var V7=Object.defineProperty;var B7=(d,f,_)=>f in d?V7(d,f,{enumerable:!0,configurable:!0,writable:!0,value:_}):d[f]=_;var od=(d,f,_)=>B7(d,typeof f!="symbol"?f+"":f,_);function j7(d,f){for(var _=0;_<f.length;_++){const g=f[_];if(typeof g!="string"&&!Array.isArray(g)){for(const R in g)if(R!=="default"&&!(R in d)){const w=Object.getOwnPropertyDescriptor(g,R);w&&Object.defineProperty(d,R,w.get?w:{enumerable:!0,get:()=>g[R]})}}}return Object.freeze(Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}))}(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))g(R);new MutationObserver(R=>{for(const w of R)if(w.type==="childList")for(const N of w.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&g(N)}).observe(document,{childList:!0,subtree:!0});function _(R){const w={};return R.integrity&&(w.integrity=R.integrity),R.referrerPolicy&&(w.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?w.credentials="include":R.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function g(R){if(R.ep)return;R.ep=!0;const w=_(R);fetch(R.href,w)}})();var xO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jN(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var UO={exports:{}},FS={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nj;function F7(){if(Nj)return FS;Nj=1;var d=Symbol.for("react.transitional.element"),f=Symbol.for("react.fragment");function _(g,R,w){var N=null;if(w!==void 0&&(N=""+w),R.key!==void 0&&(N=""+R.key),"key"in R){w={};for(var L in R)L!=="key"&&(w[L]=R[L])}else w=R;return R=w.ref,{$$typeof:d,type:g,key:N,ref:R!==void 0?R:null,props:w}}return FS.Fragment=f,FS.jsx=_,FS.jsxs=_,FS}var Dj;function G7(){return Dj||(Dj=1,UO.exports=F7()),UO.exports}var Rt=G7(),VO={exports:{}},cn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pj;function H7(){if(Pj)return cn;Pj=1;var d=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),w=Symbol.for("react.consumer"),N=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),Y=Symbol.iterator;function et(st){return st===null||typeof st!="object"?null:(st=Y&&st[Y]||st["@@iterator"],typeof st=="function"?st:null)}var z={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},J=Object.assign,X={};function tt(st,xt,Qt){this.props=st,this.context=xt,this.refs=X,this.updater=Qt||z}tt.prototype.isReactComponent={},tt.prototype.setState=function(st,xt){if(typeof st!="object"&&typeof st!="function"&&st!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,st,xt,"setState")},tt.prototype.forceUpdate=function(st){this.updater.enqueueForceUpdate(this,st,"forceUpdate")};function dt(){}dt.prototype=tt.prototype;function pt(st,xt,Qt){this.props=st,this.context=xt,this.refs=X,this.updater=Qt||z}var ot=pt.prototype=new dt;ot.constructor=pt,J(ot,tt.prototype),ot.isPureReactComponent=!0;var bt=Array.isArray,St={H:null,A:null,T:null,S:null},Ft=Object.prototype.hasOwnProperty;function Bt(st,xt,Qt,ee,zt,ve){return Qt=ve.ref,{$$typeof:d,type:st,key:xt,ref:Qt!==void 0?Qt:null,props:ve}}function se(st,xt){return Bt(st.type,xt,void 0,void 0,void 0,st.props)}function Jt(st){return typeof st=="object"&&st!==null&&st.$$typeof===d}function ae(st){var xt={"=":"=0",":":"=2"};return"$"+st.replace(/[=:]/g,function(Qt){return xt[Qt]})}var we=/\/+/g;function de(st,xt){return typeof st=="object"&&st!==null&&st.key!=null?ae(""+st.key):xt.toString(36)}function Re(){}function Zt(st){switch(st.status){case"fulfilled":return st.value;case"rejected":throw st.reason;default:switch(typeof st.status=="string"?st.then(Re,Re):(st.status="pending",st.then(function(xt){st.status==="pending"&&(st.status="fulfilled",st.value=xt)},function(xt){st.status==="pending"&&(st.status="rejected",st.reason=xt)})),st.status){case"fulfilled":return st.value;case"rejected":throw st.reason}}throw st}function Ae(st,xt,Qt,ee,zt){var ve=typeof st;(ve==="undefined"||ve==="boolean")&&(st=null);var ye=!1;if(st===null)ye=!0;else switch(ve){case"bigint":case"string":case"number":ye=!0;break;case"object":switch(st.$$typeof){case d:case f:ye=!0;break;case G:return ye=st._init,Ae(ye(st._payload),xt,Qt,ee,zt)}}if(ye)return zt=zt(st),ye=ee===""?"."+de(st,0):ee,bt(zt)?(Qt="",ye!=null&&(Qt=ye.replace(we,"$&/")+"/"),Ae(zt,xt,Qt,"",function(Le){return Le})):zt!=null&&(Jt(zt)&&(zt=se(zt,Qt+(zt.key==null||st&&st.key===zt.key?"":(""+zt.key).replace(we,"$&/")+"/")+ye)),xt.push(zt)),1;ye=0;var te=ee===""?".":ee+":";if(bt(st))for(var _e=0;_e<st.length;_e++)ee=st[_e],ve=te+de(ee,_e),ye+=Ae(ee,xt,Qt,ve,zt);else if(_e=et(st),typeof _e=="function")for(st=_e.call(st),_e=0;!(ee=st.next()).done;)ee=ee.value,ve=te+de(ee,_e++),ye+=Ae(ee,xt,Qt,ve,zt);else if(ve==="object"){if(typeof st.then=="function")return Ae(Zt(st),xt,Qt,ee,zt);throw xt=String(st),Error("Objects are not valid as a React child (found: "+(xt==="[object Object]"?"object with keys {"+Object.keys(st).join(", ")+"}":xt)+"). If you meant to render a collection of children, use an array instead.")}return ye}function It(st,xt,Qt){if(st==null)return st;var ee=[],zt=0;return Ae(st,ee,"","",function(ve){return xt.call(Qt,ve,zt++)}),ee}function Gt(st){if(st._status===-1){var xt=st._result;xt=xt(),xt.then(function(Qt){(st._status===0||st._status===-1)&&(st._status=1,st._result=Qt)},function(Qt){(st._status===0||st._status===-1)&&(st._status=2,st._result=Qt)}),st._status===-1&&(st._status=0,st._result=xt)}if(st._status===1)return st._result.default;throw st._result}var Nt=typeof reportError=="function"?reportError:function(st){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var xt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof st=="object"&&st!==null&&typeof st.message=="string"?String(st.message):String(st),error:st});if(!window.dispatchEvent(xt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",st);return}console.error(st)};function Yt(){}return cn.Children={map:It,forEach:function(st,xt,Qt){It(st,function(){xt.apply(this,arguments)},Qt)},count:function(st){var xt=0;return It(st,function(){xt++}),xt},toArray:function(st){return It(st,function(xt){return xt})||[]},only:function(st){if(!Jt(st))throw Error("React.Children.only expected to receive a single React element child.");return st}},cn.Component=tt,cn.Fragment=_,cn.Profiler=R,cn.PureComponent=pt,cn.StrictMode=g,cn.Suspense=V,cn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=St,cn.act=function(){throw Error("act(...) is not supported in production builds of React.")},cn.cache=function(st){return function(){return st.apply(null,arguments)}},cn.cloneElement=function(st,xt,Qt){if(st==null)throw Error("The argument must be a React element, but you passed "+st+".");var ee=J({},st.props),zt=st.key,ve=void 0;if(xt!=null)for(ye in xt.ref!==void 0&&(ve=void 0),xt.key!==void 0&&(zt=""+xt.key),xt)!Ft.call(xt,ye)||ye==="key"||ye==="__self"||ye==="__source"||ye==="ref"&&xt.ref===void 0||(ee[ye]=xt[ye]);var ye=arguments.length-2;if(ye===1)ee.children=Qt;else if(1<ye){for(var te=Array(ye),_e=0;_e<ye;_e++)te[_e]=arguments[_e+2];ee.children=te}return Bt(st.type,zt,void 0,void 0,ve,ee)},cn.createContext=function(st){return st={$$typeof:N,_currentValue:st,_currentValue2:st,_threadCount:0,Provider:null,Consumer:null},st.Provider=st,st.Consumer={$$typeof:w,_context:st},st},cn.createElement=function(st,xt,Qt){var ee,zt={},ve=null;if(xt!=null)for(ee in xt.key!==void 0&&(ve=""+xt.key),xt)Ft.call(xt,ee)&&ee!=="key"&&ee!=="__self"&&ee!=="__source"&&(zt[ee]=xt[ee]);var ye=arguments.length-2;if(ye===1)zt.children=Qt;else if(1<ye){for(var te=Array(ye),_e=0;_e<ye;_e++)te[_e]=arguments[_e+2];zt.children=te}if(st&&st.defaultProps)for(ee in ye=st.defaultProps,ye)zt[ee]===void 0&&(zt[ee]=ye[ee]);return Bt(st,ve,void 0,void 0,null,zt)},cn.createRef=function(){return{current:null}},cn.forwardRef=function(st){return{$$typeof:L,render:st}},cn.isValidElement=Jt,cn.lazy=function(st){return{$$typeof:G,_payload:{_status:-1,_result:st},_init:Gt}},cn.memo=function(st,xt){return{$$typeof:x,type:st,compare:xt===void 0?null:xt}},cn.startTransition=function(st){var xt=St.T,Qt={};St.T=Qt;try{var ee=st(),zt=St.S;zt!==null&&zt(Qt,ee),typeof ee=="object"&&ee!==null&&typeof ee.then=="function"&&ee.then(Yt,Nt)}catch(ve){Nt(ve)}finally{St.T=xt}},cn.unstable_useCacheRefresh=function(){return St.H.useCacheRefresh()},cn.use=function(st){return St.H.use(st)},cn.useActionState=function(st,xt,Qt){return St.H.useActionState(st,xt,Qt)},cn.useCallback=function(st,xt){return St.H.useCallback(st,xt)},cn.useContext=function(st){return St.H.useContext(st)},cn.useDebugValue=function(){},cn.useDeferredValue=function(st,xt){return St.H.useDeferredValue(st,xt)},cn.useEffect=function(st,xt){return St.H.useEffect(st,xt)},cn.useId=function(){return St.H.useId()},cn.useImperativeHandle=function(st,xt,Qt){return St.H.useImperativeHandle(st,xt,Qt)},cn.useInsertionEffect=function(st,xt){return St.H.useInsertionEffect(st,xt)},cn.useLayoutEffect=function(st,xt){return St.H.useLayoutEffect(st,xt)},cn.useMemo=function(st,xt){return St.H.useMemo(st,xt)},cn.useOptimistic=function(st,xt){return St.H.useOptimistic(st,xt)},cn.useReducer=function(st,xt,Qt){return St.H.useReducer(st,xt,Qt)},cn.useRef=function(st){return St.H.useRef(st)},cn.useState=function(st){return St.H.useState(st)},cn.useSyncExternalStore=function(st,xt,Qt){return St.H.useSyncExternalStore(st,xt,Qt)},cn.useTransition=function(){return St.H.useTransition()},cn.version="19.0.0",cn}var Lj;function LC(){return Lj||(Lj=1,VO.exports=H7()),VO.exports}var Z=LC();const re=jN(Z),W7=j7({__proto__:null,default:re},[Z]);var BO={exports:{}},GS={},jO={exports:{}},FO={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kj;function K7(){return kj||(kj=1,function(d){function f(It,Gt){var Nt=It.length;It.push(Gt);t:for(;0<Nt;){var Yt=Nt-1>>>1,st=It[Yt];if(0<R(st,Gt))It[Yt]=Gt,It[Nt]=st,Nt=Yt;else break t}}function _(It){return It.length===0?null:It[0]}function g(It){if(It.length===0)return null;var Gt=It[0],Nt=It.pop();if(Nt!==Gt){It[0]=Nt;t:for(var Yt=0,st=It.length,xt=st>>>1;Yt<xt;){var Qt=2*(Yt+1)-1,ee=It[Qt],zt=Qt+1,ve=It[zt];if(0>R(ee,Nt))zt<st&&0>R(ve,ee)?(It[Yt]=ve,It[zt]=Nt,Yt=zt):(It[Yt]=ee,It[Qt]=Nt,Yt=Qt);else if(zt<st&&0>R(ve,Nt))It[Yt]=ve,It[zt]=Nt,Yt=zt;else break t}}return Gt}function R(It,Gt){var Nt=It.sortIndex-Gt.sortIndex;return Nt!==0?Nt:It.id-Gt.id}if(d.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var w=performance;d.unstable_now=function(){return w.now()}}else{var N=Date,L=N.now();d.unstable_now=function(){return N.now()-L}}var V=[],x=[],G=1,Y=null,et=3,z=!1,J=!1,X=!1,tt=typeof setTimeout=="function"?setTimeout:null,dt=typeof clearTimeout=="function"?clearTimeout:null,pt=typeof setImmediate<"u"?setImmediate:null;function ot(It){for(var Gt=_(x);Gt!==null;){if(Gt.callback===null)g(x);else if(Gt.startTime<=It)g(x),Gt.sortIndex=Gt.expirationTime,f(V,Gt);else break;Gt=_(x)}}function bt(It){if(X=!1,ot(It),!J)if(_(V)!==null)J=!0,Zt();else{var Gt=_(x);Gt!==null&&Ae(bt,Gt.startTime-It)}}var St=!1,Ft=-1,Bt=5,se=-1;function Jt(){return!(d.unstable_now()-se<Bt)}function ae(){if(St){var It=d.unstable_now();se=It;var Gt=!0;try{t:{J=!1,X&&(X=!1,dt(Ft),Ft=-1),z=!0;var Nt=et;try{e:{for(ot(It),Y=_(V);Y!==null&&!(Y.expirationTime>It&&Jt());){var Yt=Y.callback;if(typeof Yt=="function"){Y.callback=null,et=Y.priorityLevel;var st=Yt(Y.expirationTime<=It);if(It=d.unstable_now(),typeof st=="function"){Y.callback=st,ot(It),Gt=!0;break e}Y===_(V)&&g(V),ot(It)}else g(V);Y=_(V)}if(Y!==null)Gt=!0;else{var xt=_(x);xt!==null&&Ae(bt,xt.startTime-It),Gt=!1}}break t}finally{Y=null,et=Nt,z=!1}Gt=void 0}}finally{Gt?we():St=!1}}}var we;if(typeof pt=="function")we=function(){pt(ae)};else if(typeof MessageChannel<"u"){var de=new MessageChannel,Re=de.port2;de.port1.onmessage=ae,we=function(){Re.postMessage(null)}}else we=function(){tt(ae,0)};function Zt(){St||(St=!0,we())}function Ae(It,Gt){Ft=tt(function(){It(d.unstable_now())},Gt)}d.unstable_IdlePriority=5,d.unstable_ImmediatePriority=1,d.unstable_LowPriority=4,d.unstable_NormalPriority=3,d.unstable_Profiling=null,d.unstable_UserBlockingPriority=2,d.unstable_cancelCallback=function(It){It.callback=null},d.unstable_continueExecution=function(){J||z||(J=!0,Zt())},d.unstable_forceFrameRate=function(It){0>It||125<It?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Bt=0<It?Math.floor(1e3/It):5},d.unstable_getCurrentPriorityLevel=function(){return et},d.unstable_getFirstCallbackNode=function(){return _(V)},d.unstable_next=function(It){switch(et){case 1:case 2:case 3:var Gt=3;break;default:Gt=et}var Nt=et;et=Gt;try{return It()}finally{et=Nt}},d.unstable_pauseExecution=function(){},d.unstable_requestPaint=function(){},d.unstable_runWithPriority=function(It,Gt){switch(It){case 1:case 2:case 3:case 4:case 5:break;default:It=3}var Nt=et;et=It;try{return Gt()}finally{et=Nt}},d.unstable_scheduleCallback=function(It,Gt,Nt){var Yt=d.unstable_now();switch(typeof Nt=="object"&&Nt!==null?(Nt=Nt.delay,Nt=typeof Nt=="number"&&0<Nt?Yt+Nt:Yt):Nt=Yt,It){case 1:var st=-1;break;case 2:st=250;break;case 5:st=1073741823;break;case 4:st=1e4;break;default:st=5e3}return st=Nt+st,It={id:G++,callback:Gt,priorityLevel:It,startTime:Nt,expirationTime:st,sortIndex:-1},Nt>Yt?(It.sortIndex=Nt,f(x,It),_(V)===null&&It===_(x)&&(X?(dt(Ft),Ft=-1):X=!0,Ae(bt,Nt-Yt))):(It.sortIndex=st,f(V,It),J||z||(J=!0,Zt())),It},d.unstable_shouldYield=Jt,d.unstable_wrapCallback=function(It){var Gt=et;return function(){var Nt=et;et=Gt;try{return It.apply(this,arguments)}finally{et=Nt}}}}(FO)),FO}var Mj;function z7(){return Mj||(Mj=1,jO.exports=K7()),jO.exports}var GO={exports:{}},us={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xj;function Y7(){if(xj)return us;xj=1;var d=LC();function f(V){var x="https://react.dev/errors/"+V;if(1<arguments.length){x+="?args[]="+encodeURIComponent(arguments[1]);for(var G=2;G<arguments.length;G++)x+="&args[]="+encodeURIComponent(arguments[G])}return"Minified React error #"+V+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function _(){}var g={d:{f:_,r:function(){throw Error(f(522))},D:_,C:_,L:_,m:_,X:_,S:_,M:_},p:0,findDOMNode:null},R=Symbol.for("react.portal");function w(V,x,G){var Y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:R,key:Y==null?null:""+Y,children:V,containerInfo:x,implementation:G}}var N=d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function L(V,x){if(V==="font")return"";if(typeof x=="string")return x==="use-credentials"?x:""}return us.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=g,us.createPortal=function(V,x){var G=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!x||x.nodeType!==1&&x.nodeType!==9&&x.nodeType!==11)throw Error(f(299));return w(V,x,null,G)},us.flushSync=function(V){var x=N.T,G=g.p;try{if(N.T=null,g.p=2,V)return V()}finally{N.T=x,g.p=G,g.d.f()}},us.preconnect=function(V,x){typeof V=="string"&&(x?(x=x.crossOrigin,x=typeof x=="string"?x==="use-credentials"?x:"":void 0):x=null,g.d.C(V,x))},us.prefetchDNS=function(V){typeof V=="string"&&g.d.D(V)},us.preinit=function(V,x){if(typeof V=="string"&&x&&typeof x.as=="string"){var G=x.as,Y=L(G,x.crossOrigin),et=typeof x.integrity=="string"?x.integrity:void 0,z=typeof x.fetchPriority=="string"?x.fetchPriority:void 0;G==="style"?g.d.S(V,typeof x.precedence=="string"?x.precedence:void 0,{crossOrigin:Y,integrity:et,fetchPriority:z}):G==="script"&&g.d.X(V,{crossOrigin:Y,integrity:et,fetchPriority:z,nonce:typeof x.nonce=="string"?x.nonce:void 0})}},us.preinitModule=function(V,x){if(typeof V=="string")if(typeof x=="object"&&x!==null){if(x.as==null||x.as==="script"){var G=L(x.as,x.crossOrigin);g.d.M(V,{crossOrigin:G,integrity:typeof x.integrity=="string"?x.integrity:void 0,nonce:typeof x.nonce=="string"?x.nonce:void 0})}}else x==null&&g.d.M(V)},us.preload=function(V,x){if(typeof V=="string"&&typeof x=="object"&&x!==null&&typeof x.as=="string"){var G=x.as,Y=L(G,x.crossOrigin);g.d.L(V,G,{crossOrigin:Y,integrity:typeof x.integrity=="string"?x.integrity:void 0,nonce:typeof x.nonce=="string"?x.nonce:void 0,type:typeof x.type=="string"?x.type:void 0,fetchPriority:typeof x.fetchPriority=="string"?x.fetchPriority:void 0,referrerPolicy:typeof x.referrerPolicy=="string"?x.referrerPolicy:void 0,imageSrcSet:typeof x.imageSrcSet=="string"?x.imageSrcSet:void 0,imageSizes:typeof x.imageSizes=="string"?x.imageSizes:void 0,media:typeof x.media=="string"?x.media:void 0})}},us.preloadModule=function(V,x){if(typeof V=="string")if(x){var G=L(x.as,x.crossOrigin);g.d.m(V,{as:typeof x.as=="string"&&x.as!=="script"?x.as:void 0,crossOrigin:G,integrity:typeof x.integrity=="string"?x.integrity:void 0})}else g.d.m(V)},us.requestFormReset=function(V){g.d.r(V)},us.unstable_batchedUpdates=function(V,x){return V(x)},us.useFormState=function(V,x,G){return N.H.useFormState(V,x,G)},us.useFormStatus=function(){return N.H.useHostTransitionStatus()},us.version="19.0.0",us}var Uj;function YF(){if(Uj)return GO.exports;Uj=1;function d(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(d)}catch(f){console.error(f)}}return d(),GO.exports=Y7(),GO.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vj;function q7(){if(Vj)return GS;Vj=1;var d=z7(),f=LC(),_=YF();function g(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function R(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}var w=Symbol.for("react.element"),N=Symbol.for("react.transitional.element"),L=Symbol.for("react.portal"),V=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),G=Symbol.for("react.profiler"),Y=Symbol.for("react.provider"),et=Symbol.for("react.consumer"),z=Symbol.for("react.context"),J=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),tt=Symbol.for("react.suspense_list"),dt=Symbol.for("react.memo"),pt=Symbol.for("react.lazy"),ot=Symbol.for("react.offscreen"),bt=Symbol.for("react.memo_cache_sentinel"),St=Symbol.iterator;function Ft(s){return s===null||typeof s!="object"?null:(s=St&&s[St]||s["@@iterator"],typeof s=="function"?s:null)}var Bt=Symbol.for("react.client.reference");function se(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Bt?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case V:return"Fragment";case L:return"Portal";case G:return"Profiler";case x:return"StrictMode";case X:return"Suspense";case tt:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case z:return(s.displayName||"Context")+".Provider";case et:return(s._context.displayName||"Context")+".Consumer";case J:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case dt:return a=s.displayName||null,a!==null?a:se(s.type)||"Memo";case pt:a=s._payload,s=s._init;try{return se(s(a))}catch{}}return null}var Jt=f.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae=Object.assign,we,de;function Re(s){if(we===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);we=a&&a[1]||"",de=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+we+s+de}var Zt=!1;function Ae(s,a){if(!s||Zt)return"";Zt=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var E={DetermineComponentFrameRoot:function(){try{if(a){var Xt=function(){throw Error()};if(Object.defineProperty(Xt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Xt,[])}catch(Pt){var vt=Pt}Reflect.construct(s,[],Xt)}else{try{Xt.call()}catch(Pt){vt=Pt}s.call(Xt.prototype)}}else{try{throw Error()}catch(Pt){vt=Pt}(Xt=s())&&typeof Xt.catch=="function"&&Xt.catch(function(){})}}catch(Pt){if(Pt&&vt&&typeof Pt.stack=="string")return[Pt.stack,vt.stack]}return[null,null]}};E.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var T=Object.getOwnPropertyDescriptor(E.DetermineComponentFrameRoot,"name");T&&T.configurable&&Object.defineProperty(E.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=E.DetermineComponentFrameRoot(),B=C[0],K=C[1];if(B&&K){var nt=B.split(`
`),ut=K.split(`
`);for(T=E=0;E<nt.length&&!nt[E].includes("DetermineComponentFrameRoot");)E++;for(;T<ut.length&&!ut[T].includes("DetermineComponentFrameRoot");)T++;if(E===nt.length||T===ut.length)for(E=nt.length-1,T=ut.length-1;1<=E&&0<=T&&nt[E]!==ut[T];)T--;for(;1<=E&&0<=T;E--,T--)if(nt[E]!==ut[T]){if(E!==1||T!==1)do if(E--,T--,0>T||nt[E]!==ut[T]){var kt=`
`+nt[E].replace(" at new "," at ");return s.displayName&&kt.includes("<anonymous>")&&(kt=kt.replace("<anonymous>",s.displayName)),kt}while(1<=E&&0<=T);break}}}finally{Zt=!1,Error.prepareStackTrace=u}return(u=s?s.displayName||s.name:"")?Re(u):""}function It(s){switch(s.tag){case 26:case 27:case 5:return Re(s.type);case 16:return Re("Lazy");case 13:return Re("Suspense");case 19:return Re("SuspenseList");case 0:case 15:return s=Ae(s.type,!1),s;case 11:return s=Ae(s.type.render,!1),s;case 1:return s=Ae(s.type,!0),s;default:return""}}function Gt(s){try{var a="";do a+=It(s),s=s.return;while(s);return a}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Nt(s){var a=s,u=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,a.flags&4098&&(u=a.return),s=a.return;while(s)}return a.tag===3?u:null}function Yt(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function st(s){if(Nt(s)!==s)throw Error(g(188))}function xt(s){var a=s.alternate;if(!a){if(a=Nt(s),a===null)throw Error(g(188));return a!==s?null:s}for(var u=s,E=a;;){var T=u.return;if(T===null)break;var C=T.alternate;if(C===null){if(E=T.return,E!==null){u=E;continue}break}if(T.child===C.child){for(C=T.child;C;){if(C===u)return st(T),s;if(C===E)return st(T),a;C=C.sibling}throw Error(g(188))}if(u.return!==E.return)u=T,E=C;else{for(var B=!1,K=T.child;K;){if(K===u){B=!0,u=T,E=C;break}if(K===E){B=!0,E=T,u=C;break}K=K.sibling}if(!B){for(K=C.child;K;){if(K===u){B=!0,u=C,E=T;break}if(K===E){B=!0,E=C,u=T;break}K=K.sibling}if(!B)throw Error(g(189))}}if(u.alternate!==E)throw Error(g(190))}if(u.tag!==3)throw Error(g(188));return u.stateNode.current===u?s:a}function Qt(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=Qt(s),a!==null)return a;s=s.sibling}return null}var ee=Array.isArray,zt=_.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ve={pending:!1,data:null,method:null,action:null},ye=[],te=-1;function _e(s){return{current:s}}function Le(s){0>te||(s.current=ye[te],ye[te]=null,te--)}function Se(s,a){te++,ye[te]=s.current,s.current=a}var ze=_e(null),ln=_e(null),Pn=_e(null),cr=_e(null);function ws(s,a){switch(Se(Pn,a),Se(ln,s),Se(ze,null),s=a.nodeType,s){case 9:case 11:a=(a=a.documentElement)&&(a=a.namespaceURI)?vg(a):0;break;default:if(s=s===8?a.parentNode:a,a=s.tagName,s=s.namespaceURI)s=vg(s),a=yg(s,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Le(ze),Se(ze,a)}function Ii(){Le(ze),Le(ln),Le(Pn)}function to(s){s.memoizedState!==null&&Se(cr,s);var a=ze.current,u=yg(a,s.type);a!==u&&(Se(ln,s),Se(ze,u))}function pi(s){ln.current===s&&(Le(ze),Le(ln)),cr.current===s&&(Le(cr),jh._currentValue=ve)}var Oi=Object.prototype.hasOwnProperty,nc=d.unstable_scheduleCallback,eo=d.unstable_cancelCallback,Up=d.unstable_shouldYield,Io=d.unstable_requestPaint,Wn=d.unstable_now,Vp=d.unstable_getCurrentPriorityLevel,gr=d.unstable_ImmediatePriority,lr=d.unstable_UserBlockingPriority,ul=d.unstable_NormalPriority,xu=d.unstable_LowPriority,ic=d.unstable_IdlePriority,Bp=d.log,Uu=d.unstable_setDisableYieldValue,Oo=null,oi=null;function Vu(s){if(oi&&typeof oi.onCommitFiberRoot=="function")try{oi.onCommitFiberRoot(Oo,s,void 0,(s.current.flags&128)===128)}catch{}}function Pr(s){if(typeof Bp=="function"&&Uu(s),oi&&typeof oi.setStrictMode=="function")try{oi.setStrictMode(Oo,s)}catch{}}var Lr=Math.clz32?Math.clz32:jp,rc=Math.log,Bu=Math.LN2;function jp(s){return s>>>=0,s===0?32:31-(rc(s)/Bu|0)|0}var hd=128,sc=4194304;function Sr(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function No(s,a){var u=s.pendingLanes;if(u===0)return 0;var E=0,T=s.suspendedLanes,C=s.pingedLanes,B=s.warmLanes;s=s.finishedLanes!==0;var K=u&134217727;return K!==0?(u=K&~T,u!==0?E=Sr(u):(C&=K,C!==0?E=Sr(C):s||(B=K&~B,B!==0&&(E=Sr(B))))):(K=u&~T,K!==0?E=Sr(K):C!==0?E=Sr(C):s||(B=u&~B,B!==0&&(E=Sr(B)))),E===0?0:a!==0&&a!==E&&!(a&T)&&(T=E&-E,B=a&-a,T>=B||T===32&&(B&4194176)!==0)?a:E}function je(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function Tn(s,a){switch(s){case 1:case 2:case 4:case 8:return a+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Qn(){var s=hd;return hd<<=1,!(hd&4194176)&&(hd=128),s}function Yr(){var s=sc;return sc<<=1,!(sc&62914560)&&(sc=4194304),s}function kr(s){for(var a=[],u=0;31>u;u++)a.push(s);return a}function Zn(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function ha(s,a,u,E,T,C){var B=s.pendingLanes;s.pendingLanes=u,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=u,s.entangledLanes&=u,s.errorRecoveryDisabledLanes&=u,s.shellSuspendCounter=0;var K=s.entanglements,nt=s.expirationTimes,ut=s.hiddenUpdates;for(u=B&~u;0<u;){var kt=31-Lr(u),Xt=1<<kt;K[kt]=0,nt[kt]=-1;var vt=ut[kt];if(vt!==null)for(ut[kt]=null,kt=0;kt<vt.length;kt++){var Pt=vt[kt];Pt!==null&&(Pt.lane&=-536870913)}u&=~Xt}E!==0&&qr(s,E,0),C!==0&&T===0&&s.tag!==0&&(s.suspendedLanes|=C&~(B&~a))}function qr(s,a,u){s.pendingLanes|=a,s.suspendedLanes&=~a;var E=31-Lr(a);s.entangledLanes|=a,s.entanglements[E]=s.entanglements[E]|1073741824|u&4194218}function Xr(s,a){var u=s.entangledLanes|=a;for(s=s.entanglements;u;){var E=31-Lr(u),T=1<<E;T&a|s[E]&a&&(s[E]|=a),u&=~T}}function HE(s){return s&=-s,2<s?8<s?s&134217727?32:268435456:8:2}function WE(){var s=zt.p;return s!==0?s:(s=window.event,s===void 0?32:Fy(s.type))}function oT(s,a){var u=zt.p;try{return zt.p=s,a()}finally{zt.p=u}}var oc=Math.random().toString(36).slice(2),dr="__reactFiber$"+oc,Jr="__reactProps$"+oc,hl="__reactContainer$"+oc,KE="__reactEvents$"+oc,ZC="__reactListeners$"+oc,$C="__reactHandles$"+oc,zE="__reactResources$"+oc,pd="__reactMarker$"+oc;function ju(s){delete s[dr],delete s[Jr],delete s[KE],delete s[ZC],delete s[$C]}function ac(s){var a=s[dr];if(a)return a;for(var u=s.parentNode;u;){if(a=u[hl]||u[dr]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(s=Cy(s);s!==null;){if(u=s[dr])return u;s=Cy(s)}return a}s=u,u=s.parentNode}return null}function no(s){if(s=s[dr]||s[hl]){var a=s.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return s}return null}function Fu(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(g(33))}function fd(s){var a=s[zE];return a||(a=s[zE]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function $n(s){s[pd]=!0}var aT=new Set,cT={};function ti(s,a){md(s,a),md(s+"Capture",a)}function md(s,a){for(cT[s]=a,s=0;s<a.length;s++)aT.add(a[s])}var pa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),tA=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),lT={},Fp={};function eA(s){return Oi.call(Fp,s)?!0:Oi.call(lT,s)?!1:tA.test(s)?Fp[s]=!0:(lT[s]=!0,!1)}function Gu(s,a,u){if(eA(a))if(u===null)s.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var E=a.toLowerCase().slice(0,5);if(E!=="data-"&&E!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+u)}}function Gp(s,a,u){if(u===null)s.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+u)}}function fa(s,a,u,E){if(E===null)s.removeAttribute(u);else{switch(typeof E){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(u);return}s.setAttributeNS(a,u,""+E)}}function Is(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function pl(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function YE(s){var a=pl(s)?"checked":"value",u=Object.getOwnPropertyDescriptor(s.constructor.prototype,a),E=""+s[a];if(!s.hasOwnProperty(a)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var T=u.get,C=u.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return T.call(this)},set:function(B){E=""+B,C.call(this,B)}}),Object.defineProperty(s,a,{enumerable:u.enumerable}),{getValue:function(){return E},setValue:function(B){E=""+B},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function Hp(s){s._valueTracker||(s._valueTracker=YE(s))}function Fn(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var u=a.getValue(),E="";return s&&(E=pl(s)?s.checked?"true":"false":s.value),s=E,s!==u?(a.setValue(s),!0):!1}function Wp(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var dT=/[\n"\\]/g;function ps(s){return s.replace(dT,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function qE(s,a,u,E,T,C,B,K){s.name="",B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?s.type=B:s.removeAttribute("type"),a!=null?B==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Is(a)):s.value!==""+Is(a)&&(s.value=""+Is(a)):B!=="submit"&&B!=="reset"||s.removeAttribute("value"),a!=null?XE(s,B,Is(a)):u!=null?XE(s,B,Is(u)):E!=null&&s.removeAttribute("value"),T==null&&C!=null&&(s.defaultChecked=!!C),T!=null&&(s.checked=T&&typeof T!="function"&&typeof T!="symbol"),K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"?s.name=""+Is(K):s.removeAttribute("name")}function uT(s,a,u,E,T,C,B,K){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(s.type=C),a!=null||u!=null){if(!(C!=="submit"&&C!=="reset"||a!=null))return;u=u!=null?""+Is(u):"",a=a!=null?""+Is(a):u,K||a===s.value||(s.value=a),s.defaultValue=a}E=E??T,E=typeof E!="function"&&typeof E!="symbol"&&!!E,s.checked=K?s.checked:!!E,s.defaultChecked=!!E,B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(s.name=B)}function XE(s,a,u){a==="number"&&Wp(s.ownerDocument)===s||s.defaultValue===""+u||(s.defaultValue=""+u)}function Ed(s,a,u,E){if(s=s.options,a){a={};for(var T=0;T<u.length;T++)a["$"+u[T]]=!0;for(u=0;u<s.length;u++)T=a.hasOwnProperty("$"+s[u].value),s[u].selected!==T&&(s[u].selected=T),T&&E&&(s[u].defaultSelected=!0)}else{for(u=""+Is(u),a=null,T=0;T<s.length;T++){if(s[T].value===u){s[T].selected=!0,E&&(s[T].defaultSelected=!0);return}a!==null||s[T].disabled||(a=s[T])}a!==null&&(a.selected=!0)}}function hT(s,a,u){if(a!=null&&(a=""+Is(a),a!==s.value&&(s.value=a),u==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=u!=null?""+Is(u):""}function pT(s,a,u,E){if(a==null){if(E!=null){if(u!=null)throw Error(g(92));if(ee(E)){if(1<E.length)throw Error(g(93));E=E[0]}u=E}u==null&&(u=""),a=u}u=Is(a),s.defaultValue=u,E=s.textContent,E===u&&E!==""&&E!==null&&(s.value=E)}function cc(s,a){if(a){var u=s.firstChild;if(u&&u===s.lastChild&&u.nodeType===3){u.nodeValue=a;return}}s.textContent=a}var fT=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Kp(s,a,u){var E=a.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?E?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":E?s.setProperty(a,u):typeof u!="number"||u===0||fT.has(a)?a==="float"?s.cssFloat=u:s[a]=(""+u).trim():s[a]=u+"px"}function mT(s,a,u){if(a!=null&&typeof a!="object")throw Error(g(62));if(s=s.style,u!=null){for(var E in u)!u.hasOwnProperty(E)||a!=null&&a.hasOwnProperty(E)||(E.indexOf("--")===0?s.setProperty(E,""):E==="float"?s.cssFloat="":s[E]="");for(var T in a)E=a[T],a.hasOwnProperty(T)&&u[T]!==E&&Kp(s,T,E)}else for(var C in a)a.hasOwnProperty(C)&&Kp(s,C,a[C])}function Hu(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nA=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ET=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function zp(s){return ET.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var JE=null;function QE(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var _d=null,gd=null;function _T(s){var a=no(s);if(a&&(s=a.stateNode)){var u=s[Jr]||null;t:switch(s=a.stateNode,a.type){case"input":if(qE(s,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),a=u.name,u.type==="radio"&&a!=null){for(u=s;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+ps(""+a)+'"][type="radio"]'),a=0;a<u.length;a++){var E=u[a];if(E!==s&&E.form===s.form){var T=E[Jr]||null;if(!T)throw Error(g(90));qE(E,T.value,T.defaultValue,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name)}}for(a=0;a<u.length;a++)E=u[a],E.form===s.form&&Fn(E)}break t;case"textarea":hT(s,u.value,u.defaultValue);break t;case"select":a=u.value,a!=null&&Ed(s,!!u.multiple,a,!1)}}}var ZE=!1;function gT(s,a,u){if(ZE)return s(a,u);ZE=!0;try{var E=s(a);return E}finally{if(ZE=!1,(_d!==null||gd!==null)&&(Nh(),_d&&(a=_d,s=gd,gd=_d=null,_T(a),s)))for(a=0;a<s.length;a++)_T(s[a])}}function Sd(s,a){var u=s.stateNode;if(u===null)return null;var E=u[Jr]||null;if(E===null)return null;u=E[a];t:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(E=!E.disabled)||(s=s.type,E=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!E;break t;default:s=!1}if(s)return null;if(u&&typeof u!="function")throw Error(g(231,a,typeof u));return u}var $E=!1;if(pa)try{var Wu={};Object.defineProperty(Wu,"passive",{get:function(){$E=!0}}),window.addEventListener("test",Wu,Wu),window.removeEventListener("test",Wu,Wu)}catch{$E=!1}var lc=null,fl=null,Yp=null;function ST(){if(Yp)return Yp;var s,a=fl,u=a.length,E,T="value"in lc?lc.value:lc.textContent,C=T.length;for(s=0;s<u&&a[s]===T[s];s++);var B=u-s;for(E=1;E<=B&&a[u-E]===T[C-E];E++);return Yp=T.slice(s,1<E?1-E:void 0)}function qp(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Xp(){return!0}function t_(){return!1}function Qr(s){function a(u,E,T,C,B){this._reactName=u,this._targetInst=T,this.type=E,this.nativeEvent=C,this.target=B,this.currentTarget=null;for(var K in s)s.hasOwnProperty(K)&&(u=s[K],this[K]=u?u(C):C[K]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?Xp:t_,this.isPropagationStopped=t_,this}return ae(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Xp)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Xp)},persist:function(){},isPersistent:Xp}),a}var ml={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jp=Qr(ml),Os=ae({},ml,{view:0,detail:0}),Ns=Qr(Os),Qp,e_,Ku,Zp=ae({},Os,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_l,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ku&&(Ku&&s.type==="mousemove"?(Qp=s.screenX-Ku.screenX,e_=s.screenY-Ku.screenY):e_=Qp=0,Ku=s),Qp)},movementY:function(s){return"movementY"in s?s.movementY:e_}}),Tr=Qr(Zp),iA=ae({},Zp,{dataTransfer:0}),rA=Qr(iA),sA=ae({},Os,{relatedTarget:0}),Td=Qr(sA),TT=ae({},ml,{animationName:0,elapsedTime:0,pseudoElement:0}),oA=Qr(TT),n_=ae({},ml,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),aA=Qr(n_),i_=ae({},ml,{data:0}),$p=Qr(i_),r_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function El(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=lA[s])?!!a[s]:!1}function _l(){return El}var dA=ae({},Os,{key:function(s){if(s.key){var a=r_[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=qp(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?cA[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_l,charCode:function(s){return s.type==="keypress"?qp(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?qp(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),uA=Qr(dA),hA=ae({},Zp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vT=Qr(hA),pA=ae({},Os,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_l}),vd=Qr(pA),fA=ae({},ml,{propertyName:0,elapsedTime:0,pseudoElement:0}),yd=Qr(fA),yT=ae({},Zp,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),mA=Qr(yT),qe=ae({},ml,{newState:0,oldState:0}),EA=Qr(qe),_A=[9,13,27,32],s_=pa&&"CompositionEvent"in window,zu=null;pa&&"documentMode"in document&&(zu=document.documentMode);var o_=pa&&"TextEvent"in window&&!zu,RT=pa&&(!s_||zu&&8<zu&&11>=zu),bT=" ",CT=!1;function tf(s,a){switch(s){case"keyup":return _A.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function AT(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Rd=!1;function wT(s,a){switch(s){case"compositionend":return AT(a);case"keypress":return a.which!==32?null:(CT=!0,bT);case"textInput":return s=a.data,s===bT&&CT?null:s;default:return null}}function gA(s,a){if(Rd)return s==="compositionend"||!s_&&tf(s,a)?(s=ST(),Yp=fl=lc=null,Rd=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return RT&&a.locale!=="ko"?null:a.data;default:return null}}var dc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function IT(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!dc[s.type]:a==="textarea"}function OT(s,a,u,E){_d?gd?gd.push(E):gd=[E]:_d=E,a=Jd(a,"onChange"),0<a.length&&(u=new Jp("onChange","change",null,u,E),s.push({event:u,listeners:a}))}var Yu=null,bd=null;function a_(s){Ty(s,0)}function ef(s){var a=Fu(s);if(Fn(a))return s}function NT(s,a){if(s==="change")return a}var DT=!1;if(pa){var Zr;if(pa){var c_="oninput"in document;if(!c_){var PT=document.createElement("div");PT.setAttribute("oninput","return;"),c_=typeof PT.oninput=="function"}Zr=c_}else Zr=!1;DT=Zr&&(!document.documentMode||9<document.documentMode)}function LT(){Yu&&(Yu.detachEvent("onpropertychange",kT),bd=Yu=null)}function kT(s){if(s.propertyName==="value"&&ef(bd)){var a=[];OT(a,bd,s,QE(s)),gT(a_,a)}}function MT(s,a,u){s==="focusin"?(LT(),Yu=a,bd=u,Yu.attachEvent("onpropertychange",kT)):s==="focusout"&&LT()}function SA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return ef(bd)}function TA(s,a){if(s==="click")return ef(a)}function xT(s,a){if(s==="input"||s==="change")return ef(a)}function l_(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var fs=typeof Object.is=="function"?Object.is:l_;function qu(s,a){if(fs(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var u=Object.keys(s),E=Object.keys(a);if(u.length!==E.length)return!1;for(E=0;E<u.length;E++){var T=u[E];if(!Oi.call(a,T)||!fs(s[T],a[T]))return!1}return!0}function Xu(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function UT(s,a){var u=Xu(s);s=0;for(var E;u;){if(u.nodeType===3){if(E=s+u.textContent.length,s<=a&&E>=a)return{node:u,offset:a-s};s=E}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=Xu(u)}}function VT(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?VT(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function BT(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=Wp(s.document);a instanceof s.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)s=a.contentWindow;else break;a=Wp(s.document)}return a}function io(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}function vA(s,a){var u=BT(a);a=s.focusedElem;var E=s.selectionRange;if(u!==a&&a&&a.ownerDocument&&VT(a.ownerDocument.documentElement,a)){if(E!==null&&io(a)){if(s=E.start,u=E.end,u===void 0&&(u=s),"selectionStart"in a)a.selectionStart=s,a.selectionEnd=Math.min(u,a.value.length);else if(u=(s=a.ownerDocument||document)&&s.defaultView||window,u.getSelection){u=u.getSelection();var T=a.textContent.length,C=Math.min(E.start,T);E=E.end===void 0?C:Math.min(E.end,T),!u.extend&&C>E&&(T=E,E=C,C=T),T=UT(a,C);var B=UT(a,E);T&&B&&(u.rangeCount!==1||u.anchorNode!==T.node||u.anchorOffset!==T.offset||u.focusNode!==B.node||u.focusOffset!==B.offset)&&(s=s.createRange(),s.setStart(T.node,T.offset),u.removeAllRanges(),C>E?(u.addRange(s),u.extend(B.node,B.offset)):(s.setEnd(B.node,B.offset),u.addRange(s)))}}for(s=[],u=a;u=u.parentNode;)u.nodeType===1&&s.push({element:u,left:u.scrollLeft,top:u.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<s.length;a++)u=s[a],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}var yA=pa&&"documentMode"in document&&11>=document.documentMode,Yi=null,d_=null,Ju=null,u_=!1;function jT(s,a,u){var E=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;u_||Yi==null||Yi!==Wp(E)||(E=Yi,"selectionStart"in E&&io(E)?E={start:E.selectionStart,end:E.selectionEnd}:(E=(E.ownerDocument&&E.ownerDocument.defaultView||window).getSelection(),E={anchorNode:E.anchorNode,anchorOffset:E.anchorOffset,focusNode:E.focusNode,focusOffset:E.focusOffset}),Ju&&qu(Ju,E)||(Ju=E,E=Jd(d_,"onSelect"),0<E.length&&(a=new Jp("onSelect","select",null,a,u),s.push({event:a,listeners:E}),a.target=Yi)))}function uc(s,a){var u={};return u[s.toLowerCase()]=a.toLowerCase(),u["Webkit"+s]="webkit"+a,u["Moz"+s]="moz"+a,u}var Cd={animationend:uc("Animation","AnimationEnd"),animationiteration:uc("Animation","AnimationIteration"),animationstart:uc("Animation","AnimationStart"),transitionrun:uc("Transition","TransitionRun"),transitionstart:uc("Transition","TransitionStart"),transitioncancel:uc("Transition","TransitionCancel"),transitionend:uc("Transition","TransitionEnd")},h_={},FT={};pa&&(FT=document.createElement("div").style,"AnimationEvent"in window||(delete Cd.animationend.animation,delete Cd.animationiteration.animation,delete Cd.animationstart.animation),"TransitionEvent"in window||delete Cd.transitionend.transition);function hc(s){if(h_[s])return h_[s];if(!Cd[s])return s;var a=Cd[s],u;for(u in a)if(a.hasOwnProperty(u)&&u in FT)return h_[s]=a[u];return s}var GT=hc("animationend"),HT=hc("animationiteration"),nf=hc("animationstart"),p_=hc("transitionrun"),RA=hc("transitionstart"),Ct=hc("transitioncancel"),WT=hc("transitionend"),KT=new Map,zT="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function ro(s,a){KT.set(s,a),ti(a,[s])}var ms=[],gl=0,f_=0;function rf(){for(var s=gl,a=f_=gl=0;a<s;){var u=ms[a];ms[a++]=null;var E=ms[a];ms[a++]=null;var T=ms[a];ms[a++]=null;var C=ms[a];if(ms[a++]=null,E!==null&&T!==null){var B=E.pending;B===null?T.next=T:(T.next=B.next,B.next=T),E.pending=T}C!==0&&YT(u,T,C)}}function sf(s,a,u,E){ms[gl++]=s,ms[gl++]=a,ms[gl++]=u,ms[gl++]=E,f_|=E,s.lanes|=E,s=s.alternate,s!==null&&(s.lanes|=E)}function Ad(s,a,u,E){return sf(s,a,u,E),of(s)}function Ds(s,a){return sf(s,null,null,a),of(s)}function YT(s,a,u){s.lanes|=u;var E=s.alternate;E!==null&&(E.lanes|=u);for(var T=!1,C=s.return;C!==null;)C.childLanes|=u,E=C.alternate,E!==null&&(E.childLanes|=u),C.tag===22&&(s=C.stateNode,s===null||s._visibility&1||(T=!0)),s=C,C=C.return;T&&a!==null&&s.tag===3&&(C=s.stateNode,T=31-Lr(u),C=C.hiddenUpdates,s=C[T],s===null?C[T]=[a]:s.push(a),a.lane=u|536870912)}function of(s){if(50<Wo)throw Wo=0,dg=null,Error(g(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var ma={},af=new WeakMap;function Mr(s,a){if(typeof s=="object"&&s!==null){var u=af.get(s);return u!==void 0?u:(a={value:s,source:a,stack:Gt(a)},af.set(s,a),a)}return{value:s,source:a,stack:Gt(a)}}var wd=[],Id=0,cf=null,lf=0,$r=[],Ps=0,pc=null,qi=1,Ea="";function so(s,a){wd[Id++]=lf,wd[Id++]=cf,cf=s,lf=a}function qT(s,a,u){$r[Ps++]=qi,$r[Ps++]=Ea,$r[Ps++]=pc,pc=s;var E=qi;s=Ea;var T=32-Lr(E)-1;E&=~(1<<T),u+=1;var C=32-Lr(a)+T;if(30<C){var B=T-T%5;C=(E&(1<<B)-1).toString(32),E>>=B,T-=B,qi=1<<32-Lr(a)+T|u<<T|E,Ea=C+s}else qi=1<<C|u<<T|E,Ea=s}function m_(s){s.return!==null&&(so(s,1),qT(s,1,0))}function E_(s){for(;s===cf;)cf=wd[--Id],wd[Id]=null,lf=wd[--Id],wd[Id]=null;for(;s===pc;)pc=$r[--Ps],$r[Ps]=null,Ea=$r[--Ps],$r[Ps]=null,qi=$r[--Ps],$r[Ps]=null}var vr=null,ur=null,In=!1,oo=null,Ls=!1,__=Error(g(519));function fc(s){var a=Error(g(418,""));throw Qu(Mr(a,s)),__}function g_(s){var a=s.stateNode,u=s.type,E=s.memoizedProps;switch(a[dr]=s,a[Jr]=E,u){case"dialog":En("cancel",a),En("close",a);break;case"iframe":case"object":case"embed":En("load",a);break;case"video":case"audio":for(u=0;u<kc.length;u++)En(kc[u],a);break;case"source":En("error",a);break;case"img":case"image":case"link":En("error",a),En("load",a);break;case"details":En("toggle",a);break;case"input":En("invalid",a),uT(a,E.value,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name,!0),Hp(a);break;case"select":En("invalid",a);break;case"textarea":En("invalid",a),pT(a,E.value,E.defaultValue,E.children),Hp(a)}u=E.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||a.textContent===""+u||E.suppressHydrationWarning===!0||Sg(a.textContent,u)?(E.popover!=null&&(En("beforetoggle",a),En("toggle",a)),E.onScroll!=null&&En("scroll",a),E.onScrollEnd!=null&&En("scrollend",a),E.onClick!=null&&(a.onclick=Uh),a=!0):a=!1,a||fc(s)}function XT(s){for(vr=s.return;vr;)switch(vr.tag){case 3:case 27:Ls=!0;return;case 5:case 13:Ls=!1;return;default:vr=vr.return}}function Od(s){if(s!==vr)return!1;if(!In)return XT(s),In=!0,!1;var a=!1,u;if((u=s.tag!==3&&s.tag!==27)&&((u=s.tag===5)&&(u=s.type,u=!(u!=="form"&&u!=="button")||Rg(s.type,s.memoizedProps)),u=!u),u&&(a=!0),a&&ur&&fc(s),XT(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(g(317));t:{for(s=s.nextSibling,a=0;s;){if(s.nodeType===8)if(u=s.data,u==="/$"){if(a===0){ur=lo(s.nextSibling);break t}a--}else u!=="$"&&u!=="$!"&&u!=="$?"||a++;s=s.nextSibling}ur=null}}else ur=vr?lo(s.stateNode.nextSibling):null;return!0}function mc(){ur=vr=null,In=!1}function Qu(s){oo===null?oo=[s]:oo.push(s)}var Zu=Error(g(460)),JT=Error(g(474)),S_={then:function(){}};function QT(s){return s=s.status,s==="fulfilled"||s==="rejected"}function $u(){}function df(s,a,u){switch(u=s[u],u===void 0?s.push(a):u!==a&&(a.then($u,$u),a=u),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,s===Zu?Error(g(483)):s;default:if(typeof a.status=="string")a.then($u,$u);else{if(s=zn,s!==null&&100<s.shellSuspendCounter)throw Error(g(482));s=a,s.status="pending",s.then(function(E){if(a.status==="pending"){var T=a;T.status="fulfilled",T.value=E}},function(E){if(a.status==="pending"){var T=a;T.status="rejected",T.reason=E}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,s===Zu?Error(g(483)):s}throw th=a,Zu}}var th=null;function uf(){if(th===null)throw Error(g(459));var s=th;return th=null,s}var Nd=null,eh=0;function hf(s){var a=eh;return eh+=1,Nd===null&&(Nd=[]),df(Nd,s,a)}function nh(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function pf(s,a){throw a.$$typeof===w?Error(g(525)):(s=Object.prototype.toString.call(a),Error(g(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function ZT(s){var a=s._init;return a(s._payload)}function $T(s){function a(mt,lt){if(s){var gt=mt.deletions;gt===null?(mt.deletions=[lt],mt.flags|=16):gt.push(lt)}}function u(mt,lt){if(!s)return null;for(;lt!==null;)a(mt,lt),lt=lt.sibling;return null}function E(mt){for(var lt=new Map;mt!==null;)mt.key!==null?lt.set(mt.key,mt):lt.set(mt.index,mt),mt=mt.sibling;return lt}function T(mt,lt){return mt=Bo(mt,lt),mt.index=0,mt.sibling=null,mt}function C(mt,lt,gt){return mt.index=gt,s?(gt=mt.alternate,gt!==null?(gt=gt.index,gt<lt?(mt.flags|=33554434,lt):gt):(mt.flags|=33554434,lt)):(mt.flags|=1048576,lt)}function B(mt){return s&&mt.alternate===null&&(mt.flags|=33554434),mt}function K(mt,lt,gt,Ht){return lt===null||lt.tag!==6?(lt=xr(gt,mt.mode,Ht),lt.return=mt,lt):(lt=T(lt,gt),lt.return=mt,lt)}function nt(mt,lt,gt,Ht){var Ee=gt.type;return Ee===V?kt(mt,lt,gt.props.children,Ht,gt.key):lt!==null&&(lt.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===pt&&ZT(Ee)===lt.type)?(lt=T(lt,gt.props),nh(lt,gt),lt.return=mt,lt):(lt=Wf(gt.type,gt.key,gt.props,null,mt.mode,Ht),nh(lt,gt),lt.return=mt,lt)}function ut(mt,lt,gt,Ht){return lt===null||lt.tag!==4||lt.stateNode.containerInfo!==gt.containerInfo||lt.stateNode.implementation!==gt.implementation?(lt=og(gt,mt.mode,Ht),lt.return=mt,lt):(lt=T(lt,gt.children||[]),lt.return=mt,lt)}function kt(mt,lt,gt,Ht,Ee){return lt===null||lt.tag!==7?(lt=vs(gt,mt.mode,Ht,Ee),lt.return=mt,lt):(lt=T(lt,gt),lt.return=mt,lt)}function Xt(mt,lt,gt){if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return lt=xr(""+lt,mt.mode,gt),lt.return=mt,lt;if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case N:return gt=Wf(lt.type,lt.key,lt.props,null,mt.mode,gt),nh(gt,lt),gt.return=mt,gt;case L:return lt=og(lt,mt.mode,gt),lt.return=mt,lt;case pt:var Ht=lt._init;return lt=Ht(lt._payload),Xt(mt,lt,gt)}if(ee(lt)||Ft(lt))return lt=vs(lt,mt.mode,gt,null),lt.return=mt,lt;if(typeof lt.then=="function")return Xt(mt,hf(lt),gt);if(lt.$$typeof===z)return Xt(mt,Uf(mt,lt),gt);pf(mt,lt)}return null}function vt(mt,lt,gt,Ht){var Ee=lt!==null?lt.key:null;if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return Ee!==null?null:K(mt,lt,""+gt,Ht);if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case N:return gt.key===Ee?nt(mt,lt,gt,Ht):null;case L:return gt.key===Ee?ut(mt,lt,gt,Ht):null;case pt:return Ee=gt._init,gt=Ee(gt._payload),vt(mt,lt,gt,Ht)}if(ee(gt)||Ft(gt))return Ee!==null?null:kt(mt,lt,gt,Ht,null);if(typeof gt.then=="function")return vt(mt,lt,hf(gt),Ht);if(gt.$$typeof===z)return vt(mt,lt,Uf(mt,gt),Ht);pf(mt,gt)}return null}function Pt(mt,lt,gt,Ht,Ee){if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number"||typeof Ht=="bigint")return mt=mt.get(gt)||null,K(lt,mt,""+Ht,Ee);if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case N:return mt=mt.get(Ht.key===null?gt:Ht.key)||null,nt(lt,mt,Ht,Ee);case L:return mt=mt.get(Ht.key===null?gt:Ht.key)||null,ut(lt,mt,Ht,Ee);case pt:var dn=Ht._init;return Ht=dn(Ht._payload),Pt(mt,lt,gt,Ht,Ee)}if(ee(Ht)||Ft(Ht))return mt=mt.get(gt)||null,kt(lt,mt,Ht,Ee,null);if(typeof Ht.then=="function")return Pt(mt,lt,gt,hf(Ht),Ee);if(Ht.$$typeof===z)return Pt(mt,lt,gt,Uf(lt,Ht),Ee);pf(lt,Ht)}return null}function Te(mt,lt,gt,Ht){for(var Ee=null,dn=null,Ce=lt,xe=lt=0,rr=null;Ce!==null&&xe<gt.length;xe++){Ce.index>xe?(rr=Ce,Ce=null):rr=Ce.sibling;var yn=vt(mt,Ce,gt[xe],Ht);if(yn===null){Ce===null&&(Ce=rr);break}s&&Ce&&yn.alternate===null&&a(mt,Ce),lt=C(yn,lt,xe),dn===null?Ee=yn:dn.sibling=yn,dn=yn,Ce=rr}if(xe===gt.length)return u(mt,Ce),In&&so(mt,xe),Ee;if(Ce===null){for(;xe<gt.length;xe++)Ce=Xt(mt,gt[xe],Ht),Ce!==null&&(lt=C(Ce,lt,xe),dn===null?Ee=Ce:dn.sibling=Ce,dn=Ce);return In&&so(mt,xe),Ee}for(Ce=E(Ce);xe<gt.length;xe++)rr=Pt(Ce,mt,xe,gt[xe],Ht),rr!==null&&(s&&rr.alternate!==null&&Ce.delete(rr.key===null?xe:rr.key),lt=C(rr,lt,xe),dn===null?Ee=rr:dn.sibling=rr,dn=rr);return s&&Ce.forEach(function(La){return a(mt,La)}),In&&so(mt,xe),Ee}function He(mt,lt,gt,Ht){if(gt==null)throw Error(g(151));for(var Ee=null,dn=null,Ce=lt,xe=lt=0,rr=null,yn=gt.next();Ce!==null&&!yn.done;xe++,yn=gt.next()){Ce.index>xe?(rr=Ce,Ce=null):rr=Ce.sibling;var La=vt(mt,Ce,yn.value,Ht);if(La===null){Ce===null&&(Ce=rr);break}s&&Ce&&La.alternate===null&&a(mt,Ce),lt=C(La,lt,xe),dn===null?Ee=La:dn.sibling=La,dn=La,Ce=rr}if(yn.done)return u(mt,Ce),In&&so(mt,xe),Ee;if(Ce===null){for(;!yn.done;xe++,yn=gt.next())yn=Xt(mt,yn.value,Ht),yn!==null&&(lt=C(yn,lt,xe),dn===null?Ee=yn:dn.sibling=yn,dn=yn);return In&&so(mt,xe),Ee}for(Ce=E(Ce);!yn.done;xe++,yn=gt.next())yn=Pt(Ce,mt,xe,yn.value,Ht),yn!==null&&(s&&yn.alternate!==null&&Ce.delete(yn.key===null?xe:yn.key),lt=C(yn,lt,xe),dn===null?Ee=yn:dn.sibling=yn,dn=yn);return s&&Ce.forEach(function(Lg){return a(mt,Lg)}),In&&so(mt,xe),Ee}function Ni(mt,lt,gt,Ht){if(typeof gt=="object"&&gt!==null&&gt.type===V&&gt.key===null&&(gt=gt.props.children),typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case N:t:{for(var Ee=gt.key;lt!==null;){if(lt.key===Ee){if(Ee=gt.type,Ee===V){if(lt.tag===7){u(mt,lt.sibling),Ht=T(lt,gt.props.children),Ht.return=mt,mt=Ht;break t}}else if(lt.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===pt&&ZT(Ee)===lt.type){u(mt,lt.sibling),Ht=T(lt,gt.props),nh(Ht,gt),Ht.return=mt,mt=Ht;break t}u(mt,lt);break}else a(mt,lt);lt=lt.sibling}gt.type===V?(Ht=vs(gt.props.children,mt.mode,Ht,gt.key),Ht.return=mt,mt=Ht):(Ht=Wf(gt.type,gt.key,gt.props,null,mt.mode,Ht),nh(Ht,gt),Ht.return=mt,mt=Ht)}return B(mt);case L:t:{for(Ee=gt.key;lt!==null;){if(lt.key===Ee)if(lt.tag===4&&lt.stateNode.containerInfo===gt.containerInfo&&lt.stateNode.implementation===gt.implementation){u(mt,lt.sibling),Ht=T(lt,gt.children||[]),Ht.return=mt,mt=Ht;break t}else{u(mt,lt);break}else a(mt,lt);lt=lt.sibling}Ht=og(gt,mt.mode,Ht),Ht.return=mt,mt=Ht}return B(mt);case pt:return Ee=gt._init,gt=Ee(gt._payload),Ni(mt,lt,gt,Ht)}if(ee(gt))return Te(mt,lt,gt,Ht);if(Ft(gt)){if(Ee=Ft(gt),typeof Ee!="function")throw Error(g(150));return gt=Ee.call(gt),He(mt,lt,gt,Ht)}if(typeof gt.then=="function")return Ni(mt,lt,hf(gt),Ht);if(gt.$$typeof===z)return Ni(mt,lt,Uf(mt,gt),Ht);pf(mt,gt)}return typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint"?(gt=""+gt,lt!==null&&lt.tag===6?(u(mt,lt.sibling),Ht=T(lt,gt),Ht.return=mt,mt=Ht):(u(mt,lt),Ht=xr(gt,mt.mode,Ht),Ht.return=mt,mt=Ht),B(mt)):u(mt,lt)}return function(mt,lt,gt,Ht){try{eh=0;var Ee=Ni(mt,lt,gt,Ht);return Nd=null,Ee}catch(Ce){if(Ce===Zu)throw Ce;var dn=Us(29,Ce,null,mt.mode);return dn.lanes=Ht,dn.return=mt,dn}finally{}}}var Sl=$T(!0),tv=$T(!1),Dd=_e(null),ff=_e(0);function ih(s,a){s=jo,Se(ff,s),Se(Dd,a),jo=s|a.baseLanes}function Pd(){Se(ff,jo),Se(Dd,Dd.current)}function rh(){jo=ff.current,Le(Dd),Le(ff)}var ks=_e(null),Do=null;function Ec(s){var a=s.alternate;Se(Xi,Xi.current&1),Se(ks,s),Do===null&&(a===null||Dd.current!==null||a.memoizedState!==null)&&(Do=s)}function T_(s){if(s.tag===22){if(Se(Xi,Xi.current),Se(ks,s),Do===null){var a=s.alternate;a!==null&&a.memoizedState!==null&&(Do=s)}}else _a()}function _a(){Se(Xi,Xi.current),Se(ks,ks.current)}function ao(s){Le(ks),Do===s&&(Do=null),Le(Xi)}var Xi=_e(0);function mf(s){for(var a=s;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var sh=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(u,E){s.push(E)}};this.abort=function(){a.aborted=!0,s.forEach(function(u){return u()})}},bA=d.unstable_scheduleCallback,CA=d.unstable_NormalPriority,Ji={$$typeof:z,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function v_(){return{controller:new sh,data:new Map,refCount:0}}function oh(s){s.refCount--,s.refCount===0&&bA(CA,function(){s.controller.abort()})}var ah=null,Ef=0,Ld=0,kd=null;function AA(s,a){if(ah===null){var u=ah=[];Ef=0,Ld=Mh(),kd={status:"pending",value:void 0,then:function(E){u.push(E)}}}return Ef++,a.then(_f,_f),a}function _f(){if(--Ef===0&&ah!==null){kd!==null&&(kd.status="fulfilled");var s=ah;ah=null,Ld=0,kd=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function wA(s,a){var u=[],E={status:"pending",value:null,reason:null,then:function(T){u.push(T)}};return s.then(function(){E.status="fulfilled",E.value=a;for(var T=0;T<u.length;T++)(0,u[T])(a)},function(T){for(E.status="rejected",E.reason=T,T=0;T<u.length;T++)(0,u[T])(void 0)}),E}var ev=Jt.S;Jt.S=function(s,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&AA(s,a),ev!==null&&ev(s,a)};var Po=_e(null);function y_(){var s=Po.current;return s!==null?s:zn.pooledCache}function gf(s,a){a===null?Se(Po,Po.current):Se(Po,a.pool)}function nv(){var s=y_();return s===null?null:{parent:Ji._currentValue,pool:s}}var _c=0,on=null,Kn=null,Ti=null,ch=!1,Md=!1,Tl=!1,lh=0,dh=0,xd=null,IA=0;function vi(){throw Error(g(321))}function uh(s,a){if(a===null)return!1;for(var u=0;u<a.length&&u<s.length;u++)if(!fs(s[u],a[u]))return!1;return!0}function Sf(s,a,u,E,T,C){return _c=C,on=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Jt.H=s===null||s.memoizedState===null?ko:Sc,Tl=!1,C=u(E,T),Tl=!1,Md&&(C=R_(a,u,E,T)),Tf(s),C}function Tf(s){Jt.H=Lo;var a=Kn!==null&&Kn.next!==null;if(_c=0,Ti=Kn=on=null,ch=!1,dh=0,xd=null,a)throw Error(g(300));s===null||er||(s=s.dependencies,s!==null&&xf(s)&&(er=!0))}function R_(s,a,u,E){on=s;var T=0;do{if(Md&&(xd=null),dh=0,Md=!1,25<=T)throw Error(g(301));if(T+=1,Ti=Kn=null,s.updateQueue!=null){var C=s.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}Jt.H=Ms,C=a(u,E)}while(Md);return C}function iv(){var s=Jt.H,a=s.useState()[0];return a=typeof a.then=="function"?hh(a):a,s=s.useState()[0],(Kn!==null?Kn.memoizedState:null)!==s&&(on.flags|=1024),a}function Ud(){var s=lh!==0;return lh=0,s}function vl(s,a,u){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~u}function b_(s){if(ch){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}ch=!1}_c=0,Ti=Kn=on=null,Md=!1,dh=lh=0,xd=null}function ts(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ti===null?on.memoizedState=Ti=s:Ti=Ti.next=s,Ti}function ki(){if(Kn===null){var s=on.alternate;s=s!==null?s.memoizedState:null}else s=Kn.next;var a=Ti===null?on.memoizedState:Ti.next;if(a!==null)Ti=a,Kn=s;else{if(s===null)throw on.alternate===null?Error(g(467)):Error(g(310));Kn=s,s={memoizedState:Kn.memoizedState,baseState:Kn.baseState,baseQueue:Kn.baseQueue,queue:Kn.queue,next:null},Ti===null?on.memoizedState=Ti=s:Ti=Ti.next=s}return Ti}var vf;vf=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function hh(s){var a=dh;return dh+=1,xd===null&&(xd=[]),s=df(xd,s,a),a=on,(Ti===null?a.memoizedState:Ti.next)===null&&(a=a.alternate,Jt.H=a===null||a.memoizedState===null?ko:Sc),s}function ph(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return hh(s);if(s.$$typeof===z)return yr(s)}throw Error(g(438,String(s)))}function C_(s){var a=null,u=on.updateQueue;if(u!==null&&(a=u.memoCache),a==null){var E=on.alternate;E!==null&&(E=E.updateQueue,E!==null&&(E=E.memoCache,E!=null&&(a={data:E.data.map(function(T){return T.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),u===null&&(u=vf(),on.updateQueue=u),u.memoCache=a,u=a.data[a.index],u===void 0)for(u=a.data[a.index]=Array(s),E=0;E<s;E++)u[E]=bt;return a.index++,u}function ga(s,a){return typeof a=="function"?a(s):a}function yf(s){var a=ki();return A_(a,Kn,s)}function A_(s,a,u){var E=s.queue;if(E===null)throw Error(g(311));E.lastRenderedReducer=u;var T=s.baseQueue,C=E.pending;if(C!==null){if(T!==null){var B=T.next;T.next=C.next,C.next=B}a.baseQueue=T=C,E.pending=null}if(C=s.baseState,T===null)s.memoizedState=C;else{a=T.next;var K=B=null,nt=null,ut=a,kt=!1;do{var Xt=ut.lane&-536870913;if(Xt!==ut.lane?(gn&Xt)===Xt:(_c&Xt)===Xt){var vt=ut.revertLane;if(vt===0)nt!==null&&(nt=nt.next={lane:0,revertLane:0,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null}),Xt===Ld&&(kt=!0);else if((_c&vt)===vt){ut=ut.next,vt===Ld&&(kt=!0);continue}else Xt={lane:0,revertLane:ut.revertLane,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},nt===null?(K=nt=Xt,B=C):nt=nt.next=Xt,on.lanes|=vt,Fo|=vt;Xt=ut.action,Tl&&u(C,Xt),C=ut.hasEagerState?ut.eagerState:u(C,Xt)}else vt={lane:Xt,revertLane:ut.revertLane,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},nt===null?(K=nt=vt,B=C):nt=nt.next=vt,on.lanes|=Xt,Fo|=Xt;ut=ut.next}while(ut!==null&&ut!==a);if(nt===null?B=C:nt.next=K,!fs(C,s.memoizedState)&&(er=!0,kt&&(u=kd,u!==null)))throw u;s.memoizedState=C,s.baseState=B,s.baseQueue=nt,E.lastRenderedState=C}return T===null&&(E.lanes=0),[s.memoizedState,E.dispatch]}function w_(s){var a=ki(),u=a.queue;if(u===null)throw Error(g(311));u.lastRenderedReducer=s;var E=u.dispatch,T=u.pending,C=a.memoizedState;if(T!==null){u.pending=null;var B=T=T.next;do C=s(C,B.action),B=B.next;while(B!==T);fs(C,a.memoizedState)||(er=!0),a.memoizedState=C,a.baseQueue===null&&(a.baseState=C),u.lastRenderedState=C}return[C,E]}function rv(s,a,u){var E=on,T=ki(),C=In;if(C){if(u===void 0)throw Error(g(407));u=u()}else u=a();var B=!fs((Kn||T).memoizedState,u);if(B&&(T.memoizedState=u,er=!0),T=T.queue,N_(sv.bind(null,E,T,s),[s]),T.getSnapshot!==a||B||Ti!==null&&Ti.memoizedState.tag&1){if(E.flags|=2048,Bd(9,gc.bind(null,E,T,u,a),{destroy:void 0},null),zn===null)throw Error(g(349));C||_c&60||I_(E,a,u)}return u}function I_(s,a,u){s.flags|=16384,s={getSnapshot:a,value:u},a=on.updateQueue,a===null?(a=vf(),on.updateQueue=a,a.stores=[s]):(u=a.stores,u===null?a.stores=[s]:u.push(s))}function gc(s,a,u,E){a.value=u,a.getSnapshot=E,ov(a)&&av(s)}function sv(s,a,u){return u(function(){ov(a)&&av(s)})}function ov(s){var a=s.getSnapshot;s=s.value;try{var u=a();return!fs(s,u)}catch{return!0}}function av(s){var a=Ds(s,2);a!==null&&Vr(a,s,2)}function Rf(s){var a=ts();if(typeof s=="function"){var u=s;if(s=u(),Tl){Pr(!0);try{u()}finally{Pr(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:s},a}function cv(s,a,u,E){return s.baseState=u,A_(s,Kn,typeof E=="function"?E:ga)}function lv(s,a,u,E,T){if(Of(s))throw Error(g(485));if(s=a.action,s!==null){var C={payload:T,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(B){C.listeners.push(B)}};Jt.T!==null?u(!0):C.isTransition=!1,E(C),u=a.pending,u===null?(C.next=a.pending=C,dv(a,C)):(C.next=u.next,a.pending=u.next=C)}}function dv(s,a){var u=a.action,E=a.payload,T=s.state;if(a.isTransition){var C=Jt.T,B={};Jt.T=B;try{var K=u(T,E),nt=Jt.S;nt!==null&&nt(B,K),uv(s,a,K)}catch(ut){Vd(s,a,ut)}finally{Jt.T=C}}else try{C=u(T,E),uv(s,a,C)}catch(ut){Vd(s,a,ut)}}function uv(s,a,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(E){hv(s,a,E)},function(E){return Vd(s,a,E)}):hv(s,a,u)}function hv(s,a,u){a.status="fulfilled",a.value=u,pv(a),s.state=u,a=s.pending,a!==null&&(u=a.next,u===a?s.pending=null:(u=u.next,a.next=u,dv(s,u)))}function Vd(s,a,u){var E=s.pending;if(s.pending=null,E!==null){E=E.next;do a.status="rejected",a.reason=u,pv(a),a=a.next;while(a!==E)}s.action=null}function pv(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function fv(s,a){return a}function mv(s,a){if(In){var u=zn.formState;if(u!==null){t:{var E=on;if(In){if(ur){e:{for(var T=ur,C=Ls;T.nodeType!==8;){if(!C){T=null;break e}if(T=lo(T.nextSibling),T===null){T=null;break e}}C=T.data,T=C==="F!"||C==="F"?T:null}if(T){ur=lo(T.nextSibling),E=T.data==="F!";break t}}fc(E)}E=!1}E&&(a=u[0])}}return u=ts(),u.memoizedState=u.baseState=a,E={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fv,lastRenderedState:a},u.queue=E,u=If.bind(null,on,E),E.dispatch=u,E=Rf(!1),C=P_.bind(null,on,!1,E.queue),E=ts(),T={state:a,dispatch:null,action:s,pending:null},E.queue=T,u=lv.bind(null,on,T,C,u),T.dispatch=u,E.memoizedState=s,[a,u,!1]}function Ev(s){var a=ki();return _v(a,Kn,s)}function _v(s,a,u){a=A_(s,a,fv)[0],s=yf(ga)[0],a=typeof a=="object"&&a!==null&&typeof a.then=="function"?hh(a):a;var E=ki(),T=E.queue,C=T.dispatch;return u!==E.memoizedState&&(on.flags|=2048,Bd(9,OA.bind(null,T,u),{destroy:void 0},null)),[a,C,s]}function OA(s,a){s.action=a}function bf(s){var a=ki(),u=Kn;if(u!==null)return _v(a,u,s);ki(),a=a.memoizedState,u=ki();var E=u.queue.dispatch;return u.memoizedState=s,[a,E,!1]}function Bd(s,a,u,E){return s={tag:s,create:a,inst:u,deps:E,next:null},a=on.updateQueue,a===null&&(a=vf(),on.updateQueue=a),u=a.lastEffect,u===null?a.lastEffect=s.next=s:(E=u.next,u.next=s,s.next=E,a.lastEffect=s),s}function O_(){return ki().memoizedState}function Cf(s,a,u,E){var T=ts();on.flags|=s,T.memoizedState=Bd(1|a,u,{destroy:void 0},E===void 0?null:E)}function fh(s,a,u,E){var T=ki();E=E===void 0?null:E;var C=T.memoizedState.inst;Kn!==null&&E!==null&&uh(E,Kn.memoizedState.deps)?T.memoizedState=Bd(a,u,C,E):(on.flags|=s,T.memoizedState=Bd(1|a,u,C,E))}function gv(s,a){Cf(8390656,8,s,a)}function N_(s,a){fh(2048,8,s,a)}function Sv(s,a){return fh(4,2,s,a)}function Tv(s,a){return fh(4,4,s,a)}function vv(s,a){if(typeof a=="function"){s=s();var u=a(s);return function(){typeof u=="function"?u():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function yv(s,a,u){u=u!=null?u.concat([s]):null,fh(4,4,vv.bind(null,a,s),u)}function Af(){}function Rv(s,a){var u=ki();a=a===void 0?null:a;var E=u.memoizedState;return a!==null&&uh(a,E[1])?E[0]:(u.memoizedState=[s,a],s)}function bv(s,a){var u=ki();a=a===void 0?null:a;var E=u.memoizedState;if(a!==null&&uh(a,E[1]))return E[0];if(E=s(),Tl){Pr(!0);try{s()}finally{Pr(!1)}}return u.memoizedState=[E,a],E}function wf(s,a,u){return u===void 0||_c&1073741824?s.memoizedState=a:(s.memoizedState=u,s=Xf(),on.lanes|=s,Fo|=s,u)}function Cv(s,a,u,E){return fs(u,a)?u:Dd.current!==null?(s=wf(s,u,E),fs(s,a)||(er=!0),s):_c&42?(s=Xf(),on.lanes|=s,Fo|=s,a):(er=!0,s.memoizedState=u)}function mh(s,a,u,E,T){var C=zt.p;zt.p=C!==0&&8>C?C:8;var B=Jt.T,K={};Jt.T=K,P_(s,!1,a,u);try{var nt=T(),ut=Jt.S;if(ut!==null&&ut(K,nt),nt!==null&&typeof nt=="object"&&typeof nt.then=="function"){var kt=wA(nt,E);Rl(s,a,kt,ns(s))}else Rl(s,a,E,ns(s))}catch(Xt){Rl(s,a,{then:function(){},status:"rejected",reason:Xt},ns())}finally{zt.p=C,Jt.T=B}}function Av(){}function yl(s,a,u,E){if(s.tag!==5)throw Error(g(476));var T=wv(s).queue;mh(s,T,a,ve,u===null?Av:function(){return Iv(s),u(E)})}function wv(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:ve,baseState:ve,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:ve},next:null};var u={};return a.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ga,lastRenderedState:u},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function Iv(s){var a=wv(s).next.queue;Rl(s,a,{},ns())}function D_(){return yr(jh)}function Ov(){return ki().memoizedState}function Eh(){return ki().memoizedState}function NA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var u=ns();s=bc(u);var E=Cc(a,s,u);E!==null&&(Vr(E,a,u),yh(E,a,u)),a={cache:v_()},s.payload=a;return}a=a.return}}function Nv(s,a,u){var E=ns();u={lane:E,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},Of(s)?Dv(a,u):(u=Ad(s,a,u,E),u!==null&&(Vr(u,s,E),Pv(u,a,E)))}function If(s,a,u){var E=ns();Rl(s,a,u,E)}function Rl(s,a,u,E){var T={lane:E,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(Of(s))Dv(a,T);else{var C=s.alternate;if(s.lanes===0&&(C===null||C.lanes===0)&&(C=a.lastRenderedReducer,C!==null))try{var B=a.lastRenderedState,K=C(B,u);if(T.hasEagerState=!0,T.eagerState=K,fs(K,B))return sf(s,a,T,0),zn===null&&rf(),!1}catch{}finally{}if(u=Ad(s,a,T,E),u!==null)return Vr(u,s,E),Pv(u,a,E),!0}return!1}function P_(s,a,u,E){if(E={lane:2,revertLane:Mh(),action:E,hasEagerState:!1,eagerState:null,next:null},Of(s)){if(a)throw Error(g(479))}else a=Ad(s,u,E,2),a!==null&&Vr(a,s,2)}function Of(s){var a=s.alternate;return s===on||a!==null&&a===on}function Dv(s,a){Md=ch=!0;var u=s.pending;u===null?a.next=a:(a.next=u.next,u.next=a),s.pending=a}function Pv(s,a,u){if(u&4194176){var E=a.lanes;E&=s.pendingLanes,u|=E,a.lanes=u,Xr(s,u)}}var Lo={readContext:yr,use:ph,useCallback:vi,useContext:vi,useEffect:vi,useImperativeHandle:vi,useLayoutEffect:vi,useInsertionEffect:vi,useMemo:vi,useReducer:vi,useRef:vi,useState:vi,useDebugValue:vi,useDeferredValue:vi,useTransition:vi,useSyncExternalStore:vi,useId:vi};Lo.useCacheRefresh=vi,Lo.useMemoCache=vi,Lo.useHostTransitionStatus=vi,Lo.useFormState=vi,Lo.useActionState=vi,Lo.useOptimistic=vi;var ko={readContext:yr,use:ph,useCallback:function(s,a){return ts().memoizedState=[s,a===void 0?null:a],s},useContext:yr,useEffect:gv,useImperativeHandle:function(s,a,u){u=u!=null?u.concat([s]):null,Cf(4194308,4,vv.bind(null,a,s),u)},useLayoutEffect:function(s,a){return Cf(4194308,4,s,a)},useInsertionEffect:function(s,a){Cf(4,2,s,a)},useMemo:function(s,a){var u=ts();a=a===void 0?null:a;var E=s();if(Tl){Pr(!0);try{s()}finally{Pr(!1)}}return u.memoizedState=[E,a],E},useReducer:function(s,a,u){var E=ts();if(u!==void 0){var T=u(a);if(Tl){Pr(!0);try{u(a)}finally{Pr(!1)}}}else T=a;return E.memoizedState=E.baseState=T,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:T},E.queue=s,s=s.dispatch=Nv.bind(null,on,s),[E.memoizedState,s]},useRef:function(s){var a=ts();return s={current:s},a.memoizedState=s},useState:function(s){s=Rf(s);var a=s.queue,u=If.bind(null,on,a);return a.dispatch=u,[s.memoizedState,u]},useDebugValue:Af,useDeferredValue:function(s,a){var u=ts();return wf(u,s,a)},useTransition:function(){var s=Rf(!1);return s=mh.bind(null,on,s.queue,!0,!1),ts().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,u){var E=on,T=ts();if(In){if(u===void 0)throw Error(g(407));u=u()}else{if(u=a(),zn===null)throw Error(g(349));gn&60||I_(E,a,u)}T.memoizedState=u;var C={value:u,getSnapshot:a};return T.queue=C,gv(sv.bind(null,E,C,s),[s]),E.flags|=2048,Bd(9,gc.bind(null,E,C,u,a),{destroy:void 0},null),u},useId:function(){var s=ts(),a=zn.identifierPrefix;if(In){var u=Ea,E=qi;u=(E&~(1<<32-Lr(E)-1)).toString(32)+u,a=":"+a+"R"+u,u=lh++,0<u&&(a+="H"+u.toString(32)),a+=":"}else u=IA++,a=":"+a+"r"+u.toString(32)+":";return s.memoizedState=a},useCacheRefresh:function(){return ts().memoizedState=NA.bind(null,on)}};ko.useMemoCache=C_,ko.useHostTransitionStatus=D_,ko.useFormState=mv,ko.useActionState=mv,ko.useOptimistic=function(s){var a=ts();a.memoizedState=a.baseState=s;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=u,a=P_.bind(null,on,!0,u),u.dispatch=a,[s,a]};var Sc={readContext:yr,use:ph,useCallback:Rv,useContext:yr,useEffect:N_,useImperativeHandle:yv,useInsertionEffect:Sv,useLayoutEffect:Tv,useMemo:bv,useReducer:yf,useRef:O_,useState:function(){return yf(ga)},useDebugValue:Af,useDeferredValue:function(s,a){var u=ki();return Cv(u,Kn.memoizedState,s,a)},useTransition:function(){var s=yf(ga)[0],a=ki().memoizedState;return[typeof s=="boolean"?s:hh(s),a]},useSyncExternalStore:rv,useId:Ov};Sc.useCacheRefresh=Eh,Sc.useMemoCache=C_,Sc.useHostTransitionStatus=D_,Sc.useFormState=Ev,Sc.useActionState=Ev,Sc.useOptimistic=function(s,a){var u=ki();return cv(u,Kn,s,a)};var Ms={readContext:yr,use:ph,useCallback:Rv,useContext:yr,useEffect:N_,useImperativeHandle:yv,useInsertionEffect:Sv,useLayoutEffect:Tv,useMemo:bv,useReducer:w_,useRef:O_,useState:function(){return w_(ga)},useDebugValue:Af,useDeferredValue:function(s,a){var u=ki();return Kn===null?wf(u,s,a):Cv(u,Kn.memoizedState,s,a)},useTransition:function(){var s=w_(ga)[0],a=ki().memoizedState;return[typeof s=="boolean"?s:hh(s),a]},useSyncExternalStore:rv,useId:Ov};Ms.useCacheRefresh=Eh,Ms.useMemoCache=C_,Ms.useHostTransitionStatus=D_,Ms.useFormState=bf,Ms.useActionState=bf,Ms.useOptimistic=function(s,a){var u=ki();return Kn!==null?cv(u,Kn,s,a):(u.baseState=s,[s,u.queue.dispatch])};function _h(s,a,u,E){a=s.memoizedState,u=u(E,a),u=u==null?a:ae({},a,u),s.memoizedState=u,s.lanes===0&&(s.updateQueue.baseState=u)}var jd={isMounted:function(s){return(s=s._reactInternals)?Nt(s)===s:!1},enqueueSetState:function(s,a,u){s=s._reactInternals;var E=ns(),T=bc(E);T.payload=a,u!=null&&(T.callback=u),a=Cc(s,T,E),a!==null&&(Vr(a,s,E),yh(a,s,E))},enqueueReplaceState:function(s,a,u){s=s._reactInternals;var E=ns(),T=bc(E);T.tag=1,T.payload=a,u!=null&&(T.callback=u),a=Cc(s,T,E),a!==null&&(Vr(a,s,E),yh(a,s,E))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var u=ns(),E=bc(u);E.tag=2,a!=null&&(E.callback=a),a=Cc(s,E,u),a!==null&&(Vr(a,s,u),yh(a,s,u))}};function Fd(s,a,u,E,T,C,B){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(E,C,B):a.prototype&&a.prototype.isPureReactComponent?!qu(u,E)||!qu(T,C):!0}function gh(s,a,u,E){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,E),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,E),a.state!==s&&jd.enqueueReplaceState(a,a.state,null)}function bl(s,a){var u=a;if("ref"in a){u={};for(var E in a)E!=="ref"&&(u[E]=a[E])}if(s=s.defaultProps){u===a&&(u=ae({},u));for(var T in s)u[T]===void 0&&(u[T]=s[T])}return u}var Sh=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function Lv(s){Sh(s)}function L_(s){console.error(s)}function kv(s){Sh(s)}function Nf(s,a){try{var u=s.onUncaughtError;u(a.value,{componentStack:a.stack})}catch(E){setTimeout(function(){throw E})}}function Df(s,a,u){try{var E=s.onCaughtError;E(u.value,{componentStack:u.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(T){setTimeout(function(){throw T})}}function Th(s,a,u){return u=bc(u),u.tag=3,u.payload={element:null},u.callback=function(){Nf(s,a)},u}function Mv(s){return s=bc(s),s.tag=3,s}function xv(s,a,u,E){var T=u.type.getDerivedStateFromError;if(typeof T=="function"){var C=E.value;s.payload=function(){return T(C)},s.callback=function(){Df(a,u,E)}}var B=u.stateNode;B!==null&&typeof B.componentDidCatch=="function"&&(s.callback=function(){Df(a,u,E),typeof T!="function"&&(Ho===null?Ho=new Set([this]):Ho.add(this));var K=E.stack;this.componentDidCatch(E.value,{componentStack:K!==null?K:""})})}function Uv(s,a,u,E,T){if(u.flags|=32768,E!==null&&typeof E=="object"&&typeof E.then=="function"){if(a=u.alternate,a!==null&&Es(a,u,T,!0),u=ks.current,u!==null){switch(u.tag){case 13:return Do===null?Zf():u.alternate===null&&gi===0&&(gi=3),u.flags&=-257,u.flags|=65536,u.lanes=T,E===S_?u.flags|=16384:(a=u.updateQueue,a===null?u.updateQueue=new Set([E]):a.add(E),Vs(s,E,T)),!1;case 22:return u.flags|=65536,E===S_?u.flags|=16384:(a=u.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([E])},u.updateQueue=a):(u=a.retryQueue,u===null?a.retryQueue=new Set([E]):u.add(E)),Vs(s,E,T)),!1}throw Error(g(435,u.tag))}return Vs(s,E,T),Zf(),!1}if(In)return a=ks.current,a!==null?(!(a.flags&65536)&&(a.flags|=256),a.flags|=65536,a.lanes=T,E!==__&&(s=Error(g(422),{cause:E}),Qu(Mr(s,u)))):(E!==__&&(a=Error(g(423),{cause:E}),Qu(Mr(a,u))),s=s.current.alternate,s.flags|=65536,T&=-T,s.lanes|=T,E=Mr(E,u),T=Th(s.stateNode,E,T),X_(s,T),gi!==4&&(gi=2)),!1;var C=Error(g(520),{cause:E});if(C=Mr(C,u),Oh===null?Oh=[C]:Oh.push(C),gi!==4&&(gi=2),a===null)return!0;E=Mr(E,u),u=a;do{switch(u.tag){case 3:return u.flags|=65536,s=T&-T,u.lanes|=s,s=Th(u.stateNode,E,s),X_(u,s),!1;case 1:if(a=u.type,C=u.stateNode,(u.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Ho===null||!Ho.has(C))))return u.flags|=65536,T&=-T,u.lanes|=T,T=Mv(T),xv(T,s,u,E),X_(u,T),!1}u=u.return}while(u!==null);return!1}var Pf=Error(g(461)),er=!1;function ai(s,a,u,E){a.child=s===null?tv(a,null,u,E):Sl(a,s.child,u,E)}function Cl(s,a,u,E,T){u=u.render;var C=a.ref;if("ref"in E){var B={};for(var K in E)K!=="ref"&&(B[K]=E[K])}else B=E;return Il(a),E=Sf(s,a,u,B,C,T),K=Ud(),s!==null&&!er?(vl(s,a,T),xo(s,a,T)):(In&&K&&m_(a),a.flags|=1,ai(s,a,E,T),a.child)}function Tc(s,a,u,E,T){if(s===null){var C=u.type;return typeof C=="function"&&!rg(C)&&C.defaultProps===void 0&&u.compare===null?(a.tag=15,a.type=C,k_(s,a,C,E,T)):(s=Wf(u.type,null,E,a,a.mode,T),s.ref=a.ref,s.return=a,a.child=s)}if(C=s.child,!K_(s,T)){var B=C.memoizedProps;if(u=u.compare,u=u!==null?u:qu,u(B,E)&&s.ref===a.ref)return xo(s,a,T)}return a.flags|=1,s=Bo(C,E),s.ref=a.ref,s.return=a,a.child=s}function k_(s,a,u,E,T){if(s!==null){var C=s.memoizedProps;if(qu(C,E)&&s.ref===a.ref)if(er=!1,a.pendingProps=E=C,K_(s,T))s.flags&131072&&(er=!0);else return a.lanes=s.lanes,xo(s,a,T)}return x_(s,a,u,E,T)}function M_(s,a,u){var E=a.pendingProps,T=E.children,C=(a.stateNode._pendingVisibility&2)!==0,B=s!==null?s.memoizedState:null;if(Al(s,a),E.mode==="hidden"||C){if(a.flags&128){if(E=B!==null?B.baseLanes|u:u,s!==null){for(T=a.child=s.child,C=0;T!==null;)C=C|T.lanes|T.childLanes,T=T.sibling;a.childLanes=C&~E}else a.childLanes=0,a.child=null;return vc(s,a,E,u)}if(u&536870912)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&gf(a,B!==null?B.cachePool:null),B!==null?ih(a,B):Pd(),T_(a);else return a.lanes=a.childLanes=536870912,vc(s,a,B!==null?B.baseLanes|u:u,u)}else B!==null?(gf(a,B.cachePool),ih(a,B),_a(),a.memoizedState=null):(s!==null&&gf(a,null),Pd(),_a());return ai(s,a,T,u),a.child}function vc(s,a,u,E){var T=y_();return T=T===null?null:{parent:Ji._currentValue,pool:T},a.memoizedState={baseLanes:u,cachePool:T},s!==null&&gf(a,null),Pd(),T_(a),s!==null&&Es(s,a,E,!0),null}function Al(s,a){var u=a.ref;if(u===null)s!==null&&s.ref!==null&&(a.flags|=2097664);else{if(typeof u!="function"&&typeof u!="object")throw Error(g(284));(s===null||s.ref!==u)&&(a.flags|=2097664)}}function x_(s,a,u,E,T){return Il(a),u=Sf(s,a,u,E,void 0,T),E=Ud(),s!==null&&!er?(vl(s,a,T),xo(s,a,T)):(In&&E&&m_(a),a.flags|=1,ai(s,a,u,T),a.child)}function U_(s,a,u,E,T,C){return Il(a),a.updateQueue=null,u=R_(a,E,u,T),Tf(s),E=Ud(),s!==null&&!er?(vl(s,a,C),xo(s,a,C)):(In&&E&&m_(a),a.flags|=1,ai(s,a,u,C),a.child)}function Vv(s,a,u,E,T){if(Il(a),a.stateNode===null){var C=ma,B=u.contextType;typeof B=="object"&&B!==null&&(C=yr(B)),C=new u(E,C),a.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=jd,a.stateNode=C,C._reactInternals=a,C=a.stateNode,C.props=E,C.state=a.memoizedState,C.refs={},vh(a),B=u.contextType,C.context=typeof B=="object"&&B!==null?yr(B):ma,C.state=a.memoizedState,B=u.getDerivedStateFromProps,typeof B=="function"&&(_h(a,u,B,E),C.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(B=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),B!==C.state&&jd.enqueueReplaceState(C,C.state,null),Hd(a,E,C,T),Gd(),C.state=a.memoizedState),typeof C.componentDidMount=="function"&&(a.flags|=4194308),E=!0}else if(s===null){C=a.stateNode;var K=a.memoizedProps,nt=bl(u,K);C.props=nt;var ut=C.context,kt=u.contextType;B=ma,typeof kt=="object"&&kt!==null&&(B=yr(kt));var Xt=u.getDerivedStateFromProps;kt=typeof Xt=="function"||typeof C.getSnapshotBeforeUpdate=="function",K=a.pendingProps!==K,kt||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(K||ut!==B)&&gh(a,C,E,B),Rc=!1;var vt=a.memoizedState;C.state=vt,Hd(a,E,C,T),Gd(),ut=a.memoizedState,K||vt!==ut||Rc?(typeof Xt=="function"&&(_h(a,u,Xt,E),ut=a.memoizedState),(nt=Rc||Fd(a,u,nt,E,vt,ut,B))?(kt||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(a.flags|=4194308)):(typeof C.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=E,a.memoizedState=ut),C.props=E,C.state=ut,C.context=B,E=nt):(typeof C.componentDidMount=="function"&&(a.flags|=4194308),E=!1)}else{C=a.stateNode,q_(s,a),B=a.memoizedProps,kt=bl(u,B),C.props=kt,Xt=a.pendingProps,vt=C.context,ut=u.contextType,nt=ma,typeof ut=="object"&&ut!==null&&(nt=yr(ut)),K=u.getDerivedStateFromProps,(ut=typeof K=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(B!==Xt||vt!==nt)&&gh(a,C,E,nt),Rc=!1,vt=a.memoizedState,C.state=vt,Hd(a,E,C,T),Gd();var Pt=a.memoizedState;B!==Xt||vt!==Pt||Rc||s!==null&&s.dependencies!==null&&xf(s.dependencies)?(typeof K=="function"&&(_h(a,u,K,E),Pt=a.memoizedState),(kt=Rc||Fd(a,u,kt,E,vt,Pt,nt)||s!==null&&s.dependencies!==null&&xf(s.dependencies))?(ut||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(E,Pt,nt),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(E,Pt,nt)),typeof C.componentDidUpdate=="function"&&(a.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof C.componentDidUpdate!="function"||B===s.memoizedProps&&vt===s.memoizedState||(a.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||B===s.memoizedProps&&vt===s.memoizedState||(a.flags|=1024),a.memoizedProps=E,a.memoizedState=Pt),C.props=E,C.state=Pt,C.context=nt,E=kt):(typeof C.componentDidUpdate!="function"||B===s.memoizedProps&&vt===s.memoizedState||(a.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||B===s.memoizedProps&&vt===s.memoizedState||(a.flags|=1024),E=!1)}return C=E,Al(s,a),E=(a.flags&128)!==0,C||E?(C=a.stateNode,u=E&&typeof u.getDerivedStateFromError!="function"?null:C.render(),a.flags|=1,s!==null&&E?(a.child=Sl(a,s.child,null,T),a.child=Sl(a,null,u,T)):ai(s,a,u,T),a.memoizedState=C.state,s=a.child):s=xo(s,a,T),s}function V_(s,a,u,E){return mc(),a.flags|=256,ai(s,a,u,E),a.child}var Lf={dehydrated:null,treeContext:null,retryLane:0};function B_(s){return{baseLanes:s,cachePool:nv()}}function Mo(s,a,u){return s=s!==null?s.childLanes&~u:0,a&&(s|=Ur),s}function Bv(s,a,u){var E=a.pendingProps,T=!1,C=(a.flags&128)!==0,B;if((B=C)||(B=s!==null&&s.memoizedState===null?!1:(Xi.current&2)!==0),B&&(T=!0,a.flags&=-129),B=(a.flags&32)!==0,a.flags&=-33,s===null){if(In){if(T?Ec(a):_a(),In){var K=ur,nt;if(nt=K){t:{for(nt=K,K=Ls;nt.nodeType!==8;){if(!K){K=null;break t}if(nt=lo(nt.nextSibling),nt===null){K=null;break t}}K=nt}K!==null?(a.memoizedState={dehydrated:K,treeContext:pc!==null?{id:qi,overflow:Ea}:null,retryLane:536870912},nt=Us(18,null,null,0),nt.stateNode=K,nt.return=a,a.child=nt,vr=a,ur=null,nt=!0):nt=!1}nt||fc(a)}if(K=a.memoizedState,K!==null&&(K=K.dehydrated,K!==null))return K.data==="$!"?a.lanes=16:a.lanes=536870912,null;ao(a)}return K=E.children,E=E.fallback,T?(_a(),T=a.mode,K=F_({mode:"hidden",children:K},T),E=vs(E,T,u,null),K.return=a,E.return=a,K.sibling=E,a.child=K,T=a.child,T.memoizedState=B_(u),T.childLanes=Mo(s,B,u),a.memoizedState=Lf,E):(Ec(a),j_(a,K))}if(nt=s.memoizedState,nt!==null&&(K=nt.dehydrated,K!==null)){if(C)a.flags&256?(Ec(a),a.flags&=-257,a=G_(s,a,u)):a.memoizedState!==null?(_a(),a.child=s.child,a.flags|=128,a=null):(_a(),T=E.fallback,K=a.mode,E=F_({mode:"visible",children:E.children},K),T=vs(T,K,u,null),T.flags|=2,E.return=a,T.return=a,E.sibling=T,a.child=E,Sl(a,s.child,null,u),E=a.child,E.memoizedState=B_(u),E.childLanes=Mo(s,B,u),a.memoizedState=Lf,a=T);else if(Ec(a),K.data==="$!"){if(B=K.nextSibling&&K.nextSibling.dataset,B)var ut=B.dgst;B=ut,E=Error(g(419)),E.stack="",E.digest=B,Qu({value:E,source:null,stack:null}),a=G_(s,a,u)}else if(er||Es(s,a,u,!1),B=(u&s.childLanes)!==0,er||B){if(B=zn,B!==null){if(E=u&-u,E&42)E=1;else switch(E){case 2:E=1;break;case 8:E=4;break;case 32:E=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:E=64;break;case 268435456:E=134217728;break;default:E=0}if(E=E&(B.suspendedLanes|u)?0:E,E!==0&&E!==nt.retryLane)throw nt.retryLane=E,Ds(s,E),Vr(B,s,E),Pf}K.data==="$?"||Zf(),a=G_(s,a,u)}else K.data==="$?"?(a.flags|=128,a.child=s.child,a=UA.bind(null,s),K._reactRetry=a,a=null):(s=nt.treeContext,ur=lo(K.nextSibling),vr=a,In=!0,oo=null,Ls=!1,s!==null&&($r[Ps++]=qi,$r[Ps++]=Ea,$r[Ps++]=pc,qi=s.id,Ea=s.overflow,pc=a),a=j_(a,E.children),a.flags|=4096);return a}return T?(_a(),T=E.fallback,K=a.mode,nt=s.child,ut=nt.sibling,E=Bo(nt,{mode:"hidden",children:E.children}),E.subtreeFlags=nt.subtreeFlags&31457280,ut!==null?T=Bo(ut,T):(T=vs(T,K,u,null),T.flags|=2),T.return=a,E.return=a,E.sibling=T,a.child=E,E=T,T=a.child,K=s.child.memoizedState,K===null?K=B_(u):(nt=K.cachePool,nt!==null?(ut=Ji._currentValue,nt=nt.parent!==ut?{parent:ut,pool:ut}:nt):nt=nv(),K={baseLanes:K.baseLanes|u,cachePool:nt}),T.memoizedState=K,T.childLanes=Mo(s,B,u),a.memoizedState=Lf,E):(Ec(a),u=s.child,s=u.sibling,u=Bo(u,{mode:"visible",children:E.children}),u.return=a,u.sibling=null,s!==null&&(B=a.deletions,B===null?(a.deletions=[s],a.flags|=16):B.push(s)),a.child=u,a.memoizedState=null,u)}function j_(s,a){return a=F_({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function F_(s,a){return sg(s,a,0,null)}function G_(s,a,u){return Sl(a,s.child,null,u),s=j_(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function H_(s,a,u){s.lanes|=a;var E=s.alternate;E!==null&&(E.lanes|=a),Y_(s.return,a,u)}function W_(s,a,u,E,T){var C=s.memoizedState;C===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:E,tail:u,tailMode:T}:(C.isBackwards=a,C.rendering=null,C.renderingStartTime=0,C.last=E,C.tail=u,C.tailMode=T)}function kf(s,a,u){var E=a.pendingProps,T=E.revealOrder,C=E.tail;if(ai(s,a,E.children,u),E=Xi.current,E&2)E=E&1|2,a.flags|=128;else{if(s!==null&&s.flags&128)t:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&H_(s,u,a);else if(s.tag===19)H_(s,u,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break t;for(;s.sibling===null;){if(s.return===null||s.return===a)break t;s=s.return}s.sibling.return=s.return,s=s.sibling}E&=1}switch(Se(Xi,E),T){case"forwards":for(u=a.child,T=null;u!==null;)s=u.alternate,s!==null&&mf(s)===null&&(T=u),u=u.sibling;u=T,u===null?(T=a.child,a.child=null):(T=u.sibling,u.sibling=null),W_(a,!1,T,u,C);break;case"backwards":for(u=null,T=a.child,a.child=null;T!==null;){if(s=T.alternate,s!==null&&mf(s)===null){a.child=T;break}s=T.sibling,T.sibling=u,u=T,T=s}W_(a,!0,u,null,C);break;case"together":W_(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function xo(s,a,u){if(s!==null&&(a.dependencies=s.dependencies),Fo|=a.lanes,!(u&a.childLanes))if(s!==null){if(Es(s,a,u,!1),(u&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(g(153));if(a.child!==null){for(s=a.child,u=Bo(s,s.pendingProps),a.child=u,u.return=a;s.sibling!==null;)s=s.sibling,u=u.sibling=Bo(s,s.pendingProps),u.return=a;u.sibling=null}return a.child}function K_(s,a){return s.lanes&a?!0:(s=s.dependencies,!!(s!==null&&xf(s)))}function jv(s,a,u){switch(a.tag){case 3:ws(a,a.stateNode.containerInfo),yc(a,Ji,s.memoizedState.cache),mc();break;case 27:case 5:to(a);break;case 4:ws(a,a.stateNode.containerInfo);break;case 10:yc(a,a.type,a.memoizedProps.value);break;case 13:var E=a.memoizedState;if(E!==null)return E.dehydrated!==null?(Ec(a),a.flags|=128,null):u&a.child.childLanes?Bv(s,a,u):(Ec(a),s=xo(s,a,u),s!==null?s.sibling:null);Ec(a);break;case 19:var T=(s.flags&128)!==0;if(E=(u&a.childLanes)!==0,E||(Es(s,a,u,!1),E=(u&a.childLanes)!==0),T){if(E)return kf(s,a,u);a.flags|=128}if(T=a.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),Se(Xi,Xi.current),E)break;return null;case 22:case 23:return a.lanes=0,M_(s,a,u);case 24:yc(a,Ji,s.memoizedState.cache)}return xo(s,a,u)}function Fv(s,a,u){if(s!==null)if(s.memoizedProps!==a.pendingProps)er=!0;else{if(!K_(s,u)&&!(a.flags&128))return er=!1,jv(s,a,u);er=!!(s.flags&131072)}else er=!1,In&&a.flags&1048576&&qT(a,lf,a.index);switch(a.lanes=0,a.tag){case 16:t:{s=a.pendingProps;var E=a.elementType,T=E._init;if(E=T(E._payload),a.type=E,typeof E=="function")rg(E)?(s=bl(E,s),a.tag=1,a=Vv(null,a,E,s,u)):(a.tag=0,a=x_(null,a,E,s,u));else{if(E!=null){if(T=E.$$typeof,T===J){a.tag=11,a=Cl(null,a,E,s,u);break t}else if(T===dt){a.tag=14,a=Tc(null,a,E,s,u);break t}}throw a=se(E)||E,Error(g(306,a,""))}}return a;case 0:return x_(s,a,a.type,a.pendingProps,u);case 1:return E=a.type,T=bl(E,a.pendingProps),Vv(s,a,E,T,u);case 3:t:{if(ws(a,a.stateNode.containerInfo),s===null)throw Error(g(387));var C=a.pendingProps;T=a.memoizedState,E=T.element,q_(s,a),Hd(a,C,null,u);var B=a.memoizedState;if(C=B.cache,yc(a,Ji,C),C!==T.cache&&Mf(a,[Ji],u,!0),Gd(),C=B.element,T.isDehydrated)if(T={element:C,isDehydrated:!1,cache:B.cache},a.updateQueue.baseState=T,a.memoizedState=T,a.flags&256){a=V_(s,a,C,u);break t}else if(C!==E){E=Mr(Error(g(424)),a),Qu(E),a=V_(s,a,C,u);break t}else for(ur=lo(a.stateNode.containerInfo.firstChild),vr=a,In=!0,oo=null,Ls=!0,u=tv(a,null,C,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(mc(),C===E){a=xo(s,a,u);break t}ai(s,a,C,u)}a=a.child}return a;case 26:return Al(s,a),s===null?(u=Oy(a.type,null,a.pendingProps,null))?a.memoizedState=u:In||(u=a.type,s=a.pendingProps,E=Qd(Pn.current).createElement(u),E[dr]=a,E[Jr]=s,ir(E,u,s),$n(E),a.stateNode=E):a.memoizedState=Oy(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return to(a),s===null&&In&&(E=a.stateNode=Ay(a.type,a.pendingProps,Pn.current),vr=a,Ls=!0,ur=lo(E.firstChild)),E=a.pendingProps.children,s!==null||In?ai(s,a,E,u):a.child=Sl(a,null,E,u),Al(s,a),a.child;case 5:return s===null&&In&&((T=E=ur)&&(E=WA(E,a.type,a.pendingProps,Ls),E!==null?(a.stateNode=E,vr=a,ur=lo(E.firstChild),Ls=!1,T=!0):T=!1),T||fc(a)),to(a),T=a.type,C=a.pendingProps,B=s!==null?s.memoizedProps:null,E=C.children,Rg(T,C)?E=null:B!==null&&Rg(T,B)&&(a.flags|=32),a.memoizedState!==null&&(T=Sf(s,a,iv,null,null,u),jh._currentValue=T),Al(s,a),ai(s,a,E,u),a.child;case 6:return s===null&&In&&((s=u=ur)&&(u=KA(u,a.pendingProps,Ls),u!==null?(a.stateNode=u,vr=a,ur=null,s=!0):s=!1),s||fc(a)),null;case 13:return Bv(s,a,u);case 4:return ws(a,a.stateNode.containerInfo),E=a.pendingProps,s===null?a.child=Sl(a,null,E,u):ai(s,a,E,u),a.child;case 11:return Cl(s,a,a.type,a.pendingProps,u);case 7:return ai(s,a,a.pendingProps,u),a.child;case 8:return ai(s,a,a.pendingProps.children,u),a.child;case 12:return ai(s,a,a.pendingProps.children,u),a.child;case 10:return E=a.pendingProps,yc(a,a.type,E.value),ai(s,a,E.children,u),a.child;case 9:return T=a.type._context,E=a.pendingProps.children,Il(a),T=yr(T),E=E(T),a.flags|=1,ai(s,a,E,u),a.child;case 14:return Tc(s,a,a.type,a.pendingProps,u);case 15:return k_(s,a,a.type,a.pendingProps,u);case 19:return kf(s,a,u);case 22:return M_(s,a,u);case 24:return Il(a),E=yr(Ji),s===null?(T=y_(),T===null&&(T=zn,C=v_(),T.pooledCache=C,C.refCount++,C!==null&&(T.pooledCacheLanes|=u),T=C),a.memoizedState={parent:E,cache:T},vh(a),yc(a,Ji,T)):(s.lanes&u&&(q_(s,a),Hd(a,null,null,u),Gd()),T=s.memoizedState,C=a.memoizedState,T.parent!==E?(T={parent:E,cache:E},a.memoizedState=T,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=T),yc(a,Ji,E)):(E=C.cache,yc(a,Ji,E),E!==T.cache&&Mf(a,[Ji],u,!0))),ai(s,a,a.pendingProps.children,u),a.child;case 29:throw a.pendingProps}throw Error(g(156,a.tag))}var z_=_e(null),wl=null,Sa=null;function yc(s,a,u){Se(z_,a._currentValue),a._currentValue=u}function Ta(s){s._currentValue=z_.current,Le(z_)}function Y_(s,a,u){for(;s!==null;){var E=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,E!==null&&(E.childLanes|=a)):E!==null&&(E.childLanes&a)!==a&&(E.childLanes|=a),s===u)break;s=s.return}}function Mf(s,a,u,E){var T=s.child;for(T!==null&&(T.return=s);T!==null;){var C=T.dependencies;if(C!==null){var B=T.child;C=C.firstContext;t:for(;C!==null;){var K=C;C=T;for(var nt=0;nt<a.length;nt++)if(K.context===a[nt]){C.lanes|=u,K=C.alternate,K!==null&&(K.lanes|=u),Y_(C.return,u,s),E||(B=null);break t}C=K.next}}else if(T.tag===18){if(B=T.return,B===null)throw Error(g(341));B.lanes|=u,C=B.alternate,C!==null&&(C.lanes|=u),Y_(B,u,s),B=null}else B=T.child;if(B!==null)B.return=T;else for(B=T;B!==null;){if(B===s){B=null;break}if(T=B.sibling,T!==null){T.return=B.return,B=T;break}B=B.return}T=B}}function Es(s,a,u,E){s=null;for(var T=a,C=!1;T!==null;){if(!C){if(T.flags&524288)C=!0;else if(T.flags&262144)break}if(T.tag===10){var B=T.alternate;if(B===null)throw Error(g(387));if(B=B.memoizedProps,B!==null){var K=T.type;fs(T.pendingProps.value,B.value)||(s!==null?s.push(K):s=[K])}}else if(T===cr.current){if(B=T.alternate,B===null)throw Error(g(387));B.memoizedState.memoizedState!==T.memoizedState.memoizedState&&(s!==null?s.push(jh):s=[jh])}T=T.return}s!==null&&Mf(a,s,u,E),a.flags|=262144}function xf(s){for(s=s.firstContext;s!==null;){if(!fs(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Il(s){wl=s,Sa=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function yr(s){return Gv(wl,s)}function Uf(s,a){return wl===null&&Il(s),Gv(s,a)}function Gv(s,a){var u=a._currentValue;if(a={context:a,memoizedValue:u,next:null},Sa===null){if(s===null)throw Error(g(308));Sa=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else Sa=Sa.next=a;return u}var Rc=!1;function vh(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function q_(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function bc(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Cc(s,a,u){var E=s.updateQueue;if(E===null)return null;if(E=E.shared,fi&2){var T=E.pending;return T===null?a.next=a:(a.next=T.next,T.next=a),E.pending=a,a=of(s),YT(s,null,u),a}return sf(s,E,a,u),of(s)}function yh(s,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194176)!==0)){var E=a.lanes;E&=s.pendingLanes,u|=E,a.lanes=u,Xr(s,u)}}function X_(s,a){var u=s.updateQueue,E=s.alternate;if(E!==null&&(E=E.updateQueue,u===E)){var T=null,C=null;if(u=u.firstBaseUpdate,u!==null){do{var B={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};C===null?T=C=B:C=C.next=B,u=u.next}while(u!==null);C===null?T=C=a:C=C.next=a}else T=C=a;u={baseState:E.baseState,firstBaseUpdate:T,lastBaseUpdate:C,shared:E.shared,callbacks:E.callbacks},s.updateQueue=u;return}s=u.lastBaseUpdate,s===null?u.firstBaseUpdate=a:s.next=a,u.lastBaseUpdate=a}var J_=!1;function Gd(){if(J_){var s=kd;if(s!==null)throw s}}function Hd(s,a,u,E){J_=!1;var T=s.updateQueue;Rc=!1;var C=T.firstBaseUpdate,B=T.lastBaseUpdate,K=T.shared.pending;if(K!==null){T.shared.pending=null;var nt=K,ut=nt.next;nt.next=null,B===null?C=ut:B.next=ut,B=nt;var kt=s.alternate;kt!==null&&(kt=kt.updateQueue,K=kt.lastBaseUpdate,K!==B&&(K===null?kt.firstBaseUpdate=ut:K.next=ut,kt.lastBaseUpdate=nt))}if(C!==null){var Xt=T.baseState;B=0,kt=ut=nt=null,K=C;do{var vt=K.lane&-536870913,Pt=vt!==K.lane;if(Pt?(gn&vt)===vt:(E&vt)===vt){vt!==0&&vt===Ld&&(J_=!0),kt!==null&&(kt=kt.next={lane:0,tag:K.tag,payload:K.payload,callback:null,next:null});t:{var Te=s,He=K;vt=a;var Ni=u;switch(He.tag){case 1:if(Te=He.payload,typeof Te=="function"){Xt=Te.call(Ni,Xt,vt);break t}Xt=Te;break t;case 3:Te.flags=Te.flags&-65537|128;case 0:if(Te=He.payload,vt=typeof Te=="function"?Te.call(Ni,Xt,vt):Te,vt==null)break t;Xt=ae({},Xt,vt);break t;case 2:Rc=!0}}vt=K.callback,vt!==null&&(s.flags|=64,Pt&&(s.flags|=8192),Pt=T.callbacks,Pt===null?T.callbacks=[vt]:Pt.push(vt))}else Pt={lane:vt,tag:K.tag,payload:K.payload,callback:K.callback,next:null},kt===null?(ut=kt=Pt,nt=Xt):kt=kt.next=Pt,B|=vt;if(K=K.next,K===null){if(K=T.shared.pending,K===null)break;Pt=K,K=Pt.next,Pt.next=null,T.lastBaseUpdate=Pt,T.shared.pending=null}}while(!0);kt===null&&(nt=Xt),T.baseState=nt,T.firstBaseUpdate=ut,T.lastBaseUpdate=kt,C===null&&(T.shared.lanes=0),Fo|=B,s.lanes=B,s.memoizedState=Xt}}function Hv(s,a){if(typeof s!="function")throw Error(g(191,s));s.call(a)}function Wv(s,a){var u=s.callbacks;if(u!==null)for(s.callbacks=null,s=0;s<u.length;s++)Hv(u[s],a)}function Ac(s,a){try{var u=a.updateQueue,E=u!==null?u.lastEffect:null;if(E!==null){var T=E.next;u=T;do{if((u.tag&s)===s){E=void 0;var C=u.create,B=u.inst;E=C(),B.destroy=E}u=u.next}while(u!==T)}}catch(K){Ln(a,a.return,K)}}function Uo(s,a,u){try{var E=a.updateQueue,T=E!==null?E.lastEffect:null;if(T!==null){var C=T.next;E=C;do{if((E.tag&s)===s){var B=E.inst,K=B.destroy;if(K!==void 0){B.destroy=void 0,T=a;var nt=u;try{K()}catch(ut){Ln(T,nt,ut)}}}E=E.next}while(E!==C)}}catch(ut){Ln(a,a.return,ut)}}function Q_(s){var a=s.updateQueue;if(a!==null){var u=s.stateNode;try{Wv(a,u)}catch(E){Ln(s,s.return,E)}}}function Rh(s,a,u){u.props=bl(s.type,s.memoizedProps),u.state=s.memoizedState;try{u.componentWillUnmount()}catch(E){Ln(s,a,E)}}function wc(s,a){try{var u=s.ref;if(u!==null){var E=s.stateNode;switch(s.tag){case 26:case 27:case 5:var T=E;break;default:T=E}typeof u=="function"?s.refCleanup=u(T):u.current=T}}catch(C){Ln(s,a,C)}}function _s(s,a){var u=s.ref,E=s.refCleanup;if(u!==null)if(typeof E=="function")try{E()}catch(T){Ln(s,a,T)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(T){Ln(s,a,T)}else u.current=null}function Z_(s){var a=s.type,u=s.memoizedProps,E=s.stateNode;try{t:switch(a){case"button":case"input":case"select":case"textarea":u.autoFocus&&E.focus();break t;case"img":u.src?E.src=u.src:u.srcSet&&(E.srcset=u.srcSet)}}catch(T){Ln(s,s.return,T)}}function bh(s,a,u){try{var E=s.stateNode;jA(E,s.type,u,a),E[Jr]=a}catch(T){Ln(s,s.return,T)}}function Kv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27||s.tag===4}function Vf(s){t:for(;;){for(;s.sibling===null;){if(s.return===null||Kv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==27&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue t;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Bf(s,a,u){var E=s.tag;if(E===5||E===6)s=s.stateNode,a?u.nodeType===8?u.parentNode.insertBefore(s,a):u.insertBefore(s,a):(u.nodeType===8?(a=u.parentNode,a.insertBefore(s,u)):(a=u,a.appendChild(s)),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=Uh));else if(E!==4&&E!==27&&(s=s.child,s!==null))for(Bf(s,a,u),s=s.sibling;s!==null;)Bf(s,a,u),s=s.sibling}function jf(s,a,u){var E=s.tag;if(E===5||E===6)s=s.stateNode,a?u.insertBefore(s,a):u.appendChild(s);else if(E!==4&&E!==27&&(s=s.child,s!==null))for(jf(s,a,u),s=s.sibling;s!==null;)jf(s,a,u),s=s.sibling}var xs=!1,yi=!1,$_=!1,zv=typeof WeakSet=="function"?WeakSet:Set,nr=null,Ch=!1;function DA(s,a){if(s=s.containerInfo,xc=Fh,s=BT(s),io(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else t:{u=(u=s.ownerDocument)&&u.defaultView||window;var E=u.getSelection&&u.getSelection();if(E&&E.rangeCount!==0){u=E.anchorNode;var T=E.anchorOffset,C=E.focusNode;E=E.focusOffset;try{u.nodeType,C.nodeType}catch{u=null;break t}var B=0,K=-1,nt=-1,ut=0,kt=0,Xt=s,vt=null;e:for(;;){for(var Pt;Xt!==u||T!==0&&Xt.nodeType!==3||(K=B+T),Xt!==C||E!==0&&Xt.nodeType!==3||(nt=B+E),Xt.nodeType===3&&(B+=Xt.nodeValue.length),(Pt=Xt.firstChild)!==null;)vt=Xt,Xt=Pt;for(;;){if(Xt===s)break e;if(vt===u&&++ut===T&&(K=B),vt===C&&++kt===E&&(nt=B),(Pt=Xt.nextSibling)!==null)break;Xt=vt,vt=Xt.parentNode}Xt=Pt}u=K===-1||nt===-1?null:{start:K,end:nt}}else u=null}u=u||{start:0,end:0}}else u=null;for(Uc={focusedElem:s,selectionRange:u},Fh=!1,nr=a;nr!==null;)if(a=nr,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,nr=s;else for(;nr!==null;){switch(a=nr,C=a.alternate,s=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if(s&1024&&C!==null){s=void 0,u=a,T=C.memoizedProps,C=C.memoizedState,E=u.stateNode;try{var Te=bl(u.type,T,u.elementType===u.type);s=E.getSnapshotBeforeUpdate(Te,C),E.__reactInternalSnapshotBeforeUpdate=s}catch(He){Ln(u,u.return,He)}}break;case 3:if(s&1024){if(s=a.stateNode.containerInfo,u=s.nodeType,u===9)Cg(s);else if(u===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Cg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(s&1024)throw Error(g(163))}if(s=a.sibling,s!==null){s.return=a.return,nr=s;break}nr=a.return}return Te=Ch,Ch=!1,Te}function Yv(s,a,u){var E=u.flags;switch(u.tag){case 0:case 11:case 15:ya(s,u),E&4&&Ac(5,u);break;case 1:if(ya(s,u),E&4)if(s=u.stateNode,a===null)try{s.componentDidMount()}catch(K){Ln(u,u.return,K)}else{var T=bl(u.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(T,a,s.__reactInternalSnapshotBeforeUpdate)}catch(K){Ln(u,u.return,K)}}E&64&&Q_(u),E&512&&wc(u,u.return);break;case 3:if(ya(s,u),E&64&&(E=u.updateQueue,E!==null)){if(s=null,u.child!==null)switch(u.child.tag){case 27:case 5:s=u.child.stateNode;break;case 1:s=u.child.stateNode}try{Wv(E,s)}catch(K){Ln(u,u.return,K)}}break;case 26:ya(s,u),E&512&&wc(u,u.return);break;case 27:case 5:ya(s,u),a===null&&E&4&&Z_(u),E&512&&wc(u,u.return);break;case 12:ya(s,u);break;case 13:ya(s,u),E&4&&Xv(s,u);break;case 22:if(T=u.memoizedState!==null||xs,!T){a=a!==null&&a.memoizedState!==null||yi;var C=xs,B=yi;xs=T,(yi=a)&&!B?Ra(s,u,(u.subtreeFlags&8772)!==0):ya(s,u),xs=C,yi=B}E&512&&(u.memoizedProps.mode==="manual"?wc(u,u.return):_s(u,u.return));break;default:ya(s,u)}}function qv(s){var a=s.alternate;a!==null&&(s.alternate=null,qv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&ju(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Mi=null,gs=!1;function va(s,a,u){for(u=u.child;u!==null;)Ff(s,a,u),u=u.sibling}function Ff(s,a,u){if(oi&&typeof oi.onCommitFiberUnmount=="function")try{oi.onCommitFiberUnmount(Oo,u)}catch{}switch(u.tag){case 26:yi||_s(u,a),va(s,a,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:yi||_s(u,a);var E=Mi,T=gs;for(Mi=u.stateNode,va(s,a,u),u=u.stateNode,a=u.attributes;a.length;)u.removeAttributeNode(a[0]);ju(u),Mi=E,gs=T;break;case 5:yi||_s(u,a);case 6:T=Mi;var C=gs;if(Mi=null,va(s,a,u),Mi=T,gs=C,Mi!==null)if(gs)try{s=Mi,E=u.stateNode,s.nodeType===8?s.parentNode.removeChild(E):s.removeChild(E)}catch(B){Ln(u,a,B)}else try{Mi.removeChild(u.stateNode)}catch(B){Ln(u,a,B)}break;case 18:Mi!==null&&(gs?(a=Mi,u=u.stateNode,a.nodeType===8?bg(a.parentNode,u):a.nodeType===1&&bg(a,u),Kh(a)):bg(Mi,u.stateNode));break;case 4:E=Mi,T=gs,Mi=u.stateNode.containerInfo,gs=!0,va(s,a,u),Mi=E,gs=T;break;case 0:case 11:case 14:case 15:yi||Uo(2,u,a),yi||Uo(4,u,a),va(s,a,u);break;case 1:yi||(_s(u,a),E=u.stateNode,typeof E.componentWillUnmount=="function"&&Rh(u,a,E)),va(s,a,u);break;case 21:va(s,a,u);break;case 22:yi||_s(u,a),yi=(E=yi)||u.memoizedState!==null,va(s,a,u),yi=E;break;default:va(s,a,u)}}function Xv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Kh(s)}catch(u){Ln(a,a.return,u)}}function tg(s){switch(s.tag){case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new zv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new zv),a;default:throw Error(g(435,s.tag))}}function eg(s,a){var u=tg(s);a.forEach(function(E){var T=fg.bind(null,s,E);u.has(E)||(u.add(E),E.then(T,T))})}function Ss(s,a){var u=a.deletions;if(u!==null)for(var E=0;E<u.length;E++){var T=u[E],C=s,B=a,K=B;t:for(;K!==null;){switch(K.tag){case 27:case 5:Mi=K.stateNode,gs=!1;break t;case 3:Mi=K.stateNode.containerInfo,gs=!0;break t;case 4:Mi=K.stateNode.containerInfo,gs=!0;break t}K=K.return}if(Mi===null)throw Error(g(160));Ff(C,B,T),Mi=null,gs=!1,C=T.alternate,C!==null&&(C.return=null),T.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)Jv(a,s),a=a.sibling}var co=null;function Jv(s,a){var u=s.alternate,E=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Ss(a,s),Ts(s),E&4&&(Uo(3,s,s.return),Ac(3,s),Uo(5,s,s.return));break;case 1:Ss(a,s),Ts(s),E&512&&(yi||u===null||_s(u,u.return)),E&64&&xs&&(s=s.updateQueue,s!==null&&(E=s.callbacks,E!==null&&(u=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=u===null?E:u.concat(E))));break;case 26:var T=co;if(Ss(a,s),Ts(s),E&512&&(yi||u===null||_s(u,u.return)),E&4){var C=u!==null?u.memoizedState:null;if(E=s.memoizedState,u===null)if(E===null)if(s.stateNode===null){t:{E=s.type,u=s.memoizedProps,T=T.ownerDocument||T;e:switch(E){case"title":C=T.getElementsByTagName("title")[0],(!C||C[pd]||C[dr]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=T.createElement(E),T.head.insertBefore(C,T.querySelector("head > title"))),ir(C,E,u),C[dr]=s,$n(C),E=C;break t;case"link":var B=Py("link","href",T).get(E+(u.href||""));if(B){for(var K=0;K<B.length;K++)if(C=B[K],C.getAttribute("href")===(u.href==null?null:u.href)&&C.getAttribute("rel")===(u.rel==null?null:u.rel)&&C.getAttribute("title")===(u.title==null?null:u.title)&&C.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){B.splice(K,1);break e}}C=T.createElement(E),ir(C,E,u),T.head.appendChild(C);break;case"meta":if(B=Py("meta","content",T).get(E+(u.content||""))){for(K=0;K<B.length;K++)if(C=B[K],C.getAttribute("content")===(u.content==null?null:""+u.content)&&C.getAttribute("name")===(u.name==null?null:u.name)&&C.getAttribute("property")===(u.property==null?null:u.property)&&C.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&C.getAttribute("charset")===(u.charSet==null?null:u.charSet)){B.splice(K,1);break e}}C=T.createElement(E),ir(C,E,u),T.head.appendChild(C);break;default:throw Error(g(468,E))}C[dr]=s,$n(C),E=C}s.stateNode=E}else Ly(T,s.type,s.stateNode);else s.stateNode=Dy(T,E,s.memoizedProps);else C!==E?(C===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):C.count--,E===null?Ly(T,s.type,s.stateNode):Dy(T,E,s.memoizedProps)):E===null&&s.stateNode!==null&&bh(s,s.memoizedProps,u.memoizedProps)}break;case 27:if(E&4&&s.alternate===null){T=s.stateNode,C=s.memoizedProps;try{for(var nt=T.firstChild;nt;){var ut=nt.nextSibling,kt=nt.nodeName;nt[pd]||kt==="HEAD"||kt==="BODY"||kt==="SCRIPT"||kt==="STYLE"||kt==="LINK"&&nt.rel.toLowerCase()==="stylesheet"||T.removeChild(nt),nt=ut}for(var Xt=s.type,vt=T.attributes;vt.length;)T.removeAttributeNode(vt[0]);ir(T,Xt,C),T[dr]=s,T[Jr]=C}catch(Te){Ln(s,s.return,Te)}}case 5:if(Ss(a,s),Ts(s),E&512&&(yi||u===null||_s(u,u.return)),s.flags&32){T=s.stateNode;try{cc(T,"")}catch(Te){Ln(s,s.return,Te)}}E&4&&s.stateNode!=null&&(T=s.memoizedProps,bh(s,T,u!==null?u.memoizedProps:T)),E&1024&&($_=!0);break;case 6:if(Ss(a,s),Ts(s),E&4){if(s.stateNode===null)throw Error(g(162));E=s.memoizedProps,u=s.stateNode;try{u.nodeValue=E}catch(Te){Ln(s,s.return,Te)}}break;case 3:if(um=null,T=co,co=cm(a.containerInfo),Ss(a,s),co=T,Ts(s),E&4&&u!==null&&u.memoizedState.isDehydrated)try{Kh(a.containerInfo)}catch(Te){Ln(s,s.return,Te)}$_&&($_=!1,Qv(s));break;case 4:E=co,co=cm(s.stateNode.containerInfo),Ss(a,s),Ts(s),co=E;break;case 12:Ss(a,s),Ts(s);break;case 13:Ss(a,s),Ts(s),s.child.flags&8192&&s.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(qf=Wn()),E&4&&(E=s.updateQueue,E!==null&&(s.updateQueue=null,eg(s,E)));break;case 22:if(E&512&&(yi||u===null||_s(u,u.return)),nt=s.memoizedState!==null,ut=u!==null&&u.memoizedState!==null,kt=xs,Xt=yi,xs=kt||nt,yi=Xt||ut,Ss(a,s),yi=Xt,xs=kt,Ts(s),a=s.stateNode,a._current=s,a._visibility&=-3,a._visibility|=a._pendingVisibility&2,E&8192&&(a._visibility=nt?a._visibility&-2:a._visibility|1,nt&&(a=xs||yi,u===null||ut||a||Ol(s)),s.memoizedProps===null||s.memoizedProps.mode!=="manual"))t:for(u=null,a=s;;){if(a.tag===5||a.tag===26||a.tag===27){if(u===null){ut=u=a;try{if(T=ut.stateNode,nt)C=T.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{B=ut.stateNode,K=ut.memoizedProps.style;var Pt=K!=null&&K.hasOwnProperty("display")?K.display:null;B.style.display=Pt==null||typeof Pt=="boolean"?"":(""+Pt).trim()}}catch(Te){Ln(ut,ut.return,Te)}}}else if(a.tag===6){if(u===null){ut=a;try{ut.stateNode.nodeValue=nt?"":ut.memoizedProps}catch(Te){Ln(ut,ut.return,Te)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break t;for(;a.sibling===null;){if(a.return===null||a.return===s)break t;u===a&&(u=null),a=a.return}u===a&&(u=null),a.sibling.return=a.return,a=a.sibling}E&4&&(E=s.updateQueue,E!==null&&(u=E.retryQueue,u!==null&&(E.retryQueue=null,eg(s,u))));break;case 19:Ss(a,s),Ts(s),E&4&&(E=s.updateQueue,E!==null&&(s.updateQueue=null,eg(s,E)));break;case 21:break;default:Ss(a,s),Ts(s)}}function Ts(s){var a=s.flags;if(a&2){try{if(s.tag!==27){t:{for(var u=s.return;u!==null;){if(Kv(u)){var E=u;break t}u=u.return}throw Error(g(160))}switch(E.tag){case 27:var T=E.stateNode,C=Vf(s);jf(s,C,T);break;case 5:var B=E.stateNode;E.flags&32&&(cc(B,""),E.flags&=-33);var K=Vf(s);jf(s,K,B);break;case 3:case 4:var nt=E.stateNode.containerInfo,ut=Vf(s);Bf(s,ut,nt);break;default:throw Error(g(161))}}}catch(kt){Ln(s,s.return,kt)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function Qv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;Qv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function ya(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Yv(s,a.alternate,a),a=a.sibling}function Ol(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:Uo(4,a,a.return),Ol(a);break;case 1:_s(a,a.return);var u=a.stateNode;typeof u.componentWillUnmount=="function"&&Rh(a,a.return,u),Ol(a);break;case 26:case 27:case 5:_s(a,a.return),Ol(a);break;case 22:_s(a,a.return),a.memoizedState===null&&Ol(a);break;default:Ol(a)}s=s.sibling}}function Ra(s,a,u){for(u=u&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var E=a.alternate,T=s,C=a,B=C.flags;switch(C.tag){case 0:case 11:case 15:Ra(T,C,u),Ac(4,C);break;case 1:if(Ra(T,C,u),E=C,T=E.stateNode,typeof T.componentDidMount=="function")try{T.componentDidMount()}catch(ut){Ln(E,E.return,ut)}if(E=C,T=E.updateQueue,T!==null){var K=E.stateNode;try{var nt=T.shared.hiddenCallbacks;if(nt!==null)for(T.shared.hiddenCallbacks=null,T=0;T<nt.length;T++)Hv(nt[T],K)}catch(ut){Ln(E,E.return,ut)}}u&&B&64&&Q_(C),wc(C,C.return);break;case 26:case 27:case 5:Ra(T,C,u),u&&E===null&&B&4&&Z_(C),wc(C,C.return);break;case 12:Ra(T,C,u);break;case 13:Ra(T,C,u),u&&B&4&&Xv(T,C);break;case 22:C.memoizedState===null&&Ra(T,C,u),wc(C,C.return);break;default:Ra(T,C,u)}a=a.sibling}}function Ah(s,a){var u=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==u&&(s!=null&&s.refCount++,u!=null&&oh(u))}function ng(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&oh(s))}function Ic(s,a,u,E){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Wd(s,a,u,E),a=a.sibling}function Wd(s,a,u,E){var T=a.flags;switch(a.tag){case 0:case 11:case 15:Ic(s,a,u,E),T&2048&&Ac(9,a);break;case 3:Ic(s,a,u,E),T&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&oh(s)));break;case 12:if(T&2048){Ic(s,a,u,E),s=a.stateNode;try{var C=a.memoizedProps,B=C.id,K=C.onPostCommit;typeof K=="function"&&K(B,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(nt){Ln(a,a.return,nt)}}else Ic(s,a,u,E);break;case 23:break;case 22:C=a.stateNode,a.memoizedState!==null?C._visibility&4?Ic(s,a,u,E):ba(s,a):C._visibility&4?Ic(s,a,u,E):(C._visibility|=4,Nl(s,a,u,E,(a.subtreeFlags&10256)!==0)),T&2048&&Ah(a.alternate,a);break;case 24:Ic(s,a,u,E),T&2048&&ng(a.alternate,a);break;default:Ic(s,a,u,E)}}function Nl(s,a,u,E,T){for(T=T&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var C=s,B=a,K=u,nt=E,ut=B.flags;switch(B.tag){case 0:case 11:case 15:Nl(C,B,K,nt,T),Ac(8,B);break;case 23:break;case 22:var kt=B.stateNode;B.memoizedState!==null?kt._visibility&4?Nl(C,B,K,nt,T):ba(C,B):(kt._visibility|=4,Nl(C,B,K,nt,T)),T&&ut&2048&&Ah(B.alternate,B);break;case 24:Nl(C,B,K,nt,T),T&&ut&2048&&ng(B.alternate,B);break;default:Nl(C,B,K,nt,T)}a=a.sibling}}function ba(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var u=s,E=a,T=E.flags;switch(E.tag){case 22:ba(u,E),T&2048&&Ah(E.alternate,E);break;case 24:ba(u,E),T&2048&&ng(E.alternate,E);break;default:ba(u,E)}a=a.sibling}}var Vo=8192;function Dl(s){if(s.subtreeFlags&Vo)for(s=s.child;s!==null;)Gf(s),s=s.sibling}function Gf(s){switch(s.tag){case 26:Dl(s),s.flags&Vo&&s.memoizedState!==null&&iw(co,s.memoizedState,s.memoizedProps);break;case 5:Dl(s);break;case 3:case 4:var a=co;co=cm(s.stateNode.containerInfo),Dl(s),co=a;break;case 22:s.memoizedState===null&&(a=s.alternate,a!==null&&a.memoizedState!==null?(a=Vo,Vo=16777216,Dl(s),Vo=a):Dl(s));break;default:Dl(s)}}function wh(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function Ih(s){var a=s.deletions;if(s.flags&16){if(a!==null)for(var u=0;u<a.length;u++){var E=a[u];nr=E,ig(E,s)}wh(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Zv(s),s=s.sibling}function Zv(s){switch(s.tag){case 0:case 11:case 15:Ih(s),s.flags&2048&&Uo(9,s,s.return);break;case 3:Ih(s);break;case 12:Ih(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&4&&(s.return===null||s.return.tag!==13)?(a._visibility&=-5,Hf(s)):Ih(s);break;default:Ih(s)}}function Hf(s){var a=s.deletions;if(s.flags&16){if(a!==null)for(var u=0;u<a.length;u++){var E=a[u];nr=E,ig(E,s)}wh(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:Uo(8,a,a.return),Hf(a);break;case 22:u=a.stateNode,u._visibility&4&&(u._visibility&=-5,Hf(a));break;default:Hf(a)}s=s.sibling}}function ig(s,a){for(;nr!==null;){var u=nr;switch(u.tag){case 0:case 11:case 15:Uo(8,u,a);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var E=u.memoizedState.cachePool.pool;E!=null&&E.refCount++}break;case 24:oh(u.memoizedState.cache)}if(E=u.child,E!==null)E.return=u,nr=E;else t:for(u=s;nr!==null;){E=nr;var T=E.sibling,C=E.return;if(qv(E),E===u){nr=null;break t}if(T!==null){T.return=C,nr=T;break t}nr=C}}}function PA(s,a,u,E){this.tag=s,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=E,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Us(s,a,u,E){return new PA(s,a,u,E)}function rg(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Bo(s,a){var u=s.alternate;return u===null?(u=Us(s.tag,a,s.key,s.mode),u.elementType=s.elementType,u.type=s.type,u.stateNode=s.stateNode,u.alternate=s,s.alternate=u):(u.pendingProps=a,u.type=s.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=s.flags&31457280,u.childLanes=s.childLanes,u.lanes=s.lanes,u.child=s.child,u.memoizedProps=s.memoizedProps,u.memoizedState=s.memoizedState,u.updateQueue=s.updateQueue,a=s.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=s.sibling,u.index=s.index,u.ref=s.ref,u.refCleanup=s.refCleanup,u}function Ca(s,a){s.flags&=31457282;var u=s.alternate;return u===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,a=u.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Wf(s,a,u,E,T,C){var B=0;if(E=s,typeof s=="function")rg(s)&&(B=1);else if(typeof s=="string")B=nw(s,u,ze.current)?26:s==="html"||s==="head"||s==="body"?27:5;else t:switch(s){case V:return vs(u.children,T,C,a);case x:B=8,T|=24;break;case G:return s=Us(12,u,a,T|2),s.elementType=G,s.lanes=C,s;case X:return s=Us(13,u,a,T),s.elementType=X,s.lanes=C,s;case tt:return s=Us(19,u,a,T),s.elementType=tt,s.lanes=C,s;case ot:return sg(u,T,C,a);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Y:case z:B=10;break t;case et:B=9;break t;case J:B=11;break t;case dt:B=14;break t;case pt:B=16,E=null;break t}B=29,u=Error(g(130,s===null?"null":typeof s,"")),E=null}return a=Us(B,u,a,T),a.elementType=s,a.type=E,a.lanes=C,a}function vs(s,a,u,E){return s=Us(7,s,E,a),s.lanes=u,s}function sg(s,a,u,E){s=Us(22,s,E,a),s.elementType=ot,s.lanes=u;var T={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var C=T._current;if(C===null)throw Error(g(456));if(!(T._pendingVisibility&2)){var B=Ds(C,2);B!==null&&(T._pendingVisibility|=2,Vr(B,C,2))}},attach:function(){var C=T._current;if(C===null)throw Error(g(456));if(T._pendingVisibility&2){var B=Ds(C,2);B!==null&&(T._pendingVisibility&=-3,Vr(B,C,2))}}};return s.stateNode=T,s}function xr(s,a,u){return s=Us(6,s,null,a),s.lanes=u,s}function og(s,a,u){return a=Us(4,s.children!==null?s.children:[],s.key,a),a.lanes=u,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}function Aa(s){s.flags|=4}function ag(s,a){if(a.type!=="stylesheet"||a.state.loading&4)s.flags&=-16777217;else if(s.flags|=16777216,!wg(a)){if(a=ks.current,a!==null&&((gn&4194176)===gn?Do!==null:(gn&62914560)!==gn&&!(gn&536870912)||a!==Do))throw th=S_,JT;s.flags|=8192}}function Kf(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?Yr():536870912,s.lanes|=a,Ll|=a)}function Kd(s,a){if(!In)switch(s.tailMode){case"hidden":a=s.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?s.tail=null:u.sibling=null;break;case"collapsed":u=s.tail;for(var E=null;u!==null;)u.alternate!==null&&(E=u),u=u.sibling;E===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:E.sibling=null}}function _i(s){var a=s.alternate!==null&&s.alternate.child===s.child,u=0,E=0;if(a)for(var T=s.child;T!==null;)u|=T.lanes|T.childLanes,E|=T.subtreeFlags&31457280,E|=T.flags&31457280,T.return=s,T=T.sibling;else for(T=s.child;T!==null;)u|=T.lanes|T.childLanes,E|=T.subtreeFlags,E|=T.flags,T.return=s,T=T.sibling;return s.subtreeFlags|=E,s.childLanes=u,a}function LA(s,a,u){var E=a.pendingProps;switch(E_(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _i(a),null;case 1:return _i(a),null;case 3:return u=a.stateNode,E=null,s!==null&&(E=s.memoizedState.cache),a.memoizedState.cache!==E&&(a.flags|=2048),Ta(Ji),Ii(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(s===null||s.child===null)&&(Od(a)?Aa(a):s===null||s.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,oo!==null&&(ug(oo),oo=null))),_i(a),null;case 26:return u=a.memoizedState,s===null?(Aa(a),u!==null?(_i(a),ag(a,u)):(_i(a),a.flags&=-16777217)):u?u!==s.memoizedState?(Aa(a),_i(a),ag(a,u)):(_i(a),a.flags&=-16777217):(s.memoizedProps!==E&&Aa(a),_i(a),a.flags&=-16777217),null;case 27:pi(a),u=Pn.current;var T=a.type;if(s!==null&&a.stateNode!=null)s.memoizedProps!==E&&Aa(a);else{if(!E){if(a.stateNode===null)throw Error(g(166));return _i(a),null}s=ze.current,Od(a)?g_(a):(s=Ay(T,E,u),a.stateNode=s,Aa(a))}return _i(a),null;case 5:if(pi(a),u=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==E&&Aa(a);else{if(!E){if(a.stateNode===null)throw Error(g(166));return _i(a),null}if(s=ze.current,Od(a))g_(a);else{switch(T=Qd(Pn.current),s){case 1:s=T.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:s=T.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":s=T.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":s=T.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":s=T.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof E.is=="string"?T.createElement("select",{is:E.is}):T.createElement("select"),E.multiple?s.multiple=!0:E.size&&(s.size=E.size);break;default:s=typeof E.is=="string"?T.createElement(u,{is:E.is}):T.createElement(u)}}s[dr]=a,s[Jr]=E;t:for(T=a.child;T!==null;){if(T.tag===5||T.tag===6)s.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===a)break t;for(;T.sibling===null;){if(T.return===null||T.return===a)break t;T=T.return}T.sibling.return=T.return,T=T.sibling}a.stateNode=s;t:switch(ir(s,u,E),u){case"button":case"input":case"select":case"textarea":s=!!E.autoFocus;break t;case"img":s=!0;break t;default:s=!1}s&&Aa(a)}}return _i(a),a.flags&=-16777217,null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==E&&Aa(a);else{if(typeof E!="string"&&a.stateNode===null)throw Error(g(166));if(s=Pn.current,Od(a)){if(s=a.stateNode,u=a.memoizedProps,E=null,T=vr,T!==null)switch(T.tag){case 27:case 5:E=T.memoizedProps}s[dr]=a,s=!!(s.nodeValue===u||E!==null&&E.suppressHydrationWarning===!0||Sg(s.nodeValue,u)),s||fc(a)}else s=Qd(s).createTextNode(E),s[dr]=a,a.stateNode=s}return _i(a),null;case 13:if(E=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(T=Od(a),E!==null&&E.dehydrated!==null){if(s===null){if(!T)throw Error(g(318));if(T=a.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(g(317));T[dr]=a}else mc(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;_i(a),T=!1}else oo!==null&&(ug(oo),oo=null),T=!0;if(!T)return a.flags&256?(ao(a),a):(ao(a),null)}if(ao(a),a.flags&128)return a.lanes=u,a;if(u=E!==null,s=s!==null&&s.memoizedState!==null,u){E=a.child,T=null,E.alternate!==null&&E.alternate.memoizedState!==null&&E.alternate.memoizedState.cachePool!==null&&(T=E.alternate.memoizedState.cachePool.pool);var C=null;E.memoizedState!==null&&E.memoizedState.cachePool!==null&&(C=E.memoizedState.cachePool.pool),C!==T&&(E.flags|=2048)}return u!==s&&u&&(a.child.flags|=8192),Kf(a,a.updateQueue),_i(a),null;case 4:return Ii(),s===null&&Ul(a.stateNode.containerInfo),_i(a),null;case 10:return Ta(a.type),_i(a),null;case 19:if(Le(Xi),T=a.memoizedState,T===null)return _i(a),null;if(E=(a.flags&128)!==0,C=T.rendering,C===null)if(E)Kd(T,!1);else{if(gi!==0||s!==null&&s.flags&128)for(s=a.child;s!==null;){if(C=mf(s),C!==null){for(a.flags|=128,Kd(T,!1),s=C.updateQueue,a.updateQueue=s,Kf(a,s),a.subtreeFlags=0,s=u,u=a.child;u!==null;)Ca(u,s),u=u.sibling;return Se(Xi,Xi.current&1|2),a.child}s=s.sibling}T.tail!==null&&Wn()>Ia&&(a.flags|=128,E=!0,Kd(T,!1),a.lanes=4194304)}else{if(!E)if(s=mf(C),s!==null){if(a.flags|=128,E=!0,s=s.updateQueue,a.updateQueue=s,Kf(a,s),Kd(T,!0),T.tail===null&&T.tailMode==="hidden"&&!C.alternate&&!In)return _i(a),null}else 2*Wn()-T.renderingStartTime>Ia&&u!==536870912&&(a.flags|=128,E=!0,Kd(T,!1),a.lanes=4194304);T.isBackwards?(C.sibling=a.child,a.child=C):(s=T.last,s!==null?s.sibling=C:a.child=C,T.last=C)}return T.tail!==null?(a=T.tail,T.rendering=a,T.tail=a.sibling,T.renderingStartTime=Wn(),a.sibling=null,s=Xi.current,Se(Xi,E?s&1|2:s&1),a):(_i(a),null);case 22:case 23:return ao(a),rh(),E=a.memoizedState!==null,s!==null?s.memoizedState!==null!==E&&(a.flags|=8192):E&&(a.flags|=8192),E?u&536870912&&!(a.flags&128)&&(_i(a),a.subtreeFlags&6&&(a.flags|=8192)):_i(a),u=a.updateQueue,u!==null&&Kf(a,u.retryQueue),u=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),E=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(E=a.memoizedState.cachePool.pool),E!==u&&(a.flags|=2048),s!==null&&Le(Po),null;case 24:return u=null,s!==null&&(u=s.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),Ta(Ji),_i(a),null;case 25:return null}throw Error(g(156,a.tag))}function $v(s,a){switch(E_(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return Ta(Ji),Ii(),s=a.flags,s&65536&&!(s&128)?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return pi(a),null;case 13:if(ao(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(g(340));mc()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return Le(Xi),null;case 4:return Ii(),null;case 10:return Ta(a.type),null;case 22:case 23:return ao(a),rh(),s!==null&&Le(Po),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return Ta(Ji),null;case 25:return null;default:return null}}function ty(s,a){switch(E_(a),a.tag){case 3:Ta(Ji),Ii();break;case 26:case 27:case 5:pi(a);break;case 4:Ii();break;case 13:ao(a);break;case 19:Le(Xi);break;case 10:Ta(a.type);break;case 22:case 23:ao(a),rh(),s!==null&&Le(Po);break;case 24:Ta(Ji)}}var kA={getCacheForType:function(s){var a=yr(Ji),u=a.data.get(s);return u===void 0&&(u=s(),a.data.set(s,u)),u}},MA=typeof WeakMap=="function"?WeakMap:Map,fi=0,zn=null,mn=null,gn=0,ci=0,es=null,wa=!1,Oc=!1,Pl=!1,jo=0,gi=0,Fo=0,Nc=0,zf=0,Ur=0,Ll=0,Oh=null,Go=null,Yf=!1,qf=0,Ia=1/0,zd=null,Ho=null,Yd=!1,Dc=null,qd=0,cg=0,lg=null,Wo=0,dg=null;function ns(){if(fi&2&&gn!==0)return gn&-gn;if(Jt.T!==null){var s=Ld;return s!==0?s:Mh()}return WE()}function Xf(){Ur===0&&(Ur=!(gn&536870912)||In?Qn():536870912);var s=ks.current;return s!==null&&(s.flags|=32),Ur}function Vr(s,a,u){(s===zn&&ci===2||s.cancelPendingCommit!==null)&&(Oa(s,0),Ko(s,gn,Ur,!1)),Zn(s,u),(!(fi&2)||s!==zn)&&(s===zn&&(!(fi&2)&&(Nc|=u),gi===4&&Ko(s,gn,Ur,!1)),Yo(s))}function ey(s,a,u){if(fi&6)throw Error(g(327));var E=!u&&(a&60)===0&&(a&s.expiredLanes)===0||je(s,a),T=E?xA(s,a):Pc(s,a,!0),C=E;do{if(T===0){Oc&&!E&&Ko(s,a,0,!1);break}else if(T===6)Ko(s,a,0,!wa);else{if(u=s.current.alternate,C&&!hg(u)){T=Pc(s,a,!1),C=!1;continue}if(T===2){if(C=a,s.errorRecoveryDisabledLanes&C)var B=0;else B=s.pendingLanes&-536870913,B=B!==0?B:B&536870912?536870912:0;if(B!==0){a=B;t:{var K=s;T=Oh;var nt=K.current.memoizedState.isDehydrated;if(nt&&(Oa(K,B).flags|=256),B=Pc(K,B,!1),B!==2){if(Pl&&!nt){K.errorRecoveryDisabledLanes|=C,Nc|=C,T=4;break t}C=Go,Go=T,C!==null&&ug(C)}T=B}if(C=!1,T!==2)continue}}if(T===1){Oa(s,0),Ko(s,a,0,!0);break}t:{switch(E=s,T){case 0:case 1:throw Error(g(345));case 4:if((a&4194176)===a){Ko(E,a,Ur,!wa);break t}break;case 2:Go=null;break;case 3:case 5:break;default:throw Error(g(329))}if(E.finishedWork=u,E.finishedLanes=a,(a&62914560)===a&&(C=qf+300-Wn(),10<C)){if(Ko(E,a,Ur,!wa),No(E,0)!==0)break t;E.timeoutHandle=Ry(ny.bind(null,E,u,Go,zd,Yf,a,Ur,Nc,Ll,wa,2,-0,0),C);break t}ny(E,u,Go,zd,Yf,a,Ur,Nc,Ll,wa,0,-0,0)}}break}while(!0);Yo(s)}function ug(s){Go===null?Go=s:Go.push.apply(Go,s)}function ny(s,a,u,E,T,C,B,K,nt,ut,kt,Xt,vt){var Pt=a.subtreeFlags;if((Pt&8192||(Pt&16785408)===16785408)&&(jl={stylesheets:null,count:0,unsuspend:ky},Gf(a),a=rw(),a!==null)){s.cancelPendingCommit=a(tm.bind(null,s,u,E,T,B,K,nt,1,Xt,vt)),Ko(s,C,B,!ut);return}tm(s,u,E,T,B,K,nt,kt,Xt,vt)}function hg(s){for(var a=s;;){var u=a.tag;if((u===0||u===11||u===15)&&a.flags&16384&&(u=a.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var E=0;E<u.length;E++){var T=u[E],C=T.getSnapshot;T=T.value;try{if(!fs(C(),T))return!1}catch{return!1}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Ko(s,a,u,E){a&=~zf,a&=~Nc,s.suspendedLanes|=a,s.pingedLanes&=~a,E&&(s.warmLanes|=a),E=s.expirationTimes;for(var T=a;0<T;){var C=31-Lr(T),B=1<<C;E[C]=-1,T&=~B}u!==0&&qr(s,u,a)}function Nh(){return fi&6?!0:(kh(0),!1)}function Jf(){if(mn!==null){if(ci===0)var s=mn.return;else s=mn,Sa=wl=null,b_(s),Nd=null,eh=0,s=mn;for(;s!==null;)ty(s.alternate,s),s=s.return;mn=null}}function Oa(s,a){s.finishedWork=null,s.finishedLanes=0;var u=s.timeoutHandle;u!==-1&&(s.timeoutHandle=-1,am(u)),u=s.cancelPendingCommit,u!==null&&(s.cancelPendingCommit=null,u()),Jf(),zn=s,mn=u=Bo(s.current,null),gn=a,ci=0,es=null,wa=!1,Oc=je(s,a),Pl=!1,Ll=Ur=zf=Nc=Fo=gi=0,Go=Oh=null,Yf=!1,a&8&&(a|=a&32);var E=s.entangledLanes;if(E!==0)for(s=s.entanglements,E&=a;0<E;){var T=31-Lr(E),C=1<<T;a|=s[T],E&=~C}return jo=a,rf(),u}function Qf(s,a){on=null,Jt.H=Lo,a===Zu?(a=uf(),ci=3):a===JT?(a=uf(),ci=4):ci=a===Pf?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,es=a,mn===null&&(gi=1,Nf(s,Mr(a,s.current)))}function Dh(){var s=Jt.H;return Jt.H=Lo,s===null?Lo:s}function Ph(){var s=Jt.A;return Jt.A=kA,s}function Zf(){gi=4,wa||(gn&4194176)!==gn&&ks.current!==null||(Oc=!0),!(Fo&134217727)&&!(Nc&134217727)||zn===null||Ko(zn,gn,Ur,!1)}function Pc(s,a,u){var E=fi;fi|=2;var T=Dh(),C=Ph();(zn!==s||gn!==a)&&(zd=null,Oa(s,a)),a=!1;var B=gi;t:do try{if(ci!==0&&mn!==null){var K=mn,nt=es;switch(ci){case 8:Jf(),B=6;break t;case 3:case 2:case 6:ks.current===null&&(a=!0);var ut=ci;if(ci=0,es=null,Xd(s,K,nt,ut),u&&Oc){B=0;break t}break;default:ut=ci,ci=0,es=null,Xd(s,K,nt,ut)}}kl(),B=gi;break}catch(kt){Qf(s,kt)}while(!0);return a&&s.shellSuspendCounter++,Sa=wl=null,fi=E,Jt.H=T,Jt.A=C,mn===null&&(zn=null,gn=0,rf()),B}function kl(){for(;mn!==null;)iy(mn)}function xA(s,a){var u=fi;fi|=2;var E=Dh(),T=Ph();zn!==s||gn!==a?(zd=null,Ia=Wn()+500,Oa(s,a)):Oc=je(s,a);t:do try{if(ci!==0&&mn!==null){a=mn;var C=es;e:switch(ci){case 1:ci=0,es=null,Xd(s,a,C,1);break;case 2:if(QT(C)){ci=0,es=null,ry(a);break}a=function(){ci===2&&zn===s&&(ci=7),Yo(s)},C.then(a,a);break t;case 3:ci=7;break t;case 4:ci=5;break t;case 7:QT(C)?(ci=0,es=null,ry(a)):(ci=0,es=null,Xd(s,a,C,7));break;case 5:var B=null;switch(mn.tag){case 26:B=mn.memoizedState;case 5:case 27:var K=mn;if(!B||wg(B)){ci=0,es=null;var nt=K.sibling;if(nt!==null)mn=nt;else{var ut=K.return;ut!==null?(mn=ut,$f(ut)):mn=null}break e}}ci=0,es=null,Xd(s,a,C,5);break;case 6:ci=0,es=null,Xd(s,a,C,6);break;case 8:Jf(),gi=6;break t;default:throw Error(g(462))}}Lh();break}catch(kt){Qf(s,kt)}while(!0);return Sa=wl=null,Jt.H=E,Jt.A=T,fi=u,mn!==null?0:(zn=null,gn=0,rf(),gi)}function Lh(){for(;mn!==null&&!Up();)iy(mn)}function iy(s){var a=Fv(s.alternate,s,jo);s.memoizedProps=s.pendingProps,a===null?$f(s):mn=a}function ry(s){var a=s,u=a.alternate;switch(a.tag){case 15:case 0:a=U_(u,a,a.pendingProps,a.type,void 0,gn);break;case 11:a=U_(u,a,a.pendingProps,a.type.render,a.ref,gn);break;case 5:b_(a);default:ty(u,a),a=mn=Ca(a,jo),a=Fv(u,a,jo)}s.memoizedProps=s.pendingProps,a===null?$f(s):mn=a}function Xd(s,a,u,E){Sa=wl=null,b_(a),Nd=null,eh=0;var T=a.return;try{if(Uv(s,T,a,u,gn)){gi=1,Nf(s,Mr(u,s.current)),mn=null;return}}catch(C){if(T!==null)throw mn=T,C;gi=1,Nf(s,Mr(u,s.current)),mn=null;return}a.flags&32768?(In||E===1?s=!0:Oc||gn&536870912?s=!1:(wa=s=!0,(E===2||E===3||E===6)&&(E=ks.current,E!==null&&E.tag===13&&(E.flags|=16384))),pg(a,s)):$f(a)}function $f(s){var a=s;do{if(a.flags&32768){pg(a,wa);return}s=a.return;var u=LA(a.alternate,a,jo);if(u!==null){mn=u;return}if(a=a.sibling,a!==null){mn=a;return}mn=a=s}while(a!==null);gi===0&&(gi=5)}function pg(s,a){do{var u=$v(s.alternate,s);if(u!==null){u.flags&=32767,mn=u;return}if(u=s.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!a&&(s=s.sibling,s!==null)){mn=s;return}mn=s=u}while(s!==null);gi=6,mn=null}function tm(s,a,u,E,T,C,B,K,nt,ut){var kt=Jt.T,Xt=zt.p;try{zt.p=2,Jt.T=null,sy(s,a,u,E,Xt,T,C,B,K,nt,ut)}finally{Jt.T=kt,zt.p=Xt}}function sy(s,a,u,E,T,C,B,K){do Ml();while(Dc!==null);if(fi&6)throw Error(g(327));var nt=s.finishedWork;if(E=s.finishedLanes,nt===null)return null;if(s.finishedWork=null,s.finishedLanes=0,nt===s.current)throw Error(g(177));s.callbackNode=null,s.callbackPriority=0,s.cancelPendingCommit=null;var ut=nt.lanes|nt.childLanes;if(ut|=f_,ha(s,E,ut,C,B,K),s===zn&&(mn=zn=null,gn=0),!(nt.subtreeFlags&10256)&&!(nt.flags&10256)||Yd||(Yd=!0,cg=ut,lg=u,dy(ul,function(){return Ml(),null})),u=(nt.flags&15990)!==0,nt.subtreeFlags&15990||u?(u=Jt.T,Jt.T=null,C=zt.p,zt.p=2,B=fi,fi|=4,DA(s,nt),Jv(nt,s),vA(Uc,s.containerInfo),Fh=!!xc,Uc=xc=null,s.current=nt,Yv(s,nt.alternate,nt),Io(),fi=B,zt.p=C,Jt.T=u):s.current=nt,Yd?(Yd=!1,Dc=s,qd=E):oy(s,ut),ut=s.pendingLanes,ut===0&&(Ho=null),Vu(nt.stateNode),Yo(s),a!==null)for(T=s.onRecoverableError,nt=0;nt<a.length;nt++)ut=a[nt],T(ut.value,{componentStack:ut.stack});return qd&3&&Ml(),ut=s.pendingLanes,E&4194218&&ut&42?s===dg?Wo++:(Wo=0,dg=s):Wo=0,kh(0),null}function oy(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,oh(a)))}function Ml(){if(Dc!==null){var s=Dc,a=cg;cg=0;var u=HE(qd),E=Jt.T,T=zt.p;try{if(zt.p=32>u?32:u,Jt.T=null,Dc===null)var C=!1;else{u=lg,lg=null;var B=Dc,K=qd;if(Dc=null,qd=0,fi&6)throw Error(g(331));var nt=fi;if(fi|=4,Zv(B.current),Wd(B,B.current,K,u),fi=nt,kh(0,!1),oi&&typeof oi.onPostCommitFiberRoot=="function")try{oi.onPostCommitFiberRoot(Oo,B)}catch{}C=!0}return C}finally{zt.p=T,Jt.T=E,oy(s,a)}}return!1}function ay(s,a,u){a=Mr(u,a),a=Th(s.stateNode,a,2),s=Cc(s,a,2),s!==null&&(Zn(s,2),Yo(s))}function Ln(s,a,u){if(s.tag===3)ay(s,s,u);else for(;a!==null;){if(a.tag===3){ay(a,s,u);break}else if(a.tag===1){var E=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof E.componentDidCatch=="function"&&(Ho===null||!Ho.has(E))){s=Mr(u,s),u=Mv(2),E=Cc(a,u,2),E!==null&&(xv(u,E,a,s),Zn(E,2),Yo(E));break}}a=a.return}}function Vs(s,a,u){var E=s.pingCache;if(E===null){E=s.pingCache=new MA;var T=new Set;E.set(a,T)}else T=E.get(a),T===void 0&&(T=new Set,E.set(a,T));T.has(u)||(Pl=!0,T.add(u),s=cy.bind(null,s,a,u),a.then(s,s))}function cy(s,a,u){var E=s.pingCache;E!==null&&E.delete(a),s.pingedLanes|=s.suspendedLanes&u,s.warmLanes&=~u,zn===s&&(gn&u)===u&&(gi===4||gi===3&&(gn&62914560)===gn&&300>Wn()-qf?!(fi&2)&&Oa(s,0):zf|=u,Ll===gn&&(Ll=0)),Yo(s)}function ly(s,a){a===0&&(a=Yr()),s=Ds(s,a),s!==null&&(Zn(s,a),Yo(s))}function UA(s){var a=s.memoizedState,u=0;a!==null&&(u=a.retryLane),ly(s,u)}function fg(s,a){var u=0;switch(s.tag){case 13:var E=s.stateNode,T=s.memoizedState;T!==null&&(u=T.retryLane);break;case 19:E=s.stateNode;break;case 22:E=s.stateNode._retryCache;break;default:throw Error(g(314))}E!==null&&E.delete(a),ly(s,u)}function dy(s,a){return nc(s,a)}var em=null,Na=null,zo=!1,Lc=!1,mg=!1,xl=0;function Yo(s){s!==Na&&s.next===null&&(Na===null?em=Na=s:Na=Na.next=s),Lc=!0,zo||(zo=!0,fy(Eg))}function kh(s,a){if(!mg&&Lc){mg=!0;do for(var u=!1,E=em;E!==null;){if(s!==0){var T=E.pendingLanes;if(T===0)var C=0;else{var B=E.suspendedLanes,K=E.pingedLanes;C=(1<<31-Lr(42|s)+1)-1,C&=T&~(B&~K),C=C&201326677?C&201326677|1:C?C|2:0}C!==0&&(u=!0,py(E,C))}else C=gn,C=No(E,E===zn?C:0),!(C&3)||je(E,C)||(u=!0,py(E,C));E=E.next}while(u);mg=!1}}function Eg(){Lc=zo=!1;var s=0;xl!==0&&(FA()&&(s=xl),xl=0);for(var a=Wn(),u=null,E=em;E!==null;){var T=E.next,C=uy(E,a);C===0?(E.next=null,u===null?em=T:u.next=T,T===null&&(Na=u)):(u=E,(s!==0||C&3)&&(Lc=!0)),E=T}kh(s)}function uy(s,a){for(var u=s.suspendedLanes,E=s.pingedLanes,T=s.expirationTimes,C=s.pendingLanes&-62914561;0<C;){var B=31-Lr(C),K=1<<B,nt=T[B];nt===-1?(!(K&u)||K&E)&&(T[B]=Tn(K,a)):nt<=a&&(s.expiredLanes|=K),C&=~K}if(a=zn,u=gn,u=No(s,s===a?u:0),E=s.callbackNode,u===0||s===a&&ci===2||s.cancelPendingCommit!==null)return E!==null&&E!==null&&eo(E),s.callbackNode=null,s.callbackPriority=0;if(!(u&3)||je(s,u)){if(a=u&-u,a===s.callbackPriority)return a;switch(E!==null&&eo(E),HE(u)){case 2:case 8:u=lr;break;case 32:u=ul;break;case 268435456:u=ic;break;default:u=ul}return E=hy.bind(null,s),u=nc(u,E),s.callbackPriority=a,s.callbackNode=u,a}return E!==null&&E!==null&&eo(E),s.callbackPriority=2,s.callbackNode=null,2}function hy(s,a){var u=s.callbackNode;if(Ml()&&s.callbackNode!==u)return null;var E=gn;return E=No(s,s===zn?E:0),E===0?null:(ey(s,E,a),uy(s,Wn()),s.callbackNode!=null&&s.callbackNode===u?hy.bind(null,s):null)}function py(s,a){if(Ml())return null;ey(s,a,!0)}function fy(s){GA(function(){fi&6?nc(gr,s):s()})}function Mh(){return xl===0&&(xl=Qn()),xl}function my(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:zp(""+s)}function Ey(s,a){var u=a.ownerDocument.createElement("input");return u.name=a.name,u.value=a.value,s.id&&u.setAttribute("form",s.id),a.parentNode.insertBefore(u,a),s=new FormData(s),u.parentNode.removeChild(u),s}function VA(s,a,u,E,T){if(a==="submit"&&u&&u.stateNode===T){var C=my((T[Jr]||null).action),B=E.submitter;B&&(a=(a=B[Jr]||null)?my(a.formAction):B.getAttribute("formAction"),a!==null&&(C=a,B=null));var K=new Jp("action","action",null,E,T);s.push({event:K,listeners:[{instance:null,listener:function(){if(E.defaultPrevented){if(xl!==0){var nt=B?Ey(T,B):new FormData(T);yl(u,{pending:!0,data:nt,method:T.method,action:C},null,nt)}}else typeof C=="function"&&(K.preventDefault(),nt=B?Ey(T,B):new FormData(T),yl(u,{pending:!0,data:nt,method:T.method,action:C},C,nt))},currentTarget:T}]})}}for(var nm=0;nm<zT.length;nm++){var xh=zT[nm],_y=xh.toLowerCase(),gy=xh[0].toUpperCase()+xh.slice(1);ro(_y,"on"+gy)}ro(GT,"onAnimationEnd"),ro(HT,"onAnimationIteration"),ro(nf,"onAnimationStart"),ro("dblclick","onDoubleClick"),ro("focusin","onFocus"),ro("focusout","onBlur"),ro(p_,"onTransitionRun"),ro(RA,"onTransitionStart"),ro(Ct,"onTransitionCancel"),ro(WT,"onTransitionEnd"),md("onMouseEnter",["mouseout","mouseover"]),md("onMouseLeave",["mouseout","mouseover"]),md("onPointerEnter",["pointerout","pointerover"]),md("onPointerLeave",["pointerout","pointerover"]),ti("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ti("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ti("onBeforeInput",["compositionend","keypress","textInput","paste"]),ti("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ti("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ti("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Sy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(kc));function Ty(s,a){a=(a&4)!==0;for(var u=0;u<s.length;u++){var E=s[u],T=E.event;E=E.listeners;t:{var C=void 0;if(a)for(var B=E.length-1;0<=B;B--){var K=E[B],nt=K.instance,ut=K.currentTarget;if(K=K.listener,nt!==C&&T.isPropagationStopped())break t;C=K,T.currentTarget=ut;try{C(T)}catch(kt){Sh(kt)}T.currentTarget=null,C=nt}else for(B=0;B<E.length;B++){if(K=E[B],nt=K.instance,ut=K.currentTarget,K=K.listener,nt!==C&&T.isPropagationStopped())break t;C=K,T.currentTarget=ut;try{C(T)}catch(kt){Sh(kt)}T.currentTarget=null,C=nt}}}}function En(s,a){var u=a[KE];u===void 0&&(u=a[KE]=new Set);var E=s+"__bubble";u.has(E)||(rm(a,s,2,!1),u.add(E))}function _g(s,a,u){var E=0;a&&(E|=4),rm(u,s,E,a)}var im="_reactListening"+Math.random().toString(36).slice(2);function Ul(s){if(!s[im]){s[im]=!0,aT.forEach(function(u){u!=="selectionchange"&&(Sy.has(u)||_g(u,!1,s),_g(u,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[im]||(a[im]=!0,_g("selectionchange",!1,a))}}function rm(s,a,u,E){switch(Fy(a)){case 2:var T=ow;break;case 8:T=jy;break;default:T=Gh}u=T.bind(null,a,u,s),T=void 0,!$E||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(T=!0),E?T!==void 0?s.addEventListener(a,u,{capture:!0,passive:T}):s.addEventListener(a,u,!0):T!==void 0?s.addEventListener(a,u,{passive:T}):s.addEventListener(a,u,!1)}function sm(s,a,u,E,T){var C=E;if(!(a&1)&&!(a&2)&&E!==null)t:for(;;){if(E===null)return;var B=E.tag;if(B===3||B===4){var K=E.stateNode.containerInfo;if(K===T||K.nodeType===8&&K.parentNode===T)break;if(B===4)for(B=E.return;B!==null;){var nt=B.tag;if((nt===3||nt===4)&&(nt=B.stateNode.containerInfo,nt===T||nt.nodeType===8&&nt.parentNode===T))return;B=B.return}for(;K!==null;){if(B=ac(K),B===null)return;if(nt=B.tag,nt===5||nt===6||nt===26||nt===27){E=C=B;continue t}K=K.parentNode}}E=E.return}gT(function(){var ut=C,kt=QE(u),Xt=[];t:{var vt=KT.get(s);if(vt!==void 0){var Pt=Jp,Te=s;switch(s){case"keypress":if(qp(u)===0)break t;case"keydown":case"keyup":Pt=uA;break;case"focusin":Te="focus",Pt=Td;break;case"focusout":Te="blur",Pt=Td;break;case"beforeblur":case"afterblur":Pt=Td;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Pt=Tr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Pt=rA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Pt=vd;break;case GT:case HT:case nf:Pt=oA;break;case WT:Pt=yd;break;case"scroll":case"scrollend":Pt=Ns;break;case"wheel":Pt=mA;break;case"copy":case"cut":case"paste":Pt=aA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Pt=vT;break;case"toggle":case"beforetoggle":Pt=EA}var He=(a&4)!==0,Ni=!He&&(s==="scroll"||s==="scrollend"),mt=He?vt!==null?vt+"Capture":null:vt;He=[];for(var lt=ut,gt;lt!==null;){var Ht=lt;if(gt=Ht.stateNode,Ht=Ht.tag,Ht!==5&&Ht!==26&&Ht!==27||gt===null||mt===null||(Ht=Sd(lt,mt),Ht!=null&&He.push(Vl(lt,Ht,gt))),Ni)break;lt=lt.return}0<He.length&&(vt=new Pt(vt,Te,null,u,kt),Xt.push({event:vt,listeners:He}))}}if(!(a&7)){t:{if(vt=s==="mouseover"||s==="pointerover",Pt=s==="mouseout"||s==="pointerout",vt&&u!==JE&&(Te=u.relatedTarget||u.fromElement)&&(ac(Te)||Te[hl]))break t;if((Pt||vt)&&(vt=kt.window===kt?kt:(vt=kt.ownerDocument)?vt.defaultView||vt.parentWindow:window,Pt?(Te=u.relatedTarget||u.toElement,Pt=ut,Te=Te?ac(Te):null,Te!==null&&(Ni=Nt(Te),He=Te.tag,Te!==Ni||He!==5&&He!==27&&He!==6)&&(Te=null)):(Pt=null,Te=ut),Pt!==Te)){if(He=Tr,Ht="onMouseLeave",mt="onMouseEnter",lt="mouse",(s==="pointerout"||s==="pointerover")&&(He=vT,Ht="onPointerLeave",mt="onPointerEnter",lt="pointer"),Ni=Pt==null?vt:Fu(Pt),gt=Te==null?vt:Fu(Te),vt=new He(Ht,lt+"leave",Pt,u,kt),vt.target=Ni,vt.relatedTarget=gt,Ht=null,ac(kt)===ut&&(He=new He(mt,lt+"enter",Te,u,kt),He.target=gt,He.relatedTarget=Ni,Ht=He),Ni=Ht,Pt&&Te)e:{for(He=Pt,mt=Te,lt=0,gt=He;gt;gt=Mc(gt))lt++;for(gt=0,Ht=mt;Ht;Ht=Mc(Ht))gt++;for(;0<lt-gt;)He=Mc(He),lt--;for(;0<gt-lt;)mt=Mc(mt),gt--;for(;lt--;){if(He===mt||mt!==null&&He===mt.alternate)break e;He=Mc(He),mt=Mc(mt)}He=null}else He=null;Pt!==null&&vy(Xt,vt,Pt,He,!1),Te!==null&&Ni!==null&&vy(Xt,Ni,Te,He,!0)}}t:{if(vt=ut?Fu(ut):window,Pt=vt.nodeName&&vt.nodeName.toLowerCase(),Pt==="select"||Pt==="input"&&vt.type==="file")var Ee=NT;else if(IT(vt))if(DT)Ee=xT;else{Ee=SA;var dn=MT}else Pt=vt.nodeName,!Pt||Pt.toLowerCase()!=="input"||vt.type!=="checkbox"&&vt.type!=="radio"?ut&&Hu(ut.elementType)&&(Ee=NT):Ee=TA;if(Ee&&(Ee=Ee(s,ut))){OT(Xt,Ee,u,kt);break t}dn&&dn(s,vt,ut),s==="focusout"&&ut&&vt.type==="number"&&ut.memoizedProps.value!=null&&XE(vt,"number",vt.value)}switch(dn=ut?Fu(ut):window,s){case"focusin":(IT(dn)||dn.contentEditable==="true")&&(Yi=dn,d_=ut,Ju=null);break;case"focusout":Ju=d_=Yi=null;break;case"mousedown":u_=!0;break;case"contextmenu":case"mouseup":case"dragend":u_=!1,jT(Xt,u,kt);break;case"selectionchange":if(yA)break;case"keydown":case"keyup":jT(Xt,u,kt)}var Ce;if(s_)t:{switch(s){case"compositionstart":var xe="onCompositionStart";break t;case"compositionend":xe="onCompositionEnd";break t;case"compositionupdate":xe="onCompositionUpdate";break t}xe=void 0}else Rd?tf(s,u)&&(xe="onCompositionEnd"):s==="keydown"&&u.keyCode===229&&(xe="onCompositionStart");xe&&(RT&&u.locale!=="ko"&&(Rd||xe!=="onCompositionStart"?xe==="onCompositionEnd"&&Rd&&(Ce=ST()):(lc=kt,fl="value"in lc?lc.value:lc.textContent,Rd=!0)),dn=Jd(ut,xe),0<dn.length&&(xe=new $p(xe,s,null,u,kt),Xt.push({event:xe,listeners:dn}),Ce?xe.data=Ce:(Ce=AT(u),Ce!==null&&(xe.data=Ce)))),(Ce=o_?wT(s,u):gA(s,u))&&(xe=Jd(ut,"onBeforeInput"),0<xe.length&&(dn=new $p("onBeforeInput","beforeinput",null,u,kt),Xt.push({event:dn,listeners:xe}),dn.data=Ce)),VA(Xt,s,ut,u,kt)}Ty(Xt,a)})}function Vl(s,a,u){return{instance:s,listener:a,currentTarget:u}}function Jd(s,a){for(var u=a+"Capture",E=[];s!==null;){var T=s,C=T.stateNode;T=T.tag,T!==5&&T!==26&&T!==27||C===null||(T=Sd(s,u),T!=null&&E.unshift(Vl(s,T,C)),T=Sd(s,a),T!=null&&E.push(Vl(s,T,C))),s=s.return}return E}function Mc(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function vy(s,a,u,E,T){for(var C=a._reactName,B=[];u!==null&&u!==E;){var K=u,nt=K.alternate,ut=K.stateNode;if(K=K.tag,nt!==null&&nt===E)break;K!==5&&K!==26&&K!==27||ut===null||(nt=ut,T?(ut=Sd(u,C),ut!=null&&B.unshift(Vl(u,ut,nt))):T||(ut=Sd(u,C),ut!=null&&B.push(Vl(u,ut,nt)))),u=u.return}B.length!==0&&s.push({event:a,listeners:B})}var BA=/\r\n?/g,yy=/\u0000|\uFFFD/g;function gg(s){return(typeof s=="string"?s:""+s).replace(BA,`
`).replace(yy,"")}function Sg(s,a){return a=gg(a),gg(s)===a}function Uh(){}function Gn(s,a,u,E,T,C){switch(u){case"children":typeof E=="string"?a==="body"||a==="textarea"&&E===""||cc(s,E):(typeof E=="number"||typeof E=="bigint")&&a!=="body"&&cc(s,""+E);break;case"className":Gp(s,"class",E);break;case"tabIndex":Gp(s,"tabindex",E);break;case"dir":case"role":case"viewBox":case"width":case"height":Gp(s,u,E);break;case"style":mT(s,E,C);break;case"data":if(a!=="object"){Gp(s,"data",E);break}case"src":case"href":if(E===""&&(a!=="a"||u!=="href")){s.removeAttribute(u);break}if(E==null||typeof E=="function"||typeof E=="symbol"||typeof E=="boolean"){s.removeAttribute(u);break}E=zp(""+E),s.setAttribute(u,E);break;case"action":case"formAction":if(typeof E=="function"){s.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(u==="formAction"?(a!=="input"&&Gn(s,a,"name",T.name,T,null),Gn(s,a,"formEncType",T.formEncType,T,null),Gn(s,a,"formMethod",T.formMethod,T,null),Gn(s,a,"formTarget",T.formTarget,T,null)):(Gn(s,a,"encType",T.encType,T,null),Gn(s,a,"method",T.method,T,null),Gn(s,a,"target",T.target,T,null)));if(E==null||typeof E=="symbol"||typeof E=="boolean"){s.removeAttribute(u);break}E=zp(""+E),s.setAttribute(u,E);break;case"onClick":E!=null&&(s.onclick=Uh);break;case"onScroll":E!=null&&En("scroll",s);break;case"onScrollEnd":E!=null&&En("scrollend",s);break;case"dangerouslySetInnerHTML":if(E!=null){if(typeof E!="object"||!("__html"in E))throw Error(g(61));if(u=E.__html,u!=null){if(T.children!=null)throw Error(g(60));s.innerHTML=u}}break;case"multiple":s.multiple=E&&typeof E!="function"&&typeof E!="symbol";break;case"muted":s.muted=E&&typeof E!="function"&&typeof E!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(E==null||typeof E=="function"||typeof E=="boolean"||typeof E=="symbol"){s.removeAttribute("xlink:href");break}u=zp(""+E),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":E!=null&&typeof E!="function"&&typeof E!="symbol"?s.setAttribute(u,""+E):s.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":E&&typeof E!="function"&&typeof E!="symbol"?s.setAttribute(u,""):s.removeAttribute(u);break;case"capture":case"download":E===!0?s.setAttribute(u,""):E!==!1&&E!=null&&typeof E!="function"&&typeof E!="symbol"?s.setAttribute(u,E):s.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":E!=null&&typeof E!="function"&&typeof E!="symbol"&&!isNaN(E)&&1<=E?s.setAttribute(u,E):s.removeAttribute(u);break;case"rowSpan":case"start":E==null||typeof E=="function"||typeof E=="symbol"||isNaN(E)?s.removeAttribute(u):s.setAttribute(u,E);break;case"popover":En("beforetoggle",s),En("toggle",s),Gu(s,"popover",E);break;case"xlinkActuate":fa(s,"http://www.w3.org/1999/xlink","xlink:actuate",E);break;case"xlinkArcrole":fa(s,"http://www.w3.org/1999/xlink","xlink:arcrole",E);break;case"xlinkRole":fa(s,"http://www.w3.org/1999/xlink","xlink:role",E);break;case"xlinkShow":fa(s,"http://www.w3.org/1999/xlink","xlink:show",E);break;case"xlinkTitle":fa(s,"http://www.w3.org/1999/xlink","xlink:title",E);break;case"xlinkType":fa(s,"http://www.w3.org/1999/xlink","xlink:type",E);break;case"xmlBase":fa(s,"http://www.w3.org/XML/1998/namespace","xml:base",E);break;case"xmlLang":fa(s,"http://www.w3.org/XML/1998/namespace","xml:lang",E);break;case"xmlSpace":fa(s,"http://www.w3.org/XML/1998/namespace","xml:space",E);break;case"is":Gu(s,"is",E);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=nA.get(u)||u,Gu(s,u,E))}}function Tg(s,a,u,E,T,C){switch(u){case"style":mT(s,E,C);break;case"dangerouslySetInnerHTML":if(E!=null){if(typeof E!="object"||!("__html"in E))throw Error(g(61));if(u=E.__html,u!=null){if(T.children!=null)throw Error(g(60));s.innerHTML=u}}break;case"children":typeof E=="string"?cc(s,E):(typeof E=="number"||typeof E=="bigint")&&cc(s,""+E);break;case"onScroll":E!=null&&En("scroll",s);break;case"onScrollEnd":E!=null&&En("scrollend",s);break;case"onClick":E!=null&&(s.onclick=Uh);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!cT.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(T=u.endsWith("Capture"),a=u.slice(2,T?u.length-7:void 0),C=s[Jr]||null,C=C!=null?C[u]:null,typeof C=="function"&&s.removeEventListener(a,C,T),typeof E=="function")){typeof C!="function"&&C!==null&&(u in s?s[u]=null:s.hasAttribute(u)&&s.removeAttribute(u)),s.addEventListener(a,E,T);break t}u in s?s[u]=E:E===!0?s.setAttribute(u,""):Gu(s,u,E)}}}function ir(s,a,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":En("error",s),En("load",s);var E=!1,T=!1,C;for(C in u)if(u.hasOwnProperty(C)){var B=u[C];if(B!=null)switch(C){case"src":E=!0;break;case"srcSet":T=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(g(137,a));default:Gn(s,a,C,B,u,null)}}T&&Gn(s,a,"srcSet",u.srcSet,u,null),E&&Gn(s,a,"src",u.src,u,null);return;case"input":En("invalid",s);var K=C=B=T=null,nt=null,ut=null;for(E in u)if(u.hasOwnProperty(E)){var kt=u[E];if(kt!=null)switch(E){case"name":T=kt;break;case"type":B=kt;break;case"checked":nt=kt;break;case"defaultChecked":ut=kt;break;case"value":C=kt;break;case"defaultValue":K=kt;break;case"children":case"dangerouslySetInnerHTML":if(kt!=null)throw Error(g(137,a));break;default:Gn(s,a,E,kt,u,null)}}uT(s,C,K,nt,ut,B,T,!1),Hp(s);return;case"select":En("invalid",s),E=B=C=null;for(T in u)if(u.hasOwnProperty(T)&&(K=u[T],K!=null))switch(T){case"value":C=K;break;case"defaultValue":B=K;break;case"multiple":E=K;default:Gn(s,a,T,K,u,null)}a=C,u=B,s.multiple=!!E,a!=null?Ed(s,!!E,a,!1):u!=null&&Ed(s,!!E,u,!0);return;case"textarea":En("invalid",s),C=T=E=null;for(B in u)if(u.hasOwnProperty(B)&&(K=u[B],K!=null))switch(B){case"value":E=K;break;case"defaultValue":T=K;break;case"children":C=K;break;case"dangerouslySetInnerHTML":if(K!=null)throw Error(g(91));break;default:Gn(s,a,B,K,u,null)}pT(s,E,T,C),Hp(s);return;case"option":for(nt in u)if(u.hasOwnProperty(nt)&&(E=u[nt],E!=null))switch(nt){case"selected":s.selected=E&&typeof E!="function"&&typeof E!="symbol";break;default:Gn(s,a,nt,E,u,null)}return;case"dialog":En("cancel",s),En("close",s);break;case"iframe":case"object":En("load",s);break;case"video":case"audio":for(E=0;E<kc.length;E++)En(kc[E],s);break;case"image":En("error",s),En("load",s);break;case"details":En("toggle",s);break;case"embed":case"source":case"link":En("error",s),En("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ut in u)if(u.hasOwnProperty(ut)&&(E=u[ut],E!=null))switch(ut){case"children":case"dangerouslySetInnerHTML":throw Error(g(137,a));default:Gn(s,a,ut,E,u,null)}return;default:if(Hu(a)){for(kt in u)u.hasOwnProperty(kt)&&(E=u[kt],E!==void 0&&Tg(s,a,kt,E,u,void 0));return}}for(K in u)u.hasOwnProperty(K)&&(E=u[K],E!=null&&Gn(s,a,K,E,u,null))}function jA(s,a,u,E){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var T=null,C=null,B=null,K=null,nt=null,ut=null,kt=null;for(Pt in u){var Xt=u[Pt];if(u.hasOwnProperty(Pt)&&Xt!=null)switch(Pt){case"checked":break;case"value":break;case"defaultValue":nt=Xt;default:E.hasOwnProperty(Pt)||Gn(s,a,Pt,null,E,Xt)}}for(var vt in E){var Pt=E[vt];if(Xt=u[vt],E.hasOwnProperty(vt)&&(Pt!=null||Xt!=null))switch(vt){case"type":C=Pt;break;case"name":T=Pt;break;case"checked":ut=Pt;break;case"defaultChecked":kt=Pt;break;case"value":B=Pt;break;case"defaultValue":K=Pt;break;case"children":case"dangerouslySetInnerHTML":if(Pt!=null)throw Error(g(137,a));break;default:Pt!==Xt&&Gn(s,a,vt,Pt,E,Xt)}}qE(s,B,K,nt,ut,kt,C,T);return;case"select":Pt=B=K=vt=null;for(C in u)if(nt=u[C],u.hasOwnProperty(C)&&nt!=null)switch(C){case"value":break;case"multiple":Pt=nt;default:E.hasOwnProperty(C)||Gn(s,a,C,null,E,nt)}for(T in E)if(C=E[T],nt=u[T],E.hasOwnProperty(T)&&(C!=null||nt!=null))switch(T){case"value":vt=C;break;case"defaultValue":K=C;break;case"multiple":B=C;default:C!==nt&&Gn(s,a,T,C,E,nt)}a=K,u=B,E=Pt,vt!=null?Ed(s,!!u,vt,!1):!!E!=!!u&&(a!=null?Ed(s,!!u,a,!0):Ed(s,!!u,u?[]:"",!1));return;case"textarea":Pt=vt=null;for(K in u)if(T=u[K],u.hasOwnProperty(K)&&T!=null&&!E.hasOwnProperty(K))switch(K){case"value":break;case"children":break;default:Gn(s,a,K,null,E,T)}for(B in E)if(T=E[B],C=u[B],E.hasOwnProperty(B)&&(T!=null||C!=null))switch(B){case"value":vt=T;break;case"defaultValue":Pt=T;break;case"children":break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(g(91));break;default:T!==C&&Gn(s,a,B,T,E,C)}hT(s,vt,Pt);return;case"option":for(var Te in u)if(vt=u[Te],u.hasOwnProperty(Te)&&vt!=null&&!E.hasOwnProperty(Te))switch(Te){case"selected":s.selected=!1;break;default:Gn(s,a,Te,null,E,vt)}for(nt in E)if(vt=E[nt],Pt=u[nt],E.hasOwnProperty(nt)&&vt!==Pt&&(vt!=null||Pt!=null))switch(nt){case"selected":s.selected=vt&&typeof vt!="function"&&typeof vt!="symbol";break;default:Gn(s,a,nt,vt,E,Pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var He in u)vt=u[He],u.hasOwnProperty(He)&&vt!=null&&!E.hasOwnProperty(He)&&Gn(s,a,He,null,E,vt);for(ut in E)if(vt=E[ut],Pt=u[ut],E.hasOwnProperty(ut)&&vt!==Pt&&(vt!=null||Pt!=null))switch(ut){case"children":case"dangerouslySetInnerHTML":if(vt!=null)throw Error(g(137,a));break;default:Gn(s,a,ut,vt,E,Pt)}return;default:if(Hu(a)){for(var Ni in u)vt=u[Ni],u.hasOwnProperty(Ni)&&vt!==void 0&&!E.hasOwnProperty(Ni)&&Tg(s,a,Ni,void 0,E,vt);for(kt in E)vt=E[kt],Pt=u[kt],!E.hasOwnProperty(kt)||vt===Pt||vt===void 0&&Pt===void 0||Tg(s,a,kt,vt,E,Pt);return}}for(var mt in u)vt=u[mt],u.hasOwnProperty(mt)&&vt!=null&&!E.hasOwnProperty(mt)&&Gn(s,a,mt,null,E,vt);for(Xt in E)vt=E[Xt],Pt=u[Xt],!E.hasOwnProperty(Xt)||vt===Pt||vt==null&&Pt==null||Gn(s,a,Xt,vt,E,Pt)}var xc=null,Uc=null;function Qd(s){return s.nodeType===9?s:s.ownerDocument}function vg(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function yg(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function Rg(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var om=null;function FA(){var s=window.event;return s&&s.type==="popstate"?s===om?!1:(om=s,!0):(om=null,!1)}var Ry=typeof setTimeout=="function"?setTimeout:void 0,am=typeof clearTimeout=="function"?clearTimeout:void 0,by=typeof Promise=="function"?Promise:void 0,GA=typeof queueMicrotask=="function"?queueMicrotask:typeof by<"u"?function(s){return by.resolve(null).then(s).catch(HA)}:Ry;function HA(s){setTimeout(function(){throw s})}function bg(s,a){var u=a,E=0;do{var T=u.nextSibling;if(s.removeChild(u),T&&T.nodeType===8)if(u=T.data,u==="/$"){if(E===0){s.removeChild(T),Kh(a);return}E--}else u!=="$"&&u!=="$?"&&u!=="$!"||E++;u=T}while(u);Kh(a)}function Cg(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var u=a;switch(a=a.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Cg(u),ju(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}s.removeChild(u)}}function WA(s,a,u,E){for(;s.nodeType===1;){var T=u;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!E&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(E){if(!s[pd])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(C=s.getAttribute("rel"),C==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(C!==T.rel||s.getAttribute("href")!==(T.href==null?null:T.href)||s.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin)||s.getAttribute("title")!==(T.title==null?null:T.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(C=s.getAttribute("src"),(C!==(T.src==null?null:T.src)||s.getAttribute("type")!==(T.type==null?null:T.type)||s.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin))&&C&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var C=T.name==null?null:""+T.name;if(T.type==="hidden"&&s.getAttribute("name")===C)return s}else return s;if(s=lo(s.nextSibling),s===null)break}return null}function KA(s,a,u){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!u||(s=lo(s.nextSibling),s===null))return null;return s}function lo(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return s}function Cy(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var u=s.data;if(u==="$"||u==="$!"||u==="$?"){if(a===0)return s;a--}else u==="/$"&&a++}s=s.previousSibling}return null}function Ay(s,a,u){switch(a=Qd(u),s){case"html":if(s=a.documentElement,!s)throw Error(g(452));return s;case"head":if(s=a.head,!s)throw Error(g(453));return s;case"body":if(s=a.body,!s)throw Error(g(454));return s;default:throw Error(g(451))}}var Bs=new Map,wy=new Set;function cm(s){return typeof s.getRootNode=="function"?s.getRootNode():s.ownerDocument}var Da=zt.d;zt.d={f:zA,r:YA,D:qA,C:XA,L:JA,m:QA,X:$A,S:ZA,M:tw};function zA(){var s=Da.f(),a=Nh();return s||a}function YA(s){var a=no(s);a!==null&&a.tag===5&&a.type==="form"?Iv(a):Da.r(s)}var Bl=typeof document>"u"?null:document;function Iy(s,a,u){var E=Bl;if(E&&typeof a=="string"&&a){var T=ps(a);T='link[rel="'+s+'"][href="'+T+'"]',typeof u=="string"&&(T+='[crossorigin="'+u+'"]'),wy.has(T)||(wy.add(T),s={rel:s,crossOrigin:u,href:a},E.querySelector(T)===null&&(a=E.createElement("link"),ir(a,"link",s),$n(a),E.head.appendChild(a)))}}function qA(s){Da.D(s),Iy("dns-prefetch",s,null)}function XA(s,a){Da.C(s,a),Iy("preconnect",s,a)}function JA(s,a,u){Da.L(s,a,u);var E=Bl;if(E&&s&&a){var T='link[rel="preload"][as="'+ps(a)+'"]';a==="image"&&u&&u.imageSrcSet?(T+='[imagesrcset="'+ps(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(T+='[imagesizes="'+ps(u.imageSizes)+'"]')):T+='[href="'+ps(s)+'"]';var C=T;switch(a){case"style":C=Zd(s);break;case"script":C=$d(s)}Bs.has(C)||(s=ae({rel:"preload",href:a==="image"&&u&&u.imageSrcSet?void 0:s,as:a},u),Bs.set(C,s),E.querySelector(T)!==null||a==="style"&&E.querySelector(Vh(C))||a==="script"&&E.querySelector(Bh(C))||(a=E.createElement("link"),ir(a,"link",s),$n(a),E.head.appendChild(a)))}}function QA(s,a){Da.m(s,a);var u=Bl;if(u&&s){var E=a&&typeof a.as=="string"?a.as:"script",T='link[rel="modulepreload"][as="'+ps(E)+'"][href="'+ps(s)+'"]',C=T;switch(E){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=$d(s)}if(!Bs.has(C)&&(s=ae({rel:"modulepreload",href:s},a),Bs.set(C,s),u.querySelector(T)===null)){switch(E){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Bh(C)))return}E=u.createElement("link"),ir(E,"link",s),$n(E),u.head.appendChild(E)}}}function ZA(s,a,u){Da.S(s,a,u);var E=Bl;if(E&&s){var T=fd(E).hoistableStyles,C=Zd(s);a=a||"default";var B=T.get(C);if(!B){var K={loading:0,preload:null};if(B=E.querySelector(Vh(C)))K.loading=5;else{s=ae({rel:"stylesheet",href:s,"data-precedence":a},u),(u=Bs.get(C))&&dm(s,u);var nt=B=E.createElement("link");$n(nt),ir(nt,"link",s),nt._p=new Promise(function(ut,kt){nt.onload=ut,nt.onerror=kt}),nt.addEventListener("load",function(){K.loading|=1}),nt.addEventListener("error",function(){K.loading|=2}),K.loading|=4,lm(B,a,E)}B={type:"stylesheet",instance:B,count:1,state:K},T.set(C,B)}}}function $A(s,a){Da.X(s,a);var u=Bl;if(u&&s){var E=fd(u).hoistableScripts,T=$d(s),C=E.get(T);C||(C=u.querySelector(Bh(T)),C||(s=ae({src:s,async:!0},a),(a=Bs.get(T))&&Ag(s,a),C=u.createElement("script"),$n(C),ir(C,"link",s),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},E.set(T,C))}}function tw(s,a){Da.M(s,a);var u=Bl;if(u&&s){var E=fd(u).hoistableScripts,T=$d(s),C=E.get(T);C||(C=u.querySelector(Bh(T)),C||(s=ae({src:s,async:!0,type:"module"},a),(a=Bs.get(T))&&Ag(s,a),C=u.createElement("script"),$n(C),ir(C,"link",s),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},E.set(T,C))}}function Oy(s,a,u,E){var T=(T=Pn.current)?cm(T):null;if(!T)throw Error(g(446));switch(s){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(a=Zd(u.href),u=fd(T).hoistableStyles,E=u.get(a),E||(E={type:"style",instance:null,count:0,state:null},u.set(a,E)),E):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){s=Zd(u.href);var C=fd(T).hoistableStyles,B=C.get(s);if(B||(T=T.ownerDocument||T,B={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(s,B),(C=T.querySelector(Vh(s)))&&!C._p&&(B.instance=C,B.state.loading=5),Bs.has(s)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Bs.set(s,u),C||ew(T,s,u,B.state))),a&&E===null)throw Error(g(528,""));return B}if(a&&E!==null)throw Error(g(529,""));return null;case"script":return a=u.async,u=u.src,typeof u=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=$d(u),u=fd(T).hoistableScripts,E=u.get(a),E||(E={type:"script",instance:null,count:0,state:null},u.set(a,E)),E):{type:"void",instance:null,count:0,state:null};default:throw Error(g(444,s))}}function Zd(s){return'href="'+ps(s)+'"'}function Vh(s){return'link[rel="stylesheet"]['+s+"]"}function Ny(s){return ae({},s,{"data-precedence":s.precedence,precedence:null})}function ew(s,a,u,E){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?E.loading=1:(a=s.createElement("link"),E.preload=a,a.addEventListener("load",function(){return E.loading|=1}),a.addEventListener("error",function(){return E.loading|=2}),ir(a,"link",u),$n(a),s.head.appendChild(a))}function $d(s){return'[src="'+ps(s)+'"]'}function Bh(s){return"script[async]"+s}function Dy(s,a,u){if(a.count++,a.instance===null)switch(a.type){case"style":var E=s.querySelector('style[data-href~="'+ps(u.href)+'"]');if(E)return a.instance=E,$n(E),E;var T=ae({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return E=(s.ownerDocument||s).createElement("style"),$n(E),ir(E,"style",T),lm(E,u.precedence,s),a.instance=E;case"stylesheet":T=Zd(u.href);var C=s.querySelector(Vh(T));if(C)return a.state.loading|=4,a.instance=C,$n(C),C;E=Ny(u),(T=Bs.get(T))&&dm(E,T),C=(s.ownerDocument||s).createElement("link"),$n(C);var B=C;return B._p=new Promise(function(K,nt){B.onload=K,B.onerror=nt}),ir(C,"link",E),a.state.loading|=4,lm(C,u.precedence,s),a.instance=C;case"script":return C=$d(u.src),(T=s.querySelector(Bh(C)))?(a.instance=T,$n(T),T):(E=u,(T=Bs.get(C))&&(E=ae({},u),Ag(E,T)),s=s.ownerDocument||s,T=s.createElement("script"),$n(T),ir(T,"link",E),s.head.appendChild(T),a.instance=T);case"void":return null;default:throw Error(g(443,a.type))}else a.type==="stylesheet"&&!(a.state.loading&4)&&(E=a.instance,a.state.loading|=4,lm(E,u.precedence,s));return a.instance}function lm(s,a,u){for(var E=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),T=E.length?E[E.length-1]:null,C=T,B=0;B<E.length;B++){var K=E[B];if(K.dataset.precedence===a)C=K;else if(C!==T)break}C?C.parentNode.insertBefore(s,C.nextSibling):(a=u.nodeType===9?u.head:u,a.insertBefore(s,a.firstChild))}function dm(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function Ag(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var um=null;function Py(s,a,u){if(um===null){var E=new Map,T=um=new Map;T.set(u,E)}else T=um,E=T.get(u),E||(E=new Map,T.set(u,E));if(E.has(s))return E;for(E.set(s,null),u=u.getElementsByTagName(s),T=0;T<u.length;T++){var C=u[T];if(!(C[pd]||C[dr]||s==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var B=C.getAttribute(a)||"";B=s+B;var K=E.get(B);K?K.push(C):E.set(B,[C])}}return E}function Ly(s,a,u){s=s.ownerDocument||s,s.head.insertBefore(u,a==="title"?s.querySelector("head > title"):null)}function nw(s,a,u){if(u===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return s=a.disabled,typeof a.precedence=="string"&&s==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function wg(s){return!(s.type==="stylesheet"&&!(s.state.loading&3))}var jl=null;function ky(){}function iw(s,a,u){if(jl===null)throw Error(g(475));var E=jl;if(a.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&!(a.state.loading&4)){if(a.instance===null){var T=Zd(u.href),C=s.querySelector(Vh(T));if(C){s=C._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(E.count++,E=tu.bind(E),s.then(E,E)),a.state.loading|=4,a.instance=C,$n(C);return}C=s.ownerDocument||s,u=Ny(u),(T=Bs.get(T))&&dm(u,T),C=C.createElement("link"),$n(C);var B=C;B._p=new Promise(function(K,nt){B.onload=K,B.onerror=nt}),ir(C,"link",u),a.instance=C}E.stylesheets===null&&(E.stylesheets=new Map),E.stylesheets.set(a,s),(s=a.state.preload)&&!(a.state.loading&3)&&(E.count++,a=tu.bind(E),s.addEventListener("load",a),s.addEventListener("error",a))}}function rw(){if(jl===null)throw Error(g(475));var s=jl;return s.stylesheets&&s.count===0&&Ig(s,s.stylesheets),0<s.count?function(a){var u=setTimeout(function(){if(s.stylesheets&&Ig(s,s.stylesheets),s.unsuspend){var E=s.unsuspend;s.unsuspend=null,E()}},6e4);return s.unsuspend=a,function(){s.unsuspend=null,clearTimeout(u)}}:null}function tu(){if(this.count--,this.count===0){if(this.stylesheets)Ig(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var hm=null;function Ig(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,hm=new Map,a.forEach(sw,s),hm=null,tu.call(s))}function sw(s,a){if(!(a.state.loading&4)){var u=hm.get(s);if(u)var E=u.get(null);else{u=new Map,hm.set(s,u);for(var T=s.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<T.length;C++){var B=T[C];(B.nodeName==="LINK"||B.getAttribute("media")!=="not all")&&(u.set(B.dataset.precedence,B),E=B)}E&&u.set(null,E)}T=a.instance,B=T.getAttribute("data-precedence"),C=u.get(B)||E,C===E&&u.set(null,T),u.set(B,T),this.count++,E=tu.bind(this),T.addEventListener("load",E),T.addEventListener("error",E),C?C.parentNode.insertBefore(T,C.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(T,s.firstChild)),a.state.loading|=4}}var jh={$$typeof:z,Provider:null,Consumer:null,_currentValue:ve,_currentValue2:ve,_threadCount:0};function My(s,a,u,E,T,C,B,K){this.tag=1,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=kr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kr(0),this.hiddenUpdates=kr(null),this.identifierPrefix=E,this.onUncaughtError=T,this.onCaughtError=C,this.onRecoverableError=B,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=K,this.incompleteTransitions=new Map}function xy(s,a,u,E,T,C,B,K,nt,ut,kt,Xt){return s=new My(s,a,u,B,K,nt,ut,Xt),a=1,C===!0&&(a|=24),C=Us(3,null,null,a),s.current=C,C.stateNode=s,a=v_(),a.refCount++,s.pooledCache=a,a.refCount++,C.memoizedState={element:E,isDehydrated:u,cache:a},vh(C),s}function pm(s){return s?(s=ma,s):ma}function Uy(s,a,u,E,T,C){T=pm(T),E.context===null?E.context=T:E.pendingContext=T,E=bc(a),E.payload={element:u},C=C===void 0?null:C,C!==null&&(E.callback=C),u=Cc(s,E,a),u!==null&&(Vr(u,s,a),yh(u,s,a))}function Vy(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var u=s.retryLane;s.retryLane=u!==0&&u<a?u:a}}function Og(s,a){Vy(s,a),(s=s.alternate)&&Vy(s,a)}function By(s){if(s.tag===13){var a=Ds(s,67108864);a!==null&&Vr(a,s,67108864),Og(s,67108864)}}var Fh=!0;function ow(s,a,u,E){var T=Jt.T;Jt.T=null;var C=zt.p;try{zt.p=2,Gh(s,a,u,E)}finally{zt.p=C,Jt.T=T}}function jy(s,a,u,E){var T=Jt.T;Jt.T=null;var C=zt.p;try{zt.p=8,Gh(s,a,u,E)}finally{zt.p=C,Jt.T=T}}function Gh(s,a,u,E){if(Fh){var T=Ng(E);if(T===null)sm(s,a,E,fm,u),Dg(s,E);else if(Gy(T,s,a,u,E))E.stopPropagation();else if(Dg(s,E),a&4&&-1<aw.indexOf(s)){for(;T!==null;){var C=no(T);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var B=Sr(C.pendingLanes);if(B!==0){var K=C;for(K.pendingLanes|=2,K.entangledLanes|=2;B;){var nt=1<<31-Lr(B);K.entanglements[1]|=nt,B&=~nt}Yo(C),!(fi&6)&&(Ia=Wn()+500,kh(0))}}break;case 13:K=Ds(C,2),K!==null&&Vr(K,C,2),Nh(),Og(C,2)}if(C=Ng(E),C===null&&sm(s,a,E,fm,u),C===T)break;T=C}T!==null&&E.stopPropagation()}else sm(s,a,E,null,u)}}function Ng(s){return s=QE(s),mm(s)}var fm=null;function mm(s){if(fm=null,s=ac(s),s!==null){var a=Nt(s);if(a===null)s=null;else{var u=a.tag;if(u===13){if(s=Yt(a),s!==null)return s;s=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return fm=s,null}function Fy(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Vp()){case gr:return 2;case lr:return 8;case ul:case xu:return 32;case ic:return 268435456;default:return 32}default:return 32}}var Em=!1,Pa=null,Vc=null,Bc=null,Hh=new Map,Wh=new Map,jc=[],aw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Dg(s,a){switch(s){case"focusin":case"focusout":Pa=null;break;case"dragenter":case"dragleave":Vc=null;break;case"mouseover":case"mouseout":Bc=null;break;case"pointerover":case"pointerout":Hh.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wh.delete(a.pointerId)}}function Fl(s,a,u,E,T,C){return s===null||s.nativeEvent!==C?(s={blockedOn:a,domEventName:u,eventSystemFlags:E,nativeEvent:C,targetContainers:[T]},a!==null&&(a=no(a),a!==null&&By(a)),s):(s.eventSystemFlags|=E,a=s.targetContainers,T!==null&&a.indexOf(T)===-1&&a.push(T),s)}function Gy(s,a,u,E,T){switch(a){case"focusin":return Pa=Fl(Pa,s,a,u,E,T),!0;case"dragenter":return Vc=Fl(Vc,s,a,u,E,T),!0;case"mouseover":return Bc=Fl(Bc,s,a,u,E,T),!0;case"pointerover":var C=T.pointerId;return Hh.set(C,Fl(Hh.get(C)||null,s,a,u,E,T)),!0;case"gotpointercapture":return C=T.pointerId,Wh.set(C,Fl(Wh.get(C)||null,s,a,u,E,T)),!0}return!1}function At(s){var a=ac(s.target);if(a!==null){var u=Nt(a);if(u!==null){if(a=u.tag,a===13){if(a=Yt(u),a!==null){s.blockedOn=a,oT(s.priority,function(){if(u.tag===13){var E=ns(),T=Ds(u,E);T!==null&&Vr(T,u,E),Og(u,E)}});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){s.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}s.blockedOn=null}function _m(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var u=Ng(s.nativeEvent);if(u===null){u=s.nativeEvent;var E=new u.constructor(u.type,u);JE=E,u.target.dispatchEvent(E),JE=null}else return a=no(u),a!==null&&By(a),s.blockedOn=u,!1;a.shift()}return!0}function Hy(s,a,u){_m(s)&&u.delete(a)}function cw(){Em=!1,Pa!==null&&_m(Pa)&&(Pa=null),Vc!==null&&_m(Vc)&&(Vc=null),Bc!==null&&_m(Bc)&&(Bc=null),Hh.forEach(Hy),Wh.forEach(Hy)}function gm(s,a){s.blockedOn===a&&(s.blockedOn=null,Em||(Em=!0,d.unstable_scheduleCallback(d.unstable_NormalPriority,cw)))}var Sm=null;function Tm(s){Sm!==s&&(Sm=s,d.unstable_scheduleCallback(d.unstable_NormalPriority,function(){Sm===s&&(Sm=null);for(var a=0;a<s.length;a+=3){var u=s[a],E=s[a+1],T=s[a+2];if(typeof E!="function"){if(mm(E||u)===null)continue;break}var C=no(u);C!==null&&(s.splice(a,3),a-=3,yl(C,{pending:!0,data:T,method:u.method,action:E},E,T))}}))}function Kh(s){function a(nt){return gm(nt,s)}Pa!==null&&gm(Pa,s),Vc!==null&&gm(Vc,s),Bc!==null&&gm(Bc,s),Hh.forEach(a),Wh.forEach(a);for(var u=0;u<jc.length;u++){var E=jc[u];E.blockedOn===s&&(E.blockedOn=null)}for(;0<jc.length&&(u=jc[0],u.blockedOn===null);)At(u),u.blockedOn===null&&jc.shift();if(u=(s.ownerDocument||s).$$reactFormReplay,u!=null)for(E=0;E<u.length;E+=3){var T=u[E],C=u[E+1],B=T[Jr]||null;if(typeof C=="function")B||Tm(u);else if(B){var K=null;if(C&&C.hasAttribute("formAction")){if(T=C,B=C[Jr]||null)K=B.formAction;else if(mm(T)!==null)continue}else K=B.action;typeof K=="function"?u[E+1]=K:(u.splice(E,3),E-=3),Tm(u)}}}function Pg(s){this._internalRoot=s}hr.prototype.render=Pg.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(g(409));var u=a.current,E=ns();Uy(u,E,s,a,null,null)},hr.prototype.unmount=Pg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;s.tag===0&&Ml(),Uy(s.current,2,null,s,null,null),Nh(),a[hl]=null}};function hr(s){this._internalRoot=s}hr.prototype.unstable_scheduleHydration=function(s){if(s){var a=WE();s={blockedOn:null,target:s,priority:a};for(var u=0;u<jc.length&&a!==0&&a<jc[u].priority;u++);jc.splice(u,0,s),u===0&&At(s)}};var Wy=f.version;if(Wy!=="19.0.0")throw Error(g(527,Wy,"19.0.0"));zt.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(g(188)):(s=Object.keys(s).join(","),Error(g(268,s)));return s=xt(a),s=s!==null?Qt(s):null,s=s===null?null:s.stateNode,s};var lw={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:Jt,findFiberByHostInstance:ac,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vm.isDisabled&&vm.supportsFiber)try{Oo=vm.inject(lw),oi=vm}catch{}}return GS.createRoot=function(s,a){if(!R(s))throw Error(g(299));var u=!1,E="",T=Lv,C=L_,B=kv,K=null;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(E=a.identifierPrefix),a.onUncaughtError!==void 0&&(T=a.onUncaughtError),a.onCaughtError!==void 0&&(C=a.onCaughtError),a.onRecoverableError!==void 0&&(B=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(K=a.unstable_transitionCallbacks)),a=xy(s,1,!1,null,null,u,E,T,C,B,K,null),s[hl]=a.current,Ul(s.nodeType===8?s.parentNode:s),new Pg(a)},GS.hydrateRoot=function(s,a,u){if(!R(s))throw Error(g(299));var E=!1,T="",C=Lv,B=L_,K=kv,nt=null,ut=null;return u!=null&&(u.unstable_strictMode===!0&&(E=!0),u.identifierPrefix!==void 0&&(T=u.identifierPrefix),u.onUncaughtError!==void 0&&(C=u.onUncaughtError),u.onCaughtError!==void 0&&(B=u.onCaughtError),u.onRecoverableError!==void 0&&(K=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(nt=u.unstable_transitionCallbacks),u.formState!==void 0&&(ut=u.formState)),a=xy(s,1,!0,a,u??null,E,T,C,B,K,nt,ut),a.context=pm(null),u=a.current,E=ns(),T=bc(E),T.callback=null,Cc(u,T,E),a.current.lanes=E,Zn(a,E),Yo(a),s[hl]=a.current,Ul(s),new hr(a)},GS.version="19.0.0",GS}var Bj;function X7(){if(Bj)return BO.exports;Bj=1;function d(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(d)}catch(f){console.error(f)}}return d(),BO.exports=q7(),BO.exports}var J7=X7();function jj(d,f){if(typeof d=="function")return d(f);d!=null&&(d.current=f)}function qF(...d){return f=>{let _=!1;const g=d.map(R=>{const w=jj(R,f);return!_&&typeof w=="function"&&(_=!0),w});if(_)return()=>{for(let R=0;R<g.length;R++){const w=g[R];typeof w=="function"?w():jj(d[R],null)}}}}function zr(...d){return Z.useCallback(qF(...d),d)}var PE=Z.forwardRef((d,f)=>{const{children:_,...g}=d,R=Z.Children.toArray(_),w=R.find(Z7);if(w){const N=w.props.children,L=R.map(V=>V===w?Z.Children.count(N)>1?Z.Children.only(null):Z.isValidElement(N)?N.props.children:null:V);return Rt.jsx(dN,{...g,ref:f,children:Z.isValidElement(N)?Z.cloneElement(N,void 0,L):null})}return Rt.jsx(dN,{...g,ref:f,children:_})});PE.displayName="Slot";var dN=Z.forwardRef((d,f)=>{const{children:_,...g}=d;if(Z.isValidElement(_)){const R=t9(_),w=$7(g,_.props);return _.type!==Z.Fragment&&(w.ref=f?qF(f,R):R),Z.cloneElement(_,w)}return Z.Children.count(_)>1?Z.Children.only(null):null});dN.displayName="SlotClone";var Q7=({children:d})=>Rt.jsx(Rt.Fragment,{children:d});function Z7(d){return Z.isValidElement(d)&&d.type===Q7}function $7(d,f){const _={...f};for(const g in f){const R=d[g],w=f[g];/^on[A-Z]/.test(g)?R&&w?_[g]=(...L)=>{w(...L),R(...L)}:R&&(_[g]=R):g==="style"?_[g]={...R,...w}:g==="className"&&(_[g]=[R,w].filter(Boolean).join(" "))}return{...d,..._}}function t9(d){var g,R;let f=(g=Object.getOwnPropertyDescriptor(d.props,"ref"))==null?void 0:g.get,_=f&&"isReactWarning"in f&&f.isReactWarning;return _?d.ref:(f=(R=Object.getOwnPropertyDescriptor(d,"ref"))==null?void 0:R.get,_=f&&"isReactWarning"in f&&f.isReactWarning,_?d.props.ref:d.props.ref||d.ref)}function XF(d){var f,_,g="";if(typeof d=="string"||typeof d=="number")g+=d;else if(typeof d=="object")if(Array.isArray(d)){var R=d.length;for(f=0;f<R;f++)d[f]&&(_=XF(d[f]))&&(g&&(g+=" "),g+=_)}else for(_ in d)d[_]&&(g&&(g+=" "),g+=_);return g}function JF(){for(var d,f,_=0,g="",R=arguments.length;_<R;_++)(d=arguments[_])&&(f=XF(d))&&(g&&(g+=" "),g+=f);return g}const Fj=d=>typeof d=="boolean"?`${d}`:d===0?"0":d,Gj=JF,QF=(d,f)=>_=>{var g;if((f==null?void 0:f.variants)==null)return Gj(d,_==null?void 0:_.class,_==null?void 0:_.className);const{variants:R,defaultVariants:w}=f,N=Object.keys(R).map(x=>{const G=_==null?void 0:_[x],Y=w==null?void 0:w[x];if(G===null)return null;const et=Fj(G)||Fj(Y);return R[x][et]}),L=_&&Object.entries(_).reduce((x,G)=>{let[Y,et]=G;return et===void 0||(x[Y]=et),x},{}),V=f==null||(g=f.compoundVariants)===null||g===void 0?void 0:g.reduce((x,G)=>{let{class:Y,className:et,...z}=G;return Object.entries(z).every(J=>{let[X,tt]=J;return Array.isArray(tt)?tt.includes({...w,...L}[X]):{...w,...L}[X]===tt})?[...x,Y,et]:x},[]);return Gj(d,N,V,_==null?void 0:_.class,_==null?void 0:_.className)},FN="-",e9=d=>{const f=i9(d),{conflictingClassGroups:_,conflictingClassGroupModifiers:g}=d;return{getClassGroupId:N=>{const L=N.split(FN);return L[0]===""&&L.length!==1&&L.shift(),ZF(L,f)||n9(N)},getConflictingClassGroupIds:(N,L)=>{const V=_[N]||[];return L&&g[N]?[...V,...g[N]]:V}}},ZF=(d,f)=>{var N;if(d.length===0)return f.classGroupId;const _=d[0],g=f.nextPart.get(_),R=g?ZF(d.slice(1),g):void 0;if(R)return R;if(f.validators.length===0)return;const w=d.join(FN);return(N=f.validators.find(({validator:L})=>L(w)))==null?void 0:N.classGroupId},Hj=/^\[(.+)\]$/,n9=d=>{if(Hj.test(d)){const f=Hj.exec(d)[1],_=f==null?void 0:f.substring(0,f.indexOf(":"));if(_)return"arbitrary.."+_}},i9=d=>{const{theme:f,classGroups:_}=d,g={nextPart:new Map,validators:[]};for(const R in _)uN(_[R],g,R,f);return g},uN=(d,f,_,g)=>{d.forEach(R=>{if(typeof R=="string"){const w=R===""?f:Wj(f,R);w.classGroupId=_;return}if(typeof R=="function"){if(r9(R)){uN(R(g),f,_,g);return}f.validators.push({validator:R,classGroupId:_});return}Object.entries(R).forEach(([w,N])=>{uN(N,Wj(f,w),_,g)})})},Wj=(d,f)=>{let _=d;return f.split(FN).forEach(g=>{_.nextPart.has(g)||_.nextPart.set(g,{nextPart:new Map,validators:[]}),_=_.nextPart.get(g)}),_},r9=d=>d.isThemeGetter,s9=d=>{if(d<1)return{get:()=>{},set:()=>{}};let f=0,_=new Map,g=new Map;const R=(w,N)=>{_.set(w,N),f++,f>d&&(f=0,g=_,_=new Map)};return{get(w){let N=_.get(w);if(N!==void 0)return N;if((N=g.get(w))!==void 0)return R(w,N),N},set(w,N){_.has(w)?_.set(w,N):R(w,N)}}},hN="!",pN=":",o9=pN.length,a9=d=>{const{prefix:f,experimentalParseClassName:_}=d;let g=R=>{const w=[];let N=0,L=0,V=0,x;for(let J=0;J<R.length;J++){let X=R[J];if(N===0&&L===0){if(X===pN){w.push(R.slice(V,J)),V=J+o9;continue}if(X==="/"){x=J;continue}}X==="["?N++:X==="]"?N--:X==="("?L++:X===")"&&L--}const G=w.length===0?R:R.substring(V),Y=c9(G),et=Y!==G,z=x&&x>V?x-V:void 0;return{modifiers:w,hasImportantModifier:et,baseClassName:Y,maybePostfixModifierPosition:z}};if(f){const R=f+pN,w=g;g=N=>N.startsWith(R)?w(N.substring(R.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:N,maybePostfixModifierPosition:void 0}}if(_){const R=g;g=w=>_({className:w,parseClassName:R})}return g},c9=d=>d.endsWith(hN)?d.substring(0,d.length-1):d.startsWith(hN)?d.substring(1):d,l9=d=>{const f=Object.fromEntries(d.orderSensitiveModifiers.map(g=>[g,!0]));return g=>{if(g.length<=1)return g;const R=[];let w=[];return g.forEach(N=>{N[0]==="["||f[N]?(R.push(...w.sort(),N),w=[]):w.push(N)}),R.push(...w.sort()),R}},d9=d=>({cache:s9(d.cacheSize),parseClassName:a9(d),sortModifiers:l9(d),...e9(d)}),u9=/\s+/,h9=(d,f)=>{const{parseClassName:_,getClassGroupId:g,getConflictingClassGroupIds:R,sortModifiers:w}=f,N=[],L=d.trim().split(u9);let V="";for(let x=L.length-1;x>=0;x-=1){const G=L[x],{isExternal:Y,modifiers:et,hasImportantModifier:z,baseClassName:J,maybePostfixModifierPosition:X}=_(G);if(Y){V=G+(V.length>0?" "+V:V);continue}let tt=!!X,dt=g(tt?J.substring(0,X):J);if(!dt){if(!tt){V=G+(V.length>0?" "+V:V);continue}if(dt=g(J),!dt){V=G+(V.length>0?" "+V:V);continue}tt=!1}const pt=w(et).join(":"),ot=z?pt+hN:pt,bt=ot+dt;if(N.includes(bt))continue;N.push(bt);const St=R(dt,tt);for(let Ft=0;Ft<St.length;++Ft){const Bt=St[Ft];N.push(ot+Bt)}V=G+(V.length>0?" "+V:V)}return V};function p9(){let d=0,f,_,g="";for(;d<arguments.length;)(f=arguments[d++])&&(_=$F(f))&&(g&&(g+=" "),g+=_);return g}const $F=d=>{if(typeof d=="string")return d;let f,_="";for(let g=0;g<d.length;g++)d[g]&&(f=$F(d[g]))&&(_&&(_+=" "),_+=f);return _};function f9(d,...f){let _,g,R,w=N;function N(V){const x=f.reduce((G,Y)=>Y(G),d());return _=d9(x),g=_.cache.get,R=_.cache.set,w=L,L(V)}function L(V){const x=g(V);if(x)return x;const G=h9(V,_);return R(V,G),G}return function(){return w(p9.apply(null,arguments))}}const Nr=d=>{const f=_=>_[d]||[];return f.isThemeGetter=!0,f},t3=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,e3=/^\((?:(\w[\w-]*):)?(.+)\)$/i,m9=/^\d+\/\d+$/,E9=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,_9=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,g9=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,S9=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,T9=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,CE=d=>m9.test(d),bn=d=>!!d&&!Number.isNaN(Number(d)),wp=d=>!!d&&Number.isInteger(Number(d)),Kj=d=>d.endsWith("%")&&bn(d.slice(0,-1)),Au=d=>E9.test(d),v9=()=>!0,y9=d=>_9.test(d)&&!g9.test(d),GN=()=>!1,R9=d=>S9.test(d),b9=d=>T9.test(d),C9=d=>!fe(d)&&!me(d),A9=d=>ME(d,r3,GN),fe=d=>t3.test(d),Ip=d=>ME(d,s3,y9),HO=d=>ME(d,U9,bn),w9=d=>ME(d,n3,GN),I9=d=>ME(d,i3,b9),O9=d=>ME(d,GN,R9),me=d=>e3.test(d),oC=d=>xE(d,s3),N9=d=>xE(d,V9),D9=d=>xE(d,n3),P9=d=>xE(d,r3),L9=d=>xE(d,i3),k9=d=>xE(d,B9,!0),ME=(d,f,_)=>{const g=t3.exec(d);return g?g[1]?f(g[1]):_(g[2]):!1},xE=(d,f,_=!1)=>{const g=e3.exec(d);return g?g[1]?f(g[1]):_:!1},n3=d=>d==="position",M9=new Set(["image","url"]),i3=d=>M9.has(d),x9=new Set(["length","size","percentage"]),r3=d=>x9.has(d),s3=d=>d==="length",U9=d=>d==="number",V9=d=>d==="family-name",B9=d=>d==="shadow",j9=()=>{const d=Nr("color"),f=Nr("font"),_=Nr("text"),g=Nr("font-weight"),R=Nr("tracking"),w=Nr("leading"),N=Nr("breakpoint"),L=Nr("container"),V=Nr("spacing"),x=Nr("radius"),G=Nr("shadow"),Y=Nr("inset-shadow"),et=Nr("drop-shadow"),z=Nr("blur"),J=Nr("perspective"),X=Nr("aspect"),tt=Nr("ease"),dt=Nr("animate"),pt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ot=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],bt=()=>["auto","hidden","clip","visible","scroll"],St=()=>["auto","contain","none"],Ft=()=>[CE,"px","full","auto",me,fe,V],Bt=()=>[wp,"none","subgrid",me,fe],se=()=>["auto",{span:["full",wp,me,fe]},me,fe],Jt=()=>[wp,"auto",me,fe],ae=()=>["auto","min","max","fr",me,fe],we=()=>[me,fe,V],de=()=>["start","end","center","between","around","evenly","stretch","baseline"],Re=()=>["start","end","center","stretch"],Zt=()=>[me,fe,V],Ae=()=>["px",...Zt()],It=()=>["px","auto",...Zt()],Gt=()=>[CE,"auto","px","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",me,fe,V],Nt=()=>[d,me,fe],Yt=()=>[Kj,Ip],st=()=>["","none","full",x,me,fe],xt=()=>["",bn,oC,Ip],Qt=()=>["solid","dashed","dotted","double"],ee=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],zt=()=>["","none",z,me,fe],ve=()=>["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",me,fe],ye=()=>["none",bn,me,fe],te=()=>["none",bn,me,fe],_e=()=>[bn,me,fe],Le=()=>[CE,"full","px",me,fe,V];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Au],breakpoint:[Au],color:[v9],container:[Au],"drop-shadow":[Au],ease:["in","out","in-out"],font:[C9],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Au],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Au],shadow:[Au],spacing:[bn],text:[Au],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",CE,fe,me,X]}],container:["container"],columns:[{columns:[bn,fe,me,L]}],"break-after":[{"break-after":pt()}],"break-before":[{"break-before":pt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ot(),fe,me]}],overflow:[{overflow:bt()}],"overflow-x":[{"overflow-x":bt()}],"overflow-y":[{"overflow-y":bt()}],overscroll:[{overscroll:St()}],"overscroll-x":[{"overscroll-x":St()}],"overscroll-y":[{"overscroll-y":St()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Ft()}],"inset-x":[{"inset-x":Ft()}],"inset-y":[{"inset-y":Ft()}],start:[{start:Ft()}],end:[{end:Ft()}],top:[{top:Ft()}],right:[{right:Ft()}],bottom:[{bottom:Ft()}],left:[{left:Ft()}],visibility:["visible","invisible","collapse"],z:[{z:[wp,"auto",me,fe]}],basis:[{basis:[CE,"full","auto",me,fe,L,V]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[bn,CE,"auto","initial","none",fe]}],grow:[{grow:["",bn,me,fe]}],shrink:[{shrink:["",bn,me,fe]}],order:[{order:[wp,"first","last","none",me,fe]}],"grid-cols":[{"grid-cols":Bt()}],"col-start-end":[{col:se()}],"col-start":[{"col-start":Jt()}],"col-end":[{"col-end":Jt()}],"grid-rows":[{"grid-rows":Bt()}],"row-start-end":[{row:se()}],"row-start":[{"row-start":Jt()}],"row-end":[{"row-end":Jt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":ae()}],"auto-rows":[{"auto-rows":ae()}],gap:[{gap:we()}],"gap-x":[{"gap-x":we()}],"gap-y":[{"gap-y":we()}],"justify-content":[{justify:[...de(),"normal"]}],"justify-items":[{"justify-items":[...Re(),"normal"]}],"justify-self":[{"justify-self":["auto",...Re()]}],"align-content":[{content:["normal",...de()]}],"align-items":[{items:[...Re(),"baseline"]}],"align-self":[{self:["auto",...Re(),"baseline"]}],"place-content":[{"place-content":de()}],"place-items":[{"place-items":[...Re(),"baseline"]}],"place-self":[{"place-self":["auto",...Re()]}],p:[{p:Ae()}],px:[{px:Ae()}],py:[{py:Ae()}],ps:[{ps:Ae()}],pe:[{pe:Ae()}],pt:[{pt:Ae()}],pr:[{pr:Ae()}],pb:[{pb:Ae()}],pl:[{pl:Ae()}],m:[{m:It()}],mx:[{mx:It()}],my:[{my:It()}],ms:[{ms:It()}],me:[{me:It()}],mt:[{mt:It()}],mr:[{mr:It()}],mb:[{mb:It()}],ml:[{ml:It()}],"space-x":[{"space-x":Zt()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Zt()}],"space-y-reverse":["space-y-reverse"],size:[{size:Gt()}],w:[{w:[L,"screen",...Gt()]}],"min-w":[{"min-w":[L,"screen","none",...Gt()]}],"max-w":[{"max-w":[L,"screen","none","prose",{screen:[N]},...Gt()]}],h:[{h:["screen",...Gt()]}],"min-h":[{"min-h":["screen","none",...Gt()]}],"max-h":[{"max-h":["screen",...Gt()]}],"font-size":[{text:["base",_,oC,Ip]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[g,me,HO]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Kj,fe]}],"font-family":[{font:[N9,fe,f]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[R,me,fe]}],"line-clamp":[{"line-clamp":[bn,"none",me,HO]}],leading:[{leading:[me,fe,w,V]}],"list-image":[{"list-image":["none",me,fe]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",me,fe]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Nt()}],"text-color":[{text:Nt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Qt(),"wavy"]}],"text-decoration-thickness":[{decoration:[bn,"from-font","auto",me,Ip]}],"text-decoration-color":[{decoration:Nt()}],"underline-offset":[{"underline-offset":[bn,"auto",me,fe]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:["px",...Zt()]}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",me,fe]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",me,fe]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ot(),D9,w9]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:["auto","cover","contain",P9,A9]}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},wp,me,fe],radial:["",me,fe],conic:[wp,me,fe]},L9,I9]}],"bg-color":[{bg:Nt()}],"gradient-from-pos":[{from:Yt()}],"gradient-via-pos":[{via:Yt()}],"gradient-to-pos":[{to:Yt()}],"gradient-from":[{from:Nt()}],"gradient-via":[{via:Nt()}],"gradient-to":[{to:Nt()}],rounded:[{rounded:st()}],"rounded-s":[{"rounded-s":st()}],"rounded-e":[{"rounded-e":st()}],"rounded-t":[{"rounded-t":st()}],"rounded-r":[{"rounded-r":st()}],"rounded-b":[{"rounded-b":st()}],"rounded-l":[{"rounded-l":st()}],"rounded-ss":[{"rounded-ss":st()}],"rounded-se":[{"rounded-se":st()}],"rounded-ee":[{"rounded-ee":st()}],"rounded-es":[{"rounded-es":st()}],"rounded-tl":[{"rounded-tl":st()}],"rounded-tr":[{"rounded-tr":st()}],"rounded-br":[{"rounded-br":st()}],"rounded-bl":[{"rounded-bl":st()}],"border-w":[{border:xt()}],"border-w-x":[{"border-x":xt()}],"border-w-y":[{"border-y":xt()}],"border-w-s":[{"border-s":xt()}],"border-w-e":[{"border-e":xt()}],"border-w-t":[{"border-t":xt()}],"border-w-r":[{"border-r":xt()}],"border-w-b":[{"border-b":xt()}],"border-w-l":[{"border-l":xt()}],"divide-x":[{"divide-x":xt()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":xt()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Qt(),"hidden","none"]}],"divide-style":[{divide:[...Qt(),"hidden","none"]}],"border-color":[{border:Nt()}],"border-color-x":[{"border-x":Nt()}],"border-color-y":[{"border-y":Nt()}],"border-color-s":[{"border-s":Nt()}],"border-color-e":[{"border-e":Nt()}],"border-color-t":[{"border-t":Nt()}],"border-color-r":[{"border-r":Nt()}],"border-color-b":[{"border-b":Nt()}],"border-color-l":[{"border-l":Nt()}],"divide-color":[{divide:Nt()}],"outline-style":[{outline:[...Qt(),"none","hidden"]}],"outline-offset":[{"outline-offset":[bn,me,fe]}],"outline-w":[{outline:["",bn,oC,Ip]}],"outline-color":[{outline:[d]}],shadow:[{shadow:["","none",G,k9,O9]}],"shadow-color":[{shadow:Nt()}],"inset-shadow":[{"inset-shadow":["none",me,fe,Y]}],"inset-shadow-color":[{"inset-shadow":Nt()}],"ring-w":[{ring:xt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Nt()}],"ring-offset-w":[{"ring-offset":[bn,Ip]}],"ring-offset-color":[{"ring-offset":Nt()}],"inset-ring-w":[{"inset-ring":xt()}],"inset-ring-color":[{"inset-ring":Nt()}],opacity:[{opacity:[bn,me,fe]}],"mix-blend":[{"mix-blend":[...ee(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ee()}],filter:[{filter:["","none",me,fe]}],blur:[{blur:zt()}],brightness:[{brightness:[bn,me,fe]}],contrast:[{contrast:[bn,me,fe]}],"drop-shadow":[{"drop-shadow":["","none",et,me,fe]}],grayscale:[{grayscale:["",bn,me,fe]}],"hue-rotate":[{"hue-rotate":[bn,me,fe]}],invert:[{invert:["",bn,me,fe]}],saturate:[{saturate:[bn,me,fe]}],sepia:[{sepia:["",bn,me,fe]}],"backdrop-filter":[{"backdrop-filter":["","none",me,fe]}],"backdrop-blur":[{"backdrop-blur":zt()}],"backdrop-brightness":[{"backdrop-brightness":[bn,me,fe]}],"backdrop-contrast":[{"backdrop-contrast":[bn,me,fe]}],"backdrop-grayscale":[{"backdrop-grayscale":["",bn,me,fe]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[bn,me,fe]}],"backdrop-invert":[{"backdrop-invert":["",bn,me,fe]}],"backdrop-opacity":[{"backdrop-opacity":[bn,me,fe]}],"backdrop-saturate":[{"backdrop-saturate":[bn,me,fe]}],"backdrop-sepia":[{"backdrop-sepia":["",bn,me,fe]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Zt()}],"border-spacing-x":[{"border-spacing-x":Zt()}],"border-spacing-y":[{"border-spacing-y":Zt()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",me,fe]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[bn,"initial",me,fe]}],ease:[{ease:["linear","initial",tt,me,fe]}],delay:[{delay:[bn,me,fe]}],animate:[{animate:["none",dt,me,fe]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[J,me,fe]}],"perspective-origin":[{"perspective-origin":ve()}],rotate:[{rotate:ye()}],"rotate-x":[{"rotate-x":ye()}],"rotate-y":[{"rotate-y":ye()}],"rotate-z":[{"rotate-z":ye()}],scale:[{scale:te()}],"scale-x":[{"scale-x":te()}],"scale-y":[{"scale-y":te()}],"scale-z":[{"scale-z":te()}],"scale-3d":["scale-3d"],skew:[{skew:_e()}],"skew-x":[{"skew-x":_e()}],"skew-y":[{"skew-y":_e()}],transform:[{transform:[me,fe,"","none","gpu","cpu"]}],"transform-origin":[{origin:ve()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Le()}],"translate-x":[{"translate-x":Le()}],"translate-y":[{"translate-y":Le()}],"translate-z":[{"translate-z":Le()}],"translate-none":["translate-none"],accent:[{accent:Nt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Nt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",me,fe]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Zt()}],"scroll-mx":[{"scroll-mx":Zt()}],"scroll-my":[{"scroll-my":Zt()}],"scroll-ms":[{"scroll-ms":Zt()}],"scroll-me":[{"scroll-me":Zt()}],"scroll-mt":[{"scroll-mt":Zt()}],"scroll-mr":[{"scroll-mr":Zt()}],"scroll-mb":[{"scroll-mb":Zt()}],"scroll-ml":[{"scroll-ml":Zt()}],"scroll-p":[{"scroll-p":Zt()}],"scroll-px":[{"scroll-px":Zt()}],"scroll-py":[{"scroll-py":Zt()}],"scroll-ps":[{"scroll-ps":Zt()}],"scroll-pe":[{"scroll-pe":Zt()}],"scroll-pt":[{"scroll-pt":Zt()}],"scroll-pr":[{"scroll-pr":Zt()}],"scroll-pb":[{"scroll-pb":Zt()}],"scroll-pl":[{"scroll-pl":Zt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",me,fe]}],fill:[{fill:["none",...Nt()]}],"stroke-w":[{stroke:[bn,oC,Ip,HO]}],stroke:[{stroke:["none",...Nt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["before","after","placeholder","file","marker","selection","first-line","first-letter","backdrop","*","**"]}},F9=f9(j9);function Dr(...d){return F9(JF(d))}const G9=QF("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),XS=Z.forwardRef(({className:d,variant:f,size:_,asChild:g=!1,...R},w)=>{const N=g?PE:"button";return Rt.jsx(N,{className:Dr(G9({variant:f,size:_,className:d})),ref:w,...R})});XS.displayName="Button";const o3=Z.forwardRef(({className:d,...f},_)=>Rt.jsx("div",{ref:_,className:Dr("rounded-xl border bg-card text-card-foreground shadow",d),...f}));o3.displayName="Card";const a3=Z.forwardRef(({className:d,...f},_)=>Rt.jsx("div",{ref:_,className:Dr("flex flex-col space-y-1.5 p-6",d),...f}));a3.displayName="CardHeader";const c3=Z.forwardRef(({className:d,...f},_)=>Rt.jsx("div",{ref:_,className:Dr("font-semibold leading-none tracking-tight",d),...f}));c3.displayName="CardTitle";const l3=Z.forwardRef(({className:d,...f},_)=>Rt.jsx("div",{ref:_,className:Dr("text-sm text-muted-foreground",d),...f}));l3.displayName="CardDescription";const d3=Z.forwardRef(({className:d,...f},_)=>Rt.jsx("div",{ref:_,className:Dr("p-6 pt-0",d),...f}));d3.displayName="CardContent";const u3=Z.forwardRef(({className:d,...f},_)=>Rt.jsx("div",{ref:_,className:Dr("flex items-center p-6 pt-0",d),...f}));u3.displayName="CardFooter";const h3=Z.forwardRef(({className:d,type:f,..._},g)=>Rt.jsx("input",{type:f,className:Dr("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",d),ref:g,..._}));h3.displayName="Input";var eT=YF();const p3=jN(eT);var H9=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],tr=H9.reduce((d,f)=>{const _=Z.forwardRef((g,R)=>{const{asChild:w,...N}=g,L=w?PE:f;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),Rt.jsx(L,{...N,ref:R})});return _.displayName=`Primitive.${f}`,{...d,[f]:_}},{});function W9(d,f){d&&eT.flushSync(()=>d.dispatchEvent(f))}var K9="Label",f3=Z.forwardRef((d,f)=>Rt.jsx(tr.label,{...d,ref:f,onMouseDown:_=>{var R;_.target.closest("button, input, select, textarea")||((R=d.onMouseDown)==null||R.call(d,_),!_.defaultPrevented&&_.detail>1&&_.preventDefault())}}));f3.displayName=K9;var m3=f3;const z9=QF("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),E3=Z.forwardRef(({className:d,...f},_)=>Rt.jsx(m3,{ref:_,className:Dr(z9(),d),...f}));E3.displayName=m3.displayName;var fC={exports:{}},Y9=fC.exports,zj;function q9(){return zj||(zj=1,function(d,f){(function(_,g){d.exports=g()})(Y9,function(){function _(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof xO<"u"?xO:typeof self<"u"?self:{};function R(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var w=function(t){try{return!!t()}catch{return!0}},N=!w(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),L=N,V=Function.prototype,x=V.call,G=L&&V.bind.bind(x,x),Y=L?G:function(t){return function(){return x.apply(t,arguments)}},et=Y({}.isPrototypeOf),z=function(t){return t&&t.Math===Math&&t},J=z(typeof globalThis=="object"&&globalThis)||z(typeof window=="object"&&window)||z(typeof self=="object"&&self)||z(typeof g=="object"&&g)||z(typeof g=="object"&&g)||function(){return this}()||Function("return this")(),X=N,tt=Function.prototype,dt=tt.apply,pt=tt.call,ot=typeof Reflect=="object"&&Reflect.apply||(X?pt.bind(dt):function(){return pt.apply(dt,arguments)}),bt=Y,St=bt({}.toString),Ft=bt("".slice),Bt=function(t){return Ft(St(t),8,-1)},se=Bt,Jt=Y,ae=function(t){if(se(t)==="Function")return Jt(t)},we=typeof document=="object"&&document.all,de=we===void 0&&we!==void 0?function(t){return typeof t=="function"||t===we}:function(t){return typeof t=="function"},Re={},Zt=!w(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Ae=N,It=Function.prototype.call,Gt=Ae?It.bind(It):function(){return It.apply(It,arguments)},Nt={},Yt={}.propertyIsEnumerable,st=Object.getOwnPropertyDescriptor,xt=st&&!Yt.call({1:2},1);Nt.f=xt?function(t){var e=st(this,t);return!!e&&e.enumerable}:Yt;var Qt,ee,zt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ve=w,ye=Bt,te=Object,_e=Y("".split),Le=ve(function(){return!te("z").propertyIsEnumerable(0)})?function(t){return ye(t)==="String"?_e(t,""):te(t)}:te,Se=function(t){return t==null},ze=Se,ln=TypeError,Pn=function(t){if(ze(t))throw new ln("Can't call method on "+t);return t},cr=Le,ws=Pn,Ii=function(t){return cr(ws(t))},to=de,pi=function(t){return typeof t=="object"?t!==null:to(t)},Oi={},nc=Oi,eo=J,Up=de,Io=function(t){return Up(t)?t:void 0},Wn=function(t,e){return arguments.length<2?Io(nc[t])||Io(eo[t]):nc[t]&&nc[t][e]||eo[t]&&eo[t][e]},Vp=J.navigator,gr=Vp&&Vp.userAgent,lr=gr?String(gr):"",ul=J,xu=lr,ic=ul.process,Bp=ul.Deno,Uu=ic&&ic.versions||Bp&&Bp.version,Oo=Uu&&Uu.v8;Oo&&(ee=(Qt=Oo.split("."))[0]>0&&Qt[0]<4?1:+(Qt[0]+Qt[1])),!ee&&xu&&(!(Qt=xu.match(/Edge\/(\d+)/))||Qt[1]>=74)&&(Qt=xu.match(/Chrome\/(\d+)/))&&(ee=+Qt[1]);var oi=ee,Vu=oi,Pr=w,Lr=J.String,rc=!!Object.getOwnPropertySymbols&&!Pr(function(){var t=Symbol("symbol detection");return!Lr(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Vu&&Vu<41}),Bu=rc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",jp=Wn,hd=de,sc=et,Sr=Object,No=Bu?function(t){return typeof t=="symbol"}:function(t){var e=jp("Symbol");return hd(e)&&sc(e.prototype,Sr(t))},je=String,Tn=function(t){try{return je(t)}catch{return"Object"}},Qn=de,Yr=Tn,kr=TypeError,Zn=function(t){if(Qn(t))return t;throw new kr(Yr(t)+" is not a function")},ha=Zn,qr=Se,Xr=function(t,e){var n=t[e];return qr(n)?void 0:ha(n)},HE=Gt,WE=de,oT=pi,oc=TypeError,dr={exports:{}},Jr=!0,hl=J,KE=Object.defineProperty,ZC=J,$C=function(t,e){try{KE(hl,t,{value:e,configurable:!0,writable:!0})}catch{hl[t]=e}return e},zE="__core-js_shared__",pd=dr.exports=ZC[zE]||$C(zE,{});(pd.versions||(pd.versions=[])).push({version:"3.39.0",mode:"pure",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ju=dr.exports,ac=ju,no=function(t,e){return ac[t]||(ac[t]=e||{})},Fu=Pn,fd=Object,$n=function(t){return fd(Fu(t))},aT=$n,cT=Y({}.hasOwnProperty),ti=Object.hasOwn||function(t,e){return cT(aT(t),e)},md=Y,pa=0,tA=Math.random(),lT=md(1 .toString),Fp=function(t){return"Symbol("+(t===void 0?"":t)+")_"+lT(++pa+tA,36)},eA=no,Gu=ti,Gp=Fp,fa=rc,Is=Bu,pl=J.Symbol,YE=eA("wks"),Hp=Is?pl.for||pl:pl&&pl.withoutSetter||Gp,Fn=function(t){return Gu(YE,t)||(YE[t]=fa&&Gu(pl,t)?pl[t]:Hp("Symbol."+t)),YE[t]},Wp=Gt,dT=pi,ps=No,qE=Xr,uT=function(t,e){var n,i;if(WE(n=t.toString)&&!oT(i=HE(n,t))||WE(n=t.valueOf)&&!oT(i=HE(n,t)))return i;throw new oc("Can't convert object to primitive value")},XE=TypeError,Ed=Fn("toPrimitive"),hT=function(t,e){if(!dT(t)||ps(t))return t;var n,i=qE(t,Ed);if(i){if(n=Wp(i,t,e),!dT(n)||ps(n))return n;throw new XE("Can't convert object to primitive value")}return uT(t)},pT=No,cc=function(t){var e=hT(t,"string");return pT(e)?e:e+""},fT=pi,Kp=J.document,mT=fT(Kp)&&fT(Kp.createElement),Hu=function(t){return mT?Kp.createElement(t):{}},nA=Hu,ET=!Zt&&!w(function(){return Object.defineProperty(nA("div"),"a",{get:function(){return 7}}).a!==7}),zp=Zt,JE=Gt,QE=Nt,_d=zt,gd=Ii,_T=cc,ZE=ti,gT=ET,Sd=Object.getOwnPropertyDescriptor;Re.f=zp?Sd:function(t,e){if(t=gd(t),e=_T(e),gT)try{return Sd(t,e)}catch{}if(ZE(t,e))return _d(!JE(QE.f,t,e),t[e])};var $E=w,Wu=de,lc=/#|\.prototype\./,fl=function(t,e){var n=ST[Yp(t)];return n===Xp||n!==qp&&(Wu(e)?$E(e):!!e)},Yp=fl.normalize=function(t){return String(t).replace(lc,".").toLowerCase()},ST=fl.data={},qp=fl.NATIVE="N",Xp=fl.POLYFILL="P",t_=fl,Qr=Zn,ml=N,Jp=ae(ae.bind),Os=function(t,e){return Qr(t),e===void 0?t:ml?Jp(t,e):function(){return t.apply(e,arguments)}},Ns={},Qp=Zt&&w(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),e_=pi,Ku=String,Zp=TypeError,Tr=function(t){if(e_(t))return t;throw new Zp(Ku(t)+" is not an object")},iA=Zt,rA=ET,sA=Qp,Td=Tr,TT=cc,oA=TypeError,n_=Object.defineProperty,aA=Object.getOwnPropertyDescriptor,i_="enumerable",$p="configurable",r_="writable";Ns.f=iA?sA?function(t,e,n){if(Td(t),e=TT(e),Td(n),typeof t=="function"&&e==="prototype"&&"value"in n&&r_ in n&&!n[r_]){var i=aA(t,e);i&&i[r_]&&(t[e]=n.value,n={configurable:$p in n?n[$p]:i[$p],enumerable:i_ in n?n[i_]:i[i_],writable:!1})}return n_(t,e,n)}:n_:function(t,e,n){if(Td(t),e=TT(e),Td(n),rA)try{return n_(t,e,n)}catch{}if("get"in n||"set"in n)throw new oA("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var cA=Ns,lA=zt,El=Zt?function(t,e,n){return cA.f(t,e,lA(1,n))}:function(t,e,n){return t[e]=n,t},_l=J,dA=ot,uA=ae,hA=de,vT=Re.f,pA=t_,vd=Oi,fA=Os,yd=El,yT=ti,mA=function(t){var e=function(n,i,r){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,r)}return dA(t,this,arguments)};return e.prototype=t.prototype,e},qe=function(t,e){var n,i,r,o,c,l,h,p,m,S=t.target,v=t.global,y=t.stat,P=t.proto,I=v?_l:y?_l[S]:_l[S]&&_l[S].prototype,O=v?vd:vd[S]||yd(vd,S,{})[S],M=O.prototype;for(o in e)i=!(n=pA(v?o:S+(y?".":"#")+o,t.forced))&&I&&yT(I,o),l=O[o],i&&(h=t.dontCallGetSet?(m=vT(I,o))&&m.value:I[o]),c=i&&h?h:e[o],(n||P||typeof l!=typeof c)&&(p=t.bind&&i?fA(c,_l):t.wrap&&i?mA(c):P&&hA(c)?uA(c):c,(t.sham||c&&c.sham||l&&l.sham)&&yd(p,"sham",!0),yd(O,o,p),P&&(yT(vd,r=S+"Prototype")||yd(vd,r,{}),yd(vd[r],o,c),t.real&&M&&(n||!M[o])&&yd(M,o,c)))},EA=Math.ceil,_A=Math.floor,s_=Math.trunc||function(t){var e=+t;return(e>0?_A:EA)(e)},zu=s_,o_=function(t){var e=+t;return e!=e||e===0?0:zu(e)},RT=o_,bT=Math.max,CT=Math.min,tf=function(t,e){var n=RT(t);return n<0?bT(n+e,0):CT(n,e)},AT=o_,Rd=Math.min,wT=function(t){var e=AT(t);return e>0?Rd(e,9007199254740991):0},gA=wT,dc=function(t){return gA(t.length)},IT=Ii,OT=tf,Yu=dc,bd=function(t){return function(e,n,i){var r=IT(e),o=Yu(r);if(o===0)return!t&&-1;var c,l=OT(i,o);if(t&&n!=n){for(;o>l;)if((c=r[l++])!=c)return!0}else for(;o>l;l++)if((t||l in r)&&r[l]===n)return t||l||0;return!t&&-1}},a_={includes:bd(!0),indexOf:bd(!1)},ef=a_.includes;qe({target:"Array",proto:!0,forced:w(function(){return!Array(1).includes()})},{includes:function(t){return ef(this,t,arguments.length>1?arguments[1]:void 0)}});var NT=J,DT=Oi,Zr=function(t,e){var n=DT[t+"Prototype"],i=n&&n[e];if(i)return i;var r=NT[t],o=r&&r.prototype;return o&&o[e]},c_=Zr("Array","includes"),PT=pi,LT=Bt,kT=Fn("match"),MT=function(t){var e;return PT(t)&&((e=t[kT])!==void 0?!!e:LT(t)==="RegExp")},SA=MT,TA=TypeError,xT={};xT[Fn("toStringTag")]="z";var l_=String(xT)==="[object z]",fs=l_,qu=de,Xu=Bt,UT=Fn("toStringTag"),VT=Object,BT=Xu(function(){return arguments}())==="Arguments",io=fs?Xu:function(t){var e,n,i;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(r,o){try{return r[o]}catch{}}(e=VT(t),UT))=="string"?n:BT?Xu(e):(i=Xu(e))==="Object"&&qu(e.callee)?"Arguments":i},vA=io,yA=String,Yi=function(t){if(vA(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return yA(t)},d_=Fn("match"),Ju=qe,u_=function(t){if(SA(t))throw new TA("The method doesn't accept regular expressions");return t},jT=Pn,uc=Yi,Cd=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[d_]=!1,"/./"[t](e)}catch{}}return!1},h_=Y("".indexOf);Ju({target:"String",proto:!0,forced:!Cd("includes")},{includes:function(t){return!!~h_(uc(jT(this)),uc(u_(t)),arguments.length>1?arguments[1]:void 0)}});var FT=Zr("String","includes"),hc=et,GT=c_,HT=FT,nf=Array.prototype,p_=String.prototype,RA=function(t){var e=t.includes;return t===nf||hc(nf,t)&&e===nf.includes?GT:typeof t=="string"||t===p_||hc(p_,t)&&e===p_.includes?HT:e},Ct=R(RA),WT=Zn,KT=$n,zT=Le,ro=dc,ms=TypeError,gl="Reduce of empty array with no initial value",f_=function(t){return function(e,n,i,r){var o=KT(e),c=zT(o),l=ro(o);if(WT(n),l===0&&i<2)throw new ms(gl);var h=t?l-1:0,p=t?-1:1;if(i<2)for(;;){if(h in c){r=c[h],h+=p;break}if(h+=p,t?h<0:l<=h)throw new ms(gl)}for(;t?h>=0:l>h;h+=p)h in c&&(r=n(r,c[h],h,o));return r}},rf={left:f_(!1)},sf=w,Ad=function(t,e){var n=[][t];return!!n&&sf(function(){n.call(null,e||function(){return 1},1)})},Ds=J,YT=lr,of=Bt,ma=function(t){return YT.slice(0,t.length)===t},af=ma("Bun/")?"BUN":ma("Cloudflare-Workers")?"CLOUDFLARE":ma("Deno/")?"DENO":ma("Node.js/")?"NODE":Ds.Bun&&typeof Bun.version=="string"?"BUN":Ds.Deno&&typeof Deno.version=="object"?"DENO":of(Ds.process)==="process"?"NODE":Ds.window&&Ds.document?"BROWSER":"REST",Mr=af==="NODE",wd=rf.left;qe({target:"Array",proto:!0,forced:!Mr&&oi>79&&oi<83||!Ad("reduce")},{reduce:function(t){var e=arguments.length;return wd(this,t,e,e>1?arguments[1]:void 0)}});var Id=Zr("Array","reduce"),cf=et,lf=Id,$r=Array.prototype,Ps=function(t){var e=t.reduce;return t===$r||cf($r,t)&&e===$r.reduce?lf:e},pc=Ps,qi=R(pc),Ea=Bt,so=Array.isArray||function(t){return Ea(t)==="Array"},qT=qe,m_=so,E_=Y([].reverse),vr=[1,2];qT({target:"Array",proto:!0,forced:String(vr)===String(vr.reverse())},{reverse:function(){return m_(this)&&(this.length=this.length),E_(this)}});var ur=Zr("Array","reverse"),In=et,oo=ur,Ls=Array.prototype,__=function(t){var e=t.reverse;return t===Ls||In(Ls,t)&&e===Ls.reverse?oo:e},fc=__,g_=R(fc),XT=Fp,Od=no("keys"),mc=function(t){return Od[t]||(Od[t]=XT(t))},Qu=!w(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Zu=ti,JT=de,S_=$n,QT=Qu,$u=mc("IE_PROTO"),df=Object,th=df.prototype,uf=QT?df.getPrototypeOf:function(t){var e=S_(t);if(Zu(e,$u))return e[$u];var n=e.constructor;return JT(n)&&e instanceof n?n.prototype:e instanceof df?th:null},Nd=Y,eh=Zn,hf=pi,nh=function(t){return hf(t)||t===null},pf=String,ZT=TypeError,$T=function(t,e,n){try{return Nd(eh(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},Sl=pi,tv=Pn,Dd=function(t){if(nh(t))return t;throw new ZT("Can't set "+pf(t)+" as a prototype")},ff=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=$T(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(i,r){return tv(i),Dd(r),Sl(i)&&(e?t(i,r):i.__proto__=r),i}}():void 0),ih={},Pd={},rh=ti,ks=Ii,Do=a_.indexOf,Ec=Pd,T_=Y([].push),_a=function(t,e){var n,i=ks(t),r=0,o=[];for(n in i)!rh(Ec,n)&&rh(i,n)&&T_(o,n);for(;e.length>r;)rh(i,n=e[r++])&&(~Do(o,n)||T_(o,n));return o},ao=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Xi=_a,mf=ao.concat("length","prototype");ih.f=Object.getOwnPropertyNames||function(t){return Xi(t,mf)};var sh={};sh.f=Object.getOwnPropertySymbols;var bA=Wn,CA=ih,Ji=sh,v_=Tr,oh=Y([].concat),ah=bA("Reflect","ownKeys")||function(t){var e=CA.f(v_(t)),n=Ji.f;return n?oh(e,n(t)):e},Ef=ti,Ld=ah,kd=Re,AA=Ns,_f={},wA=_a,ev=ao,Po=Object.keys||function(t){return wA(t,ev)},y_=Zt,gf=Qp,nv=Ns,_c=Tr,on=Ii,Kn=Po;_f.f=y_&&!gf?Object.defineProperties:function(t,e){_c(t);for(var n,i=on(e),r=Kn(e),o=r.length,c=0;o>c;)nv.f(t,n=r[c++],i[n]);return t};var Ti,ch=Wn("document","documentElement"),Md=Tr,Tl=_f,lh=ao,dh=Pd,xd=ch,IA=Hu,vi="prototype",uh="script",Sf=mc("IE_PROTO"),Tf=function(){},R_=function(t){return"<"+uh+">"+t+"</"+uh+">"},iv=function(t){t.write(R_("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ud=function(){try{Ti=new ActiveXObject("htmlfile")}catch{}var t,e,n;Ud=typeof document<"u"?document.domain&&Ti?iv(Ti):(e=IA("iframe"),n="java"+uh+":",e.style.display="none",xd.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(R_("document.F=Object")),t.close(),t.F):iv(Ti);for(var i=lh.length;i--;)delete Ud[vi][lh[i]];return Ud()};dh[Sf]=!0;var vl=Object.create||function(t,e){var n;return t!==null?(Tf[vi]=Md(t),n=new Tf,Tf[vi]=null,n[Sf]=t):n=Ud(),e===void 0?n:Tl.f(n,e)},b_=pi,ts=El,ki=Error,vf=Y("".replace),hh=String(new ki("zxcasd").stack),ph=/\n\s*at [^:]*:[^\n]*/,C_=ph.test(hh),ga=zt,yf=!w(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",ga(1,7)),t.stack!==7)}),A_=El,w_=function(t,e){if(C_&&typeof t=="string"&&!ki.prepareStackTrace)for(;e--;)t=vf(t,ph,"");return t},rv=yf,I_=Error.captureStackTrace,gc={},sv=gc,ov=Fn("iterator"),av=Array.prototype,Rf=function(t){return t!==void 0&&(sv.Array===t||av[ov]===t)},cv=io,lv=Xr,dv=Se,uv=gc,hv=Fn("iterator"),Vd=function(t){if(!dv(t))return lv(t,hv)||lv(t,"@@iterator")||uv[cv(t)]},pv=Gt,fv=Zn,mv=Tr,Ev=Tn,_v=Vd,OA=TypeError,bf=function(t,e){var n=arguments.length<2?_v(t):e;if(fv(n))return mv(pv(n,t));throw new OA(Ev(t)+" is not iterable")},Bd=Gt,O_=Tr,Cf=Xr,fh=function(t,e,n){var i,r;O_(t);try{if(!(i=Cf(t,"return"))){if(e==="throw")throw n;return n}i=Bd(i,t)}catch(o){r=!0,i=o}if(e==="throw")throw n;if(r)throw i;return O_(i),n},gv=Os,N_=Gt,Sv=Tr,Tv=Tn,vv=Rf,yv=dc,Af=et,Rv=bf,bv=Vd,wf=fh,Cv=TypeError,mh=function(t,e){this.stopped=t,this.result=e},Av=mh.prototype,yl=function(t,e,n){var i,r,o,c,l,h,p,m=n&&n.that,S=!(!n||!n.AS_ENTRIES),v=!(!n||!n.IS_RECORD),y=!(!n||!n.IS_ITERATOR),P=!(!n||!n.INTERRUPTED),I=gv(e,m),O=function(U){return i&&wf(i,"normal",U),new mh(!0,U)},M=function(U){return S?(Sv(U),P?I(U[0],U[1],O):I(U[0],U[1])):P?I(U,O):I(U)};if(v)i=t.iterator;else if(y)i=t;else{if(!(r=bv(t)))throw new Cv(Tv(t)+" is not iterable");if(vv(r)){for(o=0,c=yv(t);c>o;o++)if((l=M(t[o]))&&Af(Av,l))return l;return new mh(!1)}i=Rv(t,r)}for(h=v?t.next:i.next;!(p=N_(h,i)).done;){try{l=M(p.value)}catch(U){wf(i,"throw",U)}if(typeof l=="object"&&l&&Af(Av,l))return l}return new mh(!1)},wv=Yi,Iv=qe,D_=et,Ov=uf,Eh=ff,NA=function(t,e,n){for(var i=Ld(e),r=AA.f,o=kd.f,c=0;c<i.length;c++){var l=i[c];Ef(t,l)||n&&Ef(n,l)||r(t,l,o(e,l))}},Nv=vl,If=El,Rl=zt,P_=function(t,e){b_(e)&&"cause"in e&&ts(t,"cause",e.cause)},Of=function(t,e,n,i){rv&&(I_?I_(t,e):A_(t,"stack",w_(n,i)))},Dv=yl,Pv=function(t,e){return t===void 0?arguments.length<2?"":e:wv(t)},Lo=Fn("toStringTag"),ko=Error,Sc=[].push,Ms=function(t,e){var n,i=D_(_h,this);Eh?n=Eh(new ko,i?Ov(this):_h):(n=i?this:Nv(_h),If(n,Lo,"Error")),e!==void 0&&If(n,"message",Pv(e)),Of(n,Ms,n.stack,1),arguments.length>2&&P_(n,arguments[2]);var r=[];return Dv(t,Sc,{that:r}),If(n,"errors",r),n};Eh?Eh(Ms,ko):NA(Ms,ko,{name:!0});var _h=Ms.prototype=Nv(ko.prototype,{constructor:Rl(1,Ms),message:Rl(1,""),name:Rl(1,"AggregateError")});Iv({global:!0},{AggregateError:Ms});var jd,Fd,gh,bl=de,Sh=J.WeakMap,Lv=bl(Sh)&&/native code/.test(String(Sh)),L_=J,kv=pi,Nf=El,Df=ti,Th=ju,Mv=mc,xv=Pd,Uv="Object already initialized",Pf=L_.TypeError,er=L_.WeakMap;if(Lv||Th.state){var ai=Th.state||(Th.state=new er);ai.get=ai.get,ai.has=ai.has,ai.set=ai.set,jd=function(t,e){if(ai.has(t))throw new Pf(Uv);return e.facade=t,ai.set(t,e),e},Fd=function(t){return ai.get(t)||{}},gh=function(t){return ai.has(t)}}else{var Cl=Mv("state");xv[Cl]=!0,jd=function(t,e){if(Df(t,Cl))throw new Pf(Uv);return e.facade=t,Nf(t,Cl,e),e},Fd=function(t){return Df(t,Cl)?t[Cl]:{}},gh=function(t){return Df(t,Cl)}}var Tc,k_,M_,vc={set:jd,get:Fd,has:gh,enforce:function(t){return gh(t)?Fd(t):jd(t,{})},getterFor:function(t){return function(e){var n;if(!kv(e)||(n=Fd(e)).type!==t)throw new Pf("Incompatible receiver, "+t+" required");return n}}},Al=Zt,x_=ti,U_=Function.prototype,Vv=Al&&Object.getOwnPropertyDescriptor,V_=x_(U_,"name"),Lf={PROPER:V_&&(function(){}).name==="something",CONFIGURABLE:V_&&(!Al||Al&&Vv(U_,"name").configurable)},B_=El,Mo=function(t,e,n,i){return i&&i.enumerable?t[e]=n:B_(t,e,n),t},Bv=w,j_=de,F_=pi,G_=vl,H_=uf,W_=Mo,kf=Fn("iterator"),xo=!1;[].keys&&("next"in(M_=[].keys())?(k_=H_(H_(M_)))!==Object.prototype&&(Tc=k_):xo=!0);var K_=!F_(Tc)||Bv(function(){var t={};return Tc[kf].call(t)!==t});j_((Tc=K_?{}:G_(Tc))[kf])||W_(Tc,kf,function(){return this});var jv={IteratorPrototype:Tc,BUGGY_SAFARI_ITERATORS:xo},Fv=io,z_=l_?{}.toString:function(){return"[object "+Fv(this)+"]"},wl=l_,Sa=Ns.f,yc=El,Ta=ti,Y_=z_,Mf=Fn("toStringTag"),Es=function(t,e,n,i){var r=n?t:t&&t.prototype;r&&(Ta(r,Mf)||Sa(r,Mf,{configurable:!0,value:e}),i&&!wl&&yc(r,"toString",Y_))},xf=jv.IteratorPrototype,Il=vl,yr=zt,Uf=Es,Gv=gc,Rc=function(){return this},vh=function(t,e,n,i){var r=e+" Iterator";return t.prototype=Il(xf,{next:yr(+!i,n)}),Uf(t,r,!1,!0),Gv[r]=Rc,t},q_=qe,bc=Gt,Cc=Lf,yh=vh,X_=uf,J_=Es,Gd=Mo,Hd=gc,Hv=jv,Wv=Cc.PROPER,Ac=Hv.BUGGY_SAFARI_ITERATORS,Uo=Fn("iterator"),Q_="keys",Rh="values",wc="entries",_s=function(){return this},Z_=function(t,e,n,i,r,o,c){yh(n,e,i);var l,h,p,m=function(M){if(M===r&&I)return I;if(!Ac&&M&&M in y)return y[M];switch(M){case Q_:case Rh:case wc:return function(){return new n(this,M)}}return function(){return new n(this)}},S=e+" Iterator",v=!1,y=t.prototype,P=y[Uo]||y["@@iterator"]||r&&y[r],I=!Ac&&P||m(r),O=e==="Array"&&y.entries||P;if(O&&(l=X_(O.call(new t)))!==Object.prototype&&l.next&&(J_(l,S,!0,!0),Hd[S]=_s),Wv&&r===Rh&&P&&P.name!==Rh&&(v=!0,I=function(){return bc(P,this)}),r)if(h={values:m(Rh),keys:o?I:m(Q_),entries:m(wc)},c)for(p in h)(Ac||v||!(p in y))&&Gd(y,p,h[p]);else q_({target:e,proto:!0,forced:Ac||v},h);return c&&y[Uo]!==I&&Gd(y,Uo,I,{}),Hd[e]=I,h},bh=function(t,e){return{value:t,done:e}},Kv=Ii,Vf=gc,Bf=vc;Ns.f;var jf=Z_,xs=bh,yi="Array Iterator",$_=Bf.set,zv=Bf.getterFor(yi);jf(Array,"Array",function(t,e){$_(this,{type:yi,target:Kv(t),index:0,kind:e})},function(){var t=zv(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,xs(void 0,!0);switch(t.kind){case"keys":return xs(n,!1);case"values":return xs(e[n],!1)}return xs([n,e[n]],!1)},"values"),Vf.Arguments=Vf.Array;var nr=Ns,Ch=function(t,e,n){return nr.f(t,e,n)},DA=Wn,Yv=Ch,qv=Zt,Mi=Fn("species"),gs=et,va=TypeError,Ff=function(t,e){if(gs(e,t))return t;throw new va("Incorrect invocation")},Xv=de,tg=ju,eg=Y(Function.toString);Xv(tg.inspectSource)||(tg.inspectSource=function(t){return eg(t)});var Ss=tg.inspectSource,co=Y,Jv=w,Ts=de,Qv=io,ya=Ss,Ol=function(){},Ra=Wn("Reflect","construct"),Ah=/^\s*(?:class|function)\b/,ng=co(Ah.exec),Ic=!Ah.test(Ol),Wd=function(t){if(!Ts(t))return!1;try{return Ra(Ol,[],t),!0}catch{return!1}},Nl=function(t){if(!Ts(t))return!1;switch(Qv(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ic||!!ng(Ah,ya(t))}catch{return!0}};Nl.sham=!0;var ba,Vo,Dl,Gf,wh=!Ra||Jv(function(){var t;return Wd(Wd.call)||!Wd(Object)||!Wd(function(){t=!0})||t})?Nl:Wd,Ih=wh,Zv=Tn,Hf=TypeError,ig=Tr,PA=function(t){if(Ih(t))return t;throw new Hf(Zv(t)+" is not a constructor")},Us=Se,rg=Fn("species"),Bo=function(t,e){var n,i=ig(t).constructor;return i===void 0||Us(n=ig(i)[rg])?e:PA(n)},Ca=Y([].slice),Wf=TypeError,vs=function(t,e){if(t<e)throw new Wf("Not enough arguments");return t},sg=/(?:ipad|iphone|ipod).*applewebkit/i.test(lr),xr=J,og=ot,Aa=Os,ag=de,Kf=ti,Kd=w,_i=ch,LA=Ca,$v=Hu,ty=vs,kA=sg,MA=Mr,fi=xr.setImmediate,zn=xr.clearImmediate,mn=xr.process,gn=xr.Dispatch,ci=xr.Function,es=xr.MessageChannel,wa=xr.String,Oc=0,Pl={},jo="onreadystatechange";Kd(function(){ba=xr.location});var gi=function(t){if(Kf(Pl,t)){var e=Pl[t];delete Pl[t],e()}},Fo=function(t){return function(){gi(t)}},Nc=function(t){gi(t.data)},zf=function(t){xr.postMessage(wa(t),ba.protocol+"//"+ba.host)};fi&&zn||(fi=function(t){ty(arguments.length,1);var e=ag(t)?t:ci(t),n=LA(arguments,1);return Pl[++Oc]=function(){og(e,void 0,n)},Vo(Oc),Oc},zn=function(t){delete Pl[t]},MA?Vo=function(t){mn.nextTick(Fo(t))}:gn&&gn.now?Vo=function(t){gn.now(Fo(t))}:es&&!kA?(Gf=(Dl=new es).port2,Dl.port1.onmessage=Nc,Vo=Aa(Gf.postMessage,Gf)):xr.addEventListener&&ag(xr.postMessage)&&!xr.importScripts&&ba&&ba.protocol!=="file:"&&!Kd(zf)?(Vo=zf,xr.addEventListener("message",Nc,!1)):Vo=jo in $v("script")?function(t){_i.appendChild($v("script"))[jo]=function(){_i.removeChild(this),gi(t)}}:function(t){setTimeout(Fo(t),0)});var Ur={set:fi,clear:zn},Ll=J,Oh=Zt,Go=Object.getOwnPropertyDescriptor,Yf=function(t){if(!Oh)return Ll[t];var e=Go(Ll,t);return e&&e.value},qf=function(){this.head=null,this.tail=null};qf.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Ia,zd,Ho,Yd,Dc,qd=qf,cg=/ipad|iphone|ipod/i.test(lr)&&typeof Pebble<"u",lg=/web0s(?!.*chrome)/i.test(lr),Wo=J,dg=Yf,ns=Os,Xf=Ur.set,Vr=qd,ey=sg,ug=cg,ny=lg,hg=Mr,Ko=Wo.MutationObserver||Wo.WebKitMutationObserver,Nh=Wo.document,Jf=Wo.process,Oa=Wo.Promise,Qf=dg("queueMicrotask");if(!Qf){var Dh=new Vr,Ph=function(){var t,e;for(hg&&(t=Jf.domain)&&t.exit();e=Dh.get();)try{e()}catch(n){throw Dh.head&&Ia(),n}t&&t.enter()};ey||hg||ny||!Ko||!Nh?!ug&&Oa&&Oa.resolve?((Yd=Oa.resolve(void 0)).constructor=Oa,Dc=ns(Yd.then,Yd),Ia=function(){Dc(Ph)}):hg?Ia=function(){Jf.nextTick(Ph)}:(Xf=ns(Xf,Wo),Ia=function(){Xf(Ph)}):(zd=!0,Ho=Nh.createTextNode(""),new Ko(Ph).observe(Ho,{characterData:!0}),Ia=function(){Ho.data=zd=!zd}),Qf=function(t){Dh.head||Ia(),Dh.add(t)}}var Zf=Qf,Pc=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},kl=J.Promise,xA=J,Lh=kl,iy=de,ry=t_,Xd=Ss,$f=Fn,pg=af,tm=oi,sy=Lh&&Lh.prototype,oy=$f("species"),Ml=iy(xA.PromiseRejectionEvent),ay=ry("Promise",function(){var t=Xd(Lh),e=t!==String(Lh);if(!e&&tm===66||!sy.catch||!sy.finally)return!0;if(!tm||tm<51||!/native code/.test(t)){var n=new Lh(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[oy]=i,!(n.then(function(){})instanceof i))return!0}return!(e||pg!=="BROWSER"&&pg!=="DENO"||Ml)}),Ln={CONSTRUCTOR:ay,REJECTION_EVENT:Ml},Vs={},cy=Zn,ly=TypeError,UA=function(t){var e,n;this.promise=new t(function(i,r){if(e!==void 0||n!==void 0)throw new ly("Bad Promise constructor");e=i,n=r}),this.resolve=cy(e),this.reject=cy(n)};Vs.f=function(t){return new UA(t)};var fg,dy,em=qe,Na=Mr,zo=J,Lc=Gt,mg=Mo,xl=Es,Yo=function(t){var e=DA(t);qv&&e&&!e[Mi]&&Yv(e,Mi,{configurable:!0,get:function(){return this}})},kh=Zn,Eg=de,uy=pi,hy=Ff,py=Bo,fy=Ur.set,Mh=Zf,my=function(t,e){try{arguments.length===1?console.error(t):console.error(t,e)}catch{}},Ey=Pc,VA=qd,nm=vc,xh=kl,_y=Ln,gy=Vs,kc="Promise",Sy=_y.CONSTRUCTOR,Ty=_y.REJECTION_EVENT,En=nm.getterFor(kc),_g=nm.set,im=xh&&xh.prototype,Ul=xh,rm=im,sm=zo.TypeError,Vl=zo.document,Jd=zo.process,Mc=gy.f,vy=Mc,BA=!!(Vl&&Vl.createEvent&&zo.dispatchEvent),yy="unhandledrejection",gg=function(t){var e;return!(!uy(t)||!Eg(e=t.then))&&e},Sg=function(t,e){var n,i,r,o=e.value,c=e.state===1,l=c?t.ok:t.fail,h=t.resolve,p=t.reject,m=t.domain;try{l?(c||(e.rejection===2&&jA(e),e.rejection=1),l===!0?n=o:(m&&m.enter(),n=l(o),m&&(m.exit(),r=!0)),n===t.promise?p(new sm("Promise-chain cycle")):(i=gg(n))?Lc(i,n,h,p):h(n)):p(o)}catch(S){m&&!r&&m.exit(),p(S)}},Uh=function(t,e){t.notified||(t.notified=!0,Mh(function(){for(var n,i=t.reactions;n=i.get();)Sg(n,t);t.notified=!1,e&&!t.rejection&&Tg(t)}))},Gn=function(t,e,n){var i,r;BA?((i=Vl.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),zo.dispatchEvent(i)):i={promise:e,reason:n},!Ty&&(r=zo["on"+t])?r(i):t===yy&&my("Unhandled promise rejection",n)},Tg=function(t){Lc(fy,zo,function(){var e,n=t.facade,i=t.value;if(ir(t)&&(e=Ey(function(){Na?Jd.emit("unhandledRejection",i,n):Gn(yy,n,i)}),t.rejection=Na||ir(t)?2:1,e.error))throw e.value})},ir=function(t){return t.rejection!==1&&!t.parent},jA=function(t){Lc(fy,zo,function(){var e=t.facade;Na?Jd.emit("rejectionHandled",e):Gn("rejectionhandled",e,t.value)})},xc=function(t,e,n){return function(i){t(e,i,n)}},Uc=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Uh(t,!0))},Qd=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw new sm("Promise can't be resolved itself");var i=gg(e);i?Mh(function(){var r={done:!1};try{Lc(i,e,xc(Qd,r,t),xc(Uc,r,t))}catch(o){Uc(r,o,t)}}):(t.value=e,t.state=1,Uh(t,!1))}catch(r){Uc({done:!1},r,t)}}};Sy&&(rm=(Ul=function(t){hy(this,rm),kh(t),Lc(fg,this);var e=En(this);try{t(xc(Qd,e),xc(Uc,e))}catch(n){Uc(e,n)}}).prototype,(fg=function(t){_g(this,{type:kc,done:!1,notified:!1,parent:!1,reactions:new VA,rejection:!1,state:0,value:null})}).prototype=mg(rm,"then",function(t,e){var n=En(this),i=Mc(py(this,Ul));return n.parent=!0,i.ok=!Eg(t)||t,i.fail=Eg(e)&&e,i.domain=Na?Jd.domain:void 0,n.state===0?n.reactions.add(i):Mh(function(){Sg(i,n)}),i.promise}),dy=function(){var t=new fg,e=En(t);this.promise=t,this.resolve=xc(Qd,e),this.reject=xc(Uc,e)},gy.f=Mc=function(t){return t===Ul||t===void 0?new dy(t):vy(t)}),em({global:!0,wrap:!0,forced:Sy},{Promise:Ul}),xl(Ul,kc,!1,!0),Yo(kc);var vg=Fn("iterator"),yg=!1;try{var Rg=0,om={next:function(){return{done:!!Rg++}},return:function(){yg=!0}};om[vg]=function(){return this},Array.from(om,function(){throw 2})}catch{}var FA=kl,Ry=function(t,e){try{if(!e&&!yg)return!1}catch{return!1}var n=!1;try{var i={};i[vg]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},am=Ln.CONSTRUCTOR||!Ry(function(t){FA.all(t).then(void 0,function(){})}),by=Gt,GA=Zn,HA=Vs,bg=Pc,Cg=yl;qe({target:"Promise",stat:!0,forced:am},{all:function(t){var e=this,n=HA.f(e),i=n.resolve,r=n.reject,o=bg(function(){var c=GA(e.resolve),l=[],h=0,p=1;Cg(t,function(m){var S=h++,v=!1;p++,by(c,e,m).then(function(y){v||(v=!0,l[S]=y,--p||i(l))},r)}),--p||i(l)});return o.error&&r(o.value),n.promise}});var WA=qe,KA=Ln.CONSTRUCTOR;kl&&kl.prototype,WA({target:"Promise",proto:!0,forced:KA,real:!0},{catch:function(t){return this.then(void 0,t)}});var lo=Gt,Cy=Zn,Ay=Vs,Bs=Pc,wy=yl;qe({target:"Promise",stat:!0,forced:am},{race:function(t){var e=this,n=Ay.f(e),i=n.reject,r=Bs(function(){var o=Cy(e.resolve);wy(t,function(c){lo(o,e,c).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var cm=Vs;qe({target:"Promise",stat:!0,forced:Ln.CONSTRUCTOR},{reject:function(t){var e=cm.f(this);return(0,e.reject)(t),e.promise}});var Da=Tr,zA=pi,YA=Vs,Bl=function(t,e){if(Da(t),zA(e)&&e.constructor===t)return e;var n=YA.f(t);return(0,n.resolve)(e),n.promise},Iy=qe,qA=kl,XA=Ln.CONSTRUCTOR,JA=Bl,QA=Wn("Promise"),ZA=!XA;Iy({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return JA(ZA&&this===QA?qA:this,t)}});var $A=Gt,tw=Zn,Oy=Vs,Zd=Pc,Vh=yl;qe({target:"Promise",stat:!0,forced:am},{allSettled:function(t){var e=this,n=Oy.f(e),i=n.resolve,r=n.reject,o=Zd(function(){var c=tw(e.resolve),l=[],h=0,p=1;Vh(t,function(m){var S=h++,v=!1;p++,$A(c,e,m).then(function(y){v||(v=!0,l[S]={status:"fulfilled",value:y},--p||i(l))},function(y){v||(v=!0,l[S]={status:"rejected",reason:y},--p||i(l))})}),--p||i(l)});return o.error&&r(o.value),n.promise}});var Ny=Gt,ew=Zn,$d=Wn,Bh=Vs,Dy=Pc,lm=yl,dm="No one promise resolved";qe({target:"Promise",stat:!0,forced:am},{any:function(t){var e=this,n=$d("AggregateError"),i=Bh.f(e),r=i.resolve,o=i.reject,c=Dy(function(){var l=ew(e.resolve),h=[],p=0,m=1,S=!1;lm(t,function(v){var y=p++,P=!1;m++,Ny(l,e,v).then(function(I){P||S||(S=!0,r(I))},function(I){P||S||(P=!0,h[y]=I,--m||o(new n(h,dm)))})}),--m||o(new n(h,dm))});return c.error&&o(c.value),i.promise}});var Ag=qe,um=ot,Py=Ca,Ly=Vs,nw=Zn,wg=Pc,jl=J.Promise,ky=!1;Ag({target:"Promise",stat:!0,forced:!jl||!jl.try||wg(function(){jl.try(function(t){ky=t===8},8)}).error||!ky},{try:function(t){var e=arguments.length>1?Py(arguments,1):[],n=Ly.f(this),i=wg(function(){return um(nw(t),void 0,e)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var iw=Vs;qe({target:"Promise",stat:!0},{withResolvers:function(){var t=iw.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var rw=qe,tu=kl,hm=w,Ig=Wn,sw=de,jh=Bo,My=Bl,xy=tu&&tu.prototype;rw({target:"Promise",proto:!0,real:!0,forced:!!tu&&hm(function(){xy.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=jh(this,Ig("Promise")),n=sw(t);return this.then(n?function(i){return My(e,t()).then(function(){return i})}:t,n?function(i){return My(e,t()).then(function(){throw i})}:t)}});var pm=Y,Uy=o_,Vy=Yi,Og=Pn,By=pm("".charAt),Fh=pm("".charCodeAt),ow=pm("".slice),jy=function(t){return function(e,n){var i,r,o=Vy(Og(e)),c=Uy(n),l=o.length;return c<0||c>=l?t?"":void 0:(i=Fh(o,c))<55296||i>56319||c+1===l||(r=Fh(o,c+1))<56320||r>57343?t?By(o,c):i:t?ow(o,c,c+2):r-56320+(i-55296<<10)+65536}},Gh={codeAt:jy(!1),charAt:jy(!0)},Ng=Gh.charAt,fm=Yi,mm=vc,Fy=Z_,Em=bh,Pa="String Iterator",Vc=mm.set,Bc=mm.getterFor(Pa);Fy(String,"String",function(t){Vc(this,{type:Pa,string:fm(t),index:0})},function(){var t,e=Bc(this),n=e.string,i=e.index;return i>=n.length?Em(void 0,!0):(t=Ng(n,i),e.index+=t.length,Em(t,!1))});var Hh=Oi.Promise,Wh={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},jc=J,aw=Es,Dg=gc;for(var Fl in Wh)aw(jc[Fl],Fl),Dg[Fl]=Dg.Array;var Gy=Hh,At=R(Gy),_m=Zr("Array","values"),Hy=io,cw=ti,gm=et,Sm=_m,Tm=Array.prototype,Kh={DOMTokenList:!0,NodeList:!0},Pg=function(t){var e=t.values;return t===Tm||gm(Tm,t)&&e===Tm.values||cw(Kh,Hy(t))?Sm:e},hr=R(Pg),Wy=qe,lw=Y,vm=tf,s=RangeError,a=String.fromCharCode,u=String.fromCodePoint,E=lw([].join);Wy({target:"String",stat:!0,forced:!!u&&u.length!==1},{fromCodePoint:function(t){for(var e,n=[],i=arguments.length,r=0;i>r;){if(e=+arguments[r++],vm(e,1114111)!==e)throw new s(e+" is not a valid code point");n[r]=e<65536?a(e):a(55296+((e-=65536)>>10),e%1024+56320)}return E(n,"")}});var T=w,C=Jr,B=Fn("iterator"),K=!T(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return t.pathname="c%20d",e.forEach(function(r,o){e.delete("b"),i+=o+r}),n.delete("a",2),n.delete("b",void 0),!t.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!e.size&&C||!e.sort||t.href!=="https://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[B]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),nt=Mo,ut=Ca,kt=Math.floor,Xt=function(t,e){var n=t.length;if(n<8)for(var i,r,o=1;o<n;){for(r=o,i=t[o];r&&e(t[r-1],i)>0;)t[r]=t[--r];r!==o++&&(t[r]=i)}else for(var c=kt(n/2),l=Xt(ut(t,0,c),e),h=Xt(ut(t,c),e),p=l.length,m=h.length,S=0,v=0;S<p||v<m;)t[S+v]=S<p&&v<m?e(l[S],h[v])<=0?l[S++]:h[v++]:S<p?l[S++]:h[v++];return t},vt=Xt,Pt=qe,Te=J,He=Yf,Ni=Wn,mt=Gt,lt=Y,gt=Zt,Ht=K,Ee=Mo,dn=Ch,Ce=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:nt(t,i,e[i],n);return t},xe=Es,rr=vh,yn=vc,La=Ff,Lg=de,kG=ti,MG=Os,xG=io,UG=Tr,cD=pi,ys=Yi,VG=vl,lD=zt,dD=bf,BG=Vd,Ky=bh,ym=vs,jG=vt,FG=Fn("iterator"),Rm="URLSearchParams",uD=Rm+"Iterator",hD=yn.set,qo=yn.getterFor(Rm),GG=yn.getterFor(uD),pD=He("fetch"),zy=He("Request"),kg=He("Headers"),dw=zy&&zy.prototype,fD=kg&&kg.prototype,HG=Te.TypeError,WG=Te.encodeURIComponent,KG=String.fromCharCode,zG=Ni("String","fromCodePoint"),YG=parseInt,Yy=lt("".charAt),mD=lt([].join),eu=lt([].push),ED=lt("".replace),qG=lt([].shift),_D=lt([].splice),gD=lt("".split),SD=lt("".slice),XG=lt(/./.exec),JG=/\+/g,QG=/^[0-9a-f]+$/i,TD=function(t,e){var n=SD(t,e,e+2);return XG(QG,n)?YG(n,16):NaN},ZG=function(t){for(var e=0,n=128;n>0&&t&n;n>>=1)e++;return e},$G=function(t){var e=null;switch(t.length){case 1:e=t[0];break;case 2:e=(31&t[0])<<6|63&t[1];break;case 3:e=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:e=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return e>1114111?null:e},vD=function(t){for(var e=(t=ED(t,JG," ")).length,n="",i=0;i<e;){var r=Yy(t,i);if(r==="%"){if(Yy(t,i+1)==="%"||i+3>e){n+="%",i++;continue}var o=TD(t,i+1);if(o!=o){n+=r,i++;continue}i+=2;var c=ZG(o);if(c===0)r=KG(o);else{if(c===1||c>4){n+="�",i++;continue}for(var l=[o],h=1;h<c&&!(++i+3>e||Yy(t,i)!=="%");){var p=TD(t,i+1);if(p!=p){i+=3;break}if(p>191||p<128)break;eu(l,p),i+=2,h++}if(l.length!==c){n+="�";continue}var m=$G(l);m===null?n+="�":r=zG(m)}}n+=r,i++}return n},t4=/[!'()~]|%20/g,e4={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},n4=function(t){return e4[t]},yD=function(t){return ED(WG(t),t4,n4)},uw=rr(function(t,e){hD(this,{type:uD,target:qo(t).entries,index:0,kind:e})},Rm,function(){var t=GG(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,Ky(void 0,!0);var i=e[n];switch(t.kind){case"keys":return Ky(i.key,!1);case"values":return Ky(i.value,!1)}return Ky([i.key,i.value],!1)},!0),RD=function(t){this.entries=[],this.url=null,t!==void 0&&(cD(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?Yy(t,0)==="?"?SD(t,1):t:ys(t)))};RD.prototype={type:Rm,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,r,o,c,l,h=this.entries,p=BG(t);if(p)for(n=(e=dD(t,p)).next;!(i=mt(n,e)).done;){if(o=(r=dD(UG(i.value))).next,(c=mt(o,r)).done||(l=mt(o,r)).done||!mt(o,r).done)throw new HG("Expected sequence with length 2");eu(h,{key:ys(c.value),value:ys(l.value)})}else for(var m in t)kG(t,m)&&eu(h,{key:m,value:ys(t[m])})},parseQuery:function(t){if(t)for(var e,n,i=this.entries,r=gD(t,"&"),o=0;o<r.length;)(e=r[o++]).length&&(n=gD(e,"="),eu(i,{key:vD(qG(n)),value:vD(mD(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],eu(n,yD(t.key)+"="+yD(t.value));return mD(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var qy=function(){La(this,bm);var t=hD(this,new RD(arguments.length>0?arguments[0]:void 0));gt||(this.size=t.entries.length)},bm=qy.prototype;if(Ce(bm,{append:function(t,e){var n=qo(this);ym(arguments.length,2),eu(n.entries,{key:ys(t),value:ys(e)}),gt||this.length++,n.updateURL()},delete:function(t){for(var e=qo(this),n=ym(arguments.length,1),i=e.entries,r=ys(t),o=n<2?void 0:arguments[1],c=o===void 0?o:ys(o),l=0;l<i.length;){var h=i[l];if(h.key!==r||c!==void 0&&h.value!==c)l++;else if(_D(i,l,1),c!==void 0)break}gt||(this.size=i.length),e.updateURL()},get:function(t){var e=qo(this).entries;ym(arguments.length,1);for(var n=ys(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=qo(this).entries;ym(arguments.length,1);for(var n=ys(t),i=[],r=0;r<e.length;r++)e[r].key===n&&eu(i,e[r].value);return i},has:function(t){for(var e=qo(this).entries,n=ym(arguments.length,1),i=ys(t),r=n<2?void 0:arguments[1],o=r===void 0?r:ys(r),c=0;c<e.length;){var l=e[c++];if(l.key===i&&(o===void 0||l.value===o))return!0}return!1},set:function(t,e){var n=qo(this);ym(arguments.length,1);for(var i,r=n.entries,o=!1,c=ys(t),l=ys(e),h=0;h<r.length;h++)(i=r[h]).key===c&&(o?_D(r,h--,1):(o=!0,i.value=l));o||eu(r,{key:c,value:l}),gt||(this.size=r.length),n.updateURL()},sort:function(){var t=qo(this);jG(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=qo(this).entries,i=MG(t,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new uw(this,"keys")},values:function(){return new uw(this,"values")},entries:function(){return new uw(this,"entries")}},{enumerable:!0}),Ee(bm,FG,bm.entries,{}),Ee(bm,"toString",function(){return qo(this).serialize()},{enumerable:!0}),gt&&dn(bm,"size",{get:function(){return qo(this).entries.length},configurable:!0,enumerable:!0}),xe(qy,Rm),Pt({global:!0,forced:!Ht},{URLSearchParams:qy}),!Ht&&Lg(kg)){var i4=lt(fD.has),r4=lt(fD.set),bD=function(t){if(cD(t)){var e,n=t.body;if(xG(n)===Rm)return e=t.headers?new kg(t.headers):new kg,i4(e,"content-type")||r4(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),VG(t,{body:lD(0,ys(n)),headers:lD(0,e)})}return t};if(Lg(pD)&&Pt({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return pD(t,arguments.length>1?bD(arguments[1]):{})}}),Lg(zy)){var hw=function(t){return La(this,dw),new zy(t,arguments.length>1?bD(arguments[1]):{})};dw.constructor=hw,hw.prototype=dw,Pt({global:!0,dontCallGetSet:!0,forced:!0},{Request:hw})}}var Xo,s4={URLSearchParams:qy,getState:qo},o4=Oi.URLSearchParams,CD=Zt,a4=Y,c4=Gt,l4=w,pw=Po,d4=sh,u4=Nt,h4=$n,p4=Le,Cm=Object.assign,AD=Object.defineProperty,f4=a4([].concat),m4=!Cm||l4(function(){if(CD&&Cm({b:1},Cm(AD({},"a",{enumerable:!0,get:function(){AD(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(r){e[r]=r}),Cm({},t)[n]!==7||pw(Cm({},e)).join("")!==i})?function(t,e){for(var n=h4(t),i=arguments.length,r=1,o=d4.f,c=u4.f;i>r;)for(var l,h=p4(arguments[r++]),p=o?f4(pw(h),o(h)):pw(h),m=p.length,S=0;m>S;)l=p[S++],CD&&!c4(c,h,l)||(n[l]=h[l]);return n}:Cm,E4=Tr,_4=fh,g4=Zt,S4=Ns,T4=zt,fw=function(t,e,n){g4?S4.f(t,e,T4(0,n)):t[e]=n},v4=Os,y4=Gt,R4=$n,b4=function(t,e,n,i){try{return i?e(E4(n)[0],n[1]):e(n)}catch(r){_4(t,"throw",r)}},C4=Rf,A4=wh,w4=dc,wD=fw,I4=bf,O4=Vd,ID=Array,zh=Y,mw=2147483647,N4=/[^\0-\u007E]/,OD=/[.\u3002\uFF0E\uFF61]/g,ND="Overflow: input needs wider integers to process",DD=RangeError,D4=zh(OD.exec),Am=Math.floor,Ew=String.fromCharCode,PD=zh("".charCodeAt),LD=zh([].join),nu=zh([].push),P4=zh("".replace),L4=zh("".split),k4=zh("".toLowerCase),kD=function(t){return t+22+75*(t<26)},M4=function(t,e,n){var i=0;for(t=n?Am(t/700):t>>1,t+=Am(t/e);t>455;)t=Am(t/35),i+=36;return Am(i+36*t/(t+38))},x4=function(t){var e=[];t=function(M){for(var U=[],W=0,$=M.length;W<$;){var Q=PD(M,W++);if(Q>=55296&&Q<=56319&&W<$){var q=PD(M,W++);(64512&q)==56320?nu(U,((1023&Q)<<10)+(1023&q)+65536):(nu(U,Q),W--)}else nu(U,Q)}return U}(t);var n,i,r=t.length,o=128,c=0,l=72;for(n=0;n<t.length;n++)(i=t[n])<128&&nu(e,Ew(i));var h=e.length,p=h;for(h&&nu(e,"-");p<r;){var m=mw;for(n=0;n<t.length;n++)(i=t[n])>=o&&i<m&&(m=i);var S=p+1;if(m-o>Am((mw-c)/S))throw new DD(ND);for(c+=(m-o)*S,o=m,n=0;n<t.length;n++){if((i=t[n])<o&&++c>mw)throw new DD(ND);if(i===o){for(var v=c,y=36;;){var P=y<=l?1:y>=l+26?26:y-l;if(v<P)break;var I=v-P,O=36-P;nu(e,Ew(kD(P+I%O))),v=Am(I/O),y+=36}nu(e,Ew(kD(v))),l=M4(c,S,p===h),c=0,p++}}c++,o++}return LD(e,"")},U4=qe,_w=Zt,V4=K,gw=J,MD=Os,Jo=Y,Xy=Mo,Qo=Ch,B4=Ff,Sw=ti,Tw=m4,wm=function(t){var e=R4(t),n=A4(this),i=arguments.length,r=i>1?arguments[1]:void 0,o=r!==void 0;o&&(r=v4(r,i>2?arguments[2]:void 0));var c,l,h,p,m,S,v=O4(e),y=0;if(!v||this===ID&&C4(v))for(c=w4(e),l=n?new this(c):ID(c);c>y;y++)S=o?r(e[y],y):e[y],wD(l,y,S);else for(l=n?new this:[],m=(p=I4(e,v)).next;!(h=y4(m,p)).done;y++)S=o?b4(p,r,[h.value,y],!0):h.value,wD(l,y,S);return l.length=y,l},ka=Ca,j4=Gh.codeAt,F4=function(t){var e,n,i=[],r=L4(P4(k4(t),OD,"."),".");for(e=0;e<r.length;e++)n=r[e],nu(i,D4(N4,n)?"xn--"+x4(n):n);return LD(i,".")},Gl=Yi,G4=Es,H4=vs,xD=s4,UD=vc,W4=UD.set,Jy=UD.getterFor("URL"),K4=xD.URLSearchParams,z4=xD.getState,Mg=gw.URL,vw=gw.TypeError,Qy=gw.parseInt,Y4=Math.floor,VD=Math.pow,Zo=Jo("".charAt),Ma=Jo(/./.exec),xg=Jo([].join),q4=Jo(1 .toString),X4=Jo([].pop),Im=Jo([].push),yw=Jo("".replace),J4=Jo([].shift),Q4=Jo("".split),Ug=Jo("".slice),Zy=Jo("".toLowerCase),Z4=Jo([].unshift),Rw="Invalid scheme",Yh="Invalid host",BD="Invalid port",jD=/[a-z]/i,$4=/[\d+-.a-z]/i,bw=/\d/,tH=/^0x/i,eH=/^[0-7]+$/,nH=/^\d+$/,FD=/^[\da-f]+$/i,iH=/[\0\t\n\r #%/:<>?@[\\\]^|]/,rH=/[\0\t\n\r #/:<>?@[\\\]^|]/,sH=/^[\u0000-\u0020]+/,oH=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,aH=/[\t\n\r]/g,Vg=function(t){var e,n,i,r;if(typeof t=="number"){for(e=[],n=0;n<4;n++)Z4(e,t%256),t=Y4(t/256);return xg(e,".")}if(typeof t=="object"){for(e="",i=function(o){for(var c=null,l=1,h=null,p=0,m=0;m<8;m++)o[m]!==0?(p>l&&(c=h,l=p),h=null,p=0):(h===null&&(h=m),++p);return p>l?h:c}(t),n=0;n<8;n++)r&&t[n]===0||(r&&(r=!1),i===n?(e+=n?":":"::",r=!0):(e+=q4(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},$y={},GD=Tw({},$y,{" ":1,'"':1,"<":1,">":1,"`":1}),HD=Tw({},GD,{"#":1,"?":1,"{":1,"}":1}),Cw=Tw({},HD,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),iu=function(t,e){var n=j4(t,0);return n>32&&n<127&&!Sw(e,t)?t:encodeURIComponent(t)},tR={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Bg=function(t,e){var n;return t.length===2&&Ma(jD,Zo(t,0))&&((n=Zo(t,1))===":"||!e&&n==="|")},WD=function(t){var e;return t.length>1&&Bg(Ug(t,0,2))&&(t.length===2||(e=Zo(t,2))==="/"||e==="\\"||e==="?"||e==="#")},cH=function(t){return t==="."||Zy(t)==="%2e"},Aw={},KD={},ww={},zD={},YD={},Iw={},qD={},XD={},eR={},nR={},Ow={},Nw={},Dw={},Pw={},JD={},Lw={},Om={},Fc={},QD={},qh={},Hl={},kw=function(t,e,n){var i,r,o,c=Gl(t);if(e){if(r=this.parse(c))throw new vw(r);this.searchParams=null}else{if(n!==void 0&&(i=new kw(n,!0)),r=this.parse(c,null,i))throw new vw(r);(o=z4(new K4)).bindURL(this),this.searchParams=o}};kw.prototype={type:"URL",parse:function(t,e,n){var i,r,o,c,l,h=this,p=e||Aw,m=0,S="",v=!1,y=!1,P=!1;for(t=Gl(t),e||(h.scheme="",h.username="",h.password="",h.host=null,h.port=null,h.path=[],h.query=null,h.fragment=null,h.cannotBeABaseURL=!1,t=yw(t,sH,""),t=yw(t,oH,"$1")),t=yw(t,aH,""),i=wm(t);m<=i.length;){switch(r=i[m],p){case Aw:if(!r||!Ma(jD,r)){if(e)return Rw;p=ww;continue}S+=Zy(r),p=KD;break;case KD:if(r&&(Ma($4,r)||r==="+"||r==="-"||r==="."))S+=Zy(r);else{if(r!==":"){if(e)return Rw;S="",p=ww,m=0;continue}if(e&&(h.isSpecial()!==Sw(tR,S)||S==="file"&&(h.includesCredentials()||h.port!==null)||h.scheme==="file"&&!h.host))return;if(h.scheme=S,e)return void(h.isSpecial()&&tR[h.scheme]===h.port&&(h.port=null));S="",h.scheme==="file"?p=Pw:h.isSpecial()&&n&&n.scheme===h.scheme?p=zD:h.isSpecial()?p=XD:i[m+1]==="/"?(p=YD,m++):(h.cannotBeABaseURL=!0,Im(h.path,""),p=QD)}break;case ww:if(!n||n.cannotBeABaseURL&&r!=="#")return Rw;if(n.cannotBeABaseURL&&r==="#"){h.scheme=n.scheme,h.path=ka(n.path),h.query=n.query,h.fragment="",h.cannotBeABaseURL=!0,p=Hl;break}p=n.scheme==="file"?Pw:Iw;continue;case zD:if(r!=="/"||i[m+1]!=="/"){p=Iw;continue}p=eR,m++;break;case YD:if(r==="/"){p=nR;break}p=Fc;continue;case Iw:if(h.scheme=n.scheme,r===Xo)h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=ka(n.path),h.query=n.query;else if(r==="/"||r==="\\"&&h.isSpecial())p=qD;else if(r==="?")h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=ka(n.path),h.query="",p=qh;else{if(r!=="#"){h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=ka(n.path),h.path.length--,p=Fc;continue}h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=ka(n.path),h.query=n.query,h.fragment="",p=Hl}break;case qD:if(!h.isSpecial()||r!=="/"&&r!=="\\"){if(r!=="/"){h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,p=Fc;continue}p=nR}else p=eR;break;case XD:if(p=eR,r!=="/"||Zo(S,m+1)!=="/")continue;m++;break;case eR:if(r!=="/"&&r!=="\\"){p=nR;continue}break;case nR:if(r==="@"){v&&(S="%40"+S),v=!0,o=wm(S);for(var I=0;I<o.length;I++){var O=o[I];if(O!==":"||P){var M=iu(O,Cw);P?h.password+=M:h.username+=M}else P=!0}S=""}else if(r===Xo||r==="/"||r==="?"||r==="#"||r==="\\"&&h.isSpecial()){if(v&&S==="")return"Invalid authority";m-=wm(S).length+1,S="",p=Ow}else S+=r;break;case Ow:case Nw:if(e&&h.scheme==="file"){p=Lw;continue}if(r!==":"||y){if(r===Xo||r==="/"||r==="?"||r==="#"||r==="\\"&&h.isSpecial()){if(h.isSpecial()&&S==="")return Yh;if(e&&S===""&&(h.includesCredentials()||h.port!==null))return;if(c=h.parseHost(S))return c;if(S="",p=Om,e)return;continue}r==="["?y=!0:r==="]"&&(y=!1),S+=r}else{if(S==="")return Yh;if(c=h.parseHost(S))return c;if(S="",p=Dw,e===Nw)return}break;case Dw:if(!Ma(bw,r)){if(r===Xo||r==="/"||r==="?"||r==="#"||r==="\\"&&h.isSpecial()||e){if(S!==""){var U=Qy(S,10);if(U>65535)return BD;h.port=h.isSpecial()&&U===tR[h.scheme]?null:U,S=""}if(e)return;p=Om;continue}return BD}S+=r;break;case Pw:if(h.scheme="file",r==="/"||r==="\\")p=JD;else{if(!n||n.scheme!=="file"){p=Fc;continue}switch(r){case Xo:h.host=n.host,h.path=ka(n.path),h.query=n.query;break;case"?":h.host=n.host,h.path=ka(n.path),h.query="",p=qh;break;case"#":h.host=n.host,h.path=ka(n.path),h.query=n.query,h.fragment="",p=Hl;break;default:WD(xg(ka(i,m),""))||(h.host=n.host,h.path=ka(n.path),h.shortenPath()),p=Fc;continue}}break;case JD:if(r==="/"||r==="\\"){p=Lw;break}n&&n.scheme==="file"&&!WD(xg(ka(i,m),""))&&(Bg(n.path[0],!0)?Im(h.path,n.path[0]):h.host=n.host),p=Fc;continue;case Lw:if(r===Xo||r==="/"||r==="\\"||r==="?"||r==="#"){if(!e&&Bg(S))p=Fc;else if(S===""){if(h.host="",e)return;p=Om}else{if(c=h.parseHost(S))return c;if(h.host==="localhost"&&(h.host=""),e)return;S="",p=Om}continue}S+=r;break;case Om:if(h.isSpecial()){if(p=Fc,r!=="/"&&r!=="\\")continue}else if(e||r!=="?")if(e||r!=="#"){if(r!==Xo&&(p=Fc,r!=="/"))continue}else h.fragment="",p=Hl;else h.query="",p=qh;break;case Fc:if(r===Xo||r==="/"||r==="\\"&&h.isSpecial()||!e&&(r==="?"||r==="#")){if((l=Zy(l=S))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(h.shortenPath(),r==="/"||r==="\\"&&h.isSpecial()||Im(h.path,"")):cH(S)?r==="/"||r==="\\"&&h.isSpecial()||Im(h.path,""):(h.scheme==="file"&&!h.path.length&&Bg(S)&&(h.host&&(h.host=""),S=Zo(S,0)+":"),Im(h.path,S)),S="",h.scheme==="file"&&(r===Xo||r==="?"||r==="#"))for(;h.path.length>1&&h.path[0]==="";)J4(h.path);r==="?"?(h.query="",p=qh):r==="#"&&(h.fragment="",p=Hl)}else S+=iu(r,HD);break;case QD:r==="?"?(h.query="",p=qh):r==="#"?(h.fragment="",p=Hl):r!==Xo&&(h.path[0]+=iu(r,$y));break;case qh:e||r!=="#"?r!==Xo&&(r==="'"&&h.isSpecial()?h.query+="%27":h.query+=r==="#"?"%23":iu(r,$y)):(h.fragment="",p=Hl);break;case Hl:r!==Xo&&(h.fragment+=iu(r,GD))}m++}},parseHost:function(t){var e,n,i;if(Zo(t,0)==="["){if(Zo(t,t.length-1)!=="]"||(e=function(r){var o,c,l,h,p,m,S,v=[0,0,0,0,0,0,0,0],y=0,P=null,I=0,O=function(){return Zo(r,I)};if(O()===":"){if(Zo(r,1)!==":")return;I+=2,P=++y}for(;O();){if(y===8)return;if(O()!==":"){for(o=c=0;c<4&&Ma(FD,O());)o=16*o+Qy(O(),16),I++,c++;if(O()==="."){if(c===0||(I-=c,y>6))return;for(l=0;O();){if(h=null,l>0){if(!(O()==="."&&l<4))return;I++}if(!Ma(bw,O()))return;for(;Ma(bw,O());){if(p=Qy(O(),10),h===null)h=p;else{if(h===0)return;h=10*h+p}if(h>255)return;I++}v[y]=256*v[y]+h,++l!=2&&l!==4||y++}if(l!==4)return;break}if(O()===":"){if(I++,!O())return}else if(O())return;v[y++]=o}else{if(P!==null)return;I++,P=++y}}if(P!==null)for(m=y-P,y=7;y!==0&&m>0;)S=v[y],v[y--]=v[P+m-1],v[P+--m]=S;else if(y!==8)return;return v}(Ug(t,1,-1)),!e))return Yh;this.host=e}else if(this.isSpecial()){if(t=F4(t),Ma(iH,t)||(e=function(r){var o,c,l,h,p,m,S,v=Q4(r,".");if(v.length&&v[v.length-1]===""&&v.length--,(o=v.length)>4)return r;for(c=[],l=0;l<o;l++){if((h=v[l])==="")return r;if(p=10,h.length>1&&Zo(h,0)==="0"&&(p=Ma(tH,h)?16:8,h=Ug(h,p===8?1:2)),h==="")m=0;else{if(!Ma(p===10?nH:p===8?eH:FD,h))return r;m=Qy(h,p)}Im(c,m)}for(l=0;l<o;l++)if(m=c[l],l===o-1){if(m>=VD(256,5-o))return null}else if(m>255)return null;for(S=X4(c),l=0;l<c.length;l++)S+=c[l]*VD(256,3-l);return S}(t),e===null))return Yh;this.host=e}else{if(Ma(rH,t))return Yh;for(e="",n=wm(t),i=0;i<n.length;i++)e+=iu(n[i],$y);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return Sw(tR,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme==="file"&&e===1&&Bg(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,r=t.host,o=t.port,c=t.path,l=t.query,h=t.fragment,p=e+":";return r!==null?(p+="//",t.includesCredentials()&&(p+=n+(i?":"+i:"")+"@"),p+=Vg(r),o!==null&&(p+=":"+o)):e==="file"&&(p+="//"),p+=t.cannotBeABaseURL?c[0]:c.length?"/"+xg(c,"/"):"",l!==null&&(p+="?"+l),h!==null&&(p+="#"+h),p},setHref:function(t){var e=this.parse(t);if(e)throw new vw(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t==="blob")try{return new Nm(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Vg(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Gl(t)+":",Aw)},getUsername:function(){return this.username},setUsername:function(t){var e=wm(Gl(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=iu(e[n],Cw)}},getPassword:function(){return this.password},setPassword:function(t){var e=wm(Gl(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=iu(e[n],Cw)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?Vg(t):Vg(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,Ow)},getHostname:function(){var t=this.host;return t===null?"":Vg(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,Nw)},getPort:function(){var t=this.port;return t===null?"":Gl(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Gl(t))===""?this.port=null:this.parse(t,Dw))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+xg(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Om))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Gl(t))===""?this.query=null:(Zo(t,0)==="?"&&(t=Ug(t,1)),this.query="",this.parse(t,qh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Gl(t))!==""?(Zo(t,0)==="#"&&(t=Ug(t,1)),this.fragment="",this.parse(t,Hl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Nm=function(t){var e=B4(this,Rs),n=H4(arguments.length,1)>1?arguments[1]:void 0,i=W4(e,new kw(t,!1,n));_w||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},Rs=Nm.prototype,$o=function(t,e){return{get:function(){return Jy(this)[t]()},set:e&&function(n){return Jy(this)[e](n)},configurable:!0,enumerable:!0}};if(_w&&(Qo(Rs,"href",$o("serialize","setHref")),Qo(Rs,"origin",$o("getOrigin")),Qo(Rs,"protocol",$o("getProtocol","setProtocol")),Qo(Rs,"username",$o("getUsername","setUsername")),Qo(Rs,"password",$o("getPassword","setPassword")),Qo(Rs,"host",$o("getHost","setHost")),Qo(Rs,"hostname",$o("getHostname","setHostname")),Qo(Rs,"port",$o("getPort","setPort")),Qo(Rs,"pathname",$o("getPathname","setPathname")),Qo(Rs,"search",$o("getSearch","setSearch")),Qo(Rs,"searchParams",$o("getSearchParams")),Qo(Rs,"hash",$o("getHash","setHash"))),Xy(Rs,"toJSON",function(){return Jy(this).serialize()},{enumerable:!0}),Xy(Rs,"toString",function(){return Jy(this).serialize()},{enumerable:!0}),Mg){var ZD=Mg.createObjectURL,$D=Mg.revokeObjectURL;ZD&&Xy(Nm,"createObjectURL",MD(ZD,Mg)),$D&&Xy(Nm,"revokeObjectURL",MD($D,Mg))}G4(Nm,"URL"),U4({global:!0,forced:!V4,sham:!_w},{URL:Nm});var lH=qe,tP=w,dH=vs,eP=Yi,uH=K,Mw=Wn("URL"),hH=uH&&tP(function(){Mw.canParse()}),pH=tP(function(){return Mw.canParse.length!==1});lH({target:"URL",stat:!0,forced:!hH||pH},{canParse:function(t){var e=dH(arguments.length,1),n=eP(t),i=e<2||arguments[1]===void 0?void 0:eP(arguments[1]);try{return!!new Mw(n,i)}catch{return!1}}});var fH=qe,mH=vs,nP=Yi,EH=K,_H=Wn("URL");fH({target:"URL",stat:!0,forced:!EH},{parse:function(t){var e=mH(arguments.length,1),n=nP(t),i=e<2||arguments[1]===void 0?void 0:nP(arguments[1]);try{return new _H(n,i)}catch{return null}}});var iR=R(Oi.URL);let iP=!0,rP=!0;function rR(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function Xh(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(c,l){if(c!==e)return r.apply(this,arguments);const h=p=>{const m=n(p);m&&(l.handleEvent?l.handleEvent(m):l(m))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,h),r.apply(this,[c,h])};const o=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const h=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[c,h])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function gH(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(iP=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function SH(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(rP=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function sP(){if(typeof window=="object"){if(iP)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function xw(t,e){rP&&console.warn(t+" is deprecated, please use "+e+" instead.")}function oP(t){return Object.prototype.toString.call(t)==="[object Object]"}function aP(t){var e;return oP(t)?qi(e=Object.keys(t)).call(e,function(n,i){const r=oP(t[i]),o=r?aP(t[i]):t[i],c=r&&!Object.keys(o).length;return o===void 0||c?n:Object.assign(n,{[i]:o})},{}):t}function Uw(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Uw(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{Uw(t,t.get(r),n)})}))}function cP(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&o.push(c)}),o.forEach(c=>{t.forEach(l=>{l.type===i&&l.trackId===c.id&&Uw(t,l,r)})}),r}const lP=sP;function dP(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const p=typeof c[h]=="object"?c[h]:{ideal:c[h]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const m=function(S,v){return S?S+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(p.ideal!==void 0){l.optional=l.optional||[];let S={};typeof p.ideal=="number"?(S[m("min",h)]=p.ideal,l.optional.push(S),S={},S[m("max",h)]=p.ideal,l.optional.push(S)):(S[m("",h)]=p.ideal,l.optional.push(S))}p.exact!==void 0&&typeof p.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[m("",h)]=p.exact):["min","max"].forEach(S=>{p[S]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[m(S,h)]=p[S])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(e.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const h=function(p,m,S){m in p&&!(S in p)&&(p[S]=p[m],delete p[m])};h((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),h(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let h=c.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const p=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||p)){let m;if(delete c.video.facingMode,h.exact==="environment"||h.ideal==="environment"?m=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(m=["front"]),m)return n.mediaDevices.enumerateDevices().then(S=>{let v=(S=S.filter(y=>y.kind==="videoinput")).find(y=>m.some(P=>{var I;return Ct(I=y.label.toLowerCase()).call(I,P)}));return!v&&S.length&&Ct(m).call(m,"back")&&(v=S[S.length-1]),v&&(c.video.deviceId=h.exact?{exact:v.deviceId}:{ideal:v.deviceId}),c.video=i(c.video),lP("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return lP("chrome: "+JSON.stringify(c)),l(c)},o=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,h){r(c,p=>{n.webkitGetUserMedia(p,l,m=>{h&&h(o(m))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,h=>c(h).then(p=>{if(h.audio&&!p.getAudioTracks().length||h.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return p},p=>At.reject(o(p))))}}}function uP(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function hP(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const o=new Event("track");o.track=i.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[n.stream],this.dispatchEvent(o)}),n.stream.getTracks().forEach(i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const o=new Event("track");o.track=i,o.receiver=r,o.transceiver={receiver:r},o.streams=[n.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Xh(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function pP(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){let h=r.apply(this,arguments);return h||(h=e(this,c),this._senders.push(h)),h};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){o.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const c=this._senders.find(l=>l.track===o);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function fP(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const o=function(l){const h={};return l.result().forEach(p=>{const m={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(S=>{m[S]=p.stat(S)}),h[m.id]=m}),h},c=function(l){return new Map(Object.keys(l).map(h=>[h,l[h]]))};if(arguments.length>=2){const l=function(h){i(c(o(h)))};return e.apply(this,[l,n])}return new At((l,h)=>{e.apply(this,[function(p){l(c(o(p)))},h])}).then(i,r)}}function mP(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>cP(o,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Xh(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>cP(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,r,o;return this.getSenders().forEach(c=>{c.track===n&&(i?o=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(r?o=!0:r=c),c.track===n)),o||i&&r?At.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():At.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function EP(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(h=>c.indexOf(h)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(o);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function _P(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return EP(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const h=n.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(p=>this._reverseStreams[p.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(p=>{if(this.getSenders().find(S=>S.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const p=new t.MediaStream(h.getTracks());this._streams[h.id]=p,this._reverseStreams[p.id]=h,h=p}i.apply(this,[h])};const r=t.RTCPeerConnection.prototype.removeStream;function o(h,p){let m=p.sdp;return Object.keys(h._reverseStreams||[]).forEach(S=>{const v=h._reverseStreams[S],y=h._streams[v.id];m=m.replace(new RegExp(y.id,"g"),v.id)}),new RTCSessionDescription({type:p.type,sdp:m})}t.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},t.RTCPeerConnection.prototype.addTrack=function(h,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(y=>y===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[p.id];if(v)v.addTrack(h),At.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new t.MediaStream([h]);this._streams[p.id]=y,this._reverseStreams[y.id]=p,this.addStream(y)}return this.getSenders().find(y=>y.track===h)},["createOffer","createAnswer"].forEach(function(h){const p=t.RTCPeerConnection.prototype[h],m={[h](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[v=>{const y=o(this,v);S[0].apply(null,[y])},v=>{S[1]&&S[1].apply(null,v)},arguments[2]]):p.apply(this,arguments).then(v=>o(this,v))}};t.RTCPeerConnection.prototype[h]=m[h]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(h,p){let m=p.sdp;return Object.keys(h._reverseStreams||[]).forEach(S=>{const v=h._reverseStreams[S],y=h._streams[v.id];m=m.replace(new RegExp(v.id,"g"),y.id)}),new RTCSessionDescription({type:p.type,sdp:m})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const h=l.get.apply(this);return h.type===""?h:o(this,h)}}),t.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(S=>h.track===S)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Vw(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function gP(t,e){Xh(t,"negotiationneeded",n=>{const i=n.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var SP=Object.freeze({__proto__:null,fixNegotiationNeeded:gP,shimAddTrackRemoveTrack:_P,shimAddTrackRemoveTrackWithNative:EP,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const r=n.video&&n.video.width,o=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},r&&(n.video.mandatory.maxWidth=r),o&&(n.video.mandatory.maxHeight=o),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:pP,shimGetStats:fP,shimGetUserMedia:dP,shimMediaStream:uP,shimOnTrack:hP,shimPeerConnection:Vw,shimSenderReceiverGetStats:mP});function TP(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,o,c){xw("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(o,c)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(c,l,h){l in c&&!(h in c)&&(c[h]=c[l],delete c[l])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c.audio,"autoGainControl","mozAutoGainControl"),r(c.audio,"noiseSuppression","mozNoiseSuppression")),o(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function vP(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Bw(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=t.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=c[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,o,c]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(h=>{h.type=n[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;l.forEach((p,m)=>{l.set(m,Object.assign({},p,{type:n[p.type]||p.type}))})}return l}).then(o,c)}}function yP(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):At.resolve(new Map)}}function RP(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Xh(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function bP(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){xw("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&Ct(i=e.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function CP(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function AP(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:o}=r,c=o.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,o.sendEncodings=n,this.setParametersPromises.push(o.setParameters(c).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function wP(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function IP(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?At.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function OP(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?At.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var NP=Object.freeze({__proto__:null,shimAddTransceiver:AP,shimCreateAnswer:OP,shimCreateOffer:IP,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,At.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:wP,shimGetUserMedia:TP,shimOnTrack:vP,shimPeerConnection:Bw,shimRTCDataChannel:CP,shimReceiverGetStats:RP,shimRemoveStream:bP,shimSenderGetStats:yP});function DP(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),Ct(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return r&&r.forEach(c=>{var l;this._localStreams?Ct(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(r=>{Ct(i).call(i,r.track)&&this.removeTrack(r)})})}}function PP(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),Ct(o=this._remoteStreams).call(o,r))return;this._remoteStreams.push(r);const c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,n.dispatchEvent(o)})}),e.apply(n,arguments)}}}function LP(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(h,p){const m=arguments.length>=2?arguments[2]:arguments[0],S=n.apply(this,[m]);return p?(S.then(h,p),At.resolve()):S},e.createAnswer=function(h,p){const m=arguments.length>=2?arguments[2]:arguments[0],S=i.apply(this,[m]);return p?(S.then(h,p),At.resolve()):S};let l=function(h,p,m){const S=r.apply(this,[h]);return m?(S.then(p,m),At.resolve()):S};e.setLocalDescription=l,l=function(h,p,m){const S=o.apply(this,[h]);return m?(S.then(p,m),At.resolve()):S},e.setRemoteDescription=l,l=function(h,p,m){const S=c.apply(this,[h]);return m?(S.then(p,m),At.resolve()):S},e.addIceCandidate=l}function kP(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(MP(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,r){e.mediaDevices.getUserMedia(n).then(i,r)}).bind(e))}function MP(t){return t&&t.video!==void 0?Object.assign({},t,{video:aP(t.video)}):t}function xP(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let o=0;o<n.iceServers.length;o++){let c=n.iceServers[o];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(xw("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,r.push(c)):r.push(n.iceServers[o])}n.iceServers=r}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function UP(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function VP(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function BP(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var jP=Object.freeze({__proto__:null,shimAudioContext:BP,shimCallbacksAPI:LP,shimConstraints:MP,shimCreateOfferLegacy:VP,shimGetUserMedia:kP,shimLocalStreamsAPI:DP,shimRTCIceServerUrls:xP,shimRemoteStreamsAPI:PP,shimTrackEventTransceiver:UP}),FP=`	
\v\f\r                　\u2028\u2029\uFEFF`,TH=Pn,vH=Yi,jw=FP,GP=Y("".replace),yH=RegExp("^["+jw+"]+"),RH=RegExp("(^|[^"+jw+"])["+jw+"]+$"),bH=function(t){return function(e){var n=vH(TH(e));return 1&t&&(n=GP(n,yH,"")),2&t&&(n=GP(n,RH,"$1")),n}},CH={trim:bH(3)},AH=Lf.PROPER,wH=w,HP=FP,IH=CH.trim;qe({target:"String",proto:!0,forced:function(t){return wH(function(){return!!HP[t]()||"​᠎"[t]()!=="​᠎"||AH&&HP[t].name!==t})}("trim")},{trim:function(){return IH(this)}});var OH=Zr("String","trim"),NH=et,DH=OH,Fw=String.prototype,PH=function(t){var e=t.trim;return typeof t=="string"||t===Fw||NH(Fw,t)&&e===Fw.trim?DH:e},pr=R(PH),WP={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":r.relatedAddress=i[o+1];break;case"rport":r.relatedPort=parseInt(i[o+1],10);break;case"tcptype":r.tcpType=i[o+1];break;case"ufrag":r.ufrag=i[o+1],r.usernameFragment=i[o+1];break;default:r[i[o]]===void 0&&(r[i[o]]=i[o+1])}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const o=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<o.length;c++)r=o[c].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?o.push(c+"="+n.parameters[c]):o.push(c)}),i+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(r.attribute=n.substring(i+1,o),r.value=n.substring(o+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],o=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");i.profile=r[2];for(let c=3;c<r.length;c++){const l=r[c],h=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(h){const p=e.parseRtpMap(h),m=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(p.parameters=m.length?e.parseFmtp(m[0]):{},p.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(p.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{o.forEach(l=>{c.rtcpFeedback.find(h=>h.type===l.type&&h.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{r+=e.writeRtpMap(c),r+=e.writeFmtp(c),r+=e.writeRtcpFb(c)});let o=0;return i.codecs.forEach(c=>{c.maxptime>o&&(o=c.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{r+=e.writeExtmap(c)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),o=r.fecMechanisms.indexOf("RED")!==-1,c=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(v=>e.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),h=l.length>0&&l[0].ssrc;let p;const m=e.matchPrefix(n,"a=ssrc-group:FID").map(v=>v.substring(17).split(" ").map(y=>parseInt(y,10)));m.length>0&&m[0].length>1&&m[0][0]===h&&(p=m[0][1]),r.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let y={ssrc:h,codecPayloadType:parseInt(v.parameters.apt,10)};h&&p&&(y.rtx={ssrc:p}),i.push(y),o&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:h,mechanism:c?"red+ulpfec":"red"},i.push(y))}}),i.length===0&&h&&i.push({ssrc:h});let S=e.matchPrefix(n,"b=");return S.length&&(S=S[0].indexOf("b=TIAS:")===0?parseInt(S[0].substring(7),10):S[0].indexOf("b=AS:")===0?1e3*parseInt(S[0].substring(5),10)*.95-16e3:void 0,i.forEach(v=>{v.maxBitrate=S})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const c=e.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return o.length>0?(i=o[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const c=e.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const h=l[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let o;const c=i!==void 0?i:2;return o=n||e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+o+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(WP);var KP=WP.exports,Dm=R(KP),LH=_({__proto__:null,default:Dm},[KP]);function sR(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),r=Dm.parseCandidate(n.candidate),o=Object.assign(i,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,Xh(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Gw(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Xh(t,"icecandidate",e=>{if(e.candidate){const n=Dm.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function oR(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:i}=this.getConfiguration();i==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(i){if(!i||!i.sdp)return!1;const r=Dm.splitSections(i.sdp);return r.shift(),r.some(o=>{const c=Dm.parseMLine(o);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const i=function(h){const p=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const m=parseInt(p[1],10);return m!=m?-1:m}(arguments[0]),r=function(h){let p=65536;return e.browser==="firefox"&&(p=e.version<57?h===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),p}(i),o=function(h,p){let m=65536;e.browser==="firefox"&&e.version===57&&(m=65535);const S=Dm.matchPrefix(h.sdp,"a=max-message-size:");return S.length>0?m=parseInt(S[0].substr(19),10):e.browser==="firefox"&&p!==-1&&(m=2147483637),m}(arguments[0],i);let c;c=r===0&&o===0?Number.POSITIVE_INFINITY:r===0||o===0?Math.max(r,o):Math.min(r,o);const l={};Object.defineProperty(l,"maxMessageSize",{get:()=>c}),this._sctp=l}return n.apply(this,arguments)}}function aR(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const o=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Xh(t,"datachannel",i=>(e(i.channel,i.target),i))}function Hw(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const c=new Event("connectionstatechange",r);o.dispatchEvent(c)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Ww(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(o=>pr(o).call(o)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function cR(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?At.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),At.resolve())})}function lR(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var kH=Object.freeze({__proto__:null,removeExtmapAllowMixed:Ww,shimAddIceCandidateNullOrEmpty:cR,shimConnectionState:Hw,shimMaxMessageSize:oR,shimParameterlessSetLocalDescription:lR,shimRTCIceCandidate:sR,shimRTCIceCandidateRelayProtocol:Gw,shimSendThrowTypeError:aR});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=sP,i=function(o){const c={browser:null,version:null};if(o===void 0||!o.navigator)return c.browser="Not a browser.",c;const{navigator:l}=o;if(l.mozGetUserMedia)c.browser="firefox",c.version=rR(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)c.browser="chrome",c.version=rR(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=rR(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return c}(t),r={browserDetails:i,commonShim:kH,extractVersion:rR,disableLog:gH,disableWarnings:SH,sdp:LH};switch(i.browser){case"chrome":if(!SP||!Vw||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=SP,cR(t,i),lR(t),dP(t,i),uP(t),Vw(t,i),hP(t),_P(t,i),pP(t),fP(t),mP(t),gP(t,i),sR(t),Gw(t),Hw(t),oR(t,i),aR(t),Ww(t,i);break;case"firefox":if(!NP||!Bw||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=NP,cR(t,i),lR(t),TP(t,i),Bw(t,i),vP(t),bP(t),yP(t),RP(t),CP(t),AP(t),wP(t),IP(t),OP(t),sR(t),Hw(t),oR(t,i),aR(t);break;case"safari":if(!jP||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=jP,cR(t,i),lR(t),xP(t),VP(t),LP(t),DP(t),PP(t),UP(t),kP(t),BP(t),sR(t),Gw(t),oR(t,i),aR(t),Ww(t,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var zP=Tn,MH=TypeError,YP=lr.match(/firefox\/(\d+)/i),xH=!!YP&&+YP[1],UH=/MSIE|Trident/.test(lr),qP=lr.match(/AppleWebKit\/(\d+)\./),VH=!!qP&&+qP[1],BH=qe,XP=Y,jH=Zn,FH=$n,JP=dc,GH=function(t,e){if(!delete t[e])throw new MH("Cannot delete property "+zP(e)+" of "+zP(t))},QP=Yi,Kw=w,HH=vt,WH=Ad,ZP=xH,KH=UH,$P=oi,tL=VH,ru=[],eL=XP(ru.sort),zH=XP(ru.push),YH=Kw(function(){ru.sort(void 0)}),qH=Kw(function(){ru.sort(null)}),XH=WH("sort"),nL=!Kw(function(){if($P)return $P<70;if(!(ZP&&ZP>3)){if(KH)return!0;if(tL)return tL<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)ru.push({k:e+i,v:n})}for(ru.sort(function(o,c){return c.v-o.v}),i=0;i<ru.length;i++)e=ru[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return r!=="DGBEFHACIJK"}});BH({target:"Array",proto:!0,forced:YH||!qH||!XH||!nL},{sort:function(t){t!==void 0&&jH(t);var e=FH(this);if(nL)return t===void 0?eL(e):eL(e,t);var n,i,r=[],o=JP(e);for(i=0;i<o;i++)i in e&&zH(r,e[i]);for(HH(r,function(c){return function(l,h){return h===void 0?-1:l===void 0?1:c!==void 0?+c(l,h)||0:QP(l)>QP(h)?1:-1}}(t)),n=JP(r),i=0;i<n;)e[i]=r[i++];for(;i<o;)GH(e,i++);return e}});var JH=Zr("Array","sort"),QH=et,ZH=JH,zw=Array.prototype,$H=function(t){var e=t.sort;return t===zw||QH(zw,t)&&e===zw.sort?ZH:e},jg=R($H),Yw=J;qe({global:!0,forced:Yw.globalThis!==Yw},{globalThis:Yw});var iL=R(J),qw={exports:{}};(function(t,e){(function(n,i){var r="function",o="undefined",c="object",l="string",h="major",p="model",m="name",S="type",v="vendor",y="version",P="architecture",I="console",O="mobile",M="tablet",U="smarttv",W="wearable",$="embedded",Q="Amazon",q="Apple",ct="ASUS",_t="BlackBerry",Dt="Browser",Mt="Chrome",De="Firefox",Pe="Google",fn="Huawei",Xn="LG",jn="Microsoft",Wr="Motorola",ht="Opera",yt="Samsung",Kt="Sharp",ft="Sony",A="Xiaomi",F="Zebra",H="Facebook",Tt="Chromium OS",he="Mac OS",rn=function(hi){for(var wi={},Rn=0;Rn<hi.length;Rn++)wi[hi[Rn].toUpperCase()]=hi[Rn];return wi},Ai=function(hi,wi){return typeof hi===l&&ls(wi).indexOf(ls(hi))!==-1},ls=function(hi){return hi.toLowerCase()},sd=function(hi,wi){if(typeof hi===l)return hi=hi.replace(/^\s\s*/,""),typeof wi===o?hi:hi.substring(0,350)},Cp=function(hi,wi){for(var Rn,As,sl,Jn,Ke,ds,Cu=0;Cu<wi.length&&!Ke;){var Xa=wi[Cu],Oj=wi[Cu+1];for(Rn=As=0;Rn<Xa.length&&!Ke&&Xa[Rn];)if(Ke=Xa[Rn++].exec(hi))for(sl=0;sl<Oj.length;sl++)ds=Ke[++As],typeof(Jn=Oj[sl])===c&&Jn.length>0?Jn.length===2?typeof Jn[1]==r?this[Jn[0]]=Jn[1].call(this,ds):this[Jn[0]]=Jn[1]:Jn.length===3?typeof Jn[1]!==r||Jn[1].exec&&Jn[1].test?this[Jn[0]]=ds?ds.replace(Jn[1],Jn[2]):i:this[Jn[0]]=ds?Jn[1].call(this,ds,Jn[2]):i:Jn.length===4&&(this[Jn[0]]=ds?Jn[3].call(this,ds.replace(Jn[1],Jn[2])):i):this[Jn]=ds||i;Cu+=2}},jS=function(hi,wi){for(var Rn in wi)if(typeof wi[Rn]===c&&wi[Rn].length>0){for(var As=0;As<wi[Rn].length;As++)if(Ai(wi[Rn][As],hi))return Rn==="?"?i:Rn}else if(Ai(wi[Rn],hi))return Rn==="?"?i:Rn;return hi},rC={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},sC={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,y],[/opios[\/ ]+([\w\.]+)/i],[y,[m,ht+" Mini"]],[/\bopr\/([\w\.]+)/i],[y,[m,ht]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[m,y],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[m,"UC"+Dt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[y,[m,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[y,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[m,"IE"]],[/yabrowser\/([\w\.]+)/i],[y,[m,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+Dt],y],[/\bfocus\/([\w\.]+)/i],[y,[m,De+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[m,ht+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[m,ht+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[m,"MIUI "+Dt]],[/fxios\/([-\w\.]+)/i],[y,[m,De]],[/\bqihu|(qi?ho?o?|360)browser/i],[[m,"360 "+Dt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1 "+Dt],y],[/(comodo_dragon)\/([\w\.]+)/i],[[m,/_/g," "],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[m,y],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,H],y],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[m,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[m,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[m,Mt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,Mt+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[m,"Android "+Dt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[y,jS,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[m,De+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[m,y],[/(cobalt)\/([\w\.]+)/i],[m,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[P,"amd64"]],[/(ia32(?=;))/i],[[P,ls]],[/((?:i[346]|x)86)[;\)]/i],[[P,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[P,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[P,"armhf"]],[/windows (ce|mobile); ppc;/i],[[P,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[P,/ower/,"",ls]],[/(sun4\w)[;\)]/i],[[P,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[P,ls]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[v,yt],[S,M]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[v,yt],[S,O]],[/\((ip(?:hone|od)[\w ]*);/i],[p,[v,q],[S,O]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[v,q],[S,M]],[/(macintosh);/i],[p,[v,q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[v,Kt],[S,O]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[v,fn],[S,M]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[v,fn],[S,O]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[v,A],[S,O]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[v,A],[S,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[v,"OPPO"],[S,O]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[v,"Vivo"],[S,O]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[v,"Realme"],[S,O]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[v,Wr],[S,O]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[v,Wr],[S,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[v,Xn],[S,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[v,Xn],[S,O]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[v,"Lenovo"],[S,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[v,"Nokia"],[S,O]],[/(pixel c)\b/i],[p,[v,Pe],[S,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[v,Pe],[S,O]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[v,ft],[S,O]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[v,ft],[S,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[v,"OnePlus"],[S,O]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[v,Q],[S,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[v,Q],[S,O]],[/(playbook);[-\w\),; ]+(rim)/i],[p,v,[S,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[v,_t],[S,O]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[v,ct],[S,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[v,ct],[S,O]],[/(nexus 9)/i],[p,[v,"HTC"],[S,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[p,/_/g," "],[S,O]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[v,"Acer"],[S,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[v,"Meizu"],[S,O]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,p,[S,O]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,p,[S,M]],[/(surface duo)/i],[p,[v,jn],[S,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[v,"Fairphone"],[S,O]],[/(u304aa)/i],[p,[v,"AT&T"],[S,O]],[/\bsie-(\w*)/i],[p,[v,"Siemens"],[S,O]],[/\b(rct\w+) b/i],[p,[v,"RCA"],[S,M]],[/\b(venue[\d ]{2,7}) b/i],[p,[v,"Dell"],[S,M]],[/\b(q(?:mv|ta)\w+) b/i],[p,[v,"Verizon"],[S,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[v,"Barnes & Noble"],[S,M]],[/\b(tm\d{3}\w+) b/i],[p,[v,"NuVision"],[S,M]],[/\b(k88) b/i],[p,[v,"ZTE"],[S,M]],[/\b(nx\d{3}j) b/i],[p,[v,"ZTE"],[S,O]],[/\b(gen\d{3}) b.+49h/i],[p,[v,"Swiss"],[S,O]],[/\b(zur\d{3}) b/i],[p,[v,"Swiss"],[S,M]],[/\b((zeki)?tb.*\b) b/i],[p,[v,"Zeki"],[S,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],p,[S,M]],[/\b(ns-?\w{0,9}) b/i],[p,[v,"Insignia"],[S,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[v,"NextBook"],[S,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],p,[S,O]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],p,[S,O]],[/\b(ph-1) /i],[p,[v,"Essential"],[S,O]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[v,"Envizen"],[S,M]],[/\b(trio[-\w\. ]+) b/i],[p,[v,"MachSpeed"],[S,M]],[/\btu_(1491) b/i],[p,[v,"Rotor"],[S,M]],[/(shield[\w ]+) b/i],[p,[v,"Nvidia"],[S,M]],[/(sprint) (\w+)/i],[v,p,[S,O]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[v,jn],[S,O]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[v,F],[S,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[v,F],[S,O]],[/smart-tv.+(samsung)/i],[v,[S,U]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[v,yt],[S,U]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,Xn],[S,U]],[/(apple) ?tv/i],[v,[p,q+" TV"],[S,U]],[/crkey/i],[[p,Mt+"cast"],[v,Pe],[S,U]],[/droid.+aft(\w)( bui|\))/i],[p,[v,Q],[S,U]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[v,Kt],[S,U]],[/(bravia[\w ]+)( bui|\))/i],[p,[v,ft],[S,U]],[/(mitv-\w{5}) bui/i],[p,[v,A],[S,U]],[/Hbbtv.*(technisat) (.*);/i],[v,p,[S,U]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,sd],[p,sd],[S,U]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[S,U]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,p,[S,I]],[/droid.+; (shield) bui/i],[p,[v,"Nvidia"],[S,I]],[/(playstation [345portablevi]+)/i],[p,[v,ft],[S,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[v,jn],[S,I]],[/((pebble))app/i],[v,p,[S,W]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[v,q],[S,W]],[/droid.+; (glass) \d/i],[p,[v,Pe],[S,W]],[/droid.+; (wt63?0{2,3})\)/i],[p,[v,F],[S,W]],[/(quest( 2| pro)?)/i],[p,[v,H],[S,W]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[S,$]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[S,O]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[S,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[S,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[S,O]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[m,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[m,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,y],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[m,[y,jS,rC]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,"Windows"],[y,jS,rC]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,he],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,y],[/\(bb(10);/i],[y,[m,_t]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[m,De+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[m,Mt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,Tt],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,y],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[m,y]]},vo=function(hi,wi){if(typeof hi===c&&(wi=hi,hi=i),!(this instanceof vo))return new vo(hi,wi).getResult();var Rn=typeof n!==o&&n.navigator?n.navigator:i,As=hi||(Rn&&Rn.userAgent?Rn.userAgent:""),sl=Rn&&Rn.userAgentData?Rn.userAgentData:i,Jn=wi?function(Ke,ds){var Cu={};for(var Xa in Ke)ds[Xa]&&ds[Xa].length%2==0?Cu[Xa]=ds[Xa].concat(Ke[Xa]):Cu[Xa]=Ke[Xa];return Cu}(sC,wi):sC;return this.getBrowser=function(){var Ke={};return Ke[m]=i,Ke[y]=i,Cp.call(Ke,As,Jn.browser),Ke[h]=function(ds){return typeof ds===l?ds.replace(/[^\d\.]/g,"").split(".")[0]:i}(Ke[y]),Rn&&Rn.brave&&typeof Rn.brave.isBrave==r&&(Ke[m]="Brave"),Ke},this.getCPU=function(){var Ke={};return Ke[P]=i,Cp.call(Ke,As,Jn.cpu),Ke},this.getDevice=function(){var Ke={};return Ke[v]=i,Ke[p]=i,Ke[S]=i,Cp.call(Ke,As,Jn.device),!Ke[S]&&sl&&sl.mobile&&(Ke[S]=O),Ke[p]=="Macintosh"&&Rn&&typeof Rn.standalone!==o&&Rn.maxTouchPoints&&Rn.maxTouchPoints>2&&(Ke[p]="iPad",Ke[S]=M),Ke},this.getEngine=function(){var Ke={};return Ke[m]=i,Ke[y]=i,Cp.call(Ke,As,Jn.engine),Ke},this.getOS=function(){var Ke={};return Ke[m]=i,Ke[y]=i,Cp.call(Ke,As,Jn.os),!Ke[m]&&sl&&sl.platform!="Unknown"&&(Ke[m]=sl.platform.replace(/chrome os/i,Tt).replace(/macos/i,he)),Ke},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return As},this.setUA=function(Ke){return As=typeof Ke===l&&Ke.length>350?sd(Ke,350):Ke,this},this.setUA(As),this};vo.VERSION="0.7.34",vo.BROWSER=rn([m,y,h]),vo.CPU=rn([P]),vo.DEVICE=rn([p,v,S,I,O,U,M,W,$]),vo.ENGINE=vo.OS=rn([m,y]),t.exports&&(e=t.exports=vo),e.UAParser=vo;var bu=typeof n!==o&&(n.jQuery||n.Zepto);if(bu&&!bu.ua){var Ap=new vo;bu.ua=Ap.getResult(),bu.ua.get=function(){return Ap.getUA()},bu.ua.set=function(hi){Ap.setUA(hi);var wi=Ap.getResult();for(var Rn in wi)bu.ua[Rn]=wi[Rn]}}})(typeof window=="object"?window:g)})(qw,qw.exports);var t6=R(qw.exports),e6=io,n6=ti,i6=Se,r6=gc,s6=Fn("iterator"),o6=Object,a6=function(t){if(i6(t))return!1;var e=o6(t);return e[s6]!==void 0||"@@iterator"in e||n6(r6,e6(e))},c6=R(a6),rL=Ur.clear;qe({global:!0,bind:!0,forced:J.clearImmediate!==rL},{clearImmediate:rL});var sL=J,l6=ot,d6=de,u6=af,h6=lr,p6=Ca,f6=vs,m6=sL.Function,E6=/MSIE .\./.test(h6)||u6==="BUN"&&function(){var t=sL.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),_6=qe,oL=J,aL=Ur.set,g6=function(t,e){var n=1;return E6?function(i,r){var o=f6(arguments.length,1)>n,c=d6(i)?i:m6(i),l=o?p6(arguments,n):[],h=o?function(){l6(c,this,l)}:c;return t(h)}:t},cL=oL.setImmediate?g6(aL):aL;_6({global:!0,bind:!0,forced:oL.setImmediate!==cL},{setImmediate:cL});var lL=R(Oi.setImmediate),S6=J,T6=Zf,v6=Zn,y6=vs,R6=Zt;qe({global:!0,dontCallGetSet:!0,forced:w(function(){return R6&&Object.getOwnPropertyDescriptor(S6,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){y6(arguments.length,1),T6(v6(t))}});var dL=R(Oi.queueMicrotask);function uL(t,e){return function(){return t.apply(e,arguments)}}const{toString:b6}=Object.prototype,{getPrototypeOf:Xw}=Object,dR=(Jw=Object.create(null),t=>{const e=b6.call(t);return Jw[e]||(Jw[e]=e.slice(8,-1).toLowerCase())});var Jw;const xa=t=>(t=t.toLowerCase(),e=>dR(e)===t),uR=t=>e=>typeof e===t,{isArray:Pm}=Array,Fg=uR("undefined"),hL=xa("ArrayBuffer"),C6=uR("string"),uo=uR("function"),pL=uR("number"),hR=t=>t!==null&&typeof t=="object",pR=t=>{if(dR(t)!=="object")return!1;const e=Xw(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||c6(t))},A6=xa("Date"),w6=xa("File"),I6=xa("Blob"),O6=xa("FileList"),N6=xa("URLSearchParams"),[D6,P6,L6,k6]=["ReadableStream","Request","Response","Headers"].map(xa);function Gg(t,e){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Pm(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const o=r?Object.getOwnPropertyNames(t):Object.keys(t),c=o.length;let l;for(n=0;n<c;n++)l=o[n],e.call(null,t[l],l,t)}}function fL(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,r=n.length;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const Jh=iL!==void 0?iL:typeof self<"u"?self:typeof window<"u"?window:xO,mL=t=>!Fg(t)&&t!==Jh,M6=(Qw=typeof Uint8Array<"u"&&Xw(Uint8Array),t=>Qw&&t instanceof Qw);var Qw;const x6=xa("HTMLFormElement"),EL=(t=>{let{hasOwnProperty:e}=t;return(n,i)=>e.call(n,i)})(Object.prototype),U6=xa("RegExp"),_L=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};Gg(n,(r,o)=>{let c;(c=e(r,o,t))!==!1&&(i[o]=c||r)}),Object.defineProperties(t,i)},Zw="abcdefghijklmnopqrstuvwxyz",gL="0123456789",SL={DIGIT:gL,ALPHA:Zw,ALPHA_DIGIT:Zw+Zw.toUpperCase()+gL},V6=xa("AsyncFunction"),TL=(vL=typeof lL=="function",yL=uo(Jh.postMessage),vL?lL:yL?($w="axios@".concat(Math.random()),fR=[],Jh.addEventListener("message",t=>{let{source:e,data:n}=t;e===Jh&&n===$w&&fR.length&&fR.shift()()},!1),t=>{fR.push(t),Jh.postMessage($w,"*")}):t=>setTimeout(t));var vL,yL,$w,fR;const B6=dL!==void 0?dL.bind(Jh):typeof process<"u"&&process.nextTick||TL;var wt={isArray:Pm,isArrayBuffer:hL,isBuffer:function(t){return t!==null&&!Fg(t)&&t.constructor!==null&&!Fg(t.constructor)&&uo(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||uo(t.append)&&((e=dR(t))==="formdata"||e==="object"&&uo(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&hL(t.buffer),e},isString:C6,isNumber:pL,isBoolean:t=>t===!0||t===!1,isObject:hR,isPlainObject:pR,isReadableStream:D6,isRequest:P6,isResponse:L6,isHeaders:k6,isUndefined:Fg,isDate:A6,isFile:w6,isBlob:I6,isRegExp:U6,isFunction:uo,isStream:t=>hR(t)&&uo(t.pipe),isURLSearchParams:N6,isTypedArray:M6,isFileList:O6,forEach:Gg,merge:function t(){const{caseless:e}=mL(this)&&this||{},n={},i=(r,o)=>{const c=e&&fL(n,o)||o;pR(n[c])&&pR(r)?n[c]=t(n[c],r):pR(r)?n[c]=t({},r):Pm(r)?n[c]=r.slice():n[c]=r};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&Gg(arguments[r],i);return n},extend:function(t,e,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Gg(e,(r,o)=>{n&&uo(r)?t[o]=uL(r,n):t[o]=r},{allOwnKeys:i}),t},trim:t=>pr(t)?pr(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let r,o,c;const l={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),o=r.length;o-- >0;)c=r[o],i&&!i(c,t,e)||l[c]||(e[c]=t[c],l[c]=!0);t=n!==!1&&Xw(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:dR,kindOfTest:xa,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},toArray:t=>{if(!t)return null;if(Pm(t))return t;let e=t.length;if(!pL(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=n.next())&&!i.done;){const r=i.value;e.call(t,r[0],r[1])}},matchAll:(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},isHTMLForm:x6,hasOwnProperty:EL,hasOwnProp:EL,reduceDescriptors:_L,freezeMethods:t=>{_L(t,(e,n)=>{if(uo(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];uo(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},i=r=>{r.forEach(o=>{n[o]=!0})};return Pm(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:fL,global:Jh,isContextDefined:mL,ALPHABET:SL,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:SL.ALPHA_DIGIT,n="";const{length:i}=e;for(;t--;)n+=e[Math.random()*i|0];return n},isSpecCompliantForm:function(t){return!!(t&&uo(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(i,r)=>{if(hR(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const o=Pm(i)?[]:{};return Gg(i,(c,l)=>{const h=n(c,r+1);!Fg(h)&&(o[l]=h)}),e[r]=void 0,o}}return i};return n(t,0)},isAsyncFn:V6,isThenable:t=>t&&(hR(t)||uo(t))&&uo(t.then)&&uo(t.catch),setImmediate:TL,asap:B6};function en(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}wt.inherits(en,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:wt.toJSONObject(this.config),code:this.code,status:this.status}}});const RL=en.prototype,bL={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{bL[t]={value:t}}),Object.defineProperties(en,bL),Object.defineProperty(RL,"isAxiosError",{value:!0}),en.from=(t,e,n,i,r,o)=>{const c=Object.create(RL);return wt.toFlatObject(t,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),en.call(c,t.message,e,n,i,r),c.cause=t,c.name=t.name,o&&Object.assign(c,o),c};function t0(t){return wt.isPlainObject(t)||wt.isArray(t)}function CL(t){return wt.endsWith(t,"[]")?t.slice(0,-2):t}function AL(t,e,n){return t?t.concat(e).map(function(i,r){return i=CL(i),!n&&r?"["+i+"]":i}).join(n?".":""):e}const j6=wt.toFlatObject(wt,{},null,function(t){return/^is[A-Z]/.test(t)});function mR(t,e,n){if(!wt.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=wt.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,y){return!wt.isUndefined(y[v])})).metaTokens,r=n.visitor||p,o=n.dots,c=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&wt.isSpecCompliantForm(e);if(!wt.isFunction(r))throw new TypeError("visitor must be a function");function h(v){if(v===null)return"";if(wt.isDate(v))return v.toISOString();if(!l&&wt.isBlob(v))throw new en("Blob is not supported. Use a Buffer instead.");return wt.isArrayBuffer(v)||wt.isTypedArray(v)?l&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function p(v,y,P){let I=v;if(v&&!P&&typeof v=="object"){if(wt.endsWith(y,"{}"))y=i?y:y.slice(0,-2),v=JSON.stringify(v);else if(wt.isArray(v)&&function(O){return wt.isArray(O)&&!O.some(t0)}(v)||(wt.isFileList(v)||wt.endsWith(y,"[]"))&&(I=wt.toArray(v)))return y=CL(y),I.forEach(function(O,M){!wt.isUndefined(O)&&O!==null&&e.append(c===!0?AL([y],M,o):c===null?y:y+"[]",h(O))}),!1}return!!t0(v)||(e.append(AL(P,y,o),h(v)),!1)}const m=[],S=Object.assign(j6,{defaultVisitor:p,convertValue:h,isVisitable:t0});if(!wt.isObject(t))throw new TypeError("data must be an object");return function v(y,P){if(!wt.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+P.join("."));m.push(y),wt.forEach(y,function(I,O){(!(wt.isUndefined(I)||I===null)&&r.call(e,I,wt.isString(O)?pr(O).call(O):O,P,S))===!0&&v(I,P?P.concat(O):[O])}),m.pop()}}(t),e}function wL(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function e0(t,e){this._pairs=[],t&&mR(t,this,e)}const IL=e0.prototype;function F6(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function OL(t,e,n){if(!e)return t;const i=n&&n.encode||F6;wt.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let o;if(o=r?r(e,n):wt.isURLSearchParams(e)?e.toString():new e0(e,n).toString(i),o){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}IL.append=function(t,e){this._pairs.push([t,e])},IL.toString=function(t){const e=t?function(n){return t.call(this,n,wL)}:wL;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var NL=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){wt.forEach(this.handlers,function(e){e!==null&&t(e)})}},DL={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},PL={exports:{}},G6=qe,H6=Zt,LL=Ns.f;G6({target:"Object",stat:!0,forced:Object.defineProperty!==LL,sham:!H6},{defineProperty:LL});var kL=Oi.Object,W6=PL.exports=function(t,e,n){return kL.defineProperty(t,e,n)};kL.defineProperty.sham&&(W6.sham=!0);var ML=R(PL.exports),K6=TypeError,xL=so,z6=wh,Y6=pi,q6=Fn("species"),UL=Array,X6=function(t){var e;return xL(t)&&(e=t.constructor,(z6(e)&&(e===UL||xL(e.prototype))||Y6(e)&&(e=e[q6])===null)&&(e=void 0)),e===void 0?UL:e},VL=function(t,e){return new(X6(t))(e===0?0:e)},J6=w,Q6=oi,Z6=Fn("species"),BL=function(t){return Q6>=51||!J6(function(){var e=[];return(e.constructor={})[Z6]=function(){return{foo:1}},e[t](Boolean).foo!==1})},$6=qe,tW=w,eW=so,nW=pi,iW=$n,rW=dc,jL=function(t){if(t>9007199254740991)throw K6("Maximum allowed index exceeded");return t},FL=fw,sW=VL,oW=BL,aW=oi,GL=Fn("isConcatSpreadable"),cW=aW>=51||!tW(function(){var t=[];return t[GL]=!1,t.concat()[0]!==t}),lW=function(t){if(!nW(t))return!1;var e=t[GL];return e!==void 0?!!e:eW(t)};$6({target:"Array",proto:!0,forced:!cW||!oW("concat")},{concat:function(t){var e,n,i,r,o,c=iW(this),l=sW(c,0),h=0;for(e=-1,i=arguments.length;e<i;e++)if(lW(o=e===-1?c:arguments[e]))for(r=rW(o),jL(h+r),n=0;n<r;n++,h++)n in o&&FL(l,h,o[n]);else jL(h+1),FL(l,h++,o);return l.length=h,l}});var HL={},dW=Bt,uW=Ii,WL=ih.f,hW=Ca,KL=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];HL.f=function(t){return KL&&dW(t)==="Window"?function(e){try{return WL(e)}catch{return hW(KL)}}(t):WL(uW(t))};var Lm={},pW=Fn;Lm.f=pW;var zL=Oi,fW=ti,mW=Lm,EW=Ns.f,xi=function(t){var e=zL.Symbol||(zL.Symbol={});fW(e,t)||EW(e,t,{value:mW.f(t)})},_W=Gt,gW=Wn,SW=Fn,TW=Mo,YL=function(){var t=gW("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=SW("toPrimitive");e&&!e[i]&&TW(e,i,function(r){return _W(n,this)},{})},vW=Os,yW=Le,RW=$n,bW=dc,CW=VL,qL=Y([].push),AW=function(t){var e=t===1,n=t===2,i=t===3,r=t===4,o=t===6,c=t===7,l=t===5||o;return function(h,p,m,S){for(var v,y,P=RW(h),I=yW(P),O=bW(I),M=vW(p,m),U=0,W=S||CW,$=e?W(h,O):n||c?W(h,0):void 0;O>U;U++)if((l||U in I)&&(y=M(v=I[U],U,P),t))if(e)$[U]=y;else if(y)switch(t){case 3:return!0;case 5:return v;case 6:return U;case 2:qL($,v)}else switch(t){case 4:return!1;case 7:qL($,v)}return o?-1:i||r?r:$}},XL={forEach:AW(0)},ER=qe,Hg=J,n0=Gt,wW=Y,km=Zt,Mm=rc,IW=w,Rr=ti,OW=et,i0=Tr,_R=Ii,r0=cc,NW=Yi,s0=zt,xm=vl,JL=Po,DW=ih,QL=HL,PW=sh,ZL=Re,$L=Ns,LW=_f,tk=Nt,ek=Mo,kW=Ch,o0=no,nk=Pd,ik=Fp,MW=Fn,xW=Lm,UW=xi,VW=YL,BW=Es,rk=vc,gR=XL.forEach,js=mc("hidden"),SR="Symbol",Wg="prototype",jW=rk.set,sk=rk.getterFor(SR),Ua=Object[Wg],Qh=Hg.Symbol,TR=Qh&&Qh[Wg],FW=Hg.RangeError,GW=Hg.TypeError,a0=Hg.QObject,ok=ZL.f,Zh=$L.f,ak=QL.f,HW=tk.f,ck=wW([].push),Wl=o0("symbols"),Kg=o0("op-symbols"),WW=o0("wks"),c0=!a0||!a0[Wg]||!a0[Wg].findChild,lk=function(t,e,n){var i=ok(Ua,e);i&&delete Ua[e],Zh(t,e,n),i&&t!==Ua&&Zh(Ua,e,i)},l0=km&&IW(function(){return xm(Zh({},"a",{get:function(){return Zh(this,"a",{value:7}).a}})).a!==7})?lk:Zh,d0=function(t,e){var n=Wl[t]=xm(TR);return jW(n,{type:SR,tag:t,description:e}),km||(n.description=e),n},vR=function(t,e,n){t===Ua&&vR(Kg,e,n),i0(t);var i=r0(e);return i0(n),Rr(Wl,i)?(n.enumerable?(Rr(t,js)&&t[js][i]&&(t[js][i]=!1),n=xm(n,{enumerable:s0(0,!1)})):(Rr(t,js)||Zh(t,js,s0(1,xm(null))),t[js][i]=!0),l0(t,i,n)):Zh(t,i,n)},u0=function(t,e){i0(t);var n=_R(e),i=JL(n).concat(pk(n));return gR(i,function(r){km&&!n0(dk,n,r)||vR(t,r,n[r])}),t},dk=function(t){var e=r0(t),n=n0(HW,this,e);return!(this===Ua&&Rr(Wl,e)&&!Rr(Kg,e))&&(!(n||!Rr(this,e)||!Rr(Wl,e)||Rr(this,js)&&this[js][e])||n)},uk=function(t,e){var n=_R(t),i=r0(e);if(n!==Ua||!Rr(Wl,i)||Rr(Kg,i)){var r=ok(n,i);return!r||!Rr(Wl,i)||Rr(n,js)&&n[js][i]||(r.enumerable=!0),r}},hk=function(t){var e=ak(_R(t)),n=[];return gR(e,function(i){Rr(Wl,i)||Rr(nk,i)||ck(n,i)}),n},pk=function(t){var e=t===Ua,n=ak(e?Kg:_R(t)),i=[];return gR(n,function(r){!Rr(Wl,r)||e&&!Rr(Ua,r)||ck(i,Wl[r])}),i};Mm||(Qh=function(){if(OW(TR,this))throw new GW("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?NW(arguments[0]):void 0,e=ik(t),n=function(i){var r=this===void 0?Hg:this;r===Ua&&n0(n,Kg,i),Rr(r,js)&&Rr(r[js],e)&&(r[js][e]=!1);var o=s0(1,i);try{l0(r,e,o)}catch(c){if(!(c instanceof FW))throw c;lk(r,e,o)}};return km&&c0&&l0(Ua,e,{configurable:!0,set:n}),d0(e,t)},ek(TR=Qh[Wg],"toString",function(){return sk(this).tag}),ek(Qh,"withoutSetter",function(t){return d0(ik(t),t)}),tk.f=dk,$L.f=vR,LW.f=u0,ZL.f=uk,DW.f=QL.f=hk,PW.f=pk,xW.f=function(t){return d0(MW(t),t)},km&&kW(TR,"description",{configurable:!0,get:function(){return sk(this).description}})),ER({global:!0,wrap:!0,forced:!Mm,sham:!Mm},{Symbol:Qh}),gR(JL(WW),function(t){UW(t)}),ER({target:SR,stat:!0,forced:!Mm},{useSetter:function(){c0=!0},useSimple:function(){c0=!1}}),ER({target:"Object",stat:!0,forced:!Mm,sham:!km},{create:function(t,e){return e===void 0?xm(t):u0(xm(t),e)},defineProperty:vR,defineProperties:u0,getOwnPropertyDescriptor:uk}),ER({target:"Object",stat:!0,forced:!Mm},{getOwnPropertyNames:hk}),VW(),BW(Qh,SR),nk[js]=!0;var fk=rc&&!!Symbol.for&&!!Symbol.keyFor,KW=qe,zW=Wn,YW=ti,qW=Yi,mk=no,XW=fk,h0=mk("string-to-symbol-registry"),JW=mk("symbol-to-string-registry");KW({target:"Symbol",stat:!0,forced:!XW},{for:function(t){var e=qW(t);if(YW(h0,e))return h0[e];var n=zW("Symbol")(e);return h0[e]=n,JW[n]=e,n}});var QW=qe,ZW=ti,$W=No,t8=Tn,e8=fk,Ek=no("symbol-to-string-registry");QW({target:"Symbol",stat:!0,forced:!e8},{keyFor:function(t){if(!$W(t))throw new TypeError(t8(t)+" is not a symbol");if(ZW(Ek,t))return Ek[t]}});var _k=so,n8=de,gk=Bt,i8=Yi,Sk=Y([].push),r8=qe,Tk=Wn,vk=ot,s8=Gt,zg=Y,yk=w,Rk=de,bk=No,Ck=Ca,o8=function(t){if(n8(t))return t;if(_k(t)){for(var e=t.length,n=[],i=0;i<e;i++){var r=t[i];typeof r=="string"?Sk(n,r):typeof r!="number"&&gk(r)!=="Number"&&gk(r)!=="String"||Sk(n,i8(r))}var o=n.length,c=!0;return function(l,h){if(c)return c=!1,h;if(_k(this))return h;for(var p=0;p<o;p++)if(n[p]===l)return h}}},a8=rc,c8=String,su=Tk("JSON","stringify"),yR=zg(/./.exec),Ak=zg("".charAt),l8=zg("".charCodeAt),d8=zg("".replace),u8=zg(1 .toString),h8=/[\uD800-\uDFFF]/g,wk=/^[\uD800-\uDBFF]$/,Ik=/^[\uDC00-\uDFFF]$/,Ok=!a8||yk(function(){var t=Tk("Symbol")("stringify detection");return su([t])!=="[null]"||su({a:t})!=="{}"||su(Object(t))!=="{}"}),Nk=yk(function(){return su("\uDF06\uD834")!=='"\\udf06\\ud834"'||su("\uDEAD")!=='"\\udead"'}),p8=function(t,e){var n=Ck(arguments),i=o8(e);if(Rk(i)||t!==void 0&&!bk(t))return n[1]=function(r,o){if(Rk(i)&&(o=s8(i,this,c8(r),o)),!bk(o))return o},vk(su,null,n)},f8=function(t,e,n){var i=Ak(n,e-1),r=Ak(n,e+1);return yR(wk,t)&&!yR(Ik,r)||yR(Ik,t)&&!yR(wk,i)?"\\u"+u8(l8(t,0),16):t};su&&r8({target:"JSON",stat:!0,forced:Ok||Nk},{stringify:function(t,e,n){var i=Ck(arguments),r=vk(Ok?p8:su,null,i);return Nk&&typeof r=="string"?d8(r,h8,f8):r}});var Dk=sh,m8=$n;qe({target:"Object",stat:!0,forced:!rc||w(function(){Dk.f(1)})},{getOwnPropertySymbols:function(t){var e=Dk.f;return e?e(m8(t)):[]}}),xi("asyncIterator"),xi("hasInstance"),xi("isConcatSpreadable"),xi("iterator"),xi("match"),xi("matchAll"),xi("replace"),xi("search"),xi("species"),xi("split");var E8=YL;xi("toPrimitive"),E8();var _8=Wn,g8=Es;xi("toStringTag"),g8(_8("Symbol"),"Symbol"),xi("unscopables"),Es(J.JSON,"JSON",!0);var S8=Oi.Symbol,T8=Fn,v8=Ns.f,Pk=T8("metadata"),Lk=Function.prototype;Lk[Pk]===void 0&&v8(Lk,Pk,{value:null}),xi("asyncDispose"),xi("dispose"),xi("metadata");var y8=S8,R8=Y,p0=Wn("Symbol"),b8=p0.keyFor,C8=R8(p0.prototype.valueOf),kk=p0.isRegisteredSymbol||function(t){try{return b8(C8(t))!==void 0}catch{return!1}};qe({target:"Symbol",stat:!0},{isRegisteredSymbol:kk});for(var A8=no,Mk=Wn,w8=Y,I8=No,O8=Fn,RR=Mk("Symbol"),xk=RR.isWellKnownSymbol,Uk=Mk("Object","getOwnPropertyNames"),N8=w8(RR.prototype.valueOf),Vk=A8("wks"),f0=0,Bk=Uk(RR),D8=Bk.length;f0<D8;f0++)try{var jk=Bk[f0];I8(RR[jk])&&O8(jk)}catch{}var Fk=function(t){if(xk&&xk(t))return!0;try{for(var e=N8(t),n=0,i=Uk(Vk),r=i.length;n<r;n++)if(Vk[i[n]]==e)return!0}catch{}return!1};qe({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Fk}),xi("customMatcher"),xi("observable"),qe({target:"Symbol",stat:!0},{isRegistered:kk}),qe({target:"Symbol",stat:!0,forced:!0},{isWellKnown:Fk}),xi("matcher"),xi("metadataKey"),xi("patternMatch"),xi("replaceAll");var Um=R(y8),Gk=R(Lm.f("iterator"));function Yg(t){return Yg=typeof Um=="function"&&typeof Gk=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Um=="function"&&e.constructor===Um&&e!==Um.prototype?"symbol":typeof e},Yg(t)}var P8=R(Lm.f("toPrimitive"));function L8(t){var e=function(n,i){if(Yg(n)!=="object"||n===null)return n;var r=n[P8];if(r!==void 0){var o=r.call(n,i);if(Yg(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(t,"string");return Yg(e)==="symbol"?e:String(e)}function D(t,e,n){return(e=L8(e))in t?ML(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Hk=R(o4),k8={isBrowser:!0,classes:{URLSearchParams:Hk!==void 0?Hk:e0,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const m0=typeof window<"u"&&typeof document<"u",E0=typeof navigator=="object"&&navigator||void 0,M8=m0&&(!E0||["ReactNative","NativeScript","NS"].indexOf(E0.product)<0),x8=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",U8=m0&&window.location.href||"http://localhost";function Wk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Kk(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Wk(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var is=Kk(Kk({},Object.freeze({__proto__:null,hasBrowserEnv:m0,hasStandardBrowserEnv:M8,hasStandardBrowserWebWorkerEnv:x8,navigator:E0,origin:U8})),k8),V8=Tr,B8=Gt,j8=ti,F8=et,G8=function(){var t=V8(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},zk=RegExp.prototype,Yk=function(t){var e=t.flags;return e!==void 0||"flags"in zk||j8(t,"flags")||!F8(zk,t)?e:B8(G8,t)},H8=Gh.charAt,qk=Gt,W8=Tr,K8=de,z8=Bt,Y8=/./.exec,q8=TypeError,X8=qe,Xk=Gt,Jk=ae,J8=vh,bR=bh,Qk=Pn,Zk=wT,qg=Yi,Q8=Tr,Z8=Se,$8=Bt,tK=MT,$k=Yk,eK=Xr,nK=w,iK=Bo,rK=function(t,e,n){return e+(n?H8(t,e).length:1)},sK=function(t,e){var n=t.exec;if(K8(n)){var i=qk(n,t,e);return i!==null&&W8(i),i}if(z8(t)==="RegExp")return qk(Y8,t,e);throw new q8("RegExp#exec called on incompatible receiver")},t1=vc,oK=Fn("matchAll"),e1="RegExp String",n1=e1+" Iterator",aK=t1.set,cK=t1.getterFor(n1),lK=TypeError,_0=Jk("".indexOf),CR=Jk("".matchAll),g0=!!CR&&!nK(function(){CR("a",/./)}),dK=J8(function(t,e,n,i){aK(this,{type:n1,regexp:t,string:e,global:n,unicode:i,done:!1})},e1,function(){var t=cK(this);if(t.done)return bR(void 0,!0);var e=t.regexp,n=t.string,i=sK(e,n);return i===null?(t.done=!0,bR(void 0,!0)):t.global?(qg(i[0])===""&&(e.lastIndex=rK(n,Zk(e.lastIndex),t.unicode)),bR(i,!1)):(t.done=!0,bR(i,!1))}),i1=function(t){var e,n,i,r=Q8(this),o=qg(t),c=iK(r,RegExp),l=qg($k(r));return e=new c(c===RegExp?r.source:r,l),n=!!~_0(l,"g"),i=!!~_0(l,"u"),e.lastIndex=Zk(r.lastIndex),new dK(e,o,n,i)};X8({target:"String",proto:!0,forced:g0},{matchAll:function(t){var e,n,i,r,o=Qk(this);if(Z8(t)){if(g0)return CR(o,t)}else{if(tK(t)&&(e=qg(Qk($k(t))),!~_0(e,"g")))throw new lK("`.matchAll` does not allow non-global regexes");if(g0)return CR(o,t);if((i=eK(t,oK))===void 0&&$8(t)==="RegExp"&&(i=i1),i)return Xk(i,t,o)}return n=qg(o),r=new RegExp(t,"g"),Xk(i1,r,n)}});var uK=Zr("String","matchAll"),hK=et,pK=uK,S0=String.prototype,fK=function(t){var e=t.matchAll;return typeof t=="string"||t===S0||hK(S0,t)&&e===S0.matchAll?pK:e},mK=R(fK);function r1(t){function e(n,i,r,o){let c=n[o++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),h=o>=n.length;return c=!c&&wt.isArray(r)?r.length:c,h?(wt.hasOwnProp(r,c)?r[c]=[r[c],i]:r[c]=i,!l):(r[c]&&wt.isObject(r[c])||(r[c]=[]),e(n,i,r[c],o)&&wt.isArray(r[c])&&(r[c]=function(p){const m={},S=Object.keys(p);let v;const y=S.length;let P;for(v=0;v<y;v++)P=S[v],m[P]=p[P];return m}(r[c])),!l)}if(wt.isFormData(t)&&wt.isFunction(t.entries)){const n={};return wt.forEachEntry(t,(i,r)=>{e(function(o){return mK(wt).call(wt,/\w+|\[(\w*)]/g,o).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),r,n,0)}),n}return null}const T0={transitional:DL,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,r=wt.isObject(t);if(r&&wt.isHTMLForm(t)&&(t=new FormData(t)),wt.isFormData(t))return i?JSON.stringify(r1(t)):t;if(wt.isArrayBuffer(t)||wt.isBuffer(t)||wt.isStream(t)||wt.isFile(t)||wt.isBlob(t)||wt.isReadableStream(t))return t;if(wt.isArrayBufferView(t))return t.buffer;if(wt.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return mR(c,new is.classes.URLSearchParams,Object.assign({visitor:function(h,p,m,S){return is.isNode&&wt.isBuffer(h)?(this.append(p,h.toString("base64")),!1):S.defaultVisitor.apply(this,arguments)}},l))}(t,this.formSerializer).toString();if((o=wt.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return mR(o?{"files[]":t}:t,c&&new c,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(c,l,h){if(wt.isString(c))try{return(l||JSON.parse)(c),pr(wt).call(wt,c)}catch(p){if(p.name!=="SyntaxError")throw p}return(h||JSON.stringify)(c)}(t)):t}],transformResponse:[function(t){const e=this.transitional||T0.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(wt.isResponse(t)||wt.isReadableStream(t))return t;if(t&&wt.isString(t)&&(n&&!this.responseType||i)){const r=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(o){if(r)throw o.name==="SyntaxError"?en.from(o,en.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:is.classes.FormData,Blob:is.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};wt.forEach(["delete","get","head","post","put","patch"],t=>{T0.headers[t]={}});var v0=T0;const EK=wt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),s1=Symbol("internals");function Xg(t){var e;return t&&pr(e=String(t)).call(e).toLowerCase()}function AR(t){return t===!1||t==null?t:wt.isArray(t)?t.map(AR):String(t)}function y0(t,e,n,i,r){return wt.isFunction(i)?i.call(this,e,n):(r&&(e=n),wt.isString(e)?wt.isString(i)?e.indexOf(i)!==-1:wt.isRegExp(i)?i.test(e):void 0:void 0)}class wR{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function o(h,p,m){const S=Xg(p);if(!S)throw new Error("header name must be a non-empty string");const v=wt.findKey(r,S);(!v||r[v]===void 0||m===!0||m===void 0&&r[v]!==!1)&&(r[v||p]=AR(h))}const c=(h,p)=>wt.forEach(h,(m,S)=>o(m,S,p));if(wt.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(wt.isString(e)&&(e=pr(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(pr(l=e).call(l)))c((h=>{const p={};let m,S,v;return h&&h.split(`
`).forEach(function(y){var P,I;v=y.indexOf(":"),m=pr(P=y.substring(0,v)).call(P).toLowerCase(),S=pr(I=y.substring(v+1)).call(I),!m||p[m]&&EK[m]||(m==="set-cookie"?p[m]?p[m].push(S):p[m]=[S]:p[m]=p[m]?p[m]+", "+S:S)}),p})(e),n);else if(wt.isHeaders(e))for(const[h,p]of e.entries())o(p,h,i);else e!=null&&o(n,e,i);var l;return this}get(e,n){if(e=Xg(e)){const i=wt.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(o){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=l.exec(o);)c[h[1]]=h[2];return c}(r);if(wt.isFunction(n))return n.call(this,r,i);if(wt.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Xg(e)){const i=wt.findKey(this,e);return!(!i||this[i]===void 0||n&&!y0(0,this[i],i,n))}return!1}delete(e,n){const i=this;let r=!1;function o(c){if(c=Xg(c)){const l=wt.findKey(i,c);!l||n&&!y0(0,i[l],l,n)||(delete i[l],r=!0)}}return wt.isArray(e)?e.forEach(o):o(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const o=n[i];e&&!y0(0,this[o],o,e,!0)||(delete this[o],r=!0)}return r}normalize(e){const n=this,i={};return wt.forEach(this,(r,o)=>{var c;const l=wt.findKey(i,o);if(l)return n[l]=AR(r),void delete n[o];const h=e?function(p){return pr(p).call(p).toLowerCase().replace(/([a-z\d])(\w*)/g,(m,S,v)=>S.toUpperCase()+v)}(o):pr(c=String(o)).call(c);h!==o&&delete n[o],n[h]=AR(r),i[h]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return wt.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&wt.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,i]=e;return n+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return r.forEach(c=>n.set(c)),n}static accessor(e){const n=(this[s1]=this[s1]={accessors:{}}).accessors,i=this.prototype;function r(o){const c=Xg(o);n[c]||(function(l,h){const p=wt.toCamelCase(" "+h);["get","set","has"].forEach(m=>{Object.defineProperty(l,m+p,{value:function(S,v,y){return this[m].call(this,h,S,v,y)},configurable:!0})})}(i,o),n[c]=!0)}return wt.isArray(e)?e.forEach(r):r(e),this}}wR.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),wt.reduceDescriptors(wR.prototype,(t,e)=>{let{value:n}=t,i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[i]=r}}}),wt.freezeMethods(wR);var Va=wR;function R0(t,e){const n=this||v0,i=e||n,r=Va.from(i.headers);let o=i.data;return wt.forEach(t,function(c){o=c.call(n,o,r.normalize(),e?e.status:void 0)}),r.normalize(),o}function o1(t){return!(!t||!t.__CANCEL__)}function Vm(t,e,n){en.call(this,t??"canceled",en.ERR_CANCELED,e,n),this.name="CanceledError"}function a1(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new en("Request failed with status code "+n.status,[en.ERR_BAD_REQUEST,en.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}wt.inherits(Vm,en,{__CANCEL__:!0});const IR=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(o,c){o=o||10;const l=new Array(o),h=new Array(o);let p,m=0,S=0;return c=c!==void 0?c:1e3,function(v){const y=Date.now(),P=h[S];p||(p=y),l[m]=v,h[m]=y;let I=S,O=0;for(;I!==m;)O+=l[I++],I%=o;if(m=(m+1)%o,m===S&&(S=(S+1)%o),y-p<c)return;const M=P&&y-P;return M?Math.round(1e3*O/M):void 0}}(50,250);return function(o,c){let l,h,p=0,m=1e3/c;const S=function(v){p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,h&&(clearTimeout(h),h=null),o.apply(null,v)};return[function(){const v=Date.now(),y=v-p;for(var P=arguments.length,I=new Array(P),O=0;O<P;O++)I[O]=arguments[O];y>=m?S(I,v):(l=I,h||(h=setTimeout(()=>{h=null,S(l)},m-y)))},()=>l&&S(l)]}(o=>{const c=o.loaded,l=o.lengthComputable?o.total:void 0,h=c-i,p=r(h);i=c,t({loaded:c,total:l,progress:l?c/l:void 0,bytes:h,rate:p||void 0,estimated:p&&l&&c<=l?(l-c)/p:void 0,event:o,lengthComputable:l!=null,[e?"download":"upload"]:!0})},n)},c1=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},l1=t=>function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return wt.asap(()=>t(...n))};var _K=is.hasStandardBrowserEnv?((t,e)=>n=>(n=new iR(n,is.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new iR(is.origin),is.navigator&&/(msie|trident)/i.test(is.navigator.userAgent)):()=>!0,gK=is.hasStandardBrowserEnv?{write(t,e,n,i,r,o){const c=[t+"="+encodeURIComponent(e)];wt.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),wt.isString(i)&&c.push("path="+i),wt.isString(r)&&c.push("domain="+r),o===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function d1(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}(t,e):e}function u1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const h1=t=>t instanceof Va?function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?u1(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t):t;function $h(t,e){e=e||{};const n={};function i(p,m,S,v){return wt.isPlainObject(p)&&wt.isPlainObject(m)?wt.merge.call({caseless:v},p,m):wt.isPlainObject(m)?wt.merge({},m):wt.isArray(m)?m.slice():m}function r(p,m,S,v){return wt.isUndefined(m)?wt.isUndefined(p)?void 0:i(void 0,p,0,v):i(p,m,0,v)}function o(p,m){if(!wt.isUndefined(m))return i(void 0,m)}function c(p,m){return wt.isUndefined(m)?wt.isUndefined(p)?void 0:i(void 0,p):i(void 0,m)}function l(p,m,S){return S in e?i(p,m):S in t?i(void 0,p):void 0}const h={url:o,method:o,data:o,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(p,m,S)=>r(h1(p),h1(m),0,!0)};return wt.forEach(Object.keys(Object.assign({},t,e)),function(p){const m=h[p]||r,S=m(t[p],e[p],p);wt.isUndefined(S)&&m!==l||(n[p]=S)}),n}var p1=t=>{const e=$h({},t);let n,{data:i,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:c,headers:l,auth:h}=e;if(e.headers=l=Va.from(l),e.url=OL(d1(e.baseURL,e.url),t.params,t.paramsSerializer),h&&l.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):""))),wt.isFormData(i)){if(is.hasStandardBrowserEnv||is.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((n=l.getContentType())!==!1){const[p,...m]=n?n.split(";").map(S=>pr(S).call(S)).filter(Boolean):[];l.setContentType([p||"multipart/form-data",...m].join("; "))}}if(is.hasStandardBrowserEnv&&(r&&wt.isFunction(r)&&(r=r(e)),r||r!==!1&&_K(e.url))){const p=o&&c&&gK.read(c);p&&l.set(o,p)}return e},SK=typeof XMLHttpRequest<"u"&&function(t){return new At(function(e,n){const i=p1(t);let r=i.data;const o=Va.from(i.headers).normalize();let c,l,h,p,m,{responseType:S,onUploadProgress:v,onDownloadProgress:y}=i;function P(){p&&p(),m&&m(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let I=new XMLHttpRequest;function O(){if(!I)return;const U=Va.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders());a1(function(W){e(W),P()},function(W){n(W),P()},{data:S&&S!=="text"&&S!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:U,config:t,request:I}),I=null}I.open(i.method.toUpperCase(),i.url,!0),I.timeout=i.timeout,"onloadend"in I?I.onloadend=O:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(O)},I.onabort=function(){I&&(n(new en("Request aborted",en.ECONNABORTED,t,I)),I=null)},I.onerror=function(){n(new en("Network Error",en.ERR_NETWORK,t,I)),I=null},I.ontimeout=function(){let U=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const W=i.transitional||DL;i.timeoutErrorMessage&&(U=i.timeoutErrorMessage),n(new en(U,W.clarifyTimeoutError?en.ETIMEDOUT:en.ECONNABORTED,t,I)),I=null},r===void 0&&o.setContentType(null),"setRequestHeader"in I&&wt.forEach(o.toJSON(),function(U,W){I.setRequestHeader(W,U)}),wt.isUndefined(i.withCredentials)||(I.withCredentials=!!i.withCredentials),S&&S!=="json"&&(I.responseType=i.responseType),y&&([h,m]=IR(y,!0),I.addEventListener("progress",h)),v&&I.upload&&([l,p]=IR(v),I.upload.addEventListener("progress",l),I.upload.addEventListener("loadend",p)),(i.cancelToken||i.signal)&&(c=U=>{I&&(n(!U||U.type?new Vm(null,t,I):U),I.abort(),I=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const M=function(U){const W=/^([-+\w]{1,25})(:?\/\/|:)/.exec(U);return W&&W[1]||""}(i.url);M&&is.protocols.indexOf(M)===-1?n(new en("Unsupported protocol "+M+":",en.ERR_BAD_REQUEST,t)):I.send(r||null)})},TK=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i,r=new AbortController;const o=function(p){if(!i){i=!0,l();const m=p instanceof Error?p:this.reason;r.abort(m instanceof en?m:new Vm(m instanceof Error?m.message:m))}};let c=e&&setTimeout(()=>{c=null,o(new en("timeout ".concat(e," of ms exceeded"),en.ETIMEDOUT))},e);const l=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(p=>{p.unsubscribe?p.unsubscribe(o):p.removeEventListener("abort",o)}),t=null)};t.forEach(p=>p.addEventListener("abort",o));const{signal:h}=r;return h.unsubscribe=()=>wt.asap(l),h}},b0=R(Gy),f1=Lm.f("asyncIterator"),vK=R(f1);function C0(t,e){this.v=t,this.k=e}function Jg(t){var e,n;function i(o,c){try{var l=t[o](c),h=l.value,p=h instanceof C0;b0.resolve(p?h.v:h).then(function(m){if(p){var S=o==="return"?"return":"next";if(!h.k||m.done)return i(S,m);m=t[S](m).value}r(l.done?"return":"normal",m)},function(m){i("throw",m)})}catch(m){r("throw",m)}}function r(o,c){switch(o){case"return":e.resolve({value:c,done:!0});break;case"throw":e.reject(c);break;default:e.resolve({value:c,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(o,c){return new b0(function(l,h){var p={key:o,arg:c,resolve:l,reject:h,next:null};n?n=n.next=p:(e=n=p,i(o,c))})},typeof t.return!="function"&&(this.return=void 0)}function ho(t){return function(){return new Jg(t.apply(this,arguments))}}function Ue(t){return new C0(t,0)}function OR(t){var e={},n=!1;function i(r,o){return n=!0,{done:!1,value:new C0(o=new b0(function(c){c(t[r](o))}),1)}}return e[Um!==void 0&&Gk||"@@iterator"]=function(){return this},e.next=function(r){return n?(n=!1,r):i("next",r)},typeof t.throw=="function"&&(e.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof t.return=="function"&&(e.return=function(r){return n?(n=!1,r):i("return",r)}),e}Jg.prototype[typeof Um=="function"&&vK||"@@asyncIterator"]=function(){return this},Jg.prototype.next=function(t){return this._invoke("next",t)},Jg.prototype.throw=function(t){return this._invoke("throw",t)},Jg.prototype.return=function(t){return this._invoke("return",t)};var A0=R(f1);function w0(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=A0,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new NR(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function NR(t){function e(n){if(Object(n)!==n)return At.reject(new TypeError(n+" is not an object."));var i=n.done;return At.resolve(n.value).then(function(r){return{value:r,done:i}})}return NR=function(n){this.s=n,this.n=n.next},NR.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?At.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?At.reject(n):e(i.apply(this.s,arguments))}},new NR(t)}const yK=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,r=0;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},RK=function(){var t=ho(function*(e,n){var i,r=!1,o=!1;try{for(var c,l=w0(bK(e));r=!(c=yield Ue(l.next())).done;r=!1){const h=c.value;yield*OR(w0(yK(h,n)))}}catch(h){o=!0,i=h}finally{try{r&&l.return!=null&&(yield Ue(l.return()))}finally{if(o)throw i}}});return function(e,n){return t.apply(this,arguments)}}(),bK=function(){var t=ho(function*(e){if(e[A0])return void(yield*OR(w0(e)));const n=e.getReader();try{for(;;){const{done:i,value:r}=yield Ue(n.read());if(i)break;yield r}}finally{yield Ue(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),m1=(t,e,n,i)=>{const r=RK(t,e);let o,c=0,l=h=>{o||(o=!0,i&&i(h))};return new ReadableStream({async pull(h){try{const{done:p,value:m}=await r.next();if(p)return l(),void h.close();let S=m.byteLength;if(n){let v=c+=S;n(v)}h.enqueue(new Uint8Array(m))}catch(p){throw l(p),p}},cancel:h=>(l(h),r.return())},{highWaterMark:2})};function E1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function _1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?E1(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const DR=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",g1=DR&&typeof ReadableStream=="function",CK=DR&&(typeof TextEncoder=="function"?(S1=new TextEncoder,t=>S1.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var S1;const T1=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return!!t(...n)}catch{return!1}},AK=g1&&T1(()=>{let t=!1;const e=new Request(is.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),I0=g1&&T1(()=>wt.isReadableStream(new Response("").body)),PR={stream:I0&&(t=>t.body)};var v1;DR&&(v1=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!PR[t]&&(PR[t]=wt.isFunction(v1[t])?e=>e[t]():(e,n)=>{throw new en("Response type '".concat(t,"' is not supported"),en.ERR_NOT_SUPPORT,n)})}));const wK=async(t,e)=>{const n=wt.toFiniteNumber(t.getContentLength());return n??(async i=>i==null?0:wt.isBlob(i)?i.size:wt.isSpecCompliantForm(i)?(await new Request(is.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:wt.isArrayBufferView(i)||wt.isArrayBuffer(i)?i.byteLength:(wt.isURLSearchParams(i)&&(i+=""),wt.isString(i)?(await CK(i)).byteLength:void 0))(e)};var IK=DR&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:o,timeout:c,onDownloadProgress:l,onUploadProgress:h,responseType:p,headers:m,withCredentials:S="same-origin",fetchOptions:v}=p1(t);p=p?(p+"").toLowerCase():"text";let y,P=TK([r,o&&o.toAbortSignal()],c);const I=P&&P.unsubscribe&&(()=>{P.unsubscribe()});let O;try{if(h&&AK&&n!=="get"&&n!=="head"&&(O=await wK(m,i))!==0){let Q,q=new Request(e,{method:"POST",body:i,duplex:"half"});if(wt.isFormData(i)&&(Q=q.headers.get("content-type"))&&m.setContentType(Q),q.body){const[ct,_t]=c1(O,IR(l1(h)));i=m1(q.body,65536,ct,_t)}}wt.isString(S)||(S=S?"include":"omit");const M="credentials"in Request.prototype;y=new Request(e,_1(_1({},v),{},{signal:P,method:n.toUpperCase(),headers:m.normalize().toJSON(),body:i,duplex:"half",credentials:M?S:void 0}));let U=await fetch(y);const W=I0&&(p==="stream"||p==="response");if(I0&&(l||W&&I)){const Q={};["status","statusText","headers"].forEach(Dt=>{Q[Dt]=U[Dt]});const q=wt.toFiniteNumber(U.headers.get("content-length")),[ct,_t]=l&&c1(q,IR(l1(l),!0))||[];U=new Response(m1(U.body,65536,ct,()=>{_t&&_t(),I&&I()}),Q)}p=p||"text";let $=await PR[wt.findKey(PR,p)||"text"](U,t);return!W&&I&&I(),await new At((Q,q)=>{a1(Q,q,{data:$,headers:Va.from(U.headers),status:U.status,statusText:U.statusText,config:t,request:y})})}catch(M){throw I&&I(),M&&M.name==="TypeError"&&/fetch/i.test(M.message)?Object.assign(new en("Network Error",en.ERR_NETWORK,t,y),{cause:M.cause||M}):en.from(M,M&&M.code,t,y)}});const y1={http:null,xhr:SK,fetch:IK};wt.forEach(y1,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const R1=t=>"- ".concat(t),OK=t=>wt.isFunction(t)||t===null||t===!1;var b1=t=>{t=wt.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let o=0;o<e;o++){let c;if(n=t[o],i=n,!OK(n)&&(i=y1[(c=String(n)).toLowerCase()],i===void 0))throw new en("Unknown adapter '".concat(c,"'"));if(i)break;r[c||"#"+o]=i}if(!i){const o=Object.entries(r).map(c=>{let[l,h]=c;return"adapter ".concat(l," ")+(h===!1?"is not supported by the environment":"is not available in the build")});throw new en("There is no suitable adapter to dispatch the request "+(e?o.length>1?`since :
`+o.map(R1).join(`
`):" "+R1(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i};function O0(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Vm(null,t)}function C1(t){return O0(t),t.headers=Va.from(t.headers),t.data=R0.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),b1(t.adapter||v0.adapter)(t).then(function(e){return O0(t),e.data=R0.call(t,t.transformResponse,e),e.headers=Va.from(e.headers),e},function(e){return o1(e)||(O0(t),e&&e.response&&(e.response.data=R0.call(t,t.transformResponse,e.response),e.response.headers=Va.from(e.response.headers))),At.reject(e)})}const NK="1.7.9",LR={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{LR[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const A1={};LR.transitional=function(t,e,n){function i(r,o){return"[Axios v1.7.9] Transitional option '"+r+"'"+o+(n?". "+n:"")}return(r,o,c)=>{if(t===!1)throw new en(i(o," has been removed"+(e?" in "+e:"")),en.ERR_DEPRECATED);return e&&!A1[o]&&(A1[o]=!0,console.warn(i(o," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,o,c)}},LR.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var kR={assertOptions:function(t,e,n){if(typeof t!="object")throw new en("options must be an object",en.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const o=i[r],c=e[o];if(c){const l=t[o],h=l===void 0||c(l,o,t);if(h!==!0)throw new en("option "+o+" must be "+h,en.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new en("Unknown option "+o,en.ERR_BAD_OPTION)}},validators:LR};const Gc=kR.validators;let MR=class{constructor(t){this.defaults=t,this.interceptors={request:new NL,response:new NL}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=$h(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:r}=e;n!==void 0&&kR.assertOptions(n,{silentJSONParsing:Gc.transitional(Gc.boolean),forcedJSONParsing:Gc.transitional(Gc.boolean),clarifyTimeoutError:Gc.transitional(Gc.boolean)},!1),i!=null&&(wt.isFunction(i)?e.paramsSerializer={serialize:i}:kR.assertOptions(i,{encode:Gc.function,serialize:Gc.function},!0)),kR.assertOptions(e,{baseUrl:Gc.spelling("baseURL"),withXsrfToken:Gc.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=r&&wt.merge(r.common,r[e.method]);r&&wt.forEach(["delete","get","head","post","put","patch","common"],y=>{delete r[y]}),e.headers=Va.concat(o,r);const c=[];let l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(e)===!1||(l=l&&y.synchronous,c.unshift(y.fulfilled,y.rejected))});const h=[];let p;this.interceptors.response.forEach(function(y){h.push(y.fulfilled,y.rejected)});let m,S=0;if(!l){const y=[C1.bind(this),void 0];for(y.unshift.apply(y,c),y.push.apply(y,h),m=y.length,p=At.resolve(e);S<m;)p=p.then(y[S++],y[S++]);return p}m=c.length;let v=e;for(S=0;S<m;){const y=c[S++],P=c[S++];try{v=y(v)}catch(I){P.call(this,I);break}}try{p=C1.call(this,v)}catch(y){return At.reject(y)}for(S=0,m=h.length;S<m;)p=p.then(h[S++],h[S++]);return p}getUri(t){return OL(d1((t=$h(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};wt.forEach(["delete","get","head","options"],function(t){MR.prototype[t]=function(e,n){return this.request($h(n||{},{method:t,url:e,data:(n||{}).data}))}}),wt.forEach(["post","put","patch"],function(t){function e(n){return function(i,r,o){return this.request($h(o||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}MR.prototype[t]=e(),MR.prototype[t+"Form"]=e(!0)});var xR=MR;class N0{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new At(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let o=i._listeners.length;for(;o-- >0;)i._listeners[o](r);i._listeners=null}),this.promise.then=r=>{let o;const c=new At(l=>{i.subscribe(l),o=l}).then(r);return c.cancel=function(){i.unsubscribe(o)},c},e(function(r,o,c){i.reason||(i.reason=new Vm(r,o,c),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new N0(function(i){e=i}),cancel:e}}}var DK=N0;const D0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(D0).forEach(t=>{let[e,n]=t;D0[n]=e});var PK=D0;const sr=function t(e){const n=new xR(e),i=uL(xR.prototype.request,n);return wt.extend(i,xR.prototype,n,{allOwnKeys:!0}),wt.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return t($h(e,r))},i}(v0);sr.Axios=xR,sr.CanceledError=Vm,sr.CancelToken=DK,sr.isCancel=o1,sr.VERSION=NK,sr.toFormData=mR,sr.AxiosError=en,sr.Cancel=sr.CanceledError,sr.all=function(t){return At.all(t)},sr.spread=function(t){return function(e){return t.apply(null,e)}},sr.isAxiosError=function(t){return wt.isObject(t)&&t.isAxiosError===!0},sr.mergeConfig=$h,sr.AxiosHeaders=Va,sr.formToJSON=t=>r1(wt.isHTMLForm(t)?new FormData(t):t),sr.getAdapter=b1,sr.HttpStatusCode=PK,sr.default=sr;var Br=sr;const LK=()=>{};function Qg(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:LK};return t.promise=new At((e,n)=>{t.resolve=i=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(i),t.value=i)},t.reject=i=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(i))}}),t}const UR=new Map,VR=new Map,Hc=new Map;let Ri=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Ye=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const w1=new t6;let Ba=w1.getResult(),P0=null;function Fe(t){if(!P0){Ba=w1.getResult();const e=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return Ye.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ye.CHROME;case"Safari":case"Mobile Safari":return Ye.SAFARI;case"Edge":return Ye.EDGE;case"Firefox":return Ye.FIREFOX;case"QQ":case"QQBrowser":return Ye.QQ;case"Opera":return Ye.OPERA;case"WeChat":return Ye.WECHAT;default:return l.browser.name||""}}(Ba),n=I1(Ba),i=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(Ba),r=Ba.os.version,o=I1(Ba,!1),c=Ba.device.type;if(!(e&&n&&i&&r))return{name:e,version:n,os:i,osVersion:r,browserVersion:o,deviceType:c};P0={name:e,version:n,os:i,osVersion:r,browserVersion:o,deviceType:c}}return P0}function I1(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function BR(){return Fe().os}function O1(){const t=Fe();return"".concat(t.os," ").concat(t.osVersion)}function jR(){const t=Fe();return!!(Ba.engine.name==="WebKit"&&t.os===Ri.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Ye.SAFARI||br()&&t.name!==Ye.SAFARI)}function Kl(){return Fe().name===Ye.CHROME}function Gi(){return Fe().name===Ye.SAFARI}function N1(){return Fe().name===Ye.EDGE}function Un(){return Fe().name===Ye.FIREFOX}function br(){return Fe().os===Ri.IOS}function Bm(t){const e=Fe();return!(e.name!==Ye.CHROME||!e.osVersion)&&Number(e.version)>=t}function D1(t){const e=Fe();return!(e.name!==Ye.CHROME||!e.osVersion)&&Number(e.version)<t}function L0(t,e,n){const i=Fe();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}function k0(t){const e=Fe();return!(e.name!==Ye.EDGE||!e.osVersion)&&Number(e.version)>=t}function P1(t){const e=Fe();return!(e.name!==Ye.SAFARI||!e.osVersion)&&Number(e.version)>=t}function L1(t,e,n){const i=Fe();if(i.os!==Ri.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t}function k1(t,e,n){const i=Fe();if(i.name!==Ye.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}function M0(t){const e=Fe();return!(e.name!==Ye.OPERA||!e.osVersion)&&Number(e.version)>=t}function M1(){const t=Fe();if(t.os!==Ri.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function jm(){const t=Fe();if(t.os!==Ri.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function x0(){const t=Fe();if(t.os!==Ri.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function x1(){const t=Fe();if(t.os!==Ri.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function ta(){return Gi()&&navigator.maxTouchPoints>0}function U1(){return Fe().name===Ye.WECHAT}function V1(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function U0(){const t=BR();return function(){const{deviceType:e}=Fe();return e==="mobile"||e==="tablet"}()||t===Ri.ANDROID||t===Ri.IOS||t===Ri.HARMONY_OS}function zl(){const t=Fe();return t.name!==Ye.EDGE&&t.name!==Ye.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function FR(){return BR()===Ri.ANDROID}function Zg(){const t=Fe();return FR()&&(t.name===Ye.CHROME||t.name===Ye.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function ue(t,e,n){return(e=function(i){var r=function(o){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var l=c.call(o,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function B1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ut(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?B1(Object(n),!0).forEach(function(i){ue(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let k=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({});class at extends Error{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),ue(this,"code",void 0),ue(this,"message",void 0),ue(this,"data",void 0),ue(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return e==="error"&&(n||console).error(this.toString()),e==="warning"&&(n||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}}function Yl(t,e){if(typeof t!="boolean")throw new at(k.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Si(t,e,n){if(!Ct(n).call(n,t))throw new at(k.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function nn(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(t))throw new at(k.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function V0(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new at(k.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&nn(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&nn(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&nn(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&nn(t.ideal,"".concat(e,".ideal"),1,1/0)}else nn(t,e,1,1/0)}function Ui(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new at(k.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!j1(t,n,i,r))throw new at(k.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function ql(t,e){if(!Array.isArray(t))throw new at(k.INVALID_PARAMS,"".concat(e," should be an array"))}function kn(t){return t==null}function j1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!i||function(r){if(typeof r!="string")return!1;for(let o=0;o<r.length;o+=1){const c=r.charCodeAt(o);if(c<0||c>255)return!1}return!0}(t))}var $g=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}($g||{}),B0=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(B0||{});const F1=new class{constructor(){ue(this,"_clientSize",null),ue(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),ue(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),ue(this,"getStyle",t=>window.getComputedStyle(t,null)),ue(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const i=this.getStyle(t),{display:r,visibility:o,opacity:c,filter:l}=i;return(r==="none"||Ct(e=["hidden","collapse"]).call(e,o)||Number(c)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(h=>{var p;const m=h.split("(")[0];return Ct(p=["brightness","blur","opacity"]).call(p,m)}).map(h=>{const[p,m]=h.split(/\(|\)/);return[p,Number(m.match(/^[0-9\.]+/))]}).forEach(h=>{const[p,m]=h;switch(p){case"brightness":(m<.1||m>3)&&(n=!1);break;case"blur":m>3&&(n=!1);break;case"opacity":m<.1&&(n=!1)}}),n)}),ue(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,i=!0;const r=c=>e(c);let o=t;for(;o&&i;)r(o)||(n=!1,i=!1),o=o.parentElement,o||(i=!1);return n}),ue(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),ue(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:i,right:r,top:o,bottom:c}=t.getBoundingClientRect(),l=this.getClientWidth(),h=this.getClientHeight();return{width:e,height:n,left:i,right:r,top:o,bottom:c,clientWidth:l,clientHeight:h,clientMin:Math.min(l,h)}}),ue(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),ue(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),ue(this,"checkCoverForAPoint",(t,e,n)=>{const i=this.elementFromPoint(t,e);return i!==null&&i!==n}),ue(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,r=t/6,o=e/6,c=[],l=10**6;for(let h=0;h<5;h++)for(let p=0;p<5;p++){const m=(n*l+(h===0?.1:h===4?(r*h*l-1e5)/l:r*h)*l)/l,S=(i*l+(p===0?.1:p===4?(o*p*l-1e5)/l:o*p)*l)/l;c.push({x:m,y:S})}return[...c]}),ue(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),ue(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),ue(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:r,clientWidth:o,clientMin:c}=this._clientSize;let l,h,p,m;if(t<0)l=0;else{if(!(t<o))return!1;l=t}if(e<0)return!1;if(h=e<o?e:o,n<0)p=0;else{if(!(n<r))return!1;p=n}if(i<0)return!1;m=i<r?i:r;const S=h-l,v=m-p;return this.checkSizeIsVisible(S,v,c)}),ue(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),ue(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult($g.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult($g.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult($g.SIZE)}}return this.returnHiddenResult($g.STYLE)}return this.returnHiddenResult(B0.UNMOUNTED)}return this.returnHiddenResult(B0.INVALID_HTML_ELEMENT)}),ue(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function j0(t){return new TextEncoder().encode(t)}const G1=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},F0=async t=>function(e,n){let i="";return new Uint8Array(e).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",j0(t)),16);let On=class{constructor(){ue(this,"_events",{}),ue(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],i=this._indexOfListener(n,e);i!==-1&&n.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(o=>o);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(let o=0;o<e.length;o+=1){const c=e[o];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];[...this._events[t]||[]].forEach(r=>{r.once&&this.off(t,r.listener);try{r.listener.apply(this,n)}catch(o){console.error("safeEmit event:".concat(t," error ").concat(o==null?void 0:o.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},tS=null;function H1(){if(tS)return tS;if(window.electron)return tS=window.electron;if(!window.require)return null;try{return tS=window.require("electron"),tS}catch{return null}}let li=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),Mn=function(t){return t.TRACER="tracer",t}({});function W1(t){return nn(t.timeout,"config.timeout",0,1e5),nn(t.timeoutFactor,"config.timeoutFactor",0,100,!1),nn(t.maxRetryCount,"config.maxRetryConfig",0,1/0),nn(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let kK=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Xe=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function eS(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function K1(t){return Ui(t.turnServerURL,"turnServerURL"),Ui(t.username,"username"),Ui(t.password,"password"),t.udpport&&nn(t.udpport,"udpport",1,99999,!0),t.forceturn&&Yl(t.forceturn,"forceturn"),t.security&&Yl(t.security,"security"),t.tcpport&&nn(t.tcpport,"tcpport",1,99999,!0),!0}function G0(t){return t.level!==void 0&&Si(t.level,"level",[1,2,3]),t.delay!==void 0&&nn(t.delay,"delay",0,3e3,!0),!0}let Ie=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Hi=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),bs=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Fm=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function Wi(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return t.getListeners(e).length===0?At.reject(new at(k.UNEXPECTED_ERROR,"can not emit promise")):new At((o,c)=>{t.emit(e,...i,o,c)})}function un(t,e){if(t.getListeners(e).length===0)return At.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return Wi(t,e,...i)}function Fs(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return nS(t,e,...i)}function nS(t,e){let n=null,i=null;for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];if(t.emit(e,...o,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new at(k.UNEXPECTED_ERROR,"handler is not sync");return n}const ei=new class extends On{set networkState(t){this.emit(Fm.NETWORK_STATE_CHANGE,t,this._networkState),t===bs.ONLINE?this.emit(Fm.ONLINE):t===bs.OFFLINE&&(this.onlineWaiter=new At(e=>{this.once(Fm.ONLINE,()=>{this.onlineWaiter=void 0,e(bs.ONLINE)})}),this.emit(Fm.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===bs.ONLINE}constructor(){super(),ue(this,"_moduleName","network-indicator"),ue(this,"_networkState",bs.ONLINE),ue(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=bs.ONLINE}),window.addEventListener("offline",()=>{this.networkState=bs.OFFLINE})}};function GR(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function Gm(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function HR(t){At!==void 0?At.resolve().then(t):setTimeout(t,0)}function Vn(t){return JSON.parse(JSON.stringify(t))}function tp(t){try{return Vn(t)}catch{return t}}const z1={};function ou(t,e){z1[e]||(z1[e]=!0,t())}function ep(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return n}function au(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function Y1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const i=new Uint8Array(e);i.set(n),n=i}return n}function q1(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=qi(e).call(e,(c,l)=>c+l.length,0),r=new Uint8Array(new ArrayBuffer(i));let o=0;return e.forEach(c=>{r.set(c,o),o+=c.length}),r}function Wc(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function X1(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?Wc(n):n.size}),e+138}function MK(t){const e=new at(k.TIMEOUT,"timeout");return new At((n,i)=>{window.setTimeout(()=>i(e),t)})}function Vi(t){return new At(e=>{window.setTimeout(e,t)})}function hn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+hn(t-n.length,"")}function np(){return hn(32,"").toUpperCase()}const WR=()=>{},J1=new class{constructor(){ue(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var r=arguments.length,o=new Array(r>4?r-4:0),c=4;c<r;c++)o[c-4]=arguments[c];if(this.fnMap.has(e)){const l=this.fnMap.get(e);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const h=window.setTimeout(()=>{const p=this.fnMap.get(e);p&&p.fn(...p.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:h,args:o,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(e,Ut(Ut({},l),{},{fn:t,args:o,skipFn:i}))}else{const l=window.setTimeout(()=>{const h=this.fnMap.get(e);h&&h.fn(...h.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:l,args:o,skipFn:i})}}},Q1=J1.throttleByKey.bind(J1);function Z1(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function H0(t,e){if(!Z1(t)||!Z1(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=H0(t[i],e[i]);return n}{const n=Ut({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=H0(t[i],e[i]):n[i]=e[i]);return n}}function $1(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let i=0;for(;t>0&&(n[i]=255&t,t>>=8,i++,i!==e););return n}function W0(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function tM(t){const e="0123456789abcdef";function n(W){let $,Q="";for($=0;$<=3;$++)Q+=e.charAt(W>>8*$+4&15)+e.charAt(W>>8*$&15);return Q}function i(W,$){const Q=(65535&W)+(65535&$);return(W>>16)+($>>16)+(Q>>16)<<16|65535&Q}function r(W,$,Q,q,ct,_t){return i(function(Dt,Mt){return Dt<<Mt|Dt>>>32-Mt}(i(i($,W),i(q,_t)),ct),Q)}function o(W,$,Q,q,ct,_t,Dt){return r($&Q|~$&q,W,$,ct,_t,Dt)}function c(W,$,Q,q,ct,_t,Dt){return r($&q|Q&~q,W,$,ct,_t,Dt)}function l(W,$,Q,q,ct,_t,Dt){return r($^Q^q,W,$,ct,_t,Dt)}function h(W,$,Q,q,ct,_t,Dt){return r(Q^($|~q),W,$,ct,_t,Dt)}const p=function(W){let $;const Q=1+(W.length+8>>6),q=new Array(16*Q);for($=0;$<16*Q;$++)q[$]=0;for($=0;$<W.length;$++)q[$>>2]|=W.charCodeAt($)<<$%4*8;return q[$>>2]|=128<<$%4*8,q[16*Q-2]=8*W.length,q}(t);let m,S,v,y,P,I=1732584193,O=-271733879,M=-1732584194,U=271733878;for(m=0;m<p.length;m+=16)S=I,v=O,y=M,P=U,I=o(I,O,M,U,p[m+0],7,-680876936),U=o(U,I,O,M,p[m+1],12,-389564586),M=o(M,U,I,O,p[m+2],17,606105819),O=o(O,M,U,I,p[m+3],22,-1044525330),I=o(I,O,M,U,p[m+4],7,-176418897),U=o(U,I,O,M,p[m+5],12,1200080426),M=o(M,U,I,O,p[m+6],17,-1473231341),O=o(O,M,U,I,p[m+7],22,-45705983),I=o(I,O,M,U,p[m+8],7,1770035416),U=o(U,I,O,M,p[m+9],12,-1958414417),M=o(M,U,I,O,p[m+10],17,-42063),O=o(O,M,U,I,p[m+11],22,-1990404162),I=o(I,O,M,U,p[m+12],7,1804603682),U=o(U,I,O,M,p[m+13],12,-40341101),M=o(M,U,I,O,p[m+14],17,-1502002290),O=o(O,M,U,I,p[m+15],22,1236535329),I=c(I,O,M,U,p[m+1],5,-165796510),U=c(U,I,O,M,p[m+6],9,-1069501632),M=c(M,U,I,O,p[m+11],14,643717713),O=c(O,M,U,I,p[m+0],20,-373897302),I=c(I,O,M,U,p[m+5],5,-701558691),U=c(U,I,O,M,p[m+10],9,38016083),M=c(M,U,I,O,p[m+15],14,-660478335),O=c(O,M,U,I,p[m+4],20,-405537848),I=c(I,O,M,U,p[m+9],5,568446438),U=c(U,I,O,M,p[m+14],9,-1019803690),M=c(M,U,I,O,p[m+3],14,-187363961),O=c(O,M,U,I,p[m+8],20,1163531501),I=c(I,O,M,U,p[m+13],5,-1444681467),U=c(U,I,O,M,p[m+2],9,-51403784),M=c(M,U,I,O,p[m+7],14,1735328473),O=c(O,M,U,I,p[m+12],20,-1926607734),I=l(I,O,M,U,p[m+5],4,-378558),U=l(U,I,O,M,p[m+8],11,-2022574463),M=l(M,U,I,O,p[m+11],16,1839030562),O=l(O,M,U,I,p[m+14],23,-35309556),I=l(I,O,M,U,p[m+1],4,-1530992060),U=l(U,I,O,M,p[m+4],11,1272893353),M=l(M,U,I,O,p[m+7],16,-155497632),O=l(O,M,U,I,p[m+10],23,-1094730640),I=l(I,O,M,U,p[m+13],4,681279174),U=l(U,I,O,M,p[m+0],11,-358537222),M=l(M,U,I,O,p[m+3],16,-722521979),O=l(O,M,U,I,p[m+6],23,76029189),I=l(I,O,M,U,p[m+9],4,-640364487),U=l(U,I,O,M,p[m+12],11,-421815835),M=l(M,U,I,O,p[m+15],16,530742520),O=l(O,M,U,I,p[m+2],23,-995338651),I=h(I,O,M,U,p[m+0],6,-198630844),U=h(U,I,O,M,p[m+7],10,1126891415),M=h(M,U,I,O,p[m+14],15,-1416354905),O=h(O,M,U,I,p[m+5],21,-57434055),I=h(I,O,M,U,p[m+12],6,1700485571),U=h(U,I,O,M,p[m+3],10,-1894986606),M=h(M,U,I,O,p[m+10],15,-1051523),O=h(O,M,U,I,p[m+1],21,-2054922799),I=h(I,O,M,U,p[m+8],6,1873313359),U=h(U,I,O,M,p[m+15],10,-30611744),M=h(M,U,I,O,p[m+6],15,-1560198380),O=h(O,M,U,I,p[m+13],21,1309151649),I=h(I,O,M,U,p[m+4],6,-145523070),U=h(U,I,O,M,p[m+11],10,-1120210379),M=h(M,U,I,O,p[m+2],15,718787259),O=h(O,M,U,I,p[m+9],21,-343485551),I=i(I,S),O=i(O,v),M=i(M,y),U=i(U,P);return n(I)+n(O)+n(M)+n(U)}let xK=1,eM=console,Qi=class{static setLogger(t){eM=t}constructor(t,e){ue(this,"id",void 0),ue(this,"lockingPromise",At.resolve()),ue(this,"locks",0),ue(this,"name",""),ue(this,"lockId",void 0),this.lockId=xK++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");eM.debug("".concat(n," ").concat(i))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new At(r=>{e=()=>{this.locks-=1,this.logger("unlocked",t),r()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Hm(t,e){return function(n,i,r){const o=r.value;if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this[e];if(!c)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const l=await c.lock("From ".concat(t,".").concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await o.apply(this,p)}finally{l()}},r}}const di={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function K0(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function ja(t,e,n,i){const r=Object.assign({},di,i);let o=r.timeout;const c=async()=>{await function(p){return new At(m=>{window.setTimeout(m,p)})}(o),o*=r.timeoutFactor,o=Math.min(r.maxRetryTimeout,o)};let l=!1;const h=new At(async(p,m)=>{e=e||(()=>!1),n=n||(()=>!0);for(let S=0;S<r.maxRetryCount;S+=1){if(l)return m(new at(k.OPERATION_ABORTED));try{const v=await t();if(!e(v,S)||S+1===r.maxRetryCount)return p(v);await c()}catch(v){if(!n(v,S)||S+1===r.maxRetryCount)return m(v);await c()}}});return h.cancel=()=>l=!0,h}let KR,nM=class{constructor(t){ue(this,"input",[]),ue(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:qi(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},zR=0,z0=0;function Y0(t,e,n,i){return new At((r,o)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),zR+=Wc(e.data)):n&&(e.data.size?zR+=e.data.size:e.data instanceof FormData?zR+=X1(e.data):zR+=Wc(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Br.request(e).then(c=>{typeof c.data=="string"?z0+=Wc(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?z0+=c.data.byteLength:z0+=Wc(JSON.stringify(c.data)),r(c.data)}).catch(c=>{Br.isCancel(c)?o(new at(k.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?o(new at(k.NETWORK_TIMEOUT,c.message)):c.response?o(new at(k.NETWORK_RESPONSE_ERROR,c.response.status)):o(new at(k.NETWORK_ERROR,c.message))})})}async function UK(t,e){const n=new Blob([e.data],{type:"buffer"});return await Y0(t,Ut(Ut({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const iM=()=>window.isSecureContext!==void 0;function ea(t){if(Array.isArray(t))return t.map(n=>n);if(!rM(t))return t;const e={};for(const n in t){const i=t[n];rM(i)||Array.isArray(i)?e[n]=ea(i):e[n]=i}return e}function rM(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let q0=class{constructor(t){ue(this,"input",[]),ue(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Kc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},iS={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Kc,remoteCandidate:Kc},updateInterval:0},sM={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},oM={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},aM={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},cM={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};let X0=class{constructor(t,e){ue(this,"onFirstVideoReceived",void 0),ue(this,"onFirstVideoDecoded",void 0),ue(this,"onFirstAudioReceived",void 0),ue(this,"onFirstVideoDecodedTimeout",void 0),ue(this,"onFirstAudioDecoded",void 0),ue(this,"onSelectedLocalCandidateChanged",void 0),ue(this,"onSelectedRemoteCandidateChanged",void 0),ue(this,"videoIsReady",!1),ue(this,"videoIsReady2",{}),ue(this,"pc",void 0),ue(this,"options",void 0),ue(this,"intervalTimer",void 0),ue(this,"stats",ea(iS)),ue(this,"isFirstVideoReceived",{}),ue(this,"isFirstVideoDecoded",{}),ue(this,"isFirstAudioReceived",{}),ue(this,"isFirstAudioDecoded",{}),ue(this,"isFirstVideoDecodedTimeout",{}),ue(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new At(t=>{t({local:Ut({},Kc),remote:Ut({},Kc)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,o=0,c=0;for(const l of n)t[l].forEach((h,p)=>{if(!this.lossRateWindowStats[e-1][l][p]||!this.lossRateWindowStats[0][l][p])return;const m=this.lossRateWindowStats[e-1][l][p].packets-this.lossRateWindowStats[0][l][p].packets,S=this.lossRateWindowStats[e-1][l][p].packetsLost-this.lossRateWindowStats[0][l][p].packetsLost;l==="videoSend"||l==="audioSend"?(i+=m,o+=S):(r+=m,c+=S),Number.isNaN(m)||Number.isNaN(m)?h.packetLostRate=0:h.packetLostRate=m<=0||S<=0?0:S/(m+S)});t.sendPacketLossRate=i<=0||o<=0?0:o/(i+o),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}},VK=class extends X0{constructor(){super(...arguments),ue(this,"_stats",iS),ue(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=ea(iS);const n=e.filter(r=>r.type==="ssrc");this.processSSRCStats(n);const i=e.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const i=Ct(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const r=ea(oM);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=ea(sM),o=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),o){const c=o.stats,l=Date.now()-o.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(o.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<o.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Ut({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=ea(cM);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=ea(aM);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new At((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(r=>{i[r]=n.stat(r)}),e.push(i)}),e}},rS=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),YR=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),J0=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),Gs=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Wm=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Wm||{});function sS(t,e,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Wm.kNone;if(!e)return;const o=Number(e[n]);if(typeof o!="number")return;const c=Number(e[i]);if(typeof c!="number")return;if(!t)return c?o/c*r:void 0;const l=Number(t[n]);if(typeof l!="number")return;const h=Number(t[i]);if(typeof h!="number")return;const p=c-h;return p?(o-l)/p*r:void 0}let lM=class extends X0{constructor(){super(...arguments),ue(this,"_stats",iS),ue(this,"report",void 0),ue(this,"lastDecodeVideoReceiverStats",new Map),ue(this,"lastVideoFramesRecv",new Map),ue(this,"lastVideoFramesSent",new Map),ue(this,"lastVideoFramesDecode",new Map),ue(this,"lastVideoFramesOutput",new Map),ue(this,"lastVideoJBDelay",new Map),ue(this,"lastAudioJBDelay",new Map),ue(this,"mediaBytesSent",new Map),ue(this,"mediaBytesRetransmit",new Map),ue(this,"mediaBytesTargetEncode",new Map),ue(this,"lastDecodeAudioReceiverStats",new Map),ue(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ea(iS),this.report.forEach(t=>{switch(t.type){case Gs.OUTBOUND:case Gs.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===Gs.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===Gs.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case Gs.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case Gs.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:Ut({},Kc),remote:Ut({},Kc)};return t.forEach(n=>{let i;if(n.type===Gs.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===Gs.CANDIDATE_PAIR&&n.selected&&(i=n),i){const r=(o,c)=>{o.type=c.type,o.id=c.id,c.address&&(o.address=c.address),c.candidateType&&(o.candidateType=c.candidateType),c.port&&(o.port=c.port),c.priority&&(o.priority=c.priority),c.protocol&&(o.protocol=c.protocol),c.relayProtocol&&(o.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const o=t.get(i.localCandidateId);o&&r(e.local,o)}if(i.remoteCandidateId){const o=t.get(i.remoteCandidateId);o&&r(e.remote,o)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===Gs.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===Gs.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===Gs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ut({},e),Ut({},this.stats.selectedCandidatePair.localCandidate)),t.type===Gs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ut({},e),Ut({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=ea(cM),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=sS(n,e,"totalProcessingDelay","jitterBufferEmittedCount",Wm.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,Ut({},e))}processVideoInboundStats(t){let e=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);e||(e=ea(sM),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=this.lastVideoFramesOutput.get(e.ssrc),o=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const c=e.decodedFrame?e.decodedFrame.width:0,l=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,c,l),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const c=n.stats,l=o-n.lts;e.framesDecodeFreezeTime=c.framesDecodeFreezeTime,e.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=l,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<c.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=sS(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=sS(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",Wm.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=sS(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",Wm.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=sS(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",Wm.kMillisecondsFromSeconds),i&&o-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:o,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:o,rate:0}),e.framesDroppedCount&&t.framesReceived&&(r&&o-r.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-r.count)/((o-r.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:o,rate:Math.max(e.outputFrameRate,0)})):r?e.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:Ut({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);e||(e=ea(oM),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new q0(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const r=new q0(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const r=new q0(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-i.lastFrameCount,o=t.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*o/r}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,Gs.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=ea(aM),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,Gs.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(hr(n=this.report).call(n)).find(r=>r.type===e&&r.ssrc===t);return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,r,o,c;const l=e?this.report.get(e):void 0,h=(i=l==null?void 0:l.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof h!="number")return;let p=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,m=(o=l==null?void 0:l.frameHeight)!==null&&o!==void 0?o:t.frameHeight,S=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof p=="number"&&typeof m=="number"||(p=0,m=0),S==null){const v=Date.now(),y=this.lastVideoFramesSent.get(n.ssrc);y&&v-y.lts>=800?(S=Math.round((h-y.count)/((v-y.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:h,lts:v,rate:S})):y?S=y.rate:this.lastVideoFramesSent.set(n.ssrc,{count:h,lts:v,rate:0})}n.sentFrame={width:p,height:m,frameRate:Math.max(0,S)}}processVideoTrackReceiverStats(t,e,n){var i,r,o,c,l;const h=e?this.report.get(e):void 0,p=(i=h==null?void 0:h.framesReceived)!==null&&i!==void 0?i:t.framesReceived,m=(r=h==null?void 0:h.frameWidth)!==null&&r!==void 0?r:t.frameWidth,S=(o=h==null?void 0:h.frameHeight)!==null&&o!==void 0?o:t.frameHeight,v=(c=h==null?void 0:h.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,y=(l=h==null?void 0:h.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof p=="number"){const P=this.lastVideoFramesRecv.get(n.ssrc),I=Date.now();n.framesReceivedCount=p;let O=0;P&&I-P.lts>=800?(O=Math.round((p-P.count)/((I-P.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:I,rate:O})):P?O=P.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:I,rate:0}),n.receivedFrame={width:m||0,height:S||0,frameRate:O||0},n.decodedFrame={width:m||0,height:S||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:m||0,height:S||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(v&&y){const P=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=P.jitterBufferMs;const O=y-P.jitterBufferEmittedCount;O>0&&(I=1e3*(v-P.jitterBufferDelay)/O),n.jitterBufferMs=I,n.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:v,jitterBufferEmittedCount:y,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,r,o,c;const l=e?this.report.get(e):void 0,h=(i=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&i!==void 0?i:0,p=(o=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;n.aecReturnLoss=h,n.aecReturnLossEnhancement=p}processAudioTrackReceiverStats(t,e,n){var i,r,o,c,l,h,p;const m=e?this.report.get(e):void 0,S=(i=m==null?void 0:m.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,v=(r=m==null?void 0:m.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,y=(o=m==null?void 0:m.jitterBufferDelay)!==null&&o!==void 0?o:t.jitterBufferDelay,P=(c=m==null?void 0:m.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,I=(l=m==null?void 0:m.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,O=(h=m==null?void 0:m.totalSamplesDuration)!==null&&h!==void 0?h:t==null?void 0:t.totalSamplesDuration,M=(p=m==null?void 0:m.concealedSamples)!==null&&p!==void 0?p:t.concealedSamples;if(S&&v&&(n.accelerateRate=S/v),y&&P){const W=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let $=W.jitterBufferMs;const Q=P-W.jitterBufferEmittedCount;Q>0&&($=1e3*(y-W.jitterBufferDelay)/Q),n.jitterBufferMs=Math.round($),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:y,jitterBufferEmittedCount:P,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=I;let U=1920;O&&v&&(U=v/O/50,n.receivedFrames=Math.round(v/U)),M&&(n.droppedFrames=Math.round(M/U))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{n=n===null?r.diffMean():n+r.diffMean()});const i=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},BK=class extends X0{updateStats(){return At.resolve()}};function Q0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const o=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return o?o<76?new VK(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new lM(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(c){if(!window.RTCStatsReport)return!1;const l=c.getStats();return!!(l instanceof At||function(h){return!!h&&(typeof h=="object"||typeof h=="function")&&typeof h.then=="function"}(l))}(t)?new lM(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new BK(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}const dM="websdk_ng_install_id";function Z0(){try{if(j("INSTALL_ID"))return j("INSTALL_ID");let t=window.localStorage.getItem(dM);return t||(t=np(),window.localStorage.setItem(dM,t)),$e("INSTALL_ID",t),t}catch{return}}const po=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],i=e[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.23.1"),$0=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let ip=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Ki=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let l=0;l<6;l++)r.push("1");const o=r.join(""),c={};return c[t]=i,c[e]=o,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ki;const qR={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},tI={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},eI="v4.23.1-0-gea45199f-dirty(1/16/2025, 3:18:04 PM)",nI={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"]},Nn=Ut(Ut(Ut({},nI),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:tI,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},qR),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function $e(t,e,n){var i,r,o;Ct(i=Object.keys(Nn)).call(i,t)&&(!n&&Ct(r=Object.keys(Fa)).call(r,t)||(Nn[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"||e!==!0||(Nn.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&e&&(o=!!e,Nn.USE_NEW_NETWORK_CONFIG=o,o&&(Nn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Nn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Nn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Nn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Nn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Nn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Nn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(Nn.ENABLE_INSTANT_VIDEO=!0,Nn.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(Nn.ENABLE_AUT_CC=!0)))}function j(t){return Nn[t]}$0||(Nn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Nn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Nn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Nn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Nn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Nn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Nn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Nn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Nn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Nn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Nn.AREAS=["NORTH_AMERICA","OVERSEA"]);let uM=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Fa={};var Oe=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(Oe||{});let jK=class{constructor(t,e,n,i){ue(this,"state",void 0),this.state={codec:t,audioCodec:e,mode:n,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ip.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(t){this.state=function(e,n){switch(n.type){case Oe.SET_SESSION_ID:return Ut(Ut({},e),{},{sessionId:n.sessionId});case Oe.SET_P2P_ID:return Ut(Ut({},e),{},{p2pId:n.p2pId});case Oe.SET_UID:return Ut(Ut({},e),{},{uid:n.uid});case Oe.SET_INT_UID:return Ut(Ut({},e),{},{intUid:n.intUid});case Oe.SET_PUB_ID:return Ut(Ut({},e),{},{pubId:n.pubId});case Oe.KEY_METRIC_CLIENT_CREATED:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{clientCreated:n.metric})});case Oe.KEY_METRIC_JOIN_START:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{joinStart:n.metric})});case Oe.AVOID_JOIN_START:return Ut(Ut({},e),{},{avoidJoinStart:n.avoidJoinStart});case Oe.KEY_METRIC_JOIN_END:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{joinEnd:n.metric})});case Oe.KEY_METRIC_REQUEST_AP_START:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{requestAPStart:n.metric})});case Oe.KEY_METRIC_REQUEST_AP_END:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{requestAPEnd:n.metric})});case Oe.KEY_METRIC_JOIN_GATEWAY_START:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{joinGatewayStart:n.metric})});case Oe.KEY_METRIC_JOIN_GATEWAY_END:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{joinGatewayEnd:n.metric})});case Oe.KEY_METRIC_PEER_CONNECTION_START:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{peerConnectionStart:n.metric})});case Oe.KEY_METRIC_PEER_CONNECTION_END:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{peerConnectionEnd:n.metric})});case Oe.KEY_METRIC_DESCRIPTION_START:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{descriptionStart:n.metric})});case Oe.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{signalChannelOpen:n.metric})});case Oe.KEY_METRIC_ICE_CONNECTION_END:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{iceConnectionEnd:n.metric})});case Oe.KEY_METRIC_PUBLISH:{const i=e.keyMetrics.publish,r=i.findIndex(o=>o.trackId===n.metric.trackId);return r!==-1?(i[r]=Ut(Ut({},i[r]),n.metric),Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{publish:[...i]})})):Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,n.metric]})})}case Oe.KEY_METRIC_SUBSCRIBE:{const i=e.keyMetrics.subscribe,r=i.findIndex(o=>o.userId===n.metric.userId&&o.type===n.metric.type);return r!==-1?(i[r]=Ut(Ut({},i[r]),n.metric),Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{subscribe:[...i]})})):Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,n.metric]})})}case Oe.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=n.mode,e;case Oe.RECORD_JOIN_CHANNEL_SERVICE:return typeof n.index!="number"?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,n.record]:(e.joinChannelServiceRecords[n.index]=Ut(Ut({},e.joinChannelServiceRecords[n.index]),n.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case Oe.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case Oe.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case Oe.SET_USE_P2P:return Ut(Ut({},e),{},{useP2P:n.val});case Oe.SET_TRANSPORT_TYPE:return Ut(Ut({},e),{},{p2pTransport:n.val});default:return e}}(this.state,t)}set sessionId(t){this.dispatch({type:Oe.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set cid(t){this.state.cid=t}get cid(){return this.state.cid}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:Oe.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:Oe.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:Oe.SET_UID,uid:t})}get uid(){return this.state.uid}set intUid(t){this.dispatch({type:Oe.SET_INT_UID,intUid:t})}get intUid(){return this.state.intUid}set pubId(t){this.dispatch({type:Oe.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:Oe.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(t){this.dispatch({type:Oe.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}set p2pTransport(t){this.dispatch({type:Oe.SET_TRANSPORT_TYPE,val:t})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(t){this.state.hasStartJoinChannel=t}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(t){this.state.isABTestSuccess=t}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Oe.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Oe.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Oe.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Oe.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Oe.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Oe.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Oe.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Oe.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Oe.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Oe.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Oe.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Oe.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,e,n,i){this.dispatch({type:Oe.KEY_METRIC_PUBLISH,metric:Ut(Ut({trackId:t,type:e},n&&{publishStart:n}),i&&{publishEnd:i})})}subscribe(t,e,n,i,r,o,c){this.dispatch({type:Oe.KEY_METRIC_SUBSCRIBE,metric:Ut(Ut(Ut(Ut(Ut({userId:t,type:e},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),r&&{firstFrame:r}),o&&{streamAdded:o}),c&&{firstDecoded:c})})}massSubscribe(t,e,n,i){t.forEach(r=>{this.dispatch({type:Oe.KEY_METRIC_SUBSCRIBE,metric:Ut(Ut(Ut({userId:r.userId,type:r.type},e&&{subscribeStart:e}),n&&{subscribeEnd:n}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,e){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(n=>n.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof e!="number"?(this.dispatch({type:Oe.RECORD_JOIN_CHANNEL_SERVICE,record:Ut(Ut({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(e<0||e>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Oe.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:e}),e)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Oe.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Oe.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:Oe.AVOID_JOIN_START,avoidJoinStart:t})}},XR=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});let FK=0;var hM=(()=>{var t={8:(i,r,o)=>{o.r(r),o.d(r,{Parser:()=>Dt,Printer:()=>Xn,parse:()=>yt,print:()=>Kt});const c=`
`,l="".concat("\r").concat(c),h=" ";let p;function m(ft){return ft>="0"&&ft<="9"}function S(ft){return ft>="!"&&ft<="~"}function v(ft){return S(ft)||ft>=""&&ft<="ÿ"}function y(ft){return ft==="!"||ft>="#"&&ft<="'"||ft>="*"&&ft<="+"||ft>="-"&&ft<="."||ft>="0"&&ft<="9"||ft>="A"&&ft<="Z"||ft>="^"&&ft<="~"}function P(ft){return ft>="1"&&ft<="9"}function I(ft){return ft>="A"&&ft<="Z"||ft>="a"&&ft<="z"}function O(ft){return ft==="d"||ft==="h"||ft==="m"||ft==="s"}function M(ft){return ft>""&&ft<"	"||ft>"\v"&&ft<"\f"||ft>""&&ft<"ÿ"}function U(ft){return I(ft)||m(ft)||ft==="+"||ft==="/"}function W(ft){return m(ft)||I(ft)||ft==="+"||ft==="/"||ft==="-"||ft==="_"}function $(ft){return I(ft)||m(ft)||ft==="+"||ft==="/"}function Q(ft,A){var F=Object.keys(ft);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(ft);A&&(H=H.filter(function(Tt){return Object.getOwnPropertyDescriptor(ft,Tt).enumerable})),F.push.apply(F,H)}return F}function q(ft){for(var A=1;A<arguments.length;A++){var F=arguments[A]!=null?arguments[A]:{};A%2?Q(Object(F),!0).forEach(function(H){ct(ft,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ft,Object.getOwnPropertyDescriptors(F)):Q(Object(F)).forEach(function(H){Object.defineProperty(ft,H,Object.getOwnPropertyDescriptor(F,H))})}return ft}function ct(ft,A,F){return A in ft?Object.defineProperty(ft,A,{value:F,enumerable:!0,configurable:!0,writable:!0}):ft[A]=F,ft}(function(ft){ft.VERSION="v",ft.ORIGIN="o",ft.SESSION_NAME="s",ft.INFORMATION="i",ft.URI="u",ft.EMAIL="e",ft.PHONE="p",ft.CONNECTION="c",ft.BANDWIDTH="b",ft.TIME="t",ft.REPEAT="r",ft.ZONE_ADJUSTMENTS="z",ft.KEY="k",ft.ATTRIBUTE="a",ft.MEDIA="m"})(p||(p={}));class _t{consumeText(A,F){let H=F;for(;H<A.length;){const Tt=A[H];if(Tt==="\0"||Tt==="\r"||Tt===c)break;H+=1}if(H-F==0)throw new Error("Invalid text, at ".concat(A));return H}consumeUnicastAddress(A,F,H){return this.consumeTill(A,F,h)}consumeOneOrMore(A,F,H){let Tt=F;for(;H(A[Tt]);)Tt++;if(Tt-F==0)throw new Error("Invalid rule at ".concat(F,"."));return Tt}consumeSpace(A,F){if(A[F]===h)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(A,F){let H=F;for(let Tt=0;Tt<4;Tt++)if(H=this.consumeDecimalUChar(A,H),Tt!==3){if(A[H]!==".")throw new Error("Invalid IP4 address.");H++}return H}consumeDecimalUChar(A,F){let H=F;for(let he=0;he<3&&m(A[H]);he++,H++);if(H-F==0)throw new Error("Invalid decimal uchar.");const Tt=parseInt(A.slice(F,H));if(Tt>=0&&Tt<=255)return H;throw new Error("Invalid decimal uchar")}consumeIP6Address(A,F){let H=this.consumeHexpart(A,F);return A[H]===":"&&(H+=1,H=this.consumeIP4Address(A,H)),H}consumeHexpart(A,F){let H=F;if(A[H]===":"&&A[H+1]===":"){H+=2;try{H=this.consumeHexseq(A,H)}catch{}return H}if(H=this.consumeHexseq(A,H),A[H]===":"&&A[H+1]===":"){H+=2;try{H=this.consumeHexseq(A,H)}catch{}return H}return H}consumeHexseq(A,F){let H=F;for(;H=this.consumeHex4(A,H),A[H]===":"&&A[H+1]!==":";)H+=1;return H}consumeHex4(A,F){let H=0;for(;H<4;H++)if(!((Tt=A[F+H])>="0"&&Tt<="9"||Tt>="a"&&Tt<="f"||Tt>="A"&&Tt<="F")){if(H===0)throw new Error("Invalid hex 4");break}var Tt;return F+H}consumeFQDN(A,F){let H=F;for(;m(A[H])||I(A[H])||A[H]==="-"||A[H]===".";)H+=1;if(H-F<4)throw new Error("Invalid FQDN");return H}consumeExtnAddr(A,F){return this.consumeOneOrMore(A,F,v)}consumeMulticastAddress(A,F,H){switch(H){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(A,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(A,F);default:try{return this.consumeFQDN(A,F)}catch{return this.consumeExtnAddr(A,F)}}}consumeIP6MulticastAddress(A,F){const H=this.consumeHexpart(A,F);return A[H]==="/"?this.consumeInteger(A,H+1):H}consumeIP4MulticastAddress(A,F){let H=F+3;const Tt=A.slice(F,H),he=parseInt(Tt);if(he<224||he>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let rn=0;rn<3;rn++){if(A[H]!==".")throw new Error("Invalid IP4 multicast address.");H+=1,H=this.consumeDecimalUChar(A,H)}return A[H]==="/"&&(H+=1),H=this.consumeTTL(A,H),A[H]==="/"&&(H=this.consumeInteger(A,H)),H}consumeInteger(A,F){if(!P(A[F]))throw new Error("Invalid integer.");for(F+=1;m(A[F]);)F+=1;return F}consumeTTL(A,F){if(A[F]==="0")return F+1;if(!P(A[F]))throw new Error("Invalid TTL.");F+=1;for(let H=0;H<2&&m(A[F]);H++)F+=1;return F}consumeToken(A,F){return this.consumeOneOrMore(A,F,y)}consumeTime(A,F){let H=F;if(A[H]==="0")return H+1;for(P(A[H])&&(H+=1);m(A[H]);)H++;if(H-F<10)throw new Error("Invalid time");return H}consumeAddress(A,F){return this.consumeTill(A,F,h)}consumeTypedTime(A,F){let H=F;return H=this.consumeOneOrMore(A,H,m),O(A[H])?H+1:H}consumeRepeatInterval(A,F){if(!P(A[F]))throw new Error("Invalid repeat interval");for(F+=1;m(A[F]);)F+=1;return O(A[F])&&(F+=1),F}consumePort(A,F){return this.consumeOneOrMore(A,F,m)}consume(A,F,H){for(let Tt=0;Tt<H.length;Tt++){if(F+Tt>=A.length)throw new Error("consume exceeding value length");if(A[F+Tt]!==H[Tt])throw new Error("consume ".concat(H," failed at ").concat(Tt))}return F+H.length}consumeTill(A,F,H){let Tt=F;for(;Tt<A.length&&(typeof H!="string"||A[Tt]!==H)&&(typeof H!="function"||!H(A[Tt]));)Tt++;return Tt}}class Dt extends _t{constructor(){super(),ct(this,"records",[]),ct(this,"currentLine",0)}parse(A){const F=this.probeEOL(A);this.records=A.split(F).filter(Ap=>!!pr(Ap).call(Ap)).map(this.parseLine),this.currentLine=0;const H=this.parseVersion(),Tt=this.parseOrigin(),he=this.parseSessionName(),rn=this.parseInformation(),Ai=this.parseUri(),ls=this.parseEmail(),sd=this.parsePhone(),Cp=this.parseConnection(),jS=this.parseBandWidth(),rC=this.parseTimeFields(),sC=this.parseKey(),vo=this.parseSessionAttribute(),bu=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:H,origin:Tt,sessionName:he,information:rn,uri:Ai,emails:ls,phones:sd,connection:Cp,bandwidths:jS,timeFields:rC,key:sC,attributes:vo,mediaDescriptions:bu}}getCurrentRecord(){const A=this.records[this.currentLine];if(!A)throw new Error("Record doesn't exit.");return A}probeEOL(A){for(let F=0;F<A.length;F++)if(A[F]===c)return A[F-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(A,F){if(A.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const H=A[0];if(A[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:H,value:A.slice(2),line:F,cur:0}}parseSessionAttribute(){const A=new De;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==p.ATTRIBUTE)break;const H={attField:this.extractOneOrMore(F,Tt=>y(Tt)&&Tt!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,H.attValue=this.extractOneOrMore(F,M)),A.parse(H),this.currentLine++}return A.digest()}parseMediaAttributes(A){const F=new Pe(A);for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==p.ATTRIBUTE)break;const Tt={attField:this.extractOneOrMore(H,he=>y(he)&&he!==":"),_cur:0};H.value[H.cur]===":"&&(H.cur+=1,Tt.attValue=this.extractOneOrMore(H,M)),F.parse(Tt),this.currentLine++}return F.digest()}parseKey(){const A=this.getCurrentRecord();if(A.type===p.KEY){if(A.value==="prompt"||A.value==="clear:"||A.value==="base64:"||A.value==="uri:")return A.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const A=this.getCurrentRecord();if(A.type===p.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const H=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);let Tt=!1;A.value[A.cur]==="-"&&(Tt=!0,A.cur+=1);const he=this.extract(A,this.consumeTypedTime);F.push({time:H,typedTime:he,back:Tt})}catch{break}if(F.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const A=[];for(;;){const F=this.getCurrentRecord();if(F.type!==p.REPEAT)break;{const H=this.extract(F,this.consumeRepeatInterval),Tt=this.parseTypedTime(F);A.push({repeatInterval:H,typedTimes:Tt}),this.currentLine++}}return A}parseTypedTime(A){const F=[];for(;;)try{this.consumeSpaceForRecord(A),F.push(this.extract(A,this.consumeTypedTime))}catch{break}if(F.length===0)throw new Error("Invalid typed time.");return F}parseTime(){const A=this.getCurrentRecord(),F=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);const H=this.extract(A,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:H}}parseBandWidth(){const A=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==p.BANDWIDTH)break;{const H=this.extractOneOrMore(F,y);if(F.value[F.cur]!==":")throw new Error("Invalid bandwidth field.");F.cur++;const Tt=this.extractOneOrMore(F,m);A.push({bwtype:H,bandwidth:Tt}),this.currentLine++}}return A}parseVersion(){const A=this.getCurrentRecord();if(A.type!==p.VERSION)throw new Error("first sdp record must be version");const F=A.value.slice(0,this.consumeOneOrMore(A.value,0,m));if(F.length!==A.value.length)throw new Error('invalid proto version, "v='.concat(A.value,'"'));return this.currentLine++,F}parseOrigin(){const A=this.getCurrentRecord();if(A.type!==p.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(A,v);this.consumeSpaceForRecord(A);const H=this.extractOneOrMore(A,m);this.consumeSpaceForRecord(A);const Tt=this.extractOneOrMore(A,m);this.consumeSpaceForRecord(A);const he=this.extractOneOrMore(A,y);this.consumeSpaceForRecord(A);const rn=this.extractOneOrMore(A,y);this.consumeSpaceForRecord(A);const Ai=this.extract(A,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:H,sessVersion:Tt,nettype:he,addrtype:rn,unicastAddress:Ai}}parseSessionName(){const A=this.getCurrentRecord();if(A.type===p.SESSION_NAME){const F=this.extract(A,this.consumeText);return this.currentLine++,F}}parseInformation(){const A=this.getCurrentRecord();if(A.type!==p.INFORMATION)return;const F=this.extract(A,this.consumeText);return this.currentLine++,F}parseUri(){const A=this.getCurrentRecord();if(A.type===p.URI)return this.currentLine++,A.value}parseEmail(){const A=[];for(;;){const F=this.getCurrentRecord();if(F.type!==p.EMAIL)break;A.push(F.value),this.currentLine++}return A}parsePhone(){const A=[];for(;;){const F=this.getCurrentRecord();if(F.type!==p.PHONE)break;A.push(F.value),this.currentLine++}return A}parseConnection(){const A=this.getCurrentRecord();if(A.type===p.CONNECTION){const F=this.extractOneOrMore(A,y);this.consumeSpaceForRecord(A);const H=this.extractOneOrMore(A,y);this.consumeSpaceForRecord(A);const Tt=this.extract(A,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:H,address:Tt}}}parseMedia(){const A=this.getCurrentRecord(),F=this.extract(A,this.consumeToken);this.consumeSpaceForRecord(A);let H=this.extract(A,this.consumePort);A.value[A.cur]==="/"&&(A.cur+=1,H+=this.extract(A,this.consumeInteger)),this.consumeSpaceForRecord(A);const Tt=[];for(Tt.push(this.extract(A,this.consumeToken));A.value[A.cur]==="/";)A.cur+=1,Tt.push(this.extract(A,this.consumeToken));if(Tt.length===0)throw new Error("Invalid proto");const he=this.parseFmt(A);return this.currentLine++,{mediaType:F,port:H,protos:Tt,fmts:he}}parseTimeFields(){const A=[];for(;this.getCurrentRecord().type===p.TIME;){const F=this.parseTime(),H=this.parseRepeat(),Tt=this.parseZone();A.push({time:F,repeats:H,zones:Tt})}return A}parseMediaDescription(){const A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.MEDIA;){const F=this.parseMedia(),H=this.parseInformation(),Tt=this.parseConnections(),he=this.parseBandWidth(),rn=this.parseKey(),Ai=this.parseMediaAttributes(F);A.push({media:F,information:H,connections:Tt,bandwidths:he,key:rn,attributes:Ai})}return A}parseConnections(){const A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.CONNECTION;)A.push(this.parseConnection());return A}parseFmt(A){const F=[];for(;;)try{this.consumeSpaceForRecord(A),F.push(this.extract(A,this.consumeToken))}catch{break}if(F.length===0)throw new Error("Invalid fmts");return F}extract(A,F){for(var H=arguments.length,Tt=new Array(H>2?H-2:0),he=2;he<H;he++)Tt[he-2]=arguments[he];const rn=F.call(this,A.value,A.cur,...Tt),Ai=A.value.slice(A.cur,rn);return A.cur=rn,Ai}extractOneOrMore(A,F){const H=this.consumeOneOrMore(A.value,A.cur,F),Tt=A.value.slice(A.cur,H);return A.cur=H,Tt}consumeSpaceForRecord(A){if(A.value[A.cur]!==h)throw new Error("Invalid space at ".concat(A.cur,"."));A.cur+=1}}class Mt extends _t{constructor(){super(...arguments),ct(this,"attributes",void 0),ct(this,"digested",!1)}extractOneOrMore(A,F,H){const Tt=this.consumeOneOrMore(A.attValue,A._cur,F),he=A.attValue.slice(A._cur,Tt),[rn,Ai]=H||[];if(typeof rn=="number"&&he.length<rn)throw new Error("error in length, should be more or equal than ".concat(rn," characters."));if(typeof Ai=="number"&&he.length>Ai)throw new Error("error in length, should be less or equal than ".concat(Ai," characters."));return A._cur=Tt,he}consumeAttributeSpace(A){if(A.attValue[A._cur]!==h)throw new Error("Invalid space at ".concat(A._cur,"."));A._cur+=1}extract(A,F){if(!A.attValue)throw new Error("Nothing to extract from attValue.");for(var H=arguments.length,Tt=new Array(H>2?H-2:0),he=2;he<H;he++)Tt[he-2]=arguments[he];const rn=F.call(this,A.attValue,A._cur,...Tt),Ai=A.attValue.slice(A._cur,rn);return A._cur=rn,Ai}atEnd(A){if(!A.attValue)throw new Error;return A._cur>=A.attValue.length}peekChar(A){if(!A.attValue)throw new Error;return A.attValue[A._cur]}peek(A,F){if(!A.attValue)throw new Error;for(let H=0;H<F.length;H++)if(F[H]!==A.attValue[A._cur+H])return!1;return!0}parseIceUfrag(A){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(A,U,[4,256])}parseIcePwd(A){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(A,U,[22,256])}parseIceOptions(A){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(A);){F.push(this.extractOneOrMore(A,U));try{this.consumeAttributeSpace(A)}catch(H){if(this.atEnd(A))break;throw H}}this.attributes.iceOptions=F}parseFingerprint(A){const F=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const H=this.extract(A,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:H})}parseExtmap(A){const F=this.extractOneOrMore(A,m);let H;this.peekChar(A)==="/"&&(this.extract(A,this.consume,"/"),H=this.extract(A,this.consumeToken)),this.consumeAttributeSpace(A);const Tt=this.extract(A,this.consumeTill,h),he=q(q({entry:parseInt(F,10)},H&&{direction:H}),{},{extensionName:Tt});this.peekChar(A)===h&&(this.consumeAttributeSpace(A),he.extensionAttributes=this.extract(A,this.consumeTill)),this.attributes.extmaps.push(he)}parseSetup(A){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(A,this.consumeTill);if(F!=="active"&&F!=="passive"&&F!=="actpass"&&F!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class De extends Mt{constructor(){super(...arguments),ct(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"group":this.parseGroup(A);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"fingerprint":this.parseFingerprint(A);break;case"setup":this.parseSetup(A);break;case"tls-id":this.parseTlsId(A);break;case"identity":this.parseIdentity(A);break;case"extmap":this.parseExtmap(A);break;case"msid-semantic":this.parseMsidSemantic(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(F){throw console.error("parsing session attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),F}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(A){const F=this.extract(A,this.consumeToken),H=[];for(;!this.atEnd(A)&&this.peekChar(A)===h;)this.consumeAttributeSpace(A),H.push(this.extract(A,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:H})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(A){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(A,W)}parseIdentity(A){const F=this.extractOneOrMore(A,$),H=[];for(;!this.atEnd(A)&&this.peekChar(A)===h;){this.consumeAttributeSpace(A);const Tt=this.extract(A,this.consumeToken);this.extract(A,this.consume,"=");const he=this.extractOneOrMore(A,rn=>rn!==h&&M(rn));H.push({name:Tt,value:he})}this.attributes.identities.push({assertionValue:F,extensions:H})}parseMsidSemantic(A){this.peekChar(A)===h&&this.consumeAttributeSpace(A);const F={semantic:this.extract(A,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(A)}catch{break}if(this.peekChar(A)==="*"){this.extract(A,this.consume,"*"),F.applyForAll=!0;break}{const H=this.extract(A,this.consumeTill,h);F.identifierList.push(H)}}this.attributes.msidSemantic=F}}class Pe extends Mt{constructor(A){super(),ct(this,"attributes",void 0),A.protos.indexOf("RTP")!==-1||A.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"extmap":this.parseExtmap(A);break;case"setup":this.parseSetup(A);break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"candidate":this.parseCandidate(A);break;case"remote-candidate":this.parseRemoteCandidate(A);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(A);break;case"rtpmap":this.parseRtpmap(A);break;case"ptime":this.parsePtime(A);break;case"maxptime":this.parseMaxPtime(A);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(A);break;case"ssrc":this.parseSSRC(A);break;case"fmtp":this.parseFmtp(A);break;case"rtcp-fb":this.parseRtcpFb(A);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(A);break;case"mid":this.parseMid(A);break;case"msid":this.parseMsid(A);break;case"imageattr":this.parseImageAttr(A);break;case"rid":this.parseRid(A);break;case"simulcast":this.parseSimulcast(A);break;case"sctp-port":this.parseSctpPort(A);break;case"max-message-size":this.parseMaxMessageSize(A);break;case"ssrc-group":this.parseSSRCGroup(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(F){throw console.error("parsing media attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),F}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}parseCandidate(A){const F=this.extractOneOrMore(A,U,[1,32]);this.consumeAttributeSpace(A);const H=this.extractOneOrMore(A,m,[1,5]);this.consumeAttributeSpace(A);const Tt=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const he=this.extractOneOrMore(A,m,[1,10]);this.consumeAttributeSpace(A);const rn=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);const Ai=this.extract(A,this.consumePort);this.consumeAttributeSpace(A),this.extract(A,this.consume,"typ"),this.consumeAttributeSpace(A);const ls={foundation:F,componentId:H,transport:Tt,priority:he,connectionAddress:rn,port:Ai,type:this.extract(A,this.consumeToken),extension:{}};for(this.peek(A," raddr")&&(this.extract(A,this.consume," raddr"),this.consumeAttributeSpace(A),ls.relAddr=this.extract(A,this.consumeAddress)),this.peek(A," rport")&&(this.extract(A,this.consume," rport"),this.consumeAttributeSpace(A),ls.relPort=this.extract(A,this.consumePort));this.peekChar(A)===h;){this.consumeAttributeSpace(A);const sd=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A),ls.extension[sd]=this.extractOneOrMore(A,S)}this.attributes.candidates.push(ls)}parseRemoteCandidate(A){const F=[];for(;;){const H=this.extractOneOrMore(A,m,[1,5]);this.consumeAttributeSpace(A);const Tt=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);const he=this.extract(A,this.consumePort);F.push({componentId:H,connectionAddress:Tt,port:he});try{this.consumeAttributeSpace(A)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(A){const F=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const H=this.extract(A,this.consumeTill,"/");this.extract(A,this.consume,"/");const Tt={encodingName:H,clockRate:this.extractOneOrMore(A,m)};this.atEnd(A)||this.peekChar(A)!=="/"||(this.extract(A,this.consume,"/"),Tt.encodingParameters=parseInt(this.extract(A,this.consumeTill),10));const he=this.attributes.payloads.find(rn=>rn.payloadType===parseInt(F,10));he?he.rtpMap=Tt:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:Tt,rtcpFeedbacks:[]})}parsePtime(A){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(A,this.consumeTill)}parseMaxPtime(A){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(A,this.consumeTill)}parseDirection(A){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=A.attField}parseSSRC(A){const F=this.extractOneOrMore(A,m);this.consumeAttributeSpace(A);const H=this.extract(A,this.consumeTill,":");let Tt;this.peekChar(A)===":"&&(this.extract(A,this.consume,":"),Tt=this.extract(A,this.consumeTill));const he=this.attributes.ssrcs.find(rn=>rn.ssrcId===parseInt(F,10));he?he.attributes[H]=Tt:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[H]:Tt}})}parseFmtp(A){const F=this.extract(A,this.consumeTill,h);this.consumeAttributeSpace(A);const H=this.extract(A,this.consumeTill),Tt={};H.split(";").forEach(rn=>{let[Ai,ls]=rn.split("=");Ai=pr(Ai).call(Ai);const sd=typeof ls=="string"?pr(ls).call(ls):null;typeof Ai=="string"&&Ai.length>0&&(Tt[Ai]=sd)});const he=this.attributes.payloads.find(rn=>rn.payloadType===parseInt(F,10));he?he.fmtp={parameters:Tt}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:Tt}})}parseFmtParameters(A){const F={},H=this.extract(A,this.consumeTill,"=");A._cur++;const Tt=this.extract(A,this.consumeTill,";");for(F[H]=Tt;A.attValue[A._cur]===";";){const he=this.extract(A,this.consumeTill,"=");A._cur++;const rn=this.extract(A,this.consumeTill,";");F[he]=rn}return F}parseRtcpFb(A){let F="";F=this.peekChar(A)==="*"?this.extract(A,this.consume,"*"):this.extract(A,this.consumeTill,h),this.consumeAttributeSpace(A);const H=this.extract(A,this.consumeTill,h);let Tt;if(H==="trr-int")Tt={type:H,interval:this.extract(A,this.consumeTill)};else{const he={type:H};this.peekChar(A)===h&&(this.consumeAttributeSpace(A),he.parameter=this.extract(A,this.consumeToken),this.peekChar(A)===h&&(he.additional=this.extract(A,this.consumeTill))),Tt=he}if(F==="*")this.attributes.rtcpFeedbackWildcards.push(Tt);else{const he=this.attributes.payloads.find(rn=>rn.payloadType===parseInt(F,10));he?he.rtcpFeedbacks.push(Tt):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[Tt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(A){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(A,this.consumePort)};this.peekChar(A)===h&&(this.consumeAttributeSpace(A),F.netType=this.extractOneOrMore(A,y),this.consumeAttributeSpace(A),F.addressType=this.extractOneOrMore(A,y),this.consumeAttributeSpace(A),F.address=this.extract(A,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(A){const F={id:this.extractOneOrMore(A,y,[1,64])};this.peekChar(A)===h&&(this.consumeAttributeSpace(A),F.appdata=this.extractOneOrMore(A,y,[1,64])),this.attributes.msids.push(F)}parseImageAttr(A){this.attributes.imageattr.push(A.attValue)}parseRid(A){const F=this.extractOneOrMore(A,Tt=>I(Tt)||m(Tt)||Tt==="_"||Tt==="-");this.consumeAttributeSpace(A);const H={id:F,direction:this.extract(A,this.consumeToken),params:[]};if(this.peekChar(A)===h){if(this.consumeAttributeSpace(A),this.peek(A,"pt=")){this.extract(A,this.consume,"pt=");const Tt=[];for(;;){const he=this.extract(A,this.consumeToken);Tt.push(he);try{this.extract(A,this.consume,",")}catch{break}}H.payloads=Tt,this.peekChar(A)===h&&this.extract(A,this.consume,h)}for(;;){const Tt=this.extract(A,this.consumeToken);switch(Tt){case"depend":{const he={type:Tt,rids:this.extract(A,this.consume,"=").split(",")};H.params.push(he);break}default:{const he={type:Tt};this.peekChar(A)==="="&&(this.extract(A,this.consume,"="),he.val=this.extract(A,this.consumeTill,";")),H.params.push(he)}}try{this.extract(A,this.consume,";")}catch{break}}}this.attributes.rids.push(H)}parseSimulcast(A){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=A.attValue,this.extract(A,this.consumeTill)}parseSctpPort(A){this.attributes.sctpPort=this.extractOneOrMore(A,m,[1,5])}parseMaxMessageSize(A){this.attributes.maxMessageSize=this.extractOneOrMore(A,m,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(A){this.attributes.mid=this.extract(A,this.consumeToken)}parseSSRCGroup(A){const F=this.extract(A,this.consumeToken),H=[];for(;;)try{this.consumeAttributeSpace(A);const Tt=this.extract(A,this.consumeInteger);H.push(parseInt(Tt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:H})}}function fn(ft,A,F){return A in ft?Object.defineProperty(ft,A,{value:F,enumerable:!0,configurable:!0,writable:!0}):ft[A]=F,ft}class Xn{constructor(){fn(this,"eol",l)}print(A,F){let H="";return F&&(this.eol=F),H+=this.printVersion(A.version),H+=this.printOrigin(A.origin),H+=this.printSessionName(A.sessionName),H+=this.printInformation(A.information),H+=this.printUri(A.uri),H+=this.printEmail(A.emails),H+=this.printPhone(A.phones),H+=this.printConnection(A.connection),H+=this.printBandwidth(A.bandwidths),H+=this.printTimeFields(A.timeFields),H+=this.printKey(A.key),H+=this.printSessionAttributes(A.attributes),H+=this.printMediaDescription(A.mediaDescriptions),H}printVersion(A){return"v=".concat(A).concat(this.eol)}printOrigin(A){return"o=".concat(A.username," ").concat(A.sessId," ").concat(A.sessVersion," ").concat(A.nettype," ").concat(A.addrtype," ").concat(A.unicastAddress).concat(this.eol)}printSessionName(A){return A?"s=".concat(A).concat(this.eol):""}printInformation(A){return A?"i=".concat(A).concat(this.eol):""}printUri(A){return A?"u=".concat(A).concat(this.eol):""}printEmail(A){let F="";for(const H of A)F+="e=".concat(H).concat(this.eol);return F}printPhone(A){let F="";for(const H of A)F+="e=".concat(H).concat(this.eol);return F}printConnection(A){return A?"c=".concat(A.nettype," ").concat(A.addrtype," ").concat(A.address).concat(this.eol):""}printBandwidth(A){let F="";for(const H of A)F+="b=".concat(H.bwtype,":").concat(H.bandwidth).concat(this.eol);return F}printTimeFields(A){let F="";for(const H of A){F+="t=".concat(H.time.startTime," ").concat(H.time.startTime).concat(this.eol);for(const Tt of H.repeats)F+="r=".concat(Tt.repeatInterval," ").concat(Tt.typedTimes.join(" ")).concat(this.eol);H.zoneAdjustments&&(F+="z=",F+="z=".concat(H.zoneAdjustments.map(Tt=>"".concat(Tt.time," ").concat(Tt.back?"-":""," ").concat(Tt.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(A){return A?"k=".concat(A).concat(this.eol):""}printAttributes(A){let F="";for(const H of A)F+="a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol);return F}printMediaDescription(A){let F="";for(const H of A)F+=this.printMedia(H.media),F+=this.printInformation(H.information),F+=this.printConnections(H.connections),F+=this.printBandwidth(H.bandwidths),F+=this.printKey(H.key),F+=this.printMediaAttributes(H);return F}printConnections(A){let F="";for(const H of A)F+=this.printConnection(H);return F}printMedia(A){return"m=".concat(A.mediaType," ").concat(A.port," ").concat(A.protos.join("/")," ").concat(A.fmts.join(" ")).concat(this.eol)}printSessionAttributes(A){return new Wr(this.eol).print(A)}printMediaAttributes(A){return new ht(this.eol).print(A)}}class jn{constructor(A){fn(this,"eol",void 0),this.eol=A}printIceUfrag(A){return A===void 0?"":"a=ice-ufrag:".concat(A).concat(this.eol)}printIcePwd(A){return A===void 0?"":"a=ice-pwd:".concat(A).concat(this.eol)}printIceOptions(A){return A===void 0?"":"a=ice-options:".concat(A.join(h)).concat(this.eol)}printFingerprints(A){return A.length>0?A.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(h).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(A){return A.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(h).concat(F.extensionName).concat(F.extensionAttributes?"".concat(h).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(A){return A===void 0?"":"a=setup:".concat(A).concat(this.eol)}printUnrecognized(A){return A.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class Wr extends jn{print(A){let F="";return F+=this.printGroups(A.groups),F+=this.printMsidSemantic(A.msidSemantic),F+=this.printIceLite(A.iceLite),F+=this.printIceUfrag(A.iceUfrag),F+=this.printIcePwd(A.icePwd),F+=this.printIceOptions(A.iceOptions),F+=this.printFingerprints(A.fingerprints),F+=this.printSetup(A.setup),F+=this.printTlsId(A.tlsId),F+=this.printIdentity(A.identities),F+=this.printExtmap(A.extmaps),F+=this.printUnrecognized(A.unrecognized),F}printGroups(A){let F="";return A.length>0&&(F+=A.map(H=>"a=group:".concat(H.semantic).concat(H.identificationTag.map(Tt=>"".concat(h).concat(Tt)).join("")).concat(this.eol)).join("")),F}printIceLite(A){return A===void 0?"":"a=ice-lite"+this.eol}printTlsId(A){return A?"a=tls-id:".concat(A).concat(this.eol):""}printIdentity(A){return A.length===0?"":A.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(H=>"".concat(h).concat(H.name).concat(H.value?"=".concat(H.value):"")))).join(this.eol)+this.eol}printMsidSemantic(A){if(!A)return"";let F="a=msid-semantic:".concat(A.semantic);return A.applyForAll?F+="".concat(h,"*"):A.identifierList.length>0&&(F+=A.identifierList.map(H=>"".concat(h).concat(H))),F+this.eol}}class ht extends jn{print(A){const F=A.attributes;let H="";return H+=this.printRTCP(F.rtcp),H+=this.printIceUfrag(F.iceUfrag),H+=this.printIcePwd(F.icePwd),H+=this.printIceOptions(F.iceOptions),H+=this.printCandidates(F.candidates),H+=this.printRemoteCandidatesList(F.remoteCandidatesList),H+=this.printEndOfCandidates(F.endOfCandidates),H+=this.printFingerprints(F.fingerprints),H+=this.printSetup(F.setup),H+=this.printMid(F.mid),H+=this.printExtmap(F.extmaps),H+=this.printRTPRelated(F),H+=this.printPtime(F.ptime),H+=this.printMaxPtime(F.maxPtime),H+=this.printDirection(F.direction),H+=this.printSSRCGroups(F.ssrcGroups),H+=this.printSSRC(F.ssrcs),H+=this.printRTCPMux(F.rtcpMux),H+=this.printRTCPMuxOnly(F.rtcpMuxOnly),H+=this.printRTCPRsize(F.rtcpRsize),H+=this.printMSId(F.msids),H+=this.printImageattr(F.imageattr),H+=this.printRid(F.rids),H+=this.printSimulcast(F.simulcast),H+=this.printSCTPPort(F.sctpPort),H+=this.printMaxMessageSize(F.maxMessageSize),H+=this.printUnrecognized(F.unrecognized),H}printCandidates(A){return A.map(F=>"a=candidate:".concat(F.foundation).concat(h).concat(F.componentId).concat(h).concat(F.transport).concat(h).concat(F.priority).concat(h).concat(F.connectionAddress).concat(h).concat(F.port).concat(h,"typ").concat(h).concat(F.type).concat(F.relAddr?"".concat(h,"raddr").concat(h).concat(F.relAddr):"").concat(F.relPort?"".concat(h,"rport").concat(h).concat(F.relPort):"").concat(Object.keys(F.extension).map(H=>"".concat(h).concat(H).concat(h).concat(F.extension[H])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(A){return A.map(F=>"a=remote-candidates:".concat(F.join(h)).concat(this.eol)).join("")}printEndOfCandidates(A){return A===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(A){if(!A.payloads)return"";const F=A.payloads;let H="";H+=A.rtcpFeedbackWildcards.map(Tt=>this.printRTCPFeedback("*",Tt)).join("");for(const Tt of F)H+=this.printRtpMap(Tt.payloadType,Tt.rtpMap),H+=this.printFmtp(Tt.payloadType,Tt.fmtp),H+=Tt.rtcpFeedbacks.map(he=>this.printRTCPFeedback(Tt.payloadType,he)).join("");return H}printFmtp(A,F){if(!F)return"";const H=Object.keys(F.parameters);return H.length===1&&F.parameters[H[0]]===null?"a=fmtp:".concat(A).concat(h).concat(H[0]).concat(this.eol):"a=fmtp:".concat(A).concat(h).concat(Object.keys(F.parameters).map(Tt=>"".concat(Tt,"=").concat(F.parameters[Tt])).join(";")).concat(this.eol)}printRtpMap(A,F){return F?"a=rtpmap:".concat(A).concat(h).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(A,F){let H="a=rtcp-fb:".concat(A).concat(h),Tt=F;return Tt.type==="trr-int"?H+="ttr-int".concat(h).concat(Tt.interval):(H+="".concat(Tt.type),Tt.parameter&&(H+="".concat(h).concat(Tt.parameter),Tt.additional&&(H+="".concat(h).concat(Tt.additional)))),H+this.eol}printPtime(A){return A===void 0?"":"a=ptime:".concat(A).concat(this.eol)}printMaxPtime(A){return A===void 0?"":"a=maxptime:".concat(A).concat(this.eol)}printDirection(A){return A===void 0?"":"a=".concat(A).concat(this.eol)}printSSRC(A){return A.map(F=>Object.keys(F.attributes).map(H=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(h).concat(H).concat(F.attributes[H]?":".concat(F.attributes[H]):"").concat(this.eol)).join("")).join("")}printRTCPMux(A){return A===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(A){return A===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(A){return A===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(A){if(A===void 0)return"";let F="a=rtcp:".concat(A.port);return A.netType&&(F+="".concat(h).concat(A.netType)),A.addressType&&(F+="".concat(h).concat(A.addressType)),A.address&&(F+="".concat(h).concat(A.address)),F+this.eol}printMSId(A){return A.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(h).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(A){return A.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(A){return A.map(F=>{let H="a=rid:".concat(F.id).concat(h).concat(F.direction);return F.payloads&&(H+="".concat(h,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(H+="".concat(h).concat(F.params.map(Tt=>Tt.type==="depend"?"depend=".concat(Tt.rids.join(",")):"".concat(Tt.type,"=").concat(Tt.val)).join(";"))),H+this.eol}).join("")}printSimulcast(A){return A===void 0?"":"a=simulcast:".concat(A).concat(this.eol)}printSCTPPort(A){return A===void 0?"":"a=sctp-port:".concat(A).concat(this.eol)}printMaxMessageSize(A){return A===void 0?"":"a=max-message-size:".concat(A).concat(this.eol)}printMid(A){return A===void 0?"":"a=mid:".concat(A).concat(this.eol)}printSSRCGroups(A){return A.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(H=>"".concat(h).concat(H.toString(10))).join("")).concat(this.eol)).join("")}}function yt(ft){return new Dt().parse(ft)}function Kt(ft,A){return new Xn().print(ft,A)}}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var o in r)n.o(r,o)&&!n.o(i,o)&&Object.defineProperty(i,o,{enumerable:!0,get:r[o]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function rs(t){return hM.parse(t)}function cu(t,e){return hM.print(t,e)}var GK=Zr("Array","keys"),HK=io,WK=ti,KK=et,zK=GK,iI=Array.prototype,YK={DOMTokenList:!0,NodeList:!0},qK=function(t){var e=t.keys;return t===iI||KK(iI,t)&&e===iI.keys||WK(YK,HK(t))?zK:e},Hs=R(qK);function xn(t,e,n){return(e=function(i){var r=function(o){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var l=c.call(o,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ge(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?pM(Object(n),!0).forEach(function(i){xn(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const fM=new class extends On{constructor(){super(...arguments),xn(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class XK{constructor(e){xn(this,"logger",void 0),xn(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function rI(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function mM(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const fo={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},JR=Date.now(),oS=t=>{for(const e in fo)if(Object.prototype.hasOwnProperty.call(fo,e)&&fo[e]===t)return e;return"DEFAULT"},b=new class{constructor(){xn(this,"proxyServerURL",void 0),xn(this,"logLevel",fo.DEBUG),xn(this,"uploadState","collecting"),xn(this,"uploadLogWaitingList",[]),xn(this,"uploadLogUploadingList",[]),xn(this,"uploadErrorCount",0),xn(this,"currentLogID",0),xn(this,"url",void 0),xn(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[fo.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[fo.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[fo.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[fo.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[fo.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){$e("UPLOAD_LOG",!0)}disableLogUpload(){$e("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new XK(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-JR<100)return void setTimeout(()=>{this.log(...e)},Date.now()-JR);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=rI()+" Agora-SDK [".concat(oS(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const r=rI()+" %cAgora-SDK [".concat(oS(i),"]:");let o=[];if(!j("USE_NEW_LOG"))switch(i){case fo.DEBUG:o=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,o);break;case fo.INFO:o=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,o);break;case fo.WARNING:o=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,o);break;case fo.ERROR:o=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-JR<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-JR);const i=Math.max(0,Math.min(4,e[0]));e[0]=rI()+" Agora-SDK [".concat(oS(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!j("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=mM()+" Agora-SDK [".concat(oS(t),"]:"):n[0]=mM()+" Agora-SDK [".concat(oS(t),"]:");let r="";n.forEach(o=>{typeof o=="object"&&(o=JSON.stringify(o)),r+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:po,process_id:j("PROCESS_ID"),payload:JSON.stringify(t)};return ja(async()=>{const n=await Br.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(j("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(j("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:t.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),fM.reportLogUploadError(i),!0},{timeout:j("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:j("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,j("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var EM;function JK(t){return Ui(t.reportId,"params.reportId",0,100,!1),Ui(t.category,"params.category",0,100,!1),Ui(t.event,"params.event",0,100,!1),Ui(t.label,"params.label",0,100,!1),nn(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(EM={}).FREE="free",EM.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const QK={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let bi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Cn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let ZK=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function ie(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,i){const r=i.value;if(typeof r=="function"){const o=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var c,l=arguments.length,h=new Array(l),p=0;p<l;p++)h[p]=arguments[p];let m=h;if(t.argsMap)try{m=t.argsMap(this,...h)}catch(v){b.warning(v),m=[]}try{JSON.stringify(m)}catch{b.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}const S=(t.report||qt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(o,".").concat(String(n)),options:m,tag:Mn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const v=r.apply(this,h);return v instanceof At?v.then(y=>(S.onSuccess(t.reportResult&&y),y)).catch(y=>{throw S.onError(y),y}):(S.onSuccess(t.reportResult&&v),v)}catch(v){throw S.onError(v),v}}}return i}}const qt=new class{constructor(){xn(this,"baseInfoMap",new Map),xn(this,"proxyServer",void 0),xn(this,"eventUploadTimer",void 0),xn(this,"setSessionIdTimer",void 0),xn(this,"url",void 0),xn(this,"sids",new Set),xn(this,"backupUrl",void 0),xn(this,"_appId",void 0),xn(this,"_aid",0),xn(this,"keyEventUploadPendingItems",[]),xn(this,"normalEventUploadPendingItems",[]),xn(this,"apiInvokeUploadPendingItems",[]),xn(this,"apiInvokeCount",0),xn(this,"apiInvokeLoggedCount",0),xn(this,"ltsList",[]),xn(this,"lastSendNormalEventTime",Date.now()),xn(this,"customReportCounterTimer",void 0),xn(this,"customReportCount",0),xn(this,"extApiInvoke",async t=>{for(const e of t){const n=ge(ge({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Mn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),j("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),j("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,i]=e;return n+i}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,o=!!j("SHOW_REPORT_INVOKER_LOG"),c=!!j("SHOW_REPORT_USER_INVOKER_LOG"),l=o||c&&e.id;l&&(this.apiInvokeLoggedCount+=1);const h=this.apiInvokeLoggedCount;function p(y,P){if(l){let I="[apiInvoke-".concat(h,"]");e.id&&(I+="[".concat(e.id,"]")),e.name&&(I+="[".concat(e.name,"]")),b.info("".concat(I," ").concat(y),y==="start"?e.options:P||"")}}const m=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});p("start");let S=!1;Vi(e.timeout).then(()=>{S||(this.sendApiInvoke(ge(ge({},m()),{},{error:k.API_INVOKE_TIMEOUT,success:!1})),p("timeout"))});const v=new at(k.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:y=>{const P=()=>{if(S)throw v;return S=!0,this.sendApiInvoke(ge(ge({},m()),{},{success:!0},e.reportResult&&{result:y})),p("onSuccess"),y};return n?Q1(P,e.name+"Success",n,()=>S=!0):P()},onError:y=>{const P=()=>{if(S)throw y;S=!0,this.sendApiInvoke(ge(ge({},m()),{},{success:!1,error:y})),p("onFailure",y.toString())};return n?Q1(P,e.name+"Error",n,()=>S=!0):P()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:j("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:$0?"global":"oversea",areas:j("AREAS")&&j("AREAS").join(",")},e.extend),{stringUid:o,channelProfile:c,channelMode:l,isABTestSuccess:h,lsid:p,clientRole:m}=e,S=Date.now(),v=ge(ge({},i),{},{eventType:bi.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:eI,lts:S,elapse:S-n,extend:JSON.stringify(r),mode:e.mode,process:j("PROCESS_ID"),appType:j("APP_TYPE"),success:!0,version:po,stringUid:o,channelProfile:c,channelMode:l,isABTestSuccess:h,lsid:p,clientType:Ct(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:m,serviceId:j("PROCESS_ID"),extensionID:j("PLUGIN_INFO").join(",")||""});var y;this.send({type:Cn.SESSION,data:v},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge({},i),{},{role:e.role,eventType:bi.JOIN_CHOOSE_SERVER,lts:r,eventElapse:e.elapse||r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0});this.send({type:Cn.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge({},i),{},{eventType:bi.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||r-n.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:Cn.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const r=Date.now(),{firstSuccess:o,avoidJoinStartTime:c,addr:l,isProxy:h}=e,p=r-(o&&c?c:n.startTime),m=ge(ge({},i),{},{eventType:bi.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:p,eventElapse:r-e.lts,firstSuccess:o,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:Z0(),isABTestSuccess:e.isABTestSuccess?1:0}),S=m.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=r),o)this.send({type:Cn.JOIN_GATEWAY,data:m},!0);else{let v;if(l)if(h){const P=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),I=l.match(/p=[0-9]{1,6}/g);v={isSuccess:S,gatewayIp:P&&P.length?P[0].split("=")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split("=")[1]:"",isProxy:h?1:0}}else{const P=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),I=l.match(/(:|p=)[0-9]{1,6}/g);v={isSuccess:S,gatewayIp:P&&P.length?P[0].split("//")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split(/:|p=/g)[1]:"",isProxy:h?1:0}}else v={isSuccess:S,gatewayIp:"",port:"",isProxy:h?1:0};delete m.success,delete m.eventType,delete m.firstSuccess,m.vid=Number(m.vid);const y=Object.assign({},m,v,{eventType:bi.REJOIN_GATEWAY});this.send({type:Cn.RE_JOIN_GATEWAY,data:y},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),r=ge(ge({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:Cn.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge({},i),{},{eventType:bi.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:Cn.PUBLISH,data:o},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const r=i.info,o=Date.now(),c=ge(ge({},r),{},{eventType:bi.SUBSCRIBE,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:Cn.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const n=[...Hs(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const o=r.info,c=Date.now(),l=ge(ge({},o),{},{eventType:bi.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:Cn.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const o=r.info,c=Date.now(),l=ge(ge(ge({},o),i),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const o=r.info,c=Date.now(),l=ge(ge(ge({},o),i),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:n,data:l},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge(ge({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:bi.AB_TEST,lts:r});this.send({type:Cn.AB_TEST,data:o},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge(ge({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:bi.PC_STATS,lts:r,preallocation:e.preallocation?1:0});this.send({type:Cn.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge(ge({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:bi.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:Cn.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const o=r.info,c=Date.now(),l=ge(ge(ge({},o),i),{},{eventType:e,lts:c});this.send({type:n,data:l},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge({},i),{},{eventType:bi.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-n.startTime,success:e.succ});this.send({type:Cn.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge({},i),{},{eventType:bi.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:Cn.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge({},i),{},{eventType:bi.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:Cn.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(t){this.proxyServer=t,t?b.debug("reportProxyServerurl: ".concat(t)):b.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:Cn.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now();(function(o,c,l){const h=o[c];if(!h||typeof h!="string")return[o];o[c]="";const p=Wc(JSON.stringify(o));let m=0;const S=[];let v=0;for(let y=0;y<h.length;y++)v+=h.charCodeAt(y)<=127?1:3,v<=l-p||(S[S.length]=Ut(Ut({},o),{},{[c]:h.substring(m,y)}),m=y,v=h.charCodeAt(y)<=127?1:3);return m!==h.length-1&&(S[S.length]=Ut(Ut({},o),{},{[c]:h.substring(m)})),S})(ge(ge(ge({},i),e),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(o=>this.send({type:Cn.WORKER_EVENT,data:o},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge(ge({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:Cn.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge(ge({},i),e),{},{elapse:r-n.startTime,lts:r,extend:e.extend||void 0});this.send({type:Cn.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=ge(ge(ge({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:Cn.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>j("CUSTOM_REPORT_LIMIT"))throw new at(k.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=e.map(r=>({type:Cn.USER_ANALYTICS,data:ge(ge({sid:t},r),{},{lts:n})}));try{j("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw b.error("send custom report message failed",r.toString()),new at(k.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=j("NOT_REPORT_EVENT");if(t.tag&&Ct(e)&&Ct(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:r,cid:o}=n.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof at){const{code:h,message:p}=t.error;c=h||p||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:i,cid:o,uid:r,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Cn.API_INVOKE,data:l},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const o=t.shift();n.length<20?n.push(o):i.push(o)}t.push(...i);for(const o of[...n]){var r;this.ltsList.indexOf(o.data.lts)!==-1?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),jg(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),j("ENABLE_EVENT_REPORT")&&n.length&&(j("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((o=>c=>{j("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-j("NORMAL_EVENT_QUEUE_CAPACITY")),b.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){ei.networkState===bs.OFFLINE&&await At.race([ei.onlineWaiter,Vi(2*di.maxRetryTimeout)]);const e=r=>{let o=new Uint8Array;return r.forEach(c=>{const l=j0(JSON.stringify(c.data)),h=new ArrayBuffer(5),p=(S=>{let v=0;return Object.entries(Cn).forEach(y=>{let[P,I]=y;I===S.type&&(v=ZK[P])}),v})(c),m=new DataView(h);m.setUint16(0,l.byteLength,!0),m.setUint8(2,255&p),m.setUint8(3,p>>>8&255),m.setUint8(4,p>>>16&255),o=G1(o,new Uint8Array(h)),o=G1(o,l)}),o},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Y0(i,{timeout:1e4,data:e(t),headers:ge(ge({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o){if(r===1)throw o;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(l=>{const h=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return h&&h.info.vid&&+h.info.vid||0})(t[0]),i=n?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(l=>JSON.stringify(l)),vid:n,aid:i};ei.networkState===bs.OFFLINE&&await At.race([ei.onlineWaiter,Vi(2*di.maxRetryTimeout)]);const o=e?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(j("EVENT_REPORT_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(o));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(j("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(o)));try{e?await UK(c,{timeout:1e4,data:r}):await Y0(c,{timeout:1e4,data:r})}catch(h){if(l===1)throw h;continue}return}}createBaseInfo(t,e){const n=Object.assign({},QK);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:Mn.TRACER}).onSuccess()}};fM.on("REPORT_LOG_UPLOAD",t=>{t.networkState=ei.networkState,qt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Mn.TRACER}).onSuccess("logUploadError")});class rt extends at{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),xn(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,b)}throw(){super.throw(b)}}const Bi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ge(){return Bi}function _M(){return"setSinkId"in HTMLAudioElement.prototype&&(!j("RESTRICTION_SET_PLAYBACK_DEVICE")||(Kl()||N1())&&!U0())}function gM(){return!Bi.supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&zl()}let ji=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Km(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function Ve(t,e,n,i,r){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:r}}function na(t,e,n,i,r){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:r}}function sI(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const $K={"90p":Ve(160,90),"90p_1":Ve(160,90),"120p":Ve(160,120,15,30,65),"120p_1":Ve(160,120,15,30,65),"120p_3":Ve(120,120,15,30,50),"120p_4":Ve(212,120),"180p":Ve(320,180,15,30,140),"180p_1":Ve(320,180,15,30,140),"180p_3":Ve(180,180,15,30,100),"180p_4":Ve(240,180,15,30,120),"240p":Ve(320,240,15,40,200),"240p_1":Ve(320,240,15,40,200),"240p_3":Ve(240,240,15,40,140),"240p_4":Ve(424,240,15,40,220),"360p":Ve(640,360,15,80,400),"360p_1":Ve(640,360,15,80,400),"360p_3":Ve(360,360,15,80,260),"360p_4":Ve(640,360,30,80,600),"360p_6":Ve(360,360,30,80,400),"360p_7":Ve(480,360,15,80,320),"360p_8":Ve(480,360,30,80,490),"360p_9":Ve(640,360,15,80,800),"360p_10":Ve(640,360,24,80,800),"360p_11":Ve(640,360,24,80,1e3),"480p":Ve(640,480,15,100,500),"480p_1":Ve(640,480,15,100,500),"480p_2":Ve(640,480,30,100,1e3),"480p_3":Ve(480,480,15,100,400),"480p_4":Ve(640,480,30,100,750),"480p_6":Ve(480,480,30,100,600),"480p_8":Ve(848,480,15,100,610),"480p_9":Ve(848,480,30,100,930),"480p_10":Ve(640,480,10,100,400),"720p":Ve(1280,720,15,120,1130),"720p_auto":Ve(1280,720,30,900,3e3),"720p_1":Ve(1280,720,15,120,1130),"720p_2":Ve(1280,720,30,120,2e3),"720p_3":Ve(1280,720,30,120,1710),"720p_5":Ve(960,720,15,120,910),"720p_6":Ve(960,720,30,120,1380),"1080p":Ve(1920,1080,15,120,2080),"1080p_1":Ve(1920,1080,15,120,2080),"1080p_2":Ve(1920,1080,30,120,3e3),"1080p_3":Ve(1920,1080,30,120,3150),"1080p_5":Ve(1920,1080,60,120,4780),"1440p":Ve(2560,1440,30,120,4850),"1440p_1":Ve(2560,1440,30,120,4850),"1440p_2":Ve(2560,1440,60,120,7350),"4k":Ve(3840,2160,30,120,8910),"4k_1":Ve(3840,2160,30,120,8910),"4k_3":Ve(3840,2160,60,120,13500)},tz={"480p":na(640,480,5),"480p_1":na(640,480,5),"480p_2":na(640,480,30),"480p_3":na(640,480,15),"720p":na(1280,720,5),"720p_auto":Ve(1280,720,30,900,3e3),"720p_1":na(1280,720,5),"720p_2":na(1280,720,30),"720p_3":na(1280,720,15),"1080p":na(1920,1080,5),"1080p_1":na(1920,1080,5),"1080p_2":na(1920,1080,30),"1080p_3":na(1920,1080,15)},ez={"1SL1TL":sI(1,1),"3SL3TL":sI(3,3),"2SL3TL":sI(2,3)};function zc(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},$K[t]):t}function oI(t){return typeof t=="string"?Object.assign({},tz[t]):t}function QR(t){return typeof t=="string"?Object.assign({},ez[t]):t}const nz={speech_low_quality:Km(16e3,!1),speech_standard:Km(32e3,!1,18),music_standard:Km(48e3,!1),standard_stereo:Km(48e3,!0,56),high_quality:Km(48e3,!1,128),high_quality_stereo:Km(48e3,!0,192)};function ZR(t){return typeof t=="string"?Object.assign({},nz[t]):t}const zm=[];function SM(t){return Si(t,"mediaSource",["screen","window","application"]),!0}let jt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),pn=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Ym=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),iz=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),rz=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),rp=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),qm=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Xm=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),Jm=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Ws=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const aI={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},cI={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},TM={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},sz={uplinkNetworkQuality:0,downlinkNetworkQuality:0},vM={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Cr=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Ks=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),aS=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),sp=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),fr=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Yc=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const lI={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let $R=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Be(t,e,n,i,r){var o,c,l={};return Object.keys(i).forEach(function(h){l[h]=i[h]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=qi(o=g_(c=n.slice()).call(c)).call(o,function(h,p){return p(t,e,h)||h},l),r&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),l.initializer===void 0?(Object.defineProperty(t,e,l),null):l}function it(t,e,n){return(e=function(i){var r=function(o){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var l=c.call(o,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function yM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function An(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yM(Object(n),!0).forEach(function(i){it(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class RM extends On{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(rp.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),it(this,"trackMediaType",void 0),it(this,"_ID",void 0),it(this,"_rtpTransceiver",void 0),it(this,"_lowRtpTransceiver",void 0),it(this,"_hints",[]),it(this,"_isClosed",!1),it(this,"_originMediaStreamTrack",void 0),it(this,"mediaStreamTrack",void 0),it(this,"_external",{}),this._ID=n||hn(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){Ct(zm).call(zm,i)||zm.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||ou(()=>{var n;qt.reportApiInvoke(null,{name:li.GET_MEDIA_STREAM_TRACK,options:[],tag:Mn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Ym.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=zm.indexOf(e);n!==-1&&zm.splice(n,1)}(this),this.emit(qm.CLOSED),this.removeAllListeners(rp.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===Ym.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(rp.TRANSCEIVER_UPDATED,e,n)}}class Qm extends RM{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),it(this,"_enabled",!0),it(this,"_muted",!1),it(this,"_isExternalTrack",!1),it(this,"_isClosed",!1),it(this,"_enabledMutex",void 0),it(this,"processor",void 0),it(this,"_processorContext",void 0),it(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Qi("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,b.debug("[".concat(this.getTrackId(),"] close")),this.emit(jt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await un(this,jt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qm.TRACK_ENDED)}stateCheck(e,n){if(b.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),Yl(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new at(k.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",b);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new at(k.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",b)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():At.resolve([])}}const bM=window.AudioContext||window.webkitAudioContext;let zs=null;const tn=new class extends On{constructor(){super(...arguments),it(this,"prevState",void 0),it(this,"curState",void 0),it(this,"currentTime",void 0),it(this,"currentTimeStuckAt",void 0),it(this,"interruptDetectorTrack",void 0),it(this,"onLocalAudioTrackMute",()=>{b.info("ios15-interruption-start"),this.emit(ji.IOS_15_16_INTERRUPTION_START)}),it(this,"onLocalAudioTrackUnmute",async()=>{b.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?b.info("ios15-interruption-end-canceled"):(zs&&await zs.suspend(),this.emit(ji.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){b.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){b.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Zm(){if(!zs){if(function(){if(!bM)return void b.error("your browser is not support web audio");b.info("create audio context");const t=An({},j("WEBAUDIO_INIT_OPTIONS"));b.debug("audio context init option:",JSON.stringify(t)),zs=new bM(t),tn.curState=zs.state,zs.onstatechange=()=>{tn.prevState=tn.curState,tn.curState=zs?zs.state:void 0;const{prevState:e,curState:n}=tn,i=n==="running",r=n==="interrupted",o=e==="running",c=e==="suspended",l=e==="interrupted",h=Fe().osVersion;(br()||ta())&&o&&r&&(b.info("ios".concat(h,"-interruption-start")),tn.emit(ji.IOS_INTERRUPTION_START)),(br()||ta())&&(c||l)&&i&&(b.info("ios".concat(h,"-interruption-end")),tn.emit(ji.IOS_INTERRUPTION_END)),e!==n&&tn.emit(ji.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=zs)===null||e===void 0?void 0:e.currentTime;tn.currentTime!==n?(tn.currentTimeStuckAt&&(b.debug("AudioContext current time resume at ".concat(n)),tn.currentTimeStuckAt=void 0),tn.currentTime=n):(n!==tn.currentTimeStuckAt&&(qt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Mn.TRACER}).onSuccess(),b.warning("AudioContext current time stuck at ".concat(n))),tn.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,o=!1,c=!1;function l(I){e.state==="running"?h(!1):br()||ta()?e.state==="suspended"&&(h(!0),I&&e.resume().then(p,p)):e.state!=="closed"&&(h(!0),I&&e.resume().then(p,p))}function h(I){if(r!==I){r=I;for(let O=0,M=n;O<M.length;O+=1){const U=M[O];I?window.addEventListener(U,m,{capture:!0,passive:!0}):window.removeEventListener(U,m,{capture:!0,passive:!0})}}}function p(){l(!1)}function m(){l(!0)}function S(I){if(!c)if(i.paused)if(I){let O;v(!1),c=!0;try{O=i.play(),O?O.then(y,y):(i.addEventListener("playing",y),i.addEventListener("abort",y),i.addEventListener("error",y))}catch{y()}}else v(!0);else v(!1)}function v(I){if(o!==I){o=I;for(let O=0,M=n;O<M.length;O++){const U=M[O];I?window.addEventListener(U,P,{capture:!0,passive:!0}):window.removeEventListener(U,P,{capture:!0,passive:!0})}}}function y(){i.removeEventListener("playing",y),i.removeEventListener("abort",y),i.removeEventListener("error",y),c=!1,S(!1)}function P(){S(!0)}if(br()){const I=e.createMediaStreamDestination(),O=document.createElement("div");O.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=O.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=I.stream,S(!0)}tn.on(ji.STATE_CHANGE,function(){l(!0)}),l(!1)}(zs)}(),!zs)throw new at(k.NOT_SUPPORTED,"can not create audio context");return zs}return zs}function op(t){if(function(){if(dI!==null)return dI;const i=Zm(),r=i.createBufferSource(),o=i.createGain(),c=i.createGain();r.connect(o),r.connect(c),r.disconnect(o);let l=!1;try{r.disconnect(o)}catch{l=!0}return r.disconnect(),dI=l,l}())return;const e=t.connect,n=t.disconnect;t.connect=(i,r,o)=>{var c;return t._inputNodes||(t._inputNodes=[]),Ct(c=t._inputNodes).call(c,i)||(i instanceof AudioNode?(t._inputNodes.push(i),e.call(t,i,r,o)):e.call(t,i,r)),t},t.disconnect=(i,r,o)=>{n.call(t),i?GR(t._inputNodes,i):t._inputNodes=[];for(const c of t._inputNodes)e.call(t,c)}}let dI=null;function uI(t,e){let n=!1;const i=1/e;if(j("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):t(performance.now()/1e3)},1e3*i)}else{const r=Zm();let o=r.createGain();o.gain.value=0,o.connect(r.destination);const c=()=>{if(n)return void(o=null);const l=r.createOscillator();l.onended=c,l.connect(o),l.start(0),l.stop(r.currentTime+i),t(r.currentTime)};c()}return()=>{n=!0}}class CM{constructor(){it(this,"context",void 0),it(this,"analyserNode",void 0),it(this,"sourceNode",void 0),this.context=Zm(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||br()||ta()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}const n=qi(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{b.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class AM extends On{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),it(this,"outputNode",void 0),it(this,"outputTrack",void 0),it(this,"isPlayed",!1),it(this,"sourceNode",void 0),it(this,"context",void 0),it(this,"audioBufferNode",void 0),it(this,"destNode",void 0),it(this,"audioOutputLevel",0),it(this,"volumeLevelAnalyser",void 0),it(this,"_processedNode",void 0),it(this,"playNode",void 0),it(this,"isDestroyed",!1),it(this,"onNoAudioInput",void 0),it(this,"isNoAudioInput",!1),it(this,"_noAudioInputCount",0),this.context=Zm(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),op(this.outputNode),this.volumeLevelAnalyser=new CM}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Ws.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const o=i.outputBuffer.getChannelData(r);for(let c=0;c<o.length;c+=1)o[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ge().webAudioMediaStreamDest)throw new at(k.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&HR(()=>{tn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;br()||ta()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let o=0;o<i.length;o++)i[o]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await Vi(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class wM extends AM{get isFreeze(){return!1}constructor(e,n,i){var r;if(super(),it(this,"sourceNode",void 0),it(this,"track",void 0),it(this,"clonedTrack",void 0),it(this,"audioElement",void 0),it(this,"isCurrentTrackCloned",!1),it(this,"isRemoteTrack",!1),it(this,"originVolumeLevelAnalyser",void 0),it(this,"rebuildWebAudio",async()=>{if(b.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void b.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>b.info("resume success")),b.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),op(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),op(this.outputNode),this.emit(Ws.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new at(k.UNEXPECTED_ERROR);this.track=e;const o=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(o),op(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,b.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const h=this.context.createMediaStreamSource(new MediaStream([l]));op(h),this.originVolumeLevelAnalyser=new CM,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=o;const c=Fe();n&&c.os===Ri.IOS&&Number((r=c.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(tn.on(ji.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),op(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Ws.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),tn.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),b.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));op(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function IM(t,e,n){const i=(o,c)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||c:o:c,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function oz(t,e){const n=await OM(t.mediaSource),{sourceId:i,audio:r}=await function(o){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new At((l,h)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const S=document.createElement("div");S.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",S.setAttribute("style","height: 12%;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const P=document.createElement("button");P.innerHTML="cancel",P.setAttribute("style","width: 85px;"),P.onclick=()=>{document.body.removeChild(M);const U=new Error("NotAllowedError");U.name="NotAllowedError",h(U)};let I=c;const O=document.createElement("div");if(c){const U=document.createElement("input");U.setAttribute("type","checkbox");const W=document.createElement("span");U.setAttribute("style","margin-right: 6px;"),W.innerText="Share audio",U.checked=I,U.onchange=()=>{I=U.checked},O.appendChild(U),O.appendChild(W)}y.appendChild(O),y.appendChild(P),m.appendChild(S),m.appendChild(v),m.appendChild(y);const M=document.createElement("div");M.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),M.appendChild(p),M.appendChild(m),document.body.appendChild(M),o.map(U=>{if(U.id){const W=document.createElement("div");W.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let $=U.thumbnail;try{const{width:Q}=$.getSize();Q>1920&&($=$.resize({width:1920}))}catch(Q){throw Q&&Q.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Q}W.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+$.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+U.name.replace(/[\u00A0-\u9999<>\&]/g,function(Q){return"&#"+Q.charCodeAt(0)+";"})+"</span>",W.onclick=()=>{document.body.removeChild(M),l({sourceId:U.id,audio:I})},v.appendChild(W)}})})}(n,e);return await IM(i,t,r)}async function OM(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=H1();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new at(k.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new At((o,c)=>{n.desktopCapturer.getSources({types:e},(l,h)=>{l?c(l):o(h)})}));try{return await i}catch(o){throw new at(k.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}const hI=new Qi("safari");let NM=!1,DM=!1;async function Ys(t,e){let n=0,i=null;for(;n<2;)try{i=await az(t,e,n>0);break}catch(r){if(r instanceof at)throw b.error("[".concat(e,"] ").concat(r.toString())),r;const o=tb(r.name||r.code||r,r.message);if(o.code===k.MEDIA_OPTION_INVALID){b.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await Vi(500);continue}throw b.error("[".concat(e,"] ").concat(o.toString())),o}if(!i)throw new at(k.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function az(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new at(k.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=Ge(),r=new MediaStream;if(t.audioSource&&r.addTrack(t.audioSource),t.videoSource&&r.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return b.debug("Using Video Source/ Audio Source"),r;if(t.screen)if(H1())t.screen.sourceId?$m(r,await IM(t.screen.sourceId,t.screen,!!t.screenAudio)):$m(r,await oz(t.screen,!!t.screenAudio));else if(Kl()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new at(k.NOT_SUPPORTED,"This browser does not support screen sharing");b.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const v=await(c=t.screen.extensionId,l=e,new At((y,P)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},I=>{if(!I||!I.streamId)return b.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),I),void P(new at(k.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(I.streamId)})}catch(I){b.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),I.toString()),P(new at(k.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=v,$m(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var o;t.screen.mediaSource&&SM(t.screen.mediaSource);const v={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(o=t.screen.displaySurface)!==null&&o!==void 0?o:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:P,systemAudio:I,preferCurrentTab:O}=t.screen,M={selfBrowserSurface:y,surfaceSwitching:P,systemAudio:I,preferCurrentTab:O};!y&&delete M.selfBrowserSurface,!P&&delete M.surfaceSwitching,!I&&delete M.systemAudio,!O&&delete M.preferCurrentTab,b.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:v,audio:t.screenAudio,controls:M})),$m(r,await navigator.mediaDevices.getDisplayMedia(An({video:v,audio:t.screenAudio},M)))}else{if(!Un())throw b.error("[".concat(e,"] This browser does not support screenSharing")),new at(k.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&SM(t.screen.mediaSource);const v={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};b.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(v))),$m(r,await navigator.mediaDevices.getUserMedia(v))}}var c,l;if(!t.video&&!t.audio)return r;let h={video:t.video,audio:t.audio},p=j("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),h=H0(h,p)}catch{}b.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(h)),Fe();let m,S=null;(Gi()||br()||jR())&&(S=await hI.lock());try{m=await navigator.mediaDevices.getUserMedia(h)}catch(v){throw S&&S(),v}return h.audio&&(NM=!0),h.video&&(DM=!0),$m(r,m),S&&S(),r}function tb(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new at(k.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new at(k.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new at(k.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new at(k.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new at(k.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new at(k.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return b.error("getUserMedia unexpected error",t),new at(k.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function $m(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],r=e.getVideoTracks()[0],o=e.getAudioTracks()[0];o&&(i&&t.removeTrack(i),t.addTrack(o)),r&&(n&&t.removeTrack(n),t.addTrack(r))}const qs=new class extends On{get state(){return this._state}set state(t){t!==this._state&&(this.emit(sp.STATE_CHANGE,t),this._state=t)}constructor(){super(),it(this,"_state",aS.IDLE),it(this,"isAccessMicrophonePermission",!1),it(this,"isAccessCameraPermission",!1),it(this,"lastAccessMicrophonePermission",!1),it(this,"lastAccessCameraPermission",!1),it(this,"checkdeviceMatched",!1),it(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(j("ENUMERATE_DEVICES_INTERVAL")||(FR()||BR()===Ri.HARMONY_OS)&&zl())&&this.updateDevicesInfo()},j("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>b.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new at(k.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let o=!this.isAccessMicrophonePermission&&t,c=!this.isAccessCameraPermission&&e;r.audio&&(o=!1),r.video&&(c=!1);let l=null,h=null,p=null;if(!n&&(o||c)){if(hI.isLocked&&(b.debug("[device manager] wait GUM lock"),(await hI.lock())(),b.debug("[device manager] GUM unlock")),NM&&(o=!1,this.isAccessMicrophonePermission=!0),DM&&(c=!1,this.isAccessCameraPermission=!0),b.debug("[device manager] check media device permissions",t,e,o,c),o&&c){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){const S=tb(m.name||m.code||m,m.message);if(S.code===k.PERMISSION_DENIED)throw S;b.warning("getUserMedia failed in getDevices",S)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{l=await navigator.mediaDevices.getUserMedia({audio:t})}catch(m){const S=tb(m.name||m.code||m,m.message);if(S.code===k.PERMISSION_DENIED)throw S;b.warning("getUserMedia failed in getDevices",S)}this.isAccessMicrophonePermission=!0}else if(c){try{h=await navigator.mediaDevices.getUserMedia({video:e})}catch(m){const S=tb(m.name||m.code||m,m.message);if(S.code===k.PERMISSION_DENIED)throw S;b.warning("getUserMedia failed in getDevices",S)}this.isAccessCameraPermission=!0}b.debug("[device manager] mic permission",t,"cam permission",e)}try{const m=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(S=>S.stop()),h&&h.getTracks().forEach(S=>S.stop()),p&&p.getTracks().forEach(S=>S.stop()),l=null,h=null,p=null,m}catch(m){return l&&l.getTracks().forEach(S=>S.stop()),h&&h.getTracks().forEach(S=>S.stop()),p&&p.getTracks().forEach(S=>S.stop()),l=null,h=null,p=null,new at(k.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new at(k.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=aS.INITING;try{await this.updateDevicesInfo(),this.state=aS.INITEND}catch(t){throw b.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=aS.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new at(k.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=t.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),o=t.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");r&&o?o.groupId===r.groupId?b.debug("[device-check] default input ".concat(r.label," and output ").concat(o.label," is the same group")):b.debug("[device-check] default input ".concat(r.label," and output ").concat(o.label," is not the same group")):b.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(r=>{if(!r.deviceId)return;const o=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((o?o.state:"INACTIVE")!=="ACTIVE"){const c={initAt:e,updateAt:e,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),c),n.push(c)}o&&(o.updateAt=e)}),this.deviceInfoMap.forEach((r,o)=>{r.state==="ACTIVE"&&r.updateAt!==e&&(r.state="INACTIVE",n.push(r))}),this.state!==aS.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(sp.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(sp.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(sp.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(r=>r.kind==="audioinput"),n=t.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of e)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let pI=!1;const Xs=new class extends On{constructor(){super(...arguments),it(this,"onAutoplayFailed",void 0),it(this,"onAudioAutoplayFailed",void 0)}};function PM(){if(Fe(),!pI){const t=e=>{e.preventDefault(),pI=!1,Zg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};pI=!0,Zg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),b.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Xs.onAutoplayFailed?Xs.onAutoplayFailed():Xs.onAudioAutoplayFailed?b.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):b.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Xs.emit("autoplay-failed")}}function LM(t,e,n,i){if(!t)return;const r=qt.getBaseInfoBySessionId(t);if(!r)return;const o=r.info,c=Date.now(),l=An(An({},o),{},{vid:o.vid===void 0?0:Number(o.vid),lts:c,elapse:c-r.startTime,cbRegistered:Xs.onAutoplayFailed||Xs.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});qt.send({type:Cn.AUTOPLAY_FAILED,data:l},!0)}const cz=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],jr=new class{constructor(){it(this,"onAutoplayFailed",void 0),it(this,"elementMap",new Map),it(this,"elementStateMap",new Map),it(this,"elementsNeedToResume",[]),it(this,"sinkIdMap",new Map),it(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const r=this.elementStateMap.get(n),o=i.srcObject.getAudioTracks()[0],c=o&&o.readyState;if(b.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(c," ").concat(t)),c==="live"){if(t)return i.pause(),void i.play();if(tn.curState==="running")return jm()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),it(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(b.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),tn.on(ji.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tn.on(ji.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),tn.on(ji.STATE_CHANGE,()=>{br()&&tn.prevState==="suspended"&&tn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(i){throw new at(k.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,fr.INIT),this.setVolume(e,n);const o=this.sinkIdMap.get(e);if(o)try{r.setSinkId(o).catch(l=>{b.warning("[".concat(e,"] set sink id failed"),l.toString())})}catch(l){b.warning("[".concat(e,"] set sink id failed"),l.toString())}const c=r.play();c&&c.then&&c.catch(l=>{i&&LM(i,"audio",l.message,e),b.warning("audio element play warning",l.toString()),this.elementMap.has(e)&&l.name==="NotAllowedError"&&(b.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),HR(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),PM()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){cz.forEach(n=>{e.addEventListener(n,i=>{const r=this.elementStateMap.get(t),o=i.type==="pause"?"paused":i.type;if(b.debug("[".concat(t,"] audio-element-status change ").concat(r," => ").concat(o)),i.type==="error"){const c=e==null?void 0:e.error;c&&b.error("[".concat(t,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(t,o)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{b.debug("Auto resume audio element success")}).catch(n=>{b.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new At(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{Zg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Yn(){return function(t,e,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new at(k.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",b);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];const l=i.apply(this,o);return l instanceof At?new At((h,p)=>{l.then(h).catch(p)}):l}),n}}class kM extends On{constructor(e){super(),it(this,"name","VideoProcessorDestination"),it(this,"ID","0"),it(this,"_source",void 0),it(this,"videoContext",void 0),it(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new at(k.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new at(k.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Cr.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Cr.ON_TRACK,void 0)}}class MM extends On{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),it(this,"constraintsMap",new Map),it(this,"statsRegistry",[]),it(this,"usageRegistry",[]),it(this,"trackId",void 0),it(this,"direction",void 0),it(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await Wi(this,Ks.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var i;return b.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),un(this,Ks.REQUEST_UPDATE_CONSTRAINTS,Array.from(hr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return b.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),un(this,Ks.REQUEST_UPDATE_CONSTRAINTS,Array.from(hr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:o}of this.statsRegistry)try{const c=o();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){b.error(new at(k.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof At&&(i=await i),e.push(An(An({},i),{},{direction:this.direction}))}catch(i){b.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class xM extends On{constructor(e){super(),it(this,"name","AudioProcessorDestination"),it(this,"ID","0"),it(this,"inputTrack",void 0),it(this,"inputNode",void 0),it(this,"audioProcessorContext",void 0),it(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new at(k.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new at(k.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Cr.ON_TRACK,void 0),this.emit(Cr.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Cr.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Cr.ON_NODE,this.inputNode))}}class UM extends On{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,i){super(),it(this,"constraintsMap",new Map),it(this,"statsRegistry",[]),it(this,"audioContext",void 0),it(this,"trackId",void 0),it(this,"direction",void 0),it(this,"usageRegistry",[]),it(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=i}async getConstraints(){return Wi(this,Ks.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var i;return b.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),un(this,Ks.REQUEST_UPDATE_CONSTRAINTS,Array.from(hr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),un(this,Ks.REQUEST_UPDATE_CONSTRAINTS,Array.from(hr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:o}of this.statsRegistry)try{const c=o();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){b.error(new at(k.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof At&&(i=await i),e.push(An(An({},i),{},{direction:this.direction}))}catch(i){b.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class fI extends On{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),it(this,"context",void 0),it(this,"processSourceNode",void 0),it(this,"outputTrack",void 0),it(this,"processedNode",void 0),it(this,"clonedTrack",void 0),it(this,"outputNode",void 0),this.outputNode=new lz}setVolume(){}createOutputTrack(){throw new at(k.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class lz{disconnect(){}connect(){}}function VM(t){return new At((e,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const o=br()?"canplay":"playing";r.addEventListener(o,()=>{const c=r.videoWidth,l=r.videoHeight;!c&&Un()||(i=!0,r.srcObject=null,r.remove(),e([c,l]))}),r.srcObject=new MediaStream([t]),r.play().catch(WR),setTimeout(()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))},4e3)})}function eb(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=zc(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!V1()&&n.frameRate&&(e.frameRate=n.frameRate),N1()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),Un()&&(e.frameRate={ideal:30,max:30}),e}function BM(t){const e={};return V1()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,Kl()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function jM(t){const e=BM(t);if(t.encoderConfig){const n=ZR(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),FR()&&(e.sampleRate=void 0),e}const dz=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:i,height:r}=t.getMediaStreamTrackSettings();let{frameRate:o=n,width:c=i,height:l=r}=e;if(!o||!c||!l)return;c=W0(c),l=W0(l),o=W0(o);const{max:h,min:p}=function(y,P,I){const O=200*Math.pow(I/15,.6)*Math.pow(y*P/640/360,.75);return{min:Math.floor(O),max:Math.floor(4*O)}}(c,l,o),{bitrateMax:m,bitrateMin:S}=e||{};m||b.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(o,"] => [brMax: ").concat(m,", brMin: ").concat(S,"]"));const{maxFramerate:v}=j("ENCODER_CONFIG_LIMIT");return v&&typeof v=="number"&&(o=Math.min(o,v)),{frameRate:o,bitrateMax:m||h,bitrateMin:S||p,scaleResolutionDownBy:1,scale:0}},FM=async(t,e,n)=>await(async(i,r,o)=>{const c=function(p){const m=[];for(let S=0;S<p.length;S+=2)m.push(parseInt(p.slice(S,S+2),16));return Uint8Array.from(m)}(tM(""+r+o)).slice(0,16),l=c.slice(0,12),h=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},h,i))})(t.buffer,e,n),mI=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new At((n,i)=>{e.toBlob(async r=>{if(e.remove(),r){const o=await GM(r);n({buffer:o,width:e.width,height:e.height})}else i(new at(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},GM=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var HM,WM,KM,zM,YM,qM,XM,JM,QM,ZM,$M,tx,ex,nx,ix,rx,sx,ox,Dn,ax,cx,lx,dx,ux,hx,qc,px,fx,mx,Ex,_x,gx,Sx,Tx,vx,yx,Rx,bx,Cx,zi;let Bn=(HM=ie({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),WM=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),KM=Yn(),zM=Hm("LocalAudioTrack","_enabledMutex"),YM=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),qM=Yn(),XM=Hm("LocalAudioTrack","_enabledMutex"),JM=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),QM=Yn(),ZM=Yn(),$M=Yn(),tx=ie({argsMap:t=>[t.getTrackId()]}),ex=Yn(),nx=ie({argsMap:t=>[t.getTrackId()]}),ix=Yn(),rx=ie({argsMap:t=>[t.getTrackId()]}),sx=ie({argsMap:(t,e)=>[t.getTrackId(),e.name]}),ox=ie({argsMap:t=>[t.getTrackId()]}),Be((Dn=class extends Qm{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?jr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i){super(t,n),it(this,"trackMediaType",Jm.AUDIO),it(this,"_encoderConfig",void 0),it(this,"_trackSource",void 0),it(this,"metadata",[]),it(this,"_enabled",!0),it(this,"_volume",100),it(this,"_useAudioElement",!0),it(this,"_bypassWebAudio",!1),it(this,"processor",void 0),it(this,"_processorContext",void 0),it(this,"_processorDestination",void 0),it(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new fI,j("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),j("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Gi()&&!zs?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){nn(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&jr.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void b.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,un(this,jt.NEED_REPLACE_TRACK,this).then(()=>{b.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{b.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!_M())throw new at(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");await jr.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await un(this,jt.NEED_ENABLE_TRACK,this),b.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(i){throw n||(this._enabled=!1),b.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await un(this,jt.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,b.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await un(this,jt.NEED_MUTE_TRACK,this):await un(this,jt.NEED_UNMUTE_TRACK,this))}getStats(){return ou(()=>{b.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Fs(this,jt.GET_STATS)||An({},aI)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Ws.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Ws.ON_AUDIO_BUFFER),this._source.on(Ws.ON_AUDIO_BUFFER,n=>t(n))}play(){b.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(b.debug("[".concat(this.getTrackId(),"] start audio playback in element")),jr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){b.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?jr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];b.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&jr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await un(this,jt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return At.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new at(k.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new at(k.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(Cr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await un(this,jt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await un(this,jt.NEED_REPLACE_TRACK,this))}),t.on(Cr.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Cr.ON_TRACK),t.removeAllListeners(Cr.ON_NODE)}bindProcessorContextEvents(t){t.on(Ks.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Ks.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof fI&&(this._trackSource=new wM(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new UM(this._source.context,this.getTrackId(),"local"),e=new xM(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(Ws.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(jr.stop(this.getTrackId()),this._source.play()),un(this,jt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{b.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{b.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[HM],Object.getOwnPropertyDescriptor(Dn.prototype,"setVolume"),Dn.prototype),Be(Dn.prototype,"setPlaybackDevice",[WM,KM],Object.getOwnPropertyDescriptor(Dn.prototype,"setPlaybackDevice"),Dn.prototype),Be(Dn.prototype,"setEnabled",[zM,YM,qM],Object.getOwnPropertyDescriptor(Dn.prototype,"setEnabled"),Dn.prototype),Be(Dn.prototype,"setMuted",[XM,JM,QM],Object.getOwnPropertyDescriptor(Dn.prototype,"setMuted"),Dn.prototype),Be(Dn.prototype,"getStats",[ZM],Object.getOwnPropertyDescriptor(Dn.prototype,"getStats"),Dn.prototype),Be(Dn.prototype,"setAudioFrameCallback",[$M],Object.getOwnPropertyDescriptor(Dn.prototype,"setAudioFrameCallback"),Dn.prototype),Be(Dn.prototype,"play",[tx,ex],Object.getOwnPropertyDescriptor(Dn.prototype,"play"),Dn.prototype),Be(Dn.prototype,"stop",[nx,ix],Object.getOwnPropertyDescriptor(Dn.prototype,"stop"),Dn.prototype),Be(Dn.prototype,"close",[rx],Object.getOwnPropertyDescriptor(Dn.prototype,"close"),Dn.prototype),Be(Dn.prototype,"pipe",[sx],Object.getOwnPropertyDescriptor(Dn.prototype,"pipe"),Dn.prototype),Be(Dn.prototype,"unpipe",[ox],Object.getOwnPropertyDescriptor(Dn.prototype,"unpipe"),Dn.prototype),Dn),nb=(ax=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),cx=Yn(),lx=Hm("MicrophoneAudioTrack","_enabledMutex"),dx=ie({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),ux=Yn(),hx=ie({argsMap:t=>[t.getTrackId()]}),Be((qc=class extends Bn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?ZR(e.encoderConfig):{},i,j("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),it(this,"_config",void 0),it(this,"_deviceName","default"),it(this,"_constraints",void 0),it(this,"_originalConstraints",void 0),it(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(jm()||x0())&&tn.bindInterruptDetectorTrack(this)}async setDevice(t){if(b.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await qs.getDeviceById(t),n={};n.audio=An({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await Ys(n,this.getTrackId())}catch(r){throw b.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await Ys({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await qs.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}b.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return b.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),t),j("AUTO_RESET_AUDIO_ROUTE")&&(br()||ta())){const c=navigator.audioSession;c&&(t||(c.type="playback"),c.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await un(this,jt.NEED_DISABLE_TRACK,this)}catch(c){throw b.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=An({},this._constraints),o=qs.searchDeviceIdByName(this._deviceName);o&&!r.deviceId&&(r.deviceId=o);try{n||(this._enabled=!0);const c=await Ys({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await un(this,jt.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),b.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}b.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(jm()||x0())&&tn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((br()||ta())&&this._enabled&&!this._isClosed&&tn.duringInterruption){const t=async()=>{tn.off(ji.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};tn.on(ji.IOS_INTERRUPTION_END,t)}else b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qm.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=qs.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const i=await Ys({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Ks.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Ks.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[ax,cx],Object.getOwnPropertyDescriptor(qc.prototype,"setDevice"),qc.prototype),Be(qc.prototype,"setEnabled",[lx,dx,ux],Object.getOwnPropertyDescriptor(qc.prototype,"setEnabled"),qc.prototype),Be(qc.prototype,"close",[hx],Object.getOwnPropertyDescriptor(qc.prototype,"close"),qc.prototype),qc),uz=(px=ie({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),fx=Yn(),mx=ie({argsMap:t=>[t.getTrackId()]}),Ex=Yn(),_x=ie({argsMap:t=>[t.getTrackId()]}),gx=Yn(),Sx=ie({argsMap:t=>[t.getTrackId()]}),Tx=Yn(),vx=ie({argsMap:t=>[t.getTrackId()]}),yx=Yn(),Rx=ie({argsMap:t=>[t.getTrackId()]}),bx=ie({argsMap:t=>[t.getTrackId()]}),Cx=Yn(),Be((zi=class extends Bn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),it(this,"source",void 0),it(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(Ws.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(qm.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){nn(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[px,fx],Object.getOwnPropertyDescriptor(zi.prototype,"startProcessAudioBuffer"),zi.prototype),Be(zi.prototype,"pauseProcessAudioBuffer",[mx,Ex],Object.getOwnPropertyDescriptor(zi.prototype,"pauseProcessAudioBuffer"),zi.prototype),Be(zi.prototype,"seekAudioBuffer",[_x,gx],Object.getOwnPropertyDescriptor(zi.prototype,"seekAudioBuffer"),zi.prototype),Be(zi.prototype,"resumeProcessAudioBuffer",[Sx,Tx],Object.getOwnPropertyDescriptor(zi.prototype,"resumeProcessAudioBuffer"),zi.prototype),Be(zi.prototype,"stopProcessAudioBuffer",[vx,yx],Object.getOwnPropertyDescriptor(zi.prototype,"stopProcessAudioBuffer"),zi.prototype),Be(zi.prototype,"close",[Rx],Object.getOwnPropertyDescriptor(zi.prototype,"close"),zi.prototype),Be(zi.prototype,"setAudioBufferPlaybackSpeed",[bx,Cx],Object.getOwnPropertyDescriptor(zi.prototype,"setAudioBufferPlaybackSpeed"),zi.prototype),zi);class mi extends Bn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Zm().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,hn(8,"track-mix-")),it(this,"trackList",void 0),it(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(b.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):b.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){b.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}GR(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof mi?n.emit(rp.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class hz extends AM{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(Ws.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),it(this,"audioBuffer",void 0),it(this,"sourceNode",void 0),it(this,"startPlayTime",0),it(this,"startPlayOffset",0),it(this,"pausePlayTime",0),it(this,"options",void 0),it(this,"currentLoopCount",0),it(this,"currentPlaybackSpeed",100),it(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):b.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Ax=new Map;class EI{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(b.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){it(this,"trackId",void 0),it(this,"config",void 0),it(this,"onFirstVideoFrameDecoded",void 0),it(this,"onVideoStateChanged",void 0),it(this,"freezeTimeCounterList",[]),it(this,"renderFreezeAccTime",0),it(this,"isKeepLastFrame",!1),it(this,"timeUpdatedCount",0),it(this,"freezeTime",0),it(this,"playbackTime",0),it(this,"lastTimeUpdatedTime",0),it(this,"autoplayFailed",!1),it(this,"videoTrack",void 0),it(this,"videoElement",void 0),it(this,"cacheVideoElement",void 0),it(this,"renderStats",void 0),it(this,"_videoState",Yc.VideoStateStopped),it(this,"videoElementCheckInterval",void 0),it(this,"videoElementFreezeTimeout",void 0),it(this,"_videoElementStatus",fr.NONE),it(this,"isGettingVideoDimensions",!1),it(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return b.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),it(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&tn.curState==="running"&&(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(O1())),x1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),it(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=fr.PLAYING;break;case"loadeddata":if(this.videoState=Yc.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=fr.CANPLAY;break;case"stalled":this.videoElementStatus=fr.STALLED;break;case"suspend":this.videoElementStatus=fr.SUSPEND;break;case"pause":this.videoElementStatus=fr.PAUSED,br()||ta()||Gi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=fr.WAITING;break;case"abort":this.videoElementStatus=fr.ABORT;break;case"ended":this.videoElementStatus=fr.ENDED;break;case"emptied":this.videoElementStatus=fr.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=fr.ERROR,b.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,o=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Xl.lastVisibleTime<Xl.lastHiddenTime||o<Xl.lastHiddenTime||o<Xl.lastVisibleTime)return;for(r>j("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),it(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(O1())),x1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),tn.on(ji.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tn.on(ji.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{e&&LM(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(b.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):b.warning("[".concat(this.trackId,"] play warning: "),r)});const i=Fe();if((i.name==="Safari"&&Number(i.version)===15||jm())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return b.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new At((o,c)=>{i.toBlob(async l=>{if(i.remove(),l){const h=await GM(l);o({buffer:h,width:i.width,height:i.height})}else c(new at(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await mI(e)}destroy(){this.renderStats=void 0,tn.off(ji.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tn.off(ji.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Yc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=fr.INIT,!this.videoElementCheckInterval&&(wx.forEach(o=>{this.videoElement.addEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(o){return o!==document.body&&document.body.contains(o)})(this.videoElement)||(this.videoElementStatus=fr.DESTROYED)},1e3),j("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let o;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,j("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Yc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Yc.VideoStateFrozen:document.addEventListener("visibilitychange",c))},h=(p,m)=>{if(this.videoElementStatus===fr.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=m.mediaTime):this.renderStats={lastTs:m.mediaTime,curTs:m.mediaTime,lastRenderNum:0,renderNum:0},o){const y=m.presentationTime-o.presentationTime;this.videoState===Yc.VideoStateStarting&&(this.videoState=Yc.VideoStateDecoding),this.videoState===Yc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,j("VIDEO_FREEZE_DURATION"))),y<j("VIDEO_FREEZE_DURATION")&&this.videoState===Yc.VideoStateFrozen&&(this.videoState=Yc.VideoStateDecoding),y>j("VIDEO_FREEZE_DURATION")&&Xl.lastVisibleTime>=Xl.lastHiddenTime&&o.timestamp>Xl.lastVisibleTime&&o.timestamp>Xl.lastHiddenTime&&(this.renderFreezeAccTime+=y)}o=An(An({},m),{},{timestamp:p})}var S,v;j("ENABLE_VIDEO_FRAME_CALLBACK")&&((S=(v=this.videoElement).requestVideoFrameCallback)===null||S===void 0||S.call(v,h))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),FR()&&!j("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=Fe();i.name==="Safari"&&Number(i.version)===15||jm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Un()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Un()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(o=>{b.debug("[".concat(this.trackId,"] playback interrupted"),o.toString())})}resetVideoElement(){wx.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=fr.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{b.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{b.error(i)}),this.autoplayFailed=!1,Zg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Zg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),PM()}}const wx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Ix extends EI{constructor(e){super(e),it(this,"container",void 0),it(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await mI(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",j("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Ox,Nx,Dx,Px,Lx,kx,Mx,xx,Ux,Vx,Bx,jx,Fx,Gx,Hx,Wx,Kx,zx,Yx,qx,Xx,Jx,Qx,Zx,ke,$x,tU,eU,nU,iU,rU,sU,oU,Js;let vn=(Ox=ie({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Nx=Yn(),Dx=ie({argsMap:t=>[t.getTrackId()]}),Px=Hm("LocalVideoTrack","_enabledMutex"),Lx=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),kx=Yn(),Mx=Hm("LocalVideoTrack","_enabledMutex"),xx=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),Ux=Yn(),Vx=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),Bx=Yn(),jx=Yn(),Fx=ie({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),Gx=Yn(),Hx=Yn(),Wx=Yn(),Kx=Yn(),zx=Yn(),Yx=Yn(),qx=Yn(),Xx=ie({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Jx=ie({argsMap:t=>[t.getTrackId()]}),Qx=ie({argsMap:t=>[t.getTrackId()]}),Zx=ie({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),ke=class _3 extends Qm{get videoHeight(){if(Gi()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(Gi()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==fr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,i,r,o,c){if(super(e,o),it(this,"trackMediaType",Jm.VIDEO),it(this,"_player",void 0),it(this,"isUseScaleResolutionDownBy",!1),it(this,"_videoVisibleTimer",null),it(this,"_previousVideoVisibleStatus",void 0),it(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),it(this,"_encoderConfig",void 0),it(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),it(this,"_optimizationMode",void 0),it(this,"_videoHeight",void 0),it(this,"_videoWidth",void 0),it(this,"_forceBitrateLimit",void 0),it(this,"_enabled",!0),it(this,"_processorDestination",void 0),it(this,"_processorContext",void 0),Gi()){const{width:l,height:h}=e.getSettings();this._videoWidth=l,this._videoHeight=h}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=i,this._optimizationMode=r,this._hints=c||[],this._hints.indexOf(pn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(L0(Ye.CHROME,115)&&BR().indexOf("Windows")!==-1){const l=function(h,p){if("VideoFrame"in window&&"TransformStream"in window&&Ge().supportWebRTCInsertableStream){const m=new MediaStreamTrackProcessor(h),S=new MediaStreamTrackGenerator({kind:"video"});let v,y,P=Date.now();const I=()=>{O&&(clearInterval(O),O=void 0),v&&(v.close(),v=void 0),h.stop(),y=void 0,S.removeEventListener("ended",I)};let O=window.setInterval(()=>{if(y&&v&&Date.now()-P>1e3)try{S.readyState==="live"?y.enqueue(v.clone()):I()}catch{I()}},1e3);const M=new TransformStream({transform:(U,W)=>{S.readyState==="live"?(y=W,P=Date.now(),v===void 0?(v=U,W.enqueue(U.clone())):(W.enqueue(v),v=U)):U.close()}});return S.addEventListener("ended",I),m.readable.pipeThrough(M).pipeTo(S.writable),S}}(e);l&&(b.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(pn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new MM(this.getTrackId(),"local"),this._processorDestination=new kM(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(b.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}b.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=An(An(An({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new EI(i):this._player=new Ix(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(qm.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,b.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await un(this,jt.NEED_DISABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void b.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await un(this,jt.NEED_ENABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,b.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await un(this,jt.NEED_MUTE_TRACK,this):await un(this,jt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new at(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=zc(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=eb({encoderConfig:e});(Gi()||br()||ta())&&(i.deviceId=void 0),b.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const o=new at(k.UNEXPECTED_ERROR,r.toString());throw b.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}}this._encoderConfig=e,this._hints.indexOf(pn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await un(this,jt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(b)}}getStats(){return ou(()=>{b.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Fs(this,jt.GET_STATS)||An({},cI)}async setBeautyEffect(e){b.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await mI(e)}async setBitrateLimit(e){b.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void b.error(k.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await un(this,jt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,b.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return b.error(k.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,b.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){VM(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(WR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new at(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");b.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=zc(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(pn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await un(this,jt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(b)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!n||!i)return;const{bitrateMax:r,bitrateMin:o}=this._encoderConfig;if(o==null||r==null){const{max:c,min:l}=function(h,p,m,S,v){const y=j("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:S,max:v};if(v===void 0){var P;const O=Math.floor(200*Math.pow(m/15,.6)*Math.pow(h*p/640/360,.75));v=y==="STANDARD_BITRATE"?4*O:2*O,S=(P=S)!==null&&P!==void 0?P:O}else{var I;S=(I=S)!==null&&I!==void 0?I:Math.floor(v/10)}return{min:S,max:v}}(e,n,i,o,r);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,b.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:o,slot:c}=r;if(this.isPlaying&&o instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=F1.checkOneElementVisible(o),h=Object.assign({},l);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const p=qt.reportApiInvoke(null,{tag:Mn.TRACER,name:li.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new at(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new at(k.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=An(An({},i),zc(e))),i=tp(i);const r=hn(8,"track-video-cloned-"),o=new _3(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,tp(this._scalabilityMode),this._optimizationMode,r,tp(this._hints));return e&&i&&o.setEncoderConfiguration(i),b.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),o}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new at(k.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new at(k.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(ou(()=>{qt.reportApiInvoke(null,{name:li.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Mn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!j("ENABLE_VIDEO_SEI")||!j("ENABLE_ENCODED_TRANSFORM"))return void b.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new at(k.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void b.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"?this.safeEmit("sei-to-send",e):b.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(Cr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await un(this,jt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await un(this,jt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Cr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ks.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ks.REQUEST_CONSTRAINTS)}},Be(ke.prototype,"play",[Ox,Nx],Object.getOwnPropertyDescriptor(ke.prototype,"play"),ke.prototype),Be(ke.prototype,"stop",[Dx],Object.getOwnPropertyDescriptor(ke.prototype,"stop"),ke.prototype),Be(ke.prototype,"setEnabled",[Px,Lx,kx],Object.getOwnPropertyDescriptor(ke.prototype,"setEnabled"),ke.prototype),Be(ke.prototype,"setMuted",[Mx,xx,Ux],Object.getOwnPropertyDescriptor(ke.prototype,"setMuted"),ke.prototype),Be(ke.prototype,"setEncoderConfiguration",[Vx,Bx],Object.getOwnPropertyDescriptor(ke.prototype,"setEncoderConfiguration"),ke.prototype),Be(ke.prototype,"getStats",[jx],Object.getOwnPropertyDescriptor(ke.prototype,"getStats"),ke.prototype),Be(ke.prototype,"setBeautyEffect",[Fx,Gx],Object.getOwnPropertyDescriptor(ke.prototype,"setBeautyEffect"),ke.prototype),Be(ke.prototype,"getCurrentFrameData",[Hx],Object.getOwnPropertyDescriptor(ke.prototype,"getCurrentFrameData"),ke.prototype),Be(ke.prototype,"getCurrentFrameImage",[Wx],Object.getOwnPropertyDescriptor(ke.prototype,"getCurrentFrameImage"),ke.prototype),Be(ke.prototype,"setBitrateLimit",[Kx],Object.getOwnPropertyDescriptor(ke.prototype,"setBitrateLimit"),ke.prototype),Be(ke.prototype,"setOptimizationMode",[zx],Object.getOwnPropertyDescriptor(ke.prototype,"setOptimizationMode"),ke.prototype),Be(ke.prototype,"setScalabiltyMode",[Yx],Object.getOwnPropertyDescriptor(ke.prototype,"setScalabiltyMode"),ke.prototype),Be(ke.prototype,"updateMediaStreamTrackResolution",[qx],Object.getOwnPropertyDescriptor(ke.prototype,"updateMediaStreamTrackResolution"),ke.prototype),Be(ke.prototype,"pipe",[Xx],Object.getOwnPropertyDescriptor(ke.prototype,"pipe"),ke.prototype),Be(ke.prototype,"unpipe",[Jx],Object.getOwnPropertyDescriptor(ke.prototype,"unpipe"),ke.prototype),Be(ke.prototype,"close",[Qx],Object.getOwnPropertyDescriptor(ke.prototype,"close"),ke.prototype),Be(ke.prototype,"replaceTrack",[Zx],Object.getOwnPropertyDescriptor(ke.prototype,"replaceTrack"),ke.prototype),ke),_I=($x=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),tU=Yn(),eU=Hm("CameraVideoTrack","_enabledMutex"),nU=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),iU=Yn(),rU=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),sU=Yn(),oU=ie({argsMap:t=>[t.getTrackId()]}),Js=class g3 extends vn{get __className__(){return"CameraVideoTrack"}constructor(e,n,i,r,o,c){super(e,zc(n.encoderConfig),r,o,c),it(this,"_config",void 0),it(this,"_originalConstraints",void 0),it(this,"_constraints",void 0),it(this,"_enabled",!0),it(this,"_deviceName","default"),it(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(jm()||x0())&&!function(){const l=Fe();if(l.os!==Ri.IOS||!l.osVersion)return!1;const h=l.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2}()&&U1()&&this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=zc(this._config.encoderConfig),tn.on(ji.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tn.on(ji.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(b.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await qs.getDeviceById(e),i={};i.video=An({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await Ys(i,this.getTrackId())}catch(o){throw b.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),r=await Ys({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await qs.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}b.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){b.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:An(An({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Ys(n,this.getTrackId())}catch(r){throw b.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await Ys({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=An({},n.video),b.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Ys({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await un(this,jt.NEED_ENABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),b.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await un(this,jt.NEED_DISABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new at(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=zc(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const i=Vn(this._config);i.encoderConfig=e;const r=eb(i);(Gi()||br()||ta())&&(r.deviceId=void 0),b.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(o){const c=new at(k.UNEXPECTED_ERROR,o.toString());throw b.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(pn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await un(this,jt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(b)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((br()||ta())&&this._enabled&&!this._isClosed&&tn.duringInterruption){const e=async()=>{tn.off(ji.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};tn.on(ji.IOS_INTERRUPTION_END,e)}else b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qm.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=qs.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await Ys({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),tn.off(ji.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tn.off(ji.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=An(An({},i),zc(e))),i=tp(i);const r=hn(8,"track-cam-cloned-"),o=new g3(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,tp(An(An({},this._config),{},{encoderConfig:i})),tp(this._constraints),tp(this._scalabilityMode),this._optimizationMode,r);return e&&i&&o.setEncoderConfiguration(i),b.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),o}bindProcessorContextEvents(){this.processorContext.on(Ks.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on(Ks.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},Be(Js.prototype,"setDevice",[$x,tU],Object.getOwnPropertyDescriptor(Js.prototype,"setDevice"),Js.prototype),Be(Js.prototype,"setEnabled",[eU,nU,iU],Object.getOwnPropertyDescriptor(Js.prototype,"setEnabled"),Js.prototype),Be(Js.prototype,"setEncoderConfiguration",[rU,sU],Object.getOwnPropertyDescriptor(Js.prototype,"setEncoderConfiguration"),Js.prototype),Be(Js.prototype,"close",[oU],Object.getOwnPropertyDescriptor(Js.prototype,"close"),Js.prototype),Js);function gI(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=An(An({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?b.debug("[".concat(t,"] set content hint to"),n.optimizationMode):b.debug("[".concat(t,"] set content hint failed")))):b.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var aU,cU,lU,dU,mo,uU,hU,pU,fU,mU,EU,mr;class _U extends RM{getUserId(){return this._userId}constructor(e,n,i,r){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(hn(5,""))),it(this,"_userId",void 0),it(this,"_uintId",void 0),it(this,"_isDestroyed",!1),it(this,"store",void 0),it(this,"processor",void 0),it(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,b.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let tE=(aU=ie({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),cU=ie({argsMap:t=>[t.getTrackId()]}),lU=ie({argsMap:(t,e)=>[t.getTrackId(),e.name]}),dU=ie({argsMap:t=>[t.getTrackId()]}),Be((mo=class extends _U{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==fr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i){super(t,e,n,i),it(this,"_videoVisibleTimer",null),it(this,"_previousVideoVisibleStatus",void 0),it(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),it(this,"trackMediaType",Jm.VIDEO),it(this,"_videoWidth",void 0),it(this,"_videoHeight",void 0),it(this,"_player",void 0),it(this,"processorDestination",void 0),it(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new MM(this.getTrackId(),"remote"),this.processorDestination=new kM(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return ou(()=>{b.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Fs(this,jt.GET_STATS)||An({},vM)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(b.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}b.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=An(An({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new EI(n):this._player=new Ix(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Xm.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(Xm.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Xm.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,b.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){VM(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(WR)}_updatePlayerSource(){b.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:o}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=F1.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const h=qt.reportApiInvoke(null,{tag:Mn.TRACER,name:li.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new at(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new at(k.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Cr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Cr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(rp.SEI_RECEIVED,t)}}).prototype,"play",[aU],Object.getOwnPropertyDescriptor(mo.prototype,"play"),mo.prototype),Be(mo.prototype,"stop",[cU],Object.getOwnPropertyDescriptor(mo.prototype,"stop"),mo.prototype),Be(mo.prototype,"pipe",[lU],Object.getOwnPropertyDescriptor(mo.prototype,"pipe"),mo.prototype),Be(mo.prototype,"unpipe",[dU],Object.getOwnPropertyDescriptor(mo.prototype,"unpipe"),mo.prototype),mo),eE=(uU=ie({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),hU=ie({argsMap:(t,e)=>[t.getTrackId(),e]}),pU=ie({argsMap:t=>[t.getTrackId()]}),fU=ie({argsMap:t=>[t.getTrackId()]}),mU=ie({argsMap:(t,e)=>[t.getTrackId(),e.name]}),EU=ie({argsMap:t=>[t.getTrackId()]}),Be((mr=class extends _U{get isPlaying(){return this._useAudioElement?jr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),it(this,"trackMediaType",Jm.AUDIO),it(this,"_source",void 0),it(this,"_useAudioElement",!0),it(this,"_volume",100),it(this,"processorContext",void 0),it(this,"processorDestination",void 0),it(this,"_played",!1),it(this,"_bypassWebAudio",!1),j("DISABLE_WEBAUDIO")?(this._source=new fI,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new wM(t,!0),j("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Ws.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Xm.FIRST_FRAME_DECODED)}),this.processorContext=new UM(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new xM(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Ws.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Ws.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Ws.ON_AUDIO_BUFFER),this._source.on(Ws.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?jr.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!_M())throw new at(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");await jr.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ou(()=>{b.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Fs(this,jt.GET_STATS)||An({},TM)}play(){b.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(b.debug("[".concat(this.getTrackId(),"] use audio element to play")),jr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){b.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?jr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];b.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&jr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new at(k.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new at(k.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new at(k.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Cr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Cr.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Cr.ON_TRACK),this.processorDestination.removeAllListeners(Cr.ON_NODE)}}).prototype,"setVolume",[uU],Object.getOwnPropertyDescriptor(mr.prototype,"setVolume"),mr.prototype),Be(mr.prototype,"setPlaybackDevice",[hU],Object.getOwnPropertyDescriptor(mr.prototype,"setPlaybackDevice"),mr.prototype),Be(mr.prototype,"play",[pU],Object.getOwnPropertyDescriptor(mr.prototype,"play"),mr.prototype),Be(mr.prototype,"stop",[fU],Object.getOwnPropertyDescriptor(mr.prototype,"stop"),mr.prototype),Be(mr.prototype,"pipe",[mU],Object.getOwnPropertyDescriptor(mr.prototype,"pipe"),mr.prototype),Be(mr.prototype,"unpipe",[EU],Object.getOwnPropertyDescriptor(mr.prototype,"unpipe"),mr.prototype),mr);const Xl=new class extends On{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),it(this,"_lastHiddenTime",0),it(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),b.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class gU extends On{constructor(e,n){super(),it(this,"trackMediaType",Jm.DATA),it(this,"_version",1),it(this,"_type",3),it(this,"_config",void 0),it(this,"_originDataChannel",void 0),it(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),it(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),it(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return j("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new At((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var r;n(new at(k.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new at(k.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new at(k.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[$R.OPEN,$R.CLOSE,$R.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),e.addEventListener(n,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class pz extends gU{constructor(e){super(e),it(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(j("SHOW_DATASTREAM2_LOG")&&b.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let o=n.data.slice(this._dataStreamPacketHeader.byteLength);o=this._dataStreamPacketHandler.deserialize(o),this.emit($R.MESSAGE,o)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class fz extends gU{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function ib(){const t=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>iR.revokeObjectURL(t),0),new Worker(iR.createObjectURL(t))}var nE=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t}(nE||{});function SU(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==71)return;const i=t.getUint16(1),r=3+i,o=new Uint8Array(t.byteLength-r);o.set(new Uint8Array(t.buffer,r,t.byteLength-r));const c={m:n,tlvLen:i,tlv:[],frame:o};let l=3;for(;l<r;){const h=t.getUint8(l),p=t.getUint16(l+1),m=3;if(h===nE.AUDIO_LEVEL){let S=t.getUint8(l+m);for(let v=1;v<p;v++)S=S<<8|t.getUint8(l+m+v);c.tlv.push({tag:h,length:p,value:e?127^S>>1:127&S})}else if(h===nE.METADATA){const S=new Uint8Array(p);for(let v=0;v<p;v++)S[v]=t.getUint8(l+m+v);c.tlv.push({tag:h,length:p,value:S})}l+=m+p}return c}const rb=new Map;async function mz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ge().supportWebRTCEncodedTransform)return void b.warning("browser not support audio encoded transform");if(rb.has(t)||!t.track)return;const n={track:t.track};if(Kl()){if(!t.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void b.error("create audio-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const h=e.metadata&&e.metadata();h?function(p,m){const{chunk:S,controller:v}=m;S.data=function(y,P,I){const O=I.byteLength,M=O+1+2,U=3+M,W=new ArrayBuffer(y.byteLength+U),$=new DataView(W);$.setUint8(0,71),$.setUint16(1,M),$.setUint8(3,P),$.setUint16(4,O);for(let q=0;q<O;q++)$.setUint8(6+q,I[q]);const Q=new Uint8Array($.buffer);return Q.set(new Uint8Array(y),U),Q.buffer}(S.data,nE.METADATA,p),v.enqueue(S)}(h,{chunk:c,controller:l}):l.enqueue(c)}});r.readable.pipeThrough(o).pipeTo(r.writable)}else if(Gi()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=ib(),o=new MessageChannel;await new At(l=>r.onmessage=h=>{h.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"tx",port:o.port2},[o.port2]);t.transform=c,await new At(l=>r.onmessage=h=>{h.data==="started"&&l(void 0)}),o.port1.onmessage=l=>{var h;l.data.transformed&&t.track&&((h=t.track)===null||h===void 0?void 0:h.id)!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=rb.get(t);if(r){rb.delete(t);try{var o,c;(o=r.controller)===null||o===void 0||o.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){b.warning(l&&l.message)}}}rb.set(t,n),t.track.addEventListener("ended",i)}const sb=127,ap=1e-10,SI=139/13,ob=new Map;function TI(t,e,n){const i="".concat(t,"-").concat(e,"-").concat(n);let r=0;return ob.has(i)?r=ob.get(i):(r=Math.log(function(c,l){const h=c-l;l<h&&(l=h);let p=1;for(let m=c,S=1;m>l;m--,S++)p=p*m/S;return p}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,ob.set(i,r)),r<ap&&(r=ap),r}function TU(t,e,n){const i=e.length,r=t.length/i;let o=!1;for(let c=0,l=0;c<i;c++){let h=0;for(let p=l+r;l<p;l++)t[l]>n&&h++;e[c]!==h&&(e[c]=h,o=!0)}return o}window.cache=ob;let Ez=0;class vU{constructor(e){it(this,"id",void 0),it(this,"immediates",[]),it(this,"lastNonSilence",-1),it(this,"immediateSpeechActivityScore",ap),it(this,"lastLevelChangedTime",Date.now()),it(this,"levels",[]),it(this,"longs",[]),it(this,"longSpeechActivityScore",ap),it(this,"mediums",[]),it(this,"mediumSpeechActivityScore",ap),it(this,"minLevel",0),it(this,"nextMinLevel",0),it(this,"nextMinLevelWindowLength",0),it(this,"energyScore",0),this.id=e||"".concat(Ez++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,i=this.minLevel+SI;let r=!1;for(let o=0;o<e.length;++o){let c=n[o];c<i&&(c=0);const l=Math.floor(c/SI);e[o]!==l&&(e[o]=l,r=!0)}return r}computeLongs(){return TU(this.mediums,this.longs,4)}computeMediums(){return TU(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=TI(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=TI(this.longs[0],10,47),this.longSpeechActivityScore>ap&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=TI(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(g_(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=e;return e<0&&(i=0),e>sb&&(i=sb),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+SI?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>sb&&(n=sb),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class _z{constructor(e){it(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class vI{constructor(e,n,i){it(this,"isDominant",void 0),it(this,"energyRanking",void 0),it(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=i}}class gz extends On{constructor(e){super(),it(this,"dominantId",null),it(this,"lastDecisionTime",0),it(this,"lastLevelChangedTime",0),it(this,"lastLevelIdleTime",0),it(this,"relativeSpeechActivities",[]),it(this,"speakers",new Map),it(this,"enableSilence",!1),it(this,"timeoutToSilenceInterval",0),it(this,"decisionMaker",null),it(this,"loudest",[]),it(this,"numLoudestToTrack",3),it(this,"energyExpireTimeMs",250),it(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const i=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const o=r.levelChanged(n,i);return this.updateLoudestList(r,o,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new vU(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,i){const r=e.id===this.dominantId;if(n<0){let h=0;for(;h<this.loudest.length&&this.loudest[h]!==e;)++h;return new vI(r,h,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new vI(r,0,e.energyScore);const o=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const h=this.loudest[c];if(h.getLastLevelChangedTime()<o&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(h.id!==e.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<e.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new vI(r,l,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new _z(this),this.decisionMaker.execute())}makeDecision(e){let n=null,i=null;const r=this.speakers.size;let o=null;if(r===0)o=null;else if(r===1){var c;const l=hr(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(o=l.id,l.evaluateSpeechActivityScores(e),e-l.lastNonSilence>this.timeoutToSilenceInterval&&(o=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){const m=this.speakers.entries().next();m.value&&(o=m.value[0],l=m.value[1])}else o=l.id;l!=null&&l.evaluateSpeechActivityScores(e);const h=this.relativeSpeechActivities;let p=2;for(const m of this.speakers.entries()){const[S,v]=m;if(v===l)continue;v.evaluateSpeechActivityScores(e);for(let O=0;O<h.length;++O){const M=l==null?ap:l.getSpeechActivityScore(O);h[O]=Math.log(v.getSpeechActivityScore(O)/M)}const y=h[0],P=h[1],I=h[2];y>3&&P>2&&I>0&&P>p&&(p=P,o=S)}this.enableSilence&&l!=null&&o===l.id&&e-l.lastNonSilence>this.timeoutToSilenceInterval&&(o=null)}o==null&&!this.enableSilence||o===this.dominantId||(n=this.dominantId,this.dominantId=o,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=n;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(e){const n=[];for(const r of hr(i=this.speakers).call(i)){var i;const o=e-r.getLastLevelChangedTime();36e5<o&&(this.dominantId==null||r.id!==this.dominantId)?n.push(r.id):300<o&&r.levelTimedOut()}n.forEach(r=>this.speakers.delete(r))}}const iE=new Map;let Ga=null,ab=null,cp=[];const Sz=1e3/15,Ha=new Map,cb=new Map;class Tz{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){it(this,"id",void 0),it(this,"track",void 0),it(this,"score",0),it(this,"active",!0),it(this,"muted",!1),it(this,"timer",0),it(this,"actives",0),it(this,"inactives",0),this.id=e,this.track=n,this.setActive(Ha.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const r=[],o=[];return Array.from(hr(Ha).call(Ha)).forEach(c=>{c.active?r.push(c):o.push(c)}),{actives:r,inactives:o}}();if(n.length>3){let r;n.forEach(o=>{(!r||r.score>o.score)&&(r=o)}),r&&r.setActive(!1)}if(n.length<3&&i.length>0){let r;i.forEach(o=>{(!r||r.score<o.score)&&o.id!==this.id&&(r=o)}),r&&e&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let i;return Array.from(hr(Ha).call(Ha)).forEach(r=>{!r.active||r.id===n||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let i;return Array.from(hr(Ha).call(Ha)).forEach(r=>{r.active||r.id===n||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>Sz&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let lb;function yU(t){const e=Ha.get(t);e&&(Ha.delete(t),e.clearTimer())}const db=new Map,vz=new Map;async function yI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ge().supportWebRTCEncodedTransform)return void b.warning("browser not support audio encoded transform");if(db.has(t))return;const n={track:t.track};if(Kl()){if(!t.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");L0(Ye.CHROME,87,116)||(e.enableTopn=!1);let r=null;try{r=t.createEncodedStreams()}catch(c){return void b.error("create audio-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)),e.enableTopn?function(h,p,m){var S;const v=SU(new DataView(p.data));if(!v)return m.enqueue(p);const y=h.track.id;vz.set(y,h.track);const P=(S=v.tlv.find($=>$.tag===nE.AUDIO_LEVEL))===null||S===void 0?void 0:S.value;let I=0;typeof P=="number"&&(I=127-P);const O=Math.round(Math.pow(10,I/60)-1),{selected:M,speaker:U}=function($,Q){let q=iE.get($);if(q||(q=function(ct){const _t=new vU;return iE.set(ct,_t),Ga||(Ga=new gz(j("TOPN_SILENCE_THRESHOLD")||500),Ga.on("ActiveSpeakerChanged",Dt=>{Dt!=null&&(ab=Dt)})),Ga.addSpeakers([_t]),_t}($)),iE.size<=3)return{selected:!0,speaker:q};if(!Ga)throw new Error("no active speaker detector");return Ga.levelChanged(q.id,Q),cp=Ga.loudest.map(ct=>ct.id),ab&&!Ct(cp).call(cp,ab)&&cp.length>=3&&cp.pop(),{selected:Ct(cp).call(cp,q.id)||q.id===ab,speaker:q}}(h,O),W=function($,Q,q){const ct=Ha.get($)||new Tz($,Q);return ct.score=q,Ha.set($,ct),function(_t){if(cb.set(_t,!0),!lb)return void(lb=Date.now());const Dt=Date.now();Dt-lb>1e3&&(cb.get(_t)?cb.set(_t,!1):(yU(_t),cb.delete(_t)),lb=Dt)}($),ct}(y,h.track,U.energyScore);W.addSample(M),W.active&&(p.data=v.frame.buffer,m.enqueue(p))}(t,c,l):e.enableMetadata?function(h,p,m){const S=SU(new DataView(h.data));if(!S)return p.enqueue(h);const v=S.tlv.find(y=>y.tag===nE.METADATA);v&&m&&v.value instanceof Uint8Array&&m(v.value),h.data=S.frame.buffer,p.enqueue(h)}(c,l,e.onMetadata):l.enqueue(c)}});r.readable.pipeThrough(o).pipeTo(r.writable)}else if(Gi()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=ib(),o=new MessageChannel;await new At(l=>r.onmessage=h=>{h.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"rx",port:o.port2},[o.port2]);t.transform=c,await new At(l=>r.onmessage=h=>{h.data==="started"&&l(void 0)}),o.port1.onmessage=l=>{var h;l.data.transformed&&t.track&&((h=t.track)===null||h===void 0?void 0:h.id)!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}function i(){t.track.removeEventListener("ended",i),function(r){const o=db.get(r);if(o){(function(h){const p=iE.get(h);p&&(iE.delete(h),Ga&&(Ga.removeSpeakers([p]),iE.size===0&&(Ga.destroy(),Ga=null)))})(r),yU(r.track.id),db.delete(r);try{var c,l;(c=o.controller)===null||c===void 0||c.terminate(),(l=o.worker)===null||l===void 0||l.terminate()}catch(h){b.warning(h&&h.message)}}}(t)}db.set(t,n),t.track.addEventListener("ended",i)}function yz(t,e,n){let i=new Uint8Array(t,e,n),r=[],o=0;for(;r.length<n;)o+3<n&&i[o]===0&&i[o+1]===0&&i[o+2]===3&&(i[o+3]===0||i[o+3]===1||i[o+3]===2||i[o+3]===3)?(r.push(i[o],i[o+1],i[o+3]),o+=4):(r.push(i[o]),o++);return new Uint8Array(r)}const ub=new Map;async function Rz(t,e){if(!Ge().supportWebRTCEncodedTransform)return void b.warning("browser not support video encoded transform");if(ub.has(t)||!t.track)return;const n={track:t.track};if(Kl()){if(!t.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(l){return void b.error("create video-encoded-streams error",l&&l.message)}const o=[];e.on("sei-to-send",l=>{o.push(l)});const c=new TransformStream({transform(l,h){n.controller||(n.controller=h),t.track&&t.track.id!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const p=o.shift();p&&(l.data=function(m,S){const v=function(U){const W=U.length;let $=[],Q=0;for(;Q<W;)Q+2<W&&U[Q]===0&&U[Q+1]===0&&(U[Q+2]===0||U[Q+2]===1||U[Q+2]===2||U[Q+2]===3)?($.push(U[Q],U[Q+1],3,U[Q+2]),Q+=3):($.push(U[Q]),Q++);return new Uint8Array($)}(S),y=v.length,P=Math.floor(y/255),I=y%255,O=new Uint8Array(6+P+1+y+m.byteLength);O[0]=0,O[1]=0,O[2]=0,O[3]=1,O[4]=6,O[5]=101;let M=0;for(;M<P;)O[6+M]=255,M++;return O[6+M]=I,M++,O.set(v,6+M),O.set(new Uint8Array(m),6+M+y),O.buffer}(l.data,p)),h.enqueue(l)}});r.readable.pipeThrough(c).pipeTo(r.writable)}else{if(!Gi())return;{if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=ib(),o=new MessageChannel;await new At(l=>r.onmessage=h=>{h.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"tx",port:o.port2},[o.port2]);t.transform=c,await new At(l=>r.onmessage=h=>{h.data==="started"&&l(void 0)}),e.on("sei-to-send",l=>{o.port1.postMessage({sei:l})}),o.port1.onmessage=l=>{var h;l.data.transformed&&t.track&&((h=t.track)===null||h===void 0?void 0:h.id)!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=ub.get(t);if(r){ub.delete(t);try{var o,c;(o=r.controller)===null||o===void 0||o.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){b.warning(l&&l.message)}}}ub.set(t,n),t.track.addEventListener("ended",i)}const cS=new Map;async function RI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ge().supportWebRTCEncodedTransform)return void b.warning("browser not support video encoded transform");if(!t.track)return;if(cS.has(t)){const r=cS.get(t);return void(r&&(r.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(Kl()){if(!t.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void b.error("create video-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const h=function(p){const m=new DataView(p.data);let S=0;for(;S+4<p.data.byteLength;){if(m.getUint8(S+0)===0&&m.getUint8(S+1)===0&&m.getUint8(S+2)===0&&m.getUint8(S+3)===1&&m.getUint8(S+4)===6){let v=S+6,y=0,P=0;for(;(P=m.getUint8(v++))===255;)y+=255;y+=P;const I=yz(p.data,v,y);return new Uint8Array(I)}S++}return null}(c);h&&n.onSei&&n.onSei(h),l.enqueue(c)}});r.readable.pipeThrough(o).pipeTo(r.writable)}else if(Gi()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=ib(),o=new MessageChannel;await new At(l=>r.onmessage=h=>{h.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"rx",port:o.port2},[o.port2]);t.transform=c,await new At(l=>r.onmessage=h=>{h.data==="started"&&l(void 0)}),o.port1.onmessage=l=>{var h;l.data.transformed&&t.track&&((h=t.track)===null||h===void 0?void 0:h.id)!==n.track.id?(b.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.sei&&n.onSei&&n.onSei(l.data.sei)},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}(function(r){const o=cS.get(r);if(o){cS.delete(r);try{var c,l;(c=o.controller)===null||c===void 0||c.terminate(),(l=o.worker)===null||l===void 0||l.terminate()}catch(h){b.warning(h&&h.message)}}})(t)}cS.set(t,n),t.track.addEventListener("ended",i)}(function(){const t=Fe();Bi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Bi.getStreamFromExtension=t.name===Ye.CHROME&&Number(t.version)>34,Bi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),Bi.supportMinBitrate=t.name===Ye.CHROME||t.name===Ye.EDGE,Bi.supportSetRtpSenderParameters=function(){const e=Fe();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!zl()||!(!Gi()&&!jR())||e.name===Ye.FIREFOX&&Number(e.version)>=64)}(),t.name===Ye.SAFARI&&(Number(t.version)>=14?Bi.supportDualStream=!0:Bi.supportDualStream=!1),Bi.webAudioMediaStreamDest=function(){const e=Fe();return!(e.name===Ye.SAFARI&&Number(e.version)<12)}(),Bi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Bi.supportWebGL=typeof WebGLRenderingContext<"u",Bi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,zl()||(Bi.webAudioWithAEC=!0),Bi.supportShareAudio=function(){const e=Fe();return(e.os===Ri.WIN_10||e.os===Ri.WIN_81||e.os===Ri.WIN_7||e.os===Ri.LINUX||e.os===Ri.MAC_OS||e.os===Ri.CHROMIUM_OS)&&e.name===Ye.CHROME&&Number(e.version)>=74}(),Bi.supportDataChannel=!!(Bm(76)||function(e){const n=Fe();return!(n.name!==Ye.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||P1(14)),Bi.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!Un()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Bi.supportWebRTCEncodedTransform=function(){const e=Fe();return e.name==="Chrome"&&Number(e.version)>=87||e.name==="Safari"&&Number(e.version)>=15}(),Bi.supportWebRTCInsertableStream=function(){const e=Fe();return(e.name===Ye.CHROME||e.name===Ye.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Bi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Bi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,HR(()=>{Bi.supportDualStreamEncoding=function(){const e=Fe();return!!j("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&j("CHROME_DUAL_STREAM_USE_ENCODING"))}(),b.debug("browser ua: ",navigator.userAgent),b.info("browser info: ",t),b.info("browser compatibility: ",Bi)})})();const bz=["CHINA","GLOBAL"],RU=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],lp=[],rE=[];function dp(t,e){return!!e&&lp.some(n=>n.uid===t&&n.channelName===e)}function bI(){return rE.length>0}var Cz=XL.forEach,bU=Ad("forEach")?[].forEach:function(t){return Cz(this,t,arguments.length>1?arguments[1]:void 0)};qe({target:"Array",proto:!0,forced:[].forEach!==bU},{forEach:bU});var Az=Zr("Array","forEach"),wz=io,Iz=ti,Oz=et,Nz=Az,CI=Array.prototype,Dz={DOMTokenList:!0,NodeList:!0},Pz=function(t){var e=t.forEach;return t===CI||Oz(CI,t)&&e===CI.forEach||Iz(Dz,wz(t))?Nz:e},Lz=R(Pz),kz=$n,CU=Po;qe({target:"Object",stat:!0,forced:w(function(){CU(1)})},{keys:function(t){return CU(kz(t))}});var AU=R(Oi.Object.keys),Mz=R(pc),xz=R(fc),Uz=qe,wU=so,Vz=wh,Bz=pi,IU=tf,jz=dc,Fz=Ii,Gz=fw,Hz=Fn,Wz=Ca,Kz=BL("slice"),zz=Hz("species"),AI=Array,Yz=Math.max;Uz({target:"Array",proto:!0,forced:!Kz},{slice:function(t,e){var n,i,r,o=Fz(this),c=jz(o),l=IU(t,c),h=IU(e===void 0?c:e,c);if(wU(o)&&(n=o.constructor,(Vz(n)&&(n===AI||wU(n.prototype))||Bz(n)&&(n=n[zz])===null)&&(n=void 0),n===AI||n===void 0))return Wz(o,l,h);for(i=new(n===void 0?AI:n)(Yz(h-l,0)),r=0;l<h;l++,r++)l in o&&Gz(i,r,o[l]);return i.length=r,i}});var qz=Zr("Array","slice"),Xz=et,Jz=qz,wI=Array.prototype,Qz=function(t){var e=t.slice;return t===wI||Xz(wI,t)&&e===wI.slice?Jz:e},Zz=R(Qz);function Wt(t,e,n,i,r){var o,c,l,h={};return Lz(o=AU(i)).call(o,function(p){h[p]=i[p]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=Mz(c=xz(l=Zz(n).call(n)).call(l)).call(c,function(p,m){return m(t,e,p)||p},h),r&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(r):void 0,h.initializer=void 0),h.initializer===void 0&&(ML(t,e,h),h=null),h}let hb=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),II=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),ia=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Ar=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),ne=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),_n=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),le=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),ce=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),lS=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),Ne=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),wr=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),pe=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function pb(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw b.error("Invalid Channel Name ".concat(t)),new rt(k.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function fb(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||j1(t,1,255)))throw new rt(k.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&b.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Jl=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const $z={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},OI={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function NI(t,e){Ui(t.url,"".concat(e,".url"),1,1e3,!1),kn(t.x)||nn(t.x,"".concat(e,".x"),0,1e4),kn(t.y)||nn(t.y,"".concat(e,".y"),0,1e4),kn(t.width)||nn(t.width,"".concat(e,".width"),0,1e4),kn(t.height)||nn(t.height,"".concat(e,".height"),0,1e4),kn(t.zOrder)||nn(t.zOrder,"".concat(e,".zOrder"),0,255),kn(t.alpha)||nn(t.alpha,"".concat(e,".alpha"),0,1,!1)}const tY={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let lu=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),DI=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Ei=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function OU(t){if(!t.channelName)throw new rt(k.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new rt(k.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Ui(t.token,"info.token",1,2047),fb(t.uid),pb(t.channelName),!0}let Ir=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Ql=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),ss=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),sE=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Qe=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),Di=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),mb=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),Ci=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),We=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const NU=[We.AFRICA,We.ASIA,We.CHINA,We.EUROPE,We.GLOBAL,We.INDIA,We.JAPAN,We.NORTH_AMERICA,We.OCEANIA,We.OVERSEA,We.SOUTH_AMERICA];let Zi=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const Eb={CHINA:{},ASIA:{CODE:Zi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Zi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Zi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Zi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Zi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Zi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Zi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Zi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Zi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Zi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Zi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Zi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Zi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};$0&&(Eb.CHINA={CODE:Zi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let dS=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function DU(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class PU extends On{constructor(e,n){super(),D(this,"onICEConnectionStateChange",void 0),D(this,"onConnectionStateChange",void 0),D(this,"onDTLSTransportStateChange",void 0),D(this,"onDTLSTransportError",void 0),D(this,"onICETransportStateChange",void 0),D(this,"onFirstAudioReceived",void 0),D(this,"onFirstVideoReceived",void 0),D(this,"onFirstAudioDecoded",void 0),D(this,"onFirstVideoDecoded",void 0),D(this,"onFirstVideoDecodedTimeout",void 0),D(this,"onSelectedLocalCandidateChanged",void 0),D(this,"onSelectedRemoteCandidateChanged",void 0),D(this,"onICECandidateError",void 0),D(this,"getLocalVideoStats",void 0)}}class LU extends PU{constructor(e,n){super(e,n),D(this,"establishPromise",void 0)}}let Vt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),or=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),Zl=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const kU=["disconnected","failed"];let Et=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Je=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),$t=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),ra=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),sa=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Pi=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),MU=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Xc=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Eo=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Wa=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),oE=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),qn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),aE=function(t){return t.ABORT="abort",t}({}),du=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),eY=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const nY={[hb.ACCESS_POINT]:{[Ar.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ar.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ar.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ar.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ar.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ar.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ar.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[hb.UNILBS]:{[ia.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ia.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ia.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ia.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ia.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ia.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ia.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ia.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ia.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ia.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ia.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ia.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[hb.STRING_UID_ALLOCATOR]:{[II.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[II.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[II.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function cE(t){const e=nY[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===hb.ACCESS_POINT){const i=t%1e4;if(i.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const iY={[ne.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ne.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ne.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ne.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ne.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ne.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ne.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ne.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ne.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ne.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ne.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ne.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[ne.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[ne.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ne.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ne.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ne.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ne.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ne.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ne.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ne.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ne.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ne.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ne.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ne.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ne.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ne.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ne.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ne.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ne.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ne.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ne.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ne.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ne.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ne.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ne.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ne.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ne.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ne.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ne.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ne.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ne.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ne.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ne.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ne.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ne.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ne.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ne.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ne.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ne.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ne.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ne.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ne.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ne.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ne.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ne.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[ne.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[ne.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[ne.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[ne.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[ne.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[ne.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[ne.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[ne.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function uS(t){return iY[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function xU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function PI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?xU(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function UU(t,e){if(typeof t=="string")return t;const{proxy:n,host:i,port:r}=t;if(e){const o=j("JOIN_GATEWAY_FALLBACK_PORT")||443;return o===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(o,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const rY=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,sY=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,oY=/wss:\/\/(.+):([0-9]+)\/?/,aY=/wss:\/\/(.[^\/]+)\/?/;let cY=0;class lY{constructor(e,n){D(this,"id",0),D(this,"store",void 0),D(this,"recordIndex",void 0),D(this,"websockets",[]),D(this,"try443PortDuration",2e3),D(this,"forceCloseWSDuration",5e3),D(this,"try443PortTimeout",null),D(this,"forceCloseTimeout",null),D(this,"isTry443PortFailed",!1),D(this,"isNormalPortFailed",!1),D(this,"useDoubleDomain",!1),D(this,"useProxy",!1),D(this,"startTime",Date.now()),this.id=++cY,this.try443PortDuration=j("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];b.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(e,n,i){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:i});const r=j("GATEWAY_DOMAINS"),o=Date.now(),c=[],l=r.find(v=>{var y;return Ct(y=e.host).call(y,v)});l||(this.useDoubleDomain=!1);const h=[];if(this.useDoubleDomain)r.forEach(v=>{h.push(UU(PI(PI({},e),{},{host:e.host.replace(l,v)}),n))});else{const v=PI({},e);if(n&&l){const y=r.find(P=>P!==l);y&&(v.host=v.host.replace(l,y))}h.push(UU(v,n))}try{h.forEach(v=>{const y=new WebSocket(v);y.binaryType="arraybuffer",c.push(y),this.logger("ws is connecting:",y.url)})}catch(v){if(this.logger("ws create failed"),c.forEach(y=>y.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,i);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new rt(k.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const p=Qg();this.store&&this.store.recordJoinChannelService({urls:c.map(v=>v.url),service:"gateway"},this.recordIndex),c.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-o,"ms")),this.websockets.forEach(y=>{y!==v&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,p.resolve(v)},v.onclose=y=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(v.readyState));const P=c.every(I=>I.readyState===WebSocket.CLOSED||I.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(P)),P&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(y.reason)),p.reject({code:y.code,reason:mb.A_ROUND_WS_FAILED})):!n&&P&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),S()),n?this.isTry443PortFailed=P:this.isNormalPortFailed=P},v.onmessage=y=>this.logger("".concat(v.url," onmessage: ").concat(y.data))}),this.websockets.push(...c);const m=()=>{this.websockets.forEach(v=>v.readyState!==WebSocket.OPEN&&v.close())},S=()=>{if(p.isResolved)return m();Fe().os===Ri.MAC_OS&&Un()&&m(),this.createWebSocket(e,!0,!0).then(v=>{p.resolve(v)}).catch(v=>{this.isNormalPortFailed&&p.reject(v),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.forceCloseTimeout=null,m()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,m()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",p.isResolved),this.try443PortTimeout=null,S()},this.try443PortDuration)})(),p.promise}chooseBestWebsocket(e,n,i,r){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(o){let c,l,h;return[,c,l,h]=o.match(rY)||[],c||([,l,h]=o.match(sY)||[]),l&&h||([,l,h]=o.match(oY)||[]),l&&h||([,l]=o.match(aY)||[]),l||b.warning("un-destructible url: ",o),{proxy:c,host:l,port:h||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(b.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function VU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class BU extends On{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;Ct(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(pe.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(pe.CONNECTED):this._state==="closed"?this.emit(pe.CLOSED):this._state==="failed"&&this.emit(pe.FAILED))}resetReconnectCount(e){b.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],o=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),D(this,"connectionID",0),D(this,"currentURLIndex",0),D(this,"urls",[]),D(this,"_reconnectMode","tryNext"),D(this,"reconnectReason",void 0),D(this,"_initMutex",void 0),D(this,"name",void 0),D(this,"_state","closed"),D(this,"reconnectInterrupter",void 0),D(this,"websocket",void 0),D(this,"retryConfig",void 0),D(this,"reconnectCount",0),D(this,"forceCloseTimeout",5e3),D(this,"onlineReconnectListener",void 0),D(this,"useCompress",void 0),D(this,"tryDoubleDomain",!1),D(this,"use443PortOnly",!1),D(this,"wsInflateLength",0),D(this,"wsDeflateLength",0),D(this,"closeEstablishingWs",()=>{}),D(this,"store",void 0),D(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=e,this.retryConfig=function(S){for(var v=1;v<arguments.length;v++){var y=arguments[v]!=null?arguments[v]:{};v%2?VU(Object(y),!0).forEach(function(P){D(S,P,y[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(y)):VU(Object(y)).forEach(function(P){Object.defineProperty(S,P,Object.getOwnPropertyDescriptor(y,P))})}return S}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=o,this._initMutex=new Qi("websocket",c?c.clientId:void 0);const{timeout:l,timeoutFactor:h}=n,p=Math.max(300,Math.floor(3*l/5)),m=Math.max(1.2,Math.floor(8*h)/10);bs.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m),ei.on(Fm.NETWORK_STATE_CHANGE,(S,v)=>{S!==v&&(this.resetReconnectCount("network state change: ".concat(v," -> ").concat(S)),S===bs.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const r=Qg(),o=this.urls[this.currentURLIndex];j("ENABLE_PREALLOC_PC")&&this.emit(MU.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(r.resolve).catch(r.reject),this.once(pe.CLOSED,()=>{r.reject(new at(k.WS_DISCONNECT))}),this.once(pe.CONNECTED,r.resolve),await r.promise}catch{}finally{i()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void b.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),b.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new at(k.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new at(k.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const i=Qg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=m=>{var S;(S=this.store)===null||S===void 0||S.signalChannelOpen(),b.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},o=async m=>{var S;if(b.debug("[".concat(this.name,"] websocket close ").concat((S=this.websocket)===null||S===void 0?void 0:S.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new at(k.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");const v=Fs(this,pe.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,y=await this.reconnectWithAction(v);if(this.state==="closed")return void b.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return i.reject(new at(k.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);i.resolve()}},c=m=>{this.emit(pe.ON_MESSAGE,m)},l=m=>{b.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),j("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=j("GATEWAY_WSS_ADDRESS")),b.debug("[".concat(this.name,"] start connect, url:"),e);const h=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;const m=await this.chooseBestWebsocketConnection(e);this.websocket=m,r&&r(this.websocket.url),this.websocket.onclose=o,this.websocket.onmessage=c,this.websocket.onerror=l,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this.joinGatewayRecordIndex=h}catch(m){const S=this.state==="closed",v=m instanceof at,y=v&&m.code===k.WS_ABORT,P=v&&m.code===k.WS_ERR,I=v?m.message:m&&(m.reason||m.toString());b.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[m]},h),S||P?(i.reject(S?new at(k.WS_DISCONNECT,"websocket is closed: ".concat(I)):new at(k.WS_ERR,"init websocket failed: ".concat(I))),P&&b.error("[".concat(this.name,"] init websocket failed: ").concat(I))):o&&o(m)}return i.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;b.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||ei.isOnline||!ei.onlineWaiter||(this.onlineReconnectListener=ei.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=K0(this.reconnectCount,this.retryConfig);b.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(e)),await At.race([Vi(c),this.onlineReconnectListener||new At(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(c,l)=>{this.emit(pe.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(e==="retry")await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);b.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(b.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Wi(this,pe.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(c){var o;b.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(o=c.data)===null||o===void 0?void 0:o.desc;return Array.isArray(l)&&Ct(l).call(l,"dynamic key expired")?(this.emit(pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class LI extends BU{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const i=Qg(),r=function(c,l){return new lY(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{b.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new at(k.WS_ABORT,"choose best websocket aborted"))};const o=j("GATEWAY_DOMAINS");return b.debug("[choose-best-ws] currentDomain: ",e,", domains: ",o,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class hS extends BU{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new At((i,r)=>{let o=!1;const c=[];this.closeEstablishingWs=()=>{b.debug("[choose-best-ws] close establishing websockets"),c.forEach(P=>{P.onclose=null,P.onopen=null,P.onmessage=null,P.close()}),r(new at(k.WS_ABORT,"choose best websocket aborted"))};const l=j("GATEWAY_DOMAINS");let h;const p=e.indexOf("?h="),m=l.find(P=>p!==-1?Ct(e).call(e,P,p):Ct(e).call(e,P));b.debug("[choose-best-ws] currentDomain: ",m,", domains: ",l);let S=!this.tryDoubleDomain||!m;if(!S&&m){var v;const P=Date.now();try{l.forEach(I=>{const O=p===-1?e.replace(m,I):e.substr(0,p)+e.substr(p).replace(m,I),M=new WebSocket(O);M.binaryType="arraybuffer",c.push(M),b.debug("[choose-best-ws] ws is connecting:",M.url)})}catch{for(b.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(O=>O.close());c.length;)c.pop();S=!0}(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:c.map(I=>I.url),service:"gateway"},n),c.forEach(I=>{I.onopen=()=>{if(o)return;const O=Date.now()-P;b.debug("[choose-best-ws] ws open cost ".concat(O,"ms")),c.filter(M=>M!==I).forEach(M=>{b.debug("[choose-best-ws]close backup websocket: ".concat(M.url)),M.close()}),o=!0,i(I)},I.onclose=O=>{h=O,!o&&(c.find(M=>!(M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING))||(b.debug("[choose-best-ws] all websocket is closed"),o=!0,r(h)))},I.onmessage=O=>{b.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(O.data))}}),Vi(this.forceCloseTimeout).then(()=>{c.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(S){var y;let P;b.debug("[choose-best-ws] use single url: ",e),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[e],service:"gateway"},n);try{P=new WebSocket(e),c.push(P),P.binaryType="arraybuffer"}catch(I){const O=new at(k.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return b.error("[".concat(this.name,"]").concat(O)),void r(O)}P.onopen=()=>{i(P)},P.onclose=I=>{r(I)},P.onmessage=I=>{b.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(I.data))},Vi(this.forceCloseTimeout).then(()=>{P&&P.readyState!==WebSocket.OPEN&&P.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class dY extends On{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===_n.CONNECTED?this.emit(le.WS_CONNECTED):e===_n.RECONNECTING?this.emit(le.WS_RECONNECTING,this._websocketReconnectReason):e===_n.CLOSED&&this.emit(le.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),D(this,"_disconnectedReason",void 0),D(this,"_websocketReconnectReason",void 0),D(this,"_connectionState",_n.CLOSED),D(this,"reconnectToken",void 0),D(this,"websocket",void 0),D(this,"openConnectionTime",void 0),D(this,"clientId",void 0),D(this,"lastMsgTime",Date.now()),D(this,"uploadCache",[]),D(this,"uploadCacheInterval",void 0),D(this,"rttRolling",new nM(5)),D(this,"pingpongTimer",void 0),D(this,"wsInflateDataTimer",void 0),D(this,"pingpongTimeoutCount",0),D(this,"joinResponse",void 0),D(this,"multiIpOption",void 0),D(this,"initError",void 0),D(this,"spec",void 0),D(this,"store",void 0),D(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(le.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const o="res-@".concat(r._id);this.emit(o,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===Ne.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Ne.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Xe.UID_BANNED);break;case 15:this.close(Xe.IP_BANNED);break;case 16:this.close(Xe.CHANNEL_BANNED)}if(r._type===Ne.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case ne.ERR_LICENSE_MISSING:this.close(Xe.LICENSE_MISSING);break;case ne.ERR_LICENSE_EXPIRED:this.close(Xe.LICENSE_EXPIRED);break;case ne.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xe.LICENSE_MINUTES_EXCEEDED);break;case ne.ERR_LICENSE_PERIOD_INVALID:this.close(Xe.LICENSE_PERIOD_INVALID);break;case ne.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xe.LICENSE_MULTIPLE_SDK_SERVICE);break;case ne.ERR_LICENSE_ILLEGAL:this.close(Xe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new LI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===_n.CONNECTED&&this.reconnect("retry",Hi.OFFLINE)})}async request(e,n,i,r){const o=hn(6,""),c={_id:o,_type:e,_message:n},l=this.websocket.connectionID,h=()=>new At((P,I)=>{if(this.connectionState===_n.CONNECTED)return P();const O=()=>{this.off(le.WS_CLOSED,M),P()},M=()=>{this.off(le.WS_CONNECTED,O),I(new rt(k.WS_ABORT))};this.once(le.WS_CONNECTED,O),this.once(le.WS_CLOSED,M),e!==ce.PUBLISH&&e!==ce.PUBLISH_DATASTREAM&&e!==ce.SUBSCRIBE&&e!==ce.SUBSCRIBE_DATASTREAM&&e!==ce.UNSUBSCRIBE&&e!==ce.UNSUBSCRIBE_DATASTREAM&&e!==ce.UNPUBLISH&&e!==ce.UNPUBLISH_DATASTREAM&&e!==ce.CONTROL&&e!==ce.RESTART_ICE||this.once(le.DISCONNECT_P2P,()=>{I(new rt(k.DISCONNECT_P2P))}),e!==ce.PUBLISH&&e!==ce.RESTART_ICE||this.once(le.ABORT_P2P_EXECUTION,()=>{I(new rt(k.DISCONNECT_P2P))})});if(this.connectionState!==_n.CONNECTING&&this.connectionState!==_n.RECONNECTING||e===ce.JOIN||e===ce.REJOIN||await h(),this.websocket.sendMessage(c,!0),r)return;const p=new At((P,I)=>{let O=!1;const M=(W,$)=>{O=!0,P({isSuccess:W==="success",message:$||{}}),this.off(le.WS_CLOSED,U),this.off(le.WS_RECONNECTING,U),this.emit(le.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(o),M);const U=()=>{I(new rt(k.WS_ABORT,"type: ".concat(e))),this.off(le.WS_CLOSED,U),this.off(le.WS_RECONNECTING,U),this.off("res-@".concat(o),M)};this.once(le.WS_CLOSED,U),this.once(le.WS_RECONNECTING,U),Vi(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(b.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(le.REQUEST_TIMEOUT,e,n))})});let m=null;try{m=await p}catch(P){if(this.connectionState===_n.CLOSED||e===ce.LEAVE)throw new rt(k.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?P.throw():e===ce.JOIN||e===ce.REJOIN?null:(await h(),await this.request(e,n))}if(m.isSuccess)return m.message;const S=Number(m.message.error_code||m.message.code),v=uS(S),y=new rt(k.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:S,data:m.message,desc:v.desc});return v.action==="success"?m.message:(b.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(S,", message: ").concat(v.desc,", action: ").concat(v.action)),S===ne.ERR_TOO_MANY_BROADCASTERS?((e===ce.JOIN||e===ce.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(S===ne.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,b.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Hi.MULTI_IP)):this.reconnect(v.action,Hi.SERVER_ERROR),e===ce.JOIN||e===ce.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new At(i=>{const r=o=>{(!n||n(o))&&(this.off(e,r),i(o))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void b.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(lS.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const o=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==_n.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new At((n,i)=>{this.once(le.WS_CONNECTED,()=>n(this.joinResponse)),this.once(le.WS_CLOSED,r=>i(this.initError||new rt(k.WS_ABORT,r))),this.connectionState=_n.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Xe.LEAVE,this.connectionState=_n.CLOSED,b.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(le.ABORT_P2P_EXECUTION);const e=await Wi(this,le.REQUEST_JOIN_INFO),n=await this.request(ce.JOIN,e);if(!n)return this.emit(le.REPORT_JOIN_GATEWAY,mb.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(le.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=_n.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new rt(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=nS(this,le.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(ce.REJOIN,e);return!!n&&(this.connectionState=_n.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(Ne.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Ne.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Ne.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Ne.MUTE_AUDIO,{uid:i.uid}):this.emit(Ne.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Ne.MUTE_VIDEO,{uid:i.uid}):this.emit(Ne.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Ne.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Ne.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Ne.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Ne.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Ne.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){b.debug("[".concat(this.clientId,"] receive notification: "),e);const n=uS(e.code);if(e.code===28&&"detail"in e&&(b.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(le.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xe.UID_BANNED),void this.close()):void this.reconnect(n.action,Hi.SERVER_ERROR);b.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=j("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(b.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Hi.TIMEOUT):this.request(ce.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),j("REPORT_STATS")&&this.send(ce.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(lS.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(pe.RECONNECT_CREATE_CONNECTION,e=>{this.emit(le.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(pe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pe.CLOSED,()=>{this.connectionState=_n.CLOSED}),this.websocket.on(pe.FAILED,()=>{this._disconnectedReason=Xe.NETWORK_ERROR,this.connectionState=_n.CLOSED}),this.websocket.on(pe.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===_n.CONNECTED?this.connectionState=_n.RECONNECTING:this.connectionState=_n.CONNECTING}),this.websocket.on(pe.WILL_RECONNECT,(e,n,i)=>{const r=nS(this,le.IS_P2P_DISCONNECTED),o=r||e!=="retry";r&&e==="retry"&&(b.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=mb.P2P_DISCONNECTED),o&&(b.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(le.REPORT_JOIN_GATEWAY,n||mb.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(le.DISCONNECT_P2P)),i(e)}),this.websocket.on(pe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{b.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Hi.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(le.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof rt){if(e.code===k.UNEXPECTED_RESPONSE&&e.data.code===ne.ERR_NO_AUTHORIZED)return this.initError=new rt(k.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Xe.TOKEN_EXPIRE);b.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Hi.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(pe.REQUEST_NEW_URLS,(e,n)=>{Wi(this,le.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(MU.PRE_CONNECT_PC,()=>{this.emit(le.PRE_CONNECT_PC)})}}let uY=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),ni=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function jU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function _b(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jU(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function lE(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(j("TURN_DOMAIN")):(b.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function kI(t,e){t.addresses||(t.addresses=[]);const n=function(l,h){if(j("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(S=>{let{ip:v,port:y}=S;return{address:"".concat(v,":").concat(y)}});const p=j("GATEWAY_DOMAINS");let m=p[1]&&Ct(h).call(h,p[1])?1:0;return l.map(S=>{let{domain_prefix:v,port:y,ip:P}=S;if(v)return{address:"".concat(v,".").concat(p[m++%p.length],":").concat(y)};const I=/^[\.\:\d]+$/.test(P),O=I?"".concat(P.replace(/[^\d]/g,"-"),".").concat(p[m++%p.length],":").concat(y):"".concat(P,":").concat(y);return I||b.debug("Cannot recognized as ip address: ".concat(P,", use as host")),{ip:P,port:y,address:O}})}(t.addresses,e),i=Array.isArray(t.detail)&&t.detail[18];if(i&&typeof i=="string"){const l=i.split(";");for(let h=0;h<l.length;h++){var r;const p=pr(r=l[h]).call(r);n[h]&&p&&(n[h].ip6=p)}}const o=t.detail&&t.detail.candidate;let c;if(o){const[l,h]=o.split(":");l&&h&&(c={port:Number(h),ip:l,address:"".concat(l,":").concat(h)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Cs(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function FU(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(Cs(e.width),"x").concat(Cs(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function GU(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function pS(t,e){let n,i,r;switch(e){case ni.CHOOSE_SERVER:i=4096,r="choose server";break;case ni.CLOUD_PROXY:i=1048576,r="proxy";break;case ni.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case ni.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new rt(k.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(o=>{o.buffer&&o.buffer.flag===i&&(n={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map(c=>_b(_b({},c),{},{ticket:o.buffer.cert})),server_ts:t.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:_b(_b({},o.buffer.detail),t.detail),flag:o.buffer.flag,opid:t.opid,cert:o.buffer.cert})}),!n)throw new rt(k.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function HU(t,e){return await At.all(t.addresses.map(async n=>({address:lE(n.ip),tcpport:n.port,udpport:n.port,username:e&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():Ki.username,password:e&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await F0(e.toString()):Ki.password})))}function MI(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||n.height,r=e.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min(Cs(t.height),Cs(t.width)),1):(b.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function uu(t){let{candidateType:e,relayProtocol:n,type:i,address:r,port:o,protocol:c}=t;const l={candidateType:e,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const h=r.split(".");h.length>=4&&(h[1]="*",h[2]="*"),l.address=h.join("."),l.port=o}return l}function gb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:j("SVC_MODE");if(j("ENABLE_SVC"))return function(e){return e in YR}(t)?t:YR.L1T3}const WU={[Vt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Vt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function Sb(t,e,n){e.forEach(i=>{var r;const o=WU[t].find(l=>{var h;let{key:p}=l;return Ct(h=i.extensionName).call(h,p)});if(!o)return;const c=n.find(l=>{let{extensionName:h}=l;return Ct(h).call(h,o.key)});c&&Ct(r=c.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=c.extensionName)})}function dE(t,e){e.forEach(n=>{var i;const r=WU[t].find(o=>{var c;let{key:l}=o;return Ct(c=n.extensionName).call(c,l)});Ct(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function KU(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ct(t).call(t,"abs-send-time")}function Tb(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ct(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function zU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function YU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zU(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function fS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:o,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:h}=e,{useXR:p}=n;let m=[],S=[],v=[],y=[],P=!1,I=!1;if(rs(t).mediaDescriptions.forEach(M=>{i&&i!==M.attributes.direction||(M.media.mediaType!=="video"||P||(S=M.attributes.payloads,y=M.attributes.extmaps,P=!0),M.media.mediaType!=="audio"||I||(m=M.attributes.payloads,v=M.attributes.extmaps,I=!0))}),!y||S.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!v||m.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(S.forEach(M=>{var U;(U=M.rtpMap)!==null&&U!==void 0&&U.clockRate&&(M.rtpMap.clockRate=parseInt(M.rtpMap.clockRate)),p&&M.rtcpFeedbacks.push({type:"rrtr"})}),m.forEach(M=>{var U;(U=M.rtpMap)!==null&&U!==void 0&&U.clockRate&&(M.rtpMap.clockRate=parseInt(M.rtpMap.clockRate)),p&&M.rtcpFeedbacks.push({type:"rrtr"})}),r&&(m=m.filter(M=>{var U;return((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())!=="rtx"}),S=S.filter(M=>{var U;return((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())!=="rtx"})),o&&(S=S.filter(M=>{var U;return!/(red)|(ulpfec)|(flexfec)/i.test(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")})),c&&(m=m.filter(M=>{var U;return!/(red)|(ulpfec)|(flexfec)/i.test(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(m=m.filter(M=>{var U;return Ct(l).call(l,((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"")})),h&&(h==null?void 0:h.length)>0){const M=S.filter(U=>{var W;return Ct(h).call(h,((W=U.rtpMap)===null||W===void 0?void 0:W.encodingName.toLowerCase())||"")});S=M.concat(r?[]:VI(M,S))}const O=j("UNSUPPORTED_VIDEO_CODEC");return O&&O.length>0&&(S=S.filter(M=>!(M.rtpMap&&Ct(O).call(O,M.rtpMap.encodingName.toLowerCase())))),{audioCodecs:m,videoCodecs:S,audioExtensions:v,videoExtensions:y}}function hu(t){const e=rs(t);let n,i;for(const r of e.mediaDescriptions){if(!n){const o=r.attributes.iceUfrag,c=r.attributes.icePwd;if(!o||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:o,icePwd:c}}if(!i){const o=r.attributes.fingerprints;o.length>0&&(i={fingerprints:o})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function qU(t,e){const n=[],i=t.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),r=t.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),o=t.attributes.ssrcs;if(r)r.ssrcIds.forEach(c=>{var l;const h=(l=i.find(p=>p.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:e?h:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:e?l:void 0})}else{if(o.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function XU(t,e,n){const{cname:i}=t;let r=[];e&&(r=JU(e)),r.length===0&&(r=t.iceParameters.candidates.map(m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}})),b.debug("Using candidates from gateway."));const o={fingerprints:t.dtlsParameters.fingerprints.map(m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint}))},c={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let l;switch(t.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}const h=yb(t.rtpCapabilities),p=[];return Array.isArray(n)&&n.length>0&&n.forEach(m=>{p.push({kind:Vt.VIDEO,ssrcId:m.v,rtx:m.v_rtx,mslabel:"".concat(m.v,"_").concat(m.a)},{kind:Vt.AUDIO,ssrcId:m.a,mslabel:"".concat(m.v,"_").concat(m.a)})}),{dtlsParameters:o,iceParameters:c,candidates:r,rtpCapabilities:h,setup:l,cname:i,preSSRCs:p}}function JU(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],b.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),b.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function up(t,e,n){const i=[],r=[];return t.forEach(o=>{let{ssrcId:c,rtx:l}=o;const h=hn(8,"track-"),p={ssrcId:c,attributes:YU({label:h,mslabel:n=n||hn(10,""),msid:"".concat(n," ").concat(h)},e&&{cname:e})};if(i.push(p),l!==void 0){const m={ssrcId:l,attributes:YU({label:h,mslabel:n,msid:"".concat(n," ").concat(h)},e&&{cname:e})};i.push(m),r.push({semantic:"FID",ssrcIds:[c,l]})}}),t.length>1&&r.push({semantic:"SIM",ssrcIds:t.map(o=>{let{ssrcId:c}=o;return c})}),{ssrcs:i,ssrcGroups:r}}function uE(t,e){e instanceof Bn&&t.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const o=e._encoderConfig;o&&r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(o.bitrate&&!Un()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function xI(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function UI(t,e){var n;if(!(e instanceof vn&&e._encoderConfig&&e._hints.indexOf(pn.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;Ge().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach(r=>{var o,c;Ct(o=["h264","h265","vp8","vp9","av1"]).call(o,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Ge().supportMinBitrate&&!Ct(n=e._hints).call(n,pn.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach(r=>{var o,c;Ct(o=["h264","h265","vp8","vp9","av1"]).call(o,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(j("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function QU(t){if(t.media.mediaType!=="video")return;const e=Fe();if(e.name!==Ye.SAFARI&&e.os!==Ri.IOS)return;const n=t.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function vb(t,e,n){if(!e)return;let i,r;if(t.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),e.twcc===!0){const o=i.find(c=>Tb(c.extensionName));if(o){const c=o.extensionName;t.attributes.extmaps.find(h=>Tb(h.extensionName))||t.attributes.extmaps.push({entry:o.entry,extensionName:c}),function(h,p){return p.filter(m=>!!h.find(S=>S.payloadType===m.payloadType&&!!S.rtcpFeedbacks.find(v=>v.type==="transport-cc")))}(r,t.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(p=>p.type==="transport-cc")||h.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const o=t.attributes.extmaps.findIndex(c=>Tb(c.extensionName));o!==-1&&t.attributes.extmaps.splice(o,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(e.remb===!0){const o=i.find(c=>KU(c.extensionName));if(o){const c=o.extensionName;t.attributes.extmaps.find(h=>h.extensionName===c)||t.attributes.extmaps.push({entry:o.entry,extensionName:c}),function(h,p){return p.filter(m=>!!h.find(S=>S.payloadType===m.payloadType&&!!S.rtcpFeedbacks.find(v=>v.type==="goog-remb")))}(r,t.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(p=>p.type==="goog-remb")||h.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const o=t.attributes.extmaps.findIndex(c=>KU(c.extensionName));o!==-1&&t.attributes.extmaps.splice(o,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function ZU(t,e,n){if(Un()||t.media.mediaType!=="video"||!(e instanceof vn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!j("SIMULCAST")||n==="vp9"&&j("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,r=t.attributes.ssrcs[0],o=t.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===r.ssrcId),c={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let l=1;l<i;l++)t.attributes.ssrcs.push({ssrcId:r.ssrcId+l,attributes:Vn(r.attributes)}),c.ssrcIds.push(r.ssrcId+l),o&&(t.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+l,attributes:Vn(r.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+l,o.ssrcIds[1]+l]}));t.attributes.ssrcGroups.unshift(c)}async function $U(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:o,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const m=fS(p,l,h,"sendonly"),S=fS(p,l,h,"recvonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oa(m,S,"videoExtensions",v,y,P),oa(m,S,"videoCodecs",v,y,P),oa(m,S,"audioExtensions",v,y,P),oa(m,S,"audioCodecs",v,y,P),j("RAISE_H264_BASELINE_PRIORITY")){const I=[],O=[];P.videoCodecs.forEach((M,U)=>{var W;if(((W=M.rtpMap)===null||W===void 0?void 0:W.encodingName.toLocaleLowerCase())==="h264"){var $,Q;const q=P.videoCodecs[U+1],ct=q&&r2(M,q),_t=($=M.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"],Dt=(Q=M.fmtp)===null||Q===void 0?void 0:Q.parameters["packetization-mode"];!_t||_t!==j("FIRST_H264_PROFILE_LEVEL_ID")||j("FIRST_PACKETIZATION_MODE")&&Dt!==j("FIRST_PACKETIZATION_MODE")?ct?O.push([M,q]):O.push([M]):ct?I.push([M,q]):I.push([M])}}),I.length>0&&O.length>0&&(b.debug("raising H264 baseline profile priority"),P.videoCodecs.forEach((M,U)=>{var W;if(((W=M.rtpMap)===null||W===void 0?void 0:W.encodingName.toLocaleLowerCase())==="h264"){const $=r2(M,P.videoCodecs[U+1]),Q=I.shift()||O.shift()||[];Q.length>0&&($?P.videoCodecs.splice(U,2,...Q):P.videoCodecs.splice(U,1,...Q))}}),y.videoCodecs=y.videoCodecs.filter(M=>{var U,W;return!(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((W=M.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"])!==j("FIRST_H264_PROFILE_LEVEL_ID"))}),j("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(M=>{var U,W;return!(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((W=M.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"])!==j("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:v,recv:y,sendrecv:P}}(t,e,i);try{n.close()}catch{}return{send:r,recv:o,sendrecv:c}}function t2(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=fS(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oa(t,e,"videoExtensions",n,i,r),oa(t,e,"videoCodecs",n,i,r),oa(t,e,"audioExtensions",n,i,r),oa(t,e,"audioCodecs",n,i,r),j("RAISE_H264_BASELINE_PRIORITY")){const o=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(o!==-1){const c=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<o){b.debug("raising H264 baseline profile priority");const l=r.videoCodecs[o];r.videoCodecs.splice(o,1),r.videoCodecs.splice(c,0,l)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function oa(t,e,n,i,r,o){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return t[n].forEach(l=>{e[n].some((h,p)=>{if(l.entry===h.entry&&l.extensionName===h.extensionName)return c.push(p),!0})?o[n].push(l):i[n].push(l)}),void e[n].forEach((l,h)=>{c.indexOf(h)===-1&&r[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return t[n].forEach(l=>{e[n].some((h,p)=>{if(l.payloadType===h.payloadType&&JSON.stringify(l)===JSON.stringify(h))return c.push(p),!0})?o[n].push(l):i[n].push(l)}),void e[n].forEach((l,h)=>{c.indexOf(h)===-1&&r[n].push(l)})}}function yb(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let r,o;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...i.audioCodecs],o.videoCodecs=[...n.videoCodecs,...i.videoCodecs],o.audioExtensions=[...n.audioExtensions,...i.audioExtensions],o.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):o=i,{send:r,recv:o}}function hE(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function mS(t,e,n,i){let r=[];if(t===Vt.VIDEO){if(j("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=e.videoCodecs.filter(o=>{var c;return Ct(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===j("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let o=[];const c=[],l=[],h=[];if(n.videoCodecs.forEach(p=>{const m=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"";Ct(m).call(m,i)?o.push(p):Ct(m).call(m,"vp9")?c.push(p):Ct(m).call(m,"vp8")?l.push(p):Ct(m).call(m,"h264")&&h.push(p)}),o.length===0){let p="";c.length!==0?(o=c,p="vp9"):l.length!==0?(o=l,p="vp8"):h.length!==0&&(o=h,p="h264"),b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(p))}o.length!==0&&(r=e.videoCodecs.filter(p=>o.some(m=>m.payloadType===p.payloadType)))}if(r.length===0&&(b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs),j("USE_PUB_RTX")||j("USE_SUB_RTX")){const o=VI(r,e.videoCodecs);r=[...r,...o]}}else r=e.audioCodecs.filter(o=>{var c;return Ct(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,i)}),r.length===0&&(b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter(o=>{var c;return Ct(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return r}function VI(t,e){const n=t.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&Ct(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Rb(t,e,n){const i=e.toString(),r=n2(i,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:i});const o=await t.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let c=o.sdp;c=e2(c,n||{}),r==null||r(c||""),await t.setLocalDescription({type:"answer",sdp:c})}function e2(t,e,n){const i=rs(t),{useXR:r}=e;return i.mediaDescriptions.forEach(o=>{var c;o.attributes.mid&&(Array.isArray(n)&&!Ct(n).call(n,o.attributes.mid)||(o.media.mediaType==="audio"&&hE(o),r&&Ct(c=["audio","video"]).call(c,o.media.mediaType)&&o.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(h=>h.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),cu(i)}function n2(t,e,n,i){if(j("SDP_LOGGING"))return b.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(i,`
`),t),e==="offer"?r=>{n2(r,"answer",n==="local"?"remote":"local",i)}:void 0}function i2(t){const e=j("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>Ct(t).call(t,n))}function r2(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function s2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function _o(t,e){return typeof j(t)===e?j(t):void 0}function hY(){try{const t=j("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?s2(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s2(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t)}catch(t){return b.debug("handle gateway attributes failed: ",t),{}}}const o2={};function hp(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&b.debug("install service ".concat(t.name)),o2[t.name]=t}function pu(t){const e=o2[t];if(!e)throw new at(k.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function a2(t,e){return pu("DataStream").create(t,e)}function c2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function $l(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?c2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const BI=new Map;class pY extends On{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(Di.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(Di.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){b.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var i,r,o;super(),D(this,"store",void 0),D(this,"joinInfo",void 0),D(this,"key",void 0),D(this,"ntpOffset",0),D(this,"signal",void 0),D(this,"role",void 0),D(this,"inChannelInfo",{joinAt:null,duration:0}),D(this,"spec",void 0),D(this,"_state","DISCONNECTED"),D(this,"_statsCollector",void 0),D(this,"_disconnectedReason",void 0),D(this,"isSignalRecover",!1),D(this,"hasChangeBGPAddress",!1),D(this,"trafficStatsInterval",void 0),D(this,"networkQualityInterval",void 0),D(this,"_joinGatewayStartTime",0),D(this,"_signalTimeout",!1),D(this,"_clientRoleOptions",void 0),D(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(i={spec:$l($l({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(r=(o=pu("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(o,i)):new dY($l($l({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let o=BI.get(e.cname);if(o||(o=new Map,BI.set(e.cname,o)),this._isProactiveJoin=!0,o.has(e.uid)){const p=new rt(k.UID_CONFLICT);throw qt.joinGateway(e.sid,{lts:r,succ:!1,ec:p.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),p}o.set(e.uid,!0),this.joinInfo=e,this.key=n;let c=0;this.joinGatewayStartTime=r;const l=e.proxyServer;try{b.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const p=e.gatewayAddrs.map(m=>{let{address:S}=m;const[v,y]=S.split(":"),P={host:v,port:y};return e.proxyServer&&(P.proxy=e.proxyServer),P});c=(await this.signal.init(p)).uid,b.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(p){var h;throw b.error("[".concat(this.store.clientId,"] User join failed"),p.toString()),qt.joinGateway(e.sid,{lts:r,succ:!1,ec:((h=p.data)===null||h===void 0?void 0:h.desc)||p.code,errorMsg:p.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:"0",preload:e.preload}),o.delete(e.uid),this.signal.close(),p}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),b.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(p=>{b.warning("[".concat(this.store.clientId,"] get traffic stats error"),p.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Di.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Di.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Di.NETWORK_QUALITY,{uplinkNetworkQuality:GU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:GU(this._statsCollector.trafficStats.B_dnq)}):this.emit(Di.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Xe.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==_n.CONNECTED||await function(i,r){return r===1/0?i:At.race([i,MK(r)])}(this.signal.request(ce.LEAVE,void 0,!0),3e3)}catch(i){b.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Xe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:j("PUB_EXTEND"),twcc:!!j("PUBLISH_TWCC"),rtx:!!j("USE_PUB_RTX")};try{return(await this.signal.request(ce.PUBLISH,r,!0))._message}catch(o){if(i&&o.data&&o.data.code===ne.ERR_PUBLISH_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),o.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw o}}async publishDataChannel(e,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(ce.PUBLISH_DATASTREAM,o,!0)}catch(c){if(i&&c.data&&c.data.code===ne.ERR_PUBLISH_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw c}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ce.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(i){b.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await At.all(e.map(n=>this.signal.request(ce.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){b.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX")||void 0,extend:j("SUB_EXTEND"),svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return await this.signal.request(ce.PRE_SUBSCRIBE,r,!0)}catch(o){if(i&&o.data&&o.data.code===ne.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),o.toString()),this.presubscribe(e,n,!1);throw o}}async subscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX"),extend:j("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return(await this.signal.request(ce.SUBSCRIBE,r,!0))._message}catch(o){if(i&&o.data&&o.data.code===ne.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),o.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw o}}async subscribeDataChannel(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(ce.SUBSCRIBE_DATASTREAM,r,!0)}catch(o){if(i&&o.data&&o.data.code===ne.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),o.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw o}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!j("USE_SUB_RTX"),twcc:!!j("SUBSCRIBE_TWCC"),svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return await this.signal.request(ce.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===ne.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,o=i.width,c=i.height,l=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(l=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,r||(l=!1)),l?{stream_type:0,width:o,height:c,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(n)return this.signal.request(ce.SET_VIDEO_PROFILE,n);b.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(ce.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(i){b.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await At.all(e.map(i=>this.signal.request(ce.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){b.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(ce.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){b.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(ce.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ce.GATEWAY_INFO)}async renewToken(e){await this.signal.request(ce.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),j("CLIENT_ROLE_OPTIONS")&&(b.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(j("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},j("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),j("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},j("CLIENT_ROLE_OPTIONS")),b.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(j("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(ce.SET_CLIENT_ROLE,{role:e,level:r,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(ce.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(ce.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(ce.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(ce.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(ce.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),$l({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ce.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=BI.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Ki.username,password:Ki.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push($l($l({},Ki),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(ce.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&HR(()=>{this.emit(Di.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new rt(k.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=j("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}var r;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Di.UPDATE_GATEWAY_CONFIG),r=this.store.clientId,Ct(rE).call(rE,r)||rE.push(r);const o=!(Un()||D1(87)||gM())&&typeof j("ENABLE_PRE_SUB")=="boolean"&&j("ENABLE_PRE_SUB"),c=!gM()&&_o("ENABLE_PREALLOC_PC","boolean"),l=hY(),h=$l({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:po,browser:navigator.userAgent,process_id:j("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:j("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:$l({enableEncodedTransform:!!j("ENABLE_AUDIO_METADATA")&&Bm(87)||!!j("ENABLE_AUDIO_TOPN")&&L0(Ye.CHROME,87,116)||void 0,enableAudioMetadata:!!j("ENABLE_AUDIO_METADATA")&&Bm(87),topnSmoothLevel:j("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:j("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:j("TOPN_SWITCH_HOLD_MS"),topnAudioGain:j("TOPN_AUDIO_GAIN"),enablePublishedUserList:j("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:j("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:_o("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:_o("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:_o("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:j("USE_PUB_RTX")===!0||j("USE_SUB_RTX")===!0||void 0,disableFEC:j("DISABLE_FEC"),enableNTPReport:!!j("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!j("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!j("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:_o("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!j("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!j("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:_o("USE_XR","boolean"),enableLossbasedBwe:_o("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!j("ENABLE_AUT_CC")||void 0,enableCCFallback:_o("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:c,preSubNum:o?_o("PRE_SUB_NUM","number"):void 0,enablePubTWCC:_o("PUBLISH_TWCC","boolean"),enableSubTWCC:_o("SUBSCRIBE_TWCC","boolean"),enablePubRTX:_o("USE_PUB_RTX","boolean"),enableSubRTX:_o("USE_SUB_RTX","boolean"),enableSubSVC:j("ENABLE_SVC")?j("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0,enableSvcExtended:j("ENABLE_SVC")&&Array.isArray(j("SVC_EXTENDED"))&&j("SVC_EXTENDED").length!==0?j("SVC_EXTENDED"):void 0},l)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,j("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new rt(k.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(le.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(le.WS_RECONNECTING,e=>{this.joinInfo&&qt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Hi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",qt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(le.WS_CLOSED,e=>{let n;switch(e){case Xe.LEAVE:n=Hi.LEAVE;break;case Xe.UID_BANNED:case Xe.IP_BANNED:case Xe.CHANNEL_BANNED:case Xe.SERVER_ERROR:n=Hi.SERVER_ERROR;break;case Xe.FALLBACK:n=Hi.FALLBACK;break;case Xe.LICENSE_MISSING:case Xe.LICENSE_EXPIRED:case Xe.LICENSE_MINUTES_EXCEEDED:case Xe.LICENSE_PERIOD_INVALID:case Xe.LICENSE_MULTIPLE_SDK_SERVICE:case Xe.LICENSE_ILLEGAL:case Xe.TOKEN_EXPIRE:n=e;break;default:n=Hi.NETWORK_ERROR}b.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Hi.NETWORK_ERROR)),this.joinInfo&&qt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Xe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==Xe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(le.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=j("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(b.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(qt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void b.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));$e("EVENT_REPORT_DOMAIN",e[1]),$e("EVENT_REPORT_BACKUP_DOMAIN",e[1]),$e("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(Ne.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(le.REQUEST_RECOVER,(e,n,i)=>{if(!this.joinInfo)return i(new rt(k.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Wi(this,Di.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(le.REQUEST_JOIN_INFO,async(e,n,i)=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:o,dtlsParameters:c,rtpCapabilities:l}=await Wi(this,Di.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(r=this.joinInfo)===null||r===void 0?void 0:r.turnServer});try{e(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:c,rtpCapabilities:l,version:"2"}}))}catch(h){n(h)}}),this.signal.on(le.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(le.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let i,r="";var o;e instanceof rt?(i=((o=e.data)===null||o===void 0?void 0:o.desc)||e.code,r=e.message):i=e,qt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(le.IS_P2P_DISCONNECTED,e=>{e(nS(this,Di.IS_P2P_DISCONNECTED))}),this.signal.on(le.DISCONNECT_P2P,()=>{this.emit(Di.DISCONNECT_P2P)}),this.signal.on(le.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(le.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(le.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(Di.JOIN_RESPONSE,e,n)}),this.signal.on(le.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=j("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const i=JU(e);this.emit(Di.PRE_CONNECT_PC,{candidates:i,fingerprint:n})}}}),this.signal.on(le.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof j("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(j("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(ce.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(ce.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw b.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(ce.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(ce.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw b.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const n={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(ce.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,n){const i={action:e.find(r=>r.stream_type===Qe.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(ce.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,n){const i={action:e.find(r=>r.stream_type===Qe.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(ce.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,n){const i={action:e===Vt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ce.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,n){const i={action:e===Vt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ce.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(ce.RESTART_ICE,n,!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||Hi.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!j("GATEWAY_WSS_ADDRESS"))return j("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(b.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(ce.SET_PARAMETER,{enablePublishAudioFilter:e})}}let bb=0,jI=0;function Ka(t,e,n,i){return new At((r,o)=>{e.timeout=e.timeout||j("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),bb+=Wc(e.data)):n&&(e.data.size?bb+=e.data.size:e.data instanceof FormData?bb+=X1(e.data):bb+=Wc(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Br.request(e).then(c=>{typeof c.data=="string"?jI+=Wc(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?jI+=c.data.byteLength:jI+=Wc(JSON.stringify(c.data)),i&&r({data:c.data,headers:c.headers}),r(c.data)}).catch(c=>{Br.isCancel(c)?o(new rt(k.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?o(new rt(k.NETWORK_TIMEOUT,c.message)):c.response?o(new rt(k.NETWORK_RESPONSE_ERROR,c.response.status)):o(new rt(k.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(ht){var yt=0;return function(){return yt<ht.length?{done:!1,value:ht[yt++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(ht,yt,Kt){return ht==Array.prototype||ht==Object.prototype||(ht[yt]=Kt.value),ht},i,r=function(ht){ht=[typeof globalThis=="object"&&globalThis,ht,typeof window=="object"&&window,typeof self=="object"&&self,typeof g=="object"&&g];for(var yt=0;yt<ht.length;++yt){var Kt=ht[yt];if(Kt&&Kt.Math==Math)return Kt}throw Error("Cannot find global object")}(this);function o(ht,yt){if(yt)t:{var Kt=r;ht=ht.split(".");for(var ft=0;ft<ht.length-1;ft++){var A=ht[ft];if(!(A in Kt))break t;Kt=Kt[A]}(yt=yt(ft=Kt[ht=ht[ht.length-1]]))!=ft&&yt!=null&&n(Kt,ht,{configurable:!0,writable:!0,value:yt})}}function c(ht){return(ht={next:ht})[Symbol.iterator]=function(){return this},ht}function l(ht){var yt=typeof Symbol<"u"&&Symbol.iterator&&ht[Symbol.iterator];return yt?yt.call(ht):{next:e(ht)}}if(o("Symbol",function(ht){function yt(A,F){this.A=A,n(this,"description",{configurable:!0,writable:!0,value:F})}if(ht)return ht;yt.prototype.toString=function(){return this.A};var Kt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ft=0;return function A(F){if(this instanceof A)throw new TypeError("Symbol is not a constructor");return new yt(Kt+(F||"")+"_"+ft++,F)}}),o("Symbol.iterator",function(ht){if(ht)return ht;ht=Symbol("Symbol.iterator");for(var yt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Kt=0;Kt<yt.length;Kt++){var ft=r[yt[Kt]];typeof ft=="function"&&typeof ft.prototype[ht]!="function"&&n(ft.prototype,ht,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return ht}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var h;t:{var p={};try{p.__proto__={a:!0},h=p.a;break t}catch{}h=!1}i=h?function(ht,yt){if(ht.__proto__=yt,ht.__proto__!==yt)throw new TypeError(ht+" is not extensible");return ht}:null}var m=i;function S(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function v(ht){if(ht.m)throw new TypeError("Generator is already running");ht.m=!0}function y(ht,yt){return ht.h=3,{value:yt}}function P(ht){this.g=new S,this.G=ht}function I(ht,yt,Kt,ft){try{var A=yt.call(ht.g.j,Kt);if(!(A instanceof Object))throw new TypeError("Iterator result "+A+" is not an object");if(!A.done)return ht.g.m=!1,A;var F=A.value}catch(H){return ht.g.j=null,ht.g.s(H),O(ht)}return ht.g.j=null,ft.call(ht.g,F),O(ht)}function O(ht){for(;ht.g.h;)try{var yt=ht.G(ht.g);if(yt)return ht.g.m=!1,{value:yt.value,done:!1}}catch(Kt){ht.g.v=void 0,ht.g.s(Kt)}if(ht.g.m=!1,ht.g.l){if(yt=ht.g.l,ht.g.l=null,yt.F)throw yt.D;return{value:yt.return,done:!0}}return{value:void 0,done:!0}}function M(ht){this.next=function(yt){return ht.o(yt)},this.throw=function(yt){return ht.s(yt)},this.return=function(yt){return function(Kt,ft){v(Kt.g);var A=Kt.g.j;return A?I(Kt,"return"in A?A.return:function(F){return{value:F,done:!0}},ft,Kt.g.return):(Kt.g.return(ft),O(Kt))}(ht,yt)},this[Symbol.iterator]=function(){return this}}function U(ht,yt){return yt=new M(new P(yt)),m&&ht.prototype&&m(yt,ht.prototype),yt}if(S.prototype.o=function(ht){this.v=ht},S.prototype.s=function(ht){this.l={D:ht,F:!0},this.h=this.C||this.u},S.prototype.return=function(ht){this.l={return:ht},this.h=this.u},P.prototype.o=function(ht){return v(this.g),this.g.j?I(this,this.g.j.next,ht,this.g.o):(this.g.o(ht),O(this))},P.prototype.s=function(ht){return v(this.g),this.g.j?I(this,this.g.j.throw,ht,this.g.o):(this.g.s(ht),O(this))},o("Array.prototype.entries",function(ht){return ht||function(){return function(yt,Kt){yt instanceof String&&(yt+="");var ft=0,A=!1,F={next:function(){if(!A&&ft<yt.length){var H=ft++;return{value:Kt(H,yt[H]),done:!1}}return A=!0,{done:!0,value:void 0}}};return F[Symbol.iterator]=function(){return F},F}(this,function(yt,Kt){return[yt,Kt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var W=function(ht,yt){for(var Kt=0;Kt<ht.length;Kt++)yt(ht[Kt])},$=function(ht){return ht.replace(/\r?\n|\r/g,`\r
`)},Q=function(ht,yt,Kt){return yt instanceof Blob?(Kt=Kt!==void 0?Kt+"":typeof yt.name=="string"?yt.name:"blob",yt.name===Kt&&Object.prototype.toString.call(yt)!=="[object Blob]"||(yt=new File([yt],Kt)),[String(ht),yt]):[String(ht),String(yt)]},q=function(ht,yt){if(ht.length<yt)throw new TypeError(yt+" argument required, but only "+ht.length+" present.")},ct=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,_t=ct.FormData,Dt=ct.XMLHttpRequest&&ct.XMLHttpRequest.prototype.send,Mt=ct.Request&&ct.fetch,De=ct.navigator&&ct.navigator.sendBeacon,Pe=ct.Element&&ct.Element.prototype,fn=ct.Symbol&&Symbol.toStringTag;fn&&(Blob.prototype[fn]||(Blob.prototype[fn]="Blob"),"File"in ct&&!File.prototype[fn]&&(File.prototype[fn]="File"));try{new File([],"")}catch{ct.File=function(yt,Kt,ft){return yt=new Blob(yt,ft||{}),Object.defineProperties(yt,{name:{value:Kt},lastModified:{value:+(ft&&ft.lastModified!==void 0?new Date(ft.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),fn&&Object.defineProperty(yt,fn,{value:"File"}),yt}}var Xn=function(ht){return ht.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},jn=function(ht){this.i=[];var yt=this;ht&&W(ht.elements,function(Kt){if(Kt.name&&!Kt.disabled&&Kt.type!=="submit"&&Kt.type!=="button"&&!Kt.matches("form fieldset[disabled] *"))if(Kt.type==="file"){var ft=Kt.files&&Kt.files.length?Kt.files:[new File([],"",{type:"application/octet-stream"})];W(ft,function(A){yt.append(Kt.name,A)})}else Kt.type==="select-multiple"||Kt.type==="select-one"?W(Kt.options,function(A){!A.disabled&&A.selected&&yt.append(Kt.name,A.value)}):Kt.type==="checkbox"||Kt.type==="radio"?Kt.checked&&yt.append(Kt.name,Kt.value):(ft=Kt.type==="textarea"?$(Kt.value):Kt.value,yt.append(Kt.name,ft))})};if((t=jn.prototype).append=function(ht,yt,Kt){q(arguments,2),this.i.push(Q(ht,yt,Kt))},t.delete=function(ht){q(arguments,1);var yt=[];ht=String(ht),W(this.i,function(Kt){Kt[0]!==ht&&yt.push(Kt)}),this.i=yt},t.entries=function ht(){var yt,Kt=this;return U(ht,function(ft){if(ft.h==1&&(yt=0),ft.h!=3)return yt<Kt.i.length?ft=y(ft,Kt.i[yt]):(ft.h=0,ft=void 0),ft;yt++,ft.h=2})},t.forEach=function(ht,yt){q(arguments,1);for(var Kt=l(this),ft=Kt.next();!ft.done;ft=Kt.next()){var A=l(ft.value);ft=A.next().value,A=A.next().value,ht.call(yt,A,ft,this)}},t.get=function(ht){q(arguments,1);var yt=this.i;ht=String(ht);for(var Kt=0;Kt<yt.length;Kt++)if(yt[Kt][0]===ht)return yt[Kt][1];return null},t.getAll=function(ht){q(arguments,1);var yt=[];return ht=String(ht),W(this.i,function(Kt){Kt[0]===ht&&yt.push(Kt[1])}),yt},t.has=function(ht){q(arguments,1),ht=String(ht);for(var yt=0;yt<this.i.length;yt++)if(this.i[yt][0]===ht)return!0;return!1},t.keys=function ht(){var yt,Kt,ft,A,F=this;return U(ht,function(H){if(H.h==1&&(yt=l(F),Kt=yt.next()),H.h!=3)return Kt.done?void(H.h=0):(ft=Kt.value,A=l(ft),y(H,A.next().value));Kt=yt.next(),H.h=2})},t.set=function(ht,yt,Kt){q(arguments,2),ht=String(ht);var ft=[],A=Q(ht,yt,Kt),F=!0;W(this.i,function(H){H[0]===ht?F&&(F=!ft.push(A)):ft.push(H)}),F&&ft.push(A),this.i=ft},t.values=function ht(){var yt,Kt,ft,A,F=this;return U(ht,function(H){if(H.h==1&&(yt=l(F),Kt=yt.next()),H.h!=3)return Kt.done?void(H.h=0):(ft=Kt.value,(A=l(ft)).next(),y(H,A.next().value));Kt=yt.next(),H.h=2})},jn.prototype._asNative=function(){for(var ht=new _t,yt=l(this),Kt=yt.next();!Kt.done;Kt=yt.next()){var ft=l(Kt.value);Kt=ft.next().value,ft=ft.next().value,ht.append(Kt,ft)}return ht},jn.prototype._blob=function(){var ht="----formdata-polyfill-"+Math.random(),yt=[],Kt="--"+ht+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ft,A){return typeof ft=="string"?yt.push(Kt+Xn($(A))+`"\r
\r
`+$(ft)+`\r
`):yt.push(Kt+Xn($(A))+'"; filename="'+Xn(ft.name)+`"\r
Content-Type: `+(ft.type||"application/octet-stream")+`\r
\r
`,ft,`\r
`)}),yt.push("--"+ht+"--"),new Blob(yt,{type:"multipart/form-data; boundary="+ht})},jn.prototype[Symbol.iterator]=function(){return this.entries()},jn.prototype.toString=function(){return"[object FormData]"},Pe&&!Pe.matches&&(Pe.matches=Pe.matchesSelector||Pe.mozMatchesSelector||Pe.msMatchesSelector||Pe.oMatchesSelector||Pe.webkitMatchesSelector||function(ht){for(var yt=(ht=(this.document||this.ownerDocument).querySelectorAll(ht)).length;0<=--yt&&ht.item(yt)!==this;);return-1<yt}),fn&&(jn.prototype[fn]="FormData"),Dt){var Wr=ct.XMLHttpRequest.prototype.setRequestHeader;ct.XMLHttpRequest.prototype.setRequestHeader=function(ht,yt){Wr.call(this,ht,yt),ht.toLowerCase()==="content-type"&&(this.B=!0)},ct.XMLHttpRequest.prototype.send=function(ht){ht instanceof jn?(ht=ht._blob(),this.B||this.setRequestHeader("Content-Type",ht.type),Dt.call(this,ht)):Dt.call(this,ht)}}Mt&&(ct.fetch=function(ht,yt){return yt&&yt.body&&yt.body instanceof jn&&(yt.body=yt.body._blob()),Mt.call(this,ht,yt)}),De&&(ct.navigator.sendBeacon=function(ht,yt){return yt instanceof jn&&(yt=yt._asNative()),De.call(this,ht,yt)}),ct.FormData=jn}})();const ES=()=>{const t=j("AREAS");return t.length===0&&t.push(We.GLOBAL),qi(t).call(t,(e,n,i)=>{const r=l2(n);return r?i===0?r:"".concat(e,",").concat(r):e},"")},l2=t=>t===We.OVERSEA?"".concat(Zi.ASIA,",").concat(Zi.EUROPE,",").concat(Zi.AFRICA,",").concat(Zi.NORTH_AMERICA,",").concat(Zi.SOUTH_AMERICA,",").concat(Zi.OCEANIA):Zi[t],Cb={GLOBAL:{ASIA:[We.CHINA,We.JAPAN,We.INDIA,We.KOREA,We.HKMC],EUROPE:[],NORTH_AMERICA:[We.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Ab=Object.keys(Cb[We.GLOBAL]),FI=[We.CHINA,We.NORTH_AMERICA,We.EUROPE,We.ASIA,We.JAPAN,We.INDIA,We.OCEANIA,We.SOUTH_AMERICA,We.AFRICA,We.KOREA,We.HKMC,We.US],fY=function(t,e){let n=[];if(Ct(t).call(t,We.GLOBAL)){const o=[We.GLOBAL,We.OVERSEA],c=Object.keys(Eb);if(e===We.GLOBAL)throw new rt(k.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===We.CHINA)n=[We.OVERSEA];else if(r=e,Ct(Ab).call(Ab,r)){const l=(i=e,Cb[We.GLOBAL][i]||[]),h=[...o,e,...l];n=c.filter(p=>!Ct(h).call(h,p))}else if(function(l){let h=!1;return Ab.forEach(p=>{var m;Ct(m=Cb[We.GLOBAL][p]).call(m,l)&&(h=!0)}),h}(e)){const l=function(p){let m;return Ab.forEach(S=>{var v;Ct(v=Cb[We.GLOBAL][S]).call(v,p)&&(m=S)}),m}(e),h=[...o,l,e];n=c.filter(p=>!Ct(h).call(h,p))}else n=t;n=function(l){const h=[];return FI.forEach(p=>{Ct(l).call(l,p)&&h.push(p)}),h.concat(l.filter(p=>!Ct(FI).call(FI,p)))}(n)}else n=t;var i,r;return n};function d2(t){var e,n;if(!t&&Ct(e=j("AREAS")).call(e,We.EXTENSIONS))return b.debug("update area from ap : reset"),void GI(bz,!0);if(!Ct(n=j("AREAS")).call(n,We.GLOBAL)||!t)return;let i=Eb.EXTENSIONS;i&&(i={CODE:l2(We.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},b.debug("update area from ap success: ".concat(t,",config is "),i),$e("AREAS",[We.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?$e(r,i[r][0]):$e(r,i[r])}))}function GI(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=qt.reportApiInvoke(null,{name:li.SET_AREA,options:t,tag:Mn.TRACER});try{let i=[];if(typeof t=="string"&&(i=[t]),Array.isArray(t)&&(t.forEach(o=>{if(!Ct(NU).call(NU,o))throw new rt(k.INVALID_PARAMS,"invalid area code")}),i=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:o,excludedArea:c}=t;if(!o)throw new rt(k.INVALID_PARAMS,"area code is needed");let l=o;typeof o=="string"&&(l=[o]),i=c?fY(l,c):l}if(!e){if(Fa.AREAS){const o=new rt(k.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(o),void b.warning("setArea is prohibited because of config-distribute")}if(Ct(i).call(i,We.GLOBAL)&&j("AREAS")===We.EXTENSIONS){const o=new rt(k.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(o),void b.warning("setArea is prohibited because of ap extensions")}}$e("AREAS",i,e);const r=(o=>{const c={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return o.map(l=>{const h=Eb[l],p=Object.keys(h);p&&p.map(m=>{m!=="CODE"&&(c[m]=c[m].concat(h[m]))})}),c})(i);Object.keys(r).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?$e(o,r[o][0]):$e(o,r[o])}),b.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function u2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Jc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?u2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let HI=1;function mY(t,e,n,i,r){HI+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:HI,requestId:HI,version:po,cname:n.cname},c={service_name:e,json_body:JSON.stringify(o)};let l,h,p=t[0];return ja(async()=>{l=Date.now();const m=await Ka(p,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-l,m.code!==0){const y=new rt(k.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:h});throw b.error(y.toString()),y}const S=JSON.parse(m.json_body);if(S.code!==200){const y=new rt(k.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(S.code,", reason: ").concat(S.reason),{code:S.code,responseTime:h});throw b.error(y.toString()),y}if(!S.servers||S.servers.length===0){const y=new rt(k.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:S.code,responseTime:h});throw b.error(y.toString()),y}const v=function(y,P){return{addressList:y.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(P))),workerToken:y.workerToken,vid:y.vid}}(S,e);return j("LIVE_STREAMING_ADDRESS")&&(v.addressList=j("LIVE_STREAMING_ADDRESS")instanceof Array?j("LIVE_STREAMING_ADDRESS"):[j("LIVE_STREAMING_ADDRESS")]),Jc(Jc({},v),{},{responseTime:h})},(m,S)=>(qt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(m.addressList),firstSuccess:S===0,responseTime:h,serverIp:t[S%t.length]}),!1),(m,S)=>(qt.apworkerEvent(n.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:e,responseTime:h,serverIp:t[S%t.length]}),!!(m.code!==k.OPERATION_ABORTED&&m.code!==k.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(p=t[(S+1)%t.length],!0)),r)}let WI=1;function h2(t,e,n,i){let{url:r,areaCode:o}=t;const{clientId:c,sid:l}=e,h=Date.now();let p;const m=e.role,[S,v]=zI(e,o,[ni.CHOOSE_SERVER]);let y=ei.networkState;return ja(async()=>{y&&ei.networkState===bs.OFFLINE&&ei.onlineWaiter&&await At.race([ei.onlineWaiter,Vi(i&&i.maxRetryTimeout||di.maxRetryTimeout)]),y=ei.networkState;const{data:P,headers:I}=await Ka(r,{data:S,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=I.http3==="1"?1:-1,qt.reportResourceTiming(r,l),f2(P,r,e,h,[ni.CHOOSE_SERVER],p);const O=pS(P,ni.CHOOSE_SERVER);return KI(O),kI(O,r)},P=>(P&&qt.joinChooseServer(l,{role:m,lts:h,succ:!0,csAddr:r,opid:v,serverList:P.gatewayAddrs.map(I=>I.address),ec:null,cid:P.cid.toString(),uid:P.uid.toString(),csIp:P.csIp,unilbsServerIds:[ni.CHOOSE_SERVER].toString(),isHttp3:p,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:P.res.detail&&P.res.detail[38]}),!1),P=>P.code!==k.OPERATION_ABORTED&&(P.code===k.CAN_NOT_GET_GATEWAY_SERVER?P.data.retry:(qt.joinChooseServer(l,{role:m,lts:h,succ:!1,csAddr:r,serverList:null,opid:v,ec:P.code,csIp:P.data&&P.data.csIp,unilbsServerIds:[ni.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:y}),isHttp3:p,corssRegionTagReq:e.apRequestDetail}),b.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),P),!0)),i)}function p2(t,e,n,i){let r,{url:o,areaCode:c,serviceIds:l}=t;const h=Date.now(),p=e.role,[m,S]=zI(e,c,l);let v;return ja(async()=>{v&&ei.networkState===bs.OFFLINE&&ei.onlineWaiter&&await At.race([ei.onlineWaiter,Vi(i&&i.maxRetryTimeout||di.maxRetryTimeout)]),v=ei.networkState;const{data:y,headers:P}=await Ka(o,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=P.http3==="1"?1:-1,qt.reportResourceTiming(o,e.sid),f2(y,o,e,h,l,r);const I=pS(y,ni.CHOOSE_SERVER),O=pS(y,e.cloudProxyServer==="proxy5"?ni.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ni.CLOUD_PROXY:ni.CLOUD_PROXY_FALLBACK);return KI(I),{gatewayInfo:kI(I,o),proxyInfo:O,url:o}},y=>(y.gatewayInfo&&qt.joinChooseServer(e.sid,{role:p,lts:h,succ:!0,csAddr:o,serverList:y.gatewayInfo.gatewayAddrs.map(P=>P.address),ec:null,opid:S,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:r,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:y.gatewayInfo.res.detail&&y.gatewayInfo.res.detail[38]}),y.proxyInfo&&qt.joinWebProxyAP(e.sid,{lts:h,sucess:1,apServerAddr:o,turnServerAddrList:y.proxyInfo.addresses.map(P=>P.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:l.toString()}),!1),y=>y.code!==k.OPERATION_ABORTED&&(y.code===k.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(qt.joinWebProxyAP(e.sid,{lts:h,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:y.code,eventType:e.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:v})}),b.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),y),!0)),i)}const f2=(t,e,n,i,r,o)=>{const{sid:c,clientId:l,cloudProxyServer:h}=n,p=[],m=S=>{S.flag===4096?qt.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:S.error.message,csIp:S.error.data&&S.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:o,corssRegionTagReq:n.apRequestDetail}):S.flag!==1048576&&S.flag!==4194304&&S.flag!==4194310||qt.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:S.error.code,eventType:h,unilbsServerIds:r.toString()})};if(t.response_body.forEach(S=>{const v=S.buffer.code;if(S.uri===23&&v===0&&!S.buffer.edges_services)if(S.buffer.flag===4194310)b.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),S.buffer.edges_services=[];else{const y={error:new rt(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:S.buffer.flag};p.push(y),m(y)}if(v!==0){const y=cE(v),P={error:new rt(k.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:t.detail[502]}),flag:S.buffer.flag};S.buffer.flag===4194310?b.warning(P.error.toString()):p.push(P),m(P)}}),p.length)throw b.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(p.map(S=>"flag: ".concat(S.flag,", message: ").concat(S.error.message,", retry: ").concat(S.error.data.retry)).join(" | "))),new rt(k.CAN_NOT_GET_GATEWAY_SERVER,p.map(S=>"flag: ".concat(S.flag,", message: ").concat(S.error.message)).join(" | "),{retry:!!p.find(S=>S.error.data.retry),csIp:t.detail[502],desc:[...new Set(p.map(S=>{var v;return S==null||(v=S.error)===null||v===void 0||(v=v.data)===null||v===void 0?void 0:v.desc}).filter(S=>!!S))]})},KI=t=>{var e,n,i,r;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new rt(k.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(j("AP_AREA")&&((i=t.detail)!==null&&i!==void 0&&i[23]&&typeof((r=t.detail)===null||r===void 0?void 0:r[23])=="string"?d2(t.detail[23].toLowerCase()):d2()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const c=t.detail[19],l=c==null?void 0:c.split(";");for(let h=0;h<l.length;h++){var o;const p=pr(o=l[h]).call(o);t.addresses[h]&&l&&(t.addresses[h].fingerprint=p)}}if(j("GATEWAY_ADDRESS")&&j("GATEWAY_ADDRESS").length>0){b.debug("assign gateway address to",j("GATEWAY_ADDRESS"));const c=j("GATEWAY_ADDRESS").map(l=>{var h,p;const m=(h=(p=t.addresses.find(S=>S.ip===l.ip&&S.port===l.port))===null||p===void 0?void 0:p.fingerprint)!==null&&h!==void 0?h:"";return{ip:l.ip,port:l.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:m}});t.addresses=c}},EY=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const i=cE(n.buffer.code);throw new rt(k.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw b.debug("update ticket request received ap response without response body:",e),new rt(k.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},zI=(t,e,n)=>{const i=Math.floor(Math.random()*1e12),r=t.role==="host"?"1":t.role==="audience"?"2":void 0,o={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Jc(Jc(Jc({6:t.stringUid,11:e,12:j("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};o.request_bodies.forEach(l=>{t.multiIP&&t.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]},_Y=(t,e)=>{const n=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(o=>({ip:o.ip,port:o.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let pE=0;function fE(t){return At.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const _S=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:o}=t,c=0;const l=e;let h,p=0;const m=async()=>{const S=(()=>{const v=c*l,y=v+l;return n.slice(v,y).map(i)})();o&&o.push(...S);try{h=await fE(S)}catch(v){if(p+=l,c++,!(p>=n.length))return void await m();r(v)}S.forEach(v=>v.cancel())};return await m(),h},m2=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:i}=t;const r=e.length;let o=0;const c=async()=>{const l=n(e.shift());try{return await l}catch(h){if(o++,o>=r||i!=null&&i(h))throw h;return c()}};return c()};async function YI(t,e,n,i){return{gatewayInfo:await async function(o,c,l,h){let p=null;const m=[],S=async()=>{const y=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(O=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:ES()})),P=h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),I=await _S({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(b.debug("[".concat(o.clientId,"] Connect to choose_server:"),O.url),h2(O,o,c,l)),allFailedhandler:O=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},P),O[0]},promisesCollector:m});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I},v=async()=>{if(await Vi(1e3),p!==null)return p;const y=j("WEBCS_DOMAIN_BACKUP_LIST").map(O=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:ES()})),P=h.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),I=await _S({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(b.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),O.url),h2(O,o,c,l)),allFailedhandler:O=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},P),O[0]},promisesCollector:m});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I};try{return p=await fE([S(),v()]),m.length&&m.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),p}catch(y){throw y[0]}}(t,e,n,i)}}async function E2(t,e,n,i,r){const o=t.cloudProxyServer;if(o==="disabled"){if(t.useLocalAccessPoint)return await YI(t,e,n,r);if(j("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:v,proxyInfo:y}=await S2(t,e,n,r);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:v};const P=y.map(I=>({turnServerURL:I.address,tcpport:I.tcpport||Ki.tcpport,udpport:I.udpport||Ki.udpport,username:I.username||Ki.username,password:I.password||Ki.password,forceturn:!1,security:!0}));if(r.useP2P){var c;const I=(c=t.uid)!==null&&c!==void 0?c:v.uid,O="glb:".concat(I.toString()),M=await F0(O),U=y.map(W=>({turnServerURL:W.address,tcpport:W.tcpport||Ki.tcpport,udpport:W.udpport||Ki.udpport,username:O,password:M,forceturn:!1,security:!0}));P.push(...U)}return t.turnServer={mode:"manual",servers:P},{gatewayInfo:v}}return await YI(t,e,n,r)}const{proxyInfo:l,gatewayInfo:h}=await S2(t,e,n,r),p={gatewayInfo:h},m=l.map(v=>({turnServerURL:v.address,tcpport:o==="proxy3"?void 0:v.tcpport?v.tcpport:Ki.tcpport,udpport:o==="proxy4"?void 0:v.udpport?v.udpport:Ki.udpport,username:v.username||Ki.username,password:v.password||Ki.password,forceturn:o!=="proxy4",security:o==="proxy5"}));if(r.useP2P){var S;const v=(S=t.uid)!==null&&S!==void 0?S:h.uid,y="glb:".concat(v.toString()),P=await F0(y),I=l.map(O=>({turnServerURL:O.address,tcpport:o==="proxy3"?void 0:O.tcpport||Ki.tcpport,udpport:o==="proxy4"?void 0:O.udpport||Ki.udpport,username:y,password:P,forceturn:o!=="proxy4",security:o==="proxy5"}));m.push(...I)}return t.turnServer={mode:"manual",servers:m},b.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(o)),p}async function _2(t,e,n,i,r){const o=j("ACCOUNT_REGISTER").slice(0,j("AJAX_REQUEST_CONCURRENT"));let c=[];c=e.proxyServer?o.map(h=>"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v1")):o.map(h=>"https://".concat(h,"/api/v1"));const l=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const h=await async function(p,m,S,v,y){const P=Date.now(),I={sid:S.sid,opid:10,appid:S.appId,string_uid:m};let O=p[0];const M=await ja(()=>Ka(O+"".concat(O.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,W)=>{if(U.code===0){if(U.uid<=0||U.uid>=Math.pow(2,32))throw b.error("Invalid Uint Uid ".concat(m," => ").concat(U.uid),U),qt.reqUserAccount(I.sid,{lts:P,success:!1,serverAddr:O,stringUid:I.string_uid,uid:U.uid,errorCode:k.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new rt(k.INVALID_UINT_UID_FROM_STRING_UID);return qt.reqUserAccount(I.sid,{lts:P,success:!0,serverAddr:O,stringUid:I.string_uid,uid:U.uid,errorCode:null,extend:I}),!1}const $=cE(U.code);return $.retry&&(O=p[(W+1)%p.length]),qt.reqUserAccount(I.sid,{lts:P,success:!1,serverAddr:O,stringUid:I.string_uid,uid:U.uid,errorCode:$.desc,extend:I}),$.retry},(U,W)=>U.code!==k.OPERATION_ABORTED&&(qt.reqUserAccount(I.sid,{lts:P,success:!1,serverAddr:O,stringUid:I.string_uid,uid:null,errorCode:U.code,extend:I}),O=p[(W+1)%p.length],!0),y);if(M.code!==0){const U=cE(M.code);throw new rt(k.UNEXPECTED_RESPONSE,U.desc)}return M}(c,t,e,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},l),h.uid}catch(h){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},l),h}}async function gY(t,e,n){const i=j("ACCOUNT_REGISTER");let r=[];r=e.proxyServer?i.map(o=>"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1")):i.map(o=>"https://".concat(o,"/api/v1"));try{return await m2({referenceList:r,asyncMapHandler:c=>async function(l,h,p,m){const S=Date.now(),v={sid:p.sid,opid:10,appid:p.appId,string_uid:h};try{const y=await Ka(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(y.code!==0){const P=cE(y.code);throw new rt(k.UNEXPECTED_RESPONSE,"preload sua error:".concat(P.desc),P)}if(y.uid<=0||y.uid>=Math.pow(2,32))throw new rt(k.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:S,url:l,req:v,uid:y.uid,elapse:Date.now()-S}}catch(y){throw y}}(c,t,e,n),closeFn:c=>c.code===k.OPERATION_ABORTED||c.code===k.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(o){throw o}}async function SY(t,e,n){const i=j("CDS_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(h=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v1"):"https://".concat(h,"/api/v1?action=config")),r=i.map(h=>function(p,m,S,v){const y=Fe(),P={flag:64,cipher_method:0,features:Jc(Jc(Jc(Jc(Jc({install_id:Z0(),device:y.name,system:y.os,system_general:navigator.userAgent,vendor:m.appId,version:po,cname:m.cname,session_id:m.sid,proxyServer:m.proxyServer,sdk_type:uY.WEB_RTC,browser_name:y.name,browser_version:y.version,user_agent:navigator.userAgent,channel_name:m.cname},m.stringUid&&{string_uid:m.stringUid}),m.uid&&{uid:m.uid+""}),y.os&&{os_name:y.os}),y.osVersion&&{os_version:y.osVersion}),{},{detail:""})};return ja(()=>Ka(p,{data:P,timeout:1e3,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,I=>I.code!==k.OPERATION_ABORTED,v)}(h,t,e,n));let o=null,c=null,l={};try{o=await fE(r)}catch(h){if(h.code===k.OPERATION_ABORTED)throw h;c=h}if(r.forEach(h=>h.cancel()),qt.reportApiInvoke(t.sid,{name:li.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:o}}).onSuccess(),o&&o.test_tags)try{l=function(h){if(!h.test_tags)return{};const p=h.test_tags,m=Object.keys(p),S={};return m.forEach(v=>{var y;const P=pr(y=v.slice(4)).call(y),I=JSON.parse(p[v]),O=I[1];S[P]={tag:I[0]||"",value:O}}),S}(o)}catch{}return l}async function g2(t,e){const n=j("WEBCS_DOMAIN").concat(j("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:ES(),serviceIds:[ni.CHOOSE_SERVER,ni.CLOUD_PROXY_FALLBACK]}));try{return await m2({referenceList:n,asyncMapHandler:r=>async function(o,c,l){let h,{url:p,areaCode:m,serviceIds:S}=o;const v=Date.now(),[y,P]=zI(c,m,S);let I=ei.networkState;try{I&&ei.networkState===bs.OFFLINE&&ei.onlineWaiter&&await At.race([ei.onlineWaiter,Vi(di.maxRetryTimeout)]),I=ei.networkState;const{data:O,headers:M}=await Ka(p,{data:y,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=M.http3==="1"?1:-1,(Q=>{const q=[];if(Q.response_body.forEach(ct=>{const _t=ct.buffer.code;if(ct.uri===23&&_t===0&&!ct.buffer.edges_services)if(ct.buffer.flag===4194310)ct.buffer.edges_services=[];else{const Dt={error:new rt(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Q.detail[502]}),flag:ct.buffer.flag};q.push(Dt)}if(_t!==0){const Dt=cE(_t),Mt={error:new rt(k.CAN_NOT_GET_GATEWAY_SERVER,Dt.desc,{desc:Dt.desc,retry:Dt.retry,csIp:Q.detail[502]}),flag:ct.buffer.flag};ct.buffer.flag===4194310?b.warning(Mt.error.toString()):q.push(Mt)}}),q.length)throw new rt(k.CAN_NOT_GET_GATEWAY_SERVER,q.map(ct=>"flag: ".concat(ct.flag,", message: ").concat(ct.error.message)).join(" | "),{retry:!!q.find(ct=>ct.error.data.retry),csIp:Q.detail[502],desc:[...new Set(q.map(ct=>{var _t;return ct==null||(_t=ct.error)===null||_t===void 0||(_t=_t.data)===null||_t===void 0?void 0:_t.desc}).filter(ct=>!!ct))]})})(O);const W=pS(O,ni.CHOOSE_SERVER),$=pS(O,ni.CLOUD_PROXY_FALLBACK);return KI(W),{gatewayInfo:kI(W,p),proxyInfo:$,opid:P,requestTime:v,url:p,isHttp3:h,elapse:Date.now()-v}}catch(O){throw O}}(r,t,e),closeFn:r=>r.code===k.OPERATION_ABORTED||r.code===k.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function S2(t,e,n,i){const r=j("PROXY_SERVER_TYPE3"),o=(y,P,I)=>{let O=I||r;return Array.isArray(O)&&(O=P%2==0?r[1]:r[0]),"https://".concat(O,"/ap/?url=").concat(y)};let c=null;const l=[],h=async()=>{const y=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map((O,M)=>{let U;return U=t.cloudProxyServer==="disabled"&&t.proxyServer?o("".concat(O,"/api/v2/transpond/webrtc?v=2"),M,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):o("".concat(O,"/api/v2/transpond/webrtc?v=2"),M),{url:U,areaCode:ES(),serviceIds:[ni.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?ni.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?ni.CLOUD_PROXY:ni.CLOUD_PROXY_FALLBACK]}}),P=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),I=await _S({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(b.debug("[".concat(t.clientId,"] Connect to choose_server:"),O.url),p2(O,t,e,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},P),O[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I},p=async()=>{if(await Vi(1e3),c!==null)return c;const y=j("WEBCS_DOMAIN_BACKUP_LIST").map((O,M)=>{let U;return U=t.cloudProxyServer==="disabled"&&t.proxyServer?o("".concat(O,"/api/v2/transpond/webrtc?v=2"),M,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):o("".concat(O,"/api/v2/transpond/webrtc?v=2"),M),{url:U,areaCode:ES(),serviceIds:[ni.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?ni.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?ni.CLOUD_PROXY:ni.CLOUD_PROXY_FALLBACK]}}),P=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),I=await _S({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(b.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),O.url),p2(O,t,e,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},P),O[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I};let m,S,v;try{({gatewayInfo:m,proxyInfo:S,url:v}=await fE([h(),p()]))}catch(y){throw y[0]}if(l.length&&l.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!m||!S)throw new rt(k.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=v,t.cloudProxyServer!=="disabled"&&Array.isArray(r)&&v){const y=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1];Ct(r).call(r,y)&&(t.proxyServer=y,b.setProxyServer(y),qt.setProxyServer(y))}return c={gatewayInfo:m,proxyInfo:await HU(S,m.uid)},c}async function TY(t,e,n){const i=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(o=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")),r=i.map(o=>function(c,l,h,p){const m={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:po,cname:l.cname,uid:l.uid.toString(),requestId:WI,seq:WI};WI+=1;const S={service_name:"tele_channel",json_body:JSON.stringify(m)};return ja(async()=>{const v=await Ka(c,{data:S,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(v.code!==0){const P=new rt(k.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw b.error(P.toString()),P}const y=JSON.parse(v.json_body);if(y.code!==200){const P=new rt(k.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw b.error(P.toString()),P}if(!y.servers||y.servers.length===0){const P=new rt(k.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw b.error(P.toString()),P}return{vid:y.vid,workerToken:y.workerToken,addressList:(j("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(P.wss))}},void 0,v=>!!(v.code!==k.OPERATION_ABORTED&&v.code!==k.UNEXPECTED_RESPONSE||v.data&&v.data.retry),p)}(o,t,e,n));try{const o=await fE(r);return r.forEach(c=>c.cancel()),o}catch(o){throw o[0]}}async function vY(t,e,n){let i=null;const r=[],o=async c=>{const l=j(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return c&&(await Vi(1e3),i!==null)?i:await _S({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:h=>(b.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),h),function(p,m,S,v){const[y]=_Y(m,[ni.CHOOSE_SERVER]);let P=ei.networkState;return ja(async()=>{P&&ei.networkState===bs.OFFLINE&&ei.onlineWaiter&&await At.race([ei.onlineWaiter,Vi(v&&v.maxRetryTimeout||di.maxRetryTimeout)]),P=ei.networkState;const I=await Ka(p,{data:y,cancelToken:S,headers:{"Content-Type":"multipart/form-data;"}},!0);return EY(I,p)},()=>!1,I=>I.code!==k.OPERATION_ABORTED&&(I.code===k.UPDATE_TICKET_FAILED?I.data.retry:(b.warning("[".concat(m.clientId,"] update ticket network error, retry"),I),!0)),v)}(h,t,e,n)),allFailedhandler:h=>{throw h[0]},promisesCollector:r})};try{return i=await fE([o(!1),o(!0)]),r.length&&r.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function T2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function qI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?T2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class yY extends On{get isSuccess(){return!!this.configs}constructor(e,n){super(),D(this,"configs",void 0),D(this,"store",void 0),D(this,"joinInfo",void 0),D(this,"cancelToken",void 0),D(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),D(this,"interval",void 0),D(this,"mutex",void 0),D(this,"mutableParamsRead",!1),D(this,"configCache",{}),D(this,"limit_bitrate",void 0),this.mutex=new Qi("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),j("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},j("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,qt.reportApiInvoke(null,{options:void 0,name:li.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Mn.TRACER}).onSuccess(JSON.stringify(Fa))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void b.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await SY(this.joinInfo,this.cancelToken,this.retryConfig),b.debug("[config-distribute] get config distribute",JSON.stringify(e));const i=function(r){var o;const c=jg(o=Object.keys(r).filter(p=>/^webrtc_ng_global_parameter/.test(p))).call(o);for(let p=0;p<c.length;p++)for(let m=c.length-1;m>p;m--){const S=c[m],v=r[S].value;if(typeof v.__priority=="number"){const y=v.__priority,P=c[m-1],I=r[P].value;if(typeof I.__priority=="number"){if(!(y>I.__priority))continue;{const O=S;c[m]=c[m-1],c[m-1]=O}}else{const O=S;c[m]=c[m-1],c[m-1]=O}}}const l=Date.now();let h={};return c.forEach(p=>{const m=r[p].value.__expires;m&&m<=l||(h[p]=r[p])}),h}(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const r=new rt(k.NETWORK_RESPONSE_ERROR,i);b.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){DU(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(dS.UPDATE_BITRATE_LIMIT,e):this.emit(dS.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&qI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},i=Object.keys(e),r=[];i.forEach(o=>{const c=e[o].value;n[o]=c;const l=c.__id;if(l&&this.configCache[o]&&this.configCache[o].__id===l)return;const h=c.__type,p=e[o].value,m=e[o].tag;let S=0;h?h===uM.REALTIME&&(S=1):Object.keys(p).some(v=>Object.prototype.hasOwnProperty.call(nI,v)||!bI()&&Object.prototype.hasOwnProperty.call(qR,v)?(S=1,!0):void 0),r.push({tag:m,isApplied:S,feature:o,params:JSON.stringify(c)})}),r.forEach(o=>{let{tag:c,feature:l,params:h,isApplied:p}=o;this.store.sessionId&&qt.abTest(this.store.sessionId,{intSucc:1,isApplied:p,tag:c,feature:l,params:h,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){b.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(r){const o={};return Object.keys(r).forEach(c=>{const l=r[c].value,h=l.__expires,p=l.__type;Object.keys(l).forEach(m=>{m==="__id"||m==="__type"||m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(o,m)||(o[m]=qI(qI({value:l[m]},h&&{expires:h}),p&&{type:p}))})}),o}(e);try{var i;const r=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,r&&DU(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(l){try{const h=Date.now();Object.keys(l).forEach(p=>{const{value:m,type:S,expires:v}=l[p];v&&v<=h||((S===uM.REALTIME||Object.prototype.hasOwnProperty.call(nI,p))&&(Fa[p]=m,Nn[p]=m,b.debug("Update realtime parameters from config distribute",p,m)),S||bI()||!Object.prototype.hasOwnProperty.call(qR,p)||(Fa[p]=m,Nn[p]=m,b.debug("Update gateway parameters from config distribute",p,m)))})}catch(h){b.error("Error update config immediately: ".concat(l),h.message)}}(n);const o=JSON.stringify(n),c=window.btoa(o);window.localStorage.setItem("websdk_ng_global_parameter",c),b.debug("Caching global parameters ".concat(o))}catch(r){b.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Nn,i)){const{value:r,expires:o}=e[i];if(o&&o<=n)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(Nn[i],r)||(Fa[i]=r,Nn[i]=r,this.emit(dS.UPDATE_CLIENT_ROLE_OPTIONS,r),b.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(n){b.error("Error handling global parameter config:",n.message)}}}class RY extends On{constructor(){super(...arguments),D(this,"resultStorage",new Map)}setLocalAudioStats(e,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(e,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,n){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(e,n,i){if(j("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(i),r.result.length>=5)){var o;const c=Ct(o=r.result).call(o,!0);r.isPrevNormal&&!c&&this.emit("exception",v2[e],e,n),!r.isPrevNormal&&c&&this.emit("exception",v2[e]+2e3,e+"_RECOVER",n),r.isPrevNormal=c,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof mi&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=Cs(n._encoderConfig.frameRate));const r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof mi&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const v2={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},$i=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function y2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function pp(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?y2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class gS{constructor(e){D(this,"store",void 0),D(this,"onStatsException",void 0),D(this,"onUploadPublishDuration",void 0),D(this,"onStatsChanged",void 0),D(this,"localStats",new Map),D(this,"remoteStats",new Map),D(this,"updateStatsInterval",void 0),D(this,"trafficStats",void 0),D(this,"trafficStatsPeerList",[]),D(this,"uplinkStats",void 0),D(this,"exceptionMonitor",void 0),D(this,"p2pChannel",void 0),D(this,"scalabilityMode",YR.L1T1),D(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new RY,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Et.LocalAudioTrack)||pp({},aI)}getLocalVideoTrackStats(){return this.localStats.get(Et.LocalVideoTrack)||pp({},cI)}getRemoteAudioTrackStats(e){const n=(o,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(h=>h.peer_uid===o);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const o=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.audioStats;o&&(i[e]=n(e,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[c,{audioStats:l}]=o;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(e){const n={};if(e){var i;const r=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;r&&(n[e]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[o,{networkStats:c}]=r;c&&(n[o]=c)});return n}getRemoteVideoTrackStats(e){const n=(o,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(h=>h.peer_uid===o);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const o=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.videoStats;o&&(i[e]=n(e,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[c,{videoStats:l}]=o;l&&(i[c]=n(c,l))});return i}getRTCStats(){let e=0,n=0,i=0,r=0;const o=this.localStats.get(Et.LocalAudioTrack);o&&(e+=o.sendBytes,n+=o.sendBitrate);const c=this.localStats.get(Et.LocalVideoTrack);c&&(e+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(Et.LocalVideoLowTrack);l&&(e+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:m,videoStats:S}=p;m&&(i+=m.receiveBytes,r+=m.receiveBitrate),S&&(i+=S.receiveBytes,r+=S.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:n,SendBytes:e,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),o=r!=null&&r.videoSSRC?$i.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,c=r!=null&&r.audioSSRC?$i.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,o>c?o:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&b.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,i){if(!e)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,o=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!o}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case Et.LocalVideoTrack:case Et.LocalVideoLowTrack:{const c=r,l=pp({},cI),h=e.getStats(),p=e.getLocalMedia(i);if(h){const m=h.videoSend.find(S=>S.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(m){const S=e.getLocalVideoSize(),v=e.getEncoderConfig(Et.LocalVideoTrack);m.codec!=="H264"&&m.codec!=="H265"&&m.codec!=="VP8"&&m.codec!=="VP9"&&m.codec!=="AV1X"&&m.codec!=="AV1"||(l.codecType=m.codec),l.sendBytes=m.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,m.inputFrame?(l.captureFrameRate=m.inputFrame.frameRate,l.captureResolutionHeight=m.inputFrame.height,l.captureResolutionWidth=m.inputFrame.width):S&&(l.captureResolutionWidth=S.width,l.captureResolutionHeight=S.height),m.sentFrame?(l.sendFrameRate=m.sentFrame.frameRate,l.sendResolutionHeight=m.sentFrame.height,l.sendResolutionWidth=m.sentFrame.width):S&&(l.sendResolutionWidth=S.width,l.sendResolutionHeight=S.height),m.avgEncodeMs&&(l.encodeDelay=m.avgEncodeMs),v&&v.bitrateMax&&(l.targetSendBitrate=1e3*v.bitrateMax),l.sendPackets=m.packets,l.sendPacketsLost=m.packetsLost,l.sendJitterMs=m.jitterMs,l.sendRttMs=m.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(m)&&(l.totalFreezeTime+=1),m.scalabilityMode&&this.scalabilityMode!==m.scalabilityMode&&(b.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(m.scalabilityMode)),this.scalabilityMode=m.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(i,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,l);break}case Et.LocalAudioTrack:{const c=r,l=pp({},aI),h=e.getStats(),p=e.getLocalMedia(i);if(h){const m=h.audioSend.find(S=>S.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(m){if(m.codec!=="opus"&&m.codec!=="aac"&&m.codec!=="PCMU"&&m.codec!=="PCMA"&&m.codec!=="G722"||(l.codecType=m.codec),m.inputLevel)l.sendVolumeLevel=Math.round(32767*m.inputLevel);else{const S=e.getLocalAudioVolume();S&&(l.sendVolumeLevel=Math.round(32767*S))}l.sendBytes=m.bytes,l.sendPackets=m.packets,l.sendPacketsLost=m.packetsLost,l.sendJitterMs=m.jitterMs,l.sendRttMs=m.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Et.LocalAudioTrack,l),l&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,l);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[o,{videoStats:c,audioStats:l,videoPcStats:h}]=n;const p=l,m=c,S=h,v=pp({},TM),y=pp({},vM),P=pp({},sz),{audioTrack:I,videoTrack:O,audioSSRC:M,videoSSRC:U}=e.getRemoteMedia(o);let W;W=this.store.useP2P?e.getStats(!0):e.getStats();const $=(i=W)===null||i===void 0?void 0:i.audioRecv.find(_t=>_t.ssrc===M),Q=(r=W)===null||r===void 0?void 0:r.videoRecv.find(_t=>_t.ssrc===U),q=this.trafficStats&&this.trafficStats.peer_delay.find(_t=>_t.peer_uid===o);if($&&($.codec!=="opus"&&$.codec!=="aac"&&$.codec!=="PCMU"&&$.codec!=="PCMA"&&$.codec!=="G722"||(v.codecType=$.codec),$.outputLevel?v.receiveLevel=Math.round(32767*$.outputLevel):I&&(v.receiveLevel=Math.round(32767*I.getVolumeLevel())),v.receiveBytes=$.bytes,v.receivePackets=$.packets,v.receivePacketsLost=$.packetsLost,v.receivePacketsDiscarded=$.packetsDiscarded,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.receiveBitrate=p?8*Math.max(0,v.receiveBytes-p.receiveBytes):0,v.totalDuration=p?p.totalDuration+1:1,v.totalFreezeTime=p?p.totalFreezeTime:0,v.freezeRate=v.totalFreezeTime/v.totalDuration,v.receiveDelay=$.jitterBufferMs,v.totalDuration>10&&gS.isRemoteAudioFreeze(I)&&(v.totalFreezeTime+=1)),Q){var ct;Q.codec!=="H264"&&Q.codec!=="H265"&&Q.codec!=="VP8"&&Q.codec!=="VP9"&&Q.codec!=="AV1X"&&Q.codec!=="AV1"||(y.codecType=Q.codec),y.receiveBytes=Q.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,y.renderFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,Q.outputFrame&&(y.renderFrameRate=Q.outputFrame.frameRate),Q.receivedFrame?(y.receiveFrameRate=Q.receivedFrame.frameRate,y.receiveResolutionHeight=Q.receivedFrame.height,y.receiveResolutionWidth=Q.receivedFrame.width):O&&(y.receiveResolutionHeight=O._videoHeight||0,y.receiveResolutionWidth=O._videoWidth||0),Q.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round(Q.framesRateFirefox)),y.receivePackets=Q.packets,y.receivePacketsLost=Q.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost);const _t=m?m.totalFreezeTime:0,Dt=m?m.totalDuration:0;y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=(ct=Q.totalFreezesDuration)!==null&&ct!==void 0?ct:_t||0,y.receiveDelay=Q.jitterBufferMs||0;const Mt=!!U&&e.getRemoteVideoIsReady(U);Q.totalFreezesDuration===void 0&&O&&Mt&&gS.isRemoteVideoFreeze(O,Q,S)&&(y.totalFreezeTime+=1),y.freezeRate=Math.max(0,Math.min((y.totalFreezeTime-_t)/(y.totalDuration-Dt),1))}q&&(v.end2EndDelay=q.B_ad,y.end2EndDelay=q.B_vd,v.transportDelay=q.B_ed,y.transportDelay=q.B_ed,v.currentPacketLossRate=q.B_ealr4/100,y.currentPacketLossRate=q.B_evlr4/100,P.uplinkNetworkQuality=q.B_punq?q.B_punq:0,P.downlinkNetworkQuality=q.B_pdnq?q.B_pdnq:0),this.remoteStats.set(o,{audioStats:v,videoStats:y,videoPcStats:Q,networkStats:P}),I&&this.exceptionMonitor.setRemoteAudioStats(I,v),O&&this.exceptionMonitor.setRemoteVideoStats(O,y)})}}class R2{constructor(){D(this,"destChannelMediaInfos",new Map),D(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){OU(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){OU(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){pb(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function b2(t){if(!(t instanceof R2))return new rt(k.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new rt(k.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new rt(k.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class fu{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){D(this,"uid",void 0),D(this,"_uintid",void 0),D(this,"_trust_in_room_",!0),D(this,"_trust_audio_enabled_state_",!0),D(this,"_trust_video_enabled_state_",!0),D(this,"_trust_audio_mute_state_",!0),D(this,"_trust_video_mute_state_",!0),D(this,"_audio_muted_",!1),D(this,"_video_muted_",!1),D(this,"_audio_enabled_",!0),D(this,"_video_enabled_",!0),D(this,"_audio_added_",!1),D(this,"_video_added_",!1),D(this,"_is_pre_created",!1),D(this,"_video_pre_subscribed",!1),D(this,"_audio_pre_subscribed",!1),D(this,"_trust_video_stream_added_state_",!0),D(this,"_trust_audio_stream_added_state_",!0),D(this,"_audioTrack",void 0),D(this,"_videoTrack",void 0),D(this,"_dataChannels",[]),D(this,"_audioSSRC",void 0),D(this,"_videoSSRC",void 0),D(this,"_audioOrtc",void 0),D(this,"_videoOrtc",void 0),D(this,"_cname",void 0),D(this,"_rtxSsrcId",void 0),D(this,"_videoMid",void 0),D(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function C2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function A2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?C2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const SS="9",w2=4e4;let bY=class{get localCapabilities(){return Vn(this._localCapabilities)}get rtpCapabilities(){return Vn(this._rtpCapabilities)}get candidates(){return Vn(this._candidates)}get iceParameters(){return Vn(this._iceParameters)}get dtlsParameters(){return Vn(this._dtlsParameters)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];D(this,"sessionDesc",void 0),D(this,"_localCapabilities",void 0),D(this,"_rtpCapabilities",void 0),D(this,"_candidates",void 0),D(this,"_originCandidates",void 0),D(this,"_iceParameters",void 0),D(this,"_isUseExtmapAllowMixed",void 0),D(this,"_dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname",void 0),D(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=e,t=Vn(t);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:o,setup:c,localCapabilities:l,cname:h}=t;this._rtpCapabilities=o,this._candidates=r,this._originCandidates=Vn(r),this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=l,this.setup=c,this.cname=h,this.sessionDesc=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(t){const e=this.candidates,n=this.dtlsParameters,i=this.iceParameters,r=this.rtpCapabilities.send;let o=this.sessionDesc.mediaDescriptions.length-1;for(let c=1;c<t;c++){const l=2*c+2e4,h=2*c+w2,{ssrcs:p,ssrcGroups:m}=up([{ssrcId:l}],this.cname),{ssrcs:S,ssrcGroups:v}=up([{ssrcId:h,rtx:j("USE_SUB_RTX")?h+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:SS,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.videoCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:e,extmaps:r.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:r.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:SS,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.audioCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:e,extmaps:r.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:r.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return cu(this.sessionDesc)}send(t,e,n,i){const{ssrcs:r,ssrcGroups:o}=up(e,this.cname,j("SYNC_GROUP")?n:void 0),c=this.findPreloadMediaDesc(r);if(c){if(Un()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){const l=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const l=this.findAvailableMediaIndex(t,r);let h;return l===-1||l===1&&(Gi()||function(){const p=Fe();return!(p.name!==Ye.CHROME||!p.osVersion)&&Number(p.version)<=90}()||j("ENABLE_ENCODED_TRANSFORM")&&Kl())||l===0&&j("USE_SUB_RTX")||M1()?(h=this.createOrRecycleSendMedia(t,r,o,"sendonly",i),this.updateBundleMids()):(h=Vn(this.sessionDesc.mediaDescriptions[l]),h.attributes.direction="sendonly",h.attributes.ssrcs=r,h.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(h,i)),Un()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,h.attributes.mid),{mid:h.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t,needExchangeSDP:e}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:e}}batchSend(t){const e=t.map(r=>{let{kind:o,ssrcMsg:c,mslabel:l}=r;return this.send(o,c,l)}),n=[];let i=!1;return e.forEach(r=>{let{mid:o,needExchangeSDP:c}=r;c&&(i=!0),n.push(o)}),{mids:n,needExchangeSDP:i}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.mid==="0"||Un()||M1()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(t){const e=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t);if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));e.attributes.direction="inactive"}unmute(t){const e=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t);if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));e.attributes.direction="sendonly"}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Ct(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Ct(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}receive(t,e,n,i){t.forEach((r,o)=>{this.createOrRecycleRecvMedia(r,[],"recvonly",e,n,i[o])}),this.updateBundleMids()}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(t){const e=this.sessionDesc||rs((n=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=t;const i=this.rtpCapabilities.send,r=this.localCapabilities.send;for(const o of e.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,o.media.mediaType==="application"&&(o.attributes.sctpPort="5000"),o.media.mediaType==="video"){if(i.videoCodecs.length===0){const c=r.videoCodecs.filter(l=>{var h,p;return(h=l.rtpMap)===null||h===void 0?void 0:Ct(p=h.encodingName.toLowerCase()).call(p,"vp8")})||[r.videoCodecs[0]];o.media.fmts=c.map(l=>l.payloadType.toString(10)),o.attributes.payloads=c,o.attributes.extmaps=[]}else if(o.media.fmts=i.videoCodecs.map(c=>c.payloadType.toString(10)),o.attributes.payloads=i.videoCodecs,o.attributes.extmaps=i.videoExtensions,j("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:c,ssrcGroups:l}=up([{ssrcId:w2,rtx:j("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=c,o.attributes.ssrcGroups=l}}if(o.media.mediaType==="audio"){if(i.audioCodecs.length===0){const c=r.audioCodecs.filter(l=>{var h,p;return(h=l.rtpMap)===null||h===void 0?void 0:Ct(p=h.encodingName.toLowerCase()).call(p,"opus")})||[r.audioCodecs[0]];o.media.fmts=c.map(l=>l.payloadType.toString(10)),o.attributes.payloads=c,o.attributes.extmaps=[]}else if(o.media.fmts=i.audioCodecs.map(c=>c.payloadType.toString(10)),o.attributes.payloads=i.audioCodecs,o.attributes.extmaps=i.audioExtensions,hE(o),j("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:c,ssrcGroups:l}=up([{ssrcId:2e4}],this.cname);o.attributes.ssrcs=c,o.attributes.ssrcGroups=l}}}return this.sessionDesc=e,this.currentMidIndex=e.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(t){const e=this._originCandidates.filter(i=>i.transport==="udp"),n=[];if(e.forEach(i=>{n.push(A2(A2({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),e.length!==0){switch(t){case or.TCP_RELAY:this._candidates=n;break;case or.UDP_TCP_RELAY:case or.RELAY:this._candidates=[...e,...n];break;default:this._candidates=e}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=Vn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}findAvailableMediaIndex(t,e){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===t&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(Un()){if(i){const r=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(r||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!r||r!==n.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const t="".concat(this.currentMidIndex),e={media:{mediaType:"application",port:SS,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(e),{mediaDesc:e,needExchangeSDP:!0}}createOrRecycleRecvMedia(t,e,n,i,r,o){const c=t._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,h=mS(c,l,this.localCapabilities.send,c===Vt.VIDEO?i:r),p=c===Vt.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let S={media:{mediaType:c,port:SS,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};S=this.mungRecvMediaDsec(S,t,o);const v=this.findFirstClosedMedia(c);if(v){const y=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[y]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}updateRemoteCodec(t,e,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(S=>S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"").filter(S=>{var v;return Ct(v=Object.keys(XR)).call(v,S)}))],r=new Set(e);if(i.every(S=>r.has(S)))return b.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(e)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter(S=>e.some(v=>{var y;return Ct(y=S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"").call(y,v)}));if(o.length===0)return b.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(e)),!1;const c=[...new Set(o.map(S=>S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||""))];let l;if(b.debug("updateRemoteCodec, from ".concat(i," to ").concat(c)),t.length===0)l=this.sessionDesc.mediaDescriptions.filter(S=>S.media.mediaType==="video"&&S.attributes.direction==="recvonly");else if(l=this.sessionDesc.mediaDescriptions.filter(S=>S.attributes.mid&&Ct(t).call(t,S.attributes.mid)&&S.attributes.direction==="recvonly"),l.length!==t.length)return b.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(e)),!1;if(j("USE_PUB_RTX")||j("USE_SUB_RTX")){const S=VI(o,this.rtpCapabilities.recv.videoCodecs);o.push(...S)}this._rtpCapabilities.recv.videoCodecs=o;const h=this.localCapabilities.send,p=this.rtpCapabilities.recv,m=mS(Vt.VIDEO,p,h,n);return l.forEach(S=>{const v=m.map(y=>y.payloadType.toString(10));b.debug("updateRemoteCodec mid: ".concat(S.attributes.mid,", from"),S.attributes.payloads,"to",m),S.attributes.payloads=m,S.media.fmts=v}),!0}createOrRecycleSendMedia(t,e,n,i,r){const o=this.rtpCapabilities.send,c=t===Vt.VIDEO?o.videoCodecs:o.audioCodecs,l=t===Vt.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const h="".concat(this.currentMidIndex);let p={media:{mediaType:t,port:SS,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungSendMediaDesc(p,r);const m=this.findFirstClosedMedia(t);if(m){const S=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[S]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,e,n){const i=Vn(t);return xI(i),uE(i,e),UI(i,e),QU(i),vb(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=Vn(t);return vb(n,e,this.localCapabilities.recv),hE(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>Un()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}getSSRC(t){var e;return(e=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t))===null||e===void 0?void 0:e.attributes.ssrcs}};function I2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function td(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?I2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var mE=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(mE||{});const wb=new Map;function O2(t,e,n,i){let{scale:r}=t;if(r===0&&i===mE.UP||r>=e.length-1&&i===mE.DOWN)return t;let o=td(td({},t),{},{scale:i===mE.DOWN?++r:--r});switch(n){case"maintain-framerate":o=td(td({},o),e[r].motion);break;case"maintain-resolution":o=td(td({},o),e[r].detail);break;case"balanced":o=td(td({},o),e[r].balanced)}return o}function N2(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:D2(e)};wb.set(t,n)}else wb.delete(t)}function D2(t){const e=td({},t),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:o}=e,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:h,BITRATE_MIN_THRESHOLD:p,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:S,BWE_SCALE_DOWN_THRESHOLD:v,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:P,BALANCE_BITRATE_FACTOR:I,BALANCE_FRAMERATE_FACTOR:O,BALANCE_RESOLUTION_FACTOR:M,MOTION_RESOLUTION_FACTOR:U,MOTION_BITRATE_FACTOR:W,DETAIL_FRAMERATE_FACTOR:$,DETAIL_BITRATE_FACTOR:Q}=tI,q=Math.min(e.frameRate,l),ct=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(v,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(y,1)*q),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o}}];for(let _t=1;_t<=h;_t++){const Dt={bwe_up:Math.round(Math.pow(S,_t)*n),bwe_down:Math.round(Math.pow(v,_t+1)*n),fps_up:Math.round(Math.pow(P,_t)*q),fps_down:Math.round(Math.pow(y,_t+1)*q)},Mt={scaleResolutionDownBy:r/Math.pow(M,_t),frameRate:Math.max(Math.round(Math.pow(O,_t)*i),c),bitrateMax:Math.max(Math.round(Math.pow(I,_t)*n),m),bitrateMin:Math.max(Math.round(Math.pow(I,_t)*o),p)},De={scaleResolutionDownBy:r/Math.pow(U,_t),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(W,_t)*n),m),bitrateMin:Math.max(Math.round(Math.pow(W,_t)*o),p)},Pe={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow($,_t)*i),c),bitrateMax:Math.max(Math.round(Math.pow(Q,_t)*n),m),bitrateMin:Math.max(Math.round(Math.pow(Q,_t)*o),p)};ct.push({scale:_t,threshold:Dt,balanced:Mt,motion:De,detail:Pe})}return ct}function CY(t,e,n,i,r,o){const c=wb.get(t)||{overUse:0,underUse:0,adaptationList:D2(r)},{adaptationList:l}=c;wb.set(t,c);const{OVERUSE_TIMES_THRESHOLD:h,UNDERUSE_TIMES_THRESHOLD:p}=tI,{scale:m}=i;let S,v;return typeof e=="number"&&e>0&&function(y,P,I,O){if(P>=I.length)return!1;let{threshold:{fps_down:M}}=I[P];return j("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(M=I[0].threshold.fps_down),y<M}(e,m,l,o)&&(c.overUse++,v=rS.CPU,c.overUse>h)||typeof n=="number"&&n>0&&function(y,P,I){if(P>=I.length)return!1;const{threshold:{bwe_down:O}}=I[P];return y<O}(n,m,l)&&(c.overUse++,v=rS.BANDWIDTH,c.overUse>h)?(c.overUse=0,c.underUse=0,S=O2(i,l,o,mE.DOWN),[S,v]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(y,P,I,O){if(P===0)return;let{threshold:{fps_up:M}}=I[P];return j("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(M=I[1].threshold.fps_up),y>M}(e,m,l,o)&&function(y,P,I){if(P===0)return;const{threshold:{bwe_up:O}}=I[P];return y>O}(n,m,l)&&(c.underUse++,c.underUse>p&&(c.overUse=0,c.underUse=0,S=O2(i,l,o,mE.UP),S.scale===0&&(v=rS.NONE))),[S,v])}function P2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function XI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?P2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function AY(t){var e;return!!j("ENABLE_AG_ADAPTATION")&&!!(t instanceof _I||Ct(e=t._hints).call(e,pn.CUSTOM_TRACK))&&(!!j("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const i=Fe();if(i.os!==Ri.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return Number(r[0])>=n}(14)&&L1(17,4)||P1(14)&&k1(17,4,!0)))}const Ib=new Map;function Ob(t,e){const n=Ib.get(t);if(n){const{timer:i}=n;window.clearTimeout(i),Ib.delete(t)}e.qualityLimitationReason=rS.NONE,N2(t)}function wY(t,e){var n;let i;switch(e){case Et.LocalAudioTrack:i=Qe.Audio;break;case Et.LocalVideoTrack:i=Ct(n=t._hints).call(n,pn.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Et.LocalVideoLowTrack:i=Qe.Low}return i}function JI(t){const e=Ge();if(t.some(n=>n._bypassWebAudio))throw new at(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new at(k.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function QI(t,e){JI(t);const n=new mi;return t.forEach(i=>n.addAudioTrack(i)),n}const IY=!Ge().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&zl();function Nb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return IY?(n={spec:e,store:t},pu("PlanBConnection").create(n)):new ed(e,t)}function ZI(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function L2(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(eS(t.turnServer.servers))return!1;if(j("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var Me;function k2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function za(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?k2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let ed=(Me=class WS extends LU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return Ct(n=Object.keys(XR)).call(n,e)}))]}constructor(e,n){super(e,n),D(this,"id",hn(5,"connection-")),D(this,"store",void 0),D(this,"peerConnection",void 0),D(this,"forceTurn",!1),D(this,"remoteSDP",void 0),D(this,"initialOffer",void 0),D(this,"transportEventReceiver",void 0),D(this,"statsFilter",void 0),D(this,"extension",{useXR:j("USE_XR")}),D(this,"localCapabilities",void 0),D(this,"remoteCodecs",void 0),D(this,"localCandidateCount",0),D(this,"allCandidatesReceived",!1),D(this,"isPreallocation",!1),D(this,"preSSRCMap",new Map),D(this,"dataStreamChannelMap",new Map),D(this,"establishPromise",void 0),D(this,"recoveredDataChannelIds",[]),D(this,"currentDataChannelId",1),D(this,"supportAV1RtpSpec",!1),D(this,"mutex",void 0),D(this,"qualityLimitationReason",rS.NONE),this.store=n,this.forceTurn=L2(e),this.mutex=new Qi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(WS.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=Q0(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Un()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void b.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();r==null||r(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else b.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=hu(i.sdp),o=await $U({filterRTX:!j("USE_PUB_RTX")&&!j("USE_SUB_RTX"),filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterVideoCodec:j("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=yb(o),this.initialOffer=i,j("ENABLE_SVC")&&this.store.codec=="av1"){const l=await async function(){try{const h=new RTCPeerConnection;h.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:YR.L1T3}]});const p=await h.createOffer();if(!p.sdp)return void h.close();const m=rs(p.sdp).mediaDescriptions[0];if(!m)return;const S=m.attributes.extmaps.find(v=>v.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return h.close(),S}catch{return}}();var e;l&&(this.supportAV1RtpSpec=!0,(e=o.send)===null||e===void 0||e.videoExtensions.push(l))}let c;return i.sdp&&i2(i.sdp)&&(c=Vn(o),(n=c).send&&(dE(Vt.VIDEO,n.send.videoExtensions),dE(Vt.AUDIO,n.send.audioExtensions)),n.recv&&(dE(Vt.VIDEO,n.recv.videoExtensions),dE(Vt.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(dE(Vt.VIDEO,n.sendrecv.videoExtensions),dE(Vt.AUDIO,n.sendrecv.audioExtensions))),za(za({},r),{},{rtpCapabilities:c||o,offerSDP:i.sdp})}catch(i){throw new at(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&i2(this.initialOffer.sdp)&&(n=e.rtpCapabilities,i=this.localCapabilities,n.send&&(Sb(Vt.VIDEO,n.send.videoExtensions,i.send.videoExtensions),Sb(Vt.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(Sb(Vt.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),Sb(Vt.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new bY(za(za({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),o=e2(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),j("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(j("PRELOAD_MEDIA_COUNT"));const p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const m=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(m)}const{preSSRCs:h}=e;if(Array.isArray(h)&&h.length>0){const{mids:p}=this.remoteSDP.batchSend(h.map(m=>({kind:m.kind,ssrcMsg:[{ssrcId:m.ssrcId,rtx:m.rtx}],mslabel:m.mslabel})));p.forEach((m,S)=>{this.preSSRCMap.set(h[S].ssrcId,m)}),await Rb(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:i}=e;if(Array.isArray(i)&&i.length>0){const{mids:r}=this.remoteSDP.batchSend(i.map(o=>Object.assign({},{kind:o.kind,ssrcMsg:[{ssrcId:o.ssrcId,rtx:o.rtx}],mslabel:o.mslabel})));r.forEach((o,c)=>{this.preSSRCMap.set(i[c].ssrcId,o)})}await Rb(this.peerConnection,this.remoteSDP,this.extension),b.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return ho(function*(){const o=yield Ue(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=gb();e.forEach(O=>{const M=r.peerConnection.addTransceiver(O._mediaStreamTrack,za({direction:"sendonly"},O.trackMediaType==="video"&&r.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(M),O._updateRtpTransceiver(M)}),Un()&&j("SIMULCAST")===!0&&(yield Ue(r.applySimulcastForFirefox(c,e)));const h=yield Ue(r.peerConnection.createOffer()),p=r.remoteSDP.predictReceivingMids(e.length),m=r.mungSendOfferSDP(h.sdp,e,p),S=rs(m),v=p.map(O=>{const M=S.mediaDescriptions.find(U=>U.attributes.mid===O);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return qU(M,j("USE_PUB_RTX"))});let y;try{y=yield v}catch(O){y=[],r.remoteSDP.receive(e,n,i,y);const M=r.remoteSDP.toString();throw yield Ue(r.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Ue(r.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield Ue(r.stopSending(p,!0)),O}r.remoteSDP.receive(e,n,i,y);const P=r.remoteSDP.toString(),I=r.logSDPExchange(m,"offer","local","send");return yield Ue(r.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Ue(r.applySimulcastEncodings(c,e)),yield Ue(r.applySendEncodings(c,e)),I==null||I(P),yield Ue(r.peerConnection.setRemoteDescription({type:"answer",sdp:P})),c.map((O,M)=>{const U=p[M];return{localSSRC:v[M],id:U,transceiver:O}})}catch(c){throw c instanceof at?c:new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")b.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const o=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:o,negotiated:!0,ordered:!1,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}n.forEach(o=>{o._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),b.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else b.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof at?i:new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof at?n:new at(k.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(h=>e.indexOf(h.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(h=>{var p;Ob(this.id+h.mid,this),h.direction="inactive",(p=h.stop)===null||p===void 0||p.call(h)});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);c&&(await Rb(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const l=this.peerConnection.getTransceivers().find(h=>h.mid===o);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:o,transceiver:l}}catch(o){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await Rb(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const o=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:r,transceiver:o}})}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(o=>{Array.from(this.preSSRCMap.entries()).some(c=>{let[l,h]=c;if(h===o)return this.preSSRCMap.delete(l),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const o=this.remoteSDP.toString();r==null||r(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const o=this.remoteSDP.toString();r==null||r(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return ho(function*(){const i=yield Ue(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Ge().supportPCSetConfiguration,o=j("FORCE_TURN_TCP")||n.forceTurn;if(e===or.RELAY&&!r)return;if(r&&!o){const S=e===or.RELAY?"relay":"all",v=n.peerConnection.getConfiguration();v.iceTransportPolicy!==S&&(b.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(S,"]")),v.iceTransportPolicy=S,n.peerConnection.setConfiguration(v))}n.remoteSDP.updateCandidates(e);const c=yield Ue(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=hu(c.sdp),{remoteIceParameters:h}=yield l.iceParameters;n.remoteSDP.restartICE(h);const p=n.remoteSDP.toString(),m=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Ue(n.peerConnection.setLocalDescription(c)),m==null||m(p),yield Ue(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(r){b.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{Ob(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return za(za({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const o=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new at(k.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?Un()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:za(za({},Kc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:za(za({},Kc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"";b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(e.url||"",", host_candidate:").concat(r)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(eS(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...WS.turnServerConfigToIceServers(e.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...WS.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&Ge().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(lE(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!j("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var o;r&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:o}=i.getSelectedCandidatePair();b.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(O=>O.track===e._mediaStreamTrack)),!n)return b.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return b.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ge().supportSetRtpSenderParameters)return b.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},c={};switch(e._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;case"balanced":o.degradationPreference="balanced"}const l=function(I,O){return I.getTransceivers().find(M=>M.sender.track===O||M.receiver.track===O)}(this.peerConnection,e._mediaStreamTrack),h=dz(e);if(AY(e)&&l&&n&&h&&this.getLocalVideoStats&&Ct(i=["vp8","vp9"]).call(i,this.store.codec)){var p;const I=o.degradationPreference||(Ct(p=e._hints).call(p,pn.CUSTOM_TRACK)?j("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(O,M,U,W,$,Q){if(Ob(O,U),$(M),W!=="balanced"&&W!=="maintain-framerate"&&W!=="maintain-resolution")return;let q=-1;N2(O,M);const ct=window.setInterval(()=>{const Dt=Ib.get(O);if(!j("ENABLE_AG_ADAPTATION")||!Dt)return Ob(O,U),void $(M);const Mt=Q();if(Mt.sendPackets>0&&Mt.OutgoingAvailableBandwidth>0){if(q===-1)return void(q=Date.now());if(Date.now()-q<1e3)return;const De=Mt.sendFrameRate,Pe=Mt.OutgoingAvailableBandwidth,[fn,Xn]=CY(O,De,Pe,Dt.adaptationConfig,M,W);Xn&&(U.qualityLimitationReason=Xn),fn&&Dt.adaptationConfig.scale!==fn.scale&&(b.debug("[".concat(O,"] applyAdaptation: ").concat(U.qualityLimitationReason,`
           sendFps `).concat(De,", bwe ").concat(Pe,", switch from ").concat(Dt.adaptationConfig.scale," to ").concat(fn.scale," ")),Dt.adaptationConfig=XI(XI({},Dt.adaptationConfig),fn),$(fn))}},j("CHECK_LOCAL_STATS_INTERVAL")),_t=XI({},M);Ib.set(O,{timer:ct,adaptationConfig:_t,originConfig:M,adaptationFunc:$}),b.debug("[".concat(O,"] start adaptation, originConfig: ").concat(JSON.stringify(M),", degradationPreference: ").concat(W))})(this.id+l.mid,h,this,I,O=>{n&&this.updateAdaptation(n,O)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var m;const{bitrateMax:I,frameRate:O,scaleResolutionDownBy:M}=e._encoderConfig;I&&(c.maxBitrate=1e3*I),(Ct(m=e._hints).call(m,pn.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(O&&(c.maxFramerate=Cs(O)),M&&M>=1&&(c.scaleResolutionDownBy=M))}const{maxFramerate:S}=j("ENCODER_CONFIG_LIMIT");if(S&&typeof S=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,S):S),j("DSCP_TYPE")&&zl()){var v;const I=j("DSCP_TYPE");Ct(v=["very-low","low","medium","high"]).call(v,I)&&(c.networkPriority=I)}const y=n.getParameters(),P=(r=y.encodings)===null||r===void 0?void 0:r[0];Un()&&!P&&(o.encodings=[c]),P&&Object.assign(P,c),Object.assign(y,o),b.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await n.setParameters(y),await async function(I,O,M){try{var U;if(!Ge().supportSetRtpSenderParameters||!function(ct){return ct==="vp9"||ct==="av1"}(I)||!j("ENABLE_SVC"))return;const W={},$={},Q=O.getParameters(),q=(U=Q.encodings)===null||U===void 0?void 0:U[0];$.scalabilityMode=gb(M),q&&Object.assign(q,$),Object.assign(Q,W),await O.setParameters(Q),b.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Q.encodings)))}catch(W){b.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",W)}}(this.store.codec,n,j("SVC_MODE"))}async updateAdaptation(e,n){var i,r;if(!e)return b.debug("[updateAdaptation] no rtpSender found");if(!Ge().supportSetRtpSenderParameters)return b.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const o={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:h}=n;c&&(o.maxBitrate=1e3*c),l&&(o.maxFramerate=Cs(l)),h&&h>=1&&Ct(i=["vp8","vp9"]).call(i,this.store.codec)&&(o.scaleResolutionDownBy=h);const p=e.getParameters(),m=(r=p.encodings)===null||r===void 0?void 0:r[0];m&&Object.assign(m,o),Object.assign(p,{});try{await e.setParameters(p),b.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(p.encodings)))}catch(S){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?b.debug("[updateAdaptation] peerConnection not connected}"):b.debug("[updateAdaptation] updateRtpSenderEncodings failed",S):b.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!Ge().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],o=n[i];o instanceof vn&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,r.sender)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=rs(e);return n.forEach((o,c)=>{const l=i[c],h=r.mediaDescriptions.find(p=>p.attributes.mid===l);h&&(uE(h,o),ZU(h,o,this.store.codec))}),cu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let h=0;h<e.length;h++){var i,r,o,c,l;const p=e[h],m=n[h];if(m instanceof vn&&!Ct(i=m._hints).call(i,pn.LOW_STREAM)&&(r=m._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=m._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=m._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=m._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const S={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,S))}}}async applySimulcastEncodings(e,n){if(!Un()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof vn&&this.isVP8Simulcast(r)){const o=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const h=o.sender.getParameters();await o.sender.setParameters(Object.assign(h,c))}}}isVP8Simulcast(e){var n,i,r,o,c;return!!(e instanceof vn&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Ct(n=e._hints).call(n,pn.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(o=e._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(j("SDP_LOGGING"))return b.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?o=>{this.logSDPExchange(o,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(Ge().supportPCSetConfiguration){const n=WS.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Wt(Me.prototype,"updateRemoteRTPCapabilities",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"updateRemoteRTPCapabilities"),Me.prototype),Wt(Me.prototype,"connect",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"connect"),Me.prototype),Wt(Me.prototype,"updateRemoteConnect",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"updateRemoteConnect"),Me.prototype),Wt(Me.prototype,"createDataChannels",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"createDataChannels"),Me.prototype),Wt(Me.prototype,"receive",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"receive"),Me.prototype),Wt(Me.prototype,"batchReceive",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"batchReceive"),Me.prototype),Wt(Me.prototype,"stopReceiving",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"stopReceiving"),Me.prototype),Wt(Me.prototype,"muteRemote",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"muteRemote"),Me.prototype),Wt(Me.prototype,"unmuteRemote",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"unmuteRemote"),Me.prototype),Wt(Me.prototype,"muteLocal",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"muteLocal"),Me.prototype),Wt(Me.prototype,"unmuteLocal",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"unmuteLocal"),Me.prototype),Wt(Me.prototype,"close",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"close"),Me.prototype),Wt(Me.prototype,"updateEncoderConfig",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"updateEncoderConfig"),Me.prototype),Wt(Me.prototype,"updateSendParameters",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"updateSendParameters"),Me.prototype),Wt(Me.prototype,"replaceTrack",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"replaceTrack"),Me.prototype),Wt(Me.prototype,"updateAdaptation",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"updateAdaptation"),Me.prototype),Wt(Me.prototype,"getRemoteSSRC",[Fr],Object.getOwnPropertyDescriptor(Me.prototype,"getRemoteSSRC"),Me.prototype),Me);function Fr(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,o=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await i.apply(this,l)}finally{o()}},n}function $I(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=Cs(e.width),i.height=Cs(e.height);const r=Cs(e.framerate||15);document.body.append(n),document.body.append(i);let o=t._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const c=i.getContext("2d");if(!c)throw new rt(k.UNEXPECTED_ERROR,"can not get canvas context");const l=Ge(),h=i.captureStream(l.supportRequestFrame?0:r).getVideoTracks()[0];h.canvas||(h.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const m=n.videoWidth,S=n.videoHeight/m,v=i.width*S;Math.abs(v-i.height)>=2&&(b.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(v)),i.height=v)}c.drawImage(n,0,0,i.width,i.height),h.requestFrame&&h.requestFrame(),o!==t._mediaStreamTrack&&(o=t._mediaStreamTrack,n.srcObject=new MediaStream([o]))},i.stopCapture=uI(()=>i.startCapture&&i.startCapture(),r);const p=h.stop;return h.stop=()=>{p.call(h),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),b.debug("clean low stream renderer")},h}var Db=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(Db||{}),ii=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(ii||{}),fp=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(fp||{}),ri=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(ri||{}),mp=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(mp||{}),M2=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(M2||{}),Qc=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(Qc||{}),os=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t}(os||{}),x2=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(x2||{}),Gr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Gr||{}),Pb=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(Pb||{});const Lb=1e3,OY=Math.max(6,3);function oe(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function U2(t){const e={[Gr.CONN_TYPE]:0,[Gr.RTT]:t.rtt,[Gr.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[Gr.CONN_TYPE]=1),n==="tcp"&&(e[Gr.CONN_TYPE]=3),n==="tls"&&(e[Gr.CONN_TYPE]=4);break}case"srflx":e[Gr.CONN_TYPE]=2;break;case"unknown":e[Gr.CONN_TYPE]=5;break;default:e[Gr.CONN_TYPE]=0}return e}function V2(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class B2 extends On{constructor(e){super(),D(this,"store",void 0),D(this,"uploadWRTCStatsTimer",void 0),D(this,"uploadOutboundDenoiserStatsTimer",void 0),D(this,"uploadExtStatsTimer",void 0),D(this,"uploadExtUsageStatsTimer",void 0),D(this,"uploadInboundExtStatsTimer",void 0),D(this,"requestStats",void 0),D(this,"requestTransportStats",void 0),D(this,"requestLocalMedia",void 0),D(this,"requestRemoteMedia",void 0),D(this,"requestAllTracks",void 0),D(this,"requestVideoIsReady",void 0),D(this,"requestUploadStats",void 0),D(this,"requestUpload",void 0),D(this,"uploadOutboundStarted",!1),D(this,"uploadInboundStarted",!1),D(this,"uploadTransportStarted",!1),D(this,"uploadBaseStatsStarted",!1),D(this,"uploadExtensionUsageStarted",!1),D(this,"lastRecvStats",void 0),D(this,"lastSendStats",void 0),D(this,"lastRefRecvStats",void 0),D(this,"lastRefSendStats",void 0),D(this,"lastFullRecvStats",void 0),D(this,"lastFullSendStats",void 0),D(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%3==0,i=e%6==0;let r,o;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),r||o){var c;const l={};if(this.uploadTransportStarted&&r){const p=this.getTransportStats(r,o,n);p&&(l.misc=[p])}if(this.uploadOutboundStarted&&r){const p=this.getOutboundStats(r,i?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,i);p&&(l.outbound=[p])}if(this.uploadInboundStarted&&o){const p=this.getInboundStats(o,i?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,i);p&&(l.inbound=p)}const h=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;h&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[Pb.RTC_PEER_CONNECTION_STATE]=J0[h]):l.misc=[{addition:{[Pb.RTC_PEER_CONNECTION_STATE]:J0[h]}}]),this.requestUploadStats(l)}this.lastRecvStats=o,this.lastSendStats=r,i&&(this.lastFullRecvStats=o,this.lastFullSendStats=r),n&&(this.lastRefRecvStats=o,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const r=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[Pb.RTC_PEER_CONNECTION_STATE]:J0[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===OY+1&&(e=1)},Lb)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[Gr.RTT]:e.rtt,[Gr.CONN_TYPE]:void 0,[Gr.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=U2(e);if(this.store.useP2P){if(n){const o=U2(n);r[Gr.CONN_TYPE]+=o[Gr.CONN_TYPE]<<3}r[Gr.CONN_TYPE]+=110}else r[Gr.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,n,i,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const o=this.requestLocalMedia();if(!o||o.length===0)return;let c,l,h;return o.forEach(p=>{let[m,{track:S,ssrcs:v}]=p;switch(m){case Et.LocalVideoLowTrack:case Et.LocalVideoTrack:if(m===Et.LocalVideoTrack){const y=function(O,M,U,W,$,Q){const q=M.videoSend.find(Mt=>Mt.ssrc===O);if(!q)return;const ct={},{sentFrame:_t,inputFrame:Dt}=q;if(Q&&(oe(ct,ii.QP_SUM,q.qpSumPerFrame),Dt&&_t)){const Mt=Dt.frameRate,De=_t.frameRate;ct[ii.FREEZE]=function(Pe,fn){let Xn=!0;return Xn=!(Pe<=5)&&(Pe<=10?fn<3:Pe<=20?fn<4:fn<5),Xn}(Mt,De)?1:0}if($){switch(_t&&(oe(ct,ii.HEIGHT,_t.height),oe(ct,ii.WIDTH,_t.width),oe(ct,ii.FRAME_RATE,_t.frameRate)),ct[ii.DISABLED]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0,q.adaptionChangeReason){case"none":ct[ii.ADAPTATION]=0;break;case"cpu":ct[ii.ADAPTATION]=1;break;case"bandwidth":ct[ii.ADAPTATION]=2;break;case"other":ct[ii.ADAPTATION]=3}let Mt=0;q.adaptionChangeReason&&(Mt+=V2(q.adaptionChangeReason)),M.qualityLimitationReason&&(Mt+=V2(M.qualityLimitationReason)<<3),ct[ii.ADAPTATION]=Mt,ct[ii.PLAYER_STATUS]=lI[W._player?W._player.videoElementStatus:"uninit"],oe(ct,ii.NACKS,q.nacksCount),oe(ct,ii.PLIS,q.plisCount),oe(ct,ii.FIRS,q.firsCount),oe(ct,ii.AVG_ENCODE,q.avgEncodeMs),oe(ct,ii.HUGE_FRAME_SENT,q.hugeFramesSent),oe(ct,ii.BYTES_RETRANSMIT,q.retransmittedBytesSent),oe(ct,ii.PACKAGES_RETRANSMIT,q.retransmittedPacketsSent),oe(ct,ii.KEY_FRAMES_ENCODED,q.keyFramesEncoded);const De=U&&U.videoSend.find(Pe=>Pe.ssrc===O);if(De){let Pe=$?Lb:6e3;De.timestamp&&q.timestamp&&(Pe=q.timestamp-De.timestamp),De.packets!=null&&q.packets!=null&&oe(ct,ii.PACKAGE_RATE,1e3*(q.packets-De.packets)/Pe),q.packetsLost!=null&&De.packetsLost!=null&&oe(ct,ii.PACKAGE_LOST,q.packetsLost-De.packetsLost),De.bytes!=null&&q.bytes!=null&&oe(ct,ii.BITRATE,8*(q.bytes-De.bytes)/Pe)}}return ct}(v[0].ssrcId,e,n,S,i,r),P=S&&function(O,M,U,W){const $=M.videoSend.find(q=>q.ssrc===O);if(!$)return null;const Q={};if(W){const q=$.inputFrame,ct=q&&q.height||U.videoHeight||0,_t=q&&q.width||U.videoWidth||0,Dt=q&&q.frameRate||0;oe(Q,Db.HEIGHT,ct),oe(Q,Db.WIDTH,_t),oe(Q,Db.FRAME_RATE,Dt)}return Q}(v[0].ssrcId,e,S,i),I=function(O,M){const U={};return M&&(oe(U,ii.RETRANSMIT,O.bitrate.retransmit),oe(U,ii.TARGET_ENCODED,O.bitrate.targetEncoded),oe(U,ii.ACTUAL_ENCODED,O.bitrate.actualEncoded),oe(U,ii.TRANSMIT,O.bitrate.transmit),oe(U,ii.BANDWIDTH,O.sendBandwidth)),U}(e,i);l=Object.assign({},y,P,I)}else h=function(y,P,I,O){const M=P.videoSend.find(W=>W.ssrc===y);if(!M)return;const U={};if(O){const W=M.sentFrame;if(W&&(oe(U,fp.HEIGHT,W.height),oe(U,fp.WIDTH,W.width),oe(U,fp.FRAME_RATE,W.frameRate)),I){const $=I.videoSend.find(Q=>Q.ssrc===y);if($){let Q=6e3;$.timestamp&&M.timestamp&&(Q=M.timestamp-$.timestamp),$.packets!=null&&M.packets!=null&&oe(U,fp.PACKAGE_RATE,1e3*(M.packets-$.packets)/Q),M.packetsLost!=null&&$.packetsLost!=null&&oe(U,fp.PACKAGE_LOST,M.packetsLost-$.packetsLost),$.bytes!=null&&M.bytes!=null&&oe(U,fp.BITRATE,8*(M.bytes-$.bytes)/Q)}}}return U}(v[0].ssrcId,e,n,i);break;case Et.LocalAudioTrack:c=S&&function(y,P,I,O,M){const U=P.audioSend.find($=>$.ssrc===y);if(!U)return;const W={};if(M){W[Qc.DISABLED]=O._originMediaStreamTrack&&!O._originMediaStreamTrack.enabled||O._mediaStreamTrack&&!O._mediaStreamTrack.enabled?1:0;const $=100*O._source.getAccurateVolumeLevel(),Q=U.inputLevel;if(Q!=null){const ct=Math.ceil(50*Math.log10(100*Q+1));oe(W,Qc.LEVEL,ct)}oe(W,M2.PCM_LEVEL,$),oe(W,Qc.AEC_RETURN_LOSS,U.aecReturnLoss),oe(W,Qc.AEC_RETURN_LOSS_ENH,U.aecReturnLossEnhancement),oe(W,Qc.BYTES_RETRANSMIT,U.retransmittedBytesSent),oe(W,Qc.PACKAGES_RETRANSMIT,U.retransmittedPacketsSent),W[Qc.FREEZE]=0;const q=I&&I.audioSend.find(ct=>ct.ssrc===y);if(q){let ct=6e3;q.timestamp&&U.timestamp&&(ct=U.timestamp-q.timestamp),q.bytes!=null&&U.bytes!=null&&oe(W,Qc.BITRATE,8*(U.bytes-q.bytes)/ct),q.packets!=null&&U.packets!=null&&oe(W,Qc.PACKAGE_RATE,1e3*(U.packets-q.packets)/ct)}}return W}(v[0].ssrcId,e,n,S,i)}}),{high:l,low:h,audio:c}}getInboundStats(e,n,i,r){if(!this.requestRemoteMedia)return;const o=this.requestRemoteMedia()||[],c=[];return o.forEach(l=>{let[h,p]=l;const m={peer:h.uid};if(p.has(Vt.VIDEO)&&h.videoTrack){const S=h._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(h._videoSSRC)||!1,v=h.videoTrack?function(y,P,I,O,M,U,W,$){const Q=P.videoRecv.find(Pe=>Pe.ssrc===y);if(!Q)return;const q={},{receivedFrame:ct,outputFrame:_t,decodeFrameRate:Dt}=Q,Mt=I&&I.videoRecv.find(Pe=>Pe.ssrc===y);if(oe(q,mp.FRAME_RATE_DECODE,Dt),Q.framesRateFirefox&&oe(q,ri.FRAME_RATE,Q.framesRateFirefox),ct&&oe(q,ri.FRAME_RATE,ct.frameRate),oe(q,ri.FRAMES_DROPPED,Q.framesDroppedCount),oe(q,ri.BYTES_RETRANSMIT,Q.retransmittedBytesReceived),oe(q,ri.PACKAGES_RETRANSMIT,Q.retransmittedPacketsReceived),oe(q,ri.PACKAGES_DISCARDED,Q.packetsDiscarded),oe(q,ri.AVG_DECODE,Q.avgDecodeMs),oe(q,ri.AVG_PROCESSING_DELAY,Q.avgProcessingDelayMs),oe(q,ri.AVG_ASSEMBLY_TIME,Q.avgFramesAssembledFromMultiplePacketsMs),oe(q,ri.AVG_INTER_FRAME_DELAY,Q.avgInterFrameDelayMs),oe(q,ri.KEY_FRAMES_DECODED,Q.keyFramesDecoded),Mt){const Pe=P.timestamp-I.timestamp||Lb*($?6:W?3:1);Q.packetsLost!=null&&Mt.packetsLost!=null&&oe(q,ri.PACKAGE_LOST,Q.packetsLost-Mt.packetsLost),Mt.bytes!=null&&Q.bytes!=null&&oe(q,ri.BITRATE,8*(Q.bytes-Mt.bytes)/Pe),Mt.packets!=null&&Q.packets!=null&&oe(q,ri.PACKAGE_RATE,1e3*(Q.packets-Mt.packets)/Pe)}if($&&(oe(q,ri.QP_SUM,Q.qpSumPerFrame),q[ri.FREEZE]=M&&gS.isRemoteVideoFreeze(O,Q,Mt)?1:0),W){var De;ct?(oe(q,ri.HEIGHT,ct.height),oe(q,ri.WIDTH,ct.width)):O&&(oe(q,ri.HEIGHT,O._videoHeight||0),oe(q,ri.WIDTH,O._videoWidth||0)),_t&&oe(q,mp.FRAME_RATE_OUTPUT,_t.frameRate);const Pe=(De=O._player)===null||De===void 0?void 0:De.rendFrameRate.toFixed(0);if(Pe&&oe(q,mp.FRAME_RATE_RENDER,+Pe),oe(q,ri.JITTER_BUFFER,Q.jitterBufferMs),oe(q,ri.CURRENT_DELAY,Q.currentDelayMs),oe(q,ri.FIRS,Q.firsCount),oe(q,ri.NACKS,Q.nacksCount),oe(q,ri.PLIS,Q.plisCount),O){q[ri.DISABLED]=O._originMediaStreamTrack.enabled&&O._mediaStreamTrack.enabled?0:1;const fn=O._player;if(fn){const{freezeTimeCounterList:Xn,renderFreezeAccTime:jn,videoElementStatus:Wr}=fn;if(Xn&&Xn.length>0&&oe(q,mp.FREEZE_TIME,Xn.splice(0,1)[0]),U&&Xl.visibility==="visible"&&Wr===fr.PLAYING&&Ge().supportRequestVideoFrameCallback){const ht=Math.min(6e3,jn);fn.renderFreezeAccTime=Math.max(0,jn-ht),oe(q,mp.FREEZE_TIME_RENDER,ht)}if(typeof Q.totalFreezesDuration=="number"){const ht=Mt&&Mt.totalFreezesDuration?Q.totalFreezesDuration-Mt.totalFreezesDuration:Q.totalFreezesDuration;oe(q,mp.FREEZE_DURATION,1e3*ht)}}}if(q[ri.PLAYER_STATUS]=lI[O._player?O._player.videoElementStatus:"uninit"],Mt&&Q.totalInterFrameDelay!==void 0&&Q.totalSquaredInterFrameDelay!==void 0&&Mt.totalInterFrameDelay!==void 0&&Mt.totalSquaredInterFrameDelay!==void 0){const fn=Q.totalInterFrameDelay-Mt.totalInterFrameDelay,Xn=Q.totalSquaredInterFrameDelay-Mt.totalSquaredInterFrameDelay,jn=Q.framesDecodeCount-Mt.framesDecodeCount,Wr=fn/jn*1e3,ht=Math.round(1e3*Math.sqrt((Xn-Math.pow(fn,2)/jn)/jn));!isNaN(ht)&&Wr+ht>Math.max(3*Wr,Wr+150)&&(q[ri.I_FRAME_DELAY]=ht)}}return q}(h._videoSSRC,e,n,h.videoTrack,S===!0,this.needUploadRenderFreezeTime,i,r):void 0;v&&(m.video=v)}if(p.has(Vt.AUDIO)&&h.audioTrack){const S=h.audioTrack?function(v,y,P,I,O,M){const U=y.audioRecv.find(q=>q.ssrc===v);if(!U)return;const W={},$=P&&P.audioRecv.find(q=>q.ssrc===v);if(oe(W,os.JITTER,U.jitterMs),oe(W,os.BYTES_RETRANSMIT,U.retransmittedBytesReceived),oe(W,os.PACKAGES_RETRANSMIT,U.retransmittedPacketsReceived),oe(W,os.PACKAGES_DISCARDED,U.packetsDiscarded),oe(W,os.AVG_PROCESSING_DELAY,U.avgProcessingDelayMs),$){const q=y.timestamp-P.timestamp||Lb*(M?6:O?3:1);U.packets!=null&&$.packets!=null&&oe(W,os.PACKAGE_RATE,1e3*(U.packets-$.packets)/q),O&&$.bytes!=null&&U.bytes!=null&&oe(W,os.BITRATE,8*(U.bytes-$.bytes)/q),U.packetsLost!=null&&$.packetsLost!=null&&oe(W,os.PACKAGE_LOST,U.packetsLost-$.packetsLost)}if(M){const{receivedFrames:q,droppedFrames:ct}=U;q!=null&&ct!=null&&(W[os.FREEZE]=(Q=q)===0||100*ct/Q>20?1:0)}var Q;if(O){const q=100*I._source.getAccurateVolumeLevel(),ct=U.outputLevel;if(ct!=null){const _t=Math.ceil(50*Math.log10(100*ct+1));oe(W,x2.LEVEL,_t)}if(oe(W,os.PCM_LEVEL,q),I&&(W[os.DISABLED]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),oe(W,os.JITTER_BUFFER,U.jitterBufferMs),oe(W,os.CURRENT_DELAY,U.jitterBufferMs),W[os.PLAYER_STATUS]=lI[jr.getPlayerState(I.getTrackId())],$){const _t=U.concealedSamples-$.concealedSamples;_t>0&&oe(W,os.CONCEALED_SAMPLES,_t)}}return W}(h._audioSSRC,e,n,h.audioTrack,i,r):void 0;S&&(m.audio=S)}(m.video||m.audio)&&c.push(m)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof nb);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(lS.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,i]=e;i.has(Vt.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(Vt.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const o=this.requestAllTracks&&this.requestAllTracks()||[];for(const p of o)!p.muted&&p.enabled&&(r=r.concat(await p.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[p,m]of c)m.has(Vt.VIDEO)&&p.videoTrack&&(r=r.concat(await p.videoTrack.getProcessorUsage())),m.has(Vt.AUDIO)&&p.audioTrack&&(r=r.concat(await p.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(p,m){const S={};for(const{id:I,value:O,level:M,direction:U}of p){var v;const W=(v=m.get(I))!==null&&v!==void 0?v:0,$=O===2?W+j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:W;var y,P;m.set(I,$),S[I]?(O===2&&(S[I].value=O),M>S[I].level&&(S[I].level=M),U==="remote"&&(S[I].remoteUidCount+=1),S[I].totalTs=(y=m.get(I))!==null&&y!==void 0?y:0):S[I]={value:O,level:M,remoteUidCount:U==="local"?0:1,totalTs:(P=m.get(I))!==null&&P!==void 0?P:0}}return Object.keys(S).map(I=>{const{level:O,value:M,totalTs:U}=S[I];return{id:I,level:O,value:M,totalTs:U}})}(r,e);const l=Date.now(),h=l>n?l:n+1;this.requestUpload&&this.requestUpload(lS.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:h})},j("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const NY=j("ICE_RESTART_INTERVAL");let kb=new Map,EE=new Map,mu=[or.UDP_TCP_RELAY,or.TCP_RELAY,or.RELAY],tO=j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ge().supportPCSetConfiguration;function j2(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=kb.get(t.id);n&&(window.clearTimeout(n),kb.delete(t.id));const i=EE.get(t.id);e&&i&&i.index===mu.length-1&&(b.debug("[".concat(t.id,"] reset ICE restart policy")),EE.delete(t.id))}function F2(t,e,n){if(kb.size===0&&EE.size===0&&(Array.isArray(j("RESTART_SEQUENCE"))&&j("RESTART_SEQUENCE").length>0&&!function(l,h){if(l.length!==h.length)return!1;for(let p=0;p<l.length;p+=1){const m=l[p];if(l.filter(S=>S===m).length!==h.filter(S=>S===m).length)return!1}return!0}(mu,j("RESTART_SEQUENCE"))&&(mu=j("RESTART_SEQUENCE").filter(l=>{var h;if(Ct(h=Object.values(or)).call(h,l))return!0}),b.debug("use reconnection policy from config distribution, queues: ".concat(mu.join(" => ")))),tO=j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ge().supportPCSetConfiguration),mu.length===0)return void n();let i,{index:r=0,type:o}=EE.get(t.id)||{};if(tO&&o===or.RELAY)return void n();let c=o&&r>=mu.length-1;if(tO)o=or.RELAY;else{if(c)return void n();o?(r++,o=mu[r]):(o=mu[0],r=0)}b.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(o,", index: ").concat(r)),e(o),EE.set(t.id,{index:r,type:o}),i=window.setTimeout(()=>F2(t,e,n),NY),kb.set(t.id,i)}var be;function G2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Zc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?G2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):G2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function H2(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=A0,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new Mb(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Mb(t){function e(n){if(Object(n)!==n)return At.reject(new TypeError(n+" is not an object."));var i=n.done;return At.resolve(n.value).then(function(r){return{value:r,done:i}})}return Mb=function(n){this.s=n,this.n=n.next},Mb.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?At.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?At.reject(n):e(i.apply(this.s,arguments))}},new Mb(t)}let TS=(be=class extends On{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit($t.StateChange,e,this._state)}constructor(t,e){super(),D(this,"isPlanB",void 0),D(this,"store",void 0),D(this,"statsUploader",void 0),D(this,"connection",void 0),D(this,"localTrackMap",new Map),D(this,"remoteUserMap",new Map),D(this,"localDataChannels",[]),D(this,"remoteDataChannelMap",new Map),D(this,"pendingLocalTracks",[]),D(this,"pendingRemoteTracks",[]),D(this,"pendingLocalDataChannels",[]),D(this,"pendingRemoteDataChannels",[]),D(this,"statsCollector",void 0),D(this,"shouldForwardP2PCreation",void 0),D(this,"iceFailedCount",0),D(this,"dtlsFailedCount",0),D(this,"mutex",void 0),D(this,"_state",Je.Disconnected),D(this,"_pcStatsUploadType",j("NEW_ICE_RESTART")?Zl.FIRST_CONNECTION:Zl.OLD_FIRST_CONNECTION),D(this,"_isStartRestartIce",!1),D(this,"_restartTimer",void 0),D(this,"_isTryConnecting",!1),D(this,"_iceError",null),D(this,"_forceTurn",!1),D(this,"_isWaitPcToRePub",!1),D(this,"handleMuteLocalTrack",async(n,i,r)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Je.Connected)return void r(new at(k.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(p=>p[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(p=>{let[,{id:m}]=p;return m}));const h=this.createMuteMessage(c);await un(this,$t.RequestMuteLocal,h),i()}catch(c){r(c)}finally{o()}}),D(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Je.Connected)return void r(new at(k.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(p=>p[0]==="videoLowTrack");if(l){const p=l[1];if(p.track._originMediaStreamTrack.stop(),!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding){const m=n._mediaStreamTrack.clone();p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}else{const m=$I(n,nS(this,$t.RequestLowStreamParameter));p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}await new At((m,S)=>{this.handleReplaceTrack(p.track,m,S,!0)})}await this.connection.unmuteLocal(c.map(p=>{let[,{id:m}]=p;return m}));const h=this.createUnmuteMessage(c);await un(this,$t.RequestUnmuteLocal,h),i()}catch(c){r(c)}finally{o()}}),D(this,"handleUpdateVideoEncoder",async(n,i,r,o)=>{let c;o||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const h=this.localTrackMap.get(Et.LocalVideoTrack);if(!this.connection||!h||h.track!==n||this.state!==Je.Connected)return void i();const{id:p,track:m}=h;await this.connection.updateSendParameters(p,m),await this.connection.updateEncoderConfig(p,m),this.emit($t.UpdateVideoEncoder,m),i()}catch(h){r(h)}finally{var l;(l=c)===null||l===void 0||l()}}),D(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(Et.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Je.Connected)return void i();const{id:l,track:h}=c;await this.connection.updateSendParameters(l,h),i()}catch(c){r(c)}finally{o()}}),D(this,"handleReplaceMixingTrack",async(n,i,r,o)=>{if(!this.connection||this.state!==Je.Connected)return void i();const c=QI([n]);let l;b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof o=="boolean"&&o||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(p){r(p)}finally{var h;(h=l)===null||h===void 0||h()}}),D(this,"handleReplaceTrack",async(n,i,r,o)=>{let c;b.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof o=="boolean"&&o||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const p=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:S}]=m;return n===S});if(!this.connection||!p||this.state!==Je.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,p[1].id)),this.isPlanB){const m=p[1];m.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],m)}if(p[0]===Et.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding){const m=this.localTrackMap.get(Et.LocalVideoLowTrack);if(m){const S=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=S,m.track._originMediaStreamTrack=S,await new At((v,y)=>{this.handleReplaceTrack(m.track,v,y,!0)})}}i()}catch(p){r(p)}finally{var h;(h=c)===null||h===void 0||h()}}),D(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),D(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),D(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),D(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),D(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new B2(this.store),this.bindStatsUploaderEvents(),this.mutex=new Qi("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ge().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&zl(),this.shouldForwardP2PCreation=j("FORWARD_P2P_CREATION")&&Ge().supportPCSetConfiguration&&U0(),this.shouldForwardP2PCreation&&(this.connection=Nb(this.store),this.emit($t.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=Je.New,this._forceTurn=L2(t),b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Nb(this.store,t),this.emit($t.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new at(k.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=j("NEW_ICE_RESTART")?Zl.FIRST_CONNECTION:Zl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new at(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");j("ENABLE_PREALLOC_PC")&&this.state===Je.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Je.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(r=>{var o;let[c]=r;return Ct(o=[Et.LocalVideoLowTrack,Et.LocalVideoTrack]).call(o,c)}),n=e.map(r=>{let[,{id:o}]=r;return o}),i=e.map(r=>{let[o]=r;return o});if(this.connection instanceof ed){if(qt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!Ct(t).call(t,this.store.codec)){const r=["vp9","vp8","h264"].find(o=>Ct(t).call(t,o));r&&(this.store.codec=r,b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof ed&&this.connection.peerConnectionState!=="closed"&&Ct(t=[Je.New,Je.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Je.Connected){if(this.state===Je.Disconnected)throw new at(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var i;Ct(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var i=this;return ho(function*(){const r=yield Ue(i.mutex.lock("From P2PChannel.publish"));try{var o;const c=i.connection&&Ct(o=["disconnected","failed"]).call(o,i.connection.peerConnectionState);if(!i.connection||i.state!==Je.Connected||c){if(i.state===Je.Disconnected)throw new at(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const h=t.filter(p=>i.pendingLocalTracks.indexOf(p)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(h),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,$i.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(t,e,n);if(l.length===0)return void(yield Ue(i.tryToUnmuteAudio(t)));yield*OR(H2(i.doPublish(i.connection,l)))}finally{r()}})()}doPublish(t,e){var n=this;return ho(function*(){e.forEach(v=>{let{track:y,type:P}=v;const I=Date.now();n.store.publish(y.getTrackId(),P===Et.LocalAudioTrack?"audio":"video",I)}),n.bindLocalTrackEvents(e);const i=e.map(v=>{let{track:y}=v;return y}),r=yield Ue(t.send(i,n.store.codec,n.store.audioCodec)),o=(yield Ue(r.next())).value,c=n.createGatewayPublishMessage(e,o);let l;try{l=yield c}catch(v){throw r.throw(v),(v==null?void 0:v.code)===k.WS_ABORT&&e.forEach(y=>{let{track:P}=y;n.pendingLocalTracks.indexOf(P)===-1&&n.pendingLocalTracks.push(P)}),n.unbindLocalTrackEvents(e),v}const h=n.mapPubResToRemoteConfig(c,l,i),p=(yield Ue(r.next(h))).value;if(n.state===Je.Disconnected)throw new at(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");j("ENABLE_VIDEO_SEI");const m=j("ENABLE_ENCODED_TRANSFORM"),S=j("ENABLE_AUDIO_METADATA");i.forEach(async v=>{const y=v.getRTCRtpTransceiver();y&&m&&(v.trackMediaType===Vt.VIDEO?await Rz(y.sender,v):v.trackMediaType===Vt.AUDIO&&await mz(y.sender,{metadata:S?()=>{const P=v.metadata.shift();return P&&P.value}:void 0}))}),e.forEach(v=>{let{type:y}=v;n.statsCollector.addLocalStats(y)}),n.assignLocalTracks(e,p),n.statsUploader.startUploadOutboundStats(),e.forEach(v=>{let{track:y,type:P}=v;const I=Date.now();n.store.publish(y.getTrackId(),P===Et.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof vn))return b.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,r=function(o,c){const l={};return o.height&&o.width&&(l.scaleResolutionDownBy=MI(o,c)),l.maxFramerate=o.framerate?Cs(o.framerate):void 0,l.maxBitrate=o.bitrate?1e3*o.bitrate:void 0,l}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==Et.LocalVideoLowTrack||!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const o=i._originMediaStreamTrack;if(!o.canvas)return b.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,l){const h=c.canvas;l.width&&(h.width=Cs(l.width)),l.height&&(h.height=Cs(l.height)),l.framerate&&(h.stopCapture&&h.stopCapture(),h.stopCapture=uI(()=>{!h.startCapture&&h.stopCapture&&h.stopCapture(),h.startCapture&&h.startCapture()},Cs(l.framerate)))})(o,t)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),b.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return ho(function*(){if(!e.connection||e.state!==Je.Connected)return;const n=yield Ue(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(Et.LocalVideoTrack);if(!r)throw new at(k.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(Et.LocalVideoLowTrack))throw new at(k.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const o=[{track:e.getLowVideoTrack(r.track,t),type:Et.LocalVideoLowTrack}];if(yield*OR(H2(e.doPublish(e.connection,o))),r.track.muted||!r.track.enabled){var i;const c=(i=e.localTrackMap.get(Et.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield Ue(e.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(b.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Wi(this,$t.RequestRePublish,this.pendingLocalTracks),this.emit($t.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(b.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Wi(this,$t.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:i}=this.pendingRemoteTracks[e];(i!==Vt.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==Vt.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await Wi(this,$t.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===Vt.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit($t.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Je.Connected)return void t.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Je.Connected)return void t.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Je.Connected)return;const t=this.localTrackMap.get(Et.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[Et.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[r,{track:o}]=i;return{type:r,track:o}})),e.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Je.Connected)throw new at(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(t,new Map([[i.id,i]]));const o=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:h}=c;return l.uid===t.uid&&h===i.id});o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),n.map(i=>i.id)}async subscribe(t,e,n,i,r){var o;if(!this.connection||this.state!==Je.Connected)throw new at(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o=this.remoteUserMap.get(t))!==null&&o!==void 0&&o.has(e))return;let c,l,h;const p=this.connection.getPreMedia(n);if(p)b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),h=p.transceiver,c=p.track,l=p.id;else if(r){const v=r.find(P=>{let{stream_type:I}=P;return I===e});if(!v)throw new at(k.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const y=await this.connection.receive(e,v.ssrcs,String(t._uintid),v.attributes);this.connection instanceof ed&&(h=y.transceiver),c=y.track,l=y.id}else{const v=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof ed&&(h=v.transceiver),c=v.track,l=v.id}e===Vt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new eE(c,t.uid,t._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),h&&t._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new tE(c,t.uid,t._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),h&&t._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(t,t._videoTrack)),h&&j("ENABLE_ENCODED_TRANSFORM")&&(e==Vt.VIDEO?await RI(h.receiver,{onSei:j("ENABLE_VIDEO_SEI")&&(v=>{var y;return(y=t._videoTrack)===null||y===void 0?void 0:y._onSei(v)})}):e==Vt.AUDIO&&await yI(h.receiver,{enableTopn:!!j("ENABLE_AUDIO_TOPN"),enableMetadata:!!j("ENABLE_AUDIO_METADATA"),onMetadata:v=>{this.safeEmit($t.AudioMetadata,v)}}));const m=this.remoteUserMap.get(t);m?m.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(v=>{let{user:y,kind:P}=v;return y.uid===t.uid&&e===P});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit($t.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Je.Connected)throw new at(k.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(r=>{var o;let{user:c,mediaType:l}=r;return!((o=this.remoteUserMap.get(c))!==null&&o!==void 0&&o.has(l))});const e=[],n=new Map;t.forEach(r=>{if(!this.connection)return;const o=this.connection.getPreMedia(r.ssrcId);o?n.set(r.ssrcId,o):e.push(r)});const i=await this.connection.batchReceive(e.map(r=>{let{user:o,mediaType:c,ssrcId:l,rtxSsrcId:h}=r;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:h}],mslabel:String(o._uintid)}}));e.forEach((r,o)=>{n.set(r.ssrcId,i[o])});for(const{user:r,mediaType:o,ssrcId:c}of t){const l=n.get(c);if(!l)return void b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(o,", ").concat(c));const{track:h,id:p,transceiver:m}=l;m&&j("ENABLE_ENCODED_TRANSFORM")&&(o==Vt.VIDEO?await RI(m.receiver,{onSei:j("ENABLE_VIDEO_SEI")&&(y=>{var P;return(P=r._videoTrack)===null||P===void 0?void 0:P._onSei(y)})}):o==Vt.AUDIO&&await yI(m.receiver,{enableTopn:!!j("ENABLE_AUDIO_TOPN"),enableMetadata:!!j("ENABLE_AUDIO_METADATA"),onMetadata:y=>{this.safeEmit($t.AudioMetadata,y)}})),o===Vt.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(h):(r._audioTrack=new eE(h,r.uid,r._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),m&&r._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(h):(r._videoTrack=new tE(h,r.uid,r._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),m&&r._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(r,r._videoTrack)),j("ENABLE_VIDEO_SEI")&&m&&(o==Vt.VIDEO?await RI(m.receiver,{onSei:y=>{var P;(P=r._videoTrack)===null||P===void 0||P._onSei(y)}}):o==Vt.AUDIO&&await yI(m.receiver));const S=this.remoteUserMap.get(r);S?S.set(o,p):this.remoteUserMap.set(r,new Map([[o,p]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const v=this.pendingRemoteTracks.findIndex(y=>{let{user:P,kind:I}=y;return P.uid===r.uid&&o===I});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit($t.MediaReconnectEnd,r.uid))}}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:h}=c;return e!==void 0?l.uid===t.uid&&e===h:l.uid===t.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Je.Connected||n||i.forEach(c=>{let{kind:l}=c;var h;if(l===Vt.AUDIO)(h=t._audioTrack)===null||h===void 0||h._destroy(),t._audioTrack=void 0;else if(l===Vt.VIDEO){var p;(p=t._videoTrack)===null||p===void 0||p._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Je.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const o=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:h}]=c;var p,m;if(h===Vt.VIDEO&&l._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),h===Vt.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0);else if(h===Vt.AUDIO){var S;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((S=l._audioTrack)===null||S===void 0||S._destroy(),l._audioTrack=void 0)}}),o}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const o=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(t);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:o}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:h,kind:p}=l;return o!==void 0?h.uid===r.uid&&o===p:h.uid===r.uid});c.forEach(l=>{const h=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(h,1)}),e=e.concat(c)}if(!this.connection||this.state!==Je.Connected)return void e.forEach(r=>{let{user:o,kind:c}=r;var l;if(c===Vt.AUDIO)(l=o._audioTrack)===null||l===void 0||l._destroy(),o._audioTrack=void 0;else if(c===Vt.VIDEO){var h;(h=o._videoTrack)===null||h===void 0||h._destroy(),o._videoTrack=void 0}});const n=qi(t).call(t,(r,o)=>{let{user:c,mediaType:l}=o;const h=this.filterTobeUnSubscribedTracks(c,l);return r.concat(h)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:o}]=r;return o}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[o,{kind:c}]=r;var l,h;if(c===Vt.VIDEO&&o._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===Vt.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),(h=o._videoTrack)===null||h===void 0||h._destroy(),o._videoTrack=void 0;else if(c===Vt.AUDIO){var p;this.unbindRemoteTrackEvents(o._audioTrack),(p=o._audioTrack)===null||p===void 0||p._destroy(),o._audioTrack=void 0}}),i}isPreSubScribe(t){return!this.connection||this.state!==Je.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void b.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===Vt.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||b.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(Et.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(Et.LocalAudioTrack);if((e==null?void 0:e.track)instanceof mi){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==Et.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===Et.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===Et.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(Et.LocalAudioTrack),l=i?this.localTrackMap.get(Et.LocalVideoLowTrack):this.localTrackMap.get(Et.LocalVideoTrack);qt.publish(this.store.sessionId,{eventElapse:$i.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(pn.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var o;n||(n=[]);const c=n.find(h=>h instanceof Bn),l=i?(o=this.localTrackMap.get(Et.LocalVideoTrack))===null||o===void 0?void 0:o.track:n.find(h=>h instanceof vn);qt.publish(this.store.sessionId,{eventElapse:$i.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(pn.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===Vt.VIDEO?n._videoSSRC:n._audioSSRC;r&&qt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===Vt.VIDEO,audio:i===Vt.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:$i.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){b.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Qi("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Nb(this.store),this.emit($t.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Et.LocalAudioTrack);if((t==null?void 0:t.track)instanceof mi){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Je.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Et.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Et.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof vn||e&&e.track instanceof Bn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(Hs(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(Et.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=jg(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.connection&&(b.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Je.Reconnecting,j("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Nb(this.store),this.emit($t.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case Et.LocalVideoTrack:Ct(e=i._hints).call(e,pn.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case Et.LocalAudioTrack:i instanceof mi?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case Et.LocalVideoLowTrack:}}),this.emit($t.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Hs(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit($t.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Hs(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),b.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((t instanceof fu?t.uid:t)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof fu?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return ho(function*(){if(!e.connection||e.state!==Je.Connected)return;const n=yield Ue(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Ue(e.connection.restartICE(t));const o=yield Ue(i.next());if(o.done)return;const c=o.value,l=yield c;switch(ZI(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case or.UDP_TCP_RELAY:e._pcStatsUploadType=Zl.UDP_TCP_RESTART;break;case or.TCP_RELAY:e._pcStatsUploadType=Zl.TCP_RESTART;break;case or.RELAY:e._pcStatsUploadType=Zl.RELAY_RESTART;break;default:e._pcStatsUploadType=Zl.OLD_RESTART}e._isTryConnecting=!0,i.next(l)}catch(o){var r;(r=i)===null||r===void 0||r.throw(o)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(Et.LocalVideoTrack),n=this.localTrackMap.get(Et.LocalAudioTrack),i=t.videoSend.find(y=>y.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(y=>y.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const o=Fs(this,$t.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,h=c&&l?(c+l)/2:c||l,p=(h&&o?(h+o)/2:h||o)||0,m=100*t.sendPacketLossRate*.7/50+.3*p/1500,S=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,v=e==null?void 0:e.track;if(v&&v._encoderConfig&&v._hints.indexOf(pn.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,P=t.bitrate.actualEncoded;if(y&&P){const I=(1e3*y-P)/(1e3*y);return RU[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,o=i._videoSSRC,c=t.audioRecv.find(P=>P.ssrc===r),l=t.videoRecv.find(P=>P.ssrc===o);if(!c&&!l)return void(e+=1);const h=Fs(this,$t.NeedSignalRTT),p=t.rtt,m=(p&&h?(p+h)/2:p||h)||0,S=c?c.jitterMs:void 0,v=t.recvPacketLossRate;let y=.7*v*100/50+.3*m/1500;S&&(y=.6*v*100/50+.2*m/1500+.2*S/400),e+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new At((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(b.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==Je.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return t===c});if(!i)return;const r=i[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:r}]),this.bindLocalTrackEvents([{track:e,type:r}]),i[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,i[1].id)),this.isPlanB){const o=i[1];o.id=e._mediaStreamTrack.id,this.localTrackMap.set(r,o)}if(r===Et.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding){const o=this.localTrackMap.get(Et.LocalVideoLowTrack);if(o){const c=t._mediaStreamTrack.clone();o.track._originMediaStreamTrack.stop(),o.track._mediaStreamTrack=c,o.track._originMediaStreamTrack=c,await new At((l,h)=>{this.handleReplaceTrack(o.track,l,h,!0)})}}}filterTobePublishedTracks(t,e,n){const i=[],r=this.getAllTracks();t=Gm(t=t.filter(h=>r.indexOf(h)===-1));let o,c=!1;const l=this.localTrackMap.get(Et.LocalAudioTrack);for(const h of t){if(h instanceof vn&&(this.localTrackMap.has(Et.LocalVideoTrack)||c?new at(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:h,type:Et.LocalVideoTrack}),c=!0),e)){const p=this.getLowVideoTrack(h,n);i.push({track:p,type:Et.LocalVideoLowTrack})}if(h instanceof Bn)if(l){const p=l.track;if(p instanceof mi)JI([h]),p.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0);else{const m=QI([p,h]);b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(p,m)}}else o instanceof mi?(JI([h]),o.addAudioTrack(h)):o||!h._useAudioElement&&Ge().webAudioMediaStreamDest&&!h._bypassWebAudio?o=QI(o?[h,o]:[h]):o=h}return o&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),i.push({track:o,type:Et.LocalAudioTrack})),i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Gm(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof Bn){const r=this.localTrackMap.get(Et.LocalAudioTrack);if(!r)continue;r.track instanceof mi?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([Et.LocalAudioTrack,r]),r.track.close())):e.push([Et.LocalAudioTrack,r])}if(i instanceof vn){const r=this.localTrackMap.get(Et.LocalVideoTrack);if(!r)continue;e.push([Et.LocalVideoTrack,r]);const o=this.localTrackMap.get(Et.LocalVideoLowTrack);o&&e.push([Et.LocalVideoLowTrack,o])}}return e}filterTobePublishedDataChannels(t){return t=(t=Gm(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Gm(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case Et.LocalVideoTrack:n.addListener(jt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(jt.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(jt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(jt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(jt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Et.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Et.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof mi?t.trackList.forEach(n=>{n.addListener(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(jt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(jt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(jt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(jt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case Et.LocalVideoTrack:n.off(jt.GET_STATS,this.handleGetLocalVideoStats),n.off(jt.GET_RTC_STATS,this.handleGetRTCStats),n.off(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(jt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(jt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(jt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Et.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Et.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof mi?t.trackList.forEach(e=>{e.off(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(jt.GET_STATS,this.handleGetLocalAudioStats),e.off(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(jt.GET_STATS,this.handleGetLocalAudioStats),t.off(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(jt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(jt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof tE&&e.addListener(jt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof eE&&e.addListener(jt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(jt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(Vt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(Vt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let o,c,{track:l,type:h}=n;switch(h){case Et.LocalAudioTrack:o=Qe.Audio,c={dtx:l instanceof nb&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Et.LocalVideoTrack:o=Ct(r=l._hints).call(r,pn.SCREEN_TRACK)?Qe.Screen:Qe.High,c=Zc(Zc({},FU(l)),{},{codec:this.store.codec,svc_mode:gb()});break;case Et.LocalVideoLowTrack:o=Qe.Low,c=Zc(Zc({},FU(l)),{},{codec:this.store.codec,svc_mode:gb()})}return{stream_type:o,attributes:c,ssrcs:e[i]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case Et.LocalVideoTrack:i=Ct(n=o._hints).call(n,pn.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Et.LocalAudioTrack:i=Qe.Audio;break;case Et.LocalVideoLowTrack:i=Qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:o}=n;this.localTrackMap.set(o,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit($t.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof ed&&j2(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Zl.DISCONNECTED_OR_FAILED,Fs(this,$t.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));qt.reportApiInvoke(this.store.sessionId,{name:li.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:Mn.TRACER}).onSuccess(),this.republish()}if(j("NEW_ICE_RESTART")&&t instanceof ed&&!Un()&&!this._forceTurn){if(Ct(kU).call(kU,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=r=>{ZI(t)&&(b.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),Fs(this,$t.QueryClientConnectionState)==="CONNECTED"&&this.emit($t.RequestRestartICE,r))},i=()=>{ZI(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),b.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit($t.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{F2(t,n,i)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&j("ICE_RESTART")&&Fs(this,$t.QueryClientConnectionState)==="CONNECTED"&&this.emit($t.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit($t.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit($t.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),qt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Mn.TRACER}).onSuccess(),this.emit($t.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Xm.FIRST_FRAME_DECODED),qt.firstRemoteFrame(this.store.sessionId,bi.FIRST_AUDIO_DECODE,Cn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:$i.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&qt.firstRemoteFrame(this.store.sessionId,bi.FIRST_AUDIO_RECEIVED,Cn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:$i.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&qt.firstRemoteFrame(this.store.sessionId,bi.FIRST_VIDEO_RECEIVED,Cn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:$i.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit($t.ConnectionTypeChange,i),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uu(n))," -> ").concat(JSON.stringify(uu(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uu(n))," -> ").concat(JSON.stringify(uu(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Zc(Zc({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof ed&&function(e){EE.delete(e.id),j2(e)}(t),t.close(),this.emit($t.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(Et.LocalAudioTrack);if(t instanceof Bn&&(n==null?void 0:n.track)instanceof mi)return n.track.isActive||e.push([Et.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return t===o});if(i&&(e.push(i),i[0]===Et.LocalVideoTrack)){const r=this.localTrackMap.get(Et.LocalVideoLowTrack);r&&e.push([Et.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(Et.LocalAudioTrack);if(t instanceof Bn&&(n==null?void 0:n.track)instanceof mi)return n.track.isActive&&e.push([Et.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return t===o});if(i)if(i[0]===Et.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(Et.LocalVideoLowTrack);r&&e.push([Et.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case Et.LocalAudioTrack:i=Qe.Audio;break;case Et.LocalVideoTrack:i=Ct(n=o._hints).call(n,pn.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Et.LocalVideoLowTrack:i=Qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case Et.LocalAudioTrack:i=Qe.Audio;break;case Et.LocalVideoTrack:i=Ct(n=o._hints).call(n,pn.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Et.LocalVideoLowTrack:i=Qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[o,c]=r;n.push([t,{kind:o,id:c}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:o}]=n;switch(r){case Vt.VIDEO:return void(i._videoSSRC&&e.push({stream_type:Vt.VIDEO,ssrcId:i._videoSSRC}));case Vt.AUDIO:return void(i._audioSSRC&&e.push({stream_type:Vt.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[i,{kind:r}]=n;if(e.has(i)){let o=e.get(i);r===Vt.VIDEO?o|=Ci.Video:o|=Ci.Audio,e.set(i,o)}else r===Vt.VIDEO?e.set(i,Ci.Video):e.set(i,Ci.Audio)}),{users:Array.from(e.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(Et.LocalVideoTrack),n=this.localTrackMap.get(Et.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new At((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new At((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e,n){return t.map((i,r)=>{var o;let{stream_type:c}=i;const l=(o=e.find(h=>{let{stream_type:p}=h;return c===p}))===null||o===void 0?void 0:o.attributes;if(l&&j("DISABLE_SCREEN_SHARE_REMB")){const h=n[r]._hints;(Ct(h).call(h,pn.SCREEN_TRACK)||Ct(h).call(h,pn.SCREEN_LOW_TRACK))&&(l.remb=!1,b.debug("disable remb for screen share, hints:",h))}return l})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof Bn){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(o=>{let[,{id:c}]=o;return c})));const r=this.createUnmuteMessage(i);return void await un(this,$t.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit($t.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit($t.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Vi(K0(this.dtlsFailedCount,di)),this.emit($t.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await Wi(this,$t.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit($t.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Et.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof vn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof vn).length>1)throw new at(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Bn).length>1&&(t.some(e=>e instanceof Bn&&e._bypassWebAudio)||!Ge().webAudioMediaStreamDest))throw new at(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof vn&&this.pendingLocalTracks.some(n=>n instanceof vn))throw new at(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Bn&&this.pendingLocalTracks.some(n=>n instanceof Bn)&&(!Ge().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Bn&&n._bypassWebAudio)))throw new at(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const i=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding,r=Zc(Zc({},{width:160,height:120,framerate:15,bitrate:50}),e);let o;o=i?t._mediaStreamTrack.clone():$I(t,r);const c=hn(8,"track-low-"),l=new vn(o,Zc(Zc({},i&&{scaleResolutionDownBy:MI(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(rp.TRANSCEIVER_UPDATED,h=>{t._updateRtpTransceiver(h,Ym.LOW_STREAM)}),l._hints.push(pn.LOW_STREAM),Ct(n=t._hints).call(n,pn.SCREEN_TRACK)&&l._hints.push(pn.SCREEN_LOW_TRACK),t.on("sei-to-send",h=>{l.emit("sei-to-send",h)}),t.addListener(jt.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof ed){var r,o,c,l;const h=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:p,dtlsTransportState:m,peerConnectionState:S}=this.connection,{local:v,remote:y}=await this.connection.getSelectedCandidatePair();qt.pcStats(this.store.sessionId,{startTime:h,eventElapse:t-h||0,iceconnectionsate:p,dtlsstate:m,connectionstate:S,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=v==null?void 0:v.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(o=v.candidateType)!==null&&o!==void 0?o:"",selectedLocalCandidateAddress:"".concat(v.address,":").concat(v.port),selectedRemoteCandidateProtocol:(c=y.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=y.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,e,n,i){var r;const o=Array.from(Hs(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(h=>h.userId===o.uid&&h.type==="video");qt.firstRemoteVideoDecode(this.store.sessionId,bi.FIRST_VIDEO_DECODE,Cn.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:e,videoheight:n,subscribeElapse:$i.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0,firstFrame:(l==null?void 0:l.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const o=await this.connection.getRemoteSSRC(r);return o!==void 0&&o!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===Et.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Ym.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Wt(be.prototype,"startP2PConnection",[Er],Object.getOwnPropertyDescriptor(be.prototype,"startP2PConnection"),be.prototype),Wt(be.prototype,"connect",[Er],Object.getOwnPropertyDescriptor(be.prototype,"connect"),be.prototype),Wt(be.prototype,"updateRemoteRTPCapabilities",[Er],Object.getOwnPropertyDescriptor(be.prototype,"updateRemoteRTPCapabilities"),be.prototype),Wt(be.prototype,"publishDataChannel",[Er],Object.getOwnPropertyDescriptor(be.prototype,"publishDataChannel"),be.prototype),Wt(be.prototype,"unpublish",[Er],Object.getOwnPropertyDescriptor(be.prototype,"unpublish"),be.prototype),Wt(be.prototype,"unpublishDataChannel",[Er],Object.getOwnPropertyDescriptor(be.prototype,"unpublishDataChannel"),be.prototype),Wt(be.prototype,"unpublishLowStream",[Er],Object.getOwnPropertyDescriptor(be.prototype,"unpublishLowStream"),be.prototype),Wt(be.prototype,"subscribeDataChannel",[Er],Object.getOwnPropertyDescriptor(be.prototype,"subscribeDataChannel"),be.prototype),Wt(be.prototype,"subscribe",[Er],Object.getOwnPropertyDescriptor(be.prototype,"subscribe"),be.prototype),Wt(be.prototype,"massSubscribe",[Er],Object.getOwnPropertyDescriptor(be.prototype,"massSubscribe"),be.prototype),Wt(be.prototype,"unsubscribe",[Er],Object.getOwnPropertyDescriptor(be.prototype,"unsubscribe"),be.prototype),Wt(be.prototype,"unsubscribeDataChannel",[Er],Object.getOwnPropertyDescriptor(be.prototype,"unsubscribeDataChannel"),be.prototype),Wt(be.prototype,"massUnsubscribe",[Er],Object.getOwnPropertyDescriptor(be.prototype,"massUnsubscribe"),be.prototype),Wt(be.prototype,"muteRemote",[Er],Object.getOwnPropertyDescriptor(be.prototype,"muteRemote"),be.prototype),Wt(be.prototype,"unmuteRemote",[Er],Object.getOwnPropertyDescriptor(be.prototype,"unmuteRemote"),be.prototype),Wt(be.prototype,"hasRemoteMediaWithLock",[Er],Object.getOwnPropertyDescriptor(be.prototype,"hasRemoteMediaWithLock"),be.prototype),Wt(be.prototype,"disconnectForReconnect",[Er],Object.getOwnPropertyDescriptor(be.prototype,"disconnectForReconnect"),be.prototype),Wt(be.prototype,"updateBitrateLimit",[Er],Object.getOwnPropertyDescriptor(be.prototype,"updateBitrateLimit"),be.prototype),Wt(be.prototype,"remoteMediaSsrcChanged",[Er],Object.getOwnPropertyDescriptor(be.prototype,"remoteMediaSsrcChanged"),be.prototype),be);function Er(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,o=await r.lock("From P2PChannel.".concat(e));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await i.apply(this,l)}finally{o()}},n}function W2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function K2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?W2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):W2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const DY=Date.now(),eO=new Map,xb=new Map;async function z2(t){const e=eO.get(t),n=Array.isArray(e)&&e[e.length-1],i=xb.get(t);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const o=n.sendTs-i.firstSendTs,c=o-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-o);let l=n.mediaDelay+c;l<=0?(e.pop(),Y2(n.context,r),l=0):l=Math.min(l,20),setTimeout(()=>e.length&&z2(t),l)}function Y2(t,e){t.safeEmit(Ie.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function PY(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return Y2(n,{uid:t.uid,payload:t.payload});const i="".concat(n.id,"-").concat(t.uid),r=eO.get(i)||[],o=r.findIndex(p=>t.sendTs>=p.sendTs),c=K2(K2({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});o===-1?r.push(c):r.splice(o,0,c),eO.set(i,r);let l=!1;var h;xb.has(i)?l=!((h=xb.get(i))===null||h===void 0||!h.isSyncing):xb.set(i,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||z2(i)}const LY=Fe().name;function q2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function X2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?q2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const _E="websdk_ng_cache_parameter",kY=j("MAX_PRELOAD_ASYNC_LENGTH"),Ep=new Map,_p=[];let nO=null,iO=0,rO=0;const Ub=new Map,MY=function(t,e){const n=[];let i=0;const r=async()=>{const o=n.shift();o&&await o(),n.length>0&&i<e?r():i--};return async function(){for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return new At(async(h,p)=>{n.push(async()=>{try{const m=await t(...c);h(m)}catch(m){p(m)}}),i<e&&(i++,r())})}}(J2,kY),sO=Br.CancelToken.source();async function J2(t,e,n,i,r,o){try{if(!j("ENABLE_PRELOAD"))return;if(!Ge().supportWebCrypto)return void ou(()=>{b.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new at(k.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ui(n,"token",1,2047),Ui(t,"appid",1,2047),pb(e),i&&fb(i);const c=np();b.debug("preload channel ".concat(e,", uid is ").concat(i));const l={appId:t,cname:e,token:n||t,uid:typeof i!="string"?i:null,sid:c,proxyServer:r};let h,p;typeof i=="string"?(l.stringUid=i,[p,h]=await At.all([gY(i,{sid:c,appId:t},sO.token),g2(X2(X2({},l),{},{token:n||t,uid:0}),sO.token)]),l.uid=p.uid,h.gatewayInfo.uid=l.uid,h.gatewayInfo.res.uid=l.uid):(o&&(l.stringUid=o),h=await g2(l,sO.token));const m={sid:c,appId:t,cname:e,token:n||t,uid:l.stringUid||i,intUid:l.uid||h.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:p,ap:h};await async function(S){let v;try{S.uid&&Z2({appId:S.appId,cname:S.cname,token:S.token,uid:S.uid,stringUid:S.stringUid});const y=nV(S),P=await async function(O,M){try{const U=await window.crypto.subtle.importKey("raw",Y1(M),"AES-GCM",!1,["encrypt"]),W=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},U,ep(window.btoa(JSON.stringify(O))));return au(new Uint8Array(W))}catch{return}}(S,S.token||S.appId);if(!P)return;v=eV(_E);const I=v?JSON.parse(v):[];I.push({[y]:P}),I.length>j("AP_CACHE_NUM")&&I.shift(),Vb(_E,JSON.stringify(I))}catch(y){b.warn("Error caching server parameters:",y.message),Vb(_E,"")}}(m),iO++}catch(c){throw rO++,function(l){nO||(nO=window.setTimeout(()=>{let p="";Ub.forEach((m,S)=>{p+="".concat(S,": ").concat(m," ;")}),qt.reportApiInvoke(null,{name:li.PRELOAD,options:{success:iO,failed:rO,err:p}}).onError(l),iO=0,rO=0,Ub.clear(),nO=null},1e4));const h=Ub.get(l.code)||0;Ub.set(l.code,h+1)}(c),c}}async function Q2(t){try{if(j("AP_REQUEST_DETAIL")||j("ENABLE_ROLE_SELECT_EDGE"))return;const e=Z2(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const o=await window.crypto.subtle.importKey("raw",Y1(r),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o,ep(i));return JSON.parse(window.atob(au(new Uint8Array(c))))}catch{return}}(e,t.token||t.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<j("AP_CACHE_LIFETIME"))return n}catch(e){b.warn("Error get preloadInfo",e.message)}}function Z2(t){let e;try{if(e=eV(_E),!e)return;const n=JSON.parse(e),i=nV(t),r=function(c,l){for(let h=c.length-1;h>=0;h--)if(l(c[h]))return h;return-1}(n,c=>i in c);if(r===-1)return;const o=n.splice(r,1)[0];return Vb(_E,JSON.stringify(n)),o[i]}catch(n){b.warn("Error delete preload info: ".concat(e),n.message),Vb(_E,"")}}function oO(t){if(t){let e=Ep.get(t);e&&(window.clearTimeout(e),e=null,Ep.delete(t)),Ct(_p).call(_p,t)||t.cloudProxyServer!=="disabled"||_p.push(t)}if(Ep.size<j("AP_CACHE_NUM")&&_p.length>0){const e=_p.shift();Ep.set(e,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:o,uid:c,proxyServer:l}=e;try{await MY(n,i,r,c,l,o),Ep.has(e)&&oO(e)}catch(h){b.warn("update preload failed",h.message),$2(e)}},j("AP_UPDATE_INTERVAL")))}}function $2(t){const e=_p.indexOf(t);e!==-1&&_p.splice(e,1);let n=Ep.get(t);n&&(window.clearTimeout(n),n=null,Ep.delete(t),oO())}function tV(t,e){const n=t.sua,i=t.ap;e&&n&&qt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),qt.reportResourceTiming(t.ap.url,t.sid),qt.joinWebProxyAP(t.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[ni.CHOOSE_SERVER,ni.CLOUD_PROXY_FALLBACK].toString()}),qt.joinChooseServer(t.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[ni.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function eV(t){return window.atob(window.localStorage.getItem(t)||"")}function Vb(t,e){window.localStorage.setItem(t,window.btoa(e))}function nV(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),tM(e)}function xY(t){let e=function(){const n=BY.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&(si(i,10),Eu(i,r));let o=n.cid;o!==void 0&&(si(i,16),si(i,o));let c=n.cname;c!==void 0&&(si(i,26),Eu(i,c));let l=n.deviceId;l!==void 0&&(si(i,34),Eu(i,l));let h=n.elapse;h!==void 0&&(si(i,40),_u(i,h));let p=n.fileSize;p!==void 0&&(si(i,48),_u(i,gE(p)));let m=n.height;m!==void 0&&(si(i,56),_u(i,gE(m)));let S=n.jpg;S!==void 0&&(si(i,66),si(i,S.length),rV(i,S));let v=n.networkType;v!==void 0&&(si(i,72),_u(i,gE(v)));let y=n.osType;y!==void 0&&(si(i,80),_u(i,gE(y)));let P=n.requestId;P!==void 0&&(si(i,90),Eu(i,P));let I=n.sdkVersion;I!==void 0&&(si(i,98),Eu(i,I));let O=n.sequence;O!==void 0&&(si(i,104),_u(i,gE(O)));let M=n.sid;M!==void 0&&(si(i,114),Eu(i,M));let U=n.timestamp;U!==void 0&&(si(i,120),_u(i,U));let W=n.uid;W!==void 0&&(si(i,128),si(i,W));let $=n.vid;$!==void 0&&(si(i,136),si(i,$));let Q=n.width;Q!==void 0&&(si(i,144),_u(i,gE(Q)));let q=n.service;q!==void 0&&(si(i,152),si(i,q));let ct=n.callbackData;ct!==void 0&&(si(i,162),si(i,ct.length),rV(i,ct));let _t=n.ticket;_t!==void 0&&(si(i,170),Eu(i,_t));let Dt=n.vendorConfigs;Dt!==void 0&&(si(i,178),Eu(i,Dt))}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function UY(t){return function(n){let i={};t:for(;!jY(n);){let r=vS(n);switch(r>>>3){case 0:break t;case 1:i.code=vS(n);break;case 2:i.msg=sV(n,vS(n));break;case 3:i.requestId=sV(n,vS(n));break;case 4:i.timestamp=FY(n,!1);break;default:VY(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function VY(t,e){switch(e){case 0:for(;128&aa(t););break;case 2:aO(t,vS(t));break;case 5:aO(t,4);break;case 1:aO(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function gE(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let BY=[];function aO(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function jY(t){return t.offset>=t.limit}function Bb(t,e){let n=t.bytes,i=t.offset,r=t.limit,o=i+e;if(o>n.length){let c=new Uint8Array(2*o);c.set(n),t.bytes=c}return t.offset=o,o>r&&(t.limit=o),i}function iV(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function rV(t,e){let n=Bb(t,e.length);t.bytes.set(e,n)}function sV(t,e){let n=iV(t,e),i=String.fromCharCode,r=t.bytes,o="�",c="";for(let l=0;l<e;l++){let h,p,m,S,v=r[l+n];128&v?(224&v)==192?l+1>=e?c+=o:(h=r[l+n+1],(192&h)!=128?c+=o:(S=(31&v)<<6|63&h,S<128?c+=o:(c+=i(S),l++))):(240&v)==224?l+2>=e?c+=o:(h=r[l+n+1],p=r[l+n+2],(49344&(h|p<<8))!=32896?c+=o:(S=(15&v)<<12|(63&h)<<6|63&p,S<2048||S>=55296&&S<=57343?c+=o:(c+=i(S),l+=2))):(248&v)==240?l+3>=e?c+=o:(h=r[l+n+1],p=r[l+n+2],m=r[l+n+3],(12632256&(h|p<<8|m<<16))!=8421504?c+=o:(S=(7&v)<<18|(63&h)<<12|(63&p)<<6|63&m,S<65536||S>1114111?c+=o:(S-=65536,c+=i(55296+(S>>10),56320+(1023&S)),l+=3))):c+=o:c+=i(v)}return c}function Eu(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}si(t,i);let r=Bb(t,i),o=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?o[r++]=l:(l<2048?o[r++]=l>>6&31|192:(l<65536?o[r++]=l>>12&15|224:(o[r++]=l>>18&7|240,o[r++]=l>>12&63|128),o[r++]=l>>6&63|128),o[r++]=63&l|128)}}function aa(t){return t.bytes[iV(t,1)]}function oV(t,e){let n=Bb(t,1);t.bytes[n]=e}function vS(t){let e,n=0,i=0;do e=aa(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function si(t,e){for(e>>>=0;e>=128;)oV(t,127&e|128),e>>>=7;oV(t,e)}function FY(t,e){let n,i=0,r=0,o=0;return n=aa(t),i=127&n,128&n&&(n=aa(t),i|=(127&n)<<7,128&n&&(n=aa(t),i|=(127&n)<<14,128&n&&(n=aa(t),i|=(127&n)<<21,128&n&&(n=aa(t),r=127&n,128&n&&(n=aa(t),r|=(127&n)<<7,128&n&&(n=aa(t),r|=(127&n)<<14,128&n&&(n=aa(t),r|=(127&n)<<21,128&n&&(n=aa(t),o=127&n,128&n&&(n=aa(t),o|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|o<<24,unsigned:e}}function _u(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,o=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=Bb(t,o),l=t.bytes;switch(o){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=o!==9?128|r:127&r;case 8:l[c+7]=o!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=o!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=o!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=o!==5?128|i:127&i;case 4:l[c+3]=o!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=o!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=o!==2?n>>>7|128:n>>>7&127;case 1:l[c]=o!==1?128|n:127&n}}const aV={},cV={},lV=4294967296,GY=18446744073709552e3,HY=GY/2;uV(0,!0);const dV=uV(0),WY=yS(0,-2147483648,!1),KY=yS(-1,2147483647,!1);function uV(t,e){let n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=cV[t],i)?i:(n=yS(t,0,!0),r&&(cV[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=aV[t],i)?i:(n=yS(t,t<0?-1:0,!1),r&&(aV[t]=n),n)}function yS(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function hV(t,e){if(isNaN(t))return dV;{if(t<=-9223372036854776e3)return WY;if(t+1>=HY)return KY}return t<0?dV:yS(t%lV|0,t/lV|0,e)}function pV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class cO extends On{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Wa.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),D(this,"name","AgoraRTCImageModeration"),D(this,"_connectionState",Eo.CONNECTING),D(this,"_sequence",0),D(this,"_moderationStartTime",void 0),D(this,"_workerConnection",void 0),D(this,"_workerMessageLengthLimit",void 0),D(this,"_qualityRatio",void 0),D(this,"_connectInfo",void 0),D(this,"_cancelTokenSource",Br.CancelToken.source()),D(this,"_retryConfig",void 0),D(this,"_moderationInterval",void 0),D(this,"_moderationTimer",null),D(this,"_moderationMode",1),D(this,"_quality",1),D(this,"_qualityTimer",null),D(this,"_ticket",void 0),D(this,"_moderationIntervalMinimum",void 0),D(this,"_uploadFailedNum",0),D(this,"_uploadNum",0),D(this,"_uploadTimer",null),D(this,"_extraInfo",void 0),D(this,"_vendor",""),D(this,"_encoder",new TextEncoder),D(this,"_moderationId",void 0),D(this,"inspectImage",()=>{if(this.connectionState!==Eo.CONNECTED)throw new rt(k.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Eo.CONNECTED?this.requestToInspectImage():b.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=hn(5,"image-moderation-"),this._workerMessageLengthLimit=j("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=j("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=j("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new hS("worker-"+this._moderationId,di),this.on(Wa.STATE_CHANGE,(i,r)=>{b.debug("[".concat(this._moderationId,"] Moderation operation :").concat(oE[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(Wa.STATE_CHANGE,oE.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new At((r,o)=>{this.on(Wa.CONNECTION_STATE_CHANGE,(c,l)=>{c===Eo.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{o(c)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),b.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Eo.CONNECTED&&this.inspectImage()}async requestAP(e,n,i){const r=j("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),o=await function(h,p,m,S){let{appId:v,areaCode:y,cname:P,sid:I,token:O,uid:M}=p;pE++;const U="moderation_plugin",W={service_name:U,json_body:JSON.stringify({appId:v,areaCode:y,cname:P,command:"allocateEdge",requestId:pE,seq:pE,sid:I,appToken:O,ts:Date.now(),uid:M+""})};let $,Q,q=h[0];return ja(async()=>{$=Date.now();const ct=await Ka(q,{data:W,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Q=Date.now()-$,ct.code!==0){const Mt=new rt(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ct.code,{retry:!0,responseTime:Q});throw b.error(Mt.toString()),Mt}const _t=JSON.parse(ct.json_body);if(_t.code!==200){const Mt=new rt(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(_t.code,", reason: ").concat(_t.reason),{code:_t.code,responseTime:Q});throw b.error(Mt.toString()),Mt}if(!_t.servers||!Array.isArray(_t.servers)||_t.servers.length===0){const Mt=new rt(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:_t.code,responseTime:Q});throw b.error(Mt.toString()),Mt}if(!_t.servers.some(Mt=>!!Mt.wss)){const Mt=new rt(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:_t.code,responseTime:Q});throw b.error(Mt.toString()),Mt}const Dt=j("IMAGE_MODERATION_WORKER_HOST");return{addressList:_t.servers.map(Mt=>{let{address:De,wss:Pe}=Mt;if(De&&Pe)return"wss://".concat(De.replace(/\./g,"-"),".").concat(Dt,":").concat(Pe,"/moderation")}).filter(Mt=>!!Mt),workerToken:_t.workerToken,vid:_t.vid,ticket:_t.appTicket,responseTime:Q}},(ct,_t)=>(qt.apworkerEvent(I,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(ct.addressList),firstSuccess:_t===0,responseTime:Q,serverIp:h[_t%h.length]}),!1),(ct,_t)=>(qt.apworkerEvent(I,{success:!1,sc:ct.data&&ct.data.code||200,serviceName:U,responseTime:Q,serverIp:h[_t%h.length]}),!!(ct.code!==k.OPERATION_ABORTED&&ct.code!==k.UNEXPECTED_RESPONSE||ct.data&&ct.data.retry)&&(q=h[(_t+1)%h.length],!0)),S)}(r,e,n,i);this.emit(Wa.STATE_CHANGE,oE.AP_CONNECTED);const{addressList:c,ticket:l}=o;return this._ticket=l,c}async connectWorker(e){this.emit(Wa.STATE_CHANGE,oE.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(pe.CONNECTED,async()=>{this.emit(Wa.STATE_CHANGE,oE.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Eo.CONNECTED}),this._workerConnection.on(pe.CLOSED,()=>{this.connectionState=Eo.CLOSED}),this._workerConnection.on(pe.FAILED,()=>{this.connectionState=Eo.CLOSED}),this._workerConnection.on(pe.RECONNECTING,()=>{this.connectionState=this.connectionState===Eo.CONNECTED?Eo.RECONNECTING:Eo.CONNECTING}),this._workerConnection.on(pe.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=UY(new Uint8Array(e.data));j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,b.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{qt.reportApiInvoke(this._connectInfo.sid||null,{name:li.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Mn.TRACER}).onError(new rt(k.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},j("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else b.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(pe.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(pe.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=Fs(this,Wa.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,n);this._workerConnection.sendMessage(i,!0,!0)}else j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:i,cname:r,cid:o,vid:c,sid:l,uid:h}=n;const p=Date.now(),m=await e.getCurrentFrameImage("image/jpeg",this.quality),S=await FM(m,i,r),v=this._sequence+"-"+o+"-"+h+"-"+p+"-"+hn(12,""),y={appId:i,cid:o,cname:r,deviceId:"",elapse:cO.intToLong(Number(p-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:S,networkType:6,osType:7,requestId:v,sdkVersion:"4.23.1",sequence:this._sequence,sid:l,timestamp:hV(p),uid:h,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;const P=xY(y);if(P.byteLength<this._workerMessageLengthLimit){if(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=function(O){for(var M=1;M<arguments.length;M++){var U=arguments[M]!=null?arguments[M]:{};M%2?pV(Object(U),!0).forEach(function(W){D(O,W,U[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(U)):pV(Object(U)).forEach(function(W){Object.defineProperty(O,W,Object.getOwnPropertyDescriptor(U,W))})}return O}({},y);delete I.jpg,b.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return P}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(e,{appId:i,cname:r,cid:o,vid:c,sid:l,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Br.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Eo.CLOSED,this.emit(Wa.STATE_CHANGE,oE.CLOSED)}}function fV(t){if(nn(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new rt(k.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new rt(k.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const zY={name:"ImageModeration",create:function(t){let{config:e}=t;return fV(e),new cO(e)}};var mV,EV,_V,gV,SV,TV,vV,yV,RV,bV,CV,AV,wV,IV,OV,NV,DV,PV,LV,kV,MV,xV,UV,VV,BV,jV,FV,GV,HV,WV,KV,zV,YV,qV,XV,JV,QV,ZV,$V,tB,eB,Lt;function nB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ca(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?nB(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nB(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}Qi.setLogger(b);let YY=(mV=ie(),EV=ie({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof Qm))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),_V=ie({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==Jm.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),gV=ie({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),SV=ie({argsMap:(t,e,n)=>[e,n]}),TV=ie({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),vV=ie({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),yV=ie({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),RV=ie(),bV=ie(),CV=ie(),AV=ie(),wV=ie(),IV=ie(),OV=ie(),NV=ie(),DV=ie(),PV=ie(),LV=ie(),kV=ie(),MV=ie(),xV=ie(),UV=ie(),VV=ie({argsMap:(t,e)=>[e]}),BV=ie(),jV=ie(),FV=ie(),GV=ie(),HV=ie(),WV=ie(),KV=ie(),zV=ie(),YV=ie({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),qV=ie(),XV=ie(),JV=ie(),QV=ie(),ZV=ie(),$V=ie(),tB=ie({reportResult:!0}),eB=ie(),Lt=class extends On{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),D(this,"store",void 0),D(this,"_uid",void 0),D(this,"_channelName",void 0),D(this,"_uintUid",void 0),D(this,"_users",[]),D(this,"_config",void 0),D(this,"_clientId",void 0),D(this,"_appId",void 0),D(this,"_sessionId",null),D(this,"_key",void 0),D(this,"_rtmConfig",{}),D(this,"_joinInfo",void 0),D(this,"_gateway",void 0),D(this,"_statsCollector",void 0),D(this,"_configDistribute",void 0),D(this,"_leaveMutex",void 0),D(this,"_publishMutex",void 0),D(this,"_renewTokenMutex",void 0),D(this,"_subscribeMutex",void 0),D(this,"_encryptionMode","none"),D(this,"_encryptionSecret",null),D(this,"_encryptionSalt",null),D(this,"_encryptDataStream",!1),D(this,"_encryptDataStreamKey",null),D(this,"_encryptDataStreamIv",null),D(this,"_proxyServer",void 0),D(this,"_turnServer",{servers:[],mode:"auto"}),D(this,"_cloudProxyServerMode","disabled"),D(this,"_isDualStreamEnabled",!1),D(this,"_defaultStreamFallbackType",void 0),D(this,"_lowStreamParameter",void 0),D(this,"_streamFallbackTypeCacheMap",new Map),D(this,"_remoteStreamTypeCacheMap",new Map),D(this,"_axiosCancelSource",Br.CancelToken.source()),D(this,"_audioVolumeIndicationInterval",void 0),D(this,"_networkQualityInterval",void 0),D(this,"_userOfflineTimeout",void 0),D(this,"_streamRemovedTimeout",void 0),D(this,"_liveTranscodeStreamingClient",void 0),D(this,"_liveRawStreamingClient",void 0),D(this,"_channelMediaRelayClient",void 0),D(this,"_networkQualitySensitivity","normal"),D(this,"_p2pChannel",void 0),D(this,"_useLocalAccessPoint",!1),D(this,"_setLocalAPVersion",void 0),D(this,"_joinAndNotLeaveYet",!1),D(this,"_numberOfJoinCount",0),D(this,"_remoteDefaultVideoStreamType",void 0),D(this,"_inspect",void 0),D(this,"_moderation",void 0),D(this,"_license",void 0),D(this,"_pendingPublishedUsers",[]),D(this,"ntpAlignErrorCount",0),D(this,"remoteInboundOffset",0),D(this,"_peerConnectionState",void 0),D(this,"_handleLocalTrackEnable",(r,o,c)=>{this.publish(r,!1).then(o).catch(c)}),D(this,"_handleLocalTrackDisable",(r,o,c)=>{this.unpublish(r).then(o).catch(c)}),D(this,"_handleUserOnline",r=>{if(j("BLOCK_LOCAL_CLIENT")&&dp(r.uid,this.channelName))return void b.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&b.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const o=this._users.find(c=>c.uid===r.uid);if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit(Ie.USER_JOINED,o));else{const c=new fu(r.uid,r.uint_id||r.uid);this._users.push(c),b.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(Ie.USER_JOINED,c)}}),D(this,"_handleUserOffline",r=>{if(j("BLOCK_LOCAL_CLIENT")&&dp(r.uid,this.channelName))return;const o=this._users.find(c=>c.uid===r.uid);o&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:GR(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),b.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(Ie.USER_LEAVED,o,r.reason))}),D(this,"_handleAddAudioOrVideoStream",(r,o,c,l,h,p,m)=>{if(j("BLOCK_LOCAL_CLIENT")&&dp(o,this.channelName))return;const S=this._users.find(y=>y.uid===o);if(!S)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));b.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(r)),this.store.subscribe(S.uid,r,void 0,void 0,void 0,Date.now());const v=r==="audio"?S.hasAudio:S.hasVideo;S._uintid||(S._uintid=h||o),r==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,r==="audio"?(S._audio_added_=!0,c!==void 0&&(S._audioSSRC=c),l!==void 0&&(S._cname=l),p&&(S._audioOrtc=p)):(S._video_added_=!0,c!==void 0&&(S._videoSSRC=c),l!==void 0&&(S._cname=l),m!==void 0&&(S._rtxSsrcId=m),p&&(S._videoOrtc=p)),(r==="audio"?S.hasAudio:S.hasVideo)&&!v&&(b.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(r)),this.safeEmit(Ie.USER_PUBLISHED,S,r)),r==="video"?qt.onGatewayStream(this._sessionId,bi.ON_ADD_VIDEO_STREAM,Cn.ON_ADD_VIDEO_STREAM,{peer:h||o,ssrc:S._videoSSRC}):qt.onGatewayStream(this._sessionId,bi.ON_ADD_AUDIO_STREAM,Cn.ON_ADD_AUDIO_STREAM,{peer:h||o,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,r,c).then(y=>{if(y&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof TS))return this._p2pChannel.unsubscribe(S,r,!0).then(()=>this._subscribe(S,r,!0).catch(P=>{b.error("[".concat(this._clientId,"] resubscribe error"),P.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,r)&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,r,!0).catch(y=>{b.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),D(this,"_handleRemoveStream",r=>{if(j("BLOCK_LOCAL_CLIENT")&&dp(r.uid,this.channelName))return;const o=this._users.find(l=>l.uid===r.uid);if(!o)return void b.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));b.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let c=()=>{};o.hasAudio&&o.hasVideo?c=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(Ie.USER_UNPUBLISHED,o,"audio"),b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(Ie.USER_UNPUBLISHED,o,"video")}:o.hasVideo?c=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(Ie.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(c=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(Ie.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof TS&&this._p2pChannel.unsubscribe(o).then(l=>{if(l)return this._gateway.unsubscribe(l,o.uid)}),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),qt.onGatewayStream(this._sessionId,bi.ON_REMOVE_STREAM,Cn.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),c()}),D(this,"_handleSetStreamLocalEnable",(r,o,c)=>{if(j("BLOCK_LOCAL_CLIENT")&&dp(o,this.channelName))return;const l=this._users.find(m=>m.uid===o);if(!l)return void b.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));b.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(c?"enabled":"disabled"," with uid ").concat(o));const h=r==="audio"?l.hasAudio:l.hasVideo;if(r==="audio"){l._trust_audio_enabled_state_=!0;const m=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===m)return;{const S=l._audio_enabled_?"enable-local-audio":"disable-local-audio";b.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(S)),this.safeEmit(Ie.USER_INFO_UPDATED,o,S)}}else{l._trust_video_enabled_state_=!0;const m=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===m)return;{const S=l._video_enabled_?"enable-local-video":"disable-local-video";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(S)),this.safeEmit(Ie.USER_INFO_UPDATED,o,S)}}const p=r==="audio"?l.hasAudio:l.hasVideo;return h!==p?!h&&p?(b.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(r)),void this.safeEmit(Ie.USER_PUBLISHED,l,r)):(r==="video"&&l._videoTrack&&l._videoTrack._destroy(),r==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,r),b.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(r)),void this.safeEmit(Ie.USER_UNPUBLISHED,l,r)):void 0}),D(this,"_handleMuteStream",(r,o,c)=>{if(j("BLOCK_LOCAL_CLIENT")&&dp(r,this.channelName))return;b.debug("[".concat(this._clientId,"] receive mute message"),r,o,c);const l=this._users.find(m=>m.uid===r);if(!l)return void b.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const h=o==="audio"?l.hasAudio:l.hasVideo;if(o==="audio"){l._trust_audio_mute_state_=!0;const m=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===m)return;{const S=l._audio_muted_?"mute-audio":"unmute-audio";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(S)),this.safeEmit(Ie.USER_INFO_UPDATED,r,S)}}else{l._trust_video_mute_state_=!0;const m=l._video_muted_;if(l._video_muted_=c,l._video_muted_===m)return;{const S=l._video_muted_?"mute-video":"unmute-video";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(S)),this.safeEmit(Ie.USER_INFO_UPDATED,r,S)}}const p=o==="audio"?l.hasAudio:l.hasVideo;if(h!==p){if(!h&&p)return(o==="audio"?l._audioSSRC:l._videoSSRC)?(b.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(o)),void this.safeEmit(Ie.USER_PUBLISHED,l,o)):void b.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),o==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,o),b.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(o)),this.safeEmit(Ie.USER_UNPUBLISHED,l,o)}}),D(this,"_handleP2PLost",async r=>{b.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():b.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),D(this,"_handleTokenWillExpire",()=>{b.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Ie.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),D(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),b.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),D(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Ie.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Ie.NETWORK_QUALITY,r)}),D(this,"_handleP2PAddAudioOrVideoStream",(r,o,c,l)=>{const h=this._users.find(m=>m.uid===o);if(!h)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));b.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(r)),this.store.subscribe(h.uid,r,void 0,void 0,void 0,Date.now());const p=r==="audio"?h.hasAudio:h.hasVideo;r==="audio"?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,r==="audio"?(h._audio_added_=!0,c!==void 0&&(h._audioSSRC=c),l!==void 0&&(h._audioMid=l)):(h._video_added_=!0,c!==void 0&&(h._videoSSRC=c),l!==void 0&&(h._videoMid=l)),(r==="audio"?h.hasAudio:h.hasVideo)&&!p&&(b.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(r)),this.safeEmit(Ie.USER_PUBLISHED,h,r)),this._p2pChannel.hasPendingRemoteMedia(h,r)&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,r,!0).catch(m=>{b.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=t,this._clientId=e||hn(5,"client-"),this.store=new jK(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Qi("client-leave",this._clientId),this._publishMutex=new Qi("client-publish",this._clientId),this._renewTokenMutex=new Qi("client-renewtoken",this._clientId),this._subscribeMutex=new Qi("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),b.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(po," build: ").concat(eI,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{G0(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(r){b.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new gS(this.store),this._statsCollector.onStatsException=(r,o,c)=>{b.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(o,", uid: ").concat(c)),this.safeEmit(Ie.EXCEPTION,{code:r,msg:o,uid:c})},this._statsCollector.onUploadPublishDuration=(r,o,c,l)=>{const h=this._users.find(p=>p.uid===r);h&&qt.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:o,videoPublishDuration:c,peer:h._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new pY(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||di,httpRetryConfig:t.httpRetryConfig||di,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new yY(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},pu("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new TS(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,r){let o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];$e("JOIN_GATEWAY_USE_443PORT_ONLY",o),$e("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof LI&&(l.use443PortOnly=o,l.tryDoubleDomain=c),async function(h,p,m){UR.get(h)||UR.set(h,[]),VR.get(h)||VR.set(h,p),Hc.get(h)||Hc.set(h,0);const S=UR.get(h),v=VR.get(h);if(!S||!v)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Hc.get(h)===v){const M=Qg();S.push(M),await M.promise}Hc.set(h,Hc.get(h)+1);for(var y=arguments.length,P=new Array(y>3?y-3:0),I=3;I<y;I++)P[I-3]=arguments[I];const O=await m(...P);return Hc.set(h,Hc.get(h)-1),Hc.get(h)===v-1&&S.length>0&&(S[0].resolve(),S.shift()),Hc.get(h)===0&&(UR.set(h,[]),VR.set(h,0),Hc.set(h,0)),O}("client.join",j("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,r)}async join(t,e,n,i,r){const o=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(KR||KR||(KR=(window.location.protocol.split(":")[0]||"").toUpperCase(),KR))==="HTTPS",l=iM()?window.isSecureContext:"Browser Not Support";(!iM()&&!c||!window.isSecureContext)&&b.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),b.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),qt.setAppId(t);try{if(!n&&n!==null)throw new rt(k.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ui(n,"token",1,2047),Ui(t,"appid",1,2047),pb(e),i&&fb(i),r&&Ui(r,"optionalInfo",1,2047)}catch(I){throw qt.reportApiInvoke(np(),{name:li.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Mn.TRACER}).onError(I),I}if(this._leaveMutex.isLocked&&(b.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),b.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const I=new rt(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw qt.reportApiInvoke(np(),{name:li.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Mn.TRACER}).onError(I),I}this._gateway.state="CONNECTING";const h=await Q2({appId:t,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new rt(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const p=(h==null?void 0:h.sid)||np();b.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(o)),this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId);const m=qt.reportApiInvoke(p,{id:this._clientId,name:li.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Mn.TRACER}),S=ca(ca(ca({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!h},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:j("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(S.stringUid=i,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async I=>{const O=function(){const $=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Q=new Uint8Array(new ArrayBuffer($.length));for(let q=0;q<$.length;q+=1)Q[q]=$.charCodeAt(q);return Q}(),M=await window.crypto.subtle.importKey("spki",O,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),U=j0(I),W=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},M,U);return function($){let Q="";for(let q=0;q<$.length;q+=1)Q+=String.fromCharCode($[q]);return window.btoa(Q)}(new Uint8Array(W))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new rt(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const I=new TextEncoder,O=j("USE_PURE_ENCRYPTION_MASTER_KEY")?I.encode(S.appId+this._encryptionSecret+this._encryptionSecret):I.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(M,U,W){const $=await window.crypto.subtle.importKey("raw",U,"PBKDF2",!1,["deriveBits","deriveKey"]),Q=M==="aes-128-gcm2"?128:256,q=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:W},$,Q+96);return new Uint8Array(q).subarray(Q/8)}(this._encryptionMode,O,ep(this._encryptionSalt)),this._encryptDataStreamKey=await async function(M,U,W){const $=await window.crypto.subtle.importKey("raw",U,"PBKDF2",!1,["deriveBits","deriveKey"]),Q=M==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:W},$,{name:"AES-GCM",length:Q},!0,["encrypt","decrypt"])}(this._encryptionMode,O,ep(this._encryptionSalt))}else l?b.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):b.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,b.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:S.stringUid});const v=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&v===this._sessionId&&qt.joinChannelTimeout(this._sessionId,5)},5e3);try{var y;let I;const O=S.cloudProxyServer;if(Ct(y=["proxy3","proxy4","proxy5"]).call(y,O)){const Q=j("PROXY_SERVER_TYPE3");Array.isArray(Q)?S.proxyServer=Q[0]:S.proxyServer=Q}if(qt.setProxyServer(S.proxyServer),b.setProxyServer(S.proxyServer),this.store.requestAPStart(),h){if(b.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(h.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=h.intUid),I={gatewayInfo:h.ap.gatewayInfo},j("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(h.ap.proxyInfo.addresses.length===0)b.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Q=(await HU(h.ap.proxyInfo,h.ap.gatewayInfo.uid)).map(q=>({turnServerURL:q.address,tcpport:q.tcpport||Ki.tcpport,udpport:q.udpport||Ki.udpport,username:q.username||Ki.username,password:q.password||Ki.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:Q}}tV(h,S.stringUid)}else{if(S.stringUid&&!S.uid){let Q;[Q,I]=await At.all([_2(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||di,this.store),E2(S,this._axiosCancelSource.token,this._config.httpRetryConfig||di,!0,this.store)]),b.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(Q)),S.uid=Q,I.gatewayInfo.uid=Q,I.gatewayInfo.res.uid=Q}else I=await E2(S,this._axiosCancelSource.token,this._config.httpRetryConfig||di,!0,this.store);if(!this._joinAndNotLeaveYet)throw new rt(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(dS.UPDATE_BITRATE_LIMIT,Q=>{this._p2pChannel.updateBitrateLimit(Q)}),this._configDistribute.on(dS.UPDATE_CLIENT_ROLE_OPTIONS,Q=>{this._setClientRoleOptions(Q)})},0),this._key=n||t;const M=I.gatewayInfo,U=S.uid?S.uid:M.uid;this._joinInfo=ca(ca({},S),{},{cid:M.cid,uid:U,vid:M.vid,apResponse:M.res,apGatewayAddress:M.apGatewayAddress,uni_lbs_ip:M.uni_lbs_ip,gatewayAddrs:M.gatewayAddrs}),this.store.intUid=U,this.store.cid=M.cid;const W=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new rt(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));m.onSuccess(W),this._appId=t,this._channelName=S.cname,this._uid=W,this.store.uid=W,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Gi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const $=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return b.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat($)),setTimeout(()=>{b.startUpload()},5e3),this.store.joinEnd(),P=this,Ct(lp).call(lp,P)||lp.push(P),this._cloudProxyServerMode==="disabled"&&Ge().supportWebCrypto&&j("ENABLE_PRELOAD")&&oO(this._joinInfo),W}catch(I){const O=Array.isArray(I)?I[0]:I;throw O&&O.code===k.OPERATION_ABORTED?b.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),O):b.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),O),O.code!==k.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),m.onError(O),O}var P}_joinGateway(){if(!this._joinInfo||!this._key)throw new rt(k.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!j("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){b.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Gi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=lp.indexOf(e);n!==-1&&lp.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return b.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Xe.LEAVE),b.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Qm))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new rt(k.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new rt(k.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof Qm))throw new rt(k.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new rt(k.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}b.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(r=>{const o=this._configDistribute.getBitrateLimit();r instanceof vn&&o&&r.setBitrateLimit(o.uplink)});try{await this._publishHighStream(n),b.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw b.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(t){nn(t.id,"id",0,65535,!0),Yl(t.ordered,"ordered"),Ui(t.metadata,"metadata",0,512),b.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===t.id)!==-1)throw new rt(k.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new rt(k.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new rt(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return a2(r,!1)}(t),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw b.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new rt(k.CREATE_DATACHANNEL_ERROR);try{await At.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==k.DISCONNECT_P2P)throw r}}return b.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw b.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new rt(k.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof Qm))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);b.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(qn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),b.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw b.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),b.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),b.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(i=>"".concat(i.id))))}catch(n){throw b.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof fu)){const i=this.remoteUsers.find(r=>r.uid===t);if(!i)throw new rt(k.INVALID_REMOTE_USER,"user is not in the channel");t=i}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(Si(e,"mediaType",["audio","video"]),this.store.useP2P)throw new rt(k.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new rt(k.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===Vt.AUDIO,i=e===Vt.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:o,ortc:c,rtxSsrcId:l,cname:h,uint_id:p}=await this._gateway.presubscribe(t,e,!0);if(o==null)throw new rt(k.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find(v=>v.uid===t);m||(m=new fu(t,p||t),m._is_pre_created=!0,this._users.push(m)),h&&(m._cname=h),m._uintid||(m._uintid=p||t),n&&(m._audioSSRC=o,m._audio_pre_subscribed=!0,c&&(m._audioOrtc=c)),i&&(m._videoSSRC=o,m._video_pre_subscribed=!0,c&&(m._videoOrtc=c),l!=null&&(m._rtxSsrcId=l)),b.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o)),await this._p2pChannel.subscribe(m,e,o,l,c);const S=n?m._audioTrack:m._videoTrack;if(!S)throw new rt(k.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),i&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),S}catch(o){throw b.error("[".concat(this._clientId,"] presub user ").concat(t," error"),o),o}finally{r()}}async _subscribeDataChannel(t,e){var n;if(nn(e,"channelId",0,65535,!0),!this._joinInfo)throw new rt(k.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===t))throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new rt(k.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new rt(k.INVALID_REMOTE_USER,"user is not published");const r=(n=t._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===e);if(!r)throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new rt(k.REMOTE_USER_IS_NOT_PUBLISHED);const o=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(t,[r]);if(l&&Ct(l).call(l,r.id))try{var c;if(typeof r._originDataChannelId!="number")throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new rt(k.CREATE_DATACHANNEL_ERROR);const h={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(c=r.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(t.uid,h,!0),await r._waitTillOpen()}catch(h){if((h==null?void 0:h.code)!==k.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[r]),h;await this._p2pChannel.unsubscribeDataChannel(t,[r]),this._p2pChannel.setPendingRemoteDataChannel(t,r.id)}return b.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),r}finally{o()}}async _p2pSubscribe(t,e,n){if(Si(e,"mediaType",["audio","video"]),!this._joinInfo)throw new rt(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(o=>o===t)){const o=new rt(k.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),o}if(!t.hasAudio&&!t.hasVideo){const o=new rt(k.INVALID_REMOTE_USER,"user is not published");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),o}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const o=new rt(k.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),o}const r=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const c=e==="audio"?t._audioSSRC:t._videoSSRC,l=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,c,l)}catch(c){throw c}b.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{b.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const o=e==="audio"?t._audioTrack:t._videoTrack;if(!o)throw new rt(k.UNEXPECTED_ERROR,"can not find remote track in user object");return o}catch(o){throw b.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),o),o}finally{r()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(Si(e,"mediaType",["audio","video"]),!this._joinInfo)throw new rt(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===t)){const p=new rt(k.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),p}if(!t.hasAudio&&!t.hasVideo){const p=new rt(k.INVALID_REMOTE_USER,"user is not published");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),p}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const p=new rt(k.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),p}let r=e==="audio"?t._audioSSRC:t._videoSSRC,o=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?Vt.AUDIO:Vt.VIDEO,ssrcId:r};const h=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const m=e==="audio"?t._audioSSRC:t._videoSSRC;m!==void 0&&m!==r&&(r=m,o=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?Vt.AUDIO:Vt.VIDEO,ssrcId:r}),$i.markSubscribeStart(this.store.clientId,r),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,r,c,o);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(t.uid,l,!0)}catch(S){if((S==null?void 0:S.code)!==k.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),S;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m==null?void 0:m.code,t,e),m}b.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(m=>{b.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});const p=e==="audio"?t._audioTrack:t._videoTrack;if(!p)throw new rt(k.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw b.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),p),p}finally{h()}}async massSubscribe(t){if(ql(t,"subscribeList"),!this._joinInfo)throw new rt(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:h,mediaType:p}=l;return"user: ".concat(h==null?void 0:h.uid,", mediaType: ").concat(p)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:h,mediaType:p}=l;return{user:h,mediaType:p}}),o=await this._p2pChannel.globalLock();try{var c;for(let h=t.length-1;h>=0;h--){const p=t[h],{user:m,mediaType:S}=p;if(Si(S,"mediaType",["audio","video"]),!m){const I=new rt(k.INVALID_PARAMS,"user property does not exist in subscribeList item");throw b.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===m)){const I=new rt(k.INVALID_REMOTE_USER,"user is not in the channel");b.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),r[h].error=I,t.splice(h,1);continue}if(S==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||S==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){const I=new rt(k.REMOTE_USER_IS_NOT_PUBLISHED);b.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(S,", remote user is not published")),r[h].error=I,t.splice(h,1);continue}const y=Ci.Video|Ci.LwoVideo,P=n.get(m);if(P){if(S==="video"?P&y:P&Ci.Audio){t.splice(h,1),b.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(S," twice"));continue}n.set(m,P|(S==="video"?y:Ci.Audio))}else n.set(m,S==="video"?y:Ci.Audio)}for(let h=t.length-1;h>=0;h--){const p=t[h],{user:m,mediaType:S}=p,v=Ci.Video|Ci.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,S)){await this._p2pChannel.unmuteRemoteNoLock(m,S);const y=n.get(m);n.set(m,S==="video"?y^v:y^Ci.Audio),t.splice(h,1)}}this.store.massSubscribe(t.map(h=>({userId:h.user.uid,type:h.mediaType})),e);let l=qi(c=Array.from(n.entries())).call(c,(h,p)=>{let[m,S]=p;if(S===0)return h;const v={stream_id:m.uid,stream_type:S};return S&Ci.Audio&&(v.audio_ssrc=m._audioSSRC),S&Ci.Video&&(v.video_ssrc=m._videoSSRC),h.push(v),h},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(p=>{let{user:m,mediaType:S}=p;return{user:m,mediaType:S,ssrcId:S===Vt.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:S===Vt.VIDEO?m._rtxSsrcId:void 0}}));const h=new Map;if(l=l.filter(p=>p.video_ssrc&&!this._p2pChannel.isPreSubScribe(p.video_ssrc)||p.audio_ssrc&&!this._p2pChannel.isPreSubScribe(p.audio_ssrc)||!p.video_ssrc&&!p.audio_ssrc),l.length>0){const p=await this._gateway.subscribeAll(l,!0);((p==null?void 0:p.users)||[]).forEach(m=>{let{stream_id:S,video_error_code:v,audio_error_code:y,error_code:P}=m;(v||y||P)&&h.set(S,{video_error_code:v,audio_error_code:y,error_code:P})})}if(Array.from(h.entries()).length>0){const p=[];Array.from(h.entries()).forEach(m=>{let[S,v]=m;const y=this.remoteUsers.find(P=>P.uid===S);if(y){let P;v.error_code||v.video_error_code&&v.audio_error_code?P=void 0:v.video_error_code?P=Vt.VIDEO:v.audio_error_code&&(P=Vt.AUDIO),p.push({user:y,mediaType:P})}}),p.length>0&&await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of r){const m=h.get(p.user.uid);if(m){const S=m.error_code||p.mediaType==="audio"&&m.audio_error_code||p.mediaType==="video"&&m.video_error_code;if(S){const v=uS(S);b.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(v.desc)),p.error=new rt(k.SUBSCRIBE_FAILED,"code ".concat(S,": ").concat(v.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(r.filter(p=>!p.error).map(p=>({userId:p.user.uid,type:p.mediaType})),void 0,Date.now()),r.forEach(p=>{var m;qt.subscribe(this.store.sessionId,{succ:!!p.error,ec:((m=p.error)===null||m===void 0?void 0:m.code)||null,video:p.mediaType===Vt.VIDEO,audio:p.mediaType===Vt.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===Vt.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(p.user._videoSSRC)},!0)}),b.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(p=>{let{user:m,mediaType:S}=p;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(S)}).join("; "))),r}catch(h){throw await this._p2pChannel.massUnsubscribeNoLock(t),h}}finally{o(),i()}}async unsubscribe(t,e,n){if(!(t instanceof fu)){const o=this.remoteUsers.find(c=>c.uid===t);if(!o)throw new rt(k.INVALID_REMOTE_USER,"user is not in the channel");t=o}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&Si(e,"mediaType",["audio","video"]),!this._joinInfo)throw new rt(k.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(o=>o===t)){const o=new rt(k.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),o}b.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const o=await this._p2pChannel.unsubscribe(t,e);o&&await this._gateway.unsubscribe(o,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&GR(this._users,t),b.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(o){if(o.code===k.DISCONNECT_P2P)return void b.warning("disconnecting p2p, abort unsubscribe request.");throw b.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),o.toString()),o}finally{r()}}async _unsubscribeDataChannel(t,e){if(e&&nn(e,"id",0,65535,!0),!this._joinInfo)throw new rt(k.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new rt(k.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}let i;if(typeof e=="number"){const r=t._dataChannels.find(o=>o.id===e);r&&(i=[r])}else i=t._dataChannels;if(i===void 0){const r=new rt(k.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),r}b.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(t,i);r&&await this._gateway.unsubscribeDataChannel(r,t.uid),b.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===k.DISCONNECT_P2P)return void b.warning("disconnecting p2p, abort unsubscribe request.");throw b.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}}async massUnsubscribe(t){if(ql(t,"unsubscribeList"),!this._joinInfo)throw new rt(k.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");b.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:r}=t[n];if(!i){const l=new rt(k.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw b.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(Si(r,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===i)){b.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const c=Ci.Video|Ci.LwoVideo;if(e.has(i)){const l=e.get(i);let h;switch(r){case"video":h=l&c;break;case"audio":h=l&Ci.Audio;break;default:h=l&(Ci.Audio|c)}if(h){b.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),t.splice(n,1);continue}r?r==="audio"?e.set(i,l|Ci.Audio):r==="video"&&e.set(i,l|c):e.set(i,l|Ci.Audio|c)}else r?r==="audio"?e.set(i,Ci.Audio):r==="video"&&e.set(i,c):e.set(i,Ci.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),b.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(i=>{let{user:r,mediaType:o}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(o,";")}).join()))}catch(n){if(n.code===k.DISCONNECT_P2P)return void b.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw b.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new at(k.INVALID_PARAMS);kn(n.width)||V0(n.width,"streamParameter.width"),kn(n.height)||V0(n.height,"streamParameter.height"),kn(n.framerate)||V0(n.framerate,"streamParameter.framerate"),kn(n.bitrate)||nn(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&b.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),b.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Et.LocalVideoLowTrack)}async enableDualStream(){if(!Ge().supportDualStream)throw qt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new rt(k.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new rt(k.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw qt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,qt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),b.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new rt(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Et.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw qt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,qt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),b.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){Si(i,"role",["audience","host"])}(t),e&&G0(e),this.mode==="rtc"||this.mode==="p2p")throw b.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new rt(k.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new rt(k.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new rt(k.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&j("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",Hi.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),b.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&G0(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{b.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(Ui(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new rt(k.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new rt(k.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,qt.setProxyServer(this._proxyServer),b.setProxyServer(this._proxyServer),b.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new rt(k.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new rt(k.INVALID_OPERATION,"You have already set the proxy")}if(eS(t))return this._turnServer={servers:t,mode:"original-manual"},void b.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>K1(n)),this._turnServer={servers:t,mode:"manual"},b.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new rt(k.INVALID_OPERATION,"you should set license before join channel");if(Ui(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new rt(k.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,b.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new rt(k.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new rt(k.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new rt(k.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new rt(k.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,b.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new rt(k.INVALID_OPERATION,"Stop proxy server after leave channel");qt.setProxyServer(),b.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",b.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new rt(k.INVALID_PARAMS,"accessPoints is required.");ql(t.accessPoints.serverList,"accessPoints.serverList"),Ui(t.accessPoints.domain,"accessPoints.domain");const e=(v,y)=>{nn(v,y,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new rt(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");j("CLOSE_AFB_FOR_LOCAL_AP")&&($e("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),$e("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,o=t.accessPoints.serverList.map(v=>i.test(v)?"".concat(v.replace(/\./g,"-"),".").concat(r):v),c=o.map(v=>"".concat(v,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,$e("WEBCS_DOMAIN",c),$e("WEBCS_DOMAIN_BACKUP_LIST",c),$e("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(ql(t.report.hostname,"report.hostname"),$e("EVENT_REPORT_DOMAIN",t.report.hostname[0]),$e("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):($e("EVENT_REPORT_DOMAIN",o[0]),$e("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),$e("STATS_COLLECTOR_PORT",l),t.report?$e("ENABLE_EVENT_REPORT",!0):$e("ENABLE_EVENT_REPORT",!1);let h="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(ql(t.log.hostname,"log.hostname"),h=t.log.hostname[0]):h=o[0];let p=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),p=t.log.port),$e("LOG_UPLOAD_SERVER","".concat(h,":").concat(p));let m=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(ql(t.cds.hostname,"cds.hostname"),m=t.cds.hostname):m=o;let S=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),S=t.cds.port),$e("CDS_AP",m.map(v=>"".concat(v,":").concat(S))),t.cds?$e("ENABLE_CONFIG_DISTRIBUTE",!0):$e("ENABLE_CONFIG_DISTRIBUTE",!1),b.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(ql(t,"serverList"),Ui(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new rt(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,$e("WEBCS_DOMAIN",t),$e("WEBCS_DOMAIN_BACKUP_LIST",t),$e("GATEWAY_DOMAINS",[e]),$e("EVENT_REPORT_DOMAIN",t[0]),$e("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),$e("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),b.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Si(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw b.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else b.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Si(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(i=>i.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw b.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}b.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Si(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw b.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}b.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,i){(function(o){Si(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Ui(e,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(Ct(r).call(r,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new rt(k.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new rt(k.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Yl(i,"encryptDataStream"),!Ct(r).call(r,t))throw new rt(k.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||b.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=au(n))}async renewToken(t){if(Ui(t,"token",1,2047),!this._key||!this._joinInfo)throw new rt(k.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(j("USE_NEW_TOKEN")){b.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await vY(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||di);b.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:i})}else b.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});b.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,b.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?b.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(Ie.VOLUME_INDICATOR,t)},j("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new rt(k.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new rt(k.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new rt(k.LIVE_STREAMING_TASK_CONFLICT);const n=e?Jl.TRANSCODE:Jl.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(Jl.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new rt(k.INVALID_PARAMS,"can not find live streaming url to stop");await At.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){b2(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){b2(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof TS&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new rt(k.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const r=new TextEncoder;t.payload=r.encode(t.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ct(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,t.payload=await async function(r,o,c){var l;const h=qi(l=Array.from(c)).call(l,(I,O)=>I+O,0),p={serverTs:0,seq:FK++,length:c.length,checkSum:h},m=new Uint8Array($1(h,2)),S=new ArrayBuffer(10),v=new DataView(S);v.setUint32(0,p.serverTs),v.setUint16(4,p.seq),v.setUint16(6,p.length),v.setUint16(8,p.checkSum);const y=16-c.length%16;c=q1(c,new Uint8Array(y));const P=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:128,additionalData:m},o,c);return q1(new Uint8Array(S),new Uint8Array(P))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new rt(k.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ce.DATA_STREAM,{payload:au(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-DY},!n)}sendMetadata(t){if(!this._joinInfo)throw new rt(k.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new rt(k.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ce.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:au(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(JK),!this._joinInfo)throw new rt(k.INVALID_OPERATION,"can not send custom report, not joined");await qt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Si(e.spatialLayer,"spatialLayer",[0,1,2,3]),Si(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw b.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(Yl(e,"apRTM"),nn(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,b.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(b.debug("[".concat(this._clientId,"] reset client")),function(t){const e=rE.indexOf(t);e!==-1&&rE.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Br.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&$2(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&qt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Qi("client-publish",this._clientId),this._subscribeMutex=new Qi("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const i=t||np();t?b.debug("[".concat(this._clientId,"] new Session ").concat(i)):b.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=t?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,qt.addSid(i);const o={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};qt.sessionInit(this._sessionId,ca({cname:e.channel,appid:e.appId},o)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new rt(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new rt(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");b.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(qn.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(o){if(o.code!==k.DISCONNECT_P2P)throw n.throw(o),o}await n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof vn&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(o=>{b.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===k.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new rt(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new rt(k.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));b.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(o){if(o.code!==k.DISCONNECT_P2P)throw n.throw(o),o}n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===k.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new rt(k.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},pu("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,o)=>{qt.reportApiInvoke(this._sessionId,{name:li.ON_LIVE_STREAM_ERROR,options:[r,o],tag:Mn.TRACER}).onSuccess(),this.safeEmit(Ie.LIVE_STREAMING_ERROR,r,o)},n.onLiveStreamWarning=(r,o)=>{qt.reportApiInvoke(this._sessionId,{name:li.ON_LIVE_STREAM_WARNING,options:[r,o],tag:Mn.TRACER}).onSuccess(),this.safeEmit(Ie.LIVE_STREAMING_WARNING,r,o)},n.on(DI.REQUEST_WORKER_MANAGER_LIST,(r,o,c)=>{if(!this._joinInfo)return c(new rt(k.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,h,p,m){const S=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(v=>h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(v+"/api/v1?action=uap"):"https://".concat(v,"/api/v1?action=uap"));return await mY(S,l,h,p,m)})(r,this._joinInfo,this._axiosCancelSource.token,di).then(o).catch(c)}),n};return t===Jl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new rt(k.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},pu("ChannelMediaRelay").create(t));i.on("state",r=>{r===ss.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(Ie.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(Ie.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,o)=>{var c;r==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(o))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,r=[];if(e){const o=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{n.every(h=>h.uid!==c._uintid||h.stream_id!==l.id)&&o.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(n)&&n.length>0&&n.forEach(o=>{const{uid:c,stream_id:l,ordered:h,max_retrans_times:p,metadata:m}=o,S=this._users.find(v=>v._uintid===c);if(!S)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(b.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),Ct(r).call(r,S)||r.push(S),S._uintid||(S._uintid=c),S._dataChannels.findIndex(v=>v.id===o.stream_id)===-1){const v={id:l,ordered:!!h,maxRetransmits:p,metadata:m},y=function(P){return a2(P,!0)}(v);S._dataChannels.push(y),b.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published datachannel")),e||this.safeEmit(Ie.USER_PUBLISHED,S,"datachannel",v)}this._p2pChannel.hasPendingRemoteDataChannel(S,o.stream_id)&&(b.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(S.uid," after reconnect.")),this._subscribeDataChannel(S,o.stream_id).catch(v=>{b.error("[".concat(this._clientId,"] resubscribe datachannel error"),v.toString())}))}),e&&(this.safeEmit(Ie.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(o=>{const{uid:c,stream_id:l}=o,h=this._users.find(m=>m._uintid===c);if(!h)return void b.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const p=h._dataChannels.find(m=>m.id===o.stream_id);p&&(b.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(h,[p]).then(m=>{if(h._dataChannels=h._dataChannels.filter(S=>S!==p),m)return this._gateway.unsubscribeDataChannel(m,h.uid)}),b.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(p.id)),this.safeEmit(Ie.USER_UNPUBLISHED,h,"datachannel",p._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){b.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(Ie.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),n()}}else b.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Di.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void b.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(i=>{const{value:r,type:o,expires:c}=e[i];c&&c<=n||o||bI()||!Object.prototype.hasOwnProperty.call(qR,i)||(Fa[i]=r,Nn[i]=r,b.debug("Update gateway parameters from config distribute",i,r))})}catch(e){b.error("Error update config from local cache",e.message)}})()}),this._gateway.on(Di.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Di.CONNECTION_STATE_CHANGE,(t,e,n)=>{var i;if(n===Xe.FALLBACK)return;const r=()=>{this.safeEmit(Ie.CONNECTION_STATE_CHANGE,t,e,n)};if(qt.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:li.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:Mn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),b.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var o;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(h=>{b.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),h)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(h=>{b.warning("[".concat(this._clientId,"] auto set remote stream type failed"),h)})}),this._remoteDefaultVideoStreamType!==void 0&&((o=this._joinInfo)===null||o===void 0?void 0:o.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{b.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{b.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{b.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(b.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Vt.AUDIO,!1)),c._trust_video_mute_state_||(b.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Vt.VIDEO,!1)),c._trust_audio_enabled_state_||(b.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(b.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(b.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(b.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(b.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(Di.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new rt(k.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await Q2(ca(ca({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,tV(i),this._joinInfo.preload=!0):(n=await YI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||di,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:c}=o;const[l,h]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:h}):r.push({host:l,port:h})}),t(r)}catch(n){e(n)}}),this._gateway.on(Di.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Ie.NETWORK_QUALITY,t)}),this._gateway.on(Di.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(Ie.STREAM_TYPE_CHANGED,t,e),qt.reportApiInvoke(this._sessionId,{name:li.STREAM_TYPE_CHANGE,options:[t,e],tag:Mn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(Di.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(Di.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let i=await this._p2pChannel.getEstablishParams();j("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(t)),e(i)}catch(i){n(i)}}),this._gateway.on(Di.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;t.attributes?n=t.attributes.userAttributes.preSubSsrcs:b.debug("no attributes in joinResponse");const i=XU(t.ortc,e,n);this._p2pChannel.connect(i)}),this._gateway.on(Di.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:r,cid:o}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(r),icePwd:"".concat(o,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=j("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Ne.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ne.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ne.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Ne.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Ne.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Ne.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Ne.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ne.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ne.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Vt.AUDIO,!0)),this._gateway.signal.on(Ne.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Vt.AUDIO,!1)),this._gateway.signal.on(Ne.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Vt.VIDEO,!0)),this._gateway.signal.on(Ne.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Vt.VIDEO,!1)),this._gateway.signal.on(Ne.RECEIVE_METADATA,t=>{const e=ep(t.metadata);this.safeEmit(Ie.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(Ne.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=ep(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ct(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<10)throw new rt(k.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(10));n=await async function(o,c,l){const h=l.subarray(0,10),p=h.slice(8,10),m=(p[0]<<8)+p[1],S=(h[6]<<8)+h[7],v=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o,tagLength:128,additionalData:new Uint8Array($1(m,2))},c,l.subarray(10));return new Uint8Array(v).subarray(0,S)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(t.ordered||t.syncWithAudio){const r=this._p2pChannel.getStats(),o=this.remoteUsers.find(l=>l.uid===t.uid),c=r==null?void 0:r.audioRecv.find(l=>l.ssrc===(o==null?void 0:o._audioSSRC));i=c==null?void 0:c.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),PY(ca(ca({},t),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Ne.ON_CRYPT_ERROR,()=>{ou(()=>{b.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Ie.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ne.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{b.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Xe.TOKEN_EXPIRE),this.safeEmit(Ie.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ne.ON_STREAM_FALLBACK_UPDATE,t=>{b.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Ie.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Ne.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),b.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Ne.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Ne.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(le.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case ce.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var n,i;const o=r.some(h=>{let{stream_type:p}=h;return p===Qe.Audio}),c=r.some(h=>{let{stream_type:p}=h;return p!==Qe.Audio}),l=r.some(h=>{let{stream_type:p}=h;return p===Qe.Screen||p===Qe.ScreenLow});e.state==="offer"&&qt.publish(this._joinInfo.sid,{eventElapse:$i.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:k.TIMEOUT,audio:o,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:o?(n=r.find(h=>{let{stream_type:p}=h;return p===Qe.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=r.find(h=>{let{stream_type:p}=h;return p!==Qe.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case ce.SUBSCRIBE:e&&qt.subscribe(this._joinInfo.sid,{succ:!1,ec:k.TIMEOUT,audio:e.stream_type===Vt.AUDIO,video:e.stream_type===Vt.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:$i.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(Ne.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(Ne.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;j("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(i=>!dp(i.string_id||i.stream_id,this.channelName)));const e=[],n=[];for(const i of t.users){let r=this._users.find(m=>m._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new fu(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.getListeners(Ie.PUBLISHED_USER_LIST).length===0&&(b.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(Ie.USER_JOINED,r)));const o=Ci.Audio&i.stream_type,c=(Ci.Video|Ci.LwoVideo)&i.stream_type,l=!!(65280&i.stream_type),h=o&&r.hasAudio,p=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),o&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),o&&!h&&this.getListeners(Ie.PUBLISHED_USER_LIST).length===0&&(b.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(Ie.USER_PUBLISHED,r,"audio")),c&&!p&&this.getListeners(Ie.PUBLISHED_USER_LIST).length===0&&(b.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(Ie.USER_PUBLISHED,r,"video")),(o&&!h||c&&!p||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),o&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(b.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{b.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(Ie.PUBLISHED_USER_LIST).length>0?j("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(b.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(Ie.PUBLISHED_USER_LIST,e)):b.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(Ne.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof TS&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var i;return Ct(i=Object.keys(XR)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Ne.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(qn.PUBLISH,(t,e,n)=>{const{uid:i}=t;t.forEach(r=>{const{kind:o,ssrcs:c,mid:l,isMuted:h}=r;this._handleP2PAddAudioOrVideoStream(o,i,c[0].ssrcId,l);const p=this._users.find(m=>m.uid===i);return p&&this.store.useP2P?this._p2pChannel.mockSubscribe(p,o,c[0].ssrcId,l).then(()=>{e()}).catch(n):e(),this._handleMuteStream(i,o,!!h)})}),this._gateway.signal.on(qn.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}catch(r){n(r)}}),this._gateway.signal.on(le.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(qn.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:r}=t,o=this._users.find(c=>c.uid===r);if(!o)return b.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();try{i.forEach(async c=>{let{stream_type:l}=c;const h=l===Qe.Audio?Vt.AUDIO:Vt.VIDEO;await this._p2pChannel.unsubscribe(o,h),this._handleMuteStream(r,h,!0)}),e()}catch(c){n(c)}}}),this._gateway.signal.on(qn.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case du.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,Vt.VIDEO,!0);break;case du.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,Vt.AUDIO,!0);break;case du.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,Vt.VIDEO,!1);break;case du.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,Vt.AUDIO,!1)}}),this._gateway.signal.on(qn.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:r}=t;i!==wr.SEND_ONLY||r?e(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){n(i)}}),this._gateway.signal.on(qn.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on($t.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:i}=t;e(await this._gateway.sendExtensionMessage(qn.RESTART_ICE,t,i===wr.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on($t.LocalCandidate,t=>{this._gateway.sendExtensionMessage(qn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on($t.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(qn.CONTROL,t,!0),e()}catch(i){n(i)}}),this._p2pChannel.on($t.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===k.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on($t.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===k.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on($t.StateChange,(t,e)=>{e===Je.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on($t.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(Ie.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on($t.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===k.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on($t.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===k.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on($t.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on($t.RequestRePublishDataChannel,(t,e,n)=>{At.all(t.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(o=>{this._uid&&this._gateway.publishDataChannel(this._uid,o,!0)})}catch(o){if(o.code!==k.DISCONNECT_P2P)throw o}})).then(e).catch(n)}),this._p2pChannel.on($t.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:i,kind:r}of t)r===Vt.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){n(i)}}),this._p2pChannel.on($t.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on($t.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on($t.MediaReconnectStart,t=>{this.safeEmit(Ie.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on($t.MediaReconnectEnd,t=>{this.safeEmit(Ie.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on($t.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on($t.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(c){return void e.throw(c)}const{iceParameters:o}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:o})}),this._p2pChannel.on($t.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on($t.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),c=XU(r,o);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on($t.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on($t.P2PLost,()=>{this.safeEmit(Ie.P2P_LOST,this.store.uid)}),this._p2pChannel.on($t.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on($t.ConnectionTypeChange,t=>{this.safeEmit(Ie.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on($t.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on($t.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on($t.AudioMetadata,t=>{this.safeEmit(Ie.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new rt(k.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new rt(k.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},pu("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:o,token:c,uid:l,cid:h,vid:p}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:o,token:c,uid:l,cid:h,vid:p?Number(p):0},di)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(Pi.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(Ie.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===ra.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Ie.CONTENT_INSPECT_ERROR,new rt(k.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Pi.INSPECT_RESULT,(e,n)=>{var i;if((n==null?void 0:n.code)===k.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return b.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(Ie.CONTENT_INSPECT_RESULT,e,n)}),t.on(Pi.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new rt(k.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Yl(t,"enabled"),t){if(!e)throw new rt(k.INVALID_PARAMS,"config is required");if(fV(e),!this._joinInfo)throw new rt(k.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const i=(n={config:e},pu("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:o,sid:c,token:l,uid:h,cid:p,vid:m}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:o,sid:c,token:l,uid:h,cid:p,vid:m?Number(m):0},di)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new rt(k.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(Wa.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(Ie.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===Eo.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new rt(k.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Wa.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){Si(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new rt(k.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,b.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return b.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Yl(t,"enabled"),$e("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Wt(Lt.prototype,"leave",[mV],Object.getOwnPropertyDescriptor(Lt.prototype,"leave"),Lt.prototype),Wt(Lt.prototype,"publish",[EV],Object.getOwnPropertyDescriptor(Lt.prototype,"publish"),Lt.prototype),Wt(Lt.prototype,"unpublish",[_V],Object.getOwnPropertyDescriptor(Lt.prototype,"unpublish"),Lt.prototype),Wt(Lt.prototype,"subscribe",[gV],Object.getOwnPropertyDescriptor(Lt.prototype,"subscribe"),Lt.prototype),Wt(Lt.prototype,"presubscribe",[SV],Object.getOwnPropertyDescriptor(Lt.prototype,"presubscribe"),Lt.prototype),Wt(Lt.prototype,"massSubscribe",[TV],Object.getOwnPropertyDescriptor(Lt.prototype,"massSubscribe"),Lt.prototype),Wt(Lt.prototype,"unsubscribe",[vV],Object.getOwnPropertyDescriptor(Lt.prototype,"unsubscribe"),Lt.prototype),Wt(Lt.prototype,"massUnsubscribe",[yV],Object.getOwnPropertyDescriptor(Lt.prototype,"massUnsubscribe"),Lt.prototype),Wt(Lt.prototype,"setLowStreamParameter",[RV],Object.getOwnPropertyDescriptor(Lt.prototype,"setLowStreamParameter"),Lt.prototype),Wt(Lt.prototype,"enableDualStream",[bV],Object.getOwnPropertyDescriptor(Lt.prototype,"enableDualStream"),Lt.prototype),Wt(Lt.prototype,"disableDualStream",[CV],Object.getOwnPropertyDescriptor(Lt.prototype,"disableDualStream"),Lt.prototype),Wt(Lt.prototype,"setClientRole",[AV],Object.getOwnPropertyDescriptor(Lt.prototype,"setClientRole"),Lt.prototype),Wt(Lt.prototype,"_setClientRoleOptions",[wV],Object.getOwnPropertyDescriptor(Lt.prototype,"_setClientRoleOptions"),Lt.prototype),Wt(Lt.prototype,"setProxyServer",[IV],Object.getOwnPropertyDescriptor(Lt.prototype,"setProxyServer"),Lt.prototype),Wt(Lt.prototype,"setTurnServer",[OV],Object.getOwnPropertyDescriptor(Lt.prototype,"setTurnServer"),Lt.prototype),Wt(Lt.prototype,"setLicense",[NV],Object.getOwnPropertyDescriptor(Lt.prototype,"setLicense"),Lt.prototype),Wt(Lt.prototype,"startProxyServer",[DV],Object.getOwnPropertyDescriptor(Lt.prototype,"startProxyServer"),Lt.prototype),Wt(Lt.prototype,"stopProxyServer",[PV],Object.getOwnPropertyDescriptor(Lt.prototype,"stopProxyServer"),Lt.prototype),Wt(Lt.prototype,"setLocalAccessPointsV2",[LV],Object.getOwnPropertyDescriptor(Lt.prototype,"setLocalAccessPointsV2"),Lt.prototype),Wt(Lt.prototype,"setLocalAccessPoints",[kV],Object.getOwnPropertyDescriptor(Lt.prototype,"setLocalAccessPoints"),Lt.prototype),Wt(Lt.prototype,"setRemoteDefaultVideoStreamType",[MV],Object.getOwnPropertyDescriptor(Lt.prototype,"setRemoteDefaultVideoStreamType"),Lt.prototype),Wt(Lt.prototype,"setRemoteVideoStreamType",[xV],Object.getOwnPropertyDescriptor(Lt.prototype,"setRemoteVideoStreamType"),Lt.prototype),Wt(Lt.prototype,"setStreamFallbackOption",[UV],Object.getOwnPropertyDescriptor(Lt.prototype,"setStreamFallbackOption"),Lt.prototype),Wt(Lt.prototype,"setEncryptionConfig",[VV],Object.getOwnPropertyDescriptor(Lt.prototype,"setEncryptionConfig"),Lt.prototype),Wt(Lt.prototype,"renewToken",[BV],Object.getOwnPropertyDescriptor(Lt.prototype,"renewToken"),Lt.prototype),Wt(Lt.prototype,"enableAudioVolumeIndicator",[jV],Object.getOwnPropertyDescriptor(Lt.prototype,"enableAudioVolumeIndicator"),Lt.prototype),Wt(Lt.prototype,"startLiveStreaming",[FV],Object.getOwnPropertyDescriptor(Lt.prototype,"startLiveStreaming"),Lt.prototype),Wt(Lt.prototype,"setLiveTranscoding",[GV],Object.getOwnPropertyDescriptor(Lt.prototype,"setLiveTranscoding"),Lt.prototype),Wt(Lt.prototype,"stopLiveStreaming",[HV],Object.getOwnPropertyDescriptor(Lt.prototype,"stopLiveStreaming"),Lt.prototype),Wt(Lt.prototype,"startChannelMediaRelay",[WV],Object.getOwnPropertyDescriptor(Lt.prototype,"startChannelMediaRelay"),Lt.prototype),Wt(Lt.prototype,"updateChannelMediaRelay",[KV],Object.getOwnPropertyDescriptor(Lt.prototype,"updateChannelMediaRelay"),Lt.prototype),Wt(Lt.prototype,"stopChannelMediaRelay",[zV],Object.getOwnPropertyDescriptor(Lt.prototype,"stopChannelMediaRelay"),Lt.prototype),Wt(Lt.prototype,"sendCustomReportMessage",[YV],Object.getOwnPropertyDescriptor(Lt.prototype,"sendCustomReportMessage"),Lt.prototype),Wt(Lt.prototype,"pickSVCLayer",[qV],Object.getOwnPropertyDescriptor(Lt.prototype,"pickSVCLayer"),Lt.prototype),Wt(Lt.prototype,"setRTMConfig",[XV],Object.getOwnPropertyDescriptor(Lt.prototype,"setRTMConfig"),Lt.prototype),Wt(Lt.prototype,"enableContentInspect",[JV],Object.getOwnPropertyDescriptor(Lt.prototype,"enableContentInspect"),Lt.prototype),Wt(Lt.prototype,"disableContentInspect",[QV],Object.getOwnPropertyDescriptor(Lt.prototype,"disableContentInspect"),Lt.prototype),Wt(Lt.prototype,"setImageModeration",[ZV],Object.getOwnPropertyDescriptor(Lt.prototype,"setImageModeration"),Lt.prototype),Wt(Lt.prototype,"setP2PTransport",[$V],Object.getOwnPropertyDescriptor(Lt.prototype,"setP2PTransport"),Lt.prototype),Wt(Lt.prototype,"getJoinChannelServiceRecords",[tB],Object.getOwnPropertyDescriptor(Lt.prototype,"getJoinChannelServiceRecords"),Lt.prototype),Wt(Lt.prototype,"setPublishAudioFilterEnabled",[eB],Object.getOwnPropertyDescriptor(Lt.prototype,"setPublishAudioFilterEnabled"),Lt.prototype),Lt);class RS{constructor(e,n){D(this,"id",0),D(this,"element",void 0),D(this,"peerPair",void 0),D(this,"context",void 0),D(this,"audioPlayerElement",void 0),D(this,"audioTrack",void 0),RS.count+=1,this.id=RS.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(i,r)=>{const o=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(o),i.iceGatheringState==="complete"?i.localDescription:new At(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await e(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await e(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new rt(k.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(r){throw new rt(k.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new rt(k.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){b.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var iB,jb;D(RS,"count",0);const qY=window.AudioContext||window.webkitAudioContext,XY=new(iB=ie({report:qt}),Wt((jb=class{constructor(){D(this,"units",[]),D(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return b.debug("the system does not need to process local aec"),-1;this.context||(this.context=new qY);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new RS(t,this.context),this.units.push(e)),e.startEchoCancellation(),b.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Fe().name!==Ye.SAFARI}}).prototype,"processExternalMediaAEC",[iB],Object.getOwnPropertyDescriptor(jb.prototype,"processExternalMediaAEC"),jb.prototype),jb);function rB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function sB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rB(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rB(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const lO=window||document;function oB(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!lO)return;const n=ui._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=r=>{if(!(r&&r.blockedURI&&(ui.onSecurityPolicyViolation||ui.getListeners(Xc.SECURITY_POLICY_VIOLATION).length>0)))return;const o=r.blockedURI;j("CSP_DETECTED_HOSTNAME_LIST").some(c=>Ct(o).call(o,c))&&(ui.onSecurityPolicyViolation&&typeof ui.onSecurityPolicyViolation=="function"&&ui.onSecurityPolicyViolation(r),ui.getListeners(Xc.SECURITY_POLICY_VIOLATION).length>0&&ui.safeEmit(Xc.SECURITY_POLICY_VIOLATION,r))};n&&lO.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||ui.getListeners(Xc.SECURITY_POLICY_VIOLATION).length>0)&&lO.addEventListener("securitypolicyviolation",i),ui._cspEventHandlerPointer=i}var JY=et,QY=Yk,aB=RegExp.prototype,ZY=function(t){return t===aB||JY(aB,t)?QY(t):t.flags},_r=R(ZY);function SE(t){let e=t.length;for(;--e>=0;)t[e]=0}const dO=256,cB=286,bS=30,CS=15,uO=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Fb=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),$Y=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),lB=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),nd=new Array(576);SE(nd);const AS=new Array(60);SE(AS);const wS=new Array(512);SE(wS);const IS=new Array(256);SE(IS);const hO=new Array(29);SE(hO);const Gb=new Array(bS);function pO(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let dB,uB,hB;function fO(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}SE(Gb);const pB=t=>t<256?wS[t]:wS[256+(t>>>7)],OS=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Qs=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,OS(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},$c=(t,e,n)=>{Qs(t,n[2*e],n[2*e+1])},fB=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},mB=(t,e,n)=>{const i=new Array(16);let r,o,c=0;for(r=1;r<=CS;r++)c=c+n[r-1]<<1,i[r]=c;for(o=0;o<=e;o++){let l=t[2*o+1];l!==0&&(t[2*o]=fB(i[l]++,l))}},EB=t=>{let e;for(e=0;e<cB;e++)t.dyn_ltree[2*e]=0;for(e=0;e<bS;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},_B=t=>{t.bi_valid>8?OS(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},gB=(t,e,n,i)=>{const r=2*e,o=2*n;return t[r]<t[o]||t[r]===t[o]&&i[e]<=i[n]},mO=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&gB(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!gB(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},SB=(t,e,n)=>{let i,r,o,c,l=0;if(t.sym_next!==0)do i=255&t.pending_buf[t.sym_buf+l++],i+=(255&t.pending_buf[t.sym_buf+l++])<<8,r=t.pending_buf[t.sym_buf+l++],i===0?$c(t,r,e):(o=IS[r],$c(t,o+dO+1,e),c=uO[o],c!==0&&(r-=hO[o],Qs(t,r,c)),i--,o=pB(i),$c(t,o,n),c=Fb[o],c!==0&&(i-=Gb[o],Qs(t,i,c)));while(l<t.sym_next);$c(t,256,e)},EO=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,o=e.stat_desc.elems;let c,l,h,p=-1;for(t.heap_len=0,t.heap_max=573,c=0;c<o;c++)n[2*c]!==0?(t.heap[++t.heap_len]=p=c,t.depth[c]=0):n[2*c+1]=0;for(;t.heap_len<2;)h=t.heap[++t.heap_len]=p<2?++p:0,n[2*h]=1,t.depth[h]=0,t.opt_len--,r&&(t.static_len-=i[2*h+1]);for(e.max_code=p,c=t.heap_len>>1;c>=1;c--)mO(t,n,c);h=o;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],mO(t,n,1),l=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=l,n[2*h]=n[2*c]+n[2*l],t.depth[h]=(t.depth[c]>=t.depth[l]?t.depth[c]:t.depth[l])+1,n[2*c+1]=n[2*l+1]=h,t.heap[1]=h++,mO(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((m,S)=>{const v=S.dyn_tree,y=S.max_code,P=S.stat_desc.static_tree,I=S.stat_desc.has_stree,O=S.stat_desc.extra_bits,M=S.stat_desc.extra_base,U=S.stat_desc.max_length;let W,$,Q,q,ct,_t,Dt=0;for(q=0;q<=CS;q++)m.bl_count[q]=0;for(v[2*m.heap[m.heap_max]+1]=0,W=m.heap_max+1;W<573;W++)$=m.heap[W],q=v[2*v[2*$+1]+1]+1,q>U&&(q=U,Dt++),v[2*$+1]=q,$>y||(m.bl_count[q]++,ct=0,$>=M&&(ct=O[$-M]),_t=v[2*$],m.opt_len+=_t*(q+ct),I&&(m.static_len+=_t*(P[2*$+1]+ct)));if(Dt!==0){do{for(q=U-1;m.bl_count[q]===0;)q--;m.bl_count[q]--,m.bl_count[q+1]+=2,m.bl_count[U]--,Dt-=2}while(Dt>0);for(q=U;q!==0;q--)for($=m.bl_count[q];$!==0;)Q=m.heap[--W],Q>y||(v[2*Q+1]!==q&&(m.opt_len+=(q-v[2*Q+1])*v[2*Q],v[2*Q+1]=q),$--)}})(t,e),mB(n,p,t.bl_count)},TB=(t,e,n)=>{let i,r,o=-1,c=e[1],l=0,h=7,p=4;for(c===0&&(h=138,p=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=c,c=e[2*(i+1)+1],++l<h&&r===c||(l<p?t.bl_tree[2*r]+=l:r!==0?(r!==o&&t.bl_tree[2*r]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,o=r,c===0?(h=138,p=3):r===c?(h=6,p=3):(h=7,p=4))},vB=(t,e,n)=>{let i,r,o=-1,c=e[1],l=0,h=7,p=4;for(c===0&&(h=138,p=3),i=0;i<=n;i++)if(r=c,c=e[2*(i+1)+1],!(++l<h&&r===c)){if(l<p)do $c(t,r,t.bl_tree);while(--l!=0);else r!==0?(r!==o&&($c(t,r,t.bl_tree),l--),$c(t,16,t.bl_tree),Qs(t,l-3,2)):l<=10?($c(t,17,t.bl_tree),Qs(t,l-3,3)):($c(t,18,t.bl_tree),Qs(t,l-11,7));l=0,o=r,c===0?(h=138,p=3):r===c?(h=6,p=3):(h=7,p=4)}};let yB=!1;const RB=(t,e,n,i)=>{Qs(t,0+(i?1:0),3),_B(t),OS(t,n),OS(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var tq=t=>{yB||((()=>{let e,n,i,r,o;const c=new Array(16);for(i=0,r=0;r<28;r++)for(hO[r]=i,e=0;e<1<<uO[r];e++)IS[i++]=r;for(IS[i-1]=r,o=0,r=0;r<16;r++)for(Gb[r]=o,e=0;e<1<<Fb[r];e++)wS[o++]=r;for(o>>=7;r<bS;r++)for(Gb[r]=o<<7,e=0;e<1<<Fb[r]-7;e++)wS[256+o++]=r;for(n=0;n<=CS;n++)c[n]=0;for(e=0;e<=143;)nd[2*e+1]=8,e++,c[8]++;for(;e<=255;)nd[2*e+1]=9,e++,c[9]++;for(;e<=279;)nd[2*e+1]=7,e++,c[7]++;for(;e<=287;)nd[2*e+1]=8,e++,c[8]++;for(mB(nd,287,c),e=0;e<bS;e++)AS[2*e+1]=5,AS[2*e]=fB(e,5);dB=new pO(nd,uO,257,cB,CS),uB=new pO(AS,Fb,0,bS,CS),hB=new pO(new Array(0),$Y,0,19,7)})(),yB=!0),t.l_desc=new fO(t.dyn_ltree,dB),t.d_desc=new fO(t.dyn_dtree,uB),t.bl_desc=new fO(t.bl_tree,hB),t.bi_buf=0,t.bi_valid=0,EB(t)},eq=(t,e,n,i)=>{let r,o,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(l=>{let h,p=4093624447;for(h=0;h<=31;h++,p>>>=1)if(1&p&&l.dyn_ltree[2*h]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(h=32;h<dO;h++)if(l.dyn_ltree[2*h]!==0)return 1;return 0})(t)),EO(t,t.l_desc),EO(t,t.d_desc),c=(l=>{let h;for(TB(l,l.dyn_ltree,l.l_desc.max_code),TB(l,l.dyn_dtree,l.d_desc.max_code),EO(l,l.bl_desc),h=18;h>=3&&l.bl_tree[2*lB[h]+1]===0;h--);return l.opt_len+=3*(h+1)+5+5+4,h})(t),r=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=r&&(r=o)):r=o=n+5,n+4<=r&&e!==-1?RB(t,e,n,i):t.strategy===4||o===r?(Qs(t,2+(i?1:0),3),SB(t,nd,AS)):(Qs(t,4+(i?1:0),3),((l,h,p,m)=>{let S;for(Qs(l,h-257,5),Qs(l,p-1,5),Qs(l,m-4,4),S=0;S<m;S++)Qs(l,l.bl_tree[2*lB[S]+1],3);vB(l,l.dyn_ltree,h-1),vB(l,l.dyn_dtree,p-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),SB(t,t.dyn_ltree,t.dyn_dtree)),EB(t),i&&_B(t)},nq=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(IS[n]+dO+1)]++,t.dyn_dtree[2*pB(e)]++),t.sym_next===t.sym_end),iq=t=>{Qs(t,2,3),$c(t,256,nd),(e=>{e.bi_valid===16?(OS(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},rq={_tr_init:tq,_tr_stored_block:RB,_tr_flush_block:eq,_tr_tally:nq,_tr_align:iq},NS=(t,e,n,i)=>{let r=65535&t,o=t>>>16&65535,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do r=r+e[i++]|0,o=o+r|0;while(--c);r%=65521,o%=65521}return r|o<<16};const sq=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var Or=(t,e,n,i)=>{const r=sq,o=i+n;t^=-1;for(let c=i;c<o;c++)t=t>>>8^r[255&(t^e[c])];return~t},gp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Hb={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:oq,_tr_stored_block:_O,_tr_flush_block:aq,_tr_tally:gu,_tr_align:cq}=rq,{Z_NO_FLUSH:Su,Z_PARTIAL_FLUSH:lq,Z_FULL_FLUSH:dq,Z_FINISH:la,Z_BLOCK:bB,Z_OK:Hr,Z_STREAM_END:CB,Z_STREAM_ERROR:tl,Z_DATA_ERROR:uq,Z_BUF_ERROR:gO,Z_DEFAULT_COMPRESSION:hq,Z_FILTERED:pq,Z_HUFFMAN_ONLY:Wb,Z_RLE:fq,Z_FIXED:mq,Z_DEFAULT_STRATEGY:Eq,Z_UNKNOWN:_q,Z_DEFLATED:Kb}=Hb,Sp=258,el=262,TE=42,Tp=113,DS=666,vp=(t,e)=>(t.msg=gp[e],e),AB=t=>2*t-(t>4?9:0),Tu=t=>{let e=t.length;for(;--e>=0;)t[e]=0},gq=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do n=t.head[--i],t.head[i]=n>=r?n-r:0;while(--e);e=r,i=e;do n=t.prev[--i],t.prev[i]=n>=r?n-r:0;while(--e)};let vu=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const go=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},So=(t,e)=>{aq(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,go(t.strm)},Hn=(t,e)=>{t.pending_buf[t.pending++]=e},PS=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},SO=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),r===0?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),t.state.wrap===1?t.adler=NS(t.adler,e,r,n):t.state.wrap===2&&(t.adler=Or(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},wB=(t,e)=>{let n,i,r=t.max_chain_length,o=t.strstart,c=t.prev_length,l=t.nice_match;const h=t.strstart>t.w_size-el?t.strstart-(t.w_size-el):0,p=t.window,m=t.w_mask,S=t.prev,v=t.strstart+Sp;let y=p[o+c-1],P=p[o+c];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do if(n=e,p[n+c]===P&&p[n+c-1]===y&&p[n]===p[o]&&p[++n]===p[o+1]){o+=2,n++;do;while(p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&o<v);if(i=Sp-(v-o),o=v-Sp,i>c){if(t.match_start=e,c=i,i>=l)break;y=p[o+c-1],P=p[o+c]}}while((e=S[e&m])>h&&--r!=0);return c<=t.lookahead?c:t.lookahead},vE=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-el)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),gq(t),i+=e),t.strm.avail_in===0)break;if(n=SO(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=vu(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=vu(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<el&&t.strm.avail_in!==0)},IB=(t,e)=>{let n,i,r,o=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,c=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<o&&(n===0&&e!==la||e===Su||n!==i+t.strm.avail_in)))break;c=e===la&&n===i+t.strm.avail_in?1:0,_O(t,0,0,c),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,go(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(SO(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(c===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?4:e!==Su&&e!==la&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(SO(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,o=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=o||(i||e===la)&&e!==Su&&t.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,c=e===la&&t.strm.avail_in===0&&n===i?1:0,_O(t,t.block_start,n,c),t.block_start+=n,go(t.strm)),c?3:1)},TO=(t,e)=>{let n,i;for(;;){if(t.lookahead<el){if(vE(t),t.lookahead<el&&e===Su)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=vu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-el&&(t.match_length=wB(t,n)),t.match_length>=3)if(i=gu(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=vu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=vu(t,t.ins_h,t.window[t.strstart+1]);else i=gu(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(So(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===la?(So(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(So(t,!1),t.strm.avail_out===0)?1:2},yE=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<el){if(vE(t),t.lookahead<el&&e===Su)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=vu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-el&&(t.match_length=wB(t,n),t.match_length<=5&&(t.strategy===pq||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=gu(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=r&&(t.ins_h=vu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(So(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(i=gu(t,0,t.window[t.strstart-1]),i&&So(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=gu(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===la?(So(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(So(t,!1),t.strm.avail_out===0)?1:2};function nl(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const LS=[new nl(0,0,0,0,IB),new nl(4,4,8,4,TO),new nl(4,5,16,8,TO),new nl(4,6,32,32,TO),new nl(4,4,16,16,yE),new nl(8,16,32,32,yE),new nl(8,16,128,128,yE),new nl(8,32,128,256,yE),new nl(32,128,258,1024,yE),new nl(32,258,258,4096,yE)];function Sq(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Kb,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Tu(this.dyn_ltree),Tu(this.dyn_dtree),Tu(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Tu(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Tu(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const kS=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==TE&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Tp&&e.status!==DS?1:0},OB=t=>{if(kS(t))return vp(t,tl);t.total_in=t.total_out=0,t.data_type=_q;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?TE:Tp,t.adler=e.wrap===2?0:1,e.last_flush=-2,oq(e),Hr},NB=t=>{const e=OB(t);return e===Hr&&(n=>{n.window_size=2*n.w_size,Tu(n.head),n.max_lazy_match=LS[n.level].max_lazy,n.good_match=LS[n.level].good_length,n.nice_match=LS[n.level].nice_length,n.max_chain_length=LS[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},DB=(t,e,n,i,r,o)=>{if(!t)return tl;let c=1;if(e===hq&&(e=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),r<1||r>9||n!==Kb||i<8||i>15||e<0||e>9||o<0||o>mq||i===8&&c!==1)return vp(t,tl);i===8&&(i=9);const l=new Sq;return t.state=l,l.strm=t,l.status=TE,l.wrap=c,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=e,l.strategy=o,l.method=n,NB(t)};var Tq=(t,e)=>{if(kS(t)||e>bB||e<0)return t?vp(t,tl):tl;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===DS&&e!==la)return vp(t,t.avail_out===0?gO:tl);const i=n.last_flush;if(n.last_flush=e,n.pending!==0){if(go(t),t.avail_out===0)return n.last_flush=-1,Hr}else if(t.avail_in===0&&AB(e)<=AB(i)&&e!==la)return vp(t,gO);if(n.status===DS&&t.avail_in!==0)return vp(t,gO);if(n.status===TE&&n.wrap===0&&(n.status=Tp),n.status===TE){let r=Kb+(n.w_bits-8<<4)<<8,o=-1;if(o=n.strategy>=Wb||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=o<<6,n.strstart!==0&&(r|=32),r+=31-r%31,PS(n,r),n.strstart!==0&&(PS(n,t.adler>>>16),PS(n,65535&t.adler)),t.adler=1,n.status=Tp,go(t),n.pending!==0)return n.last_flush=-1,Hr}if(n.status===57){if(t.adler=0,Hn(n,31),Hn(n,139),Hn(n,8),n.gzhead)Hn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Hn(n,255&n.gzhead.time),Hn(n,n.gzhead.time>>8&255),Hn(n,n.gzhead.time>>16&255),Hn(n,n.gzhead.time>>24&255),Hn(n,n.level===9?2:n.strategy>=Wb||n.level<2?4:0),Hn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Hn(n,255&n.gzhead.extra.length),Hn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=Or(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Hn(n,0),Hn(n,0),Hn(n,0),Hn(n,0),Hn(n,0),Hn(n,n.level===9?2:n.strategy>=Wb||n.level<2?4:0),Hn(n,3),n.status=Tp,go(t),n.pending!==0)return n.last_flush=-1,Hr}if(n.status===69){if(n.gzhead.extra){let r=n.pending,o=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+o>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(t.adler=Or(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=l,go(t),n.pending!==0)return n.last_flush=-1,Hr;r=0,o-=l}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending+=o,n.gzhead.hcrc&&n.pending>r&&(t.adler=Or(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(t.adler=Or(t.adler,n.pending_buf,n.pending-o,o)),go(t),n.pending!==0)return n.last_flush=-1,Hr;o=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Hn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>o&&(t.adler=Or(t.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(t.adler=Or(t.adler,n.pending_buf,n.pending-o,o)),go(t),n.pending!==0)return n.last_flush=-1,Hr;o=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Hn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>o&&(t.adler=Or(t.adler,n.pending_buf,n.pending-o,o))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(go(t),n.pending!==0))return n.last_flush=-1,Hr;Hn(n,255&t.adler),Hn(n,t.adler>>8&255),t.adler=0}if(n.status=Tp,go(t),n.pending!==0)return n.last_flush=-1,Hr}if(t.avail_in!==0||n.lookahead!==0||e!==Su&&n.status!==DS){let r=n.level===0?IB(n,e):n.strategy===Wb?((o,c)=>{let l;for(;;){if(o.lookahead===0&&(vE(o),o.lookahead===0)){if(c===Su)return 1;break}if(o.match_length=0,l=gu(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,l&&(So(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,c===la?(So(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(So(o,!1),o.strm.avail_out===0)?1:2})(n,e):n.strategy===fq?((o,c)=>{let l,h,p,m;const S=o.window;for(;;){if(o.lookahead<=Sp){if(vE(o),o.lookahead<=Sp&&c===Su)return 1;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(p=o.strstart-1,h=S[p],h===S[++p]&&h===S[++p]&&h===S[++p])){m=o.strstart+Sp;do;while(h===S[++p]&&h===S[++p]&&h===S[++p]&&h===S[++p]&&h===S[++p]&&h===S[++p]&&h===S[++p]&&h===S[++p]&&p<m);o.match_length=Sp-(m-p),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(l=gu(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(l=gu(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),l&&(So(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,c===la?(So(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(So(o,!1),o.strm.avail_out===0)?1:2})(n,e):LS[n.level].func(n,e);if(r!==3&&r!==4||(n.status=DS),r===1||r===3)return t.avail_out===0&&(n.last_flush=-1),Hr;if(r===2&&(e===lq?cq(n):e!==bB&&(_O(n,0,0,!1),e===dq&&(Tu(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),go(t),t.avail_out===0))return n.last_flush=-1,Hr}return e!==la?Hr:n.wrap<=0?CB:(n.wrap===2?(Hn(n,255&t.adler),Hn(n,t.adler>>8&255),Hn(n,t.adler>>16&255),Hn(n,t.adler>>24&255),Hn(n,255&t.total_in),Hn(n,t.total_in>>8&255),Hn(n,t.total_in>>16&255),Hn(n,t.total_in>>24&255)):(PS(n,t.adler>>>16),PS(n,65535&t.adler)),go(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Hr:CB)},vq=(t,e)=>{let n=e.length;if(kS(t))return tl;const i=t.state,r=i.wrap;if(r===2||r===1&&i.status!==TE||i.lookahead)return tl;if(r===1&&(t.adler=NS(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){r===0&&(Tu(i.head),i.strstart=0,i.block_start=0,i.insert=0);let h=new Uint8Array(i.w_size);h.set(e.subarray(n-i.w_size,n),0),e=h,n=i.w_size}const o=t.avail_in,c=t.next_in,l=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,vE(i);i.lookahead>=3;){let h=i.strstart,p=i.lookahead-2;do i.ins_h=vu(i,i.ins_h,i.window[h+3-1]),i.prev[h&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=h,h++;while(--p);i.strstart=h,i.lookahead=2,vE(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=l,t.avail_in=o,i.wrap=r,Hr},MS={deflateInit:(t,e)=>DB(t,e,Kb,15,8,Eq),deflateInit2:DB,deflateReset:NB,deflateResetKeep:OB,deflateSetHeader:(t,e)=>kS(t)||t.state.wrap!==2?tl:(t.state.gzhead=e,Hr),deflate:Tq,deflateEnd:t=>{if(kS(t))return tl;const e=t.state.status;return t.state=null,e===Tp?vp(t,uq):Hr},deflateSetDictionary:vq,deflateInfo:"pako deflate (from Nodeca project)"};const yq=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var PB=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)yq(n,i)&&(t[i]=n[i])}}return t},LB=t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,o=t.length;i<o;i++){let c=t[i];n.set(c,r),r+=c.length}return n};let kB=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{kB=!1}const xS=new Uint8Array(256);for(let t=0;t<256;t++)xS[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;xS[254]=xS[254]=1;var vO=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,r,o,c=t.length,l=0;for(r=0;r<c;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),o=0,r=0;o<l;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[o++]=n:n<2048?(e[o++]=192|n>>>6,e[o++]=128|63&n):n<65536?(e[o++]=224|n>>>12,e[o++]=128|n>>>6&63,e[o++]=128|63&n):(e[o++]=240|n>>>18,e[o++]=128|n>>>12&63,e[o++]=128|n>>>6&63,e[o++]=128|63&n);return e},Rq=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,r;const o=new Array(2*n);for(r=0,i=0;i<n;){let c=t[i++];if(c<128){o[r++]=c;continue}let l=xS[c];if(l>4)o[r++]=65533,i+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&i<n;)c=c<<6|63&t[i++],l--;l>1?o[r++]=65533:c<65536?o[r++]=c:(c-=65536,o[r++]=55296|c>>10&1023,o[r++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&kB)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let h="";for(let p=0;p<l;p++)h+=String.fromCharCode(c[p]);return h})(o,r)},bq=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+xS[t[n]]>e?n:e},MB=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const xB=Object.prototype.toString,{Z_NO_FLUSH:Cq,Z_SYNC_FLUSH:Aq,Z_FULL_FLUSH:wq,Z_FINISH:Iq,Z_OK:zb,Z_STREAM_END:Oq,Z_DEFAULT_COMPRESSION:Nq,Z_DEFAULT_STRATEGY:Dq,Z_DEFLATED:Pq}=Hb;function Yb(t){this.options=PB({level:Nq,method:Pq,chunkSize:16384,windowBits:15,memLevel:8,strategy:Dq},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MB,this.strm.avail_out=0;let n=MS.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==zb)throw new Error(gp[n]);if(e.header&&MS.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?vO(e.dictionary):xB.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=MS.deflateSetDictionary(this.strm,i),n!==zb)throw new Error(gp[n]);this._dict_set=!0}}function Lq(t,e){const n=new Yb(e);if(n.push(t,!0),n.err)throw n.msg||gp[n.err];return n.result}Yb.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,o;if(this.ended)return!1;for(o=e===~~e?e:e===!0?Iq:Cq,typeof t=="string"?n.input=vO(t):xB.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(o===Aq||o===wq)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=MS.deflate(n,o),r===Oq)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=MS.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===zb;if(n.avail_out!==0){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Yb.prototype.onData=function(t){this.chunks.push(t)},Yb.prototype.onEnd=function(t){t===zb&&(this.result=LB(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var kq={deflate:Lq};const qb=16209;var Mq=function(t,e){let n,i,r,o,c,l,h,p,m,S,v,y,P,I,O,M,U,W,$,Q,q,ct,_t,Dt;const Mt=t.state;n=t.next_in,_t=t.input,i=n+(t.avail_in-5),r=t.next_out,Dt=t.output,o=r-(e-t.avail_out),c=r+(t.avail_out-257),l=Mt.dmax,h=Mt.wsize,p=Mt.whave,m=Mt.wnext,S=Mt.window,v=Mt.hold,y=Mt.bits,P=Mt.lencode,I=Mt.distcode,O=(1<<Mt.lenbits)-1,M=(1<<Mt.distbits)-1;t:do{y<15&&(v+=_t[n++]<<y,y+=8,v+=_t[n++]<<y,y+=8),U=P[v&O];e:for(;;){if(W=U>>>24,v>>>=W,y-=W,W=U>>>16&255,W===0)Dt[r++]=65535&U;else{if(!(16&W)){if(64&W){if(32&W){Mt.mode=16191;break t}t.msg="invalid literal/length code",Mt.mode=qb;break t}U=P[(65535&U)+(v&(1<<W)-1)];continue e}for($=65535&U,W&=15,W&&(y<W&&(v+=_t[n++]<<y,y+=8),$+=v&(1<<W)-1,v>>>=W,y-=W),y<15&&(v+=_t[n++]<<y,y+=8,v+=_t[n++]<<y,y+=8),U=I[v&M];;){if(W=U>>>24,v>>>=W,y-=W,W=U>>>16&255,16&W){if(Q=65535&U,W&=15,y<W&&(v+=_t[n++]<<y,y+=8,y<W&&(v+=_t[n++]<<y,y+=8)),Q+=v&(1<<W)-1,Q>l){t.msg="invalid distance too far back",Mt.mode=qb;break t}if(v>>>=W,y-=W,W=r-o,Q>W){if(W=Q-W,W>p&&Mt.sane){t.msg="invalid distance too far back",Mt.mode=qb;break t}if(q=0,ct=S,m===0){if(q+=h-W,W<$){$-=W;do Dt[r++]=S[q++];while(--W);q=r-Q,ct=Dt}}else if(m<W){if(q+=h+m-W,W-=m,W<$){$-=W;do Dt[r++]=S[q++];while(--W);if(q=0,m<$){W=m,$-=W;do Dt[r++]=S[q++];while(--W);q=r-Q,ct=Dt}}}else if(q+=m-W,W<$){$-=W;do Dt[r++]=S[q++];while(--W);q=r-Q,ct=Dt}for(;$>2;)Dt[r++]=ct[q++],Dt[r++]=ct[q++],Dt[r++]=ct[q++],$-=3;$&&(Dt[r++]=ct[q++],$>1&&(Dt[r++]=ct[q++]))}else{q=r-Q;do Dt[r++]=Dt[q++],Dt[r++]=Dt[q++],Dt[r++]=Dt[q++],$-=3;while($>2);$&&(Dt[r++]=Dt[q++],$>1&&(Dt[r++]=Dt[q++]))}break}if(64&W){t.msg="invalid distance code",Mt.mode=qb;break t}U=I[(65535&U)+(v&(1<<W)-1)]}}break}}while(n<i&&r<c);$=y>>3,n-=$,y-=$<<3,v&=(1<<y)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<c?c-r+257:257-(r-c),Mt.hold=v,Mt.bits=y};const Xb=15,xq=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Uq=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Vq=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Bq=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var US=(t,e,n,i,r,o,c,l)=>{const h=l.bits;let p,m,S,v,y,P,I=0,O=0,M=0,U=0,W=0,$=0,Q=0,q=0,ct=0,_t=0,Dt=null;const Mt=new Uint16Array(16),De=new Uint16Array(16);let Pe,fn,Xn,jn=null;for(I=0;I<=Xb;I++)Mt[I]=0;for(O=0;O<i;O++)Mt[e[n+O]]++;for(W=h,U=Xb;U>=1&&Mt[U]===0;U--);if(W>U&&(W=U),U===0)return r[o++]=20971520,r[o++]=20971520,l.bits=1,0;for(M=1;M<U&&Mt[M]===0;M++);for(W<M&&(W=M),q=1,I=1;I<=Xb;I++)if(q<<=1,q-=Mt[I],q<0)return-1;if(q>0&&(t===0||U!==1))return-1;for(De[1]=0,I=1;I<Xb;I++)De[I+1]=De[I]+Mt[I];for(O=0;O<i;O++)e[n+O]!==0&&(c[De[e[n+O]]++]=O);if(t===0?(Dt=jn=c,P=20):t===1?(Dt=xq,jn=Uq,P=257):(Dt=Vq,jn=Bq,P=0),_t=0,O=0,I=M,y=o,$=W,Q=0,S=-1,ct=1<<W,v=ct-1,t===1&&ct>852||t===2&&ct>592)return 1;for(;;){Pe=I-Q,c[O]+1<P?(fn=0,Xn=c[O]):c[O]>=P?(fn=jn[c[O]-P],Xn=Dt[c[O]-P]):(fn=96,Xn=0),p=1<<I-Q,m=1<<$,M=m;do m-=p,r[y+(_t>>Q)+m]=Pe<<24|fn<<16|Xn;while(m!==0);for(p=1<<I-1;_t&p;)p>>=1;if(p!==0?(_t&=p-1,_t+=p):_t=0,O++,--Mt[I]==0){if(I===U)break;I=e[n+c[O]]}if(I>W&&(_t&v)!==S){for(Q===0&&(Q=W),y+=M,$=I-Q,q=1<<$;$+Q<U&&(q-=Mt[$+Q],!(q<=0));)$++,q<<=1;if(ct+=1<<$,t===1&&ct>852||t===2&&ct>592)return 1;S=_t&v,r[S]=W<<24|$<<16|y-o}}return _t!==0&&(r[y+_t]=I-Q<<24|64<<16),l.bits=W,0};const{Z_FINISH:UB,Z_BLOCK:jq,Z_TREES:Jb,Z_OK:yp,Z_STREAM_END:Fq,Z_NEED_DICT:Gq,Z_STREAM_ERROR:da,Z_DATA_ERROR:VB,Z_MEM_ERROR:BB,Z_BUF_ERROR:Hq,Z_DEFLATED:jB}=Hb,Qb=16180,Zb=16190,id=16191,yO=16192,RO=16194,$b=16199,tC=16200,bO=16206,Li=16209,FB=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Wq(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Rp=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Qb||e.mode>16211?1:0},GB=t=>{if(Rp(t))return da;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Qb,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,yp},HB=t=>{if(Rp(t))return da;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,GB(t)},WB=(t,e)=>{let n;if(Rp(t))return da;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?da:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,HB(t))},KB=(t,e)=>{if(!t)return da;const n=new Wq;t.state=n,n.strm=t,n.window=null,n.mode=Qb;const i=WB(t,e);return i!==yp&&(t.state=null),i};let CO,AO,zB=!0;const Kq=t=>{if(zB){CO=new Int32Array(512),AO=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(US(1,t.lens,0,288,CO,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;US(2,t.lens,0,32,AO,0,t.work,{bits:5}),zB=!1}t.lencode=CO,t.lenbits=9,t.distcode=AO,t.distbits=5},YB=(t,e,n,i)=>{let r;const o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(e.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),o.window.set(e.subarray(n-i,n-i+r),o.wnext),(i-=r)?(o.window.set(e.subarray(n-i,n),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0};var zq=(t,e)=>{let n,i,r,o,c,l,h,p,m,S,v,y,P,I,O,M,U,W,$,Q,q,ct,_t=0;const Dt=new Uint8Array(4);let Mt,De;const Pe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Rp(t)||!t.output||!t.input&&t.avail_in!==0)return da;n=t.state,n.mode===id&&(n.mode=yO),c=t.next_out,r=t.output,h=t.avail_out,o=t.next_in,i=t.input,l=t.avail_in,p=n.hold,m=n.bits,S=l,v=h,ct=yp;t:for(;;)switch(n.mode){case Qb:if(n.wrap===0){n.mode=yO;break}for(;m<16;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}if(2&n.wrap&&p===35615){n.wbits===0&&(n.wbits=15),n.check=0,Dt[0]=255&p,Dt[1]=p>>>8&255,n.check=Or(n.check,Dt,2,0),p=0,m=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){t.msg="incorrect header check",n.mode=Li;break}if((15&p)!==jB){t.msg="unknown compression method",n.mode=Li;break}if(p>>>=4,m-=4,q=8+(15&p),n.wbits===0&&(n.wbits=q),q>15||q>n.wbits){t.msg="invalid window size",n.mode=Li;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&p?16189:id,p=0,m=0;break;case 16181:for(;m<16;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}if(n.flags=p,(255&_r(n))!==jB){t.msg="unknown compression method",n.mode=Li;break}if(57344&_r(n)){t.msg="unknown header flags set",n.mode=Li;break}n.head&&(n.head.text=p>>8&1),512&_r(n)&&4&n.wrap&&(Dt[0]=255&p,Dt[1]=p>>>8&255,n.check=Or(n.check,Dt,2,0)),p=0,m=0,n.mode=16182;case 16182:for(;m<32;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}n.head&&(n.head.time=p),512&_r(n)&&4&n.wrap&&(Dt[0]=255&p,Dt[1]=p>>>8&255,Dt[2]=p>>>16&255,Dt[3]=p>>>24&255,n.check=Or(n.check,Dt,4,0)),p=0,m=0,n.mode=16183;case 16183:for(;m<16;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&_r(n)&&4&n.wrap&&(Dt[0]=255&p,Dt[1]=p>>>8&255,n.check=Or(n.check,Dt,2,0)),p=0,m=0,n.mode=16184;case 16184:if(1024&_r(n)){for(;m<16;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}n.length=p,n.head&&(n.head.extra_len=p),512&_r(n)&&4&n.wrap&&(Dt[0]=255&p,Dt[1]=p>>>8&255,n.check=Or(n.check,Dt,2,0)),p=0,m=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&_r(n)&&(y=n.length,y>l&&(y=l),y&&(n.head&&(q=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(o,o+y),q)),512&_r(n)&&4&n.wrap&&(n.check=Or(n.check,i,y,o)),l-=y,o+=y,n.length-=y),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&_r(n)){if(l===0)break t;y=0;do q=i[o+y++],n.head&&q&&n.length<65536&&(n.head.name+=String.fromCharCode(q));while(q&&y<l);if(512&_r(n)&&4&n.wrap&&(n.check=Or(n.check,i,y,o)),l-=y,o+=y,q)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&_r(n)){if(l===0)break t;y=0;do q=i[o+y++],n.head&&q&&n.length<65536&&(n.head.comment+=String.fromCharCode(q));while(q&&y<l);if(512&_r(n)&&4&n.wrap&&(n.check=Or(n.check,i,y,o)),l-=y,o+=y,q)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&_r(n)){for(;m<16;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}if(4&n.wrap&&p!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Li;break}p=0,m=0}n.head&&(n.head.hcrc=_r(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=id;break;case 16189:for(;m<32;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}t.adler=n.check=FB(p),p=0,m=0,n.mode=Zb;case Zb:if(n.havedict===0)return t.next_out=c,t.avail_out=h,t.next_in=o,t.avail_in=l,n.hold=p,n.bits=m,Gq;t.adler=n.check=1,n.mode=id;case id:if(e===jq||e===Jb)break t;case yO:if(n.last){p>>>=7&m,m-=7&m,n.mode=bO;break}for(;m<3;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}switch(n.last=1&p,p>>>=1,m-=1,3&p){case 0:n.mode=16193;break;case 1:if(Kq(n),n.mode=$b,e===Jb){p>>>=2,m-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=Li}p>>>=2,m-=2;break;case 16193:for(p>>>=7&m,m-=7&m;m<32;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}if((65535&p)!=(p>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Li;break}if(n.length=65535&p,p=0,m=0,n.mode=RO,e===Jb)break t;case RO:n.mode=16195;case 16195:if(y=n.length,y){if(y>l&&(y=l),y>h&&(y=h),y===0)break t;r.set(i.subarray(o,o+y),c),l-=y,o+=y,h-=y,c+=y,n.length-=y;break}n.mode=id;break;case 16196:for(;m<14;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}if(n.nlen=257+(31&p),p>>>=5,m-=5,n.ndist=1+(31&p),p>>>=5,m-=5,n.ncode=4+(15&p),p>>>=4,m-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Li;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;m<3;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}n.lens[Pe[n.have++]]=7&p,p>>>=3,m-=3}for(;n.have<19;)n.lens[Pe[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Mt={bits:n.lenbits},ct=US(0,n.lens,0,19,n.lencode,0,n.work,Mt),n.lenbits=Mt.bits,ct){t.msg="invalid code lengths set",n.mode=Li;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;_t=n.lencode[p&(1<<n.lenbits)-1],O=_t>>>24,M=_t>>>16&255,U=65535&_t,!(O<=m);){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}if(U<16)p>>>=O,m-=O,n.lens[n.have++]=U;else{if(U===16){for(De=O+2;m<De;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}if(p>>>=O,m-=O,n.have===0){t.msg="invalid bit length repeat",n.mode=Li;break}q=n.lens[n.have-1],y=3+(3&p),p>>>=2,m-=2}else if(U===17){for(De=O+3;m<De;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}p>>>=O,m-=O,q=0,y=3+(7&p),p>>>=3,m-=3}else{for(De=O+7;m<De;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}p>>>=O,m-=O,q=0,y=11+(127&p),p>>>=7,m-=7}if(n.have+y>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Li;break}for(;y--;)n.lens[n.have++]=q}}if(n.mode===Li)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=Li;break}if(n.lenbits=9,Mt={bits:n.lenbits},ct=US(1,n.lens,0,n.nlen,n.lencode,0,n.work,Mt),n.lenbits=Mt.bits,ct){t.msg="invalid literal/lengths set",n.mode=Li;break}if(n.distbits=6,n.distcode=n.distdyn,Mt={bits:n.distbits},ct=US(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Mt),n.distbits=Mt.bits,ct){t.msg="invalid distances set",n.mode=Li;break}if(n.mode=$b,e===Jb)break t;case $b:n.mode=tC;case tC:if(l>=6&&h>=258){t.next_out=c,t.avail_out=h,t.next_in=o,t.avail_in=l,n.hold=p,n.bits=m,Mq(t,v),c=t.next_out,r=t.output,h=t.avail_out,o=t.next_in,i=t.input,l=t.avail_in,p=n.hold,m=n.bits,n.mode===id&&(n.back=-1);break}for(n.back=0;_t=n.lencode[p&(1<<n.lenbits)-1],O=_t>>>24,M=_t>>>16&255,U=65535&_t,!(O<=m);){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}if(M&&!(240&M)){for(W=O,$=M,Q=U;_t=n.lencode[Q+((p&(1<<W+$)-1)>>W)],O=_t>>>24,M=_t>>>16&255,U=65535&_t,!(W+O<=m);){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}p>>>=W,m-=W,n.back+=W}if(p>>>=O,m-=O,n.back+=O,n.length=U,M===0){n.mode=16205;break}if(32&M){n.back=-1,n.mode=id;break}if(64&M){t.msg="invalid literal/length code",n.mode=Li;break}n.extra=15&M,n.mode=16201;case 16201:if(n.extra){for(De=n.extra;m<De;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;_t=n.distcode[p&(1<<n.distbits)-1],O=_t>>>24,M=_t>>>16&255,U=65535&_t,!(O<=m);){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}if(!(240&M)){for(W=O,$=M,Q=U;_t=n.distcode[Q+((p&(1<<W+$)-1)>>W)],O=_t>>>24,M=_t>>>16&255,U=65535&_t,!(W+O<=m);){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}p>>>=W,m-=W,n.back+=W}if(p>>>=O,m-=O,n.back+=O,64&M){t.msg="invalid distance code",n.mode=Li;break}n.offset=U,n.extra=15&M,n.mode=16203;case 16203:if(n.extra){for(De=n.extra;m<De;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Li;break}n.mode=16204;case 16204:if(h===0)break t;if(y=v-h,n.offset>y){if(y=n.offset-y,y>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Li;break}y>n.wnext?(y-=n.wnext,P=n.wsize-y):P=n.wnext-y,y>n.length&&(y=n.length),I=n.window}else I=r,P=c-n.offset,y=n.length;y>h&&(y=h),h-=y,n.length-=y;do r[c++]=I[P++];while(--y);n.length===0&&(n.mode=tC);break;case 16205:if(h===0)break t;r[c++]=n.length,h--,n.mode=tC;break;case bO:if(n.wrap){for(;m<32;){if(l===0)break t;l--,p|=i[o++]<<m,m+=8}if(v-=h,t.total_out+=v,n.total+=v,4&n.wrap&&v&&(t.adler=n.check=_r(n)?Or(n.check,r,v,c-v):NS(n.check,r,v,c-v)),v=h,4&n.wrap&&(_r(n)?p:FB(p))!==n.check){t.msg="incorrect data check",n.mode=Li;break}p=0,m=0}n.mode=16207;case 16207:if(n.wrap&&_r(n)){for(;m<32;){if(l===0)break t;l--,p+=i[o++]<<m,m+=8}if(4&n.wrap&&p!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Li;break}p=0,m=0}n.mode=16208;case 16208:ct=Fq;break t;case Li:ct=VB;break t;case 16210:return BB;default:return da}return t.next_out=c,t.avail_out=h,t.next_in=o,t.avail_in=l,n.hold=p,n.bits=m,(n.wsize||v!==t.avail_out&&n.mode<Li&&(n.mode<bO||e!==UB))&&YB(t,t.output,t.next_out,v-t.avail_out),S-=t.avail_in,v-=t.avail_out,t.total_in+=S,t.total_out+=v,n.total+=v,4&n.wrap&&v&&(t.adler=n.check=_r(n)?Or(n.check,r,v,t.next_out-v):NS(n.check,r,v,t.next_out-v)),t.data_type=n.bits+(n.last?64:0)+(n.mode===id?128:0)+(n.mode===$b||n.mode===RO?256:0),(S===0&&v===0||e===UB)&&ct===yp&&(ct=Hq),ct},rd={inflateReset:HB,inflateReset2:WB,inflateResetKeep:GB,inflateInit:t=>KB(t,15),inflateInit2:KB,inflate:zq,inflateEnd:t=>{if(Rp(t))return da;let e=t.state;return e.window&&(e.window=null),t.state=null,yp},inflateGetHeader:(t,e)=>{if(Rp(t))return da;const n=t.state;return 2&n.wrap?(n.head=e,e.done=!1,yp):da},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,o;return Rp(t)?da:(i=t.state,i.wrap!==0&&i.mode!==Zb?da:i.mode===Zb&&(r=1,r=NS(r,e,n,0),r!==i.check)?VB:(o=YB(t,e,n,n),o?(i.mode=16210,BB):(i.havedict=1,yp)))},inflateInfo:"pako inflate (from Nodeca project)"},Yq=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const qB=Object.prototype.toString,{Z_NO_FLUSH:qq,Z_FINISH:Xq,Z_OK:VS,Z_STREAM_END:wO,Z_NEED_DICT:IO,Z_STREAM_ERROR:Jq,Z_DATA_ERROR:XB,Z_MEM_ERROR:Qq}=Hb;function eC(t){this.options=PB({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MB,this.strm.avail_out=0;let n=rd.inflateInit2(this.strm,e.windowBits);if(n!==VS)throw new Error(gp[n]);if(this.header=new Yq,rd.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=vO(e.dictionary):qB.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=rd.inflateSetDictionary(this.strm,e.dictionary),n!==VS)))throw new Error(gp[n])}function Zq(t,e){const n=new eC(e);if(n.push(t),n.err)throw n.msg||gp[n.err];return n.result}eC.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let o,c,l;if(this.ended)return!1;for(c=e===~~e?e:e===!0?Xq:qq,qB.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),o=rd.inflate(n,c),o===IO&&r&&(o=rd.inflateSetDictionary(n,r),o===VS?o=rd.inflate(n,c):o===XB&&(o=IO));n.avail_in>0&&o===wO&&n.state.wrap>0&&t[n.next_in]!==0;)rd.inflateReset(n),o=rd.inflate(n,c);switch(o){case Jq:case XB:case IO:case Qq:return this.onEnd(o),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||o===wO))if(this.options.to==="string"){let h=bq(n.output,n.next_out),p=n.next_out-h,m=Rq(n.output,h);n.next_out=p,n.avail_out=i-p,p&&n.output.set(n.output.subarray(h,h+p),0),this.onData(m)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==VS||l!==0){if(o===wO)return o=rd.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},eC.prototype.onData=function(t){this.chunks.push(t)},eC.prototype.onEnd=function(t){t===VS&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=LB(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var $q={inflate:Zq};const{deflate:t7}=kq,{inflate:e7}=$q;var n7=t7,i7=e7,JB=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(JB||{});class r7{constructor(){D(this,"_sequence",0),D(this,"_startTime",Date.now()),D(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const h={id:0,length:4,data:l.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[h]};n.commonPacketHeader.extension=1,n.extension=p,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;j("SHOW_DATASTREAM2_LOG")&&b.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),o=new DataView(i);let c=0;if(o.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,o.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,o.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const l=this.serializeExtension(n.extension);r.set(new Uint8Array(l),c),c+=l.byteLength}if(r.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let i=0;const r=n.getUint16(i,!0);i+=2;const o={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,l;if(i+=4,j("SHOW_DATASTREAM2_LOG")&&b.debug("receive data header: ".concat(JSON.stringify(o))),n.getUint16(i,!0),i+=2,o.extension){l=this.deserializeExtension(e.slice(i)),i+=2+l.length,c=e.slice(i);let h=!1;if(l.datas.length>0){const p=l.datas.find(m=>m.id===0);p&&(h=!(1&~new DataView(p.data).getUint32(0,!0)))}c=h?this.decompress(c):c}else c=e.slice(8);return c}serializeExtension(e){const{profile:n,length:i,datas:r}=e,o=new ArrayBuffer(i+2),c=new Uint8Array(o),l=new DataView(o);let h=0;if(l.setUint8(h++,n),l.setUint8(h++,i),r.forEach(p=>{n?(l.setUint8(h++,p.id),l.setUint8(h++,p.length),c.set(new Uint8Array(p.data),h),h+=p.data.byteLength):(l.setUint8(h++,p.id|p.length<<4),c.set(new Uint8Array(p.data),h),h+=p.data.byteLength)}),h!==i+2)throw Error("serialize extension error, is ".concat(h,"!==").concat(i+2));return o}deserializeExtension(e){const n=new DataView(e);let i=0;const r=n.getUint8(i);i++;const o=n.getUint8(i);i++;const c=r===JB.TWO_BYTE,l=[],h=new DataView(e,2);let p=0;for(;p<o;){let m=0,S=0,v=new ArrayBuffer(0);c?(m=h.getUint8(p),p++,S=h.getUint8(p),p++):(m=15&h.getUint8(p),S=h.getUint8(p)>>4,p++),S>0&&(v=h.buffer.slice(p+2,p+2+S),p+=v.byteLength),l.push({id:m,length:S,data:v})}if(p!==o)throw Error("parse error");return{profile:r,length:o,datas:l}}decompress(e){return i7(new Uint8Array(e))}compress(e){return n7(new Uint8Array(e))}}const s7={name:"DataStream",create:(t,e)=>{const n=e?new pz(t):new fz(t);return n.useDataStream(new r7),n}};class o7 extends On{constructor(e,n,i){super(),D(this,"ws",void 0),D(this,"requestId",1),D(this,"heartBeatTimer",void 0),D(this,"joinInfo",void 0),D(this,"clientId",void 0),D(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),D(this,"onClose",r=>{this.emit("close"),this.dispose()}),D(this,"onMessage",r=>{const o=JSON.parse(r.data);if(!o||o.command!=="serverResponse"||!o.requestId)return o&&o.command==="serverStatus"&&o.serverStatus&&o.serverStatus.command?(this.emit("status",o.serverStatus),void this.emit(o.serverStatus.command,o.serverStatus)):void 0;this.emit("req_".concat(o.requestId),o)}),this.joinInfo=e,this.clientId=n,this.ws=new hS("cross-channel-".concat(this.clientId),i),this.ws.on(pe.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(pe.CONNECTED,this.onOpen),this.ws.on(pe.ON_MESSAGE,this.onMessage),this.ws.on(pe.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new At((n,i)=>{const r=window.setTimeout(()=>{i(new rt(k.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,o=>{window.clearTimeout(r),o.state&&o.state!==0?i(new rt(k.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new rt(k.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new rt(k.WS_DISCONNECT);const n=()=>new At((c,l)=>{this.ws.once(pe.CLOSED,()=>l(new rt(k.WS_ABORT))),this.ws.once(pe.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(e),r=new At((c,l)=>{const h=()=>{l(new rt(k.WS_ABORT))};this.ws.once(pe.RECONNECTING,h),this.ws.once(pe.CLOSED,h),this.once("req_".concat(i),c),Vi(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(pe.RECONNECTING,h),this.ws.off(pe.CLOSED,h),l(new rt(k.TIMEOUT,"cross channel ws request timeout"))})}),o=await r;if(!o||o.code!==200)throw new rt(k.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o)));return o}async connect(e){this.ws.removeAllListeners(pe.REQUEST_NEW_URLS),this.ws.on(pe.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class a7 extends On{set state(e){e!==this._state&&(e!==ss.RELAY_STATE_FAILURE&&(this.errorCode=sE.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,i,r,o){super(),D(this,"joinInfo",void 0),D(this,"sid",void 0),D(this,"clientId",void 0),D(this,"cancelToken",Br.CancelToken.source()),D(this,"workerToken",void 0),D(this,"requestId",0),D(this,"signal",void 0),D(this,"prevChannelMediaConfig",void 0),D(this,"httpRetryConfig",void 0),D(this,"_resolution",void 0),D(this,"_state",ss.RELAY_STATE_IDLE),D(this,"errorCode",sE.RELAY_OK),D(this,"onStatus",c=>{b.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",Ql.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",Ql.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=sE.SRC_TOKEN_EXPIRED,this.state=ss.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=sE.DEST_TOKEN_EXPIRED,this.state=ss.RELAY_STATE_FAILURE))}),D(this,"onReconnect",async()=>{b.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ql.NETWORK_DISCONNECTED),this.state=ss.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==ss.RELAY_STATE_IDLE&&(b.error("auto restart channel media relay failed",c.toString()),this.errorCode=sE.SERVER_CONNECTION_LOST,this.state=ss.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=np(),this.signal=new o7(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=o}async startChannelMediaRelay(e){if(this.state!==ss.RELAY_STATE_IDLE)throw new rt(k.INVALID_OPERATION);this.state=ss.RELAY_STATE_CONNECTING,await this.connect(),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new rt(k.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new rt(k.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new rt(k.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==ss.RELAY_STATE_RUNNING)throw new rt(k.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==ss.RELAY_STATE_RUNNING)throw new rt(k.INVALID_OPERATION);const n=this.genMessage(Ir.SetVideoProfile);await this.signal.request(n),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),b.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ss.RELAY_STATE_IDLE,this.dispose()}dispose(){b.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Br.CancelToken.source(),this.state=ss.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await TY(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Ql.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(Ir.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Ir.SetSdkProfile,e);await this.signal.request(i),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(Ir.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ql.PACKET_JOINED_SRC_CHANNEL),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const o=this.genMessage(Ir.SetSourceUserId,e);await this.signal.request(o),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(Ir.SetDestChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ql.PACKET_JOINED_DEST_CHANNEL),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(Ir.StartPacketTransfer,e);await this.signal.request(l),this.emit("event",Ql.PACKET_SENT_TO_DEST_CHANNEL),this.state=ss.RELAY_STATE_RUNNING,b.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(Ir.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",Ql.PACKET_UPDATE_DEST_CHANNEL),b.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(Ir.StopPacketTransfer);await this.signal.request(e),b.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const i=[],r=[],o=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:po,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.23.1"&&(c.sdkVersion="0.0.1");let l=null,h=null;switch(e){case Ir.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case Ir.SetSourceChannel:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new rt(k.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},c;case Ir.SetSourceUserId:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new rt(k.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:h.uid+""},c;case Ir.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new rt(k.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(p=>{i.push(p.channelName),r.push(p.uid+""),o.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:o},c;case Ir.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case Ir.Reconnect:return c.clientRequest={command:"Reconnect"},c;case Ir.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case Ir.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new rt(k.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(p=>{i.push(p.channelName),r.push(p.uid+""),o.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:o},c;case Ir.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const c7={name:"ChannelMediaRelay",create:function(t){return new a7(t.joinInfo,t.clientId,t.websocketRetryConfig||di,t.httpRetryConfig||di,t.resolution)}};function QB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function BS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?QB(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):QB(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class l7 extends On{constructor(e,n,i,r){super(),D(this,"spec",void 0),D(this,"token",void 0),D(this,"websocket",void 0),D(this,"pingpongTimer",void 0),D(this,"reconnectMode","retry"),D(this,"serviceMode",void 0),D(this,"reqId",0),D(this,"commandReqId",0),D(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),D(this,"handleWebSocketMessage",o=>{if(!o.data)return;const c=JSON.parse(o.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(qt.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===Jl.TRANSCODE?1:2}),this.emit(lu.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=e,this.serviceMode=r,this.websocket=new hS("live-streaming",i),this.websocket.on(pe.CONNECTED,this.handleWebSocketOpen),this.websocket.on(pe.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(pe.REQUEST_NEW_URLS,(o,c)=>{Wi(this,lu.REQUEST_NEW_ADDRESS).then(o).catch(c)}),this.websocket.on(pe.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const o=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new rt(k.UNEXPECTED_ERROR);const l=BS({command:e,sdkVersion:po==="4.23.1"?"0.0.1":po,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new rt(k.WS_DISCONNECT);const h=()=>new At((v,y)=>{this.websocket.once(pe.CLOSED,()=>y(new rt(k.WS_ABORT))),this.websocket.once(pe.CONNECTED,v)});this.websocket.state!=="connected"&&await h(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const p=new At((v,y)=>{const P=()=>{y(new rt(k.WS_ABORT))};this.websocket.once(pe.RECONNECTING,P),this.websocket.once(pe.CLOSED,P),this.once("@".concat(c,"-").concat(this.spec.sid),I=>{v(I)})});r&&qt.workerEvent(this.spec.sid,BS(BS({},r),{},{requestId:o,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const m=Date.now();this.websocket.sendMessage(l);let S=null;try{S=await p}catch(v){if(this.websocket.state==="closed")throw v;return await h(),await this.request(e,n,i)}return r&&qt.workerEvent(this.spec.sid,BS(BS({},r),{},{requestId:o,actionType:"response",payload:JSON.stringify(S.serverResponse),serverCode:S.code,success:S.code===200,responseTime:Date.now()-m})),S.code!==200&&this.handleResponseError(S),S}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=po==="4.23.1"?"0.0.1":po;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Ei.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void b.warning("live stream response already exists stream");case Ei.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ei.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ei.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new rt(k.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Ei.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new rt(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ei.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new rt(k.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Ei.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new rt(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(lu.WARNING,n,e.serverResponse.url)}case Ei.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new rt(k.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(lu.WARNING,n,e.serverResponse.url)}case Ei.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new rt(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ei.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new rt(k.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Ei.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new rt(k.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(lu.WARNING,n,e.serverResponse.url)}case Ei.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new rt(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Ei.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new rt(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ei.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ei.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new rt(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ei.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new rt(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new rt(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ei.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ei.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ei.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ei.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new rt(k.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(WR)},6e3)}}function ZB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function as(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ZB(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ZB(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class d7 extends On{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:di,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:di;super(),D(this,"onLiveStreamWarning",void 0),D(this,"onLiveStreamError",void 0),D(this,"spec",void 0),D(this,"retryTimeout",1e4),D(this,"connection",void 0),D(this,"httpRetryConfig",void 0),D(this,"wsRetryConfig",void 0),D(this,"streamingTasks",new Map),D(this,"isStartingStreamingTask",!1),D(this,"taskMutex",new Qi("live-streaming")),D(this,"cancelToken",Br.CancelToken.source()),D(this,"transcodingConfig",void 0),D(this,"uapResponse",void 0),D(this,"lastTaskId",1),D(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=as(as({},tY),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(b.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>as(as(as({},$z),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){kn(c.width)||nn(c.width,"config.width",0,1e4),kn(c.height)||nn(c.height,"config.height",0,1e4),kn(c.videoBitrate)||nn(c.videoBitrate,"config.videoBitrate",1,1e6),kn(c.videoFrameRate)||nn(c.videoFrameRate,"config.videoFrameRate"),kn(c.lowLatency)||Yl(c.lowLatency,"config.lowLatency"),kn(c.audioSampleRate)||Si(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),kn(c.audioBitrate)||nn(c.audioBitrate,"config.audioBitrate",1,128),kn(c.audioChannels)||Si(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),kn(c.videoGop)||nn(c.videoGop,"config.videoGop"),kn(c.videoCodecProfile)||Si(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),kn(c.userCount)||nn(c.userCount,"config.userCount",0,17),kn(c.backgroundColor)||nn(c.backgroundColor,"config.backgroundColor",0,16777215),kn(c.userConfigExtraInfo)||Ui(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!kn(c.transcodingUsers)&&(ql(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,h)=>{fb(l.uid),kn(l.x)||nn(l.x,"transcodingUser[".concat(h,"].x"),0,1e4),kn(l.y)||nn(l.y,"transcodingUser[".concat(h,"].y"),0,1e4),kn(l.width)||nn(l.width,"transcodingUser[".concat(h,"].width"),0,1e4),kn(l.height)||nn(l.height,"transcodingUser[".concat(h,"].height"),0,1e4),kn(l.zOrder)||nn(l.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),kn(l.alpha)||nn(l.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),kn(c.watermark)||NI(c.watermark,"watermark"),kn(c.backgroundImage)||NI(c.backgroundImage,"backgroundImage"),c.images&&!kn(c.images)&&(ql(c.images,"config.images"),c.images.forEach((l,h)=>{NI(l,"images[".concat(h,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>as(as(as({},OI),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(as(as(as({},OI),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(as(as(as({},OI),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>as({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?At.resolve(c.uid):_2(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await At.all(r)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var o;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(hr(o=this.streamingTasks).call(o)).map(l=>l.taskId).join("#")});b.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{b.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{b.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(h=>{b.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,h)})})}}async startLiveStreamingTask(e,n,i){if(!this.transcodingConfig&&n===Jl.TRANSCODE)throw new rt(k.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};b.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const o=await this.taskMutex.lock();if(!this.connection&&i)return void o();if(this.streamingTasks.get(e)&&!i)return o(),new rt(k.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(l){throw o(),l}switch(n){case Jl.TRANSCODE:r.transcodingConfig=as({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new At((p,m)=>{Vi(this.retryTimeout).then(()=>{if(i)return m(i);const S=this.statusError.get(e);return S?(this.statusError.delete(e),m(S)):void 0})}),h=await At.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:n===Jl.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,b.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(h.code)),this.streamingTasks.set(e,{clientRequest:r,mode:n,url:e,taskId:c}),o()}catch(l){if(o(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,l)):await this.startLiveStreamingTask(e,n,l)}}stopLiveStreamingTask(e){return new At((n,i)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new rt(k.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const o=r.mode;r.abortTask=()=>{b.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:o===Jl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{b.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var e;const n=Array.from(hr(e=this.streamingTasks).call(e));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Br.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new rt(k.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Wi(this,DI.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new l7(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(lu.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(lu.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(lu.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new rt(k.UNEXPECTED_ERROR,"can not get new live streaming address list"));Wi(this,DI.REQUEST_WORKER_MANAGER_LIST,e).then(o=>{this.uapResponse=o,i(o.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=e.reason;switch(e.code){case Ei.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ei.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ei.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ei.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new rt(k.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return b.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case Ei.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new rt(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case Ei.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ei.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(hr(o=this.streamingTasks).call(o));for(const l of c)l.abortTask?l.abortTask():(b.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new rt(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{b.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(h=>{b.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,h)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const u7={name:"LiveStreaming",create:function(t){return new d7(t.joinInfo,t.websocketRetryConfig||di,t.httpRetryConfig||di)}};function h7(t){let e=ej();return function(n,i){let r=n.appId;r!==void 0&&(Ze(i,10),il(i,r));let o=n.cid;o!==void 0&&(Ze(i,16),Ze(i,o));let c=n.cname;c!==void 0&&(Ze(i,26),il(i,c));let l=n.deviceId;l!==void 0&&(Ze(i,34),il(i,l));let h=n.elapse;h!==void 0&&(Ze(i,40),yu(i,h));let p=n.fileSize;p!==void 0&&(Ze(i,48),yu(i,RE(p)));let m=n.height;m!==void 0&&(Ze(i,56),yu(i,RE(m)));let S=n.jpg;S!==void 0&&(Ze(i,66),Ze(i,S.length),function(Wr,ht){let yt=bE(Wr,ht.length);Wr.bytes.set(ht,yt)}(i,S));let v=n.networkType;v!==void 0&&(Ze(i,72),yu(i,RE(v)));let y=n.osType;y!==void 0&&(Ze(i,80),yu(i,RE(y)));let P=n.requestId;P!==void 0&&(Ze(i,90),il(i,P));let I=n.sdkVersion;I!==void 0&&(Ze(i,98),il(i,I));let O=n.sequence;O!==void 0&&(Ze(i,104),yu(i,RE(O)));let M=n.sid;M!==void 0&&(Ze(i,114),il(i,M));let U=n.timestamp;U!==void 0&&(Ze(i,120),yu(i,U));let W=n.uid;W!==void 0&&(Ze(i,128),Ze(i,W));let $=n.vid;$!==void 0&&(Ze(i,136),Ze(i,$));let Q=n.width;Q!==void 0&&(Ze(i,144),yu(i,RE(Q)));let q=n.service;q!==void 0&&(Ze(i,152),Ze(i,q));let ct=n.callbackData;ct!==void 0&&(Ze(i,162),il(i,ct));let _t=n.jpgEncryption;_t!==void 0&&(Ze(i,168),Ze(i,_t));let Dt=n.requestType;Dt!==void 0&&(Ze(i,176),Ze(i,Dt));let Mt=n.scorePorn;Mt!==void 0&&(Ze(i,185),LO(i,Mt));let De=n.scoreSexy;De!==void 0&&(Ze(i,193),LO(i,De));let Pe=n.scoreNeutral;Pe!==void 0&&(Ze(i,201),LO(i,Pe));let fn=n.scene;fn!==void 0&&(Ze(i,208),Ze(i,fn));let Xn=n.ossFilePrefix;Xn!==void 0&&(Ze(i,218),il(i,Xn));let jn=n.serviceVendor;if(jn!==void 0)for(let Wr of jn){Ze(i,226);let ht=ej();m7(Wr,ht),Ze(i,ht.limit),S7(i,ht),g7(ht)}}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function p7(t){return function(n){let i={};t:for(;!nj(n);){let r=rl(n);switch(r>>>3){case 0:break t;case 1:i.code=rl(n);break;case 2:i.msg=ij(n,rl(n));break;case 3:{let o=E7(n);i.data=f7(n),n.limit=o;break}default:$B(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function f7(t){let e={};t:for(;!nj(t);){let n=rl(t);switch(n>>>3){case 0:break t;case 1:e.requestId=ij(t,rl(t));break;case 2:e.requestType=rl(t)>>>0;break;case 3:e.scorePorn=PO(t);break;case 4:e.scoreSexy=PO(t);break;case 5:e.scoreNeutral=PO(t);break;case 6:e.requestScene=rl(t)>>>0;break;case 7:e.scene=rl(t)>>>0;break;default:$B(t,7&n)}}return e}function m7(t,e){let n=t.service;n!==void 0&&(Ze(e,8),Ze(e,n));let i=t.vendor;i!==void 0&&(Ze(e,16),Ze(e,i));let r=t.token;r!==void 0&&(Ze(e,26),il(e,r));let o=t.callbackUrl;o!==void 0&&(Ze(e,34),il(e,o))}function E7(t){let e=rl(t),n=t.limit;return t.limit=t.offset+e,n}function $B(t,e){switch(e){case 0:for(;128&rj(t););break;case 2:NO(t,rl(t));break;case 5:NO(t,4);break;case 1:NO(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let _7=new Float32Array(1);new Uint8Array(_7.buffer);let OO=new Float64Array(1),cs=new Uint8Array(OO.buffer);function RE(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let tj=[];function ej(){const t=tj.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function g7(t){tj.push(t)}function NO(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function nj(t){return t.offset>=t.limit}function bE(t,e){let n=t.bytes,i=t.offset,r=t.limit,o=i+e;if(o>n.length){let c=new Uint8Array(2*o);c.set(n),t.bytes=c}return t.offset=o,o>r&&(t.limit=o),i}function DO(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function ij(t,e){let n=DO(t,e),i=String.fromCharCode,r=t.bytes,o="�",c="";for(let l=0;l<e;l++){let h,p,m,S,v=r[l+n];128&v?(224&v)==192?l+1>=e?c+=o:(h=r[l+n+1],(192&h)!=128?c+=o:(S=(31&v)<<6|63&h,S<128?c+=o:(c+=i(S),l++))):(240&v)==224?l+2>=e?c+=o:(h=r[l+n+1],p=r[l+n+2],(49344&(h|p<<8))!=32896?c+=o:(S=(15&v)<<12|(63&h)<<6|63&p,S<2048||S>=55296&&S<=57343?c+=o:(c+=i(S),l+=2))):(248&v)==240?l+3>=e?c+=o:(h=r[l+n+1],p=r[l+n+2],m=r[l+n+3],(12632256&(h|p<<8|m<<16))!=8421504?c+=o:(S=(7&v)<<18|(63&h)<<12|(63&p)<<6|63&m,S<65536||S>1114111?c+=o:(S-=65536,c+=i(55296+(S>>10),56320+(1023&S)),l+=3))):c+=o:c+=i(v)}return c}function il(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}Ze(t,i);let r=bE(t,i),o=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?o[r++]=l:(l<2048?o[r++]=l>>6&31|192:(l<65536?o[r++]=l>>12&15|224:(o[r++]=l>>18&7|240,o[r++]=l>>12&63|128),o[r++]=l>>6&63|128),o[r++]=63&l|128)}}function S7(t,e){let n=bE(t,e.limit),i=t.bytes,r=e.bytes;for(let o=0,c=e.limit;o<c;o++)i[o+n]=r[o]}function rj(t){return t.bytes[DO(t,1)]}function sj(t,e){let n=bE(t,1);t.bytes[n]=e}function PO(t){let e=DO(t,8),n=t.bytes;return cs[0]=n[e++],cs[1]=n[e++],cs[2]=n[e++],cs[3]=n[e++],cs[4]=n[e++],cs[5]=n[e++],cs[6]=n[e++],cs[7]=n[e++],OO[0]}function LO(t,e){let n=bE(t,8),i=t.bytes;OO[0]=e,i[n++]=cs[0],i[n++]=cs[1],i[n++]=cs[2],i[n++]=cs[3],i[n++]=cs[4],i[n++]=cs[5],i[n++]=cs[6],i[n++]=cs[7]}function rl(t){let e,n=0,i=0;do e=rj(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function Ze(t,e){for(e>>>=0;e>=128;)sj(t,127&e|128),e>>>=7;sj(t,e)}function yu(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,o=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=bE(t,o),l=t.bytes;switch(o){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=o!==9?128|r:127&r;case 8:l[c+7]=o!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=o!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=o!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=o!==5?128|i:127&i;case 4:l[c+3]=o!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=o!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=o!==2?n>>>7|128:n>>>7&127;case 1:l[c]=o!==1?128|n:127&n}}function oj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const T7=new Map([["moderation",1],["supervise",2]]);class v7 extends On{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Pi.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=qi(n=e.map(i=>T7.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),D(this,"name","AgoraRTCVideoContentInspect"),D(this,"_connectionState",ra.CONNECTING),D(this,"_innerConnectionState",void 0),D(this,"sequence",0),D(this,"inspectStartTime",void 0),D(this,"workerManagerConnection",void 0),D(this,"workerConnection",void 0),D(this,"workerMessageLengthLimit",void 0),D(this,"inspectIntervalMinimum",void 0),D(this,"qualityRatio",void 0),D(this,"_connectInfo",void 0),D(this,"_cancelTokenSource",Br.CancelToken.source()),D(this,"_retryConfig",void 0),D(this,"wmSequence",0),D(this,"inspectInterval",void 0),D(this,"inspectTimer",null),D(this,"ossFilePrefix",void 0),D(this,"extraInfo",void 0),D(this,"_inspectType",void 0),D(this,"_inspectMode",void 0),D(this,"_quality",1),D(this,"qualityTimer",null),D(this,"_inspectId",void 0),D(this,"_needWorkUrlOnly",!1),D(this,"inspectImage",()=>{if(this.connectionState!==ra.CONNECTED)throw new rt(k.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===ra.CONNECTED?this.requestToInspectImage():b.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=hn(5,"inspect-"),this.workerMessageLengthLimit=j("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=j("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=j("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new hS("worker-manager-"+this._inspectId,di),this.on(Pi.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,b.debug("[".concat(this._inspectId,"] Inspect operation :").concat(sa[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new hS("worker-"+this._inspectId,di),this.handleWorkerEvents()}async init(e,n){this.emit(Pi.STATE_CHANGE,sa.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new At((r,o)=>{this.on(Pi.CONNECTION_STATE_CHANGE,(c,l)=>{l===ra.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{o(c)})})}async requestAP(e,n,i){const r=j("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),o=await function(l,h,p,m){let{appId:S,areaCode:v,cname:y,sid:P,token:I,uid:O}=h;pE++;const M="image_moderation_api",U={service_name:M,json_body:JSON.stringify({appId:S,areaCode:v,cname:y,command:"allocateEdge",requestId:pE,seq:pE,sid:P,token:I,ts:Date.now(),uid:O+""})};let W,$,Q=l[0];return ja(async()=>{W=Date.now();const q=await Ka(Q,{data:U,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-W,q.code!==0){const Mt=new rt(k.UNEXPECTED_RESPONSE,"image inspect ap error, code"+q.code,{retry:!0,responseTime:$});throw b.error(Mt.toString()),Mt}const ct=JSON.parse(q.json_body);if(ct.code!==200){const Mt=new rt(k.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ct.code,", reason: ").concat(ct.reason),{code:ct.code,responseTime:$});throw b.error(Mt.toString()),Mt}if(!ct.servers||!Array.isArray(ct.servers)||ct.servers.length===0){const Mt=new rt(k.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ct.code,responseTime:$});throw b.error(Mt.toString()),Mt}const _t=j("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Dt=j("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ct.servers.map(Mt=>{let{address:De,wss:Pe}=Mt;if(De&&Pe)return"wss://".concat(De.replace(/\./g,"-"),".").concat(_t,":").concat(Dt||Pe)}).filter(Mt=>!!Mt),workerToken:ct.workerToken,vid:ct.vid,responseTime:$}},(q,ct)=>(qt.apworkerEvent(P,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(q.addressList),firstSuccess:ct===0,responseTime:$,serverIp:l[ct%l.length]}),!1),(q,ct)=>(qt.apworkerEvent(P,{success:!1,sc:q.data&&q.data.code||200,serviceName:M,responseTime:$,serverIp:l[ct%l.length]}),!!(q.code!==k.OPERATION_ABORTED&&q.code!==k.UNEXPECTED_RESPONSE||q.data&&q.data.retry)&&(Q=l[(ct+1)%l.length],!0)),m)}(r,e,n,i);this.emit(Pi.STATE_CHANGE,sa.AP_CONNECTED);const{addressList:c}=o;return this.wmSequence++,c}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Pi.STATE_CHANGE,sa.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(pe.CONNECTED,async()=>{this.emit(Pi.STATE_CHANGE,sa.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(pe.CLOSED,()=>{this._innerConnectionState<sa.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(pe.FAILED,()=>{this._innerConnectionState<sa.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(pe.RECONNECTING,()=>{this._innerConnectionState<sa.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(pe.ON_MESSAGE,async e=>{this.emit(Pi.STATE_CHANGE,sa.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw b.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new rt(k.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw b.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new rt(k.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=j("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,o=n.replace(/:\d+\/?$/,":".concat(r));this.emit(Pi.STATE_CHANGE,sa.CONNECT_WORKER,o),this._needWorkUrlOnly?this.emit(Pi.REQUEST_NEW_WORKER_URL,o):await this.connectWorker(o)}}),this.workerManagerConnection.on(pe.WILL_RECONNECT,(e,n,i)=>{i(e)}),this.workerManagerConnection.on(pe.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(pe.CONNECTED,async()=>{this.emit(Pi.STATE_CHANGE,sa.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=ra.CONNECTED}),this.workerConnection.on(pe.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=p7(new Uint8Array(e.data));if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&b.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Pi.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},o=qi(n=Object.keys(r)).call(n,(l,h)=>r[l]>r[h]?l:h,"porn"),c=Object.keys(r).find(l=>l===o);this.emit(Pi.INSPECT_RESULT,c)}else this.emit(Pi.INSPECT_RESULT,void 0,new rt(k.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Pi.INSPECT_RESULT,void 0,new rt(k.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else b.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Pi.INSPECT_RESULT,void 0,new rt(k.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(pe.CLOSED,()=>{this.connectionState=ra.CLOSED}),this.workerConnection.on(pe.FAILED,()=>{this.connectionState=ra.CLOSED}),this.workerConnection.on(pe.RECONNECTING,()=>{this.connectionState=this.connectionState===ra.CONNECTED?ra.RECONNECTING:ra.CONNECTING}),this.workerConnection.on(pe.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(pe.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(Pi.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const e=Fs(this,Pi.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Pi.INSPECT_RESULT,void 0,new rt(k.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Pi.INSPECT_RESULT,void 0,new rt(k.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:i,cname:r,cid:o,vid:c,sid:l,uid:h}=n;const p=Date.now(),m=await e.getCurrentFrameImage("image/jpeg",this.quality),S=await FM(m,i,r),v=this.sequence+"-"+o+"-"+h+"-"+p+"-"+hn(12,""),y={appId:i,cid:o,cname:r,deviceId:"",elapse:(P=Number(p-this.inspectStartTime),{low:P|=0,high:P>>31,unsigned:P>=0}),fileSize:S.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:S,networkType:6,osType:7,requestId:v,sdkVersion:"4.23.1",sequence:this.sequence,sid:l,timestamp:hV(p),uid:h,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var P;this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;const I=h7(y);if(I.byteLength<this.workerMessageLengthLimit){if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const O=function(M){for(var U=1;U<arguments.length;U++){var W=arguments[U]!=null?arguments[U]:{};U%2?oj(Object(W),!0).forEach(function($){D(M,$,W[$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(W)):oj(Object(W)).forEach(function($){Object.defineProperty(M,$,Object.getOwnPropertyDescriptor(W,$))})}return M}({},y);delete O.jpg,b.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(O))}return I}{const O=this.quality*this.qualityRatio;return this.quality=O,await this.generateRequestData(e,{appId:i,cname:r,cid:o,vid:c,sid:l,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Br.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=ra.CLOSED,this.emit(Pi.STATE_CHANGE,sa.CLOSED)}}const y7={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new rt(k.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new rt(k.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var o;if(!Ct(o=["supervise","moderation"]).call(o,r))throw new rt(k.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new rt(k.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new v7(e)}};var aj=R(Oi.Object.getOwnPropertySymbols),R7=qe,b7=a_.indexOf,C7=Ad,kO=ae([].indexOf),cj=!!kO&&1/kO([1],1,-0)<0;R7({target:"Array",proto:!0,forced:cj||!C7("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return cj?kO(this,t,e)||0:b7(this,t,e)}});var A7=Zr("Array","indexOf"),w7=et,I7=A7,MO=Array.prototype,O7=function(t){var e=t.indexOf;return t===MO||w7(MO,t)&&e===MO.indexOf?I7:e},lj=R(O7);function N7(t,e){if(t==null)return{};var n,i,r=function(c,l){if(c==null)return{};var h,p,m={},S=AU(c);for(p=0;p<S.length;p++)h=S[p],lj(l).call(l,h)>=0||(m[h]=c[h]);return m}(t,e);if(aj){var o=aj(t);for(i=0;i<o.length;i++)n=o[i],lj(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}let dj=class{get localCapabilities(){return Vn(this._localCapabilities)}get rtpCapabilities(){return Vn(this._rtpCapabilities)}get candidates(){return Vn(this._candidates)}get iceParameters(){return Vn(this._iceParameters)}get dtlsParameters(){return Vn(this._dtlsParameters)}constructor(t){D(this,"sessionDesc",void 0),D(this,"_localCapabilities",void 0),D(this,"_rtpCapabilities",void 0),D(this,"_candidates",void 0),D(this,"_iceParameters",void 0),D(this,"_dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname","o/i14u9pJrxRKAsu"),D(this,"firefoxSsrcMidMap",new Map),t=Vn(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:o,direction:c,setup:l,videoCodec:h,audioCodec:p}=t;let m;this.setup=l,m=c===wr.RECEIVE_ONLY?rs(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):rs(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=o;const S=c===wr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,v=c===wr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=c===wr.RECEIVE_ONLY?r.send.videoCodecs:mS(Vt.VIDEO,S,v,h),P=c===wr.RECEIVE_ONLY?r.send.audioCodecs:mS(Vt.AUDIO,S,v,p);for(const I of m.mediaDescriptions)I.attributes.iceUfrag=e.iceUfrag,I.attributes.icePwd=e.icePwd,I.attributes.fingerprints=n.fingerprints,I.attributes.candidates=i,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"&&(I.media.fmts=y.map(O=>O.payloadType.toString(10)),I.attributes.payloads=y,I.attributes.extmaps=S.videoExtensions),I.media.mediaType==="audio"&&(I.media.fmts=P.map(O=>O.payloadType.toString(10)),I.attributes.payloads=P,I.attributes.extmaps=S.audioExtensions,hE(I));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return cu(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:c}=up(e,this.cname,j("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(o);if(l){if(Un()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(t,o,i);let p;return h===-1?(p=this.createOrRecycleSendMedia(t,o,c,"sendonly",i,r),this.updateBundleMids()):(p=Vn(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="sendonly",p.attributes.ssrcs=o,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(p,r)),Un()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,p.attributes.mid),{needExchangeSDP:!0,mid:p.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const i=[];return t.forEach(r=>{const o=r._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(o);let l,h=!1;c===-1?(h=!0,l=this.createOrRecycleRecvMedia(r,[],"recvonly",e,n),this.updateBundleMids()):(l=Vn(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),i.push({mid:l.attributes.mid,needCreateTransceiver:h})}),i}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:i,port:r,type:o,relatedAddress:c,relatedPort:l,priority:h}=new RTCIceCandidate(t),p={foundation:e??"",componentId:"1",transport:n??"",priority:h?h+"":"",connectionAddress:i??"",port:r?r+"":"",type:o?o+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(m=>m.priority===p.priority&&m.connectionAddress===p.connectionAddress&&m.port===p.port)||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,i,r){const o=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=mS(o,c,this.localCapabilities.send,o===Vt.AUDIO?r:i),h=o===Vt.VIDEO?c.videoExtensions:c.audioExtensions,p="".concat(++this.currentMidIndex);let m={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};m=this.mungRecvMediaDsec(m,t);const S=this.findFirstClosedMedia(o);if(S){const v=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[v]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Ct(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Ct(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Un()){if(r){const o=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(o||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!o||o!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=Vn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,i,r,o){const c=this.rtpCapabilities.send,l=t===Vt.VIDEO?c.videoCodecs:c.audioCodecs,h=t===Vt.VIDEO?c.videoExtensions:c.audioExtensions;Un()&&(r="".concat(++this.currentMidIndex));let p={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};p=this.mungSendMediaDesc(p,o);const m=this.findFirstClosedMedia(t);if(m){const S=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[S]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}mungRecvMediaDsec(t,e,n){const i=Vn(t);return xI(i),uE(i,e),UI(i,e),QU(i),vb(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=Vn(t);return vb(n,e,this.localCapabilities.recv),hE(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>Un()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const D7=["sdp"];var Sn;function uj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ru(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?uj(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):uj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let hj=(Sn=class OE extends PU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,i){super(e,n),D(this,"direction",void 0),D(this,"name",void 0),D(this,"store",void 0),D(this,"spec",void 0),D(this,"peerConnection",void 0),D(this,"initialOffer",void 0),D(this,"transport",void 0),D(this,"statsFilter",void 0),D(this,"localCandidateCount",0),D(this,"_isInRestartIce",!1),D(this,"mutex",void 0),D(this,"onLocalCandidate",void 0),D(this,"remoteSDP",void 0),D(this,"pendingCandidates",[]),D(this,"localCapabilities",void 0),D(this,"isReady",!1),D(this,"restartCnt",0),D(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new Qi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(OE.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??wr.SEND_ONLY,this.name=this.direction===wr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Q0(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Un()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await $U();if(this.localCapabilities=yb(n),e){const{sdp:i}=e,r=N7(e,D7),o=function(){const m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},S=fS(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oa(S,m,"videoExtensions",v,y,P),oa(S,m,"videoCodecs",v,y,P),oa(S,m,"audioExtensions",v,y,P),oa(S,m,"audioCodecs",v,y,P),j("RAISE_H264_BASELINE_PRIORITY")){const I=P.videoCodecs.findIndex(O=>O.rtpMap&&O.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&O.fmtp&&O.fmtp.parameters["profile-level-id"]==="42001f");if(I!==-1){const O=P.videoCodecs.findIndex(M=>M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(O<I){b.debug("raising H264 baseline profile priority");const M=P.videoCodecs[I];P.videoCodecs.splice(I,1),P.videoCodecs.splice(O,0,M)}O!==-1&&j("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(M=>!(M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&M.fmtp&&M.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:v,recv:y,sendrecv:P}}({},{},i);this.remoteSDP=new dj({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=hu(c.sdp);await this.peerConnection.setLocalDescription(c);const h=await t2({},{},c.sdp);this.localCapabilities=yb(h);const p=this.peerConnection.getTransceivers()[0];return p!=null&&p.receiver&&p.receiver.transport&&this.tryBindTransportEvents(p.receiver.transport),Ru(Ru({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=hu(i.sdp);return this.initialOffer=i,Ru(Ru({},r),{},{sdp:i.sdp})}}catch(n){throw new at(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=e,o=await t2({},{},n);this.remoteSDP=new dj({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new at(k.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return ho(function*(){const o=yield Ue(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=r.remoteSDP.receive(e,n,i);e.forEach((O,M)=>{if(l[M].needCreateTransceiver){const U=r.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});c.push(U),O._updateRtpTransceiver(U)}else{const U=r.peerConnection.getTransceivers().find(W=>W.mid===l[M].mid);if(!U)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[M].mid));c.push(U),O._updateRtpTransceiver(U)}}),Un()&&j("SIMULCAST")===!0&&(yield Ue(r.applySimulcastForFirefox(c,e)));const h=l.map(O=>O.mid),p=yield Ue(r.peerConnection.createOffer()),m=r.mungSendOfferSDP(p.sdp,e,h),S=rs(m),v=h.map(O=>{const M=S.mediaDescriptions.find(U=>U.attributes.mid===O);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return qU(M,j("USE_PUB_RTX"))}),y=c.map((O,M)=>{const U=h[M];return{localSSRC:v[M],id:U}});yield Ue(r.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield y}catch(O){const M=r.remoteSDP.toString();throw yield Ue(r.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Ue(r.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield Ue(r.stopSending(h,!0)),O}yield Ue(r.applySimulcastEncodings(c,e)),yield Ue(r.applySendEncodings(c,e));const P=r.remoteSDP.toString(),I=r.logSDPExchange(m,"offer","local","send");return I==null||I(P),yield Ue(r.setRemoteDescription({type:"answer",sdp:P})),c.map((O,M)=>{const U=h[M];return{localSSRC:v[M],id:U}})}catch(c){throw c instanceof at?c:new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}})()}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(h=>e.indexOf(h.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));r.map(h=>{var p;h.direction="inactive",(p=h.stop)===null||p===void 0||p.call(h)});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const h=this.remoteSDP.toString(),p=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});const m=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(m.sdp,o,e);p==null||p(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(h=>h.mid===o);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(o){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async mockReceive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const l=this.remoteSDP.toString(),h=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,o,e);h==null||h(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(o){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===ip.Auto&&(this.store.p2pTransport=ip.SdRtn,Ge().supportPCSetConfiguration&&this.peerConnection.setConfiguration(OE.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ge().supportPCSetConfiguration&&this.peerConnection.setConfiguration(OE.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=hu(n.sdp);return this.store.descriptionStart(),this.direction===wr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===wr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=hu(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const o=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new at(k.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?Un()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:Ru(Ru({},Kc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Ru(Ru({},Kc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;Ct(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var o;return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(eS(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...OE.turnServerConfigToIceServers(e.turnServer.servers,n,i)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...OE.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,i)),Ct(o=[ip.Relay,ip.SdRtn]).call(o,n)&&(r.iceTransportPolicy="relay"),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&Ge().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),b.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],o=e.filter(l=>l.tcpport);b.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(i));const c=o.length>i?o[i]:o[0];switch(n){case ip.SdRtn:const l=e.filter(p=>{var m;return Ct(m=p.username).call(m,"glb:")&&p.turnServerURL==p.turnServerURL}),h=l.length>i?l[i]:l[0];h&&(r.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(lE(h.turnServerURL),":").concat(h.tcpport,"?transport=udp")}),r.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(lE(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;case ip.Relay:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(lE(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(lE(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair();b.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(m=>m.track===e._mediaStreamTrack)),!n)return b.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return b.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ge().supportSetRtpSenderParameters)return b.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},o={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:m,frameRate:S,scaleResolutionDownBy:v}=e._encoderConfig;m&&(o.maxBitrate=1e3*m),Ct(c=e._hints).call(c,pn.LOW_STREAM)&&(S&&(o.maxFramerate=Cs(S)),v&&v>=1&&(o.scaleResolutionDownBy=v))}if(j("DSCP_TYPE")&&zl()){var l;const m=j("DSCP_TYPE");Ct(l=["very-low","low","medium","high"]).call(l,m)&&(o.networkPriority=m)}const h=n.getParameters(),p=(i=h.encodings)===null||i===void 0?void 0:i[0];Un()&&!p&&(r.encodings=[o]),p&&Object.assign(p,o),Object.assign(h,r),b.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await n.setParameters(h)}async applySendEncodings(e,n){try{if(!Ge().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],o=n[i];o instanceof vn&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,r.sender)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=rs(e);return n.forEach((o,c)=>{const l=i[c],h=r.mediaDescriptions.find(p=>p.attributes.mid===l);h&&(uE(h,o),ZU(h,o,this.store.codec))}),cu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let h=0;h<e.length;h++){var i,r,o,c,l;const p=e[h],m=n[h];if(m instanceof vn&&!Ct(i=m._hints).call(i,pn.LOW_STREAM)&&(r=m._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=m._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=m._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=m._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const S={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,S))}}}async applySimulcastEncodings(e,n){if(!Un()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof vn&&this.isVP8Simulcast(r)){const o=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const h=o.sender.getParameters();await o.sender.setParameters(Object.assign(h,c))}}}isVP8Simulcast(e){var n,i,r,o,c;return!!(e instanceof vn&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Ct(n=e._hints).call(n,pn.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(o=e._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(j("SDP_LOGGING"))return b.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?o=>{this.logSDPExchange(o,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const o=this.remoteSDP.toString();r==null||r(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const o=this.remoteSDP.toString();r==null||r(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var i,r;if(n=(i=n)!==null&&i!==void 0?i:(r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp){var o;const c=(o=rs(n).mediaDescriptions.find(l=>l.attributes.mid===e))===null||o===void 0?void 0:o.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),Ct(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,i){const r=rs(e),o=r.mediaDescriptions.find(c=>c.attributes.mid===n);return o&&i===Vt.AUDIO&&o.media.mediaType==="audio"&&hE(o),cu(r)}},Wt(Sn.prototype,"establish",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"establish"),Sn.prototype),Wt(Sn.prototype,"connect",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"connect"),Sn.prototype),Wt(Sn.prototype,"receive",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"receive"),Sn.prototype),Wt(Sn.prototype,"mockReceive",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"mockReceive"),Sn.prototype),Wt(Sn.prototype,"stopReceiving",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"stopReceiving"),Sn.prototype),Wt(Sn.prototype,"restartICE",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"restartICE"),Sn.prototype),Wt(Sn.prototype,"close",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"close"),Sn.prototype),Wt(Sn.prototype,"updateEncoderConfig",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"updateEncoderConfig"),Sn.prototype),Wt(Sn.prototype,"updateSendParameters",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"updateSendParameters"),Sn.prototype),Wt(Sn.prototype,"replaceTrack",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"replaceTrack"),Sn.prototype),Wt(Sn.prototype,"muteLocal",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"muteLocal"),Sn.prototype),Wt(Sn.prototype,"unmuteLocal",[ua],Object.getOwnPropertyDescriptor(Sn.prototype,"unmuteLocal"),Sn.prototype),Sn);function ua(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,o=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await i.apply(this,l)}finally{o()}},n}let Ya=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var pj,fj,mj,Ej,_j,gj,Sj,Tj,vj,yj,Rj,wn;function bj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function nC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bj(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let P7=(pj=qa(Ya.SEND_ONLY),fj=qa(Ya.SEND_ONLY),mj=qa(),Ej=qa(Ya.RECEIVE_ONLY),_j=qa(Ya.RECEIVE_ONLY),gj=qa(Ya.RECEIVE_ONLY),Sj=qa(Ya.RECEIVE_ONLY),Tj=qa(Ya.RECEIVE_ONLY),vj=qa(Ya.RECEIVE_ONLY),yj=qa(),Rj=qa(Ya.RECEIVE_ONLY),wn=class extends On{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit($t.StateChange,e,this._state)}constructor(t,e){super(),D(this,"isPlanB",!1),D(this,"store",void 0),D(this,"statsUploader",void 0),D(this,"sendConnection",void 0),D(this,"recvConnection",void 0),D(this,"localTrackMap",new Map),D(this,"remoteUserMap",new Map),D(this,"localDataChannels",[]),D(this,"pendingLocalTracks",[]),D(this,"pendingRemoteTracks",[]),D(this,"statsCollector",void 0),D(this,"dtlsFailedCount",0),D(this,"sendMutex",void 0),D(this,"recvMutex",void 0),D(this,"_state",Je.Disconnected),D(this,"_restartStates",["disconnected","failed"]),D(this,"reconnectInterval",void 0),D(this,"uploadUnplinkStarted",!1),D(this,"uploadDownlinkStarted",!1),D(this,"uplinkStateUploadInterval",void 0),D(this,"downlinkStatsUploadInterval",void 0),D(this,"handleMuteLocalTrack",async(n,i,r)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Je.Connected)return void r(new at(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const h=this.filterTobeMutedTracks(n);if(h.length===0)return void i();const p=h.find(y=>y[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(h.map(y=>{let[,{id:P}]=y;return P}));let m=!1;var c,l;n.trackMediaType==="video"?m=!((c=this.localTrackMap.get(Et.LocalAudioTrack))===null||c===void 0||!c.track._muted):m=((l=this.localTrackMap.get(Et.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const S=this.createMuteMessage(h);await un(this,$t.RequestMuteLocal,S);const v=n.trackMediaType==="video"?du.MUTE_LOCAL_VIDEO:du.MUTE_LOCAL_AUDIO;await un(this,$t.RequestP2PMuteLocal,{action:v,message:S,isMuteAll:m}),i()}catch(h){r(h)}finally{o()}}),D(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Je.Connected)return void r(new at(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map(p=>{let[,{id:m}]=p;return m}));const l=this.createUnmuteMessage(c),h=n.trackMediaType==="video"?du.UNMUTE_LOCAL_VIDEO:du.UNMUTE_LOCAL_AUDIO;await un(this,$t.RequestP2PMuteLocal,{action:h,message:l}),i()}catch(c){r(c)}finally{o()}}),D(this,"handleUpdateVideoEncoder",async(n,i,r,o)=>{let c;typeof o=="boolean"&&o||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const h=this.localTrackMap.get(Et.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==n||this.state!==Je.Connected)return void i();const{id:p,track:m}=h;p&&(await this.sendConnection.updateSendParameters(p,m),await this.sendConnection.updateEncoderConfig(p,m),this.emit($t.UpdateVideoEncoder,m)),i()}catch(h){r(h)}finally{var l;(l=c)===null||l===void 0||l()}}),D(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(Et.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==Je.Connected)return void i();const{id:l,track:h}=c;l&&await this.sendConnection.updateSendParameters(l,h),i()}catch(c){r(c)}finally{o()}}),D(this,"handleReplaceTrack",async(n,i,r,o)=>{let c;b.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof o=="boolean"&&o||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const p=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:S}]=m;return n===S});if(!this.sendConnection||!p||p[1].id===void 0||this.state!==Je.Connected)return void i();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,p[1].id)),p[0]===Et.LocalVideoTrack&&Ge().supportDualStreamEncoding){const m=this.localTrackMap.get(Et.LocalVideoLowTrack);if(m){const S=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=S,m.track._originMediaStreamTrack=S,await new At((v,y)=>{this.handleReplaceTrack(m.track,v,y,!0)})}}i()}catch(p){r(p)}finally{var h;(h=c)===null||h===void 0||h()}}),D(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),D(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),D(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),D(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new B2(t),this.bindStatsUploaderEvents(),this.sendMutex=new Qi("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Qi("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},j("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new at(k.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new at(k.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new hj(t,this.store,wr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Je.New,this.sendConnection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new hj(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new at(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Je.Connected}async addRemoteCandidate(t,e){if(e===wr.RECEIVE_ONLY){if(!this.sendConnection)throw new at(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new at(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var i=this;return ho(function*(){const r=yield Ue(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Je.Connected){i.throwIfTrackTypeNotMatch(t);const p=t.filter(m=>i.pendingLocalTracks.indexOf(m)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(p))}i.store.pubId=i.store.pubId+1,$i.markPublishStart(i.store.clientId,i.store.pubId);const o=i.filterTobePublishedTracks(t,e,n);if(o.length===0)return void(yield Ue(i.tryToUnmuteAudio(t)));o.forEach(p=>{let{track:m,type:S}=p;const v=Date.now();i.store.publish(m.getTrackId(),S===Et.LocalAudioTrack?"audio":"video",v)}),i.bindLocalTrackEvents(o);const c=yield Ue(i.sendConnection.send(o.map(p=>{let{track:m}=p;return m}),i.store.codec,i.store.audioCodec)),l=(yield Ue(c.next())).value,h=i.createGatewayPublishMessage(o,l);try{yield h}catch(p){throw c.throw(p),(p==null?void 0:p.code)===k.WS_ABORT&&o.forEach(m=>{let{track:S}=m;i.pendingLocalTracks.indexOf(S)===-1&&i.pendingLocalTracks.push(S)}),i.unbindLocalTrackEvents(o),p}yield Ue(c.next()),o.forEach(p=>{let{type:m}=p;i.statsCollector.addLocalStats(m)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(o,l),o.forEach(p=>{let{track:m,type:S}=p;const v=Date.now();i.store.publish(m.getTrackId(),S===Et.LocalAudioTrack?"audio":"video",void 0,v)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Je.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!Ct(t).call(t,r)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(r=>{let[,{id:o}]=r;return o})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[o,{track:c}]=r;return{type:o,track:c}})),e.forEach(r=>{let[o]=r;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Je.Connected)return n&&n[1].track.close(),i;t.forEach(r=>{const o=this.pendingLocalTracks.indexOf(r);o!==-1&&this.pendingLocalTracks.splice(o,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:o,ssrcs:c}]=i;const l={stream_type:wY(o,r),ssrcs:c};o._muted||!o._enabled?e.push(l):n.push(l)}),e.length>0&&e.forEach(i=>{un(this,$t.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{un(this,$t.RequestUnmuteLocal,[i])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return ho(function*(){throw new at(k.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(b.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Wi(this,$t.RequestRePublish,this.pendingLocalTracks),this.emit($t.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new at(k.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,i){var r;if(!this.recvConnection)throw new at(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:o,mid:c,transceiver:l}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),i);e===Vt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(o):(t._audioTrack=new eE(o,t.uid,t._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),l&&t._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(o):(t._videoTrack=new tE(o,t.uid,t._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),l&&t._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._videoTrack));const h=this.remoteUserMap.get(t);h?h.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const p=this.pendingRemoteTracks.findIndex(m=>{let{user:S,kind:v}=m;return S.uid===t.uid&&e===v});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit($t.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,i){if(!this.recvConnection)throw new at(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),i)}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(o=>{let{user:c,kind:l}=o;return e!==void 0?c.uid===t.uid&&e===l:c.uid===t.uid});if(i.forEach(o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||i.forEach(o=>{let{kind:c}=o;var l;if(c===Vt.AUDIO)(l=t._audioTrack)===null||l===void 0||l._destroy(),t._audioTrack=void 0;else if(c===Vt.VIDEO){var h;(h=t._videoTrack)===null||h===void 0||h._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(t,e);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(o=>{let[c,{kind:l}]=o;var h,p;if(l===Vt.VIDEO&&c._videoSSRC&&((h=this.recvConnection)===null||h===void 0||h.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===Vt.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0);else if(l===Vt.AUDIO){var m;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((m=c._audioTrack)===null||m===void 0||m._destroy(),c._audioTrack=void 0)}}),r.forEach(o=>{let[,{kind:c}]=o;un(this,$t.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[Vt.VIDEO,Vt.AUDIO].forEach(i=>{n.has(i)?un(this,$t.RequestP2PUnmuteRemote,i):un(this,$t.RequestP2PMuteRemote,i)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new at(k.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new at(k.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new at(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new at(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===Vt.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||b.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(Et.LocalAudioTrack);if((e==null?void 0:e.track)instanceof mi){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==Et.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===Et.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===Et.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(Et.LocalAudioTrack),l=i?this.localTrackMap.get(Et.LocalVideoLowTrack):this.localTrackMap.get(Et.LocalVideoTrack);qt.publish(this.store.sessionId,{eventElapse:$i.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(pn.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var o;n||(n=[]);const c=n.find(h=>h instanceof Bn),l=i?(o=this.localTrackMap.get(Et.LocalVideoTrack))===null||o===void 0?void 0:o.track:n.find(h=>h instanceof vn);qt.publish(this.store.sessionId,{eventElapse:$i.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(pn.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===Vt.VIDEO?n._videoSSRC:n._audioSSRC;r&&qt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===Vt.VIDEO,audio:i===Vt.AUDIO,peerid:n.uid,subscribeRequestid:i===Vt.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:$i.measureFromSubscribeStart(this.store.clientId,r)})}reset(){b.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Qi("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Qi("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Et.LocalAudioTrack);if((t==null?void 0:t.track)instanceof mi){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Je.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Et.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Et.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof vn||e&&e.track instanceof Bn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(Hs(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(Et.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=jg(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(b.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Je.Reconnecting,j("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case Et.LocalVideoTrack:Ct(e=i._hints).call(e,pn.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case Et.LocalAudioTrack:i instanceof mi?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case Et.LocalVideoLowTrack:}}),this.emit($t.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Hs(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit($t.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),b.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof fu?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,i;if(t===wr.SEND_ONLY){if(!this.sendConnection)throw new at(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new at(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){const r=await i.restartICE(e);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const o=await Wi(this,$t.RequestP2PRestartICE,{direction:wr.RECEIVE_ONLY,iceParameter:r});await i.restartICE(o),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(Et.LocalVideoTrack),n=this.localTrackMap.get(Et.LocalAudioTrack),i=t.videoSend.find(y=>{var P;return y.ssrc===(e==null||(P=e.ssrcs)===null||P===void 0?void 0:P[0].ssrcId)}),r=t.audioSend.find(y=>{var P;return y.ssrc===(n==null||(P=n.ssrcs)===null||P===void 0?void 0:P[0].ssrcId)});if(!i||!r)return 1;const o=Fs(this,$t.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,h=c&&l?(c+l)/2:c||l,p=(h&&o?(h+o)/2:h||o)||0,m=100*t.sendPacketLossRate*.7/50+.3*p/1500,S=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,v=e==null?void 0:e.track;if(v&&v._encoderConfig&&v._hints.indexOf(pn.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,P=t.bitrate.actualEncoded;if(y&&P){const I=(1e3*y-P)/(1e3*y);return RU[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,o=i._videoSSRC,c=t.audioRecv.find(P=>P.ssrc===r),l=t.videoRecv.find(P=>P.ssrc===o);if(!c&&!l)return void(e+=1);const h=Fs(this,$t.NeedSignalRTT),p=t.rtt,m=(p&&h?(p+h)/2:p||h)||0,S=c?c.jitterMs:void 0,v=t.recvPacketLossRate;let y=.7*v*100/50+.3*m/1500;S&&(y=.6*v*100/50+.2*m/1500+.2*S/400),e+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new At((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const i=[],r=Ge(),o=this.getAllTracks();t=Gm(t=t.filter(h=>o.indexOf(h)===-1));let c=!1,l=!1;for(const h of t){if(h instanceof vn&&(this.localTrackMap.has(Et.LocalVideoTrack)||c?new at(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:h,type:Et.LocalVideoTrack}),c=!0),e)){const p=this.getLowVideoTrack(h,n);i.push({track:p,type:Et.LocalVideoLowTrack})}if(h instanceof Bn){const p=this.localTrackMap.get(Et.LocalAudioTrack);if(p){if(!(p.track instanceof mi))throw new at(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new at(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0)}else if(l){const m=i.find(S=>{let{type:v}=S;return v===Et.LocalAudioTrack});if(!(m.track instanceof mi))throw new at(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new at(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(h)}else{if(!r.webAudioMediaStreamDest||h instanceof mi||h._bypassWebAudio)i.push({track:h,type:Et.LocalAudioTrack});else{const m=new mi;m.addAudioTrack(h),i.push({track:m,type:Et.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Gm(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof Bn){const r=this.localTrackMap.get(Et.LocalAudioTrack);if(!r)continue;r.track instanceof mi?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([Et.LocalAudioTrack,r]),r.track.close())):e.push([Et.LocalAudioTrack,r])}if(i instanceof vn){const r=this.localTrackMap.get(Et.LocalVideoTrack);if(!r)continue;e.push([Et.LocalVideoTrack,r]);const o=this.localTrackMap.get(Et.LocalVideoLowTrack);o&&e.push([Et.LocalVideoLowTrack,o])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case Et.LocalVideoTrack:n.addListener(jt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(jt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(jt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(jt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Et.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Et.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof mi?t.trackList.forEach(n=>{n.addListener(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(jt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(jt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(jt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case Et.LocalVideoTrack:n.off(jt.GET_STATS,this.handleGetLocalVideoStats),n.off(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(jt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(jt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(jt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Et.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Et.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof mi?t.trackList.forEach(e=>{e.off(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(jt.GET_STATS,this.handleGetLocalAudioStats),e.off(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(jt.GET_STATS,this.handleGetLocalAudioStats),t.off(jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(jt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof tE&&e.addListener(jt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof eE&&e.addListener(jt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(jt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(Vt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(Vt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let o,{track:c,type:l}=n;switch(l){case Et.LocalAudioTrack:o=Qe.Audio;break;case Et.LocalVideoTrack:o=Ct(r=c._hints).call(r,pn.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Et.LocalVideoLowTrack:o=Qe.Low}return{kind:l===Et.LocalAudioTrack?Vt.AUDIO:Vt.VIDEO,stream_type:o,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case Et.LocalVideoTrack:i=Ct(n=o._hints).call(n,pn.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Et.LocalAudioTrack:i=Qe.Audio;break;case Et.LocalVideoLowTrack:i=Qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:o}=n;this.localTrackMap.set(o,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit($t.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),Ct(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await Vi(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),qt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Mn.TRACER}).onSuccess(),this.emit($t.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Xm.FIRST_FRAME_DECODED),qt.firstRemoteFrame(this.store.sessionId,bi.FIRST_AUDIO_DECODE,Cn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:$i.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&qt.firstRemoteFrame(this.store.sessionId,bi.FIRST_AUDIO_RECEIVED,Cn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:$i.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&qt.firstRemoteFrame(this.store.sessionId,bi.FIRST_VIDEO_RECEIVED,Cn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:$i.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit($t.ConnectionTypeChange,i),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uu(n))," -> ").concat(JSON.stringify(uu(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uu(n))," -> ").concat(JSON.stringify(uu(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit($t.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===wr.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,b.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===wr.SEND_ONLY?this.restartICE(t):Wi(this,$t.RequestP2PRestartICE,{direction:wr.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(Et.LocalAudioTrack);if(t instanceof Bn&&(n==null?void 0:n.track)instanceof mi)return n.track.isActive||e.push([Et.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return t===o});if(i&&(e.push(i),i[0]===Et.LocalVideoTrack)){const r=this.localTrackMap.get(Et.LocalVideoLowTrack);r&&e.push([Et.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(Et.LocalAudioTrack);if(t instanceof Bn&&(n==null?void 0:n.track)instanceof mi)return n.track.isActive&&e.push([Et.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return t===o});if(i)if(i[0]===Et.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(Et.LocalVideoLowTrack);r&&e.push([Et.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case Et.LocalAudioTrack:i=Qe.Audio;break;case Et.LocalVideoTrack:i=Ct(n=o._hints).call(n,pn.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Et.LocalVideoLowTrack:i=Qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case Et.LocalAudioTrack:i=Qe.Audio;break;case Et.LocalVideoTrack:i=Ct(n=o._hints).call(n,pn.SCREEN_TRACK)?Qe.Screen:Qe.High;break;case Et.LocalVideoLowTrack:i=Qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[o,c]=r;n.push([t,{kind:o,id:c}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:o}]=n;switch(r){case Vt.VIDEO:return void(i._videoSSRC&&e.push({stream_type:Vt.VIDEO,ssrcId:i._videoSSRC}));case Vt.AUDIO:return void(i._audioSSRC&&e.push({stream_type:Vt.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(Et.LocalVideoTrack),n=this.localTrackMap.get(Et.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new At((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new At((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof Bn){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await un(this,$t.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit($t.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit($t.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Vi(K0(this.dtlsFailedCount,di)),this.emit($t.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Et.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof vn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof vn).length>1)throw new at(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Bn).length>1&&(t.some(e=>e instanceof Bn&&e._bypassWebAudio)||!Ge().webAudioMediaStreamDest))throw new at(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof vn&&this.pendingLocalTracks.some(n=>n instanceof vn))throw new at(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Bn&&this.pendingLocalTracks.some(n=>n instanceof Bn)&&(!Ge().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Bn&&n._bypassWebAudio)))throw new at(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding,i=nC(nC({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():$I(t,i);const o=hn(8,"track-low-"),c=new vn(r,nC(nC({},n&&{scaleResolutionDownBy:MI(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return c.on(rp.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,Ym.LOW_STREAM)}),c._hints.push(pn.LOW_STREAM),t.addListener(jt.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var r;const o=Array.from(Hs(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(h=>h.userId===o.uid&&h.type==="video");qt.firstRemoteVideoDecode(this.store.sessionId,bi.FIRST_VIDEO_DECODE,Cn.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:e,videoheight:n,subscribeElapse:$i.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const o=await this.recvConnection.getRemoteSSRC(r);return o!==void 0&&o!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new at(k.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new at(k.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new at(k.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new at(k.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new at(k.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new at(k.NOT_SUPPORTED)}async preConnect(t){throw new at(k.NOT_SUPPORTED)}getEstablishParams(){throw new at(k.NOT_SUPPORTED)}async reSubscribe(t){throw new at(k.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new at(k.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===Et.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Ym.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Wt(wn.prototype,"p2pConnect",[pj],Object.getOwnPropertyDescriptor(wn.prototype,"p2pConnect"),wn.prototype),Wt(wn.prototype,"unpublish",[fj],Object.getOwnPropertyDescriptor(wn.prototype,"unpublish"),wn.prototype),Wt(wn.prototype,"unpublishLowStream",[mj],Object.getOwnPropertyDescriptor(wn.prototype,"unpublishLowStream"),wn.prototype),Wt(wn.prototype,"subscribe",[Ej],Object.getOwnPropertyDescriptor(wn.prototype,"subscribe"),wn.prototype),Wt(wn.prototype,"mockSubscribe",[_j],Object.getOwnPropertyDescriptor(wn.prototype,"mockSubscribe"),wn.prototype),Wt(wn.prototype,"unsubscribe",[gj],Object.getOwnPropertyDescriptor(wn.prototype,"unsubscribe"),wn.prototype),Wt(wn.prototype,"muteRemote",[Sj],Object.getOwnPropertyDescriptor(wn.prototype,"muteRemote"),wn.prototype),Wt(wn.prototype,"unmuteRemote",[Tj],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteRemote"),wn.prototype),Wt(wn.prototype,"hasRemoteMediaWithLock",[vj],Object.getOwnPropertyDescriptor(wn.prototype,"hasRemoteMediaWithLock"),wn.prototype),Wt(wn.prototype,"disconnectForReconnect",[yj],Object.getOwnPropertyDescriptor(wn.prototype,"disconnectForReconnect"),wn.prototype),Wt(wn.prototype,"remoteMediaSsrcChanged",[Rj],Object.getOwnPropertyDescriptor(wn.prototype,"remoteMediaSsrcChanged"),wn.prototype),wn);function qa(t){return function(e,n,i){const r=e[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];switch(t){case Ya.SEND_ONLY:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{h()}}case Ya.RECEIVE_ONLY:{const h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{h()}}default:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(n)),p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{h(),p()}}}},i}}class bp extends On{constructor(e,n){super(),D(this,"signal",void 0),D(this,"token",void 0),D(this,"tokenTimeout",void 0),D(this,"tokenInterval",void 0),D(this,"_sequence",0),D(this,"userMap",new Map),D(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const i=()=>{this.signal.connectionState===_n.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*j("P2P_TOKEN_INTERVAL"))};i()}async send(e,n,i,r,o){var c,l,h;if(this.userMap.size===0)return;const p=Array.from(hr(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=(l=r)!==null&&l!==void 0?l:hn(6,""),o=(h=o)!==null&&h!==void 0?h:this._sequence++;const m={_id:r,_type:e,_seq:o,_message:n,token:"".concat(this.token,"_").concat(p)};j("SHOW_P2P_LOG")&&b.debug("send message",m,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(m)).forEach(v=>{this.signal.request(ce.DATA_STREAM,{payload:au(this.encoder.encode(v))})});const S=new At((v,y)=>{const P=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),I),this.off("res-@".concat(r),M),this.off(aE.ABORT,O),b.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),this.userMap.size===0?y(new at(k.INVALID_REMOTE_USER)):y(new at(k.TIMEOUT))},j("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),I=()=>{P&&window.clearTimeout(P),this.off(aE.ABORT,O),i&&v()},O=()=>{P&&window.clearTimeout(P),this.off("res-@".concat(r,"_ack"),I),this.off("res-@".concat(r),M),y(new at(k.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(aE.ABORT,O),this.once("res-@".concat(r,"_ack"),I);const M=(W,$)=>{U=!0,P&&window.clearTimeout(P),this.off("res-@".concat(r,"_ack"),I),this.off(aE.ABORT,O),W==="success"?v($):y(new at(k.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let U=!1;i||(this.once("res-@".concat(r),M),Vi(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{U||b.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(m))}))});try{return await S}catch(v){if(v.code===k.TIMEOUT)return await this.send(e,n,i,r,o);throw v}}onMessage(e){var n;const{_uid:i}=e;let r,o=this.userMap.get(i);if(o)r=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==qn.CHECK)return;const{token:p}=e;r=new Map,o={uid:i,isStart:!0,token:p,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,o),this.signal.emit(Ne.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var c;const{id:p,total:m}=e,S=(c=r.get(p))!==null&&c!==void 0?c:[];if(S.push(e),r.has(p)||r.set(p,S),S.length!==m)return;{const v=jg(S).call(S,(y,P)=>y.index-P.index).map(y=>y.payload).join("");r.delete(p),(e=JSON.parse(v))._uid=i}}const{_type:l,token:h}=e;if(Ct(n=[qn.ACK,qn.CHECK]).call(n,l))return l===qn.CHECK&&this.handleCheckToken(o,h),void this.receiveMessage(e);h==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(e):b.debug('Receive unexpected message", '.concat(h,", cur_token: ").concat(o.token,"_").concat(this.token),e)}check(){const e={_id:hn(6,""),token:this.token,_type:qn.CHECK};j("SHOW_P2P_LOG")&&b.debug("send message",e),this.signal.request(ce.DATA_STREAM,{payload:au(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:qn.ACK,token:this.token};j("SHOW_P2P_LOG")&&b.debug("send message",n),this.signal.request(ce.DATA_STREAM,{payload:au(this.encoder.encode(JSON.stringify(n)))})}response(e,n,i){this.send(qn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(p=>{const{receivedMessagesMap:m,nextExpectedSequenceNumber:S}=p;for(;m.has(S);){const v=m.get(S);m.delete(S),this.receiveMessage(v),p.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:i,_seq:r}=e,o=this.userMap.get(i),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:h}=o;if(r<h)return this.ack(e._id),void b.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));c.set(r,e),l&&r===h&&(this.receiveMessage(e),c.delete(h),o.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:i,_message:r,_uid:o}=e;if(j("SHOW_P2P_LOG")&&b.debug("receive message",e),n){let c;switch(e._type!==qn.ACK&&(r&&(c=JSON.parse(r)),this.ack(e._id)),e._type){case qn.CANDIDATE:case qn.CONTROL:this.signal.emit(i,c,o);break;case qn.PUBLISH:case qn.UNPUBLISH:case qn.RESTART_ICE:case qn.CALL:c.uid=o,Wi(this.signal,i,c).then(l=>{this.response(e._id,l)}).catch(()=>{this.response(e._id,void 0,!0)});break;case qn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case qn.RESPONSE:{const{success:l,message:h}=c;this.emit("res-@".concat(n),l?"success":"failed",h);break}}}}splitMessage(e){if(e.length<bp.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:i}=JSON.parse(e),r=hn(6,"");let o=0,c=800;const l=Math.ceil(e.length/c);for(;e.length>0;){o++;const h={id:r,index:o,total:l,payload:e.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(h).length>bp.MAX_MESSAGE_SIZE?c-=50:(n.push(h),e=e.slice(c))}return n.map(h=>JSON.stringify(h))}handleCheckToken(e,n){return e.token!==n?(b.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{b.debug("token timeout, ".concat(n)),this.reset(e.uid)},j("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await Wi(this.signal,qn.CALL,void 0),n=await this.send(qn.CALL,e);this.signal.emit(le.P2P_CONNECTION,n,!0)}async reset(e,n){const i=this.userMap.get(e);i&&(this.emit(aE.ABORT),this.signal.emit(Ne.ON_USER_OFFLINE,{uid:i.uid,reason:eY.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(b.debug("change local token from ".concat(n," to ").concat(n)),this.token=hn(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(aE.ABORT)}}D(bp,"MAX_SIZE",1),D(bp,"MAX_MESSAGE_SIZE",1024);class L7 extends On{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===_n.CONNECTED?this.emit(le.WS_CONNECTED):e===_n.RECONNECTING?this.emit(le.WS_RECONNECTING,this._websocketReconnectReason):e===_n.CLOSED&&this.emit(le.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),D(this,"_disconnectedReason",void 0),D(this,"_websocketReconnectReason",void 0),D(this,"_connectionState",_n.CLOSED),D(this,"reconnectToken",void 0),D(this,"p2pToken",void 0),D(this,"websocket",void 0),D(this,"openConnectionTime",void 0),D(this,"clientId",void 0),D(this,"lastMsgTime",Date.now()),D(this,"uploadCache",[]),D(this,"uploadCacheInterval",void 0),D(this,"rttRolling",new nM(5)),D(this,"pingpongTimer",void 0),D(this,"pingpongTimeoutCount",0),D(this,"joinResponse",void 0),D(this,"multiIpOption",void 0),D(this,"initError",void 0),D(this,"spec",void 0),D(this,"store",void 0),D(this,"_external_signal",void 0),D(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(le.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const o="res-@".concat(r._id);this.emit(o,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case Ne.ON_DATA_STREAM:return void this.handleDataStream(r._message);case Ne.MUTE_AUDIO:case Ne.MUTE_VIDEO:case Ne.ON_P2P_LOST:case Ne.ON_USER_ONLINE:return;case Ne.ON_USER_OFFLINE:const{uid:o}=r._message;return b.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o)),void this._external_signal.reset(o)}if(this.emit(r._type,r._message),r._type===Ne.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Ne.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Xe.UID_BANNED);break;case 15:this.close(Xe.IP_BANNED);break;case 16:this.close(Xe.CHANNEL_BANNED)}if(r._type===Ne.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case ne.ERR_LICENSE_MISSING:this.close(Xe.LICENSE_MISSING);break;case ne.ERR_LICENSE_EXPIRED:this.close(Xe.LICENSE_EXPIRED);break;case ne.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xe.LICENSE_MINUTES_EXCEEDED);break;case ne.ERR_LICENSE_PERIOD_INVALID:this.close(Xe.LICENSE_PERIOD_INVALID);break;case ne.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xe.LICENSE_MULTIPLE_SDK_SERVICE);break;case ne.ERR_LICENSE_ILLEGAL:this.close(Xe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new LI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===_n.CONNECTED&&this.reconnect("retry",Hi.OFFLINE)}),this.p2pToken=hn(6,""),this._external_signal=new bp(this,this.p2pToken)}async request(e,n,i,r){const o=hn(6,""),c={_id:o,_type:e,_message:n},l=this.websocket.connectionID,h=()=>new At((P,I)=>{if(this.connectionState===_n.CONNECTED)return P();const O=()=>{this.off(le.WS_CLOSED,M),P()},M=()=>{this.off(le.WS_CONNECTED,O),I(new at(k.WS_ABORT))};this.once(le.WS_CONNECTED,O),this.once(le.WS_CLOSED,M)});if(this.connectionState!==_n.CONNECTING&&this.connectionState!==_n.RECONNECTING||e===ce.JOIN||e===ce.REJOIN||await h(),this.websocket.sendMessage(c,!0),r)return;const p=new At((P,I)=>{let O=!1;const M=(W,$)=>{O=!0,P({isSuccess:W==="success",message:$||{}}),this.off(le.WS_CLOSED,U),this.off(le.WS_RECONNECTING,U),this.emit(le.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(o),M);const U=()=>{I(new at(k.WS_ABORT,"type: ".concat(e))),this.off(le.WS_CLOSED,U),this.off(le.WS_RECONNECTING,U),this.off("res-@".concat(o),M)};this.once(le.WS_CLOSED,U),this.once(le.WS_RECONNECTING,U),Vi(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(b.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(le.REQUEST_TIMEOUT,e,n))})});let m=null;try{m=await p}catch(P){if(this.connectionState===_n.CLOSED||e===ce.LEAVE)throw new at(k.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?P.throw():e===ce.JOIN||e===ce.REJOIN?null:(await h(),await this.request(e,n))}if(m.isSuccess)return m.message;const S=Number(m.message.error_code||m.message.code),v=uS(S),y=new at(k.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:S,data:m.message,desc:v.desc});return v.action==="success"?m.message:(b.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(S,", message: ").concat(v.desc,", action: ").concat(v.action)),S===ne.ERR_TOO_MANY_BROADCASTERS?((e===ce.JOIN||e===ce.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(S===ne.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,b.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Hi.MULTI_IP)):this.reconnect(v.action,Hi.SERVER_ERROR),e===ce.JOIN||e===ce.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new At(i=>{const r=o=>{(!n||n(o))&&(this.off(e,r),i(o))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void b.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(lS.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const o=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==_n.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(e,n,i){return await this._external_signal.send(e,n,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new At((n,i)=>{this.once(le.WS_CONNECTED,()=>n(this.joinResponse)),this.once(le.WS_CLOSED,()=>i(this.initError||new at(k.WS_ABORT))),this.connectionState=_n.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Xe.LEAVE,this.connectionState=_n.CLOSED,b.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=hn(6,""),this._external_signal.clear(),this._external_signal=new bp(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(le.ABORT_P2P_EXECUTION);const e=await Wi(this,le.REQUEST_JOIN_INFO),n=await this.request(ce.JOIN,e);if(!n)return this.emit(le.REPORT_JOIN_GATEWAY,k.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(le.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=_n.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const i=ep(e.payload),r=new TextDecoder().decode(i),o=JSON.parse(r);"total"in o&&"id"in o||Ct(n=Object.values(qn)).call(n,o._type)?(o._uid=e.uid,this._external_signal.onMessage(o)):this.emit(Ne.ON_DATA_STREAM,e)}catch{this.emit(Ne.ON_DATA_STREAM,e)}}handleNotification(e){b.debug("[".concat(this.clientId,"] receive notification: "),e);const n=uS(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xe.UID_BANNED),void this.close()):void this.reconnect(n.action,Hi.SERVER_ERROR);b.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=j("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(b.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Hi.TIMEOUT):this.request(ce.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),j("REPORT_STATS")&&this.send(ce.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(pe.RECONNECT_CREATE_CONNECTION,e=>{this.emit(le.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(pe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pe.CLOSED,()=>{this.connectionState=_n.CLOSED}),this.websocket.on(pe.FAILED,()=>{this._disconnectedReason=Xe.NETWORK_ERROR,this.connectionState=_n.CLOSED}),this.websocket.on(pe.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===_n.CONNECTED?this.connectionState=_n.RECONNECTING:this.connectionState=_n.CONNECTING}),this.websocket.on(pe.WILL_RECONNECT,(e,n,i)=>{e!=="retry"?(b.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):b.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(pe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(le.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof at&&e.code===k.UNEXPECTED_RESPONSE&&e.data.code===ne.ERR_NO_AUTHORIZED)return b.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Hi.SERVER_ERROR);b.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Hi.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(pe.REQUEST_NEW_URLS,(e,n)=>{Wi(this,le.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const k7={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new P7(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new L7(n,e)}};function Cj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Aj(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Cj(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Cj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class M7{constructor(e){D(this,"sessionDesc",void 0),D(this,"localCapabilities",void 0),D(this,"rtpCapabilities",void 0),D(this,"candidates",void 0),D(this,"_originCandidates",void 0),D(this,"iceParameters",void 0),D(this,"dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname",void 0),e=Vn(e);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:o,setup:c,localCapabilities:l,sdkCodec:h,cname:p}=e,m=rs(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=o,this.candidates=r,this._originCandidates=Vn(r),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=p;for(let S=0;S<m.mediaDescriptions.length;S++){const v=m.mediaDescriptions[S];if(v.attributes.iceUfrag=n.iceUfrag,v.attributes.icePwd=n.icePwd,v.attributes.fingerprints=i.fingerprints,v.attributes.candidates=r,v.attributes.setup=c,v.media.mediaType==="video"){v.media.fmts=o.videoCodecs.map(P=>P.payloadType.toString(10));let y=o.videoCodecs.filter(P=>{var I,O;return(I=P.rtpMap)===null||I===void 0?void 0:Ct(O=I.encodingName.toLowerCase()).call(O,h)});y.length===0&&(y=o.videoCodecs),v.attributes.payloads=y,v.attributes.extmaps=o.videoExtensions}v.media.mediaType==="audio"&&(v.media.fmts=o.audioCodecs.map(y=>y.payloadType.toString(10)),v.attributes.payloads=o.audioCodecs,v.attributes.extmaps=o.audioExtensions),m.mediaDescriptions[S]=this.mungMediaDesc(v)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return cu(this.sessionDesc)}send(e,n,i){const{ssrcs:r,ssrcGroups:o}=up(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(p=>e===Vt.VIDEO?p.media.mediaType==="video":p.media.mediaType==="audio"),l=r[0].attributes.label,h=r[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(r),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(o),{id:l,mslabel:h}}batchSend(e){return e.map(n=>{let{kind:i,ssrcMsg:r}=n;return this.send(i,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],r=[],o=[];n.attributes.ssrcs.forEach(c=>{Ct(e).call(e,c.attributes.label||"")?o.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var l;Ct(l=o.map(h=>h.ssrcId)).call(l,c.ssrcIds[0])||r.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=r})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,i){e.forEach((r,o)=>{const c=r._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===c.kind),h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],r);this.sessionDesc.mediaDescriptions[l]=h})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(n.forEach(r=>{i.push(Aj(Aj({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),n.length!==0){switch(e){case or.TCP_RELAY:this.candidates=i;break;case or.UDP_TCP_RELAY:case or.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=Vn(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(e,n){const i=Vn(e);return uE(i,n),UI(i,n),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,i){const r=this.sessionDesc.mediaDescriptions.find(c=>e===Vt.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(r){const c=r.attributes.ssrcs.find(l=>l.attributes.label===n);var o;c&&(c.attributes.label=i,(o=c.attributes.msid)===null||o===void 0||o.replace(n,i))}}mungMediaDesc(e){const n=Vn(e);return xI(n),function(i){const r=i.attributes.extmaps.find(o=>Tb(o.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var an;function wj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function iC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?wj(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let x7=(an=class KS extends LU{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return Ct(n=Object.keys(XR)).call(n,e)}))]}constructor(e,n){super(e,n),D(this,"store",void 0),D(this,"peerConnection",void 0),D(this,"remoteSDP",void 0),D(this,"initialOffer",void 0),D(this,"statsFilter",void 0),D(this,"useRTX",!1),D(this,"localCapabilities",void 0),D(this,"localCandidateCount",0),D(this,"allCandidatesReceived",!1),D(this,"establishPromise",void 0),D(this,"mutex",void 0),this.store=n,this.mutex=new Qi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(KS.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=Q0(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Un()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=hu(e.sdp),i=fS(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,iC(iC({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new at(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new M7(iC(iC({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new at(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var i=this;return ho(function*(){const r=yield Ue(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=e.map(v=>i.peerConnection.addTrack(v._mediaStreamTrack)),c=yield Ue(i.peerConnection.createOffer()),l=rs(c.sdp),h=e.map(v=>{const y=v._mediaStreamTrack,P=l.mediaDescriptions.find(I=>I.attributes.mid===y.kind);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return function(I,O,M){const U=I.attributes.ssrcs.filter($=>$.attributes.label===O),W=I.attributes.ssrcGroups;if(U.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(W&&U.length>1){const $=W.find(Q=>Q.ssrcIds.indexOf(U[0].ssrcId)!==-1);return $?[{ssrcId:$.ssrcIds[0],rtx:M?$.ssrcIds[1]:void 0}]:[{ssrcId:U[0].ssrcId}]}return[{ssrcId:U[0].ssrcId}]}(P,y.id,i.useRTX)});let p;try{p=yield h}catch(v){throw o.forEach(y=>{Gi()&&y.replaceTrack(null),i.peerConnection.removeTrack(y)}),v}const m=i.mungSendOfferSDP(c.sdp,e);i.remoteSDP.receive(e,n,p);const S=i.remoteSDP.toString();return yield Ue(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Ue(i.applySendEncodings(o,e)),yield Ue(i.peerConnection.setRemoteDescription({type:"answer",sdp:S})),e.map((v,y)=>{const P=v._mediaStreamTrack.id;return{localSSRC:h[y],id:P}})}catch(o){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(o=>{var c;return e.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(o=>{Gi()&&o.replaceTrack(null),this.peerConnection.removeTrack(o)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:o,mslabel:c}=this.remoteSDP.send(e,n,r),l=new At((m,S)=>{const v=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(o)))},1e4),y=P=>{const I=Fe();if((I.name==="Safari"&&Number(I.version)===11||br())&&P.track.id!==o&&P.streams[0].id===c){var O;const M=P.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(e,o,P.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m(M)}if(P.track.id===o)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m(P.track)};this.peerConnection.addEventListener("track",y)}),h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await l,id:o}}catch(o){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return e.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(Gi()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(o=>o.active=!1),i.setParameters(r)}})}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(o=>{var c;return e.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async o=>{if(Gi()&&o.track)o.track.enabled=!0;else{const c=o.getParameters();c.encodings.forEach(l=>l.active=!0),await o.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return ho(function*(){const i=yield Ue(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Ge().supportPCSetConfiguration;if(e===or.RELAY&&!r)return;if(r){const p=n.peerConnection.getConfiguration(),m=e===or.RELAY?"relay":"all";p.iceTransportPolicy!==m&&(b.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(m,"]")),p.iceTransportPolicy=m,n.peerConnection.setConfiguration(p))}e!==or.RELAY&&n.remoteSDP.updateCandidates(e);const o=yield Ue(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=hu(o.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const h=n.remoteSDP.toString();yield Ue(n.peerConnection.setLocalDescription(o)),yield Ue(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(r){b.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new at(k.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getSenders().filter(r=>{var o;return((o=r.track)===null||o===void 0?void 0:o.id)===e});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getSenders().find(r=>{var o;return((o=r.track)===null||o===void 0?void 0:o.id)===n});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new at(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new at(k.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(eS(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...KS.turnServerConfigToIceServers(e.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...KS.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(p=>{var m;return((m=p.track)===null||m===void 0?void 0:m.id)===e._mediaStreamTrack.id})),!n)return b.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!Ge().supportSetRtpSenderParameters)return b.warn("Browser not support set rtp-sender parameters");const r={},o={};if(e instanceof vn)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(j("DSCP_TYPE")&&zl()){var c;const p=j("DSCP_TYPE");Ct(c=["very-low","low","medium","high"]).call(c,p)&&(o.networkPriority=p)}const l=n.getParameters(),h=(i=l.encodings)===null||i===void 0?void 0:i[0];h&&Object.assign(h,o),Object.assign(l,r),b.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(e,n){try{if(!Ge().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],o=n[i];r&&o&&await this.updateRtpSenderEncodings(o,r)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const i=rs(e);return n.forEach((r,o)=>{const c=r._mediaStreamTrack,l=i.mediaDescriptions.find(h=>h.attributes.mid===c.kind);l&&uE(l,r)}),cu(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((o,c)=>{let{id:l,mslabel:h}=o;const{kind:p}=e[c];return new At((m,S)=>{const v=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(l)))},1e4),y=P=>{const I=Fe();if(I.name==="Safari"&&Number(I.version)===11&&P.track.id!==l&&P.streams[0].id===h){var O;const M=P.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(p,l,P.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m({track:M,id:l})}if(P.track.id===l)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m({track:P.track,id:l})};this.peerConnection.addEventListener("track",y)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await At.all(n)}catch(n){throw new at(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(Ge().supportPCSetConfiguration){const n=KS.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Wt(an.prototype,"connect",[To],Object.getOwnPropertyDescriptor(an.prototype,"connect"),an.prototype),Wt(an.prototype,"stopSending",[To],Object.getOwnPropertyDescriptor(an.prototype,"stopSending"),an.prototype),Wt(an.prototype,"receive",[To],Object.getOwnPropertyDescriptor(an.prototype,"receive"),an.prototype),Wt(an.prototype,"stopReceiving",[To],Object.getOwnPropertyDescriptor(an.prototype,"stopReceiving"),an.prototype),Wt(an.prototype,"muteRemote",[To],Object.getOwnPropertyDescriptor(an.prototype,"muteRemote"),an.prototype),Wt(an.prototype,"unmuteRemote",[To],Object.getOwnPropertyDescriptor(an.prototype,"unmuteRemote"),an.prototype),Wt(an.prototype,"muteLocal",[To],Object.getOwnPropertyDescriptor(an.prototype,"muteLocal"),an.prototype),Wt(an.prototype,"unmuteLocal",[To],Object.getOwnPropertyDescriptor(an.prototype,"unmuteLocal"),an.prototype),Wt(an.prototype,"close",[To],Object.getOwnPropertyDescriptor(an.prototype,"close"),an.prototype),Wt(an.prototype,"updateEncoderConfig",[To],Object.getOwnPropertyDescriptor(an.prototype,"updateEncoderConfig"),an.prototype),Wt(an.prototype,"updateSendParameters",[To],Object.getOwnPropertyDescriptor(an.prototype,"updateSendParameters"),an.prototype),Wt(an.prototype,"replaceTrack",[To],Object.getOwnPropertyDescriptor(an.prototype,"replaceTrack"),an.prototype),Wt(an.prototype,"getRemoteSSRC",[To],Object.getOwnPropertyDescriptor(an.prototype,"getRemoteSSRC"),an.prototype),an);function To(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,o=await r.lock("Locking from P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await i.apply(this,l)}finally{o()}},n}const U7={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new x7(n,e)}};Z0(),$e("PROCESS_ID","process-".concat(hn(8,""),"-").concat(hn(4,""),"-").concat(hn(4,""),"-").concat(hn(4,""),"-").concat(hn(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void b.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();b.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(Nn,i)){const{value:r,expires:o}=e[i];if(o&&o<=n)return;Fa[i]=r,Nn[i]=r}})}catch(e){b.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(Fa.AREAS)&&Fa.AREAS.length>0&&GI(Fa.AREAS,!0);const Ij=(t,e,n)=>{b.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),$e(t,e,n)};hp(c7,!1),hp(u7,!1),hp(zY,!1),hp(y7,!1),hp(s7,!1),hp(k7,!1),hp(U7,!1);const ui=function(t){const e=new On,n=t,i={getListeners:e.getListeners.bind(e),on:(r,o)=>(function(c,l){c===Xc.SECURITY_POLICY_VIOLATION&&oB(l,!0)}(r,o),e.on.bind(e)(r,o)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return sB(sB({},n),i)}({__TRACK_LIST__:zm,VERSION:po,BUILD:eI,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Ij,getParameter:j,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(i){let r;return Ge().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(e);if(!n)return t;e.close(),e=null,t=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(e){throw new rt(k.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=qt.reportApiInvoke(null,{name:li.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Mn.TRACER});let e=!1;try{const o=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;e=!!(o&&c&&l),e&&U0()&&D1(75)&&new o().close()}catch(o){return b.error("check system requirement failed: ",o),!1}let n=!1;const i=Fe();i.name===Ye.CHROME&&Number(i.version)>=58&&(Ba.engine.name!=="WebKit"||function(){const o=Fe();if(jR()){if(o.os===Ri.MAC_OS)return!0;if(o.os===Ri.IOS){const c=Ba.os.version&&Ba.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(i.name===Ye.FIREFOX&&Number(i.version)>=56||i.name===Ye.OPERA&&Number(i.version)>=45||i.name===Ye.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(br()||ta())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||U1()||Fe().name===Ye.QQ)&&(n=!0),b.debug("checkSystemRequirements, api:",e,"browser",n);const r=e&&n;return t.onSuccess(r),r},getDevices:function(t){return qs.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return qs.getRecordingDevices(t)},getCameras:function(t){return qs.getCamerasDevices(t)},getElectronScreenSources:OM,getPlaybackDevices:function(t){return qs.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=hn(5,"client-"),i=qt.reportApiInvoke(null,{id:n,name:li.CREATE_CLIENT,options:[e],tag:Mn.TRACER});try{(function(r){Si(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Si(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&Si(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Ui(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&K1(r.turnServer),r.httpRetryConfig!==void 0&&W1(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&W1(r.websocketRetryConfig)})(e)}catch(r){throw i.onError(r),r}return(L1(16,0)||k1(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",b.debug("browser not support vp9, force use vp8")),$e("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new YY(ca(ca({forceWaitGatewayResponse:!0},e),{},{role:Ct(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=j("CAMERA_CAPTURE_CONFIG"),n=hn(8,"track-cam-"),i=qt.reportApiInvoke(null,{id:n,tag:Mn.TRACER,name:li.CREATE_CAM_VIDEO_TRACK,options:[An({},t),e]});e&&(t.encoderConfig=e);const r=eb(t);let o=null;b.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{o=(await Ys({video:r},n)).getVideoTracks()[0]||null}catch(l){throw i.onError(l),l}if(!o){const l=new at(k.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(l),l.throw(b)}t.optimizationMode&&gI(n,o,t,zc(t.encoderConfig));const c=new _I(o,t,r,t.scalabiltyMode?QR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return i.onSuccess(c.getTrackId()),b.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(t){const e=hn(8,"track-cus-"),n=qt.reportApiInvoke(null,{id:e,tag:Mn.TRACER,name:li.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),i=new vn(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?QR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[pn.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),b.info("create custom video track success with config",t,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(v){return BM(v)}(e):void 0;n&&(e="auto");const i=hn(8,"track-scr-v-"),r=qt.reportApiInvoke(null,{id:i,tag:Mn.TRACER,name:li.CREATE_SCREEN_VIDEO_TRACK,options:[An({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const o=function(v){const y={};v.screenSourceType&&(y.mediaSource=v.screenSourceType),v.extensionId&&Kl()&&(y.extensionId=v.extensionId);const{displaySurface:P,selfBrowserSurface:I,surfaceSwitching:O,systemAudio:M,preferCurrentTab:U}=v;(Bm(107)||k0(107)||M0(93))&&(P&&(Si(P,"displaySurface",["browser","window","monitor"]),y.displaySurface=P),I?(Si(I,"selfBrowserSurface",["exclude","include"]),y.selfBrowserSurface=I):y.selfBrowserSurface="include",O&&(Si(O,"surfaceSwitching",["exclude","include"]),y.surfaceSwitching=O)),(Bm(105)||k0(105)||M0(91))&&M&&(Si(M,"systemAudio",["exclude","include"]),y.systemAudio=M),(Bm(94)||k0(94)||M0(80))&&U&&(y.preferCurrentTab=!0),v.electronScreenSourceId&&(y.sourceId=v.electronScreenSourceId);const W=v.encoderConfig?oI(v.encoderConfig):null;return y.mandatory={chromeMediaSource:"desktop",maxWidth:W?W.width:void 0,maxHeight:W?W.height:void 0},W&&(W.frameRate&&(typeof W.frameRate=="number"?(y.mandatory.maxFrameRate=W.frameRate,y.mandatory.minFrameRate=W.frameRate):(y.mandatory.maxFrameRate=W.frameRate.max||W.frameRate.ideal||W.frameRate.exact||void 0,y.mandatory.minFrameRate=W.frameRate.min||W.frameRate.ideal||W.frameRate.exact||void 0),y.frameRate=W.frameRate),W.width&&(y.width=W.width),W.height&&(y.height=W.height)),y}(t);let c=null,l=null;const h=Ge();if(!h.supportShareAudio&&e==="enable"){const v=new at(k.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(v),v.throw(b)}b.info("start create screen video track with config",t,"withAudio",e,"trackId",i);const p=h.supportShareAudio&&e!=="disable";try{const v=await Ys({screen:o,screenAudio:p?n||!0:void 0},i);c=v.getVideoTracks()[0]||null,l=v.getAudioTracks()[0]||null}catch(v){throw r.onError(v),v}if(!c){const v=new at(k.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(v),v.throw(b)}if(!l&&e==="enable"){c&&c.stop();const v=new at(k.SHARE_AUDIO_NOT_ALLOWED);return r.onError(v),v.throw(b)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(gI(i,c,t,t.encoderConfig&&oI(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const m=new vn(c,t.encoderConfig?oI(t.encoderConfig):{},t.scalabiltyMode?QR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[pn.SCREEN_TRACK]);if(!l)return r.onSuccess(m.getTrackId()),b.info("create screen video track success","video:",m.getTrackId()),m;const S=new Bn(l,void 0,hn(8,"track-scr-a-"),!1);return r.onSuccess([m.getTrackId(),S.getTrackId()]),b.info("create screen video track success","video:",m.getTrackId(),"audio:",S.getTrackId()),[m,S]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=j("CAMERA_CAPTURE_CONFIG"),i=hn(8,"track-mic-"),r=hn(8,"track-cam-"),o=qt.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:Mn.TRACER,name:li.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const c=eb(e),l=jM(t);let h=null,p=null;b.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const v=await Ys({audio:l,video:c},"".concat(i,"-").concat(r));h=v.getAudioTracks()[0],p=v.getVideoTracks()[0]}catch(v){throw o.onError(v),v}if(!h||!p){const v=new at(k.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(v),v.throw(b)}e.optimizationMode&&gI(r,p,e,zc(e.encoderConfig));const m=new nb(h,t,l,i),S=new _I(p,e,c,e.scalabiltyMode?QR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return o.onSuccess([m.getTrackId(),S.getTrackId()]),b.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[m,S]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=hn(8,"track-mic-"),n=qt.reportApiInvoke(null,{id:e,tag:Mn.TRACER,name:li.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=jM(t);let r=null;b.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{r=(await Ys({audio:i},e)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!r){const c=new at(k.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(b)}const o=new nb(r,t,i,e);return n.onSuccess(o.getTrackId()),b.info("create microphone audio track success, trackId:",e),o},createCustomAudioTrack:function(t){const e=hn(8,"track-cus-"),n=qt.reportApiInvoke(null,{id:e,tag:Mn.TRACER,name:li.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),i=new Bn(t.mediaStreamTrack,t.encoderConfig?ZR(t.encoderConfig):{},e,!1);return b.info("create custom audio track success with config",t,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:r}=t;const o={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":r,cacheOnlineFile:n,encoderConfig:i},c=hn(8,"track-buf-"),l=qt.reportApiInvoke(null,{id:c,tag:Mn.TRACER,name:li.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(j("DISABLE_WEBAUDIO"))throw new at(k.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");b.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",c);const h=r;if(!(r instanceof AudioBuffer))try{r=await async function(S,v){let y=null;if(typeof S=="string"){const I=Ax.get(S);if(I)return b.debug("use cached audio resource: ",S),I;try{y=(await ja(()=>Br.get(S,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(O){throw new at(k.FETCH_AUDIO_FILE_FAILED,O.toString())}}else y=await new At((O,M)=>{const U=new FileReader;U.onload=W=>{W.target?O(W.target.result):M(new at(k.READ_LOCAL_AUDIO_FILE_ERROR))},U.onerror=()=>{M(new at(k.READ_LOCAL_AUDIO_FILE_ERROR))},U.readAsArrayBuffer(S)});const P=await function(I){const O=Zm();return new At((M,U)=>{O.decodeAudioData(I,W=>{M(W)},W=>{U(new at(k.DECODE_AUDIO_FILE_FAILED,W.toString()))})})}(y);return typeof S=="string"&&v&&Ax.set(S,P),P}(r,n)}catch(S){return l.onError(S),S.throw(b)}const p=new hz(r),m=new uz(h,p,i?ZR(i):{},c);return b.info("create buffer source audio track success, trackId:",c),l.onSuccess(m.getTrackId()),m},setAppType:function(t){if(b.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw b.debug("Invalid appType"),new rt(k.INVALID_PARAMS,"invalid app type",t);$e("APP_TYPE",Math.floor(t))},setLogLevel:function(t){b.setLogLevel(t)},enableLogUpload:function(){j("USE_NEW_LOG")?$e("UPLOAD_LOG",!0):b.enableLogUpload()},disableLogUpload:function(){j("USE_NEW_LOG")?$e("UPLOAD_LOG",!1):b.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new R2},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=qt.reportApiInvoke(null,{tag:Mn.TRACER,name:li.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof Bn||t instanceof eE)){const h=new rt(k.INVALID_TRACK,"the parameter is not a audio track");return n.onError(h),h.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof Bn?t.getTrackLabel():"remote_track",r=t.getVolumeLevel();let o=r,c=r;const l=Date.now();return new At(h=>{const p=setInterval(()=>{const m=t.getVolumeLevel();o=m>o?m:o,c=m<c?m:c;const S=o-c>1e-4,v=Date.now()-l;if(S||v>e){clearInterval(p);const y=S,P={duration:v,deviceLabel:i,maxVolumeLevel:o,result:y};b.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(P))),n.onSuccess(P),h(y)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=qt.reportApiInvoke(null,{tag:Mn.TRACER,name:li.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof vn||t instanceof tE)){const S=new rt(k.INVALID_TRACK,"the parameter is not a video track");return n.onError(S),S.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof vn?t.getTrackLabel():"remote_track",r=t.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(Gi()||jR())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([r]),o.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,h=0;try{const S=Date.now();l=await function(v,y,P,I){let O,M=0,U=null;return new At((W,$)=>{function Q(){M>I&&O&&(O(),W(M));const q=P.getContext("2d");if(!q){const Dt=new rt(k.UNEXPECTED_ERROR,"can not get canvas 2d context.");return b.error(Dt.toString()),void $(Dt)}q.drawImage(v,0,0,160,120);const ct=q.getImageData(0,0,P.width,P.height),_t=Math.floor(ct.data.length/3);if(U){for(let Dt=0;Dt<_t;Dt+=3)if(ct.data[Dt]!==U[Dt])return M+=1,void(U=ct.data);U=ct.data}else U=ct.data}setTimeout(()=>{O&&(O(),W(M))},y),O=uI(()=>{Q()},30)})}(o,e,c,4),h=Date.now()-S}catch(S){throw n.onError(S),S}LY===Ye.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const p=l>4,m={duration:h,changedPicNum:l,deviceLabel:i,result:p};return b.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),n.onSuccess(m),p},setArea:GI,audioElementPlayCenter:jr,resumeAudioContext:function(){jr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){XY.processExternalMediaAEC(t)},registerExtensions:function(t){const e=j("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!Ct(e).call(e,n.name)&&e.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=b.extLog,i.reporter.hookApiInvoke=qt.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=j(r)})}),Ij("PLUGIN_INFO",e)},ChannelMediaRelayError:sE,ChannelMediaRelayEvent:Ql,ChannelMediaRelayState:ss,RemoteStreamFallbackType:rz,RemoteStreamType:iz,ConnectionDisconnectedReason:Xe,AudienceLatencyLevelType:kK,AREAS:We,preload:async function(t,e,n,i){return J2(t,e,n,i)}});return Object.defineProperties(ui,{onAudioAutoplayFailed:{get:()=>Xs.onAudioAutoplayFailed,set:t=>{Xs.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Xs.onAutoplayFailed,set:t=>{Xs.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ui._onSecurityPolicyViolation,set(t){ui._onSecurityPolicyViolation=t,oB(t)}},__CLIENT_LIST__:{get:()=>j("SHOW_GLOBAL_CLIENT_LIST")?lp:[]}}),qs.on(sp.CAMERA_DEVICE_CHANGED,t=>{b.info("camera device changed",JSON.stringify(t)),ui.onCameraChanged&&ui.onCameraChanged(t),ui.safeEmit(Xc.CAMERA_CHANGED,t)}),qs.on(sp.RECORDING_DEVICE_CHANGED,t=>{b.info("microphone device changed",JSON.stringify(t)),ui.onMicrophoneChanged&&ui.onMicrophoneChanged(t),ui.safeEmit(Xc.MICROPHONE_CHANGED,t)}),qs.on(sp.PLAYOUT_DEVICE_CHANGED,t=>{b.debug("playout device changed",JSON.stringify(t)),ui.onPlaybackDeviceChanged&&ui.onPlaybackDeviceChanged(t),ui.safeEmit(Xc.PLAYBACK_DEVICE_CHANGED,t)}),jr.onAutoplayFailed=()=>{b.info("detect audio element autoplay failed"),Xs.onAudioAutoplayFailed&&Xs.onAudioAutoplayFailed()},tn.on("autoplay-failed",()=>{b.info("detect webaudio autoplay failed"),Xs.onAudioAutoplayFailed&&Xs.onAudioAutoplayFailed(),ui.safeEmit(Xc.AUTOPLAY_FAILED)}),tn.on(ji.STATE_CHANGE,(t,e)=>{b.info("audio context state changed: ".concat(e," => ").concat(t)),ui.onAudioContextStateChanged&&ui.onAudioContextStateChanged(t,e),ui.safeEmit(Xc.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),ei.on(Fm.NETWORK_STATE_CHANGE,(t,e)=>{b.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=ui),ui})}(fC)),fC.exports}var X9=q9();const zS=jN(X9);var fN=(d=>(d.AGENT="agent",d.USER="user",d))(fN||{}),S3=(d=>(d.TEXT="text",d.IMAGE="image",d))(S3||{});class J9{constructor(){od(this,"_eventMap",new Map)}once(f,_){const g=(...R)=>{this.off(f,g),_(...R)};return this.on(f,g),this}on(f,_){const g=this._eventMap.get(f)??[];return g.push(_),this._eventMap.set(f,g),this}off(f,_){const g=this._eventMap.get(f);return g&&this._eventMap.set(f,g.filter(R=>R!==_)),this}removeAllEventListeners(){this._eventMap.clear()}emit(f,..._){const g=this._eventMap.get(f)??[];for(const R of g)try{R&&R(..._)}catch(w){const N=w,L=N.stack||N.message;console.error(`[event] handling event ${f.toString()} fail: ${L}`)}return this}}var mN=(d=>(d.CAMERA="camera",d.SCREEN="screen",d))(mN||{});const Q9=window.location.protocol,Z9=window.location.host,$9=window.location.pathname,tX=$9.split("/").filter(Boolean);tX.slice(0,1).join("/");const kC=`${Q9}//${Z9}`;function T3(d,f){return function(){return d.apply(f,arguments)}}const{toString:eX}=Object.prototype,{getPrototypeOf:HN}=Object,MC=(d=>f=>{const _=eX.call(f);return d[_]||(d[_]=_.slice(8,-1).toLowerCase())})(Object.create(null)),ec=d=>(d=d.toLowerCase(),f=>MC(f)===d),xC=d=>f=>typeof f===d,{isArray:UE}=Array,JS=xC("undefined");function nX(d){return d!==null&&!JS(d)&&d.constructor!==null&&!JS(d.constructor)&&Ro(d.constructor.isBuffer)&&d.constructor.isBuffer(d)}const v3=ec("ArrayBuffer");function iX(d){let f;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?f=ArrayBuffer.isView(d):f=d&&d.buffer&&v3(d.buffer),f}const rX=xC("string"),Ro=xC("function"),y3=xC("number"),UC=d=>d!==null&&typeof d=="object",sX=d=>d===!0||d===!1,mC=d=>{if(MC(d)!=="object")return!1;const f=HN(d);return(f===null||f===Object.prototype||Object.getPrototypeOf(f)===null)&&!(Symbol.toStringTag in d)&&!(Symbol.iterator in d)},oX=ec("Date"),aX=ec("File"),cX=ec("Blob"),lX=ec("FileList"),dX=d=>UC(d)&&Ro(d.pipe),uX=d=>{let f;return d&&(typeof FormData=="function"&&d instanceof FormData||Ro(d.append)&&((f=MC(d))==="formdata"||f==="object"&&Ro(d.toString)&&d.toString()==="[object FormData]"))},hX=ec("URLSearchParams"),[pX,fX,mX,EX]=["ReadableStream","Request","Response","Headers"].map(ec),_X=d=>d.trim?d.trim():d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function nT(d,f,{allOwnKeys:_=!1}={}){if(d===null||typeof d>"u")return;let g,R;if(typeof d!="object"&&(d=[d]),UE(d))for(g=0,R=d.length;g<R;g++)f.call(null,d[g],g,d);else{const w=_?Object.getOwnPropertyNames(d):Object.keys(d),N=w.length;let L;for(g=0;g<N;g++)L=w[g],f.call(null,d[L],L,d)}}function R3(d,f){f=f.toLowerCase();const _=Object.keys(d);let g=_.length,R;for(;g-- >0;)if(R=_[g],f===R.toLowerCase())return R;return null}const Np=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,b3=d=>!JS(d)&&d!==Np;function EN(){const{caseless:d}=b3(this)&&this||{},f={},_=(g,R)=>{const w=d&&R3(f,R)||R;mC(f[w])&&mC(g)?f[w]=EN(f[w],g):mC(g)?f[w]=EN({},g):UE(g)?f[w]=g.slice():f[w]=g};for(let g=0,R=arguments.length;g<R;g++)arguments[g]&&nT(arguments[g],_);return f}const gX=(d,f,_,{allOwnKeys:g}={})=>(nT(f,(R,w)=>{_&&Ro(R)?d[w]=T3(R,_):d[w]=R},{allOwnKeys:g}),d),SX=d=>(d.charCodeAt(0)===65279&&(d=d.slice(1)),d),TX=(d,f,_,g)=>{d.prototype=Object.create(f.prototype,g),d.prototype.constructor=d,Object.defineProperty(d,"super",{value:f.prototype}),_&&Object.assign(d.prototype,_)},vX=(d,f,_,g)=>{let R,w,N;const L={};if(f=f||{},d==null)return f;do{for(R=Object.getOwnPropertyNames(d),w=R.length;w-- >0;)N=R[w],(!g||g(N,d,f))&&!L[N]&&(f[N]=d[N],L[N]=!0);d=_!==!1&&HN(d)}while(d&&(!_||_(d,f))&&d!==Object.prototype);return f},yX=(d,f,_)=>{d=String(d),(_===void 0||_>d.length)&&(_=d.length),_-=f.length;const g=d.indexOf(f,_);return g!==-1&&g===_},RX=d=>{if(!d)return null;if(UE(d))return d;let f=d.length;if(!y3(f))return null;const _=new Array(f);for(;f-- >0;)_[f]=d[f];return _},bX=(d=>f=>d&&f instanceof d)(typeof Uint8Array<"u"&&HN(Uint8Array)),CX=(d,f)=>{const g=(d&&d[Symbol.iterator]).call(d);let R;for(;(R=g.next())&&!R.done;){const w=R.value;f.call(d,w[0],w[1])}},AX=(d,f)=>{let _;const g=[];for(;(_=d.exec(f))!==null;)g.push(_);return g},wX=ec("HTMLFormElement"),IX=d=>d.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(_,g,R){return g.toUpperCase()+R}),Yj=(({hasOwnProperty:d})=>(f,_)=>d.call(f,_))(Object.prototype),OX=ec("RegExp"),C3=(d,f)=>{const _=Object.getOwnPropertyDescriptors(d),g={};nT(_,(R,w)=>{let N;(N=f(R,w,d))!==!1&&(g[w]=N||R)}),Object.defineProperties(d,g)},NX=d=>{C3(d,(f,_)=>{if(Ro(d)&&["arguments","caller","callee"].indexOf(_)!==-1)return!1;const g=d[_];if(Ro(g)){if(f.enumerable=!1,"writable"in f){f.writable=!1;return}f.set||(f.set=()=>{throw Error("Can not rewrite read-only method '"+_+"'")})}})},DX=(d,f)=>{const _={},g=R=>{R.forEach(w=>{_[w]=!0})};return UE(d)?g(d):g(String(d).split(f)),_},PX=()=>{},LX=(d,f)=>d!=null&&Number.isFinite(d=+d)?d:f,WO="abcdefghijklmnopqrstuvwxyz",qj="0123456789",A3={DIGIT:qj,ALPHA:WO,ALPHA_DIGIT:WO+WO.toUpperCase()+qj},kX=(d=16,f=A3.ALPHA_DIGIT)=>{let _="";const{length:g}=f;for(;d--;)_+=f[Math.random()*g|0];return _};function MX(d){return!!(d&&Ro(d.append)&&d[Symbol.toStringTag]==="FormData"&&d[Symbol.iterator])}const xX=d=>{const f=new Array(10),_=(g,R)=>{if(UC(g)){if(f.indexOf(g)>=0)return;if(!("toJSON"in g)){f[R]=g;const w=UE(g)?[]:{};return nT(g,(N,L)=>{const V=_(N,R+1);!JS(V)&&(w[L]=V)}),f[R]=void 0,w}}return g};return _(d,0)},UX=ec("AsyncFunction"),VX=d=>d&&(UC(d)||Ro(d))&&Ro(d.then)&&Ro(d.catch),w3=((d,f)=>d?setImmediate:f?((_,g)=>(Np.addEventListener("message",({source:R,data:w})=>{R===Np&&w===_&&g.length&&g.shift()()},!1),R=>{g.push(R),Np.postMessage(_,"*")}))(`axios@${Math.random()}`,[]):_=>setTimeout(_))(typeof setImmediate=="function",Ro(Np.postMessage)),BX=typeof queueMicrotask<"u"?queueMicrotask.bind(Np):typeof process<"u"&&process.nextTick||w3,Ot={isArray:UE,isArrayBuffer:v3,isBuffer:nX,isFormData:uX,isArrayBufferView:iX,isString:rX,isNumber:y3,isBoolean:sX,isObject:UC,isPlainObject:mC,isReadableStream:pX,isRequest:fX,isResponse:mX,isHeaders:EX,isUndefined:JS,isDate:oX,isFile:aX,isBlob:cX,isRegExp:OX,isFunction:Ro,isStream:dX,isURLSearchParams:hX,isTypedArray:bX,isFileList:lX,forEach:nT,merge:EN,extend:gX,trim:_X,stripBOM:SX,inherits:TX,toFlatObject:vX,kindOf:MC,kindOfTest:ec,endsWith:yX,toArray:RX,forEachEntry:CX,matchAll:AX,isHTMLForm:wX,hasOwnProperty:Yj,hasOwnProp:Yj,reduceDescriptors:C3,freezeMethods:NX,toObjectSet:DX,toCamelCase:IX,noop:PX,toFiniteNumber:LX,findKey:R3,global:Np,isContextDefined:b3,ALPHABET:A3,generateString:kX,isSpecCompliantForm:MX,toJSONObject:xX,isAsyncFn:UX,isThenable:VX,setImmediate:w3,asap:BX};function sn(d,f,_,g,R){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=d,this.name="AxiosError",f&&(this.code=f),_&&(this.config=_),g&&(this.request=g),R&&(this.response=R,this.status=R.status?R.status:null)}Ot.inherits(sn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ot.toJSONObject(this.config),code:this.code,status:this.status}}});const I3=sn.prototype,O3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(d=>{O3[d]={value:d}});Object.defineProperties(sn,O3);Object.defineProperty(I3,"isAxiosError",{value:!0});sn.from=(d,f,_,g,R,w)=>{const N=Object.create(I3);return Ot.toFlatObject(d,N,function(V){return V!==Error.prototype},L=>L!=="isAxiosError"),sn.call(N,d.message,f,_,g,R),N.cause=d,N.name=d.name,w&&Object.assign(N,w),N};const jX=null;function _N(d){return Ot.isPlainObject(d)||Ot.isArray(d)}function N3(d){return Ot.endsWith(d,"[]")?d.slice(0,-2):d}function Xj(d,f,_){return d?d.concat(f).map(function(R,w){return R=N3(R),!_&&w?"["+R+"]":R}).join(_?".":""):f}function FX(d){return Ot.isArray(d)&&!d.some(_N)}const GX=Ot.toFlatObject(Ot,{},null,function(f){return/^is[A-Z]/.test(f)});function VC(d,f,_){if(!Ot.isObject(d))throw new TypeError("target must be an object");f=f||new FormData,_=Ot.toFlatObject(_,{metaTokens:!0,dots:!1,indexes:!1},!1,function(X,tt){return!Ot.isUndefined(tt[X])});const g=_.metaTokens,R=_.visitor||G,w=_.dots,N=_.indexes,V=(_.Blob||typeof Blob<"u"&&Blob)&&Ot.isSpecCompliantForm(f);if(!Ot.isFunction(R))throw new TypeError("visitor must be a function");function x(J){if(J===null)return"";if(Ot.isDate(J))return J.toISOString();if(!V&&Ot.isBlob(J))throw new sn("Blob is not supported. Use a Buffer instead.");return Ot.isArrayBuffer(J)||Ot.isTypedArray(J)?V&&typeof Blob=="function"?new Blob([J]):Buffer.from(J):J}function G(J,X,tt){let dt=J;if(J&&!tt&&typeof J=="object"){if(Ot.endsWith(X,"{}"))X=g?X:X.slice(0,-2),J=JSON.stringify(J);else if(Ot.isArray(J)&&FX(J)||(Ot.isFileList(J)||Ot.endsWith(X,"[]"))&&(dt=Ot.toArray(J)))return X=N3(X),dt.forEach(function(ot,bt){!(Ot.isUndefined(ot)||ot===null)&&f.append(N===!0?Xj([X],bt,w):N===null?X:X+"[]",x(ot))}),!1}return _N(J)?!0:(f.append(Xj(tt,X,w),x(J)),!1)}const Y=[],et=Object.assign(GX,{defaultVisitor:G,convertValue:x,isVisitable:_N});function z(J,X){if(!Ot.isUndefined(J)){if(Y.indexOf(J)!==-1)throw Error("Circular reference detected in "+X.join("."));Y.push(J),Ot.forEach(J,function(dt,pt){(!(Ot.isUndefined(dt)||dt===null)&&R.call(f,dt,Ot.isString(pt)?pt.trim():pt,X,et))===!0&&z(dt,X?X.concat(pt):[pt])}),Y.pop()}}if(!Ot.isObject(d))throw new TypeError("data must be an object");return z(d),f}function Jj(d){const f={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(d).replace(/[!'()~]|%20|%00/g,function(g){return f[g]})}function WN(d,f){this._pairs=[],d&&VC(d,this,f)}const D3=WN.prototype;D3.append=function(f,_){this._pairs.push([f,_])};D3.toString=function(f){const _=f?function(g){return f.call(this,g,Jj)}:Jj;return this._pairs.map(function(R){return _(R[0])+"="+_(R[1])},"").join("&")};function HX(d){return encodeURIComponent(d).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function P3(d,f,_){if(!f)return d;const g=_&&_.encode||HX;Ot.isFunction(_)&&(_={serialize:_});const R=_&&_.serialize;let w;if(R?w=R(f,_):w=Ot.isURLSearchParams(f)?f.toString():new WN(f,_).toString(g),w){const N=d.indexOf("#");N!==-1&&(d=d.slice(0,N)),d+=(d.indexOf("?")===-1?"?":"&")+w}return d}class Qj{constructor(){this.handlers=[]}use(f,_,g){return this.handlers.push({fulfilled:f,rejected:_,synchronous:g?g.synchronous:!1,runWhen:g?g.runWhen:null}),this.handlers.length-1}eject(f){this.handlers[f]&&(this.handlers[f]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(f){Ot.forEach(this.handlers,function(g){g!==null&&f(g)})}}const L3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},WX=typeof URLSearchParams<"u"?URLSearchParams:WN,KX=typeof FormData<"u"?FormData:null,zX=typeof Blob<"u"?Blob:null,YX={isBrowser:!0,classes:{URLSearchParams:WX,FormData:KX,Blob:zX},protocols:["http","https","file","blob","url","data"]},KN=typeof window<"u"&&typeof document<"u",gN=typeof navigator=="object"&&navigator||void 0,qX=KN&&(!gN||["ReactNative","NativeScript","NS"].indexOf(gN.product)<0),XX=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",JX=KN&&window.location.href||"http://localhost",QX=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:KN,hasStandardBrowserEnv:qX,hasStandardBrowserWebWorkerEnv:XX,navigator:gN,origin:JX},Symbol.toStringTag,{value:"Module"})),hs={...QX,...YX};function ZX(d,f){return VC(d,new hs.classes.URLSearchParams,Object.assign({visitor:function(_,g,R,w){return hs.isNode&&Ot.isBuffer(_)?(this.append(g,_.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)}},f))}function $X(d){return Ot.matchAll(/\w+|\[(\w*)]/g,d).map(f=>f[0]==="[]"?"":f[1]||f[0])}function tJ(d){const f={},_=Object.keys(d);let g;const R=_.length;let w;for(g=0;g<R;g++)w=_[g],f[w]=d[w];return f}function k3(d){function f(_,g,R,w){let N=_[w++];if(N==="__proto__")return!0;const L=Number.isFinite(+N),V=w>=_.length;return N=!N&&Ot.isArray(R)?R.length:N,V?(Ot.hasOwnProp(R,N)?R[N]=[R[N],g]:R[N]=g,!L):((!R[N]||!Ot.isObject(R[N]))&&(R[N]=[]),f(_,g,R[N],w)&&Ot.isArray(R[N])&&(R[N]=tJ(R[N])),!L)}if(Ot.isFormData(d)&&Ot.isFunction(d.entries)){const _={};return Ot.forEachEntry(d,(g,R)=>{f($X(g),R,_,0)}),_}return null}function eJ(d,f,_){if(Ot.isString(d))try{return(f||JSON.parse)(d),Ot.trim(d)}catch(g){if(g.name!=="SyntaxError")throw g}return(_||JSON.stringify)(d)}const iT={transitional:L3,adapter:["xhr","http","fetch"],transformRequest:[function(f,_){const g=_.getContentType()||"",R=g.indexOf("application/json")>-1,w=Ot.isObject(f);if(w&&Ot.isHTMLForm(f)&&(f=new FormData(f)),Ot.isFormData(f))return R?JSON.stringify(k3(f)):f;if(Ot.isArrayBuffer(f)||Ot.isBuffer(f)||Ot.isStream(f)||Ot.isFile(f)||Ot.isBlob(f)||Ot.isReadableStream(f))return f;if(Ot.isArrayBufferView(f))return f.buffer;if(Ot.isURLSearchParams(f))return _.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),f.toString();let L;if(w){if(g.indexOf("application/x-www-form-urlencoded")>-1)return ZX(f,this.formSerializer).toString();if((L=Ot.isFileList(f))||g.indexOf("multipart/form-data")>-1){const V=this.env&&this.env.FormData;return VC(L?{"files[]":f}:f,V&&new V,this.formSerializer)}}return w||R?(_.setContentType("application/json",!1),eJ(f)):f}],transformResponse:[function(f){const _=this.transitional||iT.transitional,g=_&&_.forcedJSONParsing,R=this.responseType==="json";if(Ot.isResponse(f)||Ot.isReadableStream(f))return f;if(f&&Ot.isString(f)&&(g&&!this.responseType||R)){const N=!(_&&_.silentJSONParsing)&&R;try{return JSON.parse(f)}catch(L){if(N)throw L.name==="SyntaxError"?sn.from(L,sn.ERR_BAD_RESPONSE,this,null,this.response):L}}return f}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:hs.classes.FormData,Blob:hs.classes.Blob},validateStatus:function(f){return f>=200&&f<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ot.forEach(["delete","get","head","post","put","patch"],d=>{iT.headers[d]={}});const nJ=Ot.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),iJ=d=>{const f={};let _,g,R;return d&&d.split(`
`).forEach(function(N){R=N.indexOf(":"),_=N.substring(0,R).trim().toLowerCase(),g=N.substring(R+1).trim(),!(!_||f[_]&&nJ[_])&&(_==="set-cookie"?f[_]?f[_].push(g):f[_]=[g]:f[_]=f[_]?f[_]+", "+g:g)}),f},Zj=Symbol("internals");function HS(d){return d&&String(d).trim().toLowerCase()}function EC(d){return d===!1||d==null?d:Ot.isArray(d)?d.map(EC):String(d)}function rJ(d){const f=Object.create(null),_=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=_.exec(d);)f[g[1]]=g[2];return f}const sJ=d=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(d.trim());function KO(d,f,_,g,R){if(Ot.isFunction(g))return g.call(this,f,_);if(R&&(f=_),!!Ot.isString(f)){if(Ot.isString(g))return f.indexOf(g)!==-1;if(Ot.isRegExp(g))return g.test(f)}}function oJ(d){return d.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(f,_,g)=>_.toUpperCase()+g)}function aJ(d,f){const _=Ot.toCamelCase(" "+f);["get","set","has"].forEach(g=>{Object.defineProperty(d,g+_,{value:function(R,w,N){return this[g].call(this,f,R,w,N)},configurable:!0})})}let $s=class{constructor(f){f&&this.set(f)}set(f,_,g){const R=this;function w(L,V,x){const G=HS(V);if(!G)throw new Error("header name must be a non-empty string");const Y=Ot.findKey(R,G);(!Y||R[Y]===void 0||x===!0||x===void 0&&R[Y]!==!1)&&(R[Y||V]=EC(L))}const N=(L,V)=>Ot.forEach(L,(x,G)=>w(x,G,V));if(Ot.isPlainObject(f)||f instanceof this.constructor)N(f,_);else if(Ot.isString(f)&&(f=f.trim())&&!sJ(f))N(iJ(f),_);else if(Ot.isHeaders(f))for(const[L,V]of f.entries())w(V,L,g);else f!=null&&w(_,f,g);return this}get(f,_){if(f=HS(f),f){const g=Ot.findKey(this,f);if(g){const R=this[g];if(!_)return R;if(_===!0)return rJ(R);if(Ot.isFunction(_))return _.call(this,R,g);if(Ot.isRegExp(_))return _.exec(R);throw new TypeError("parser must be boolean|regexp|function")}}}has(f,_){if(f=HS(f),f){const g=Ot.findKey(this,f);return!!(g&&this[g]!==void 0&&(!_||KO(this,this[g],g,_)))}return!1}delete(f,_){const g=this;let R=!1;function w(N){if(N=HS(N),N){const L=Ot.findKey(g,N);L&&(!_||KO(g,g[L],L,_))&&(delete g[L],R=!0)}}return Ot.isArray(f)?f.forEach(w):w(f),R}clear(f){const _=Object.keys(this);let g=_.length,R=!1;for(;g--;){const w=_[g];(!f||KO(this,this[w],w,f,!0))&&(delete this[w],R=!0)}return R}normalize(f){const _=this,g={};return Ot.forEach(this,(R,w)=>{const N=Ot.findKey(g,w);if(N){_[N]=EC(R),delete _[w];return}const L=f?oJ(w):String(w).trim();L!==w&&delete _[w],_[L]=EC(R),g[L]=!0}),this}concat(...f){return this.constructor.concat(this,...f)}toJSON(f){const _=Object.create(null);return Ot.forEach(this,(g,R)=>{g!=null&&g!==!1&&(_[R]=f&&Ot.isArray(g)?g.join(", "):g)}),_}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([f,_])=>f+": "+_).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(f){return f instanceof this?f:new this(f)}static concat(f,..._){const g=new this(f);return _.forEach(R=>g.set(R)),g}static accessor(f){const g=(this[Zj]=this[Zj]={accessors:{}}).accessors,R=this.prototype;function w(N){const L=HS(N);g[L]||(aJ(R,N),g[L]=!0)}return Ot.isArray(f)?f.forEach(w):w(f),this}};$s.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ot.reduceDescriptors($s.prototype,({value:d},f)=>{let _=f[0].toUpperCase()+f.slice(1);return{get:()=>d,set(g){this[_]=g}}});Ot.freezeMethods($s);function zO(d,f){const _=this||iT,g=f||_,R=$s.from(g.headers);let w=g.data;return Ot.forEach(d,function(L){w=L.call(_,w,R.normalize(),f?f.status:void 0)}),R.normalize(),w}function M3(d){return!!(d&&d.__CANCEL__)}function VE(d,f,_){sn.call(this,d??"canceled",sn.ERR_CANCELED,f,_),this.name="CanceledError"}Ot.inherits(VE,sn,{__CANCEL__:!0});function x3(d,f,_){const g=_.config.validateStatus;!_.status||!g||g(_.status)?d(_):f(new sn("Request failed with status code "+_.status,[sn.ERR_BAD_REQUEST,sn.ERR_BAD_RESPONSE][Math.floor(_.status/100)-4],_.config,_.request,_))}function cJ(d){const f=/^([-+\w]{1,25})(:?\/\/|:)/.exec(d);return f&&f[1]||""}function lJ(d,f){d=d||10;const _=new Array(d),g=new Array(d);let R=0,w=0,N;return f=f!==void 0?f:1e3,function(V){const x=Date.now(),G=g[w];N||(N=x),_[R]=V,g[R]=x;let Y=w,et=0;for(;Y!==R;)et+=_[Y++],Y=Y%d;if(R=(R+1)%d,R===w&&(w=(w+1)%d),x-N<f)return;const z=G&&x-G;return z?Math.round(et*1e3/z):void 0}}function dJ(d,f){let _=0,g=1e3/f,R,w;const N=(x,G=Date.now())=>{_=G,R=null,w&&(clearTimeout(w),w=null),d.apply(null,x)};return[(...x)=>{const G=Date.now(),Y=G-_;Y>=g?N(x,G):(R=x,w||(w=setTimeout(()=>{w=null,N(R)},g-Y)))},()=>R&&N(R)]}const vC=(d,f,_=3)=>{let g=0;const R=lJ(50,250);return dJ(w=>{const N=w.loaded,L=w.lengthComputable?w.total:void 0,V=N-g,x=R(V),G=N<=L;g=N;const Y={loaded:N,total:L,progress:L?N/L:void 0,bytes:V,rate:x||void 0,estimated:x&&L&&G?(L-N)/x:void 0,event:w,lengthComputable:L!=null,[f?"download":"upload"]:!0};d(Y)},_)},$j=(d,f)=>{const _=d!=null;return[g=>f[0]({lengthComputable:_,total:d,loaded:g}),f[1]]},tF=d=>(...f)=>Ot.asap(()=>d(...f)),uJ=hs.hasStandardBrowserEnv?((d,f)=>_=>(_=new URL(_,hs.origin),d.protocol===_.protocol&&d.host===_.host&&(f||d.port===_.port)))(new URL(hs.origin),hs.navigator&&/(msie|trident)/i.test(hs.navigator.userAgent)):()=>!0,hJ=hs.hasStandardBrowserEnv?{write(d,f,_,g,R,w){const N=[d+"="+encodeURIComponent(f)];Ot.isNumber(_)&&N.push("expires="+new Date(_).toGMTString()),Ot.isString(g)&&N.push("path="+g),Ot.isString(R)&&N.push("domain="+R),w===!0&&N.push("secure"),document.cookie=N.join("; ")},read(d){const f=document.cookie.match(new RegExp("(^|;\\s*)("+d+")=([^;]*)"));return f?decodeURIComponent(f[3]):null},remove(d){this.write(d,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function pJ(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)}function fJ(d,f){return f?d.replace(/\/?\/$/,"")+"/"+f.replace(/^\/+/,""):d}function U3(d,f){return d&&!pJ(f)?fJ(d,f):f}const eF=d=>d instanceof $s?{...d}:d;function Pp(d,f){f=f||{};const _={};function g(x,G,Y,et){return Ot.isPlainObject(x)&&Ot.isPlainObject(G)?Ot.merge.call({caseless:et},x,G):Ot.isPlainObject(G)?Ot.merge({},G):Ot.isArray(G)?G.slice():G}function R(x,G,Y,et){if(Ot.isUndefined(G)){if(!Ot.isUndefined(x))return g(void 0,x,Y,et)}else return g(x,G,Y,et)}function w(x,G){if(!Ot.isUndefined(G))return g(void 0,G)}function N(x,G){if(Ot.isUndefined(G)){if(!Ot.isUndefined(x))return g(void 0,x)}else return g(void 0,G)}function L(x,G,Y){if(Y in f)return g(x,G);if(Y in d)return g(void 0,x)}const V={url:w,method:w,data:w,baseURL:N,transformRequest:N,transformResponse:N,paramsSerializer:N,timeout:N,timeoutMessage:N,withCredentials:N,withXSRFToken:N,adapter:N,responseType:N,xsrfCookieName:N,xsrfHeaderName:N,onUploadProgress:N,onDownloadProgress:N,decompress:N,maxContentLength:N,maxBodyLength:N,beforeRedirect:N,transport:N,httpAgent:N,httpsAgent:N,cancelToken:N,socketPath:N,responseEncoding:N,validateStatus:L,headers:(x,G,Y)=>R(eF(x),eF(G),Y,!0)};return Ot.forEach(Object.keys(Object.assign({},d,f)),function(G){const Y=V[G]||R,et=Y(d[G],f[G],G);Ot.isUndefined(et)&&Y!==L||(_[G]=et)}),_}const V3=d=>{const f=Pp({},d);let{data:_,withXSRFToken:g,xsrfHeaderName:R,xsrfCookieName:w,headers:N,auth:L}=f;f.headers=N=$s.from(N),f.url=P3(U3(f.baseURL,f.url),d.params,d.paramsSerializer),L&&N.set("Authorization","Basic "+btoa((L.username||"")+":"+(L.password?unescape(encodeURIComponent(L.password)):"")));let V;if(Ot.isFormData(_)){if(hs.hasStandardBrowserEnv||hs.hasStandardBrowserWebWorkerEnv)N.setContentType(void 0);else if((V=N.getContentType())!==!1){const[x,...G]=V?V.split(";").map(Y=>Y.trim()).filter(Boolean):[];N.setContentType([x||"multipart/form-data",...G].join("; "))}}if(hs.hasStandardBrowserEnv&&(g&&Ot.isFunction(g)&&(g=g(f)),g||g!==!1&&uJ(f.url))){const x=R&&w&&hJ.read(w);x&&N.set(R,x)}return f},mJ=typeof XMLHttpRequest<"u",EJ=mJ&&function(d){return new Promise(function(_,g){const R=V3(d);let w=R.data;const N=$s.from(R.headers).normalize();let{responseType:L,onUploadProgress:V,onDownloadProgress:x}=R,G,Y,et,z,J;function X(){z&&z(),J&&J(),R.cancelToken&&R.cancelToken.unsubscribe(G),R.signal&&R.signal.removeEventListener("abort",G)}let tt=new XMLHttpRequest;tt.open(R.method.toUpperCase(),R.url,!0),tt.timeout=R.timeout;function dt(){if(!tt)return;const ot=$s.from("getAllResponseHeaders"in tt&&tt.getAllResponseHeaders()),St={data:!L||L==="text"||L==="json"?tt.responseText:tt.response,status:tt.status,statusText:tt.statusText,headers:ot,config:d,request:tt};x3(function(Bt){_(Bt),X()},function(Bt){g(Bt),X()},St),tt=null}"onloadend"in tt?tt.onloadend=dt:tt.onreadystatechange=function(){!tt||tt.readyState!==4||tt.status===0&&!(tt.responseURL&&tt.responseURL.indexOf("file:")===0)||setTimeout(dt)},tt.onabort=function(){tt&&(g(new sn("Request aborted",sn.ECONNABORTED,d,tt)),tt=null)},tt.onerror=function(){g(new sn("Network Error",sn.ERR_NETWORK,d,tt)),tt=null},tt.ontimeout=function(){let bt=R.timeout?"timeout of "+R.timeout+"ms exceeded":"timeout exceeded";const St=R.transitional||L3;R.timeoutErrorMessage&&(bt=R.timeoutErrorMessage),g(new sn(bt,St.clarifyTimeoutError?sn.ETIMEDOUT:sn.ECONNABORTED,d,tt)),tt=null},w===void 0&&N.setContentType(null),"setRequestHeader"in tt&&Ot.forEach(N.toJSON(),function(bt,St){tt.setRequestHeader(St,bt)}),Ot.isUndefined(R.withCredentials)||(tt.withCredentials=!!R.withCredentials),L&&L!=="json"&&(tt.responseType=R.responseType),x&&([et,J]=vC(x,!0),tt.addEventListener("progress",et)),V&&tt.upload&&([Y,z]=vC(V),tt.upload.addEventListener("progress",Y),tt.upload.addEventListener("loadend",z)),(R.cancelToken||R.signal)&&(G=ot=>{tt&&(g(!ot||ot.type?new VE(null,d,tt):ot),tt.abort(),tt=null)},R.cancelToken&&R.cancelToken.subscribe(G),R.signal&&(R.signal.aborted?G():R.signal.addEventListener("abort",G)));const pt=cJ(R.url);if(pt&&hs.protocols.indexOf(pt)===-1){g(new sn("Unsupported protocol "+pt+":",sn.ERR_BAD_REQUEST,d));return}tt.send(w||null)})},_J=(d,f)=>{const{length:_}=d=d?d.filter(Boolean):[];if(f||_){let g=new AbortController,R;const w=function(x){if(!R){R=!0,L();const G=x instanceof Error?x:this.reason;g.abort(G instanceof sn?G:new VE(G instanceof Error?G.message:G))}};let N=f&&setTimeout(()=>{N=null,w(new sn(`timeout ${f} of ms exceeded`,sn.ETIMEDOUT))},f);const L=()=>{d&&(N&&clearTimeout(N),N=null,d.forEach(x=>{x.unsubscribe?x.unsubscribe(w):x.removeEventListener("abort",w)}),d=null)};d.forEach(x=>x.addEventListener("abort",w));const{signal:V}=g;return V.unsubscribe=()=>Ot.asap(L),V}},gJ=function*(d,f){let _=d.byteLength;if(_<f){yield d;return}let g=0,R;for(;g<_;)R=g+f,yield d.slice(g,R),g=R},SJ=async function*(d,f){for await(const _ of TJ(d))yield*gJ(_,f)},TJ=async function*(d){if(d[Symbol.asyncIterator]){yield*d;return}const f=d.getReader();try{for(;;){const{done:_,value:g}=await f.read();if(_)break;yield g}}finally{await f.cancel()}},nF=(d,f,_,g)=>{const R=SJ(d,f);let w=0,N,L=V=>{N||(N=!0,g&&g(V))};return new ReadableStream({async pull(V){try{const{done:x,value:G}=await R.next();if(x){L(),V.close();return}let Y=G.byteLength;if(_){let et=w+=Y;_(et)}V.enqueue(new Uint8Array(G))}catch(x){throw L(x),x}},cancel(V){return L(V),R.return()}},{highWaterMark:2})},BC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",B3=BC&&typeof ReadableStream=="function",vJ=BC&&(typeof TextEncoder=="function"?(d=>f=>d.encode(f))(new TextEncoder):async d=>new Uint8Array(await new Response(d).arrayBuffer())),j3=(d,...f)=>{try{return!!d(...f)}catch{return!1}},yJ=B3&&j3(()=>{let d=!1;const f=new Request(hs.origin,{body:new ReadableStream,method:"POST",get duplex(){return d=!0,"half"}}).headers.has("Content-Type");return d&&!f}),iF=64*1024,SN=B3&&j3(()=>Ot.isReadableStream(new Response("").body)),yC={stream:SN&&(d=>d.body)};BC&&(d=>{["text","arrayBuffer","blob","formData","stream"].forEach(f=>{!yC[f]&&(yC[f]=Ot.isFunction(d[f])?_=>_[f]():(_,g)=>{throw new sn(`Response type '${f}' is not supported`,sn.ERR_NOT_SUPPORT,g)})})})(new Response);const RJ=async d=>{if(d==null)return 0;if(Ot.isBlob(d))return d.size;if(Ot.isSpecCompliantForm(d))return(await new Request(hs.origin,{method:"POST",body:d}).arrayBuffer()).byteLength;if(Ot.isArrayBufferView(d)||Ot.isArrayBuffer(d))return d.byteLength;if(Ot.isURLSearchParams(d)&&(d=d+""),Ot.isString(d))return(await vJ(d)).byteLength},bJ=async(d,f)=>{const _=Ot.toFiniteNumber(d.getContentLength());return _??RJ(f)},CJ=BC&&(async d=>{let{url:f,method:_,data:g,signal:R,cancelToken:w,timeout:N,onDownloadProgress:L,onUploadProgress:V,responseType:x,headers:G,withCredentials:Y="same-origin",fetchOptions:et}=V3(d);x=x?(x+"").toLowerCase():"text";let z=_J([R,w&&w.toAbortSignal()],N),J;const X=z&&z.unsubscribe&&(()=>{z.unsubscribe()});let tt;try{if(V&&yJ&&_!=="get"&&_!=="head"&&(tt=await bJ(G,g))!==0){let St=new Request(f,{method:"POST",body:g,duplex:"half"}),Ft;if(Ot.isFormData(g)&&(Ft=St.headers.get("content-type"))&&G.setContentType(Ft),St.body){const[Bt,se]=$j(tt,vC(tF(V)));g=nF(St.body,iF,Bt,se)}}Ot.isString(Y)||(Y=Y?"include":"omit");const dt="credentials"in Request.prototype;J=new Request(f,{...et,signal:z,method:_.toUpperCase(),headers:G.normalize().toJSON(),body:g,duplex:"half",credentials:dt?Y:void 0});let pt=await fetch(J);const ot=SN&&(x==="stream"||x==="response");if(SN&&(L||ot&&X)){const St={};["status","statusText","headers"].forEach(Jt=>{St[Jt]=pt[Jt]});const Ft=Ot.toFiniteNumber(pt.headers.get("content-length")),[Bt,se]=L&&$j(Ft,vC(tF(L),!0))||[];pt=new Response(nF(pt.body,iF,Bt,()=>{se&&se(),X&&X()}),St)}x=x||"text";let bt=await yC[Ot.findKey(yC,x)||"text"](pt,d);return!ot&&X&&X(),await new Promise((St,Ft)=>{x3(St,Ft,{data:bt,headers:$s.from(pt.headers),status:pt.status,statusText:pt.statusText,config:d,request:J})})}catch(dt){throw X&&X(),dt&&dt.name==="TypeError"&&/fetch/i.test(dt.message)?Object.assign(new sn("Network Error",sn.ERR_NETWORK,d,J),{cause:dt.cause||dt}):sn.from(dt,dt&&dt.code,d,J)}}),TN={http:jX,xhr:EJ,fetch:CJ};Ot.forEach(TN,(d,f)=>{if(d){try{Object.defineProperty(d,"name",{value:f})}catch{}Object.defineProperty(d,"adapterName",{value:f})}});const rF=d=>`- ${d}`,AJ=d=>Ot.isFunction(d)||d===null||d===!1,F3={getAdapter:d=>{d=Ot.isArray(d)?d:[d];const{length:f}=d;let _,g;const R={};for(let w=0;w<f;w++){_=d[w];let N;if(g=_,!AJ(_)&&(g=TN[(N=String(_)).toLowerCase()],g===void 0))throw new sn(`Unknown adapter '${N}'`);if(g)break;R[N||"#"+w]=g}if(!g){const w=Object.entries(R).map(([L,V])=>`adapter ${L} `+(V===!1?"is not supported by the environment":"is not available in the build"));let N=f?w.length>1?`since :
`+w.map(rF).join(`
`):" "+rF(w[0]):"as no adapter specified";throw new sn("There is no suitable adapter to dispatch the request "+N,"ERR_NOT_SUPPORT")}return g},adapters:TN};function YO(d){if(d.cancelToken&&d.cancelToken.throwIfRequested(),d.signal&&d.signal.aborted)throw new VE(null,d)}function sF(d){return YO(d),d.headers=$s.from(d.headers),d.data=zO.call(d,d.transformRequest),["post","put","patch"].indexOf(d.method)!==-1&&d.headers.setContentType("application/x-www-form-urlencoded",!1),F3.getAdapter(d.adapter||iT.adapter)(d).then(function(g){return YO(d),g.data=zO.call(d,d.transformResponse,g),g.headers=$s.from(g.headers),g},function(g){return M3(g)||(YO(d),g&&g.response&&(g.response.data=zO.call(d,d.transformResponse,g.response),g.response.headers=$s.from(g.response.headers))),Promise.reject(g)})}const G3="1.7.9",jC={};["object","boolean","number","function","string","symbol"].forEach((d,f)=>{jC[d]=function(g){return typeof g===d||"a"+(f<1?"n ":" ")+d}});const oF={};jC.transitional=function(f,_,g){function R(w,N){return"[Axios v"+G3+"] Transitional option '"+w+"'"+N+(g?". "+g:"")}return(w,N,L)=>{if(f===!1)throw new sn(R(N," has been removed"+(_?" in "+_:"")),sn.ERR_DEPRECATED);return _&&!oF[N]&&(oF[N]=!0,console.warn(R(N," has been deprecated since v"+_+" and will be removed in the near future"))),f?f(w,N,L):!0}};jC.spelling=function(f){return(_,g)=>(console.warn(`${g} is likely a misspelling of ${f}`),!0)};function wJ(d,f,_){if(typeof d!="object")throw new sn("options must be an object",sn.ERR_BAD_OPTION_VALUE);const g=Object.keys(d);let R=g.length;for(;R-- >0;){const w=g[R],N=f[w];if(N){const L=d[w],V=L===void 0||N(L,w,d);if(V!==!0)throw new sn("option "+w+" must be "+V,sn.ERR_BAD_OPTION_VALUE);continue}if(_!==!0)throw new sn("Unknown option "+w,sn.ERR_BAD_OPTION)}}const _C={assertOptions:wJ,validators:jC},ol=_C.validators;let Dp=class{constructor(f){this.defaults=f,this.interceptors={request:new Qj,response:new Qj}}async request(f,_){try{return await this._request(f,_)}catch(g){if(g instanceof Error){let R={};Error.captureStackTrace?Error.captureStackTrace(R):R=new Error;const w=R.stack?R.stack.replace(/^.+\n/,""):"";try{g.stack?w&&!String(g.stack).endsWith(w.replace(/^.+\n.+\n/,""))&&(g.stack+=`
`+w):g.stack=w}catch{}}throw g}}_request(f,_){typeof f=="string"?(_=_||{},_.url=f):_=f||{},_=Pp(this.defaults,_);const{transitional:g,paramsSerializer:R,headers:w}=_;g!==void 0&&_C.assertOptions(g,{silentJSONParsing:ol.transitional(ol.boolean),forcedJSONParsing:ol.transitional(ol.boolean),clarifyTimeoutError:ol.transitional(ol.boolean)},!1),R!=null&&(Ot.isFunction(R)?_.paramsSerializer={serialize:R}:_C.assertOptions(R,{encode:ol.function,serialize:ol.function},!0)),_C.assertOptions(_,{baseUrl:ol.spelling("baseURL"),withXsrfToken:ol.spelling("withXSRFToken")},!0),_.method=(_.method||this.defaults.method||"get").toLowerCase();let N=w&&Ot.merge(w.common,w[_.method]);w&&Ot.forEach(["delete","get","head","post","put","patch","common"],J=>{delete w[J]}),_.headers=$s.concat(N,w);const L=[];let V=!0;this.interceptors.request.forEach(function(X){typeof X.runWhen=="function"&&X.runWhen(_)===!1||(V=V&&X.synchronous,L.unshift(X.fulfilled,X.rejected))});const x=[];this.interceptors.response.forEach(function(X){x.push(X.fulfilled,X.rejected)});let G,Y=0,et;if(!V){const J=[sF.bind(this),void 0];for(J.unshift.apply(J,L),J.push.apply(J,x),et=J.length,G=Promise.resolve(_);Y<et;)G=G.then(J[Y++],J[Y++]);return G}et=L.length;let z=_;for(Y=0;Y<et;){const J=L[Y++],X=L[Y++];try{z=J(z)}catch(tt){X.call(this,tt);break}}try{G=sF.call(this,z)}catch(J){return Promise.reject(J)}for(Y=0,et=x.length;Y<et;)G=G.then(x[Y++],x[Y++]);return G}getUri(f){f=Pp(this.defaults,f);const _=U3(f.baseURL,f.url);return P3(_,f.params,f.paramsSerializer)}};Ot.forEach(["delete","get","head","options"],function(f){Dp.prototype[f]=function(_,g){return this.request(Pp(g||{},{method:f,url:_,data:(g||{}).data}))}});Ot.forEach(["post","put","patch"],function(f){function _(g){return function(w,N,L){return this.request(Pp(L||{},{method:f,headers:g?{"Content-Type":"multipart/form-data"}:{},url:w,data:N}))}}Dp.prototype[f]=_(),Dp.prototype[f+"Form"]=_(!0)});let IJ=class H3{constructor(f){if(typeof f!="function")throw new TypeError("executor must be a function.");let _;this.promise=new Promise(function(w){_=w});const g=this;this.promise.then(R=>{if(!g._listeners)return;let w=g._listeners.length;for(;w-- >0;)g._listeners[w](R);g._listeners=null}),this.promise.then=R=>{let w;const N=new Promise(L=>{g.subscribe(L),w=L}).then(R);return N.cancel=function(){g.unsubscribe(w)},N},f(function(w,N,L){g.reason||(g.reason=new VE(w,N,L),_(g.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(f){if(this.reason){f(this.reason);return}this._listeners?this._listeners.push(f):this._listeners=[f]}unsubscribe(f){if(!this._listeners)return;const _=this._listeners.indexOf(f);_!==-1&&this._listeners.splice(_,1)}toAbortSignal(){const f=new AbortController,_=g=>{f.abort(g)};return this.subscribe(_),f.signal.unsubscribe=()=>this.unsubscribe(_),f.signal}static source(){let f;return{token:new H3(function(R){f=R}),cancel:f}}};function OJ(d){return function(_){return d.apply(null,_)}}function NJ(d){return Ot.isObject(d)&&d.isAxiosError===!0}const vN={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(vN).forEach(([d,f])=>{vN[f]=d});function W3(d){const f=new Dp(d),_=T3(Dp.prototype.request,f);return Ot.extend(_,Dp.prototype,f,{allOwnKeys:!0}),Ot.extend(_,f,null,{allOwnKeys:!0}),_.create=function(R){return W3(Pp(d,R))},_}const Fi=W3(iT);Fi.Axios=Dp;Fi.CanceledError=VE;Fi.CancelToken=IJ;Fi.isCancel=M3;Fi.VERSION=G3;Fi.toFormData=VC;Fi.AxiosError=sn;Fi.Cancel=Fi.CanceledError;Fi.all=function(f){return Promise.all(f)};Fi.spread=OJ;Fi.isAxiosError=NJ;Fi.mergeConfig=Pp;Fi.AxiosHeaders=$s;Fi.formToJSON=d=>k3(Ot.isHTMLForm(d)?new FormData(d):d);Fi.getAdapter=F3.getAdapter;Fi.HttpStatusCode=vN;Fi.default=Fi;const{Axios:zet,AxiosError:aF,CanceledError:Yet,isCancel:qet,CancelToken:Xet,VERSION:Jet,all:Qet,Cancel:Zet,isAxiosError:$et,spread:tnt,toFormData:ent,AxiosHeaders:nnt,HttpStatusCode:int,formToJSON:rnt,getAdapter:snt,mergeConfig:ont}=Fi,DJ=async d=>{const f=`${kC}/convoai-token/${d.channel}/${d.userId}`;return(await Fi.get(f)).data},PJ=async d=>{const f=`${kC}/convoai/convoai-start`;return(await Fi.post(f,d)).data},LJ=async d=>{const f=`${kC}/convoai/convoai-stop`,_={agent_id:d};return(await Fi.post(f,_)).data},kJ=5e3;class MJ extends J9{constructor(){super();od(this,"_joined");od(this,"client");od(this,"localTracks");od(this,"appId",null);od(this,"token",null);od(this,"userId",null);od(this,"messageCache",{});this._joined=!1,this.localTracks={},this.client=zS.createClient({mode:"rtc",codec:"vp8"}),this._listenRtcEvents()}async join({channel:_,userId:g}){var R;if(!this._joined){const w=await DJ({channel:_,userId:g}),{app_id:N,token:L}=w;this.appId=N,this.token=L,this.userId=g,await((R=this.client)==null?void 0:R.join(N,_,L,g)),this._joined=!0}}async createCameraTracks(){try{const _=await zS.createCameraVideoTrack();this.localTracks.videoTrack=_}catch(_){console.error("Failed to create video track",_)}this.emit("localTracksChanged",this.localTracks)}async createMicrophoneAudioTrack(_){try{const g=await zS.createMicrophoneAudioTrack({microphoneId:_.deviceId});this.localTracks.audioTrack=g}catch(g){console.error("Failed to create audio track",g)}this.emit("localTracksChanged",this.localTracks)}async createScreenShareTrack(){try{const _=await zS.createScreenVideoTrack({encoderConfig:{width:1200,height:800,frameRate:5}},"disable");this.localTracks.screenTrack=_}catch(_){console.error("Failed to create screen track",_)}this.emit("localTracksChanged",this.localTracks)}async switchVideoSource(_){var g,R;_===mN.SCREEN?(await this.createScreenShareTrack(),this.localTracks.screenTrack&&(this.client.unpublish(this.localTracks.videoTrack),(g=this.localTracks.videoTrack)==null||g.close(),this.localTracks.videoTrack=void 0,this.client.publish(this.localTracks.screenTrack),this.emit("localTracksChanged",this.localTracks))):_===mN.CAMERA&&(await this.createCameraTracks(),this.localTracks.videoTrack&&(this.client.unpublish(this.localTracks.screenTrack),(R=this.localTracks.screenTrack)==null||R.close(),this.localTracks.screenTrack=void 0,this.client.publish(this.localTracks.videoTrack),this.emit("localTracksChanged",this.localTracks)))}async publish(){const _=[];this.localTracks.videoTrack&&_.push(this.localTracks.videoTrack),this.localTracks.audioTrack&&_.push(this.localTracks.audioTrack),_.length&&await this.client.publish(_)}async destroy(){var _,g,R,w,N;(g=(_=this.localTracks)==null?void 0:_.audioTrack)==null||g.close(),(w=(R=this.localTracks)==null?void 0:R.videoTrack)==null||w.close(),this._joined&&await((N=this.client)==null?void 0:N.leave()),this._resetData()}_listenRtcEvents(){this.client.on("network-quality",_=>{this.emit("networkQuality",_)}),this.client.on("user-published",async(_,g)=>{await this.client.subscribe(_,g),g==="audio"&&this._playAudio(_.audioTrack),this.emit("remoteUserChanged",{userId:_.uid,audioTrack:_.audioTrack,videoTrack:_.videoTrack})}),this.client.on("user-unpublished",async(_,g)=>{await this.client.unsubscribe(_,g),this.emit("remoteUserChanged",{userId:_.uid,audioTrack:_.audioTrack,videoTrack:_.videoTrack})}),this.client.on("stream-message",(_,g)=>{})}handleChunk(_){try{const[g,R,w,N]=_.split("|"),L=parseInt(R,10),V=w==="???"?-1:parseInt(w,10);if(V===-1){console.warn(`Total parts for message ${g} unknown, waiting for further parts.`);return}const x={message_id:g,part_index:L,total_parts:V,content:N};if(this.messageCache[g]||(this.messageCache[g]=[],setTimeout(()=>{var G;((G=this.messageCache[g])==null?void 0:G.length)!==V&&(console.warn(`Incomplete message with ID ${g} discarded`),delete this.messageCache[g])},kJ)),this.messageCache[g].push(x),this.messageCache[g].length===V){const G=this.reconstructMessage(this.messageCache[g]),{stream_id:Y,is_final:et,text:z,text_ts:J,data_type:X}=JSON.parse(atob(G));console.log(`[test] message_id: ${g} stream_id: ${Y}, text: ${z}, data_type: ${X}`);const dt={type:Number(Y)!=Number(this.userId)?fN.AGENT:fN.USER,time:J,text:z,data_type:S3.TEXT,userId:Y,isFinal:et};z.trim().length>0&&this.emit("textChanged",dt),delete this.messageCache[g]}}catch(g){console.error("Error processing chunk:",g)}}reconstructMessage(_){return _.sort((g,R)=>g.part_index-R.part_index),_.map(g=>g.content).join("")}_playAudio(_){_&&!_.isPlaying&&_.play()}_resetData(){this.localTracks={},this._joined=!1}}const wu=new MJ,xJ=d=>{const f=_=>{let w=1-Math.max(-100,Math.min(-10,_))*-1/100;return w=Math.sqrt(w),w};return d.map(_=>_===-1/0?0:f(_))};var qO={exports:{}},XO={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cF;function UJ(){if(cF)return XO;cF=1;var d=LC();function f(V,x){return V===x&&(V!==0||1/V===1/x)||V!==V&&x!==x}var _=typeof Object.is=="function"?Object.is:f,g=d.useSyncExternalStore,R=d.useRef,w=d.useEffect,N=d.useMemo,L=d.useDebugValue;return XO.useSyncExternalStoreWithSelector=function(V,x,G,Y,et){var z=R(null);if(z.current===null){var J={hasValue:!1,value:null};z.current=J}else J=z.current;z=N(function(){function tt(St){if(!dt){if(dt=!0,pt=St,St=Y(St),et!==void 0&&J.hasValue){var Ft=J.value;if(et(Ft,St))return ot=Ft}return ot=St}if(Ft=ot,_(pt,St))return Ft;var Bt=Y(St);return et!==void 0&&et(Ft,Bt)?(pt=St,Ft):(pt=St,ot=Bt)}var dt=!1,pt,ot,bt=G===void 0?null:G;return[function(){return tt(x())},bt===null?void 0:function(){return tt(bt())}]},[x,G,Y,et]);var X=g(V,z[0],z[1]);return w(function(){J.hasValue=!0,J.value=X},[X]),L(X),X},XO}var lF;function VJ(){return lF||(lF=1,qO.exports=UJ()),qO.exports}var BJ=VJ();function jJ(d){d()}function FJ(){let d=null,f=null;return{clear(){d=null,f=null},notify(){jJ(()=>{let _=d;for(;_;)_.callback(),_=_.next})},get(){const _=[];let g=d;for(;g;)_.push(g),g=g.next;return _},subscribe(_){let g=!0;const R=f={callback:_,next:null,prev:f};return R.prev?R.prev.next=R:d=R,function(){!g||d===null||(g=!1,R.next?R.next.prev=R.prev:f=R.prev,R.prev?R.prev.next=R.next:d=R.next)}}}}var dF={notify(){},get:()=>[]};function GJ(d,f){let _,g=dF,R=0,w=!1;function N(X){G();const tt=g.subscribe(X);let dt=!1;return()=>{dt||(dt=!0,tt(),Y())}}function L(){g.notify()}function V(){J.onStateChange&&J.onStateChange()}function x(){return w}function G(){R++,_||(_=d.subscribe(V),g=FJ())}function Y(){R--,_&&R===0&&(_(),_=void 0,g.clear(),g=dF)}function et(){w||(w=!0,G())}function z(){w&&(w=!1,Y())}const J={addNestedSub:N,notifyNestedSubs:L,handleChangeWrapper:V,isSubscribed:x,trySubscribe:et,tryUnsubscribe:z,getListeners:()=>g};return J}var HJ=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",WJ=HJ(),KJ=()=>typeof navigator<"u"&&navigator.product==="ReactNative",zJ=KJ(),YJ=()=>WJ||zJ?Z.useLayoutEffect:Z.useEffect,qJ=YJ(),JO=Symbol.for("react-redux-context"),QO=typeof globalThis<"u"?globalThis:{};function XJ(){if(!Z.createContext)return{};const d=QO[JO]??(QO[JO]=new Map);let f=d.get(Z.createContext);return f||(f=Z.createContext(null),d.set(Z.createContext,f)),f}var Nu=XJ();function JJ(d){const{children:f,context:_,serverState:g,store:R}=d,w=Z.useMemo(()=>{const V=GJ(R);return{store:R,subscription:V,getServerState:g?()=>g:void 0}},[R,g]),N=Z.useMemo(()=>R.getState(),[R]);qJ(()=>{const{subscription:V}=w;return V.onStateChange=V.notifyNestedSubs,V.trySubscribe(),N!==R.getState()&&V.notifyNestedSubs(),()=>{V.tryUnsubscribe(),V.onStateChange=void 0}},[w,N]);const L=_||Nu;return Z.createElement(L.Provider,{value:w},f)}var QJ=JJ;function zN(d=Nu){return function(){return Z.useContext(d)}}var K3=zN();function z3(d=Nu){const f=d===Nu?K3:zN(d),_=()=>{const{store:g}=f();return g};return Object.assign(_,{withTypes:()=>_}),_}var Y3=z3();function ZJ(d=Nu){const f=d===Nu?Y3:z3(d),_=()=>f().dispatch;return Object.assign(_,{withTypes:()=>_}),_}var $J=ZJ(),tQ=(d,f)=>d===f;function eQ(d=Nu){const f=d===Nu?K3:zN(d),_=(g,R={})=>{const{equalityFn:w=tQ}=typeof R=="function"?{equalityFn:R}:R,N=f(),{store:L,subscription:V,getServerState:x}=N;Z.useRef(!0);const G=Z.useCallback({[g.name](et){return g(et)}}[g.name],[g]),Y=BJ.useSyncExternalStoreWithSelector(V.addNestedSub,L.getState,x||L.getState,G,w);return Z.useDebugValue(Y),Y};return Object.assign(_,{withTypes:()=>_}),_}var nQ=eQ();const q3=$J.withTypes(),yN=nQ.withTypes();Y3.withTypes();const X3=(d,f=5,_=100,g=600)=>{const[R,w]=Z.useState([]);return Z.useEffect(()=>{if(!d)return w(new Array(f).fill(new Float32Array(0)));const N=new AudioContext,L=d instanceof MediaStreamTrack?d:d.getMediaStreamTrack(),V=new MediaStream([L]),x=N.createMediaStreamSource(V),G=N.createAnalyser();G.fftSize=2048,x.connect(G);const Y=G.frequencyBinCount,et=new Float32Array(Y),J=setInterval(()=>{G.getFloatFrequencyData(et);let X=new Float32Array(et.length);for(let ot=0;ot<et.length;ot++)X[ot]=et[ot];X=X.slice(_,g);const tt=xJ(X),dt=Math.ceil(tt.length/f),pt=[];for(let ot=0;ot<f;ot++)pt.push(tt.slice(ot*dt,(ot+1)*dt));w(pt)},10);return()=>{x.disconnect(),clearInterval(J)}},[d,_,g,f]),R};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iQ=d=>d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),J3=(...d)=>d.filter((f,_,g)=>!!f&&f.trim()!==""&&g.indexOf(f)===_).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var rQ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sQ=Z.forwardRef(({color:d="currentColor",size:f=24,strokeWidth:_=2,absoluteStrokeWidth:g,className:R="",children:w,iconNode:N,...L},V)=>Z.createElement("svg",{ref:V,...rQ,width:f,height:f,stroke:d,strokeWidth:g?Number(_)*24/Number(f):_,className:J3("lucide",R),...L},[...N.map(([x,G])=>Z.createElement(x,G)),...Array.isArray(w)?w:[w]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BE=(d,f)=>{const _=Z.forwardRef(({className:g,...R},w)=>Z.createElement(sQ,{ref:w,iconNode:f,className:J3(`lucide-${iQ(d)}`,g),...R}));return _.displayName=`${d}`,_};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oQ=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],aQ=BE("Check",oQ);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cQ=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Q3=BE("ChevronDown",cQ);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lQ=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],dQ=BE("ChevronUp",lQ);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uQ=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],hQ=BE("LoaderCircle",uQ);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pQ=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],fQ=BE("MicOff",pQ);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mQ=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],EQ=BE("Mic",mQ);function Kr(d){return`Minified Redux error #${d}; visit https://redux.js.org/Errors?code=${d} for the full message or use the non-minified dev environment for full errors. `}var _Q=typeof Symbol=="function"&&Symbol.observable||"@@observable",uF=_Q,ZO=()=>Math.random().toString(36).substring(7).split("").join("."),gQ={INIT:`@@redux/INIT${ZO()}`,REPLACE:`@@redux/REPLACE${ZO()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${ZO()}`},RC=gQ;function YN(d){if(typeof d!="object"||d===null)return!1;let f=d;for(;Object.getPrototypeOf(f)!==null;)f=Object.getPrototypeOf(f);return Object.getPrototypeOf(d)===f||Object.getPrototypeOf(d)===null}function Z3(d,f,_){if(typeof d!="function")throw new Error(Kr(2));if(typeof f=="function"&&typeof _=="function"||typeof _=="function"&&typeof arguments[3]=="function")throw new Error(Kr(0));if(typeof f=="function"&&typeof _>"u"&&(_=f,f=void 0),typeof _<"u"){if(typeof _!="function")throw new Error(Kr(1));return _(Z3)(d,f)}let g=d,R=f,w=new Map,N=w,L=0,V=!1;function x(){N===w&&(N=new Map,w.forEach((tt,dt)=>{N.set(dt,tt)}))}function G(){if(V)throw new Error(Kr(3));return R}function Y(tt){if(typeof tt!="function")throw new Error(Kr(4));if(V)throw new Error(Kr(5));let dt=!0;x();const pt=L++;return N.set(pt,tt),function(){if(dt){if(V)throw new Error(Kr(6));dt=!1,x(),N.delete(pt),w=null}}}function et(tt){if(!YN(tt))throw new Error(Kr(7));if(typeof tt.type>"u")throw new Error(Kr(8));if(typeof tt.type!="string")throw new Error(Kr(17));if(V)throw new Error(Kr(9));try{V=!0,R=g(R,tt)}finally{V=!1}return(w=N).forEach(pt=>{pt()}),tt}function z(tt){if(typeof tt!="function")throw new Error(Kr(10));g=tt,et({type:RC.REPLACE})}function J(){const tt=Y;return{subscribe(dt){if(typeof dt!="object"||dt===null)throw new Error(Kr(11));function pt(){const bt=dt;bt.next&&bt.next(G())}return pt(),{unsubscribe:tt(pt)}},[uF](){return this}}}return et({type:RC.INIT}),{dispatch:et,subscribe:Y,getState:G,replaceReducer:z,[uF]:J}}function SQ(d){Object.keys(d).forEach(f=>{const _=d[f];if(typeof _(void 0,{type:RC.INIT})>"u")throw new Error(Kr(12));if(typeof _(void 0,{type:RC.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Kr(13))})}function TQ(d){const f=Object.keys(d),_={};for(let w=0;w<f.length;w++){const N=f[w];typeof d[N]=="function"&&(_[N]=d[N])}const g=Object.keys(_);let R;try{SQ(_)}catch(w){R=w}return function(N={},L){if(R)throw R;let V=!1;const x={};for(let G=0;G<g.length;G++){const Y=g[G],et=_[Y],z=N[Y],J=et(z,L);if(typeof J>"u")throw L&&L.type,new Error(Kr(14));x[Y]=J,V=V||J!==z}return V=V||g.length!==Object.keys(N).length,V?x:N}}function bC(...d){return d.length===0?f=>f:d.length===1?d[0]:d.reduce((f,_)=>(...g)=>f(_(...g)))}function vQ(...d){return f=>(_,g)=>{const R=f(_,g);let w=()=>{throw new Error(Kr(15))};const N={getState:R.getState,dispatch:(V,...x)=>w(V,...x)},L=d.map(V=>V(N));return w=bC(...L)(R.dispatch),{...R,dispatch:w}}}function yQ(d){return YN(d)&&"type"in d&&typeof d.type=="string"}var $3=Symbol.for("immer-nothing"),hF=Symbol.for("immer-draftable"),Co=Symbol.for("immer-state");function Za(d,...f){throw new Error(`[Immer] minified error nr: ${d}. Full error at: https://bit.ly/3cXEKWf`)}var LE=Object.getPrototypeOf;function Lp(d){return!!d&&!!d[Co]}function cd(d){var f;return d?t5(d)||Array.isArray(d)||!!d[hF]||!!((f=d.constructor)!=null&&f[hF])||GC(d)||HC(d):!1}var RQ=Object.prototype.constructor.toString();function t5(d){if(!d||typeof d!="object")return!1;const f=LE(d);if(f===null)return!0;const _=Object.hasOwnProperty.call(f,"constructor")&&f.constructor;return _===Object?!0:typeof _=="function"&&Function.toString.call(_)===RQ}function CC(d,f){FC(d)===0?Reflect.ownKeys(d).forEach(_=>{f(_,d[_],d)}):d.forEach((_,g)=>f(g,_,d))}function FC(d){const f=d[Co];return f?f.type_:Array.isArray(d)?1:GC(d)?2:HC(d)?3:0}function RN(d,f){return FC(d)===2?d.has(f):Object.prototype.hasOwnProperty.call(d,f)}function e5(d,f,_){const g=FC(d);g===2?d.set(f,_):g===3?d.add(_):d[f]=_}function bQ(d,f){return d===f?d!==0||1/d===1/f:d!==d&&f!==f}function GC(d){return d instanceof Map}function HC(d){return d instanceof Set}function Op(d){return d.copy_||d.base_}function bN(d,f){if(GC(d))return new Map(d);if(HC(d))return new Set(d);if(Array.isArray(d))return Array.prototype.slice.call(d);const _=t5(d);if(f===!0||f==="class_only"&&!_){const g=Object.getOwnPropertyDescriptors(d);delete g[Co];let R=Reflect.ownKeys(g);for(let w=0;w<R.length;w++){const N=R[w],L=g[N];L.writable===!1&&(L.writable=!0,L.configurable=!0),(L.get||L.set)&&(g[N]={configurable:!0,writable:!0,enumerable:L.enumerable,value:d[N]})}return Object.create(LE(d),g)}else{const g=LE(d);if(g!==null&&_)return{...d};const R=Object.create(g);return Object.assign(R,d)}}function qN(d,f=!1){return WC(d)||Lp(d)||!cd(d)||(FC(d)>1&&(d.set=d.add=d.clear=d.delete=CQ),Object.freeze(d),f&&Object.entries(d).forEach(([_,g])=>qN(g,!0))),d}function CQ(){Za(2)}function WC(d){return Object.isFrozen(d)}var AQ={};function kp(d){const f=AQ[d];return f||Za(0,d),f}var QS;function n5(){return QS}function wQ(d,f){return{drafts_:[],parent_:d,immer_:f,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function pF(d,f){f&&(kp("Patches"),d.patches_=[],d.inversePatches_=[],d.patchListener_=f)}function CN(d){AN(d),d.drafts_.forEach(IQ),d.drafts_=null}function AN(d){d===QS&&(QS=d.parent_)}function fF(d){return QS=wQ(QS,d)}function IQ(d){const f=d[Co];f.type_===0||f.type_===1?f.revoke_():f.revoked_=!0}function mF(d,f){f.unfinalizedDrafts_=f.drafts_.length;const _=f.drafts_[0];return d!==void 0&&d!==_?(_[Co].modified_&&(CN(f),Za(4)),cd(d)&&(d=AC(f,d),f.parent_||wC(f,d)),f.patches_&&kp("Patches").generateReplacementPatches_(_[Co].base_,d,f.patches_,f.inversePatches_)):d=AC(f,_,[]),CN(f),f.patches_&&f.patchListener_(f.patches_,f.inversePatches_),d!==$3?d:void 0}function AC(d,f,_){if(WC(f))return f;const g=f[Co];if(!g)return CC(f,(R,w)=>EF(d,g,f,R,w,_)),f;if(g.scope_!==d)return f;if(!g.modified_)return wC(d,g.base_,!0),g.base_;if(!g.finalized_){g.finalized_=!0,g.scope_.unfinalizedDrafts_--;const R=g.copy_;let w=R,N=!1;g.type_===3&&(w=new Set(R),R.clear(),N=!0),CC(w,(L,V)=>EF(d,g,R,L,V,_,N)),wC(d,R,!1),_&&d.patches_&&kp("Patches").generatePatches_(g,_,d.patches_,d.inversePatches_)}return g.copy_}function EF(d,f,_,g,R,w,N){if(Lp(R)){const L=w&&f&&f.type_!==3&&!RN(f.assigned_,g)?w.concat(g):void 0,V=AC(d,R,L);if(e5(_,g,V),Lp(V))d.canAutoFreeze_=!1;else return}else N&&_.add(R);if(cd(R)&&!WC(R)){if(!d.immer_.autoFreeze_&&d.unfinalizedDrafts_<1)return;AC(d,R),(!f||!f.scope_.parent_)&&typeof g!="symbol"&&Object.prototype.propertyIsEnumerable.call(_,g)&&wC(d,R)}}function wC(d,f,_=!1){!d.parent_&&d.immer_.autoFreeze_&&d.canAutoFreeze_&&qN(f,_)}function OQ(d,f){const _=Array.isArray(d),g={type_:_?1:0,scope_:f?f.scope_:n5(),modified_:!1,finalized_:!1,assigned_:{},parent_:f,base_:d,draft_:null,copy_:null,revoke_:null,isManual_:!1};let R=g,w=XN;_&&(R=[g],w=ZS);const{revoke:N,proxy:L}=Proxy.revocable(R,w);return g.draft_=L,g.revoke_=N,L}var XN={get(d,f){if(f===Co)return d;const _=Op(d);if(!RN(_,f))return NQ(d,_,f);const g=_[f];return d.finalized_||!cd(g)?g:g===$O(d.base_,f)?(tN(d),d.copy_[f]=IN(g,d)):g},has(d,f){return f in Op(d)},ownKeys(d){return Reflect.ownKeys(Op(d))},set(d,f,_){const g=i5(Op(d),f);if(g!=null&&g.set)return g.set.call(d.draft_,_),!0;if(!d.modified_){const R=$O(Op(d),f),w=R==null?void 0:R[Co];if(w&&w.base_===_)return d.copy_[f]=_,d.assigned_[f]=!1,!0;if(bQ(_,R)&&(_!==void 0||RN(d.base_,f)))return!0;tN(d),wN(d)}return d.copy_[f]===_&&(_!==void 0||f in d.copy_)||Number.isNaN(_)&&Number.isNaN(d.copy_[f])||(d.copy_[f]=_,d.assigned_[f]=!0),!0},deleteProperty(d,f){return $O(d.base_,f)!==void 0||f in d.base_?(d.assigned_[f]=!1,tN(d),wN(d)):delete d.assigned_[f],d.copy_&&delete d.copy_[f],!0},getOwnPropertyDescriptor(d,f){const _=Op(d),g=Reflect.getOwnPropertyDescriptor(_,f);return g&&{writable:!0,configurable:d.type_!==1||f!=="length",enumerable:g.enumerable,value:_[f]}},defineProperty(){Za(11)},getPrototypeOf(d){return LE(d.base_)},setPrototypeOf(){Za(12)}},ZS={};CC(XN,(d,f)=>{ZS[d]=function(){return arguments[0]=arguments[0][0],f.apply(this,arguments)}});ZS.deleteProperty=function(d,f){return ZS.set.call(this,d,f,void 0)};ZS.set=function(d,f,_){return XN.set.call(this,d[0],f,_,d[0])};function $O(d,f){const _=d[Co];return(_?Op(_):d)[f]}function NQ(d,f,_){var R;const g=i5(f,_);return g?"value"in g?g.value:(R=g.get)==null?void 0:R.call(d.draft_):void 0}function i5(d,f){if(!(f in d))return;let _=LE(d);for(;_;){const g=Object.getOwnPropertyDescriptor(_,f);if(g)return g;_=LE(_)}}function wN(d){d.modified_||(d.modified_=!0,d.parent_&&wN(d.parent_))}function tN(d){d.copy_||(d.copy_=bN(d.base_,d.scope_.immer_.useStrictShallowCopy_))}var DQ=class{constructor(d){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(f,_,g)=>{if(typeof f=="function"&&typeof _!="function"){const w=_;_=f;const N=this;return function(V=w,...x){return N.produce(V,G=>_.call(this,G,...x))}}typeof _!="function"&&Za(6),g!==void 0&&typeof g!="function"&&Za(7);let R;if(cd(f)){const w=fF(this),N=IN(f,void 0);let L=!0;try{R=_(N),L=!1}finally{L?CN(w):AN(w)}return pF(w,g),mF(R,w)}else if(!f||typeof f!="object"){if(R=_(f),R===void 0&&(R=f),R===$3&&(R=void 0),this.autoFreeze_&&qN(R,!0),g){const w=[],N=[];kp("Patches").generateReplacementPatches_(f,R,w,N),g(w,N)}return R}else Za(1,f)},this.produceWithPatches=(f,_)=>{if(typeof f=="function")return(N,...L)=>this.produceWithPatches(N,V=>f(V,...L));let g,R;return[this.produce(f,_,(N,L)=>{g=N,R=L}),g,R]},typeof(d==null?void 0:d.autoFreeze)=="boolean"&&this.setAutoFreeze(d.autoFreeze),typeof(d==null?void 0:d.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(d.useStrictShallowCopy)}createDraft(d){cd(d)||Za(8),Lp(d)&&(d=PQ(d));const f=fF(this),_=IN(d,void 0);return _[Co].isManual_=!0,AN(f),_}finishDraft(d,f){const _=d&&d[Co];(!_||!_.isManual_)&&Za(9);const{scope_:g}=_;return pF(g,f),mF(void 0,g)}setAutoFreeze(d){this.autoFreeze_=d}setUseStrictShallowCopy(d){this.useStrictShallowCopy_=d}applyPatches(d,f){let _;for(_=f.length-1;_>=0;_--){const R=f[_];if(R.path.length===0&&R.op==="replace"){d=R.value;break}}_>-1&&(f=f.slice(_+1));const g=kp("Patches").applyPatches_;return Lp(d)?g(d,f):this.produce(d,R=>g(R,f))}};function IN(d,f){const _=GC(d)?kp("MapSet").proxyMap_(d,f):HC(d)?kp("MapSet").proxySet_(d,f):OQ(d,f);return(f?f.scope_:n5()).drafts_.push(_),_}function PQ(d){return Lp(d)||Za(10,d),r5(d)}function r5(d){if(!cd(d)||WC(d))return d;const f=d[Co];let _;if(f){if(!f.modified_)return f.base_;f.finalized_=!0,_=bN(d,f.scope_.immer_.useStrictShallowCopy_)}else _=bN(d,!0);return CC(_,(g,R)=>{e5(_,g,r5(R))}),f&&(f.finalized_=!1),_}var Ao=new DQ,s5=Ao.produce;Ao.produceWithPatches.bind(Ao);Ao.setAutoFreeze.bind(Ao);Ao.setUseStrictShallowCopy.bind(Ao);Ao.applyPatches.bind(Ao);Ao.createDraft.bind(Ao);Ao.finishDraft.bind(Ao);function o5(d){return({dispatch:_,getState:g})=>R=>w=>typeof w=="function"?w(_,g,d):R(w)}var LQ=o5(),kQ=o5,MQ=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?bC:bC.apply(null,arguments)};function _F(d,f){function _(...g){if(f){let R=f(...g);if(!R)throw new Error(ad(0));return{type:d,payload:R.payload,..."meta"in R&&{meta:R.meta},..."error"in R&&{error:R.error}}}return{type:d,payload:g[0]}}return _.toString=()=>`${d}`,_.type=d,_.match=g=>yQ(g)&&g.type===d,_}var a5=class YS extends Array{constructor(...f){super(...f),Object.setPrototypeOf(this,YS.prototype)}static get[Symbol.species](){return YS}concat(...f){return super.concat.apply(this,f)}prepend(...f){return f.length===1&&Array.isArray(f[0])?new YS(...f[0].concat(this)):new YS(...f.concat(this))}};function gF(d){return cd(d)?s5(d,()=>{}):d}function SF(d,f,_){return d.has(f)?d.get(f):d.set(f,_(f)).get(f)}function xQ(d){return typeof d=="boolean"}var UQ=()=>function(f){const{thunk:_=!0,immutableCheck:g=!0,serializableCheck:R=!0,actionCreatorCheck:w=!0}=f??{};let N=new a5;return _&&(xQ(_)?N.push(LQ):N.push(kQ(_.extraArgument))),N},VQ="RTK_autoBatch",TF=d=>f=>{setTimeout(f,d)},BQ=(d={type:"raf"})=>f=>(..._)=>{const g=f(..._);let R=!0,w=!1,N=!1;const L=new Set,V=d.type==="tick"?queueMicrotask:d.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:TF(10):d.type==="callback"?d.queueNotification:TF(d.timeout),x=()=>{N=!1,w&&(w=!1,L.forEach(G=>G()))};return Object.assign({},g,{subscribe(G){const Y=()=>R&&G(),et=g.subscribe(Y);return L.add(G),()=>{et(),L.delete(G)}},dispatch(G){var Y;try{return R=!((Y=G==null?void 0:G.meta)!=null&&Y[VQ]),w=!R,w&&(N||(N=!0,V(x))),g.dispatch(G)}finally{R=!0}}})},jQ=d=>function(_){const{autoBatch:g=!0}=_??{};let R=new a5(d);return g&&R.push(BQ(typeof g=="object"?g:void 0)),R};function FQ(d){const f=UQ(),{reducer:_=void 0,middleware:g,devTools:R=!0,preloadedState:w=void 0,enhancers:N=void 0}=d||{};let L;if(typeof _=="function")L=_;else if(YN(_))L=TQ(_);else throw new Error(ad(1));let V;typeof g=="function"?V=g(f):V=f();let x=bC;R&&(x=MQ({trace:!1,...typeof R=="object"&&R}));const G=vQ(...V),Y=jQ(G);let et=typeof N=="function"?N(Y):Y();const z=x(...et);return Z3(L,w,z)}function c5(d){const f={},_=[];let g;const R={addCase(w,N){const L=typeof w=="string"?w:w.type;if(!L)throw new Error(ad(28));if(L in f)throw new Error(ad(29));return f[L]=N,R},addMatcher(w,N){return _.push({matcher:w,reducer:N}),R},addDefaultCase(w){return g=w,R}};return d(R),[f,_,g]}function GQ(d){return typeof d=="function"}function HQ(d,f){let[_,g,R]=c5(f),w;if(GQ(d))w=()=>gF(d());else{const L=gF(d);w=()=>L}function N(L=w(),V){let x=[_[V.type],...g.filter(({matcher:G})=>G(V)).map(({reducer:G})=>G)];return x.filter(G=>!!G).length===0&&(x=[R]),x.reduce((G,Y)=>{if(Y)if(Lp(G)){const z=Y(G,V);return z===void 0?G:z}else{if(cd(G))return s5(G,et=>Y(et,V));{const et=Y(G,V);if(et===void 0){if(G===null)return G;throw Error("A case reducer on a non-draftable value must not return undefined")}return et}}return G},L)}return N.getInitialState=w,N}var WQ=Symbol.for("rtk-slice-createasyncthunk");function KQ(d,f){return`${d}/${f}`}function zQ({creators:d}={}){var _;const f=(_=d==null?void 0:d.asyncThunk)==null?void 0:_[WQ];return function(R){const{name:w,reducerPath:N=w}=R;if(!w)throw new Error(ad(11));const L=(typeof R.reducers=="function"?R.reducers(XQ()):R.reducers)||{},V=Object.keys(L),x={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},G={addCase(ot,bt){const St=typeof ot=="string"?ot:ot.type;if(!St)throw new Error(ad(12));if(St in x.sliceCaseReducersByType)throw new Error(ad(13));return x.sliceCaseReducersByType[St]=bt,G},addMatcher(ot,bt){return x.sliceMatchers.push({matcher:ot,reducer:bt}),G},exposeAction(ot,bt){return x.actionCreators[ot]=bt,G},exposeCaseReducer(ot,bt){return x.sliceCaseReducersByName[ot]=bt,G}};V.forEach(ot=>{const bt=L[ot],St={reducerName:ot,type:KQ(w,ot),createNotation:typeof R.reducers=="function"};QQ(bt)?$Q(St,bt,G,f):JQ(St,bt,G)});function Y(){const[ot={},bt=[],St=void 0]=typeof R.extraReducers=="function"?c5(R.extraReducers):[R.extraReducers],Ft={...ot,...x.sliceCaseReducersByType};return HQ(R.initialState,Bt=>{for(let se in Ft)Bt.addCase(se,Ft[se]);for(let se of x.sliceMatchers)Bt.addMatcher(se.matcher,se.reducer);for(let se of bt)Bt.addMatcher(se.matcher,se.reducer);St&&Bt.addDefaultCase(St)})}const et=ot=>ot,z=new Map;let J;function X(ot,bt){return J||(J=Y()),J(ot,bt)}function tt(){return J||(J=Y()),J.getInitialState()}function dt(ot,bt=!1){function St(Bt){let se=Bt[ot];return typeof se>"u"&&bt&&(se=tt()),se}function Ft(Bt=et){const se=SF(z,bt,()=>new WeakMap);return SF(se,Bt,()=>{const Jt={};for(const[ae,we]of Object.entries(R.selectors??{}))Jt[ae]=YQ(we,Bt,tt,bt);return Jt})}return{reducerPath:ot,getSelectors:Ft,get selectors(){return Ft(St)},selectSlice:St}}const pt={name:w,reducer:X,actions:x.actionCreators,caseReducers:x.sliceCaseReducersByName,getInitialState:tt,...dt(N),injectInto(ot,{reducerPath:bt,...St}={}){const Ft=bt??N;return ot.inject({reducerPath:Ft,reducer:X},St),{...pt,...dt(Ft,!0)}}};return pt}}function YQ(d,f,_,g){function R(w,...N){let L=f(w);return typeof L>"u"&&g&&(L=_()),d(L,...N)}return R.unwrapped=d,R}var qQ=zQ();function XQ(){function d(f,_){return{_reducerDefinitionType:"asyncThunk",payloadCreator:f,..._}}return d.withTypes=()=>d,{reducer(f){return Object.assign({[f.name](..._){return f(..._)}}[f.name],{_reducerDefinitionType:"reducer"})},preparedReducer(f,_){return{_reducerDefinitionType:"reducerWithPrepare",prepare:f,reducer:_}},asyncThunk:d}}function JQ({type:d,reducerName:f,createNotation:_},g,R){let w,N;if("reducer"in g){if(_&&!ZQ(g))throw new Error(ad(17));w=g.reducer,N=g.prepare}else w=g;R.addCase(d,w).exposeCaseReducer(f,w).exposeAction(f,N?_F(d,N):_F(d))}function QQ(d){return d._reducerDefinitionType==="asyncThunk"}function ZQ(d){return d._reducerDefinitionType==="reducerWithPrepare"}function $Q({type:d,reducerName:f},_,g,R){if(!R)throw new Error(ad(18));const{payloadCreator:w,fulfilled:N,pending:L,rejected:V,settled:x,options:G}=_,Y=R(d,w,G);g.exposeAction(f,Y),N&&g.addCase(Y.fulfilled,N),L&&g.addCase(Y.pending,L),V&&g.addCase(Y.rejected,V),x&&g.addMatcher(Y.settled,x),g.exposeCaseReducer(f,{fulfilled:N||aC,pending:L||aC,rejected:V||aC,settled:x||aC})}function aC(){}function ad(d){return`Minified Redux Toolkit error #${d}; visit https://redux-toolkit.js.org/Errors?code=${d} for the full message or use the non-minified dev environment for full errors. `}const tZ=()=>({agentConnected:!1,selectedMicrophone:{deviceId:"",label:"",value:""}}),l5=qQ({name:"global",initialState:tZ(),reducers:{setAgentConnected:(d,f)=>{d.agentConnected=f.payload},setSelectedMicrophone:(d,f)=>{d.selectedMicrophone=f.payload}}}),{setAgentConnected:vF,setSelectedMicrophone:yF}=l5.actions,eZ=l5.reducer;function d5(d){const{frequencies:f,gap:_,barWidth:g,minBarHeight:R,maxBarHeight:w,borderRadius:N,className:L}=d,V=f.map(x=>{const G=x.reduce((Y,et)=>Y+et,0);return G<=0?0:Math.sqrt(G/x.length)});return Rt.jsx("div",{className:"flex items-center justify-center h-full",style:{gap:`${_}px`},children:V.map((x,G)=>{const Y={height:R+x*(w-R)+"px",borderRadius:N+"px",width:g+"px",transition:"background-color 0.35s ease-out, transform 0.25s ease-out"};return Rt.jsx("span",{className:L,style:Y},G)})})}function RF(d,[f,_]){return Math.min(_,Math.max(f,d))}function ar(d,f,{checkForDefaultPrevented:_=!0}={}){return function(R){if(d==null||d(R),_===!1||!R.defaultPrevented)return f==null?void 0:f(R)}}function JN(d,f=[]){let _=[];function g(w,N){const L=Z.createContext(N),V=_.length;_=[..._,N];const x=Y=>{var dt;const{scope:et,children:z,...J}=Y,X=((dt=et==null?void 0:et[d])==null?void 0:dt[V])||L,tt=Z.useMemo(()=>J,Object.values(J));return Rt.jsx(X.Provider,{value:tt,children:z})};x.displayName=w+"Provider";function G(Y,et){var X;const z=((X=et==null?void 0:et[d])==null?void 0:X[V])||L,J=Z.useContext(z);if(J)return J;if(N!==void 0)return N;throw new Error(`\`${Y}\` must be used within \`${w}\``)}return[x,G]}const R=()=>{const w=_.map(N=>Z.createContext(N));return function(L){const V=(L==null?void 0:L[d])||w;return Z.useMemo(()=>({[`__scope${d}`]:{...L,[d]:V}}),[L,V])}};return R.scopeName=d,[g,nZ(R,...f)]}function nZ(...d){const f=d[0];if(d.length===1)return f;const _=()=>{const g=d.map(R=>({useScope:R(),scopeName:R.scopeName}));return function(w){const N=g.reduce((L,{useScope:V,scopeName:x})=>{const Y=V(w)[`__scope${x}`];return{...L,...Y}},{});return Z.useMemo(()=>({[`__scope${f.scopeName}`]:N}),[N])}};return _.scopeName=f.scopeName,_}function iZ(d){const f=d+"CollectionProvider",[_,g]=JN(f),[R,w]=_(f,{collectionRef:{current:null},itemMap:new Map}),N=z=>{const{scope:J,children:X}=z,tt=re.useRef(null),dt=re.useRef(new Map).current;return Rt.jsx(R,{scope:J,itemMap:dt,collectionRef:tt,children:X})};N.displayName=f;const L=d+"CollectionSlot",V=re.forwardRef((z,J)=>{const{scope:X,children:tt}=z,dt=w(L,X),pt=zr(J,dt.collectionRef);return Rt.jsx(PE,{ref:pt,children:tt})});V.displayName=L;const x=d+"CollectionItemSlot",G="data-radix-collection-item",Y=re.forwardRef((z,J)=>{const{scope:X,children:tt,...dt}=z,pt=re.useRef(null),ot=zr(J,pt),bt=w(x,X);return re.useEffect(()=>(bt.itemMap.set(pt,{ref:pt,...dt}),()=>void bt.itemMap.delete(pt))),Rt.jsx(PE,{[G]:"",ref:ot,children:tt})});Y.displayName=x;function et(z){const J=w(d+"CollectionConsumer",z);return re.useCallback(()=>{const tt=J.collectionRef.current;if(!tt)return[];const dt=Array.from(tt.querySelectorAll(`[${G}]`));return Array.from(J.itemMap.values()).sort((bt,St)=>dt.indexOf(bt.ref.current)-dt.indexOf(St.ref.current))},[J.collectionRef,J.itemMap])}return[{Provider:N,Slot:V,ItemSlot:Y},et,g]}var rZ=Z.createContext(void 0);function sZ(d){const f=Z.useContext(rZ);return d||f||"ltr"}function ld(d){const f=Z.useRef(d);return Z.useEffect(()=>{f.current=d}),Z.useMemo(()=>(..._)=>{var g;return(g=f.current)==null?void 0:g.call(f,..._)},[])}function oZ(d,f=globalThis==null?void 0:globalThis.document){const _=ld(d);Z.useEffect(()=>{const g=R=>{R.key==="Escape"&&_(R)};return f.addEventListener("keydown",g,{capture:!0}),()=>f.removeEventListener("keydown",g,{capture:!0})},[_,f])}var aZ="DismissableLayer",ON="dismissableLayer.update",cZ="dismissableLayer.pointerDownOutside",lZ="dismissableLayer.focusOutside",bF,u5=Z.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),h5=Z.forwardRef((d,f)=>{const{disableOutsidePointerEvents:_=!1,onEscapeKeyDown:g,onPointerDownOutside:R,onFocusOutside:w,onInteractOutside:N,onDismiss:L,...V}=d,x=Z.useContext(u5),[G,Y]=Z.useState(null),et=(G==null?void 0:G.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,z]=Z.useState({}),J=zr(f,Bt=>Y(Bt)),X=Array.from(x.layers),[tt]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),dt=X.indexOf(tt),pt=G?X.indexOf(G):-1,ot=x.layersWithOutsidePointerEventsDisabled.size>0,bt=pt>=dt,St=hZ(Bt=>{const se=Bt.target,Jt=[...x.branches].some(ae=>ae.contains(se));!bt||Jt||(R==null||R(Bt),N==null||N(Bt),Bt.defaultPrevented||L==null||L())},et),Ft=pZ(Bt=>{const se=Bt.target;[...x.branches].some(ae=>ae.contains(se))||(w==null||w(Bt),N==null||N(Bt),Bt.defaultPrevented||L==null||L())},et);return oZ(Bt=>{pt===x.layers.size-1&&(g==null||g(Bt),!Bt.defaultPrevented&&L&&(Bt.preventDefault(),L()))},et),Z.useEffect(()=>{if(G)return _&&(x.layersWithOutsidePointerEventsDisabled.size===0&&(bF=et.body.style.pointerEvents,et.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(G)),x.layers.add(G),CF(),()=>{_&&x.layersWithOutsidePointerEventsDisabled.size===1&&(et.body.style.pointerEvents=bF)}},[G,et,_,x]),Z.useEffect(()=>()=>{G&&(x.layers.delete(G),x.layersWithOutsidePointerEventsDisabled.delete(G),CF())},[G,x]),Z.useEffect(()=>{const Bt=()=>z({});return document.addEventListener(ON,Bt),()=>document.removeEventListener(ON,Bt)},[]),Rt.jsx(tr.div,{...V,ref:J,style:{pointerEvents:ot?bt?"auto":"none":void 0,...d.style},onFocusCapture:ar(d.onFocusCapture,Ft.onFocusCapture),onBlurCapture:ar(d.onBlurCapture,Ft.onBlurCapture),onPointerDownCapture:ar(d.onPointerDownCapture,St.onPointerDownCapture)})});h5.displayName=aZ;var dZ="DismissableLayerBranch",uZ=Z.forwardRef((d,f)=>{const _=Z.useContext(u5),g=Z.useRef(null),R=zr(f,g);return Z.useEffect(()=>{const w=g.current;if(w)return _.branches.add(w),()=>{_.branches.delete(w)}},[_.branches]),Rt.jsx(tr.div,{...d,ref:R})});uZ.displayName=dZ;function hZ(d,f=globalThis==null?void 0:globalThis.document){const _=ld(d),g=Z.useRef(!1),R=Z.useRef(()=>{});return Z.useEffect(()=>{const w=L=>{if(L.target&&!g.current){let V=function(){p5(cZ,_,x,{discrete:!0})};const x={originalEvent:L};L.pointerType==="touch"?(f.removeEventListener("click",R.current),R.current=V,f.addEventListener("click",R.current,{once:!0})):V()}else f.removeEventListener("click",R.current);g.current=!1},N=window.setTimeout(()=>{f.addEventListener("pointerdown",w)},0);return()=>{window.clearTimeout(N),f.removeEventListener("pointerdown",w),f.removeEventListener("click",R.current)}},[f,_]),{onPointerDownCapture:()=>g.current=!0}}function pZ(d,f=globalThis==null?void 0:globalThis.document){const _=ld(d),g=Z.useRef(!1);return Z.useEffect(()=>{const R=w=>{w.target&&!g.current&&p5(lZ,_,{originalEvent:w},{discrete:!1})};return f.addEventListener("focusin",R),()=>f.removeEventListener("focusin",R)},[f,_]),{onFocusCapture:()=>g.current=!0,onBlurCapture:()=>g.current=!1}}function CF(){const d=new CustomEvent(ON);document.dispatchEvent(d)}function p5(d,f,_,{discrete:g}){const R=_.originalEvent.target,w=new CustomEvent(d,{bubbles:!1,cancelable:!0,detail:_});f&&R.addEventListener(d,f,{once:!0}),g?W9(R,w):R.dispatchEvent(w)}var eN=0;function fZ(){Z.useEffect(()=>{const d=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",d[0]??AF()),document.body.insertAdjacentElement("beforeend",d[1]??AF()),eN++,()=>{eN===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(f=>f.remove()),eN--}},[])}function AF(){const d=document.createElement("span");return d.setAttribute("data-radix-focus-guard",""),d.tabIndex=0,d.style.outline="none",d.style.opacity="0",d.style.position="fixed",d.style.pointerEvents="none",d}var nN="focusScope.autoFocusOnMount",iN="focusScope.autoFocusOnUnmount",wF={bubbles:!1,cancelable:!0},mZ="FocusScope",f5=Z.forwardRef((d,f)=>{const{loop:_=!1,trapped:g=!1,onMountAutoFocus:R,onUnmountAutoFocus:w,...N}=d,[L,V]=Z.useState(null),x=ld(R),G=ld(w),Y=Z.useRef(null),et=zr(f,X=>V(X)),z=Z.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Z.useEffect(()=>{if(g){let X=function(ot){if(z.paused||!L)return;const bt=ot.target;L.contains(bt)?Y.current=bt:Ou(Y.current,{select:!0})},tt=function(ot){if(z.paused||!L)return;const bt=ot.relatedTarget;bt!==null&&(L.contains(bt)||Ou(Y.current,{select:!0}))},dt=function(ot){if(document.activeElement===document.body)for(const St of ot)St.removedNodes.length>0&&Ou(L)};document.addEventListener("focusin",X),document.addEventListener("focusout",tt);const pt=new MutationObserver(dt);return L&&pt.observe(L,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",X),document.removeEventListener("focusout",tt),pt.disconnect()}}},[g,L,z.paused]),Z.useEffect(()=>{if(L){OF.add(z);const X=document.activeElement;if(!L.contains(X)){const dt=new CustomEvent(nN,wF);L.addEventListener(nN,x),L.dispatchEvent(dt),dt.defaultPrevented||(EZ(vZ(m5(L)),{select:!0}),document.activeElement===X&&Ou(L))}return()=>{L.removeEventListener(nN,x),setTimeout(()=>{const dt=new CustomEvent(iN,wF);L.addEventListener(iN,G),L.dispatchEvent(dt),dt.defaultPrevented||Ou(X??document.body,{select:!0}),L.removeEventListener(iN,G),OF.remove(z)},0)}}},[L,x,G,z]);const J=Z.useCallback(X=>{if(!_&&!g||z.paused)return;const tt=X.key==="Tab"&&!X.altKey&&!X.ctrlKey&&!X.metaKey,dt=document.activeElement;if(tt&&dt){const pt=X.currentTarget,[ot,bt]=_Z(pt);ot&&bt?!X.shiftKey&&dt===bt?(X.preventDefault(),_&&Ou(ot,{select:!0})):X.shiftKey&&dt===ot&&(X.preventDefault(),_&&Ou(bt,{select:!0})):dt===pt&&X.preventDefault()}},[_,g,z.paused]);return Rt.jsx(tr.div,{tabIndex:-1,...N,ref:et,onKeyDown:J})});f5.displayName=mZ;function EZ(d,{select:f=!1}={}){const _=document.activeElement;for(const g of d)if(Ou(g,{select:f}),document.activeElement!==_)return}function _Z(d){const f=m5(d),_=IF(f,d),g=IF(f.reverse(),d);return[_,g]}function m5(d){const f=[],_=document.createTreeWalker(d,NodeFilter.SHOW_ELEMENT,{acceptNode:g=>{const R=g.tagName==="INPUT"&&g.type==="hidden";return g.disabled||g.hidden||R?NodeFilter.FILTER_SKIP:g.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;_.nextNode();)f.push(_.currentNode);return f}function IF(d,f){for(const _ of d)if(!gZ(_,{upTo:f}))return _}function gZ(d,{upTo:f}){if(getComputedStyle(d).visibility==="hidden")return!0;for(;d;){if(f!==void 0&&d===f)return!1;if(getComputedStyle(d).display==="none")return!0;d=d.parentElement}return!1}function SZ(d){return d instanceof HTMLInputElement&&"select"in d}function Ou(d,{select:f=!1}={}){if(d&&d.focus){const _=document.activeElement;d.focus({preventScroll:!0}),d!==_&&SZ(d)&&f&&d.select()}}var OF=TZ();function TZ(){let d=[];return{add(f){const _=d[0];f!==_&&(_==null||_.pause()),d=NF(d,f),d.unshift(f)},remove(f){var _;d=NF(d,f),(_=d[0])==null||_.resume()}}}function NF(d,f){const _=[...d],g=_.indexOf(f);return g!==-1&&_.splice(g,1),_}function vZ(d){return d.filter(f=>f.tagName!=="A")}var wo=globalThis!=null&&globalThis.document?Z.useLayoutEffect:()=>{},yZ=W7.useId||(()=>{}),RZ=0;function QN(d){const[f,_]=Z.useState(yZ());return wo(()=>{_(g=>g??String(RZ++))},[d]),f?`radix-${f}`:""}const bZ=["top","right","bottom","left"],Du=Math.min,yo=Math.max,IC=Math.round,cC=Math.floor,cl=d=>({x:d,y:d}),CZ={left:"right",right:"left",bottom:"top",top:"bottom"},AZ={start:"end",end:"start"};function NN(d,f,_){return yo(d,Du(f,_))}function dd(d,f){return typeof d=="function"?d(f):d}function ud(d){return d.split("-")[0]}function jE(d){return d.split("-")[1]}function ZN(d){return d==="x"?"y":"x"}function $N(d){return d==="y"?"height":"width"}function Pu(d){return["top","bottom"].includes(ud(d))?"y":"x"}function tD(d){return ZN(Pu(d))}function wZ(d,f,_){_===void 0&&(_=!1);const g=jE(d),R=tD(d),w=$N(R);let N=R==="x"?g===(_?"end":"start")?"right":"left":g==="start"?"bottom":"top";return f.reference[w]>f.floating[w]&&(N=OC(N)),[N,OC(N)]}function IZ(d){const f=OC(d);return[DN(d),f,DN(f)]}function DN(d){return d.replace(/start|end/g,f=>AZ[f])}function OZ(d,f,_){const g=["left","right"],R=["right","left"],w=["top","bottom"],N=["bottom","top"];switch(d){case"top":case"bottom":return _?f?R:g:f?g:R;case"left":case"right":return f?w:N;default:return[]}}function NZ(d,f,_,g){const R=jE(d);let w=OZ(ud(d),_==="start",g);return R&&(w=w.map(N=>N+"-"+R),f&&(w=w.concat(w.map(DN)))),w}function OC(d){return d.replace(/left|right|bottom|top/g,f=>CZ[f])}function DZ(d){return{top:0,right:0,bottom:0,left:0,...d}}function E5(d){return typeof d!="number"?DZ(d):{top:d,right:d,bottom:d,left:d}}function NC(d){const{x:f,y:_,width:g,height:R}=d;return{width:g,height:R,top:_,left:f,right:f+g,bottom:_+R,x:f,y:_}}function DF(d,f,_){let{reference:g,floating:R}=d;const w=Pu(f),N=tD(f),L=$N(N),V=ud(f),x=w==="y",G=g.x+g.width/2-R.width/2,Y=g.y+g.height/2-R.height/2,et=g[L]/2-R[L]/2;let z;switch(V){case"top":z={x:G,y:g.y-R.height};break;case"bottom":z={x:G,y:g.y+g.height};break;case"right":z={x:g.x+g.width,y:Y};break;case"left":z={x:g.x-R.width,y:Y};break;default:z={x:g.x,y:g.y}}switch(jE(f)){case"start":z[N]-=et*(_&&x?-1:1);break;case"end":z[N]+=et*(_&&x?-1:1);break}return z}const PZ=async(d,f,_)=>{const{placement:g="bottom",strategy:R="absolute",middleware:w=[],platform:N}=_,L=w.filter(Boolean),V=await(N.isRTL==null?void 0:N.isRTL(f));let x=await N.getElementRects({reference:d,floating:f,strategy:R}),{x:G,y:Y}=DF(x,g,V),et=g,z={},J=0;for(let X=0;X<L.length;X++){const{name:tt,fn:dt}=L[X],{x:pt,y:ot,data:bt,reset:St}=await dt({x:G,y:Y,initialPlacement:g,placement:et,strategy:R,middlewareData:z,rects:x,platform:N,elements:{reference:d,floating:f}});G=pt??G,Y=ot??Y,z={...z,[tt]:{...z[tt],...bt}},St&&J<=50&&(J++,typeof St=="object"&&(St.placement&&(et=St.placement),St.rects&&(x=St.rects===!0?await N.getElementRects({reference:d,floating:f,strategy:R}):St.rects),{x:G,y:Y}=DF(x,et,V)),X=-1)}return{x:G,y:Y,placement:et,strategy:R,middlewareData:z}};async function $S(d,f){var _;f===void 0&&(f={});const{x:g,y:R,platform:w,rects:N,elements:L,strategy:V}=d,{boundary:x="clippingAncestors",rootBoundary:G="viewport",elementContext:Y="floating",altBoundary:et=!1,padding:z=0}=dd(f,d),J=E5(z),tt=L[et?Y==="floating"?"reference":"floating":Y],dt=NC(await w.getClippingRect({element:(_=await(w.isElement==null?void 0:w.isElement(tt)))==null||_?tt:tt.contextElement||await(w.getDocumentElement==null?void 0:w.getDocumentElement(L.floating)),boundary:x,rootBoundary:G,strategy:V})),pt=Y==="floating"?{x:g,y:R,width:N.floating.width,height:N.floating.height}:N.reference,ot=await(w.getOffsetParent==null?void 0:w.getOffsetParent(L.floating)),bt=await(w.isElement==null?void 0:w.isElement(ot))?await(w.getScale==null?void 0:w.getScale(ot))||{x:1,y:1}:{x:1,y:1},St=NC(w.convertOffsetParentRelativeRectToViewportRelativeRect?await w.convertOffsetParentRelativeRectToViewportRelativeRect({elements:L,rect:pt,offsetParent:ot,strategy:V}):pt);return{top:(dt.top-St.top+J.top)/bt.y,bottom:(St.bottom-dt.bottom+J.bottom)/bt.y,left:(dt.left-St.left+J.left)/bt.x,right:(St.right-dt.right+J.right)/bt.x}}const LZ=d=>({name:"arrow",options:d,async fn(f){const{x:_,y:g,placement:R,rects:w,platform:N,elements:L,middlewareData:V}=f,{element:x,padding:G=0}=dd(d,f)||{};if(x==null)return{};const Y=E5(G),et={x:_,y:g},z=tD(R),J=$N(z),X=await N.getDimensions(x),tt=z==="y",dt=tt?"top":"left",pt=tt?"bottom":"right",ot=tt?"clientHeight":"clientWidth",bt=w.reference[J]+w.reference[z]-et[z]-w.floating[J],St=et[z]-w.reference[z],Ft=await(N.getOffsetParent==null?void 0:N.getOffsetParent(x));let Bt=Ft?Ft[ot]:0;(!Bt||!await(N.isElement==null?void 0:N.isElement(Ft)))&&(Bt=L.floating[ot]||w.floating[J]);const se=bt/2-St/2,Jt=Bt/2-X[J]/2-1,ae=Du(Y[dt],Jt),we=Du(Y[pt],Jt),de=ae,Re=Bt-X[J]-we,Zt=Bt/2-X[J]/2+se,Ae=NN(de,Zt,Re),It=!V.arrow&&jE(R)!=null&&Zt!==Ae&&w.reference[J]/2-(Zt<de?ae:we)-X[J]/2<0,Gt=It?Zt<de?Zt-de:Zt-Re:0;return{[z]:et[z]+Gt,data:{[z]:Ae,centerOffset:Zt-Ae-Gt,...It&&{alignmentOffset:Gt}},reset:It}}}),kZ=function(d){return d===void 0&&(d={}),{name:"flip",options:d,async fn(f){var _,g;const{placement:R,middlewareData:w,rects:N,initialPlacement:L,platform:V,elements:x}=f,{mainAxis:G=!0,crossAxis:Y=!0,fallbackPlacements:et,fallbackStrategy:z="bestFit",fallbackAxisSideDirection:J="none",flipAlignment:X=!0,...tt}=dd(d,f);if((_=w.arrow)!=null&&_.alignmentOffset)return{};const dt=ud(R),pt=Pu(L),ot=ud(L)===L,bt=await(V.isRTL==null?void 0:V.isRTL(x.floating)),St=et||(ot||!X?[OC(L)]:IZ(L)),Ft=J!=="none";!et&&Ft&&St.push(...NZ(L,X,J,bt));const Bt=[L,...St],se=await $S(f,tt),Jt=[];let ae=((g=w.flip)==null?void 0:g.overflows)||[];if(G&&Jt.push(se[dt]),Y){const Zt=wZ(R,N,bt);Jt.push(se[Zt[0]],se[Zt[1]])}if(ae=[...ae,{placement:R,overflows:Jt}],!Jt.every(Zt=>Zt<=0)){var we,de;const Zt=(((we=w.flip)==null?void 0:we.index)||0)+1,Ae=Bt[Zt];if(Ae)return{data:{index:Zt,overflows:ae},reset:{placement:Ae}};let It=(de=ae.filter(Gt=>Gt.overflows[0]<=0).sort((Gt,Nt)=>Gt.overflows[1]-Nt.overflows[1])[0])==null?void 0:de.placement;if(!It)switch(z){case"bestFit":{var Re;const Gt=(Re=ae.filter(Nt=>{if(Ft){const Yt=Pu(Nt.placement);return Yt===pt||Yt==="y"}return!0}).map(Nt=>[Nt.placement,Nt.overflows.filter(Yt=>Yt>0).reduce((Yt,st)=>Yt+st,0)]).sort((Nt,Yt)=>Nt[1]-Yt[1])[0])==null?void 0:Re[0];Gt&&(It=Gt);break}case"initialPlacement":It=L;break}if(R!==It)return{reset:{placement:It}}}return{}}}};function PF(d,f){return{top:d.top-f.height,right:d.right-f.width,bottom:d.bottom-f.height,left:d.left-f.width}}function LF(d){return bZ.some(f=>d[f]>=0)}const MZ=function(d){return d===void 0&&(d={}),{name:"hide",options:d,async fn(f){const{rects:_}=f,{strategy:g="referenceHidden",...R}=dd(d,f);switch(g){case"referenceHidden":{const w=await $S(f,{...R,elementContext:"reference"}),N=PF(w,_.reference);return{data:{referenceHiddenOffsets:N,referenceHidden:LF(N)}}}case"escaped":{const w=await $S(f,{...R,altBoundary:!0}),N=PF(w,_.floating);return{data:{escapedOffsets:N,escaped:LF(N)}}}default:return{}}}}};async function xZ(d,f){const{placement:_,platform:g,elements:R}=d,w=await(g.isRTL==null?void 0:g.isRTL(R.floating)),N=ud(_),L=jE(_),V=Pu(_)==="y",x=["left","top"].includes(N)?-1:1,G=w&&V?-1:1,Y=dd(f,d);let{mainAxis:et,crossAxis:z,alignmentAxis:J}=typeof Y=="number"?{mainAxis:Y,crossAxis:0,alignmentAxis:null}:{mainAxis:Y.mainAxis||0,crossAxis:Y.crossAxis||0,alignmentAxis:Y.alignmentAxis};return L&&typeof J=="number"&&(z=L==="end"?J*-1:J),V?{x:z*G,y:et*x}:{x:et*x,y:z*G}}const UZ=function(d){return d===void 0&&(d=0),{name:"offset",options:d,async fn(f){var _,g;const{x:R,y:w,placement:N,middlewareData:L}=f,V=await xZ(f,d);return N===((_=L.offset)==null?void 0:_.placement)&&(g=L.arrow)!=null&&g.alignmentOffset?{}:{x:R+V.x,y:w+V.y,data:{...V,placement:N}}}}},VZ=function(d){return d===void 0&&(d={}),{name:"shift",options:d,async fn(f){const{x:_,y:g,placement:R}=f,{mainAxis:w=!0,crossAxis:N=!1,limiter:L={fn:tt=>{let{x:dt,y:pt}=tt;return{x:dt,y:pt}}},...V}=dd(d,f),x={x:_,y:g},G=await $S(f,V),Y=Pu(ud(R)),et=ZN(Y);let z=x[et],J=x[Y];if(w){const tt=et==="y"?"top":"left",dt=et==="y"?"bottom":"right",pt=z+G[tt],ot=z-G[dt];z=NN(pt,z,ot)}if(N){const tt=Y==="y"?"top":"left",dt=Y==="y"?"bottom":"right",pt=J+G[tt],ot=J-G[dt];J=NN(pt,J,ot)}const X=L.fn({...f,[et]:z,[Y]:J});return{...X,data:{x:X.x-_,y:X.y-g,enabled:{[et]:w,[Y]:N}}}}}},BZ=function(d){return d===void 0&&(d={}),{options:d,fn(f){const{x:_,y:g,placement:R,rects:w,middlewareData:N}=f,{offset:L=0,mainAxis:V=!0,crossAxis:x=!0}=dd(d,f),G={x:_,y:g},Y=Pu(R),et=ZN(Y);let z=G[et],J=G[Y];const X=dd(L,f),tt=typeof X=="number"?{mainAxis:X,crossAxis:0}:{mainAxis:0,crossAxis:0,...X};if(V){const ot=et==="y"?"height":"width",bt=w.reference[et]-w.floating[ot]+tt.mainAxis,St=w.reference[et]+w.reference[ot]-tt.mainAxis;z<bt?z=bt:z>St&&(z=St)}if(x){var dt,pt;const ot=et==="y"?"width":"height",bt=["top","left"].includes(ud(R)),St=w.reference[Y]-w.floating[ot]+(bt&&((dt=N.offset)==null?void 0:dt[Y])||0)+(bt?0:tt.crossAxis),Ft=w.reference[Y]+w.reference[ot]+(bt?0:((pt=N.offset)==null?void 0:pt[Y])||0)-(bt?tt.crossAxis:0);J<St?J=St:J>Ft&&(J=Ft)}return{[et]:z,[Y]:J}}}},jZ=function(d){return d===void 0&&(d={}),{name:"size",options:d,async fn(f){var _,g;const{placement:R,rects:w,platform:N,elements:L}=f,{apply:V=()=>{},...x}=dd(d,f),G=await $S(f,x),Y=ud(R),et=jE(R),z=Pu(R)==="y",{width:J,height:X}=w.floating;let tt,dt;Y==="top"||Y==="bottom"?(tt=Y,dt=et===(await(N.isRTL==null?void 0:N.isRTL(L.floating))?"start":"end")?"left":"right"):(dt=Y,tt=et==="end"?"top":"bottom");const pt=X-G.top-G.bottom,ot=J-G.left-G.right,bt=Du(X-G[tt],pt),St=Du(J-G[dt],ot),Ft=!f.middlewareData.shift;let Bt=bt,se=St;if((_=f.middlewareData.shift)!=null&&_.enabled.x&&(se=ot),(g=f.middlewareData.shift)!=null&&g.enabled.y&&(Bt=pt),Ft&&!et){const ae=yo(G.left,0),we=yo(G.right,0),de=yo(G.top,0),Re=yo(G.bottom,0);z?se=J-2*(ae!==0||we!==0?ae+we:yo(G.left,G.right)):Bt=X-2*(de!==0||Re!==0?de+Re:yo(G.top,G.bottom))}await V({...f,availableWidth:se,availableHeight:Bt});const Jt=await N.getDimensions(L.floating);return J!==Jt.width||X!==Jt.height?{reset:{rects:!0}}:{}}}};function KC(){return typeof window<"u"}function FE(d){return _5(d)?(d.nodeName||"").toLowerCase():"#document"}function bo(d){var f;return(d==null||(f=d.ownerDocument)==null?void 0:f.defaultView)||window}function dl(d){var f;return(f=(_5(d)?d.ownerDocument:d.document)||window.document)==null?void 0:f.documentElement}function _5(d){return KC()?d instanceof Node||d instanceof bo(d).Node:!1}function $a(d){return KC()?d instanceof Element||d instanceof bo(d).Element:!1}function ll(d){return KC()?d instanceof HTMLElement||d instanceof bo(d).HTMLElement:!1}function kF(d){return!KC()||typeof ShadowRoot>"u"?!1:d instanceof ShadowRoot||d instanceof bo(d).ShadowRoot}function rT(d){const{overflow:f,overflowX:_,overflowY:g,display:R}=tc(d);return/auto|scroll|overlay|hidden|clip/.test(f+g+_)&&!["inline","contents"].includes(R)}function FZ(d){return["table","td","th"].includes(FE(d))}function zC(d){return[":popover-open",":modal"].some(f=>{try{return d.matches(f)}catch{return!1}})}function eD(d){const f=nD(),_=$a(d)?tc(d):d;return["transform","translate","scale","rotate","perspective"].some(g=>_[g]?_[g]!=="none":!1)||(_.containerType?_.containerType!=="normal":!1)||!f&&(_.backdropFilter?_.backdropFilter!=="none":!1)||!f&&(_.filter?_.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(g=>(_.willChange||"").includes(g))||["paint","layout","strict","content"].some(g=>(_.contain||"").includes(g))}function GZ(d){let f=Lu(d);for(;ll(f)&&!kE(f);){if(eD(f))return f;if(zC(f))return null;f=Lu(f)}return null}function nD(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function kE(d){return["html","body","#document"].includes(FE(d))}function tc(d){return bo(d).getComputedStyle(d)}function YC(d){return $a(d)?{scrollLeft:d.scrollLeft,scrollTop:d.scrollTop}:{scrollLeft:d.scrollX,scrollTop:d.scrollY}}function Lu(d){if(FE(d)==="html")return d;const f=d.assignedSlot||d.parentNode||kF(d)&&d.host||dl(d);return kF(f)?f.host:f}function g5(d){const f=Lu(d);return kE(f)?d.ownerDocument?d.ownerDocument.body:d.body:ll(f)&&rT(f)?f:g5(f)}function tT(d,f,_){var g;f===void 0&&(f=[]),_===void 0&&(_=!0);const R=g5(d),w=R===((g=d.ownerDocument)==null?void 0:g.body),N=bo(R);if(w){const L=PN(N);return f.concat(N,N.visualViewport||[],rT(R)?R:[],L&&_?tT(L):[])}return f.concat(R,tT(R,[],_))}function PN(d){return d.parent&&Object.getPrototypeOf(d.parent)?d.frameElement:null}function S5(d){const f=tc(d);let _=parseFloat(f.width)||0,g=parseFloat(f.height)||0;const R=ll(d),w=R?d.offsetWidth:_,N=R?d.offsetHeight:g,L=IC(_)!==w||IC(g)!==N;return L&&(_=w,g=N),{width:_,height:g,$:L}}function iD(d){return $a(d)?d:d.contextElement}function NE(d){const f=iD(d);if(!ll(f))return cl(1);const _=f.getBoundingClientRect(),{width:g,height:R,$:w}=S5(f);let N=(w?IC(_.width):_.width)/g,L=(w?IC(_.height):_.height)/R;return(!N||!Number.isFinite(N))&&(N=1),(!L||!Number.isFinite(L))&&(L=1),{x:N,y:L}}const HZ=cl(0);function T5(d){const f=bo(d);return!nD()||!f.visualViewport?HZ:{x:f.visualViewport.offsetLeft,y:f.visualViewport.offsetTop}}function WZ(d,f,_){return f===void 0&&(f=!1),!_||f&&_!==bo(d)?!1:f}function Mp(d,f,_,g){f===void 0&&(f=!1),_===void 0&&(_=!1);const R=d.getBoundingClientRect(),w=iD(d);let N=cl(1);f&&(g?$a(g)&&(N=NE(g)):N=NE(d));const L=WZ(w,_,g)?T5(w):cl(0);let V=(R.left+L.x)/N.x,x=(R.top+L.y)/N.y,G=R.width/N.x,Y=R.height/N.y;if(w){const et=bo(w),z=g&&$a(g)?bo(g):g;let J=et,X=PN(J);for(;X&&g&&z!==J;){const tt=NE(X),dt=X.getBoundingClientRect(),pt=tc(X),ot=dt.left+(X.clientLeft+parseFloat(pt.paddingLeft))*tt.x,bt=dt.top+(X.clientTop+parseFloat(pt.paddingTop))*tt.y;V*=tt.x,x*=tt.y,G*=tt.x,Y*=tt.y,V+=ot,x+=bt,J=bo(X),X=PN(J)}}return NC({width:G,height:Y,x:V,y:x})}function rD(d,f){const _=YC(d).scrollLeft;return f?f.left+_:Mp(dl(d)).left+_}function v5(d,f,_){_===void 0&&(_=!1);const g=d.getBoundingClientRect(),R=g.left+f.scrollLeft-(_?0:rD(d,g)),w=g.top+f.scrollTop;return{x:R,y:w}}function KZ(d){let{elements:f,rect:_,offsetParent:g,strategy:R}=d;const w=R==="fixed",N=dl(g),L=f?zC(f.floating):!1;if(g===N||L&&w)return _;let V={scrollLeft:0,scrollTop:0},x=cl(1);const G=cl(0),Y=ll(g);if((Y||!Y&&!w)&&((FE(g)!=="body"||rT(N))&&(V=YC(g)),ll(g))){const z=Mp(g);x=NE(g),G.x=z.x+g.clientLeft,G.y=z.y+g.clientTop}const et=N&&!Y&&!w?v5(N,V,!0):cl(0);return{width:_.width*x.x,height:_.height*x.y,x:_.x*x.x-V.scrollLeft*x.x+G.x+et.x,y:_.y*x.y-V.scrollTop*x.y+G.y+et.y}}function zZ(d){return Array.from(d.getClientRects())}function YZ(d){const f=dl(d),_=YC(d),g=d.ownerDocument.body,R=yo(f.scrollWidth,f.clientWidth,g.scrollWidth,g.clientWidth),w=yo(f.scrollHeight,f.clientHeight,g.scrollHeight,g.clientHeight);let N=-_.scrollLeft+rD(d);const L=-_.scrollTop;return tc(g).direction==="rtl"&&(N+=yo(f.clientWidth,g.clientWidth)-R),{width:R,height:w,x:N,y:L}}function qZ(d,f){const _=bo(d),g=dl(d),R=_.visualViewport;let w=g.clientWidth,N=g.clientHeight,L=0,V=0;if(R){w=R.width,N=R.height;const x=nD();(!x||x&&f==="fixed")&&(L=R.offsetLeft,V=R.offsetTop)}return{width:w,height:N,x:L,y:V}}function XZ(d,f){const _=Mp(d,!0,f==="fixed"),g=_.top+d.clientTop,R=_.left+d.clientLeft,w=ll(d)?NE(d):cl(1),N=d.clientWidth*w.x,L=d.clientHeight*w.y,V=R*w.x,x=g*w.y;return{width:N,height:L,x:V,y:x}}function MF(d,f,_){let g;if(f==="viewport")g=qZ(d,_);else if(f==="document")g=YZ(dl(d));else if($a(f))g=XZ(f,_);else{const R=T5(d);g={x:f.x-R.x,y:f.y-R.y,width:f.width,height:f.height}}return NC(g)}function y5(d,f){const _=Lu(d);return _===f||!$a(_)||kE(_)?!1:tc(_).position==="fixed"||y5(_,f)}function JZ(d,f){const _=f.get(d);if(_)return _;let g=tT(d,[],!1).filter(L=>$a(L)&&FE(L)!=="body"),R=null;const w=tc(d).position==="fixed";let N=w?Lu(d):d;for(;$a(N)&&!kE(N);){const L=tc(N),V=eD(N);!V&&L.position==="fixed"&&(R=null),(w?!V&&!R:!V&&L.position==="static"&&!!R&&["absolute","fixed"].includes(R.position)||rT(N)&&!V&&y5(d,N))?g=g.filter(G=>G!==N):R=L,N=Lu(N)}return f.set(d,g),g}function QZ(d){let{element:f,boundary:_,rootBoundary:g,strategy:R}=d;const N=[..._==="clippingAncestors"?zC(f)?[]:JZ(f,this._c):[].concat(_),g],L=N[0],V=N.reduce((x,G)=>{const Y=MF(f,G,R);return x.top=yo(Y.top,x.top),x.right=Du(Y.right,x.right),x.bottom=Du(Y.bottom,x.bottom),x.left=yo(Y.left,x.left),x},MF(f,L,R));return{width:V.right-V.left,height:V.bottom-V.top,x:V.left,y:V.top}}function ZZ(d){const{width:f,height:_}=S5(d);return{width:f,height:_}}function $Z(d,f,_){const g=ll(f),R=dl(f),w=_==="fixed",N=Mp(d,!0,w,f);let L={scrollLeft:0,scrollTop:0};const V=cl(0);if(g||!g&&!w)if((FE(f)!=="body"||rT(R))&&(L=YC(f)),g){const et=Mp(f,!0,w,f);V.x=et.x+f.clientLeft,V.y=et.y+f.clientTop}else R&&(V.x=rD(R));const x=R&&!g&&!w?v5(R,L):cl(0),G=N.left+L.scrollLeft-V.x-x.x,Y=N.top+L.scrollTop-V.y-x.y;return{x:G,y:Y,width:N.width,height:N.height}}function rN(d){return tc(d).position==="static"}function xF(d,f){if(!ll(d)||tc(d).position==="fixed")return null;if(f)return f(d);let _=d.offsetParent;return dl(d)===_&&(_=_.ownerDocument.body),_}function R5(d,f){const _=bo(d);if(zC(d))return _;if(!ll(d)){let R=Lu(d);for(;R&&!kE(R);){if($a(R)&&!rN(R))return R;R=Lu(R)}return _}let g=xF(d,f);for(;g&&FZ(g)&&rN(g);)g=xF(g,f);return g&&kE(g)&&rN(g)&&!eD(g)?_:g||GZ(d)||_}const t$=async function(d){const f=this.getOffsetParent||R5,_=this.getDimensions,g=await _(d.floating);return{reference:$Z(d.reference,await f(d.floating),d.strategy),floating:{x:0,y:0,width:g.width,height:g.height}}};function e$(d){return tc(d).direction==="rtl"}const n$={convertOffsetParentRelativeRectToViewportRelativeRect:KZ,getDocumentElement:dl,getClippingRect:QZ,getOffsetParent:R5,getElementRects:t$,getClientRects:zZ,getDimensions:ZZ,getScale:NE,isElement:$a,isRTL:e$};function b5(d,f){return d.x===f.x&&d.y===f.y&&d.width===f.width&&d.height===f.height}function i$(d,f){let _=null,g;const R=dl(d);function w(){var L;clearTimeout(g),(L=_)==null||L.disconnect(),_=null}function N(L,V){L===void 0&&(L=!1),V===void 0&&(V=1),w();const x=d.getBoundingClientRect(),{left:G,top:Y,width:et,height:z}=x;if(L||f(),!et||!z)return;const J=cC(Y),X=cC(R.clientWidth-(G+et)),tt=cC(R.clientHeight-(Y+z)),dt=cC(G),ot={rootMargin:-J+"px "+-X+"px "+-tt+"px "+-dt+"px",threshold:yo(0,Du(1,V))||1};let bt=!0;function St(Ft){const Bt=Ft[0].intersectionRatio;if(Bt!==V){if(!bt)return N();Bt?N(!1,Bt):g=setTimeout(()=>{N(!1,1e-7)},1e3)}Bt===1&&!b5(x,d.getBoundingClientRect())&&N(),bt=!1}try{_=new IntersectionObserver(St,{...ot,root:R.ownerDocument})}catch{_=new IntersectionObserver(St,ot)}_.observe(d)}return N(!0),w}function r$(d,f,_,g){g===void 0&&(g={});const{ancestorScroll:R=!0,ancestorResize:w=!0,elementResize:N=typeof ResizeObserver=="function",layoutShift:L=typeof IntersectionObserver=="function",animationFrame:V=!1}=g,x=iD(d),G=R||w?[...x?tT(x):[],...tT(f)]:[];G.forEach(dt=>{R&&dt.addEventListener("scroll",_,{passive:!0}),w&&dt.addEventListener("resize",_)});const Y=x&&L?i$(x,_):null;let et=-1,z=null;N&&(z=new ResizeObserver(dt=>{let[pt]=dt;pt&&pt.target===x&&z&&(z.unobserve(f),cancelAnimationFrame(et),et=requestAnimationFrame(()=>{var ot;(ot=z)==null||ot.observe(f)})),_()}),x&&!V&&z.observe(x),z.observe(f));let J,X=V?Mp(d):null;V&&tt();function tt(){const dt=Mp(d);X&&!b5(X,dt)&&_(),X=dt,J=requestAnimationFrame(tt)}return _(),()=>{var dt;G.forEach(pt=>{R&&pt.removeEventListener("scroll",_),w&&pt.removeEventListener("resize",_)}),Y==null||Y(),(dt=z)==null||dt.disconnect(),z=null,V&&cancelAnimationFrame(J)}}const s$=UZ,o$=VZ,a$=kZ,c$=jZ,l$=MZ,UF=LZ,d$=BZ,u$=(d,f,_)=>{const g=new Map,R={platform:n$,..._},w={...R.platform,_c:g};return PZ(d,f,{...R,platform:w})};var gC=typeof document<"u"?Z.useLayoutEffect:Z.useEffect;function DC(d,f){if(d===f)return!0;if(typeof d!=typeof f)return!1;if(typeof d=="function"&&d.toString()===f.toString())return!0;let _,g,R;if(d&&f&&typeof d=="object"){if(Array.isArray(d)){if(_=d.length,_!==f.length)return!1;for(g=_;g--!==0;)if(!DC(d[g],f[g]))return!1;return!0}if(R=Object.keys(d),_=R.length,_!==Object.keys(f).length)return!1;for(g=_;g--!==0;)if(!{}.hasOwnProperty.call(f,R[g]))return!1;for(g=_;g--!==0;){const w=R[g];if(!(w==="_owner"&&d.$$typeof)&&!DC(d[w],f[w]))return!1}return!0}return d!==d&&f!==f}function C5(d){return typeof window>"u"?1:(d.ownerDocument.defaultView||window).devicePixelRatio||1}function VF(d,f){const _=C5(d);return Math.round(f*_)/_}function sN(d){const f=Z.useRef(d);return gC(()=>{f.current=d}),f}function h$(d){d===void 0&&(d={});const{placement:f="bottom",strategy:_="absolute",middleware:g=[],platform:R,elements:{reference:w,floating:N}={},transform:L=!0,whileElementsMounted:V,open:x}=d,[G,Y]=Z.useState({x:0,y:0,strategy:_,placement:f,middlewareData:{},isPositioned:!1}),[et,z]=Z.useState(g);DC(et,g)||z(g);const[J,X]=Z.useState(null),[tt,dt]=Z.useState(null),pt=Z.useCallback(Nt=>{Nt!==Ft.current&&(Ft.current=Nt,X(Nt))},[]),ot=Z.useCallback(Nt=>{Nt!==Bt.current&&(Bt.current=Nt,dt(Nt))},[]),bt=w||J,St=N||tt,Ft=Z.useRef(null),Bt=Z.useRef(null),se=Z.useRef(G),Jt=V!=null,ae=sN(V),we=sN(R),de=sN(x),Re=Z.useCallback(()=>{if(!Ft.current||!Bt.current)return;const Nt={placement:f,strategy:_,middleware:et};we.current&&(Nt.platform=we.current),u$(Ft.current,Bt.current,Nt).then(Yt=>{const st={...Yt,isPositioned:de.current!==!1};Zt.current&&!DC(se.current,st)&&(se.current=st,eT.flushSync(()=>{Y(st)}))})},[et,f,_,we,de]);gC(()=>{x===!1&&se.current.isPositioned&&(se.current.isPositioned=!1,Y(Nt=>({...Nt,isPositioned:!1})))},[x]);const Zt=Z.useRef(!1);gC(()=>(Zt.current=!0,()=>{Zt.current=!1}),[]),gC(()=>{if(bt&&(Ft.current=bt),St&&(Bt.current=St),bt&&St){if(ae.current)return ae.current(bt,St,Re);Re()}},[bt,St,Re,ae,Jt]);const Ae=Z.useMemo(()=>({reference:Ft,floating:Bt,setReference:pt,setFloating:ot}),[pt,ot]),It=Z.useMemo(()=>({reference:bt,floating:St}),[bt,St]),Gt=Z.useMemo(()=>{const Nt={position:_,left:0,top:0};if(!It.floating)return Nt;const Yt=VF(It.floating,G.x),st=VF(It.floating,G.y);return L?{...Nt,transform:"translate("+Yt+"px, "+st+"px)",...C5(It.floating)>=1.5&&{willChange:"transform"}}:{position:_,left:Yt,top:st}},[_,L,It.floating,G.x,G.y]);return Z.useMemo(()=>({...G,update:Re,refs:Ae,elements:It,floatingStyles:Gt}),[G,Re,Ae,It,Gt])}const p$=d=>{function f(_){return{}.hasOwnProperty.call(_,"current")}return{name:"arrow",options:d,fn(_){const{element:g,padding:R}=typeof d=="function"?d(_):d;return g&&f(g)?g.current!=null?UF({element:g.current,padding:R}).fn(_):{}:g?UF({element:g,padding:R}).fn(_):{}}}},f$=(d,f)=>({...s$(d),options:[d,f]}),m$=(d,f)=>({...o$(d),options:[d,f]}),E$=(d,f)=>({...d$(d),options:[d,f]}),_$=(d,f)=>({...a$(d),options:[d,f]}),g$=(d,f)=>({...c$(d),options:[d,f]}),S$=(d,f)=>({...l$(d),options:[d,f]}),T$=(d,f)=>({...p$(d),options:[d,f]});var v$="Arrow",A5=Z.forwardRef((d,f)=>{const{children:_,width:g=10,height:R=5,...w}=d;return Rt.jsx(tr.svg,{...w,ref:f,width:g,height:R,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:d.asChild?_:Rt.jsx("polygon",{points:"0,0 30,0 15,10"})})});A5.displayName=v$;var y$=A5;function R$(d){const[f,_]=Z.useState(void 0);return wo(()=>{if(d){_({width:d.offsetWidth,height:d.offsetHeight});const g=new ResizeObserver(R=>{if(!Array.isArray(R)||!R.length)return;const w=R[0];let N,L;if("borderBoxSize"in w){const V=w.borderBoxSize,x=Array.isArray(V)?V[0]:V;N=x.inlineSize,L=x.blockSize}else N=d.offsetWidth,L=d.offsetHeight;_({width:N,height:L})});return g.observe(d,{box:"border-box"}),()=>g.unobserve(d)}else _(void 0)},[d]),f}var sD="Popper",[w5,I5]=JN(sD),[b$,O5]=w5(sD),N5=d=>{const{__scopePopper:f,children:_}=d,[g,R]=Z.useState(null);return Rt.jsx(b$,{scope:f,anchor:g,onAnchorChange:R,children:_})};N5.displayName=sD;var D5="PopperAnchor",P5=Z.forwardRef((d,f)=>{const{__scopePopper:_,virtualRef:g,...R}=d,w=O5(D5,_),N=Z.useRef(null),L=zr(f,N);return Z.useEffect(()=>{w.onAnchorChange((g==null?void 0:g.current)||N.current)}),g?null:Rt.jsx(tr.div,{...R,ref:L})});P5.displayName=D5;var oD="PopperContent",[C$,A$]=w5(oD),L5=Z.forwardRef((d,f)=>{var te,_e,Le,Se,ze,ln;const{__scopePopper:_,side:g="bottom",sideOffset:R=0,align:w="center",alignOffset:N=0,arrowPadding:L=0,avoidCollisions:V=!0,collisionBoundary:x=[],collisionPadding:G=0,sticky:Y="partial",hideWhenDetached:et=!1,updatePositionStrategy:z="optimized",onPlaced:J,...X}=d,tt=O5(oD,_),[dt,pt]=Z.useState(null),ot=zr(f,Pn=>pt(Pn)),[bt,St]=Z.useState(null),Ft=R$(bt),Bt=(Ft==null?void 0:Ft.width)??0,se=(Ft==null?void 0:Ft.height)??0,Jt=g+(w!=="center"?"-"+w:""),ae=typeof G=="number"?G:{top:0,right:0,bottom:0,left:0,...G},we=Array.isArray(x)?x:[x],de=we.length>0,Re={padding:ae,boundary:we.filter(I$),altBoundary:de},{refs:Zt,floatingStyles:Ae,placement:It,isPositioned:Gt,middlewareData:Nt}=h$({strategy:"fixed",placement:Jt,whileElementsMounted:(...Pn)=>r$(...Pn,{animationFrame:z==="always"}),elements:{reference:tt.anchor},middleware:[f$({mainAxis:R+se,alignmentAxis:N}),V&&m$({mainAxis:!0,crossAxis:!1,limiter:Y==="partial"?E$():void 0,...Re}),V&&_$({...Re}),g$({...Re,apply:({elements:Pn,rects:cr,availableWidth:ws,availableHeight:Ii})=>{const{width:to,height:pi}=cr.reference,Oi=Pn.floating.style;Oi.setProperty("--radix-popper-available-width",`${ws}px`),Oi.setProperty("--radix-popper-available-height",`${Ii}px`),Oi.setProperty("--radix-popper-anchor-width",`${to}px`),Oi.setProperty("--radix-popper-anchor-height",`${pi}px`)}}),bt&&T$({element:bt,padding:L}),O$({arrowWidth:Bt,arrowHeight:se}),et&&S$({strategy:"referenceHidden",...Re})]}),[Yt,st]=x5(It),xt=ld(J);wo(()=>{Gt&&(xt==null||xt())},[Gt,xt]);const Qt=(te=Nt.arrow)==null?void 0:te.x,ee=(_e=Nt.arrow)==null?void 0:_e.y,zt=((Le=Nt.arrow)==null?void 0:Le.centerOffset)!==0,[ve,ye]=Z.useState();return wo(()=>{dt&&ye(window.getComputedStyle(dt).zIndex)},[dt]),Rt.jsx("div",{ref:Zt.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ae,transform:Gt?Ae.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ve,"--radix-popper-transform-origin":[(Se=Nt.transformOrigin)==null?void 0:Se.x,(ze=Nt.transformOrigin)==null?void 0:ze.y].join(" "),...((ln=Nt.hide)==null?void 0:ln.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:d.dir,children:Rt.jsx(C$,{scope:_,placedSide:Yt,onArrowChange:St,arrowX:Qt,arrowY:ee,shouldHideArrow:zt,children:Rt.jsx(tr.div,{"data-side":Yt,"data-align":st,...X,ref:ot,style:{...X.style,animation:Gt?void 0:"none"}})})})});L5.displayName=oD;var k5="PopperArrow",w$={top:"bottom",right:"left",bottom:"top",left:"right"},M5=Z.forwardRef(function(f,_){const{__scopePopper:g,...R}=f,w=A$(k5,g),N=w$[w.placedSide];return Rt.jsx("span",{ref:w.onArrowChange,style:{position:"absolute",left:w.arrowX,top:w.arrowY,[N]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[w.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[w.placedSide],visibility:w.shouldHideArrow?"hidden":void 0},children:Rt.jsx(y$,{...R,ref:_,style:{...R.style,display:"block"}})})});M5.displayName=k5;function I$(d){return d!==null}var O$=d=>({name:"transformOrigin",options:d,fn(f){var tt,dt,pt;const{placement:_,rects:g,middlewareData:R}=f,N=((tt=R.arrow)==null?void 0:tt.centerOffset)!==0,L=N?0:d.arrowWidth,V=N?0:d.arrowHeight,[x,G]=x5(_),Y={start:"0%",center:"50%",end:"100%"}[G],et=(((dt=R.arrow)==null?void 0:dt.x)??0)+L/2,z=(((pt=R.arrow)==null?void 0:pt.y)??0)+V/2;let J="",X="";return x==="bottom"?(J=N?Y:`${et}px`,X=`${-V}px`):x==="top"?(J=N?Y:`${et}px`,X=`${g.floating.height+V}px`):x==="right"?(J=`${-V}px`,X=N?Y:`${z}px`):x==="left"&&(J=`${g.floating.width+V}px`,X=N?Y:`${z}px`),{data:{x:J,y:X}}}});function x5(d){const[f,_="center"]=d.split("-");return[f,_]}var N$=N5,D$=P5,P$=L5,L$=M5,k$="Portal",U5=Z.forwardRef((d,f)=>{var L;const{container:_,...g}=d,[R,w]=Z.useState(!1);wo(()=>w(!0),[]);const N=_||R&&((L=globalThis==null?void 0:globalThis.document)==null?void 0:L.body);return N?p3.createPortal(Rt.jsx(tr.div,{...g,ref:f}),N):null});U5.displayName=k$;function BF({prop:d,defaultProp:f,onChange:_=()=>{}}){const[g,R]=M$({defaultProp:f,onChange:_}),w=d!==void 0,N=w?d:g,L=ld(_),V=Z.useCallback(x=>{if(w){const Y=typeof x=="function"?x(d):x;Y!==d&&L(Y)}else R(x)},[w,d,R,L]);return[N,V]}function M$({defaultProp:d,onChange:f}){const _=Z.useState(d),[g]=_,R=Z.useRef(g),w=ld(f);return Z.useEffect(()=>{R.current!==g&&(w(g),R.current=g)},[g,R,w]),_}function x$(d){const f=Z.useRef({value:d,previous:d});return Z.useMemo(()=>(f.current.value!==d&&(f.current.previous=f.current.value,f.current.value=d),f.current.previous),[d])}var U$="VisuallyHidden",V5=Z.forwardRef((d,f)=>Rt.jsx(tr.span,{...d,ref:f,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...d.style}}));V5.displayName=U$;var V$=function(d){if(typeof document>"u")return null;var f=Array.isArray(d)?d[0]:d;return f.ownerDocument.body},AE=new WeakMap,lC=new WeakMap,dC={},oN=0,B5=function(d){return d&&(d.host||B5(d.parentNode))},B$=function(d,f){return f.map(function(_){if(d.contains(_))return _;var g=B5(_);return g&&d.contains(g)?g:(console.error("aria-hidden",_,"in not contained inside",d,". Doing nothing"),null)}).filter(function(_){return!!_})},j$=function(d,f,_,g){var R=B$(f,Array.isArray(d)?d:[d]);dC[_]||(dC[_]=new WeakMap);var w=dC[_],N=[],L=new Set,V=new Set(R),x=function(Y){!Y||L.has(Y)||(L.add(Y),x(Y.parentNode))};R.forEach(x);var G=function(Y){!Y||V.has(Y)||Array.prototype.forEach.call(Y.children,function(et){if(L.has(et))G(et);else try{var z=et.getAttribute(g),J=z!==null&&z!=="false",X=(AE.get(et)||0)+1,tt=(w.get(et)||0)+1;AE.set(et,X),w.set(et,tt),N.push(et),X===1&&J&&lC.set(et,!0),tt===1&&et.setAttribute(_,"true"),J||et.setAttribute(g,"true")}catch(dt){console.error("aria-hidden: cannot operate on ",et,dt)}})};return G(f),L.clear(),oN++,function(){N.forEach(function(Y){var et=AE.get(Y)-1,z=w.get(Y)-1;AE.set(Y,et),w.set(Y,z),et||(lC.has(Y)||Y.removeAttribute(g),lC.delete(Y)),z||Y.removeAttribute(_)}),oN--,oN||(AE=new WeakMap,AE=new WeakMap,lC=new WeakMap,dC={})}},F$=function(d,f,_){_===void 0&&(_="data-aria-hidden");var g=Array.from(Array.isArray(d)?d:[d]),R=V$(d);return R?(g.push.apply(g,Array.from(R.querySelectorAll("[aria-live]"))),j$(g,R,_,"aria-hidden")):function(){return null}},al=function(){return al=Object.assign||function(f){for(var _,g=1,R=arguments.length;g<R;g++){_=arguments[g];for(var w in _)Object.prototype.hasOwnProperty.call(_,w)&&(f[w]=_[w])}return f},al.apply(this,arguments)};function j5(d,f){var _={};for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&f.indexOf(g)<0&&(_[g]=d[g]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var R=0,g=Object.getOwnPropertySymbols(d);R<g.length;R++)f.indexOf(g[R])<0&&Object.prototype.propertyIsEnumerable.call(d,g[R])&&(_[g[R]]=d[g[R]]);return _}function G$(d,f,_){if(_||arguments.length===2)for(var g=0,R=f.length,w;g<R;g++)(w||!(g in f))&&(w||(w=Array.prototype.slice.call(f,0,g)),w[g]=f[g]);return d.concat(w||Array.prototype.slice.call(f))}var SC="right-scroll-bar-position",TC="width-before-scroll-bar",H$="with-scroll-bars-hidden",W$="--removed-body-scroll-bar-size";function aN(d,f){return typeof d=="function"?d(f):d&&(d.current=f),d}function K$(d,f){var _=Z.useState(function(){return{value:d,callback:f,facade:{get current(){return _.value},set current(g){var R=_.value;R!==g&&(_.value=g,_.callback(g,R))}}}})[0];return _.callback=f,_.facade}var z$=typeof window<"u"?Z.useLayoutEffect:Z.useEffect,jF=new WeakMap;function Y$(d,f){var _=K$(null,function(g){return d.forEach(function(R){return aN(R,g)})});return z$(function(){var g=jF.get(_);if(g){var R=new Set(g),w=new Set(d),N=_.current;R.forEach(function(L){w.has(L)||aN(L,null)}),w.forEach(function(L){R.has(L)||aN(L,N)})}jF.set(_,d)},[d]),_}function q$(d){return d}function X$(d,f){f===void 0&&(f=q$);var _=[],g=!1,R={read:function(){if(g)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return _.length?_[_.length-1]:d},useMedium:function(w){var N=f(w,g);return _.push(N),function(){_=_.filter(function(L){return L!==N})}},assignSyncMedium:function(w){for(g=!0;_.length;){var N=_;_=[],N.forEach(w)}_={push:function(L){return w(L)},filter:function(){return _}}},assignMedium:function(w){g=!0;var N=[];if(_.length){var L=_;_=[],L.forEach(w),N=_}var V=function(){var G=N;N=[],G.forEach(w)},x=function(){return Promise.resolve().then(V)};x(),_={push:function(G){N.push(G),x()},filter:function(G){return N=N.filter(G),_}}}};return R}function J$(d){d===void 0&&(d={});var f=X$(null);return f.options=al({async:!0,ssr:!1},d),f}var F5=function(d){var f=d.sideCar,_=j5(d,["sideCar"]);if(!f)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var g=f.read();if(!g)throw new Error("Sidecar medium not found");return Z.createElement(g,al({},_))};F5.isSideCarExport=!0;function Q$(d,f){return d.useMedium(f),F5}var G5=J$(),cN=function(){},qC=Z.forwardRef(function(d,f){var _=Z.useRef(null),g=Z.useState({onScrollCapture:cN,onWheelCapture:cN,onTouchMoveCapture:cN}),R=g[0],w=g[1],N=d.forwardProps,L=d.children,V=d.className,x=d.removeScrollBar,G=d.enabled,Y=d.shards,et=d.sideCar,z=d.noIsolation,J=d.inert,X=d.allowPinchZoom,tt=d.as,dt=tt===void 0?"div":tt,pt=d.gapMode,ot=j5(d,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),bt=et,St=Y$([_,f]),Ft=al(al({},ot),R);return Z.createElement(Z.Fragment,null,G&&Z.createElement(bt,{sideCar:G5,removeScrollBar:x,shards:Y,noIsolation:z,inert:J,setCallbacks:w,allowPinchZoom:!!X,lockRef:_,gapMode:pt}),N?Z.cloneElement(Z.Children.only(L),al(al({},Ft),{ref:St})):Z.createElement(dt,al({},Ft,{className:V,ref:St}),L))});qC.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};qC.classNames={fullWidth:TC,zeroRight:SC};var Z$=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function $$(){if(!document)return null;var d=document.createElement("style");d.type="text/css";var f=Z$();return f&&d.setAttribute("nonce",f),d}function ttt(d,f){d.styleSheet?d.styleSheet.cssText=f:d.appendChild(document.createTextNode(f))}function ett(d){var f=document.head||document.getElementsByTagName("head")[0];f.appendChild(d)}var ntt=function(){var d=0,f=null;return{add:function(_){d==0&&(f=$$())&&(ttt(f,_),ett(f)),d++},remove:function(){d--,!d&&f&&(f.parentNode&&f.parentNode.removeChild(f),f=null)}}},itt=function(){var d=ntt();return function(f,_){Z.useEffect(function(){return d.add(f),function(){d.remove()}},[f&&_])}},H5=function(){var d=itt(),f=function(_){var g=_.styles,R=_.dynamic;return d(g,R),null};return f},rtt={left:0,top:0,right:0,gap:0},lN=function(d){return parseInt(d||"",10)||0},stt=function(d){var f=window.getComputedStyle(document.body),_=f[d==="padding"?"paddingLeft":"marginLeft"],g=f[d==="padding"?"paddingTop":"marginTop"],R=f[d==="padding"?"paddingRight":"marginRight"];return[lN(_),lN(g),lN(R)]},ott=function(d){if(d===void 0&&(d="margin"),typeof window>"u")return rtt;var f=stt(d),_=document.documentElement.clientWidth,g=window.innerWidth;return{left:f[0],top:f[1],right:f[2],gap:Math.max(0,g-_+f[2]-f[0])}},att=H5(),DE="data-scroll-locked",ctt=function(d,f,_,g){var R=d.left,w=d.top,N=d.right,L=d.gap;return _===void 0&&(_="margin"),`
  .`.concat(H$,` {
   overflow: hidden `).concat(g,`;
   padding-right: `).concat(L,"px ").concat(g,`;
  }
  body[`).concat(DE,`] {
    overflow: hidden `).concat(g,`;
    overscroll-behavior: contain;
    `).concat([f&&"position: relative ".concat(g,";"),_==="margin"&&`
    padding-left: `.concat(R,`px;
    padding-top: `).concat(w,`px;
    padding-right: `).concat(N,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(L,"px ").concat(g,`;
    `),_==="padding"&&"padding-right: ".concat(L,"px ").concat(g,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(SC,` {
    right: `).concat(L,"px ").concat(g,`;
  }
  
  .`).concat(TC,` {
    margin-right: `).concat(L,"px ").concat(g,`;
  }
  
  .`).concat(SC," .").concat(SC,` {
    right: 0 `).concat(g,`;
  }
  
  .`).concat(TC," .").concat(TC,` {
    margin-right: 0 `).concat(g,`;
  }
  
  body[`).concat(DE,`] {
    `).concat(W$,": ").concat(L,`px;
  }
`)},FF=function(){var d=parseInt(document.body.getAttribute(DE)||"0",10);return isFinite(d)?d:0},ltt=function(){Z.useEffect(function(){return document.body.setAttribute(DE,(FF()+1).toString()),function(){var d=FF()-1;d<=0?document.body.removeAttribute(DE):document.body.setAttribute(DE,d.toString())}},[])},dtt=function(d){var f=d.noRelative,_=d.noImportant,g=d.gapMode,R=g===void 0?"margin":g;ltt();var w=Z.useMemo(function(){return ott(R)},[R]);return Z.createElement(att,{styles:ctt(w,!f,R,_?"":"!important")})},LN=!1;if(typeof window<"u")try{var uC=Object.defineProperty({},"passive",{get:function(){return LN=!0,!0}});window.addEventListener("test",uC,uC),window.removeEventListener("test",uC,uC)}catch{LN=!1}var wE=LN?{passive:!1}:!1,utt=function(d){return d.tagName==="TEXTAREA"},W5=function(d,f){if(!(d instanceof Element))return!1;var _=window.getComputedStyle(d);return _[f]!=="hidden"&&!(_.overflowY===_.overflowX&&!utt(d)&&_[f]==="visible")},htt=function(d){return W5(d,"overflowY")},ptt=function(d){return W5(d,"overflowX")},GF=function(d,f){var _=f.ownerDocument,g=f;do{typeof ShadowRoot<"u"&&g instanceof ShadowRoot&&(g=g.host);var R=K5(d,g);if(R){var w=z5(d,g),N=w[1],L=w[2];if(N>L)return!0}g=g.parentNode}while(g&&g!==_.body);return!1},ftt=function(d){var f=d.scrollTop,_=d.scrollHeight,g=d.clientHeight;return[f,_,g]},mtt=function(d){var f=d.scrollLeft,_=d.scrollWidth,g=d.clientWidth;return[f,_,g]},K5=function(d,f){return d==="v"?htt(f):ptt(f)},z5=function(d,f){return d==="v"?ftt(f):mtt(f)},Ett=function(d,f){return d==="h"&&f==="rtl"?-1:1},_tt=function(d,f,_,g,R){var w=Ett(d,window.getComputedStyle(f).direction),N=w*g,L=_.target,V=f.contains(L),x=!1,G=N>0,Y=0,et=0;do{var z=z5(d,L),J=z[0],X=z[1],tt=z[2],dt=X-tt-w*J;(J||dt)&&K5(d,L)&&(Y+=dt,et+=J),L instanceof ShadowRoot?L=L.host:L=L.parentNode}while(!V&&L!==document.body||V&&(f.contains(L)||f===L));return(G&&Math.abs(Y)<1||!G&&Math.abs(et)<1)&&(x=!0),x},hC=function(d){return"changedTouches"in d?[d.changedTouches[0].clientX,d.changedTouches[0].clientY]:[0,0]},HF=function(d){return[d.deltaX,d.deltaY]},WF=function(d){return d&&"current"in d?d.current:d},gtt=function(d,f){return d[0]===f[0]&&d[1]===f[1]},Stt=function(d){return`
  .block-interactivity-`.concat(d,` {pointer-events: none;}
  .allow-interactivity-`).concat(d,` {pointer-events: all;}
`)},Ttt=0,IE=[];function vtt(d){var f=Z.useRef([]),_=Z.useRef([0,0]),g=Z.useRef(),R=Z.useState(Ttt++)[0],w=Z.useState(H5)[0],N=Z.useRef(d);Z.useEffect(function(){N.current=d},[d]),Z.useEffect(function(){if(d.inert){document.body.classList.add("block-interactivity-".concat(R));var X=G$([d.lockRef.current],(d.shards||[]).map(WF),!0).filter(Boolean);return X.forEach(function(tt){return tt.classList.add("allow-interactivity-".concat(R))}),function(){document.body.classList.remove("block-interactivity-".concat(R)),X.forEach(function(tt){return tt.classList.remove("allow-interactivity-".concat(R))})}}},[d.inert,d.lockRef.current,d.shards]);var L=Z.useCallback(function(X,tt){if("touches"in X&&X.touches.length===2||X.type==="wheel"&&X.ctrlKey)return!N.current.allowPinchZoom;var dt=hC(X),pt=_.current,ot="deltaX"in X?X.deltaX:pt[0]-dt[0],bt="deltaY"in X?X.deltaY:pt[1]-dt[1],St,Ft=X.target,Bt=Math.abs(ot)>Math.abs(bt)?"h":"v";if("touches"in X&&Bt==="h"&&Ft.type==="range")return!1;var se=GF(Bt,Ft);if(!se)return!0;if(se?St=Bt:(St=Bt==="v"?"h":"v",se=GF(Bt,Ft)),!se)return!1;if(!g.current&&"changedTouches"in X&&(ot||bt)&&(g.current=St),!St)return!0;var Jt=g.current||St;return _tt(Jt,tt,X,Jt==="h"?ot:bt)},[]),V=Z.useCallback(function(X){var tt=X;if(!(!IE.length||IE[IE.length-1]!==w)){var dt="deltaY"in tt?HF(tt):hC(tt),pt=f.current.filter(function(St){return St.name===tt.type&&(St.target===tt.target||tt.target===St.shadowParent)&&gtt(St.delta,dt)})[0];if(pt&&pt.should){tt.cancelable&&tt.preventDefault();return}if(!pt){var ot=(N.current.shards||[]).map(WF).filter(Boolean).filter(function(St){return St.contains(tt.target)}),bt=ot.length>0?L(tt,ot[0]):!N.current.noIsolation;bt&&tt.cancelable&&tt.preventDefault()}}},[]),x=Z.useCallback(function(X,tt,dt,pt){var ot={name:X,delta:tt,target:dt,should:pt,shadowParent:ytt(dt)};f.current.push(ot),setTimeout(function(){f.current=f.current.filter(function(bt){return bt!==ot})},1)},[]),G=Z.useCallback(function(X){_.current=hC(X),g.current=void 0},[]),Y=Z.useCallback(function(X){x(X.type,HF(X),X.target,L(X,d.lockRef.current))},[]),et=Z.useCallback(function(X){x(X.type,hC(X),X.target,L(X,d.lockRef.current))},[]);Z.useEffect(function(){return IE.push(w),d.setCallbacks({onScrollCapture:Y,onWheelCapture:Y,onTouchMoveCapture:et}),document.addEventListener("wheel",V,wE),document.addEventListener("touchmove",V,wE),document.addEventListener("touchstart",G,wE),function(){IE=IE.filter(function(X){return X!==w}),document.removeEventListener("wheel",V,wE),document.removeEventListener("touchmove",V,wE),document.removeEventListener("touchstart",G,wE)}},[]);var z=d.removeScrollBar,J=d.inert;return Z.createElement(Z.Fragment,null,J?Z.createElement(w,{styles:Stt(R)}):null,z?Z.createElement(dtt,{gapMode:d.gapMode}):null)}function ytt(d){for(var f=null;d!==null;)d instanceof ShadowRoot&&(f=d.host,d=d.host),d=d.parentNode;return f}const Rtt=Q$(G5,vtt);var Y5=Z.forwardRef(function(d,f){return Z.createElement(qC,al({},d,{ref:f,sideCar:Rtt}))});Y5.classNames=qC.classNames;var btt=[" ","Enter","ArrowUp","ArrowDown"],Ctt=[" ","Enter"],sT="Select",[XC,JC,Att]=iZ(sT),[GE,ant]=JN(sT,[Att,I5]),QC=I5(),[wtt,ku]=GE(sT),[Itt,Ott]=GE(sT),q5=d=>{const{__scopeSelect:f,children:_,open:g,defaultOpen:R,onOpenChange:w,value:N,defaultValue:L,onValueChange:V,dir:x,name:G,autoComplete:Y,disabled:et,required:z,form:J}=d,X=QC(f),[tt,dt]=Z.useState(null),[pt,ot]=Z.useState(null),[bt,St]=Z.useState(!1),Ft=sZ(x),[Bt=!1,se]=BF({prop:g,defaultProp:R,onChange:w}),[Jt,ae]=BF({prop:N,defaultProp:L,onChange:V}),we=Z.useRef(null),de=tt?J||!!tt.closest("form"):!0,[Re,Zt]=Z.useState(new Set),Ae=Array.from(Re).map(It=>It.props.value).join(";");return Rt.jsx(N$,{...X,children:Rt.jsxs(wtt,{required:z,scope:f,trigger:tt,onTriggerChange:dt,valueNode:pt,onValueNodeChange:ot,valueNodeHasChildren:bt,onValueNodeHasChildrenChange:St,contentId:QN(),value:Jt,onValueChange:ae,open:Bt,onOpenChange:se,dir:Ft,triggerPointerDownPosRef:we,disabled:et,children:[Rt.jsx(XC.Provider,{scope:f,children:Rt.jsx(Itt,{scope:d.__scopeSelect,onNativeOptionAdd:Z.useCallback(It=>{Zt(Gt=>new Set(Gt).add(It))},[]),onNativeOptionRemove:Z.useCallback(It=>{Zt(Gt=>{const Nt=new Set(Gt);return Nt.delete(It),Nt})},[]),children:_})}),de?Rt.jsxs(SG,{"aria-hidden":!0,required:z,tabIndex:-1,name:G,autoComplete:Y,value:Jt,onChange:It=>ae(It.target.value),disabled:et,form:J,children:[Jt===void 0?Rt.jsx("option",{value:""}):null,Array.from(Re)]},Ae):null]})})};q5.displayName=sT;var X5="SelectTrigger",J5=Z.forwardRef((d,f)=>{const{__scopeSelect:_,disabled:g=!1,...R}=d,w=QC(_),N=ku(X5,_),L=N.disabled||g,V=zr(f,N.onTriggerChange),x=JC(_),G=Z.useRef("touch"),[Y,et,z]=TG(X=>{const tt=x().filter(ot=>!ot.disabled),dt=tt.find(ot=>ot.value===N.value),pt=vG(tt,X,dt);pt!==void 0&&N.onValueChange(pt.value)}),J=X=>{L||(N.onOpenChange(!0),z()),X&&(N.triggerPointerDownPosRef.current={x:Math.round(X.pageX),y:Math.round(X.pageY)})};return Rt.jsx(D$,{asChild:!0,...w,children:Rt.jsx(tr.button,{type:"button",role:"combobox","aria-controls":N.contentId,"aria-expanded":N.open,"aria-required":N.required,"aria-autocomplete":"none",dir:N.dir,"data-state":N.open?"open":"closed",disabled:L,"data-disabled":L?"":void 0,"data-placeholder":gG(N.value)?"":void 0,...R,ref:V,onClick:ar(R.onClick,X=>{X.currentTarget.focus(),G.current!=="mouse"&&J(X)}),onPointerDown:ar(R.onPointerDown,X=>{G.current=X.pointerType;const tt=X.target;tt.hasPointerCapture(X.pointerId)&&tt.releasePointerCapture(X.pointerId),X.button===0&&X.ctrlKey===!1&&X.pointerType==="mouse"&&(J(X),X.preventDefault())}),onKeyDown:ar(R.onKeyDown,X=>{const tt=Y.current!=="";!(X.ctrlKey||X.altKey||X.metaKey)&&X.key.length===1&&et(X.key),!(tt&&X.key===" ")&&btt.includes(X.key)&&(J(),X.preventDefault())})})})});J5.displayName=X5;var Q5="SelectValue",Z5=Z.forwardRef((d,f)=>{const{__scopeSelect:_,className:g,style:R,children:w,placeholder:N="",...L}=d,V=ku(Q5,_),{onValueNodeHasChildrenChange:x}=V,G=w!==void 0,Y=zr(f,V.onValueNodeChange);return wo(()=>{x(G)},[x,G]),Rt.jsx(tr.span,{...L,ref:Y,style:{pointerEvents:"none"},children:gG(V.value)?Rt.jsx(Rt.Fragment,{children:N}):w})});Z5.displayName=Q5;var Ntt="SelectIcon",$5=Z.forwardRef((d,f)=>{const{__scopeSelect:_,children:g,...R}=d;return Rt.jsx(tr.span,{"aria-hidden":!0,...R,ref:f,children:g||"▼"})});$5.displayName=Ntt;var Dtt="SelectPortal",tG=d=>Rt.jsx(U5,{asChild:!0,...d});tG.displayName=Dtt;var xp="SelectContent",eG=Z.forwardRef((d,f)=>{const _=ku(xp,d.__scopeSelect),[g,R]=Z.useState();if(wo(()=>{R(new DocumentFragment)},[]),!_.open){const w=g;return w?eT.createPortal(Rt.jsx(nG,{scope:d.__scopeSelect,children:Rt.jsx(XC.Slot,{scope:d.__scopeSelect,children:Rt.jsx("div",{children:d.children})})}),w):null}return Rt.jsx(iG,{...d,ref:f})});eG.displayName=xp;var Qa=10,[nG,Mu]=GE(xp),Ptt="SelectContentImpl",iG=Z.forwardRef((d,f)=>{const{__scopeSelect:_,position:g="item-aligned",onCloseAutoFocus:R,onEscapeKeyDown:w,onPointerDownOutside:N,side:L,sideOffset:V,align:x,alignOffset:G,arrowPadding:Y,collisionBoundary:et,collisionPadding:z,sticky:J,hideWhenDetached:X,avoidCollisions:tt,...dt}=d,pt=ku(xp,_),[ot,bt]=Z.useState(null),[St,Ft]=Z.useState(null),Bt=zr(f,te=>bt(te)),[se,Jt]=Z.useState(null),[ae,we]=Z.useState(null),de=JC(_),[Re,Zt]=Z.useState(!1),Ae=Z.useRef(!1);Z.useEffect(()=>{if(ot)return F$(ot)},[ot]),fZ();const It=Z.useCallback(te=>{const[_e,...Le]=de().map(ln=>ln.ref.current),[Se]=Le.slice(-1),ze=document.activeElement;for(const ln of te)if(ln===ze||(ln==null||ln.scrollIntoView({block:"nearest"}),ln===_e&&St&&(St.scrollTop=0),ln===Se&&St&&(St.scrollTop=St.scrollHeight),ln==null||ln.focus(),document.activeElement!==ze))return},[de,St]),Gt=Z.useCallback(()=>It([se,ot]),[It,se,ot]);Z.useEffect(()=>{Re&&Gt()},[Re,Gt]);const{onOpenChange:Nt,triggerPointerDownPosRef:Yt}=pt;Z.useEffect(()=>{if(ot){let te={x:0,y:0};const _e=Se=>{var ze,ln;te={x:Math.abs(Math.round(Se.pageX)-(((ze=Yt.current)==null?void 0:ze.x)??0)),y:Math.abs(Math.round(Se.pageY)-(((ln=Yt.current)==null?void 0:ln.y)??0))}},Le=Se=>{te.x<=10&&te.y<=10?Se.preventDefault():ot.contains(Se.target)||Nt(!1),document.removeEventListener("pointermove",_e),Yt.current=null};return Yt.current!==null&&(document.addEventListener("pointermove",_e),document.addEventListener("pointerup",Le,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",_e),document.removeEventListener("pointerup",Le,{capture:!0})}}},[ot,Nt,Yt]),Z.useEffect(()=>{const te=()=>Nt(!1);return window.addEventListener("blur",te),window.addEventListener("resize",te),()=>{window.removeEventListener("blur",te),window.removeEventListener("resize",te)}},[Nt]);const[st,xt]=TG(te=>{const _e=de().filter(ze=>!ze.disabled),Le=_e.find(ze=>ze.ref.current===document.activeElement),Se=vG(_e,te,Le);Se&&setTimeout(()=>Se.ref.current.focus())}),Qt=Z.useCallback((te,_e,Le)=>{const Se=!Ae.current&&!Le;(pt.value!==void 0&&pt.value===_e||Se)&&(Jt(te),Se&&(Ae.current=!0))},[pt.value]),ee=Z.useCallback(()=>ot==null?void 0:ot.focus(),[ot]),zt=Z.useCallback((te,_e,Le)=>{const Se=!Ae.current&&!Le;(pt.value!==void 0&&pt.value===_e||Se)&&we(te)},[pt.value]),ve=g==="popper"?kN:rG,ye=ve===kN?{side:L,sideOffset:V,align:x,alignOffset:G,arrowPadding:Y,collisionBoundary:et,collisionPadding:z,sticky:J,hideWhenDetached:X,avoidCollisions:tt}:{};return Rt.jsx(nG,{scope:_,content:ot,viewport:St,onViewportChange:Ft,itemRefCallback:Qt,selectedItem:se,onItemLeave:ee,itemTextRefCallback:zt,focusSelectedItem:Gt,selectedItemText:ae,position:g,isPositioned:Re,searchRef:st,children:Rt.jsx(Y5,{as:PE,allowPinchZoom:!0,children:Rt.jsx(f5,{asChild:!0,trapped:pt.open,onMountAutoFocus:te=>{te.preventDefault()},onUnmountAutoFocus:ar(R,te=>{var _e;(_e=pt.trigger)==null||_e.focus({preventScroll:!0}),te.preventDefault()}),children:Rt.jsx(h5,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:w,onPointerDownOutside:N,onFocusOutside:te=>te.preventDefault(),onDismiss:()=>pt.onOpenChange(!1),children:Rt.jsx(ve,{role:"listbox",id:pt.contentId,"data-state":pt.open?"open":"closed",dir:pt.dir,onContextMenu:te=>te.preventDefault(),...dt,...ye,onPlaced:()=>Zt(!0),ref:Bt,style:{display:"flex",flexDirection:"column",outline:"none",...dt.style},onKeyDown:ar(dt.onKeyDown,te=>{const _e=te.ctrlKey||te.altKey||te.metaKey;if(te.key==="Tab"&&te.preventDefault(),!_e&&te.key.length===1&&xt(te.key),["ArrowUp","ArrowDown","Home","End"].includes(te.key)){let Se=de().filter(ze=>!ze.disabled).map(ze=>ze.ref.current);if(["ArrowUp","End"].includes(te.key)&&(Se=Se.slice().reverse()),["ArrowUp","ArrowDown"].includes(te.key)){const ze=te.target,ln=Se.indexOf(ze);Se=Se.slice(ln+1)}setTimeout(()=>It(Se)),te.preventDefault()}})})})})})})});iG.displayName=Ptt;var Ltt="SelectItemAlignedPosition",rG=Z.forwardRef((d,f)=>{const{__scopeSelect:_,onPlaced:g,...R}=d,w=ku(xp,_),N=Mu(xp,_),[L,V]=Z.useState(null),[x,G]=Z.useState(null),Y=zr(f,Bt=>G(Bt)),et=JC(_),z=Z.useRef(!1),J=Z.useRef(!0),{viewport:X,selectedItem:tt,selectedItemText:dt,focusSelectedItem:pt}=N,ot=Z.useCallback(()=>{if(w.trigger&&w.valueNode&&L&&x&&X&&tt&&dt){const Bt=w.trigger.getBoundingClientRect(),se=x.getBoundingClientRect(),Jt=w.valueNode.getBoundingClientRect(),ae=dt.getBoundingClientRect();if(w.dir!=="rtl"){const ze=ae.left-se.left,ln=Jt.left-ze,Pn=Bt.left-ln,cr=Bt.width+Pn,ws=Math.max(cr,se.width),Ii=window.innerWidth-Qa,to=RF(ln,[Qa,Math.max(Qa,Ii-ws)]);L.style.minWidth=cr+"px",L.style.left=to+"px"}else{const ze=se.right-ae.right,ln=window.innerWidth-Jt.right-ze,Pn=window.innerWidth-Bt.right-ln,cr=Bt.width+Pn,ws=Math.max(cr,se.width),Ii=window.innerWidth-Qa,to=RF(ln,[Qa,Math.max(Qa,Ii-ws)]);L.style.minWidth=cr+"px",L.style.right=to+"px"}const we=et(),de=window.innerHeight-Qa*2,Re=X.scrollHeight,Zt=window.getComputedStyle(x),Ae=parseInt(Zt.borderTopWidth,10),It=parseInt(Zt.paddingTop,10),Gt=parseInt(Zt.borderBottomWidth,10),Nt=parseInt(Zt.paddingBottom,10),Yt=Ae+It+Re+Nt+Gt,st=Math.min(tt.offsetHeight*5,Yt),xt=window.getComputedStyle(X),Qt=parseInt(xt.paddingTop,10),ee=parseInt(xt.paddingBottom,10),zt=Bt.top+Bt.height/2-Qa,ve=de-zt,ye=tt.offsetHeight/2,te=tt.offsetTop+ye,_e=Ae+It+te,Le=Yt-_e;if(_e<=zt){const ze=we.length>0&&tt===we[we.length-1].ref.current;L.style.bottom="0px";const ln=x.clientHeight-X.offsetTop-X.offsetHeight,Pn=Math.max(ve,ye+(ze?ee:0)+ln+Gt),cr=_e+Pn;L.style.height=cr+"px"}else{const ze=we.length>0&&tt===we[0].ref.current;L.style.top="0px";const Pn=Math.max(zt,Ae+X.offsetTop+(ze?Qt:0)+ye)+Le;L.style.height=Pn+"px",X.scrollTop=_e-zt+X.offsetTop}L.style.margin=`${Qa}px 0`,L.style.minHeight=st+"px",L.style.maxHeight=de+"px",g==null||g(),requestAnimationFrame(()=>z.current=!0)}},[et,w.trigger,w.valueNode,L,x,X,tt,dt,w.dir,g]);wo(()=>ot(),[ot]);const[bt,St]=Z.useState();wo(()=>{x&&St(window.getComputedStyle(x).zIndex)},[x]);const Ft=Z.useCallback(Bt=>{Bt&&J.current===!0&&(ot(),pt==null||pt(),J.current=!1)},[ot,pt]);return Rt.jsx(Mtt,{scope:_,contentWrapper:L,shouldExpandOnScrollRef:z,onScrollButtonChange:Ft,children:Rt.jsx("div",{ref:V,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:bt},children:Rt.jsx(tr.div,{...R,ref:Y,style:{boxSizing:"border-box",maxHeight:"100%",...R.style}})})})});rG.displayName=Ltt;var ktt="SelectPopperPosition",kN=Z.forwardRef((d,f)=>{const{__scopeSelect:_,align:g="start",collisionPadding:R=Qa,...w}=d,N=QC(_);return Rt.jsx(P$,{...N,...w,ref:f,align:g,collisionPadding:R,style:{boxSizing:"border-box",...w.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});kN.displayName=ktt;var[Mtt,aD]=GE(xp,{}),MN="SelectViewport",sG=Z.forwardRef((d,f)=>{const{__scopeSelect:_,nonce:g,...R}=d,w=Mu(MN,_),N=aD(MN,_),L=zr(f,w.onViewportChange),V=Z.useRef(0);return Rt.jsxs(Rt.Fragment,{children:[Rt.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:g}),Rt.jsx(XC.Slot,{scope:_,children:Rt.jsx(tr.div,{"data-radix-select-viewport":"",role:"presentation",...R,ref:L,style:{position:"relative",flex:1,overflow:"hidden auto",...R.style},onScroll:ar(R.onScroll,x=>{const G=x.currentTarget,{contentWrapper:Y,shouldExpandOnScrollRef:et}=N;if(et!=null&&et.current&&Y){const z=Math.abs(V.current-G.scrollTop);if(z>0){const J=window.innerHeight-Qa*2,X=parseFloat(Y.style.minHeight),tt=parseFloat(Y.style.height),dt=Math.max(X,tt);if(dt<J){const pt=dt+z,ot=Math.min(J,pt),bt=pt-ot;Y.style.height=ot+"px",Y.style.bottom==="0px"&&(G.scrollTop=bt>0?bt:0,Y.style.justifyContent="flex-end")}}}V.current=G.scrollTop})})})]})});sG.displayName=MN;var oG="SelectGroup",[xtt,Utt]=GE(oG),Vtt=Z.forwardRef((d,f)=>{const{__scopeSelect:_,...g}=d,R=QN();return Rt.jsx(xtt,{scope:_,id:R,children:Rt.jsx(tr.div,{role:"group","aria-labelledby":R,...g,ref:f})})});Vtt.displayName=oG;var aG="SelectLabel",cG=Z.forwardRef((d,f)=>{const{__scopeSelect:_,...g}=d,R=Utt(aG,_);return Rt.jsx(tr.div,{id:R.id,...g,ref:f})});cG.displayName=aG;var PC="SelectItem",[Btt,lG]=GE(PC),dG=Z.forwardRef((d,f)=>{const{__scopeSelect:_,value:g,disabled:R=!1,textValue:w,...N}=d,L=ku(PC,_),V=Mu(PC,_),x=L.value===g,[G,Y]=Z.useState(w??""),[et,z]=Z.useState(!1),J=zr(f,pt=>{var ot;return(ot=V.itemRefCallback)==null?void 0:ot.call(V,pt,g,R)}),X=QN(),tt=Z.useRef("touch"),dt=()=>{R||(L.onValueChange(g),L.onOpenChange(!1))};if(g==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return Rt.jsx(Btt,{scope:_,value:g,disabled:R,textId:X,isSelected:x,onItemTextChange:Z.useCallback(pt=>{Y(ot=>ot||((pt==null?void 0:pt.textContent)??"").trim())},[]),children:Rt.jsx(XC.ItemSlot,{scope:_,value:g,disabled:R,textValue:G,children:Rt.jsx(tr.div,{role:"option","aria-labelledby":X,"data-highlighted":et?"":void 0,"aria-selected":x&&et,"data-state":x?"checked":"unchecked","aria-disabled":R||void 0,"data-disabled":R?"":void 0,tabIndex:R?void 0:-1,...N,ref:J,onFocus:ar(N.onFocus,()=>z(!0)),onBlur:ar(N.onBlur,()=>z(!1)),onClick:ar(N.onClick,()=>{tt.current!=="mouse"&&dt()}),onPointerUp:ar(N.onPointerUp,()=>{tt.current==="mouse"&&dt()}),onPointerDown:ar(N.onPointerDown,pt=>{tt.current=pt.pointerType}),onPointerMove:ar(N.onPointerMove,pt=>{var ot;tt.current=pt.pointerType,R?(ot=V.onItemLeave)==null||ot.call(V):tt.current==="mouse"&&pt.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ar(N.onPointerLeave,pt=>{var ot;pt.currentTarget===document.activeElement&&((ot=V.onItemLeave)==null||ot.call(V))}),onKeyDown:ar(N.onKeyDown,pt=>{var bt;((bt=V.searchRef)==null?void 0:bt.current)!==""&&pt.key===" "||(Ctt.includes(pt.key)&&dt(),pt.key===" "&&pt.preventDefault())})})})})});dG.displayName=PC;var qS="SelectItemText",uG=Z.forwardRef((d,f)=>{const{__scopeSelect:_,className:g,style:R,...w}=d,N=ku(qS,_),L=Mu(qS,_),V=lG(qS,_),x=Ott(qS,_),[G,Y]=Z.useState(null),et=zr(f,dt=>Y(dt),V.onItemTextChange,dt=>{var pt;return(pt=L.itemTextRefCallback)==null?void 0:pt.call(L,dt,V.value,V.disabled)}),z=G==null?void 0:G.textContent,J=Z.useMemo(()=>Rt.jsx("option",{value:V.value,disabled:V.disabled,children:z},V.value),[V.disabled,V.value,z]),{onNativeOptionAdd:X,onNativeOptionRemove:tt}=x;return wo(()=>(X(J),()=>tt(J)),[X,tt,J]),Rt.jsxs(Rt.Fragment,{children:[Rt.jsx(tr.span,{id:V.textId,...w,ref:et}),V.isSelected&&N.valueNode&&!N.valueNodeHasChildren?eT.createPortal(w.children,N.valueNode):null]})});uG.displayName=qS;var hG="SelectItemIndicator",pG=Z.forwardRef((d,f)=>{const{__scopeSelect:_,...g}=d;return lG(hG,_).isSelected?Rt.jsx(tr.span,{"aria-hidden":!0,...g,ref:f}):null});pG.displayName=hG;var xN="SelectScrollUpButton",fG=Z.forwardRef((d,f)=>{const _=Mu(xN,d.__scopeSelect),g=aD(xN,d.__scopeSelect),[R,w]=Z.useState(!1),N=zr(f,g.onScrollButtonChange);return wo(()=>{if(_.viewport&&_.isPositioned){let L=function(){const x=V.scrollTop>0;w(x)};const V=_.viewport;return L(),V.addEventListener("scroll",L),()=>V.removeEventListener("scroll",L)}},[_.viewport,_.isPositioned]),R?Rt.jsx(EG,{...d,ref:N,onAutoScroll:()=>{const{viewport:L,selectedItem:V}=_;L&&V&&(L.scrollTop=L.scrollTop-V.offsetHeight)}}):null});fG.displayName=xN;var UN="SelectScrollDownButton",mG=Z.forwardRef((d,f)=>{const _=Mu(UN,d.__scopeSelect),g=aD(UN,d.__scopeSelect),[R,w]=Z.useState(!1),N=zr(f,g.onScrollButtonChange);return wo(()=>{if(_.viewport&&_.isPositioned){let L=function(){const x=V.scrollHeight-V.clientHeight,G=Math.ceil(V.scrollTop)<x;w(G)};const V=_.viewport;return L(),V.addEventListener("scroll",L),()=>V.removeEventListener("scroll",L)}},[_.viewport,_.isPositioned]),R?Rt.jsx(EG,{...d,ref:N,onAutoScroll:()=>{const{viewport:L,selectedItem:V}=_;L&&V&&(L.scrollTop=L.scrollTop+V.offsetHeight)}}):null});mG.displayName=UN;var EG=Z.forwardRef((d,f)=>{const{__scopeSelect:_,onAutoScroll:g,...R}=d,w=Mu("SelectScrollButton",_),N=Z.useRef(null),L=JC(_),V=Z.useCallback(()=>{N.current!==null&&(window.clearInterval(N.current),N.current=null)},[]);return Z.useEffect(()=>()=>V(),[V]),wo(()=>{var G;const x=L().find(Y=>Y.ref.current===document.activeElement);(G=x==null?void 0:x.ref.current)==null||G.scrollIntoView({block:"nearest"})},[L]),Rt.jsx(tr.div,{"aria-hidden":!0,...R,ref:f,style:{flexShrink:0,...R.style},onPointerDown:ar(R.onPointerDown,()=>{N.current===null&&(N.current=window.setInterval(g,50))}),onPointerMove:ar(R.onPointerMove,()=>{var x;(x=w.onItemLeave)==null||x.call(w),N.current===null&&(N.current=window.setInterval(g,50))}),onPointerLeave:ar(R.onPointerLeave,()=>{V()})})}),jtt="SelectSeparator",_G=Z.forwardRef((d,f)=>{const{__scopeSelect:_,...g}=d;return Rt.jsx(tr.div,{"aria-hidden":!0,...g,ref:f})});_G.displayName=jtt;var VN="SelectArrow",Ftt=Z.forwardRef((d,f)=>{const{__scopeSelect:_,...g}=d,R=QC(_),w=ku(VN,_),N=Mu(VN,_);return w.open&&N.position==="popper"?Rt.jsx(L$,{...R,...g,ref:f}):null});Ftt.displayName=VN;function gG(d){return d===""||d===void 0}var SG=Z.forwardRef((d,f)=>{const{value:_,...g}=d,R=Z.useRef(null),w=zr(f,R),N=x$(_);return Z.useEffect(()=>{const L=R.current,V=window.HTMLSelectElement.prototype,G=Object.getOwnPropertyDescriptor(V,"value").set;if(N!==_&&G){const Y=new Event("change",{bubbles:!0});G.call(L,_),L.dispatchEvent(Y)}},[N,_]),Rt.jsx(V5,{asChild:!0,children:Rt.jsx("select",{...g,ref:w,defaultValue:_})})});SG.displayName="BubbleSelect";function TG(d){const f=ld(d),_=Z.useRef(""),g=Z.useRef(0),R=Z.useCallback(N=>{const L=_.current+N;f(L),function V(x){_.current=x,window.clearTimeout(g.current),x!==""&&(g.current=window.setTimeout(()=>V(""),1e3))}(L)},[f]),w=Z.useCallback(()=>{_.current="",window.clearTimeout(g.current)},[]);return Z.useEffect(()=>()=>window.clearTimeout(g.current),[]),[_,R,w]}function vG(d,f,_){const R=f.length>1&&Array.from(f).every(x=>x===f[0])?f[0]:f,w=_?d.indexOf(_):-1;let N=Gtt(d,Math.max(w,0));R.length===1&&(N=N.filter(x=>x!==_));const V=N.find(x=>x.textValue.toLowerCase().startsWith(R.toLowerCase()));return V!==_?V:void 0}function Gtt(d,f){return d.map((_,g)=>d[(f+g)%d.length])}var Htt=q5,yG=J5,Wtt=Z5,Ktt=$5,ztt=tG,RG=eG,Ytt=sG,bG=cG,CG=dG,qtt=uG,Xtt=pG,AG=fG,wG=mG,IG=_G;const Jtt=Htt,Qtt=Wtt,OG=Z.forwardRef(({className:d,children:f,..._},g)=>Rt.jsxs(yG,{ref:g,className:Dr("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",d),..._,children:[f,Rt.jsx(Ktt,{asChild:!0,children:Rt.jsx(Q3,{className:"h-4 w-4 opacity-50"})})]}));OG.displayName=yG.displayName;const NG=Z.forwardRef(({className:d,...f},_)=>Rt.jsx(AG,{ref:_,className:Dr("flex cursor-default items-center justify-center py-1",d),...f,children:Rt.jsx(dQ,{className:"h-4 w-4"})}));NG.displayName=AG.displayName;const DG=Z.forwardRef(({className:d,...f},_)=>Rt.jsx(wG,{ref:_,className:Dr("flex cursor-default items-center justify-center py-1",d),...f,children:Rt.jsx(Q3,{className:"h-4 w-4"})}));DG.displayName=wG.displayName;const PG=Z.forwardRef(({className:d,children:f,position:_="popper",...g},R)=>Rt.jsx(ztt,{children:Rt.jsxs(RG,{ref:R,className:Dr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",_==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",d),position:_,...g,children:[Rt.jsx(NG,{}),Rt.jsx(Ytt,{className:Dr("p-1",_==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:f}),Rt.jsx(DG,{})]})}));PG.displayName=RG.displayName;const Ztt=Z.forwardRef(({className:d,...f},_)=>Rt.jsx(bG,{ref:_,className:Dr("px-2 py-1.5 text-sm font-semibold",d),...f}));Ztt.displayName=bG.displayName;const LG=Z.forwardRef(({className:d,children:f,..._},g)=>Rt.jsxs(CG,{ref:g,className:Dr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",d),..._,children:[Rt.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:Rt.jsx(Xtt,{children:Rt.jsx(aQ,{className:"h-4 w-4"})})}),Rt.jsx(qtt,{children:f})]}));LG.displayName=CG.displayName;const $tt=Z.forwardRef(({className:d,...f},_)=>Rt.jsx(IG,{ref:_,className:Dr("-mx-1 my-1 h-px bg-muted",d),...f}));$tt.displayName=IG.displayName;const tet=d=>{const{active:f,color:_,...g}=d;return f?Rt.jsx(EQ,{color:_||"#3D53F5",...g}):Rt.jsx(fQ,{color:_||"#667085",...g})};function eet(d){const{audioTrack:f}=d,[_,g]=Z.useState(!1),[R,w]=Z.useState();Z.useEffect(()=>(f==null||f.on("track-updated",L),f&&w(f.getMediaStreamTrack()),()=>{f==null||f.off("track-updated",L)}),[f]),Z.useEffect(()=>{f==null||f.setMuted(_)},[f,_]);const N=X3(R,10),L=x=>{console.log("[test] audio track updated",x),w(x)},V=()=>{g(!_)};return Rt.jsx(net,{title:"",Icon:tet,onIconClick:V,isActive:!_,select:Rt.jsx(ret,{audioTrack:f}),children:Rt.jsx("div",{className:"flex flex-1 flex-col items-center justify-center self-stretch rounded-md",children:Rt.jsx(d5,{className:"bg-primary",barWidth:2,minBarHeight:2,maxBarHeight:20,frequencies:N,borderRadius:2,gap:2})})})}function net(d){const{title:f,Icon:_,onIconClick:g,isActive:R,select:w,children:N}=d;return Rt.jsx("div",{className:"flex flex-col",children:Rt.jsx("div",{className:"flex items-center justify-between",children:Rt.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[Rt.jsxs(XS,{variant:"outline",className:"border-secondary bg-transparent",onClick:g,children:[Rt.jsx(_,{className:"h-5 w-5",active:R}),N]}),Rt.jsx("div",{className:"flex flex-1 w-[100px]",children:w})]})})})}const iet=d=>{const{items:f,value:_,onChange:g,placeholder:R}=d;return Rt.jsxs(Jtt,{value:_,onValueChange:g,children:[Rt.jsx(OG,{className:"flex-1",children:Rt.jsx(Qtt,{placeholder:R})}),Rt.jsx(PG,{children:f.map(w=>Rt.jsx(LG,{value:w.value,children:w.label},w.value))})]})},ret=d=>{const f=q3(),_=yN(L=>L.global.selectedMicrophone),{audioTrack:g}=d,[R,w]=Z.useState([]);Z.useEffect(()=>{zS.getMicrophones().then(L=>{w(L.map(V=>({label:V.label,value:V.label,deviceId:V.deviceId}))),f(yF({label:L[0].label,deviceId:L[0].deviceId,value:L[0].label}))})},[f]);const N=async L=>{const V=R.find(x=>x.value===L);V&&(f(yF(V)),g&&await g.setDevice(V.deviceId))};return Rt.jsx(iet,{items:R,value:_.label,onChange:N})};function set(d){const{audioTrack:f}=d,_=X3(f,20);return Rt.jsx("div",{className:Dr("flex h-auto w-full flex-col items-center justify-center"),children:Rt.jsx("div",{className:"h-14 w-full",children:Rt.jsx(d5,{className:"bg-secondary",frequencies:_,barWidth:2,minBarHeight:2,maxBarHeight:10,borderRadius:2,gap:2})})})}var oet=d=>{switch(d){case"success":return det;case"info":return het;case"warning":return uet;case"error":return pet;default:return null}},aet=Array(12).fill(0),cet=({visible:d,className:f})=>re.createElement("div",{className:["sonner-loading-wrapper",f].filter(Boolean).join(" "),"data-visible":d},re.createElement("div",{className:"sonner-spinner"},aet.map((_,g)=>re.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${g}`})))),det=re.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},re.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),uet=re.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},re.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),het=re.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},re.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),pet=re.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},re.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),fet=re.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},re.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),re.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),met=()=>{let[d,f]=re.useState(document.hidden);return re.useEffect(()=>{let _=()=>{f(document.hidden)};return document.addEventListener("visibilitychange",_),()=>window.removeEventListener("visibilitychange",_)},[]),d},BN=1,Eet=class{constructor(){this.subscribe=d=>(this.subscribers.push(d),()=>{let f=this.subscribers.indexOf(d);this.subscribers.splice(f,1)}),this.publish=d=>{this.subscribers.forEach(f=>f(d))},this.addToast=d=>{this.publish(d),this.toasts=[...this.toasts,d]},this.create=d=>{var f;let{message:_,...g}=d,R=typeof(d==null?void 0:d.id)=="number"||((f=d.id)==null?void 0:f.length)>0?d.id:BN++,w=this.toasts.find(L=>L.id===R),N=d.dismissible===void 0?!0:d.dismissible;return this.dismissedToasts.has(R)&&this.dismissedToasts.delete(R),w?this.toasts=this.toasts.map(L=>L.id===R?(this.publish({...L,...d,id:R,title:_}),{...L,...d,id:R,dismissible:N,title:_}):L):this.addToast({title:_,...g,dismissible:N,id:R}),R},this.dismiss=d=>(this.dismissedToasts.add(d),d||this.toasts.forEach(f=>{this.subscribers.forEach(_=>_({id:f.id,dismiss:!0}))}),this.subscribers.forEach(f=>f({id:d,dismiss:!0})),d),this.message=(d,f)=>this.create({...f,message:d}),this.error=(d,f)=>this.create({...f,message:d,type:"error"}),this.success=(d,f)=>this.create({...f,type:"success",message:d}),this.info=(d,f)=>this.create({...f,type:"info",message:d}),this.warning=(d,f)=>this.create({...f,type:"warning",message:d}),this.loading=(d,f)=>this.create({...f,type:"loading",message:d}),this.promise=(d,f)=>{if(!f)return;let _;f.loading!==void 0&&(_=this.create({...f,promise:d,type:"loading",message:f.loading,description:typeof f.description!="function"?f.description:void 0}));let g=d instanceof Promise?d:d(),R=_!==void 0,w,N=g.then(async V=>{if(w=["resolve",V],re.isValidElement(V))R=!1,this.create({id:_,type:"default",message:V});else if(get(V)&&!V.ok){R=!1;let x=typeof f.error=="function"?await f.error(`HTTP error! status: ${V.status}`):f.error,G=typeof f.description=="function"?await f.description(`HTTP error! status: ${V.status}`):f.description;this.create({id:_,type:"error",message:x,description:G})}else if(f.success!==void 0){R=!1;let x=typeof f.success=="function"?await f.success(V):f.success,G=typeof f.description=="function"?await f.description(V):f.description;this.create({id:_,type:"success",message:x,description:G})}}).catch(async V=>{if(w=["reject",V],f.error!==void 0){R=!1;let x=typeof f.error=="function"?await f.error(V):f.error,G=typeof f.description=="function"?await f.description(V):f.description;this.create({id:_,type:"error",message:x,description:G})}}).finally(()=>{var V;R&&(this.dismiss(_),_=void 0),(V=f.finally)==null||V.call(f)}),L=()=>new Promise((V,x)=>N.then(()=>w[0]==="reject"?x(w[1]):V(w[1])).catch(x));return typeof _!="string"&&typeof _!="number"?{unwrap:L}:Object.assign(_,{unwrap:L})},this.custom=(d,f)=>{let _=(f==null?void 0:f.id)||BN++;return this.create({jsx:d(_),id:_,...f}),_},this.getActiveToasts=()=>this.toasts.filter(d=>!this.dismissedToasts.has(d.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Zs=new Eet,_et=(d,f)=>{let _=(f==null?void 0:f.id)||BN++;return Zs.addToast({title:d,...f,id:_}),_},get=d=>d&&typeof d=="object"&&"ok"in d&&typeof d.ok=="boolean"&&"status"in d&&typeof d.status=="number",Tet=_et,vet=()=>Zs.toasts,yet=()=>Zs.getActiveToasts(),Iu=Object.assign(Tet,{success:Zs.success,info:Zs.info,warning:Zs.warning,error:Zs.error,custom:Zs.custom,message:Zs.message,promise:Zs.promise,dismiss:Zs.dismiss,loading:Zs.loading},{getHistory:vet,getToasts:yet});function Ret(d,{insertAt:f}={}){if(typeof document>"u")return;let _=document.head||document.getElementsByTagName("head")[0],g=document.createElement("style");g.type="text/css",f==="top"&&_.firstChild?_.insertBefore(g,_.firstChild):_.appendChild(g),g.styleSheet?g.styleSheet.cssText=d:g.appendChild(document.createTextNode(d))}Ret(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function pC(d){return d.label!==void 0}var bet=3,Cet="32px",Aet="16px",KF=4e3,wet=356,Iet=14,Oet=20,Net=200;function Ja(...d){return d.filter(Boolean).join(" ")}function Det(d){let[f,_]=d.split("-"),g=[];return f&&g.push(f),_&&g.push(_),g}var Pet=d=>{var f,_,g,R,w,N,L,V,x,G,Y;let{invert:et,toast:z,unstyled:J,interacting:X,setHeights:tt,visibleToasts:dt,heights:pt,index:ot,toasts:bt,expanded:St,removeToast:Ft,defaultRichColors:Bt,closeButton:se,style:Jt,cancelButtonStyle:ae,actionButtonStyle:we,className:de="",descriptionClassName:Re="",duration:Zt,position:Ae,gap:It,loadingIcon:Gt,expandByDefault:Nt,classNames:Yt,icons:st,closeButtonAriaLabel:xt="Close toast",pauseWhenPageIsHidden:Qt}=d,[ee,zt]=re.useState(null),[ve,ye]=re.useState(null),[te,_e]=re.useState(!1),[Le,Se]=re.useState(!1),[ze,ln]=re.useState(!1),[Pn,cr]=re.useState(!1),[ws,Ii]=re.useState(!1),[to,pi]=re.useState(0),[Oi,nc]=re.useState(0),eo=re.useRef(z.duration||Zt||KF),Up=re.useRef(null),Io=re.useRef(null),Wn=ot===0,Vp=ot+1<=dt,gr=z.type,lr=z.dismissible!==!1,ul=z.className||"",xu=z.descriptionClassName||"",ic=re.useMemo(()=>pt.findIndex(je=>je.toastId===z.id)||0,[pt,z.id]),Bp=re.useMemo(()=>{var je;return(je=z.closeButton)!=null?je:se},[z.closeButton,se]),Uu=re.useMemo(()=>z.duration||Zt||KF,[z.duration,Zt]),Oo=re.useRef(0),oi=re.useRef(0),Vu=re.useRef(0),Pr=re.useRef(null),[Lr,rc]=Ae.split("-"),Bu=re.useMemo(()=>pt.reduce((je,Tn,Qn)=>Qn>=ic?je:je+Tn.height,0),[pt,ic]),jp=met(),hd=z.invert||et,sc=gr==="loading";oi.current=re.useMemo(()=>ic*It+Bu,[ic,Bu]),re.useEffect(()=>{eo.current=Uu},[Uu]),re.useEffect(()=>{_e(!0)},[]),re.useEffect(()=>{let je=Io.current;if(je){let Tn=je.getBoundingClientRect().height;return nc(Tn),tt(Qn=>[{toastId:z.id,height:Tn,position:z.position},...Qn]),()=>tt(Qn=>Qn.filter(Yr=>Yr.toastId!==z.id))}},[tt,z.id]),re.useLayoutEffect(()=>{if(!te)return;let je=Io.current,Tn=je.style.height;je.style.height="auto";let Qn=je.getBoundingClientRect().height;je.style.height=Tn,nc(Qn),tt(Yr=>Yr.find(kr=>kr.toastId===z.id)?Yr.map(kr=>kr.toastId===z.id?{...kr,height:Qn}:kr):[{toastId:z.id,height:Qn,position:z.position},...Yr])},[te,z.title,z.description,tt,z.id]);let Sr=re.useCallback(()=>{Se(!0),pi(oi.current),tt(je=>je.filter(Tn=>Tn.toastId!==z.id)),setTimeout(()=>{Ft(z)},Net)},[z,Ft,tt,oi]);re.useEffect(()=>{if(z.promise&&gr==="loading"||z.duration===1/0||z.type==="loading")return;let je;return St||X||Qt&&jp?(()=>{if(Vu.current<Oo.current){let Tn=new Date().getTime()-Oo.current;eo.current=eo.current-Tn}Vu.current=new Date().getTime()})():eo.current!==1/0&&(Oo.current=new Date().getTime(),je=setTimeout(()=>{var Tn;(Tn=z.onAutoClose)==null||Tn.call(z,z),Sr()},eo.current)),()=>clearTimeout(je)},[St,X,z,gr,Qt,jp,Sr]),re.useEffect(()=>{z.delete&&Sr()},[Sr,z.delete]);function No(){var je,Tn,Qn;return st!=null&&st.loading?re.createElement("div",{className:Ja(Yt==null?void 0:Yt.loader,(je=z==null?void 0:z.classNames)==null?void 0:je.loader,"sonner-loader"),"data-visible":gr==="loading"},st.loading):Gt?re.createElement("div",{className:Ja(Yt==null?void 0:Yt.loader,(Tn=z==null?void 0:z.classNames)==null?void 0:Tn.loader,"sonner-loader"),"data-visible":gr==="loading"},Gt):re.createElement(cet,{className:Ja(Yt==null?void 0:Yt.loader,(Qn=z==null?void 0:z.classNames)==null?void 0:Qn.loader),visible:gr==="loading"})}return re.createElement("li",{tabIndex:0,ref:Io,className:Ja(de,ul,Yt==null?void 0:Yt.toast,(f=z==null?void 0:z.classNames)==null?void 0:f.toast,Yt==null?void 0:Yt.default,Yt==null?void 0:Yt[gr],(_=z==null?void 0:z.classNames)==null?void 0:_[gr]),"data-sonner-toast":"","data-rich-colors":(g=z.richColors)!=null?g:Bt,"data-styled":!(z.jsx||z.unstyled||J),"data-mounted":te,"data-promise":!!z.promise,"data-swiped":ws,"data-removed":Le,"data-visible":Vp,"data-y-position":Lr,"data-x-position":rc,"data-index":ot,"data-front":Wn,"data-swiping":ze,"data-dismissible":lr,"data-type":gr,"data-invert":hd,"data-swipe-out":Pn,"data-swipe-direction":ve,"data-expanded":!!(St||Nt&&te),style:{"--index":ot,"--toasts-before":ot,"--z-index":bt.length-ot,"--offset":`${Le?to:oi.current}px`,"--initial-height":Nt?"auto":`${Oi}px`,...Jt,...z.style},onDragEnd:()=>{ln(!1),zt(null),Pr.current=null},onPointerDown:je=>{sc||!lr||(Up.current=new Date,pi(oi.current),je.target.setPointerCapture(je.pointerId),je.target.tagName!=="BUTTON"&&(ln(!0),Pr.current={x:je.clientX,y:je.clientY}))},onPointerUp:()=>{var je,Tn,Qn,Yr;if(Pn||!lr)return;Pr.current=null;let kr=Number(((je=Io.current)==null?void 0:je.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Zn=Number(((Tn=Io.current)==null?void 0:Tn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ha=new Date().getTime()-((Qn=Up.current)==null?void 0:Qn.getTime()),qr=ee==="x"?kr:Zn,Xr=Math.abs(qr)/ha;if(Math.abs(qr)>=Oet||Xr>.11){pi(oi.current),(Yr=z.onDismiss)==null||Yr.call(z,z),ye(ee==="x"?kr>0?"right":"left":Zn>0?"down":"up"),Sr(),cr(!0),Ii(!1);return}ln(!1),zt(null)},onPointerMove:je=>{var Tn,Qn,Yr,kr;if(!Pr.current||!lr||((Tn=window.getSelection())==null?void 0:Tn.toString().length)>0)return;let Zn=je.clientY-Pr.current.y,ha=je.clientX-Pr.current.x,qr=(Qn=d.swipeDirections)!=null?Qn:Det(Ae);!ee&&(Math.abs(ha)>1||Math.abs(Zn)>1)&&zt(Math.abs(ha)>Math.abs(Zn)?"x":"y");let Xr={x:0,y:0};ee==="y"?(qr.includes("top")||qr.includes("bottom"))&&(qr.includes("top")&&Zn<0||qr.includes("bottom")&&Zn>0)&&(Xr.y=Zn):ee==="x"&&(qr.includes("left")||qr.includes("right"))&&(qr.includes("left")&&ha<0||qr.includes("right")&&ha>0)&&(Xr.x=ha),(Math.abs(Xr.x)>0||Math.abs(Xr.y)>0)&&Ii(!0),(Yr=Io.current)==null||Yr.style.setProperty("--swipe-amount-x",`${Xr.x}px`),(kr=Io.current)==null||kr.style.setProperty("--swipe-amount-y",`${Xr.y}px`)}},Bp&&!z.jsx?re.createElement("button",{"aria-label":xt,"data-disabled":sc,"data-close-button":!0,onClick:sc||!lr?()=>{}:()=>{var je;Sr(),(je=z.onDismiss)==null||je.call(z,z)},className:Ja(Yt==null?void 0:Yt.closeButton,(R=z==null?void 0:z.classNames)==null?void 0:R.closeButton)},(w=st==null?void 0:st.close)!=null?w:fet):null,z.jsx||Z.isValidElement(z.title)?z.jsx?z.jsx:typeof z.title=="function"?z.title():z.title:re.createElement(re.Fragment,null,gr||z.icon||z.promise?re.createElement("div",{"data-icon":"",className:Ja(Yt==null?void 0:Yt.icon,(N=z==null?void 0:z.classNames)==null?void 0:N.icon)},z.promise||z.type==="loading"&&!z.icon?z.icon||No():null,z.type!=="loading"?z.icon||(st==null?void 0:st[gr])||oet(gr):null):null,re.createElement("div",{"data-content":"",className:Ja(Yt==null?void 0:Yt.content,(L=z==null?void 0:z.classNames)==null?void 0:L.content)},re.createElement("div",{"data-title":"",className:Ja(Yt==null?void 0:Yt.title,(V=z==null?void 0:z.classNames)==null?void 0:V.title)},typeof z.title=="function"?z.title():z.title),z.description?re.createElement("div",{"data-description":"",className:Ja(Re,xu,Yt==null?void 0:Yt.description,(x=z==null?void 0:z.classNames)==null?void 0:x.description)},typeof z.description=="function"?z.description():z.description):null),Z.isValidElement(z.cancel)?z.cancel:z.cancel&&pC(z.cancel)?re.createElement("button",{"data-button":!0,"data-cancel":!0,style:z.cancelButtonStyle||ae,onClick:je=>{var Tn,Qn;pC(z.cancel)&&lr&&((Qn=(Tn=z.cancel).onClick)==null||Qn.call(Tn,je),Sr())},className:Ja(Yt==null?void 0:Yt.cancelButton,(G=z==null?void 0:z.classNames)==null?void 0:G.cancelButton)},z.cancel.label):null,Z.isValidElement(z.action)?z.action:z.action&&pC(z.action)?re.createElement("button",{"data-button":!0,"data-action":!0,style:z.actionButtonStyle||we,onClick:je=>{var Tn,Qn;pC(z.action)&&((Qn=(Tn=z.action).onClick)==null||Qn.call(Tn,je),!je.defaultPrevented&&Sr())},className:Ja(Yt==null?void 0:Yt.actionButton,(Y=z==null?void 0:z.classNames)==null?void 0:Y.actionButton)},z.action.label):null))};function zF(){if(typeof window>"u"||typeof document>"u")return"ltr";let d=document.documentElement.getAttribute("dir");return d==="auto"||!d?window.getComputedStyle(document.documentElement).direction:d}function Let(d,f){let _={};return[d,f].forEach((g,R)=>{let w=R===1,N=w?"--mobile-offset":"--offset",L=w?Aet:Cet;function V(x){["top","right","bottom","left"].forEach(G=>{_[`${N}-${G}`]=typeof x=="number"?`${x}px`:x})}typeof g=="number"||typeof g=="string"?V(g):typeof g=="object"?["top","right","bottom","left"].forEach(x=>{g[x]===void 0?_[`${N}-${x}`]=L:_[`${N}-${x}`]=typeof g[x]=="number"?`${g[x]}px`:g[x]}):V(L)}),_}var ket=Z.forwardRef(function(d,f){let{invert:_,position:g="bottom-right",hotkey:R=["altKey","KeyT"],expand:w,closeButton:N,className:L,offset:V,mobileOffset:x,theme:G="light",richColors:Y,duration:et,style:z,visibleToasts:J=bet,toastOptions:X,dir:tt=zF(),gap:dt=Iet,loadingIcon:pt,icons:ot,containerAriaLabel:bt="Notifications",pauseWhenPageIsHidden:St}=d,[Ft,Bt]=re.useState([]),se=re.useMemo(()=>Array.from(new Set([g].concat(Ft.filter(Qt=>Qt.position).map(Qt=>Qt.position)))),[Ft,g]),[Jt,ae]=re.useState([]),[we,de]=re.useState(!1),[Re,Zt]=re.useState(!1),[Ae,It]=re.useState(G!=="system"?G:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Gt=re.useRef(null),Nt=R.join("+").replace(/Key/g,"").replace(/Digit/g,""),Yt=re.useRef(null),st=re.useRef(!1),xt=re.useCallback(Qt=>{Bt(ee=>{var zt;return(zt=ee.find(ve=>ve.id===Qt.id))!=null&&zt.delete||Zs.dismiss(Qt.id),ee.filter(({id:ve})=>ve!==Qt.id)})},[]);return re.useEffect(()=>Zs.subscribe(Qt=>{if(Qt.dismiss){Bt(ee=>ee.map(zt=>zt.id===Qt.id?{...zt,delete:!0}:zt));return}setTimeout(()=>{p3.flushSync(()=>{Bt(ee=>{let zt=ee.findIndex(ve=>ve.id===Qt.id);return zt!==-1?[...ee.slice(0,zt),{...ee[zt],...Qt},...ee.slice(zt+1)]:[Qt,...ee]})})})}),[]),re.useEffect(()=>{if(G!=="system"){It(G);return}if(G==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?It("dark"):It("light")),typeof window>"u")return;let Qt=window.matchMedia("(prefers-color-scheme: dark)");try{Qt.addEventListener("change",({matches:ee})=>{It(ee?"dark":"light")})}catch{Qt.addListener(({matches:zt})=>{try{It(zt?"dark":"light")}catch(ve){console.error(ve)}})}},[G]),re.useEffect(()=>{Ft.length<=1&&de(!1)},[Ft]),re.useEffect(()=>{let Qt=ee=>{var zt,ve;R.every(ye=>ee[ye]||ee.code===ye)&&(de(!0),(zt=Gt.current)==null||zt.focus()),ee.code==="Escape"&&(document.activeElement===Gt.current||(ve=Gt.current)!=null&&ve.contains(document.activeElement))&&de(!1)};return document.addEventListener("keydown",Qt),()=>document.removeEventListener("keydown",Qt)},[R]),re.useEffect(()=>{if(Gt.current)return()=>{Yt.current&&(Yt.current.focus({preventScroll:!0}),Yt.current=null,st.current=!1)}},[Gt.current]),re.createElement("section",{ref:f,"aria-label":`${bt} ${Nt}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},se.map((Qt,ee)=>{var zt;let[ve,ye]=Qt.split("-");return Ft.length?re.createElement("ol",{key:Qt,dir:tt==="auto"?zF():tt,tabIndex:-1,ref:Gt,className:L,"data-sonner-toaster":!0,"data-theme":Ae,"data-y-position":ve,"data-lifted":we&&Ft.length>1&&!w,"data-x-position":ye,style:{"--front-toast-height":`${((zt=Jt[0])==null?void 0:zt.height)||0}px`,"--width":`${wet}px`,"--gap":`${dt}px`,...z,...Let(V,x)},onBlur:te=>{st.current&&!te.currentTarget.contains(te.relatedTarget)&&(st.current=!1,Yt.current&&(Yt.current.focus({preventScroll:!0}),Yt.current=null))},onFocus:te=>{te.target instanceof HTMLElement&&te.target.dataset.dismissible==="false"||st.current||(st.current=!0,Yt.current=te.relatedTarget)},onMouseEnter:()=>de(!0),onMouseMove:()=>de(!0),onMouseLeave:()=>{Re||de(!1)},onDragEnd:()=>de(!1),onPointerDown:te=>{te.target instanceof HTMLElement&&te.target.dataset.dismissible==="false"||Zt(!0)},onPointerUp:()=>Zt(!1)},Ft.filter(te=>!te.position&&ee===0||te.position===Qt).map((te,_e)=>{var Le,Se;return re.createElement(Pet,{key:te.id,icons:ot,index:_e,toast:te,defaultRichColors:Y,duration:(Le=X==null?void 0:X.duration)!=null?Le:et,className:X==null?void 0:X.className,descriptionClassName:X==null?void 0:X.descriptionClassName,invert:_,visibleToasts:J,closeButton:(Se=X==null?void 0:X.closeButton)!=null?Se:N,interacting:Re,position:Qt,style:X==null?void 0:X.style,unstyled:X==null?void 0:X.unstyled,classNames:X==null?void 0:X.classNames,cancelButtonStyle:X==null?void 0:X.cancelButtonStyle,actionButtonStyle:X==null?void 0:X.actionButtonStyle,removeToast:xt,toasts:Ft.filter(ze=>ze.position==te.position),heights:Jt.filter(ze=>ze.position==te.position),setHeights:ae,expandByDefault:w,gap:dt,loadingIcon:pt,expanded:we,pauseWhenPageIsHidden:St,swipeDirections:d.swipeDirections})})):null}))});function Met(){const d=q3(),[f]=Z.useState(`${Math.random().toString(36).substring(4)}`),[_,g]=Z.useState(!1),[R,w]=Z.useState(""),[N,L]=Z.useState(void 0),[V,x]=Z.useState(),G=yN(ot=>ot.global.agentConnected),Y=yN(ot=>ot.global.selectedMicrophone),et=async()=>{wu.on("localTracksChanged",pt),wu.on("remoteUserChanged",dt),await wu.createMicrophoneAudioTrack(Y),await wu.join({channel:f,userId:0}),await wu.publish()},z=async()=>{wu.off("localTracksChanged",pt),wu.off("remoteUserChanged",dt),await wu.destroy()},J=async()=>{const{agent_id:ot}=await PJ({base_url:kC,channel:f});w(ot)},X=async()=>{await LJ(R),w("")},tt=async()=>{var ot,bt,St,Ft,Bt,se,Jt,ae,we,de,Re,Zt,Ae,It,Gt,Nt;if(g(!0),G)try{await Promise.all([z(),X()])}catch(Yt){d(vF(!G)),g(!1),Yt instanceof aF?(de=(we=Yt.response)==null?void 0:we.data)!=null&&de.detail?Iu.error(`Agent stop request failed: ${(Zt=(Re=Yt.response)==null?void 0:Re.data)==null?void 0:Zt.detail}`):(It=(Ae=Yt.response)==null?void 0:Ae.data)!=null&&It.message?Iu.error(`Agent stop request failed: ${(Nt=(Gt=Yt.response)==null?void 0:Gt.data)==null?void 0:Nt.message}`):Iu.error(`Agent stop request failed: ${Yt}`):Iu.error(`Failed to stop agent: ${Yt}`);return}else try{await Promise.all([et(),J()])}catch(Yt){g(!1),Yt instanceof aF?(bt=(ot=Yt.response)==null?void 0:ot.data)!=null&&bt.detail?Iu.error(`Agent start request failed: ${(Ft=(St=Yt.response)==null?void 0:St.data)==null?void 0:Ft.detail}`):(se=(Bt=Yt.response)==null?void 0:Bt.data)!=null&&se.message?Iu.error(`Agent start request failed: ${(ae=(Jt=Yt.response)==null?void 0:Jt.data)==null?void 0:ae.message}`):Iu.error(`Agent start request failed: ${Yt}`):Iu.error(`Failed to start agent: ${Yt}`);return}d(vF(!G)),g(!1)},dt=ot=>{console.log("[rtc] onRemoteUserChanged",ot),x(ot)},pt=ot=>{console.log("[rtc] onLocalTracksChanged",ot);const{audioTrack:bt}=ot;bt&&L(bt)};return Rt.jsxs(o3,{className:"w-[350px]",children:[Rt.jsxs(a3,{children:[Rt.jsx(c3,{children:"Dify & Agora Conversational AI Agent"}),Rt.jsx(l3,{children:"Talk to Dify, with your voice."})]}),Rt.jsx(d3,{children:Rt.jsxs("div",{className:"grid w-full items-center gap-4",children:[Rt.jsxs("div",{className:"flex flex-col space-y-1.5",children:[Rt.jsx(E3,{htmlFor:"name",children:"Agent Channel"}),Rt.jsx(h3,{id:"name",placeholder:"Name of your project",value:f})]}),Rt.jsx("div",{className:"flex flex-col space-y-1.5",children:Rt.jsx(eet,{audioTrack:N})})]})}),Rt.jsx(u3,{className:"flex justify-between",children:_?Rt.jsxs(XS,{disabled:!0,children:[Rt.jsx(hQ,{className:"animate-spin"}),"Please wait"]}):G?Rt.jsxs(XS,{onClick:tt,variant:"destructive",children:["Stop",Rt.jsx(set,{audioTrack:V==null?void 0:V.audioTrack})]}):Rt.jsx(XS,{onClick:tt,children:"Talk"})})]})}function xet({children:d}){const f=Z.useRef(null);return f.current||(f.current=Uet()),Rt.jsx(QJ,{store:f.current,children:d})}const Uet=()=>FQ({reducer:{global:eZ},devTools:!1});var Vet=(d,f,_,g,R,w,N,L)=>{let V=document.documentElement,x=["light","dark"];function G(z){(Array.isArray(d)?d:[d]).forEach(J=>{let X=J==="class",tt=X&&w?R.map(dt=>w[dt]||dt):R;X?(V.classList.remove(...tt),V.classList.add(w&&w[z]?w[z]:z)):V.setAttribute(J,z)}),Y(z)}function Y(z){L&&x.includes(z)&&(V.style.colorScheme=z)}function et(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(g)G(g);else try{let z=localStorage.getItem(f)||_,J=N&&z==="system"?et():z;G(J)}catch{}},Bet=Z.createContext(void 0),jet={setTheme:d=>{},themes:[]},Fet=()=>{var d;return(d=Z.useContext(Bet))!=null?d:jet};Z.memo(({forcedTheme:d,storageKey:f,attribute:_,enableSystem:g,enableColorScheme:R,defaultTheme:w,value:N,themes:L,nonce:V,scriptProps:x})=>{let G=JSON.stringify([_,f,w,d,L,N,g,R]).slice(1,-1);return Z.createElement("script",{...x,suppressHydrationWarning:!0,nonce:typeof window>"u"?V:"",dangerouslySetInnerHTML:{__html:`(${Vet.toString()})(${G})`}})});const Get=({...d})=>{const{theme:f="system"}=Fet();return Rt.jsx(ket,{theme:f,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...d})};J7.createRoot(document.getElementById("root")).render(Rt.jsxs(Z.StrictMode,{children:[Rt.jsx(xet,{children:Rt.jsx(Met,{})}),Rt.jsx(Get,{richColors:!0,closeButton:!0,theme:"dark"})]}));
