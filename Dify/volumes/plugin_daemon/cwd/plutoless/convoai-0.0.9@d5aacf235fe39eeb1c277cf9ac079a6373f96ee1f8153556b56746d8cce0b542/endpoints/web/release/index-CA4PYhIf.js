var I7=Object.defineProperty;var O7=(h,_,E)=>_ in h?I7(h,_,{enumerable:!0,configurable:!0,writable:!0,value:E}):h[_]=E;var jl=(h,_,E)=>O7(h,typeof _!="symbol"?_+"":_,E);function N7(h,_){for(var E=0;E<_.length;E++){const g=_[E];if(typeof g!="string"&&!Array.isArray(g)){for(const R in g)if(R!=="default"&&!(R in h)){const w=Object.getOwnPropertyDescriptor(g,R);w&&Object.defineProperty(h,R,w.get?w:{enumerable:!0,get:()=>g[R]})}}}return Object.freeze(Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}))}(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))g(R);new MutationObserver(R=>{for(const w of R)if(w.type==="childList")for(const N of w.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&g(N)}).observe(document,{childList:!0,subtree:!0});function E(R){const w={};return R.integrity&&(w.integrity=R.integrity),R.referrerPolicy&&(w.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?w.credentials="include":R.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function g(R){if(R.ep)return;R.ep=!0;const w=E(R);fetch(R.href,w)}})();var P0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function MN(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var L0={exports:{}},AS={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cj;function D7(){if(Cj)return AS;Cj=1;var h=Symbol.for("react.transitional.element"),_=Symbol.for("react.fragment");function E(g,R,w){var N=null;if(w!==void 0&&(N=""+w),R.key!==void 0&&(N=""+R.key),"key"in R){w={};for(var k in R)k!=="key"&&(w[k]=R[k])}else w=R;return R=w.ref,{$$typeof:h,type:g,key:N,ref:R!==void 0?R:null,props:w}}return AS.Fragment=_,AS.jsx=E,AS.jsxs=E,AS}var Aj;function P7(){return Aj||(Aj=1,L0.exports=D7()),L0.exports}var Rt=P7(),k0={exports:{}},on={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wj;function L7(){if(wj)return on;wj=1;var h=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),w=Symbol.for("react.consumer"),N=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),V=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),z=Symbol.iterator;function nt(rt){return rt===null||typeof rt!="object"?null:(rt=z&&rt[z]||rt["@@iterator"],typeof rt=="function"?rt:null)}var at={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},J=Object.assign,q={};function it(rt,Vt,ce){this.props=rt,this.context=Vt,this.refs=q,this.updater=ce||at}it.prototype.isReactComponent={},it.prototype.setState=function(rt,Vt){if(typeof rt!="object"&&typeof rt!="function"&&rt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,rt,Vt,"setState")},it.prototype.forceUpdate=function(rt){this.updater.enqueueForceUpdate(this,rt,"forceUpdate")};function ht(){}ht.prototype=it.prototype;function pt(rt,Vt,ce){this.props=rt,this.context=Vt,this.refs=q,this.updater=ce||at}var lt=pt.prototype=new ht;lt.constructor=pt,J(lt,it.prototype),lt.isPureReactComponent=!0;var bt=Array.isArray,Tt={H:null,A:null,T:null,S:null},Yt=Object.prototype.hasOwnProperty;function Ht(rt,Vt,ce,fe,Qt,We){return ce=We.ref,{$$typeof:h,type:rt,key:Vt,ref:ce!==void 0?ce:null,props:We}}function re(rt,Vt){return Ht(rt.type,Vt,void 0,void 0,void 0,rt.props)}function Xt(rt){return typeof rt=="object"&&rt!==null&&rt.$$typeof===h}function se(rt){var Vt={"=":"=0",":":"=2"};return"$"+rt.replace(/[=:]/g,function(ce){return Vt[ce]})}var Ve=/\/+/g;function me(rt,Vt){return typeof rt=="object"&&rt!==null&&rt.key!=null?se(""+rt.key):Vt.toString(36)}function ke(){}function Zt(rt){switch(rt.status){case"fulfilled":return rt.value;case"rejected":throw rt.reason;default:switch(typeof rt.status=="string"?rt.then(ke,ke):(rt.status="pending",rt.then(function(Vt){rt.status==="pending"&&(rt.status="fulfilled",rt.value=Vt)},function(Vt){rt.status==="pending"&&(rt.status="rejected",rt.reason=Vt)})),rt.status){case"fulfilled":return rt.value;case"rejected":throw rt.reason}}throw rt}function xe(rt,Vt,ce,fe,Qt){var We=typeof rt;(We==="undefined"||We==="boolean")&&(rt=null);var we=!1;if(rt===null)we=!0;else switch(We){case"bigint":case"string":case"number":we=!0;break;case"object":switch(rt.$$typeof){case h:case _:we=!0;break;case G:return we=rt._init,xe(we(rt._payload),Vt,ce,fe,Qt)}}if(we)return Qt=Qt(rt),we=fe===""?"."+me(rt,0):fe,bt(Qt)?(ce="",we!=null&&(ce=we.replace(Ve,"$&/")+"/"),xe(Qt,Vt,ce,"",function(Ge){return Ge})):Qt!=null&&(Xt(Qt)&&(Qt=re(Qt,ce+(Qt.key==null||rt&&rt.key===Qt.key?"":(""+Qt.key).replace(Ve,"$&/")+"/")+we)),Vt.push(Qt)),1;we=0;var le=fe===""?".":fe+":";if(bt(rt))for(var _e=0;_e<rt.length;_e++)fe=rt[_e],We=le+me(fe,_e),we+=xe(fe,Vt,ce,We,Qt);else if(_e=nt(rt),typeof _e=="function")for(rt=_e.call(rt),_e=0;!(fe=rt.next()).done;)fe=fe.value,We=le+me(fe,_e++),we+=xe(fe,Vt,ce,We,Qt);else if(We==="object"){if(typeof rt.then=="function")return xe(Zt(rt),Vt,ce,fe,Qt);throw Vt=String(rt),Error("Objects are not valid as a React child (found: "+(Vt==="[object Object]"?"object with keys {"+Object.keys(rt).join(", ")+"}":Vt)+"). If you meant to render a collection of children, use an array instead.")}return we}function kt(rt,Vt,ce){if(rt==null)return rt;var fe=[],Qt=0;return xe(rt,fe,"","",function(We){return Vt.call(ce,We,Qt++)}),fe}function zt(rt){if(rt._status===-1){var Vt=rt._result;Vt=Vt(),Vt.then(function(ce){(rt._status===0||rt._status===-1)&&(rt._status=1,rt._result=ce)},function(ce){(rt._status===0||rt._status===-1)&&(rt._status=2,rt._result=ce)}),rt._status===-1&&(rt._status=0,rt._result=Vt)}if(rt._status===1)return rt._result.default;throw rt._result}var Mt=typeof reportError=="function"?reportError:function(rt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Vt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof rt=="object"&&rt!==null&&typeof rt.message=="string"?String(rt.message):String(rt),error:rt});if(!window.dispatchEvent(Vt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",rt);return}console.error(rt)};function ge(){}return on.Children={map:kt,forEach:function(rt,Vt,ce){kt(rt,function(){Vt.apply(this,arguments)},ce)},count:function(rt){var Vt=0;return kt(rt,function(){Vt++}),Vt},toArray:function(rt){return kt(rt,function(Vt){return Vt})||[]},only:function(rt){if(!Xt(rt))throw Error("React.Children.only expected to receive a single React element child.");return rt}},on.Component=it,on.Fragment=E,on.Profiler=R,on.PureComponent=pt,on.StrictMode=g,on.Suspense=B,on.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Tt,on.act=function(){throw Error("act(...) is not supported in production builds of React.")},on.cache=function(rt){return function(){return rt.apply(null,arguments)}},on.cloneElement=function(rt,Vt,ce){if(rt==null)throw Error("The argument must be a React element, but you passed "+rt+".");var fe=J({},rt.props),Qt=rt.key,We=void 0;if(Vt!=null)for(we in Vt.ref!==void 0&&(We=void 0),Vt.key!==void 0&&(Qt=""+Vt.key),Vt)!Yt.call(Vt,we)||we==="key"||we==="__self"||we==="__source"||we==="ref"&&Vt.ref===void 0||(fe[we]=Vt[we]);var we=arguments.length-2;if(we===1)fe.children=ce;else if(1<we){for(var le=Array(we),_e=0;_e<we;_e++)le[_e]=arguments[_e+2];fe.children=le}return Ht(rt.type,Qt,void 0,void 0,We,fe)},on.createContext=function(rt){return rt={$$typeof:N,_currentValue:rt,_currentValue2:rt,_threadCount:0,Provider:null,Consumer:null},rt.Provider=rt,rt.Consumer={$$typeof:w,_context:rt},rt},on.createElement=function(rt,Vt,ce){var fe,Qt={},We=null;if(Vt!=null)for(fe in Vt.key!==void 0&&(We=""+Vt.key),Vt)Yt.call(Vt,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(Qt[fe]=Vt[fe]);var we=arguments.length-2;if(we===1)Qt.children=ce;else if(1<we){for(var le=Array(we),_e=0;_e<we;_e++)le[_e]=arguments[_e+2];Qt.children=le}if(rt&&rt.defaultProps)for(fe in we=rt.defaultProps,we)Qt[fe]===void 0&&(Qt[fe]=we[fe]);return Ht(rt,We,void 0,void 0,null,Qt)},on.createRef=function(){return{current:null}},on.forwardRef=function(rt){return{$$typeof:k,render:rt}},on.isValidElement=Xt,on.lazy=function(rt){return{$$typeof:G,_payload:{_status:-1,_result:rt},_init:zt}},on.memo=function(rt,Vt){return{$$typeof:V,type:rt,compare:Vt===void 0?null:Vt}},on.startTransition=function(rt){var Vt=Tt.T,ce={};Tt.T=ce;try{var fe=rt(),Qt=Tt.S;Qt!==null&&Qt(ce,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(ge,Mt)}catch(We){Mt(We)}finally{Tt.T=Vt}},on.unstable_useCacheRefresh=function(){return Tt.H.useCacheRefresh()},on.use=function(rt){return Tt.H.use(rt)},on.useActionState=function(rt,Vt,ce){return Tt.H.useActionState(rt,Vt,ce)},on.useCallback=function(rt,Vt){return Tt.H.useCallback(rt,Vt)},on.useContext=function(rt){return Tt.H.useContext(rt)},on.useDebugValue=function(){},on.useDeferredValue=function(rt,Vt){return Tt.H.useDeferredValue(rt,Vt)},on.useEffect=function(rt,Vt){return Tt.H.useEffect(rt,Vt)},on.useId=function(){return Tt.H.useId()},on.useImperativeHandle=function(rt,Vt,ce){return Tt.H.useImperativeHandle(rt,Vt,ce)},on.useInsertionEffect=function(rt,Vt){return Tt.H.useInsertionEffect(rt,Vt)},on.useLayoutEffect=function(rt,Vt){return Tt.H.useLayoutEffect(rt,Vt)},on.useMemo=function(rt,Vt){return Tt.H.useMemo(rt,Vt)},on.useOptimistic=function(rt,Vt){return Tt.H.useOptimistic(rt,Vt)},on.useReducer=function(rt,Vt,ce){return Tt.H.useReducer(rt,Vt,ce)},on.useRef=function(rt){return Tt.H.useRef(rt)},on.useState=function(rt){return Tt.H.useState(rt)},on.useSyncExternalStore=function(rt,Vt,ce){return Tt.H.useSyncExternalStore(rt,Vt,ce)},on.useTransition=function(){return Tt.H.useTransition()},on.version="19.0.0",on}var Ij;function AC(){return Ij||(Ij=1,k0.exports=L7()),k0.exports}var Z=AC();const ud=MN(Z),k7=N7({__proto__:null,default:ud},[Z]);var M0={exports:{}},wS={},U0={exports:{}},x0={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oj;function M7(){return Oj||(Oj=1,function(h){function _(kt,zt){var Mt=kt.length;kt.push(zt);t:for(;0<Mt;){var ge=Mt-1>>>1,rt=kt[ge];if(0<R(rt,zt))kt[ge]=zt,kt[Mt]=rt,Mt=ge;else break t}}function E(kt){return kt.length===0?null:kt[0]}function g(kt){if(kt.length===0)return null;var zt=kt[0],Mt=kt.pop();if(Mt!==zt){kt[0]=Mt;t:for(var ge=0,rt=kt.length,Vt=rt>>>1;ge<Vt;){var ce=2*(ge+1)-1,fe=kt[ce],Qt=ce+1,We=kt[Qt];if(0>R(fe,Mt))Qt<rt&&0>R(We,fe)?(kt[ge]=We,kt[Qt]=Mt,ge=Qt):(kt[ge]=fe,kt[ce]=Mt,ge=ce);else if(Qt<rt&&0>R(We,Mt))kt[ge]=We,kt[Qt]=Mt,ge=Qt;else break t}}return zt}function R(kt,zt){var Mt=kt.sortIndex-zt.sortIndex;return Mt!==0?Mt:kt.id-zt.id}if(h.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var w=performance;h.unstable_now=function(){return w.now()}}else{var N=Date,k=N.now();h.unstable_now=function(){return N.now()-k}}var B=[],V=[],G=1,z=null,nt=3,at=!1,J=!1,q=!1,it=typeof setTimeout=="function"?setTimeout:null,ht=typeof clearTimeout=="function"?clearTimeout:null,pt=typeof setImmediate<"u"?setImmediate:null;function lt(kt){for(var zt=E(V);zt!==null;){if(zt.callback===null)g(V);else if(zt.startTime<=kt)g(V),zt.sortIndex=zt.expirationTime,_(B,zt);else break;zt=E(V)}}function bt(kt){if(q=!1,lt(kt),!J)if(E(B)!==null)J=!0,Zt();else{var zt=E(V);zt!==null&&xe(bt,zt.startTime-kt)}}var Tt=!1,Yt=-1,Ht=5,re=-1;function Xt(){return!(h.unstable_now()-re<Ht)}function se(){if(Tt){var kt=h.unstable_now();re=kt;var zt=!0;try{t:{J=!1,q&&(q=!1,ht(Yt),Yt=-1),at=!0;var Mt=nt;try{e:{for(lt(kt),z=E(B);z!==null&&!(z.expirationTime>kt&&Xt());){var ge=z.callback;if(typeof ge=="function"){z.callback=null,nt=z.priorityLevel;var rt=ge(z.expirationTime<=kt);if(kt=h.unstable_now(),typeof rt=="function"){z.callback=rt,lt(kt),zt=!0;break e}z===E(B)&&g(B),lt(kt)}else g(B);z=E(B)}if(z!==null)zt=!0;else{var Vt=E(V);Vt!==null&&xe(bt,Vt.startTime-kt),zt=!1}}break t}finally{z=null,nt=Mt,at=!1}zt=void 0}}finally{zt?Ve():Tt=!1}}}var Ve;if(typeof pt=="function")Ve=function(){pt(se)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,ke=me.port2;me.port1.onmessage=se,Ve=function(){ke.postMessage(null)}}else Ve=function(){it(se,0)};function Zt(){Tt||(Tt=!0,Ve())}function xe(kt,zt){Yt=it(function(){kt(h.unstable_now())},zt)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(kt){kt.callback=null},h.unstable_continueExecution=function(){J||at||(J=!0,Zt())},h.unstable_forceFrameRate=function(kt){0>kt||125<kt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ht=0<kt?Math.floor(1e3/kt):5},h.unstable_getCurrentPriorityLevel=function(){return nt},h.unstable_getFirstCallbackNode=function(){return E(B)},h.unstable_next=function(kt){switch(nt){case 1:case 2:case 3:var zt=3;break;default:zt=nt}var Mt=nt;nt=zt;try{return kt()}finally{nt=Mt}},h.unstable_pauseExecution=function(){},h.unstable_requestPaint=function(){},h.unstable_runWithPriority=function(kt,zt){switch(kt){case 1:case 2:case 3:case 4:case 5:break;default:kt=3}var Mt=nt;nt=kt;try{return zt()}finally{nt=Mt}},h.unstable_scheduleCallback=function(kt,zt,Mt){var ge=h.unstable_now();switch(typeof Mt=="object"&&Mt!==null?(Mt=Mt.delay,Mt=typeof Mt=="number"&&0<Mt?ge+Mt:ge):Mt=ge,kt){case 1:var rt=-1;break;case 2:rt=250;break;case 5:rt=1073741823;break;case 4:rt=1e4;break;default:rt=5e3}return rt=Mt+rt,kt={id:G++,callback:zt,priorityLevel:kt,startTime:Mt,expirationTime:rt,sortIndex:-1},Mt>ge?(kt.sortIndex=Mt,_(V,kt),E(B)===null&&kt===E(V)&&(q?(ht(Yt),Yt=-1):q=!0,xe(bt,Mt-ge))):(kt.sortIndex=rt,_(B,kt),J||at||(J=!0,Zt())),kt},h.unstable_shouldYield=Xt,h.unstable_wrapCallback=function(kt){var zt=nt;return function(){var Mt=nt;nt=zt;try{return kt.apply(this,arguments)}finally{nt=Mt}}}}(x0)),x0}var Nj;function U7(){return Nj||(Nj=1,U0.exports=M7()),U0.exports}var V0={exports:{}},Zr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dj;function x7(){if(Dj)return Zr;Dj=1;var h=AC();function _(B){var V="https://react.dev/errors/"+B;if(1<arguments.length){V+="?args[]="+encodeURIComponent(arguments[1]);for(var G=2;G<arguments.length;G++)V+="&args[]="+encodeURIComponent(arguments[G])}return"Minified React error #"+B+"; visit "+V+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function E(){}var g={d:{f:E,r:function(){throw Error(_(522))},D:E,C:E,L:E,m:E,X:E,S:E,M:E},p:0,findDOMNode:null},R=Symbol.for("react.portal");function w(B,V,G){var z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:R,key:z==null?null:""+z,children:B,containerInfo:V,implementation:G}}var N=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function k(B,V){if(B==="font")return"";if(typeof V=="string")return V==="use-credentials"?V:""}return Zr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=g,Zr.createPortal=function(B,V){var G=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!V||V.nodeType!==1&&V.nodeType!==9&&V.nodeType!==11)throw Error(_(299));return w(B,V,null,G)},Zr.flushSync=function(B){var V=N.T,G=g.p;try{if(N.T=null,g.p=2,B)return B()}finally{N.T=V,g.p=G,g.d.f()}},Zr.preconnect=function(B,V){typeof B=="string"&&(V?(V=V.crossOrigin,V=typeof V=="string"?V==="use-credentials"?V:"":void 0):V=null,g.d.C(B,V))},Zr.prefetchDNS=function(B){typeof B=="string"&&g.d.D(B)},Zr.preinit=function(B,V){if(typeof B=="string"&&V&&typeof V.as=="string"){var G=V.as,z=k(G,V.crossOrigin),nt=typeof V.integrity=="string"?V.integrity:void 0,at=typeof V.fetchPriority=="string"?V.fetchPriority:void 0;G==="style"?g.d.S(B,typeof V.precedence=="string"?V.precedence:void 0,{crossOrigin:z,integrity:nt,fetchPriority:at}):G==="script"&&g.d.X(B,{crossOrigin:z,integrity:nt,fetchPriority:at,nonce:typeof V.nonce=="string"?V.nonce:void 0})}},Zr.preinitModule=function(B,V){if(typeof B=="string")if(typeof V=="object"&&V!==null){if(V.as==null||V.as==="script"){var G=k(V.as,V.crossOrigin);g.d.M(B,{crossOrigin:G,integrity:typeof V.integrity=="string"?V.integrity:void 0,nonce:typeof V.nonce=="string"?V.nonce:void 0})}}else V==null&&g.d.M(B)},Zr.preload=function(B,V){if(typeof B=="string"&&typeof V=="object"&&V!==null&&typeof V.as=="string"){var G=V.as,z=k(G,V.crossOrigin);g.d.L(B,G,{crossOrigin:z,integrity:typeof V.integrity=="string"?V.integrity:void 0,nonce:typeof V.nonce=="string"?V.nonce:void 0,type:typeof V.type=="string"?V.type:void 0,fetchPriority:typeof V.fetchPriority=="string"?V.fetchPriority:void 0,referrerPolicy:typeof V.referrerPolicy=="string"?V.referrerPolicy:void 0,imageSrcSet:typeof V.imageSrcSet=="string"?V.imageSrcSet:void 0,imageSizes:typeof V.imageSizes=="string"?V.imageSizes:void 0,media:typeof V.media=="string"?V.media:void 0})}},Zr.preloadModule=function(B,V){if(typeof B=="string")if(V){var G=k(V.as,V.crossOrigin);g.d.m(B,{as:typeof V.as=="string"&&V.as!=="script"?V.as:void 0,crossOrigin:G,integrity:typeof V.integrity=="string"?V.integrity:void 0})}else g.d.m(B)},Zr.requestFormReset=function(B){g.d.r(B)},Zr.unstable_batchedUpdates=function(B,V){return B(V)},Zr.useFormState=function(B,V,G){return N.H.useFormState(B,V,G)},Zr.useFormStatus=function(){return N.H.useHostTransitionStatus()},Zr.version="19.0.0",Zr}var Pj;function VF(){if(Pj)return V0.exports;Pj=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(_){console.error(_)}}return h(),V0.exports=x7(),V0.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lj;function V7(){if(Lj)return wS;Lj=1;var h=U7(),_=AC(),E=VF();function g(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function R(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}var w=Symbol.for("react.element"),N=Symbol.for("react.transitional.element"),k=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),V=Symbol.for("react.strict_mode"),G=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),nt=Symbol.for("react.consumer"),at=Symbol.for("react.context"),J=Symbol.for("react.forward_ref"),q=Symbol.for("react.suspense"),it=Symbol.for("react.suspense_list"),ht=Symbol.for("react.memo"),pt=Symbol.for("react.lazy"),lt=Symbol.for("react.offscreen"),bt=Symbol.for("react.memo_cache_sentinel"),Tt=Symbol.iterator;function Yt(s){return s===null||typeof s!="object"?null:(s=Tt&&s[Tt]||s["@@iterator"],typeof s=="function"?s:null)}var Ht=Symbol.for("react.client.reference");function re(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Ht?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case B:return"Fragment";case k:return"Portal";case G:return"Profiler";case V:return"StrictMode";case q:return"Suspense";case it:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case at:return(s.displayName||"Context")+".Provider";case nt:return(s._context.displayName||"Context")+".Consumer";case J:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case ht:return a=s.displayName||null,a!==null?a:re(s.type)||"Memo";case pt:a=s._payload,s=s._init;try{return re(s(a))}catch{}}return null}var Xt=_.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=Object.assign,Ve,me;function ke(s){if(Ve===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);Ve=a&&a[1]||"",me=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ve+s+me}var Zt=!1;function xe(s,a){if(!s||Zt)return"";Zt=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(a){var Kt=function(){throw Error()};if(Object.defineProperty(Kt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Kt,[])}catch(Nt){var vt=Nt}Reflect.construct(s,[],Kt)}else{try{Kt.call()}catch(Nt){vt=Nt}s.call(Kt.prototype)}}else{try{throw Error()}catch(Nt){vt=Nt}(Kt=s())&&typeof Kt.catch=="function"&&Kt.catch(function(){})}}catch(Nt){if(Nt&&vt&&typeof Nt.stack=="string")return[Nt.stack,vt.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var T=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");T&&T.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=m.DetermineComponentFrameRoot(),x=C[0],K=C[1];if(x&&K){var $=x.split(`
`),ut=K.split(`
`);for(T=m=0;m<$.length&&!$[m].includes("DetermineComponentFrameRoot");)m++;for(;T<ut.length&&!ut[T].includes("DetermineComponentFrameRoot");)T++;if(m===$.length||T===ut.length)for(m=$.length-1,T=ut.length-1;1<=m&&0<=T&&$[m]!==ut[T];)T--;for(;1<=m&&0<=T;m--,T--)if($[m]!==ut[T]){if(m!==1||T!==1)do if(m--,T--,0>T||$[m]!==ut[T]){var Pt=`
`+$[m].replace(" at new "," at ");return s.displayName&&Pt.includes("<anonymous>")&&(Pt=Pt.replace("<anonymous>",s.displayName)),Pt}while(1<=m&&0<=T);break}}}finally{Zt=!1,Error.prepareStackTrace=u}return(u=s?s.displayName||s.name:"")?ke(u):""}function kt(s){switch(s.tag){case 26:case 27:case 5:return ke(s.type);case 16:return ke("Lazy");case 13:return ke("Suspense");case 19:return ke("SuspenseList");case 0:case 15:return s=xe(s.type,!1),s;case 11:return s=xe(s.type.render,!1),s;case 1:return s=xe(s.type,!0),s;default:return""}}function zt(s){try{var a="";do a+=kt(s),s=s.return;while(s);return a}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Mt(s){var a=s,u=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,a.flags&4098&&(u=a.return),s=a.return;while(s)}return a.tag===3?u:null}function ge(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function rt(s){if(Mt(s)!==s)throw Error(g(188))}function Vt(s){var a=s.alternate;if(!a){if(a=Mt(s),a===null)throw Error(g(188));return a!==s?null:s}for(var u=s,m=a;;){var T=u.return;if(T===null)break;var C=T.alternate;if(C===null){if(m=T.return,m!==null){u=m;continue}break}if(T.child===C.child){for(C=T.child;C;){if(C===u)return rt(T),s;if(C===m)return rt(T),a;C=C.sibling}throw Error(g(188))}if(u.return!==m.return)u=T,m=C;else{for(var x=!1,K=T.child;K;){if(K===u){x=!0,u=T,m=C;break}if(K===m){x=!0,m=T,u=C;break}K=K.sibling}if(!x){for(K=C.child;K;){if(K===u){x=!0,u=C,m=T;break}if(K===m){x=!0,m=C,u=T;break}K=K.sibling}if(!x)throw Error(g(189))}}if(u.alternate!==m)throw Error(g(190))}if(u.tag!==3)throw Error(g(188));return u.stateNode.current===u?s:a}function ce(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=ce(s),a!==null)return a;s=s.sibling}return null}var fe=Array.isArray,Qt=E.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,We={pending:!1,data:null,method:null,action:null},we=[],le=-1;function _e(s){return{current:s}}function Ge(s){0>le||(s.current=we[le],we[le]=null,le--)}function Te(s,a){le++,we[le]=s.current,s.current=a}var nn=_e(null),gn=_e(null),jn=_e(null),br=_e(null);function ho(s,a){switch(Te(jn,a),Te(gn,s),Te(nn,null),s=a.nodeType,s){case 9:case 11:a=(a=a.documentElement)&&(a=a.namespaceURI)?og(a):0;break;default:if(s=s===8?a.parentNode:a,a=s.tagName,s=s.namespaceURI)s=og(s),a=ag(s,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Ge(nn),Te(nn,a)}function ji(){Ge(nn),Ge(gn),Ge(jn)}function Xo(s){s.memoizedState!==null&&Te(br,s);var a=nn.current,u=ag(a,s.type);a!==u&&(Te(gn,s),Te(nn,u))}function Ci(s){gn.current===s&&(Ge(nn),Ge(gn)),br.current===s&&(Ge(br),Rh._currentValue=We)}var ki=Object.prototype.hasOwnProperty,gd=h.unstable_scheduleCallback,Sd=h.unstable_cancelCallback,KC=h.unstable_shouldYield,KS=h.unstable_requestPaint,ti=h.unstable_now,zS=h.unstable_getCurrentPriorityLevel,b_=h.unstable_ImmediatePriority,po=h.unstable_UserBlockingPriority,Td=h.unstable_NormalPriority,C_=h.unstable_LowPriority,A_=h.unstable_IdlePriority,YS=h.log,qS=h.unstable_setDisableYieldValue,zl=null,Fi=null;function XS(s){if(Fi&&typeof Fi.onCommitFiberRoot=="function")try{Fi.onCommitFiberRoot(zl,s,void 0,(s.current.flags&128)===128)}catch{}}function Va(s){if(typeof YS=="function"&&qS(s),Fi&&typeof Fi.setStrictMode=="function")try{Fi.setStrictMode(zl,s)}catch{}}var ts=Math.clz32?Math.clz32:zC,Yl=Math.log,JS=Math.LN2;function zC(s){return s>>>=0,s===0?32:31-(Yl(s)/JS|0)|0}var Tp=128,vp=4194304;function Kc(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Ba(s,a){var u=s.pendingLanes;if(u===0)return 0;var m=0,T=s.suspendedLanes,C=s.pingedLanes,x=s.warmLanes;s=s.finishedLanes!==0;var K=u&134217727;return K!==0?(u=K&~T,u!==0?m=Kc(u):(C&=K,C!==0?m=Kc(C):s||(x=K&~x,x!==0&&(m=Kc(x))))):(K=u&~T,K!==0?m=Kc(K):C!==0?m=Kc(C):s||(x=u&~x,x!==0&&(m=Kc(x)))),m===0?0:a!==0&&a!==m&&!(a&T)&&(T=m&-m,x=a&-a,T>=x||T===32&&(x&4194176)!==0)?a:m}function vd(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function ql(s,a){switch(s){case 1:case 2:case 4:case 8:return a+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function QS(){var s=Tp;return Tp<<=1,!(Tp&4194176)&&(Tp=128),s}function ZS(){var s=vp;return vp<<=1,!(vp&62914560)&&(vp=4194304),s}function w_(s){for(var a=[],u=0;31>u;u++)a.push(s);return a}function Ji(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function YC(s,a,u,m,T,C){var x=s.pendingLanes;s.pendingLanes=u,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=u,s.entangledLanes&=u,s.errorRecoveryDisabledLanes&=u,s.shellSuspendCounter=0;var K=s.entanglements,$=s.expirationTimes,ut=s.hiddenUpdates;for(u=x&~u;0<u;){var Pt=31-ts(u),Kt=1<<Pt;K[Pt]=0,$[Pt]=-1;var vt=ut[Pt];if(vt!==null)for(ut[Pt]=null,Pt=0;Pt<vt.length;Pt++){var Nt=vt[Pt];Nt!==null&&(Nt.lane&=-536870913)}u&=~Kt}m!==0&&$S(s,m,0),C!==0&&T===0&&s.tag!==0&&(s.suspendedLanes|=C&~(x&~a))}function $S(s,a,u){s.pendingLanes|=a,s.suspendedLanes&=~a;var m=31-ts(a);s.entangledLanes|=a,s.entanglements[m]=s.entanglements[m]|1073741824|u&4194218}function yd(s,a){var u=s.entangledLanes|=a;for(s=s.entanglements;u;){var m=31-ts(u),T=1<<m;T&a|s[m]&a&&(s[m]|=a),u&=~T}}function I_(s){return s&=-s,2<s?8<s?s&134217727?32:268435456:8:2}function O_(){var s=Qt.p;return s!==0?s:(s=window.event,s===void 0?32:My(s.type))}function tT(s,a){var u=Qt.p;try{return Qt.p=s,a()}finally{Qt.p=u}}var ja=Math.random().toString(36).slice(2),rr="__reactFiber$"+ja,xr="__reactProps$"+ja,zc="__reactContainer$"+ja,N_="__reactEvents$"+ja,qC="__reactListeners$"+ja,XC="__reactHandles$"+ja,D_="__reactResources$"+ja,Xl="__reactMarker$"+ja;function Rd(s){delete s[rr],delete s[xr],delete s[N_],delete s[qC],delete s[XC]}function Fa(s){var a=s[rr];if(a)return a;for(var u=s.parentNode;u;){if(a=u[zc]||u[rr]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(s=Sy(s);s!==null;){if(u=s[rr])return u;s=Sy(s)}return a}s=u,u=s.parentNode}return null}function js(s){if(s=s[rr]||s[zc]){var a=s.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return s}return null}function bd(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(g(33))}function Jl(s){var a=s[D_];return a||(a=s[D_]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Yn(s){s[Xl]=!0}var eT=new Set,nT={};function qn(s,a){Ql(s,a),Ql(s+"Capture",a)}function Ql(s,a){for(nT[s]=a,s=0;s<a.length;s++)eT.add(a[s])}var Jo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),JC=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),iT={},yp={};function QC(s){return ki.call(yp,s)?!0:ki.call(iT,s)?!1:JC.test(s)?yp[s]=!0:(iT[s]=!0,!1)}function Cd(s,a,u){if(QC(a))if(u===null)s.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var m=a.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+u)}}function Rp(s,a,u){if(u===null)s.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+u)}}function Qo(s,a,u,m){if(m===null)s.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(u);return}s.setAttributeNS(a,u,""+m)}}function ms(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Yc(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function P_(s){var a=Yc(s)?"checked":"value",u=Object.getOwnPropertyDescriptor(s.constructor.prototype,a),m=""+s[a];if(!s.hasOwnProperty(a)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var T=u.get,C=u.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return T.call(this)},set:function(x){m=""+x,C.call(this,x)}}),Object.defineProperty(s,a,{enumerable:u.enumerable}),{getValue:function(){return m},setValue:function(x){m=""+x},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function bp(s){s._valueTracker||(s._valueTracker=P_(s))}function xn(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var u=a.getValue(),m="";return s&&(m=Yc(s)?s.checked?"true":"false":s.value),s=m,s!==u?(a.setValue(s),!0):!1}function Cp(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var rT=/[\n"\\]/g;function es(s){return s.replace(rT,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function L_(s,a,u,m,T,C,x,K){s.name="",x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?s.type=x:s.removeAttribute("type"),a!=null?x==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+ms(a)):s.value!==""+ms(a)&&(s.value=""+ms(a)):x!=="submit"&&x!=="reset"||s.removeAttribute("value"),a!=null?k_(s,x,ms(a)):u!=null?k_(s,x,ms(u)):m!=null&&s.removeAttribute("value"),T==null&&C!=null&&(s.defaultChecked=!!C),T!=null&&(s.checked=T&&typeof T!="function"&&typeof T!="symbol"),K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"?s.name=""+ms(K):s.removeAttribute("name")}function sT(s,a,u,m,T,C,x,K){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(s.type=C),a!=null||u!=null){if(!(C!=="submit"&&C!=="reset"||a!=null))return;u=u!=null?""+ms(u):"",a=a!=null?""+ms(a):u,K||a===s.value||(s.value=a),s.defaultValue=a}m=m??T,m=typeof m!="function"&&typeof m!="symbol"&&!!m,s.checked=K?s.checked:!!m,s.defaultChecked=!!m,x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(s.name=x)}function k_(s,a,u){a==="number"&&Cp(s.ownerDocument)===s||s.defaultValue===""+u||(s.defaultValue=""+u)}function Zl(s,a,u,m){if(s=s.options,a){a={};for(var T=0;T<u.length;T++)a["$"+u[T]]=!0;for(u=0;u<s.length;u++)T=a.hasOwnProperty("$"+s[u].value),s[u].selected!==T&&(s[u].selected=T),T&&m&&(s[u].defaultSelected=!0)}else{for(u=""+ms(u),a=null,T=0;T<s.length;T++){if(s[T].value===u){s[T].selected=!0,m&&(s[T].defaultSelected=!0);return}a!==null||s[T].disabled||(a=s[T])}a!==null&&(a.selected=!0)}}function oT(s,a,u){if(a!=null&&(a=""+ms(a),a!==s.value&&(s.value=a),u==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=u!=null?""+ms(u):""}function aT(s,a,u,m){if(a==null){if(m!=null){if(u!=null)throw Error(g(92));if(fe(m)){if(1<m.length)throw Error(g(93));m=m[0]}u=m}u==null&&(u=""),a=u}u=ms(a),s.defaultValue=u,m=s.textContent,m===u&&m!==""&&m!==null&&(s.value=m)}function Ga(s,a){if(a){var u=s.firstChild;if(u&&u===s.lastChild&&u.nodeType===3){u.nodeValue=a;return}}s.textContent=a}var cT=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ap(s,a,u){var m=a.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?m?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":m?s.setProperty(a,u):typeof u!="number"||u===0||cT.has(a)?a==="float"?s.cssFloat=u:s[a]=(""+u).trim():s[a]=u+"px"}function lT(s,a,u){if(a!=null&&typeof a!="object")throw Error(g(62));if(s=s.style,u!=null){for(var m in u)!u.hasOwnProperty(m)||a!=null&&a.hasOwnProperty(m)||(m.indexOf("--")===0?s.setProperty(m,""):m==="float"?s.cssFloat="":s[m]="");for(var T in a)m=a[T],a.hasOwnProperty(T)&&u[T]!==m&&Ap(s,T,m)}else for(var C in a)a.hasOwnProperty(C)&&Ap(s,C,a[C])}function Ad(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ZC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),uT=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function wp(s){return uT.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var M_=null;function U_(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var $l=null,tu=null;function dT(s){var a=js(s);if(a&&(s=a.stateNode)){var u=s[xr]||null;t:switch(s=a.stateNode,a.type){case"input":if(L_(s,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),a=u.name,u.type==="radio"&&a!=null){for(u=s;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+es(""+a)+'"][type="radio"]'),a=0;a<u.length;a++){var m=u[a];if(m!==s&&m.form===s.form){var T=m[xr]||null;if(!T)throw Error(g(90));L_(m,T.value,T.defaultValue,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name)}}for(a=0;a<u.length;a++)m=u[a],m.form===s.form&&xn(m)}break t;case"textarea":oT(s,u.value,u.defaultValue);break t;case"select":a=u.value,a!=null&&Zl(s,!!u.multiple,a,!1)}}}var x_=!1;function hT(s,a,u){if(x_)return s(a,u);x_=!0;try{var m=s(a);return m}finally{if(x_=!1,($l!==null||tu!==null)&&(ph(),$l&&(a=$l,s=tu,tu=$l=null,dT(a),s)))for(a=0;a<s.length;a++)dT(s[a])}}function eu(s,a){var u=s.stateNode;if(u===null)return null;var m=u[xr]||null;if(m===null)return null;u=m[a];t:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(s=s.type,m=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!m;break t;default:s=!1}if(s)return null;if(u&&typeof u!="function")throw Error(g(231,a,typeof u));return u}var V_=!1;if(Jo)try{var wd={};Object.defineProperty(wd,"passive",{get:function(){V_=!0}}),window.addEventListener("test",wd,wd),window.removeEventListener("test",wd,wd)}catch{V_=!1}var Ha=null,qc=null,Ip=null;function pT(){if(Ip)return Ip;var s,a=qc,u=a.length,m,T="value"in Ha?Ha.value:Ha.textContent,C=T.length;for(s=0;s<u&&a[s]===T[s];s++);var x=u-s;for(m=1;m<=x&&a[u-m]===T[C-m];m++);return Ip=T.slice(s,1<m?1-m:void 0)}function Op(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Np(){return!0}function B_(){return!1}function Vr(s){function a(u,m,T,C,x){this._reactName=u,this._targetInst=T,this.type=m,this.nativeEvent=C,this.target=x,this.currentTarget=null;for(var K in s)s.hasOwnProperty(K)&&(u=s[K],this[K]=u?u(C):C[K]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?Np:B_,this.isPropagationStopped=B_,this}return se(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Np)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Np)},persist:function(){},isPersistent:Np}),a}var Xc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Dp=Vr(Xc),_s=se({},Xc,{view:0,detail:0}),Es=Vr(_s),Pp,j_,Id,Lp=se({},_s,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qc,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Id&&(Id&&s.type==="mousemove"?(Pp=s.screenX-Id.screenX,j_=s.screenY-Id.screenY):j_=Pp=0,Id=s),Pp)},movementY:function(s){return"movementY"in s?s.movementY:j_}}),hr=Vr(Lp),$C=se({},Lp,{dataTransfer:0}),tA=Vr($C),eA=se({},_s,{relatedTarget:0}),nu=Vr(eA),fT=se({},Xc,{animationName:0,elapsedTime:0,pseudoElement:0}),nA=Vr(fT),F_=se({},Xc,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),iA=Vr(F_),G_=se({},Xc,{data:0}),kp=Vr(G_),H_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jc(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=sA[s])?!!a[s]:!1}function Qc(){return Jc}var oA=se({},_s,{key:function(s){if(s.key){var a=H_[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=Op(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?rA[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qc,charCode:function(s){return s.type==="keypress"?Op(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Op(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),aA=Vr(oA),cA=se({},Lp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mT=Vr(cA),lA=se({},_s,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qc}),iu=Vr(lA),uA=se({},Xc,{propertyName:0,elapsedTime:0,pseudoElement:0}),ru=Vr(uA),_T=se({},Lp,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),dA=Vr(_T),Ke=se({},Xc,{newState:0,oldState:0}),hA=Vr(Ke),pA=[9,13,27,32],W_=Jo&&"CompositionEvent"in window,Od=null;Jo&&"documentMode"in document&&(Od=document.documentMode);var K_=Jo&&"TextEvent"in window&&!Od,ET=Jo&&(!W_||Od&&8<Od&&11>=Od),gT=" ",ST=!1;function Mp(s,a){switch(s){case"keyup":return pA.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function TT(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var su=!1;function vT(s,a){switch(s){case"compositionend":return TT(a);case"keypress":return a.which!==32?null:(ST=!0,gT);case"textInput":return s=a.data,s===gT&&ST?null:s;default:return null}}function fA(s,a){if(su)return s==="compositionend"||!W_&&Mp(s,a)?(s=pT(),Ip=qc=Ha=null,su=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return ET&&a.locale!=="ko"?null:a.data;default:return null}}var Wa={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yT(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!Wa[s.type]:a==="textarea"}function RT(s,a,u,m){$l?tu?tu.push(m):tu=[m]:$l=m,a=Pu(a,"onChange"),0<a.length&&(u=new Dp("onChange","change",null,u,m),s.push({event:u,listeners:a}))}var Nd=null,ou=null;function z_(s){fy(s,0)}function Up(s){var a=bd(s);if(xn(a))return s}function bT(s,a){if(s==="change")return a}var CT=!1;if(Jo){var Br;if(Jo){var Y_="oninput"in document;if(!Y_){var AT=document.createElement("div");AT.setAttribute("oninput","return;"),Y_=typeof AT.oninput=="function"}Br=Y_}else Br=!1;CT=Br&&(!document.documentMode||9<document.documentMode)}function wT(){Nd&&(Nd.detachEvent("onpropertychange",IT),ou=Nd=null)}function IT(s){if(s.propertyName==="value"&&Up(ou)){var a=[];RT(a,ou,s,U_(s)),hT(z_,a)}}function OT(s,a,u){s==="focusin"?(wT(),Nd=a,ou=u,Nd.attachEvent("onpropertychange",IT)):s==="focusout"&&wT()}function mA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Up(ou)}function _A(s,a){if(s==="click")return Up(a)}function NT(s,a){if(s==="input"||s==="change")return Up(a)}function q_(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var ns=typeof Object.is=="function"?Object.is:q_;function Dd(s,a){if(ns(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var u=Object.keys(s),m=Object.keys(a);if(u.length!==m.length)return!1;for(m=0;m<u.length;m++){var T=u[m];if(!ki.call(a,T)||!ns(s[T],a[T]))return!1}return!0}function Pd(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function DT(s,a){var u=Pd(s);s=0;for(var m;u;){if(u.nodeType===3){if(m=s+u.textContent.length,s<=a&&m>=a)return{node:u,offset:a-s};s=m}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=Pd(u)}}function PT(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?PT(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function LT(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=Cp(s.document);a instanceof s.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)s=a.contentWindow;else break;a=Cp(s.document)}return a}function Fs(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}function EA(s,a){var u=LT(a);a=s.focusedElem;var m=s.selectionRange;if(u!==a&&a&&a.ownerDocument&&PT(a.ownerDocument.documentElement,a)){if(m!==null&&Fs(a)){if(s=m.start,u=m.end,u===void 0&&(u=s),"selectionStart"in a)a.selectionStart=s,a.selectionEnd=Math.min(u,a.value.length);else if(u=(s=a.ownerDocument||document)&&s.defaultView||window,u.getSelection){u=u.getSelection();var T=a.textContent.length,C=Math.min(m.start,T);m=m.end===void 0?C:Math.min(m.end,T),!u.extend&&C>m&&(T=m,m=C,C=T),T=DT(a,C);var x=DT(a,m);T&&x&&(u.rangeCount!==1||u.anchorNode!==T.node||u.anchorOffset!==T.offset||u.focusNode!==x.node||u.focusOffset!==x.offset)&&(s=s.createRange(),s.setStart(T.node,T.offset),u.removeAllRanges(),C>m?(u.addRange(s),u.extend(x.node,x.offset)):(s.setEnd(x.node,x.offset),u.addRange(s)))}}for(s=[],u=a;u=u.parentNode;)u.nodeType===1&&s.push({element:u,left:u.scrollLeft,top:u.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<s.length;a++)u=s[a],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}var gA=Jo&&"documentMode"in document&&11>=document.documentMode,Gi=null,X_=null,Ld=null,J_=!1;function kT(s,a,u){var m=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;J_||Gi==null||Gi!==Cp(m)||(m=Gi,"selectionStart"in m&&Fs(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Ld&&Dd(Ld,m)||(Ld=m,m=Pu(X_,"onSelect"),0<m.length&&(a=new Dp("onSelect","select",null,a,u),s.push({event:a,listeners:m}),a.target=Gi)))}function Ka(s,a){var u={};return u[s.toLowerCase()]=a.toLowerCase(),u["Webkit"+s]="webkit"+a,u["Moz"+s]="moz"+a,u}var au={animationend:Ka("Animation","AnimationEnd"),animationiteration:Ka("Animation","AnimationIteration"),animationstart:Ka("Animation","AnimationStart"),transitionrun:Ka("Transition","TransitionRun"),transitionstart:Ka("Transition","TransitionStart"),transitioncancel:Ka("Transition","TransitionCancel"),transitionend:Ka("Transition","TransitionEnd")},Q_={},MT={};Jo&&(MT=document.createElement("div").style,"AnimationEvent"in window||(delete au.animationend.animation,delete au.animationiteration.animation,delete au.animationstart.animation),"TransitionEvent"in window||delete au.transitionend.transition);function za(s){if(Q_[s])return Q_[s];if(!au[s])return s;var a=au[s],u;for(u in a)if(a.hasOwnProperty(u)&&u in MT)return Q_[s]=a[u];return s}var UT=za("animationend"),xT=za("animationiteration"),xp=za("animationstart"),Z_=za("transitionrun"),SA=za("transitionstart"),Ct=za("transitioncancel"),VT=za("transitionend"),BT=new Map,jT="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Gs(s,a){BT.set(s,a),qn(a,[s])}var is=[],Zc=0,$_=0;function Vp(){for(var s=Zc,a=$_=Zc=0;a<s;){var u=is[a];is[a++]=null;var m=is[a];is[a++]=null;var T=is[a];is[a++]=null;var C=is[a];if(is[a++]=null,m!==null&&T!==null){var x=m.pending;x===null?T.next=T:(T.next=x.next,x.next=T),m.pending=T}C!==0&&FT(u,T,C)}}function Bp(s,a,u,m){is[Zc++]=s,is[Zc++]=a,is[Zc++]=u,is[Zc++]=m,$_|=m,s.lanes|=m,s=s.alternate,s!==null&&(s.lanes|=m)}function cu(s,a,u,m){return Bp(s,a,u,m),jp(s)}function gs(s,a){return Bp(s,null,null,a),jp(s)}function FT(s,a,u){s.lanes|=u;var m=s.alternate;m!==null&&(m.lanes|=u);for(var T=!1,C=s.return;C!==null;)C.childLanes|=u,m=C.alternate,m!==null&&(m.childLanes|=u),C.tag===22&&(s=C.stateNode,s===null||s._visibility&1||(T=!0)),s=C,C=C.return;T&&a!==null&&s.tag===3&&(C=s.stateNode,T=31-ts(u),C=C.hiddenUpdates,s=C[T],s===null?C[T]=[a]:s.push(a),a.lane=u|536870912)}function jp(s){if(50<wo)throw wo=0,XE=null,Error(g(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var Zo={},Fp=new WeakMap;function Cr(s,a){if(typeof s=="object"&&s!==null){var u=Fp.get(s);return u!==void 0?u:(a={value:s,source:a,stack:zt(a)},Fp.set(s,a),a)}return{value:s,source:a,stack:zt(a)}}var lu=[],uu=0,Gp=null,Hp=0,jr=[],Ss=0,Ya=null,Hi=1,$o="";function Hs(s,a){lu[uu++]=Hp,lu[uu++]=Gp,Gp=s,Hp=a}function GT(s,a,u){jr[Ss++]=Hi,jr[Ss++]=$o,jr[Ss++]=Ya,Ya=s;var m=Hi;s=$o;var T=32-ts(m)-1;m&=~(1<<T),u+=1;var C=32-ts(a)+T;if(30<C){var x=T-T%5;C=(m&(1<<x)-1).toString(32),m>>=x,T-=x,Hi=1<<32-ts(a)+T|u<<T|m,$o=C+s}else Hi=1<<C|u<<T|m,$o=s}function tE(s){s.return!==null&&(Hs(s,1),GT(s,1,0))}function eE(s){for(;s===Gp;)Gp=lu[--uu],lu[uu]=null,Hp=lu[--uu],lu[uu]=null;for(;s===Ya;)Ya=jr[--Ss],jr[Ss]=null,$o=jr[--Ss],jr[Ss]=null,Hi=jr[--Ss],jr[Ss]=null}var pr=null,sr=null,Cn=!1,Ws=null,Ts=!1,nE=Error(g(519));function qa(s){var a=Error(g(418,""));throw kd(Cr(a,s)),nE}function iE(s){var a=s.stateNode,u=s.type,m=s.memoizedProps;switch(a[rr]=s,a[xr]=m,u){case"dialog":pn("cancel",a),pn("close",a);break;case"iframe":case"object":case"embed":pn("load",a);break;case"video":case"audio":for(u=0;u<fc.length;u++)pn(fc[u],a);break;case"source":pn("error",a);break;case"img":case"image":case"link":pn("error",a),pn("load",a);break;case"details":pn("toggle",a);break;case"input":pn("invalid",a),sT(a,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0),bp(a);break;case"select":pn("invalid",a);break;case"textarea":pn("invalid",a),aT(a,m.value,m.defaultValue,m.children),bp(a)}u=m.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||a.textContent===""+u||m.suppressHydrationWarning===!0||rg(a.textContent,u)?(m.popover!=null&&(pn("beforetoggle",a),pn("toggle",a)),m.onScroll!=null&&pn("scroll",a),m.onScrollEnd!=null&&pn("scrollend",a),m.onClick!=null&&(a.onclick=Th),a=!0):a=!1,a||qa(s)}function HT(s){for(pr=s.return;pr;)switch(pr.tag){case 3:case 27:Ts=!0;return;case 5:case 13:Ts=!1;return;default:pr=pr.return}}function du(s){if(s!==pr)return!1;if(!Cn)return HT(s),Cn=!0,!1;var a=!1,u;if((u=s.tag!==3&&s.tag!==27)&&((u=s.tag===5)&&(u=s.type,u=!(u!=="form"&&u!=="button")||cg(s.type,s.memoizedProps)),u=!u),u&&(a=!0),a&&sr&&qa(s),HT(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(g(317));t:{for(s=s.nextSibling,a=0;s;){if(s.nodeType===8)if(u=s.data,u==="/$"){if(a===0){sr=Ys(s.nextSibling);break t}a--}else u!=="$"&&u!=="$!"&&u!=="$?"||a++;s=s.nextSibling}sr=null}}else sr=pr?Ys(s.stateNode.nextSibling):null;return!0}function Xa(){sr=pr=null,Cn=!1}function kd(s){Ws===null?Ws=[s]:Ws.push(s)}var Md=Error(g(460)),WT=Error(g(474)),rE={then:function(){}};function KT(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Ud(){}function Wp(s,a,u){switch(u=s[u],u===void 0?s.push(a):u!==a&&(a.then(Ud,Ud),a=u),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,s===Md?Error(g(483)):s;default:if(typeof a.status=="string")a.then(Ud,Ud);else{if(s=Gn,s!==null&&100<s.shellSuspendCounter)throw Error(g(482));s=a,s.status="pending",s.then(function(m){if(a.status==="pending"){var T=a;T.status="fulfilled",T.value=m}},function(m){if(a.status==="pending"){var T=a;T.status="rejected",T.reason=m}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,s===Md?Error(g(483)):s}throw xd=a,Md}}var xd=null;function Kp(){if(xd===null)throw Error(g(459));var s=xd;return xd=null,s}var hu=null,Vd=0;function zp(s){var a=Vd;return Vd+=1,hu===null&&(hu=[]),Wp(hu,s,a)}function Bd(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function Yp(s,a){throw a.$$typeof===w?Error(g(525)):(s=Object.prototype.toString.call(a),Error(g(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function zT(s){var a=s._init;return a(s._payload)}function YT(s){function a(mt,ct){if(s){var gt=mt.deletions;gt===null?(mt.deletions=[ct],mt.flags|=16):gt.push(ct)}}function u(mt,ct){if(!s)return null;for(;ct!==null;)a(mt,ct),ct=ct.sibling;return null}function m(mt){for(var ct=new Map;mt!==null;)mt.key!==null?ct.set(mt.key,mt):ct.set(mt.index,mt),mt=mt.sibling;return ct}function T(mt,ct){return mt=yo(mt,ct),mt.index=0,mt.sibling=null,mt}function C(mt,ct,gt){return mt.index=gt,s?(gt=mt.alternate,gt!==null?(gt=gt.index,gt<ct?(mt.flags|=33554434,ct):gt):(mt.flags|=33554434,ct)):(mt.flags|=1048576,ct)}function x(mt){return s&&mt.alternate===null&&(mt.flags|=33554434),mt}function K(mt,ct,gt,jt){return ct===null||ct.tag!==6?(ct=Ar(gt,mt.mode,jt),ct.return=mt,ct):(ct=T(ct,gt),ct.return=mt,ct)}function $(mt,ct,gt,jt){var he=gt.type;return he===B?Pt(mt,ct,gt.props.children,jt,gt.key):ct!==null&&(ct.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===pt&&zT(he)===ct.type)?(ct=T(ct,gt.props),Bd(ct,gt),ct.return=mt,ct):(ct=Cf(gt.type,gt.key,gt.props,null,mt.mode,jt),Bd(ct,gt),ct.return=mt,ct)}function ut(mt,ct,gt,jt){return ct===null||ct.tag!==4||ct.stateNode.containerInfo!==gt.containerInfo||ct.stateNode.implementation!==gt.implementation?(ct=KE(gt,mt.mode,jt),ct.return=mt,ct):(ct=T(ct,gt.children||[]),ct.return=mt,ct)}function Pt(mt,ct,gt,jt,he){return ct===null||ct.tag!==7?(ct=ls(gt,mt.mode,jt,he),ct.return=mt,ct):(ct=T(ct,gt),ct.return=mt,ct)}function Kt(mt,ct,gt){if(typeof ct=="string"&&ct!==""||typeof ct=="number"||typeof ct=="bigint")return ct=Ar(""+ct,mt.mode,gt),ct.return=mt,ct;if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case N:return gt=Cf(ct.type,ct.key,ct.props,null,mt.mode,gt),Bd(gt,ct),gt.return=mt,gt;case k:return ct=KE(ct,mt.mode,gt),ct.return=mt,ct;case pt:var jt=ct._init;return ct=jt(ct._payload),Kt(mt,ct,gt)}if(fe(ct)||Yt(ct))return ct=ls(ct,mt.mode,gt,null),ct.return=mt,ct;if(typeof ct.then=="function")return Kt(mt,zp(ct),gt);if(ct.$$typeof===at)return Kt(mt,gf(mt,ct),gt);Yp(mt,ct)}return null}function vt(mt,ct,gt,jt){var he=ct!==null?ct.key:null;if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return he!==null?null:K(mt,ct,""+gt,jt);if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case N:return gt.key===he?$(mt,ct,gt,jt):null;case k:return gt.key===he?ut(mt,ct,gt,jt):null;case pt:return he=gt._init,gt=he(gt._payload),vt(mt,ct,gt,jt)}if(fe(gt)||Yt(gt))return he!==null?null:Pt(mt,ct,gt,jt,null);if(typeof gt.then=="function")return vt(mt,ct,zp(gt),jt);if(gt.$$typeof===at)return vt(mt,ct,gf(mt,gt),jt);Yp(mt,gt)}return null}function Nt(mt,ct,gt,jt,he){if(typeof jt=="string"&&jt!==""||typeof jt=="number"||typeof jt=="bigint")return mt=mt.get(gt)||null,K(ct,mt,""+jt,he);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case N:return mt=mt.get(jt.key===null?gt:jt.key)||null,$(ct,mt,jt,he);case k:return mt=mt.get(jt.key===null?gt:jt.key)||null,ut(ct,mt,jt,he);case pt:var an=jt._init;return jt=an(jt._payload),Nt(mt,ct,gt,jt,he)}if(fe(jt)||Yt(jt))return mt=mt.get(gt)||null,Pt(ct,mt,jt,he,null);if(typeof jt.then=="function")return Nt(mt,ct,gt,zp(jt),he);if(jt.$$typeof===at)return Nt(mt,ct,gt,gf(ct,jt),he);Yp(ct,jt)}return null}function Ee(mt,ct,gt,jt){for(var he=null,an=null,ve=ct,Ne=ct=0,tr=null;ve!==null&&Ne<gt.length;Ne++){ve.index>Ne?(tr=ve,ve=null):tr=ve.sibling;var Sn=vt(mt,ve,gt[Ne],jt);if(Sn===null){ve===null&&(ve=tr);break}s&&ve&&Sn.alternate===null&&a(mt,ve),ct=C(Sn,ct,Ne),an===null?he=Sn:an.sibling=Sn,an=Sn,ve=tr}if(Ne===gt.length)return u(mt,ve),Cn&&Hs(mt,Ne),he;if(ve===null){for(;Ne<gt.length;Ne++)ve=Kt(mt,gt[Ne],jt),ve!==null&&(ct=C(ve,ct,Ne),an===null?he=ve:an.sibling=ve,an=ve);return Cn&&Hs(mt,Ne),he}for(ve=m(ve);Ne<gt.length;Ne++)tr=Nt(ve,mt,Ne,gt[Ne],jt),tr!==null&&(s&&tr.alternate!==null&&ve.delete(tr.key===null?Ne:tr.key),ct=C(tr,ct,Ne),an===null?he=tr:an.sibling=tr,an=tr);return s&&ve.forEach(function(_a){return a(mt,_a)}),Cn&&Hs(mt,Ne),he}function Be(mt,ct,gt,jt){if(gt==null)throw Error(g(151));for(var he=null,an=null,ve=ct,Ne=ct=0,tr=null,Sn=gt.next();ve!==null&&!Sn.done;Ne++,Sn=gt.next()){ve.index>Ne?(tr=ve,ve=null):tr=ve.sibling;var _a=vt(mt,ve,Sn.value,jt);if(_a===null){ve===null&&(ve=tr);break}s&&ve&&_a.alternate===null&&a(mt,ve),ct=C(_a,ct,Ne),an===null?he=_a:an.sibling=_a,an=_a,ve=tr}if(Sn.done)return u(mt,ve),Cn&&Hs(mt,Ne),he;if(ve===null){for(;!Sn.done;Ne++,Sn=gt.next())Sn=Kt(mt,Sn.value,jt),Sn!==null&&(ct=C(Sn,ct,Ne),an===null?he=Sn:an.sibling=Sn,an=Sn);return Cn&&Hs(mt,Ne),he}for(ve=m(ve);!Sn.done;Ne++,Sn=gt.next())Sn=Nt(ve,mt,Ne,Sn.value,jt),Sn!==null&&(s&&Sn.alternate!==null&&ve.delete(Sn.key===null?Ne:Sn.key),ct=C(Sn,ct,Ne),an===null?he=Sn:an.sibling=Sn,an=Sn);return s&&ve.forEach(function(gg){return a(mt,gg)}),Cn&&Hs(mt,Ne),he}function vi(mt,ct,gt,jt){if(typeof gt=="object"&&gt!==null&&gt.type===B&&gt.key===null&&(gt=gt.props.children),typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case N:t:{for(var he=gt.key;ct!==null;){if(ct.key===he){if(he=gt.type,he===B){if(ct.tag===7){u(mt,ct.sibling),jt=T(ct,gt.props.children),jt.return=mt,mt=jt;break t}}else if(ct.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===pt&&zT(he)===ct.type){u(mt,ct.sibling),jt=T(ct,gt.props),Bd(jt,gt),jt.return=mt,mt=jt;break t}u(mt,ct);break}else a(mt,ct);ct=ct.sibling}gt.type===B?(jt=ls(gt.props.children,mt.mode,jt,gt.key),jt.return=mt,mt=jt):(jt=Cf(gt.type,gt.key,gt.props,null,mt.mode,jt),Bd(jt,gt),jt.return=mt,mt=jt)}return x(mt);case k:t:{for(he=gt.key;ct!==null;){if(ct.key===he)if(ct.tag===4&&ct.stateNode.containerInfo===gt.containerInfo&&ct.stateNode.implementation===gt.implementation){u(mt,ct.sibling),jt=T(ct,gt.children||[]),jt.return=mt,mt=jt;break t}else{u(mt,ct);break}else a(mt,ct);ct=ct.sibling}jt=KE(gt,mt.mode,jt),jt.return=mt,mt=jt}return x(mt);case pt:return he=gt._init,gt=he(gt._payload),vi(mt,ct,gt,jt)}if(fe(gt))return Ee(mt,ct,gt,jt);if(Yt(gt)){if(he=Yt(gt),typeof he!="function")throw Error(g(150));return gt=he.call(gt),Be(mt,ct,gt,jt)}if(typeof gt.then=="function")return vi(mt,ct,zp(gt),jt);if(gt.$$typeof===at)return vi(mt,ct,gf(mt,gt),jt);Yp(mt,gt)}return typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint"?(gt=""+gt,ct!==null&&ct.tag===6?(u(mt,ct.sibling),jt=T(ct,gt),jt.return=mt,mt=jt):(u(mt,ct),jt=Ar(gt,mt.mode,jt),jt.return=mt,mt=jt),x(mt)):u(mt,ct)}return function(mt,ct,gt,jt){try{Vd=0;var he=vi(mt,ct,gt,jt);return hu=null,he}catch(ve){if(ve===Md)throw ve;var an=bs(29,ve,null,mt.mode);return an.lanes=jt,an.return=mt,an}finally{}}}var $c=YT(!0),qT=YT(!1),pu=_e(null),qp=_e(0);function jd(s,a){s=Ro,Te(qp,s),Te(pu,a),Ro=s|a.baseLanes}function fu(){Te(qp,Ro),Te(pu,pu.current)}function Fd(){Ro=qp.current,Ge(pu),Ge(qp)}var vs=_e(null),fo=null;function Ja(s){var a=s.alternate;Te(Wi,Wi.current&1),Te(vs,s),fo===null&&(a===null||pu.current!==null||a.memoizedState!==null)&&(fo=s)}function sE(s){if(s.tag===22){if(Te(Wi,Wi.current),Te(vs,s),fo===null){var a=s.alternate;a!==null&&a.memoizedState!==null&&(fo=s)}}else ta()}function ta(){Te(Wi,Wi.current),Te(vs,vs.current)}function Ks(s){Ge(vs),fo===s&&(fo=null),Ge(Wi)}var Wi=_e(0);function Xp(s){for(var a=s;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Gd=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(u,m){s.push(m)}};this.abort=function(){a.aborted=!0,s.forEach(function(u){return u()})}},TA=h.unstable_scheduleCallback,vA=h.unstable_NormalPriority,Ki={$$typeof:at,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function oE(){return{controller:new Gd,data:new Map,refCount:0}}function Hd(s){s.refCount--,s.refCount===0&&TA(vA,function(){s.controller.abort()})}var Wd=null,Jp=0,mu=0,_u=null;function yA(s,a){if(Wd===null){var u=Wd=[];Jp=0,mu=gh(),_u={status:"pending",value:void 0,then:function(m){u.push(m)}}}return Jp++,a.then(Qp,Qp),a}function Qp(){if(--Jp===0&&Wd!==null){_u!==null&&(_u.status="fulfilled");var s=Wd;Wd=null,mu=0,_u=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function RA(s,a){var u=[],m={status:"pending",value:null,reason:null,then:function(T){u.push(T)}};return s.then(function(){m.status="fulfilled",m.value=a;for(var T=0;T<u.length;T++)(0,u[T])(a)},function(T){for(m.status="rejected",m.reason=T,T=0;T<u.length;T++)(0,u[T])(void 0)}),m}var XT=Xt.S;Xt.S=function(s,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&yA(s,a),XT!==null&&XT(s,a)};var mo=_e(null);function aE(){var s=mo.current;return s!==null?s:Gn.pooledCache}function Zp(s,a){a===null?Te(mo,mo.current):Te(mo,a.pool)}function JT(){var s=aE();return s===null?null:{parent:Ki._currentValue,pool:s}}var Qa=0,rn=null,Fn=null,pi=null,Kd=!1,Eu=!1,tl=!1,zd=0,Yd=0,gu=null,bA=0;function fi(){throw Error(g(321))}function qd(s,a){if(a===null)return!1;for(var u=0;u<a.length&&u<s.length;u++)if(!ns(s[u],a[u]))return!1;return!0}function $p(s,a,u,m,T,C){return Qa=C,rn=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Xt.H=s===null||s.memoizedState===null?Eo:$a,tl=!1,C=u(m,T),tl=!1,Eu&&(C=cE(a,u,m,T)),tf(s),C}function tf(s){Xt.H=_o;var a=Fn!==null&&Fn.next!==null;if(Qa=0,pi=Fn=rn=null,Kd=!1,Yd=0,gu=null,a)throw Error(g(300));s===null||Qi||(s=s.dependencies,s!==null&&Ef(s)&&(Qi=!0))}function cE(s,a,u,m){rn=s;var T=0;do{if(Eu&&(gu=null),Yd=0,Eu=!1,25<=T)throw Error(g(301));if(T+=1,pi=Fn=null,s.updateQueue!=null){var C=s.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}Xt.H=ys,C=a(u,m)}while(Eu);return C}function QT(){var s=Xt.H,a=s.useState()[0];return a=typeof a.then=="function"?Xd(a):a,s=s.useState()[0],(Fn!==null?Fn.memoizedState:null)!==s&&(rn.flags|=1024),a}function Su(){var s=zd!==0;return zd=0,s}function el(s,a,u){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~u}function lE(s){if(Kd){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Kd=!1}Qa=0,pi=Fn=rn=null,Eu=!1,Yd=zd=0,gu=null}function Fr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pi===null?rn.memoizedState=pi=s:pi=pi.next=s,pi}function Ai(){if(Fn===null){var s=rn.alternate;s=s!==null?s.memoizedState:null}else s=Fn.next;var a=pi===null?rn.memoizedState:pi.next;if(a!==null)pi=a,Fn=s;else{if(s===null)throw rn.alternate===null?Error(g(467)):Error(g(310));Fn=s,s={memoizedState:Fn.memoizedState,baseState:Fn.baseState,baseQueue:Fn.baseQueue,queue:Fn.queue,next:null},pi===null?rn.memoizedState=pi=s:pi=pi.next=s}return pi}var ef;ef=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function Xd(s){var a=Yd;return Yd+=1,gu===null&&(gu=[]),s=Wp(gu,s,a),a=rn,(pi===null?a.memoizedState:pi.next)===null&&(a=a.alternate,Xt.H=a===null||a.memoizedState===null?Eo:$a),s}function Jd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Xd(s);if(s.$$typeof===at)return fr(s)}throw Error(g(438,String(s)))}function uE(s){var a=null,u=rn.updateQueue;if(u!==null&&(a=u.memoCache),a==null){var m=rn.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(a={data:m.data.map(function(T){return T.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),u===null&&(u=ef(),rn.updateQueue=u),u.memoCache=a,u=a.data[a.index],u===void 0)for(u=a.data[a.index]=Array(s),m=0;m<s;m++)u[m]=bt;return a.index++,u}function ea(s,a){return typeof a=="function"?a(s):a}function nf(s){var a=Ai();return dE(a,Fn,s)}function dE(s,a,u){var m=s.queue;if(m===null)throw Error(g(311));m.lastRenderedReducer=u;var T=s.baseQueue,C=m.pending;if(C!==null){if(T!==null){var x=T.next;T.next=C.next,C.next=x}a.baseQueue=T=C,m.pending=null}if(C=s.baseState,T===null)s.memoizedState=C;else{a=T.next;var K=x=null,$=null,ut=a,Pt=!1;do{var Kt=ut.lane&-536870913;if(Kt!==ut.lane?(mn&Kt)===Kt:(Qa&Kt)===Kt){var vt=ut.revertLane;if(vt===0)$!==null&&($=$.next={lane:0,revertLane:0,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null}),Kt===mu&&(Pt=!0);else if((Qa&vt)===vt){ut=ut.next,vt===mu&&(Pt=!0);continue}else Kt={lane:0,revertLane:ut.revertLane,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},$===null?(K=$=Kt,x=C):$=$.next=Kt,rn.lanes|=vt,bo|=vt;Kt=ut.action,tl&&u(C,Kt),C=ut.hasEagerState?ut.eagerState:u(C,Kt)}else vt={lane:Kt,revertLane:ut.revertLane,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},$===null?(K=$=vt,x=C):$=$.next=vt,rn.lanes|=Kt,bo|=Kt;ut=ut.next}while(ut!==null&&ut!==a);if($===null?x=C:$.next=K,!ns(C,s.memoizedState)&&(Qi=!0,Pt&&(u=_u,u!==null)))throw u;s.memoizedState=C,s.baseState=x,s.baseQueue=$,m.lastRenderedState=C}return T===null&&(m.lanes=0),[s.memoizedState,m.dispatch]}function hE(s){var a=Ai(),u=a.queue;if(u===null)throw Error(g(311));u.lastRenderedReducer=s;var m=u.dispatch,T=u.pending,C=a.memoizedState;if(T!==null){u.pending=null;var x=T=T.next;do C=s(C,x.action),x=x.next;while(x!==T);ns(C,a.memoizedState)||(Qi=!0),a.memoizedState=C,a.baseQueue===null&&(a.baseState=C),u.lastRenderedState=C}return[C,m]}function ZT(s,a,u){var m=rn,T=Ai(),C=Cn;if(C){if(u===void 0)throw Error(g(407));u=u()}else u=a();var x=!ns((Fn||T).memoizedState,u);if(x&&(T.memoizedState=u,Qi=!0),T=T.queue,mE($T.bind(null,m,T,s),[s]),T.getSnapshot!==a||x||pi!==null&&pi.memoizedState.tag&1){if(m.flags|=2048,vu(9,Za.bind(null,m,T,u,a),{destroy:void 0},null),Gn===null)throw Error(g(349));C||Qa&60||pE(m,a,u)}return u}function pE(s,a,u){s.flags|=16384,s={getSnapshot:a,value:u},a=rn.updateQueue,a===null?(a=ef(),rn.updateQueue=a,a.stores=[s]):(u=a.stores,u===null?a.stores=[s]:u.push(s))}function Za(s,a,u,m){a.value=u,a.getSnapshot=m,tv(a)&&ev(s)}function $T(s,a,u){return u(function(){tv(a)&&ev(s)})}function tv(s){var a=s.getSnapshot;s=s.value;try{var u=a();return!ns(s,u)}catch{return!0}}function ev(s){var a=gs(s,2);a!==null&&Ir(a,s,2)}function rf(s){var a=Fr();if(typeof s=="function"){var u=s;if(s=u(),tl){Va(!0);try{u()}finally{Va(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ea,lastRenderedState:s},a}function nv(s,a,u,m){return s.baseState=u,dE(s,Fn,typeof m=="function"?m:ea)}function iv(s,a,u,m,T){if(uf(s))throw Error(g(485));if(s=a.action,s!==null){var C={payload:T,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(x){C.listeners.push(x)}};Xt.T!==null?u(!0):C.isTransition=!1,m(C),u=a.pending,u===null?(C.next=a.pending=C,rv(a,C)):(C.next=u.next,a.pending=u.next=C)}}function rv(s,a){var u=a.action,m=a.payload,T=s.state;if(a.isTransition){var C=Xt.T,x={};Xt.T=x;try{var K=u(T,m),$=Xt.S;$!==null&&$(x,K),sv(s,a,K)}catch(ut){Tu(s,a,ut)}finally{Xt.T=C}}else try{C=u(T,m),sv(s,a,C)}catch(ut){Tu(s,a,ut)}}function sv(s,a,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(m){ov(s,a,m)},function(m){return Tu(s,a,m)}):ov(s,a,u)}function ov(s,a,u){a.status="fulfilled",a.value=u,av(a),s.state=u,a=s.pending,a!==null&&(u=a.next,u===a?s.pending=null:(u=u.next,a.next=u,rv(s,u)))}function Tu(s,a,u){var m=s.pending;if(s.pending=null,m!==null){m=m.next;do a.status="rejected",a.reason=u,av(a),a=a.next;while(a!==m)}s.action=null}function av(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function cv(s,a){return a}function lv(s,a){if(Cn){var u=Gn.formState;if(u!==null){t:{var m=rn;if(Cn){if(sr){e:{for(var T=sr,C=Ts;T.nodeType!==8;){if(!C){T=null;break e}if(T=Ys(T.nextSibling),T===null){T=null;break e}}C=T.data,T=C==="F!"||C==="F"?T:null}if(T){sr=Ys(T.nextSibling),m=T.data==="F!";break t}}qa(m)}m=!1}m&&(a=u[0])}}return u=Fr(),u.memoizedState=u.baseState=a,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cv,lastRenderedState:a},u.queue=m,u=lf.bind(null,rn,m),m.dispatch=u,m=rf(!1),C=EE.bind(null,rn,!1,m.queue),m=Fr(),T={state:a,dispatch:null,action:s,pending:null},m.queue=T,u=iv.bind(null,rn,T,C,u),T.dispatch=u,m.memoizedState=s,[a,u,!1]}function uv(s){var a=Ai();return dv(a,Fn,s)}function dv(s,a,u){a=dE(s,a,cv)[0],s=nf(ea)[0],a=typeof a=="object"&&a!==null&&typeof a.then=="function"?Xd(a):a;var m=Ai(),T=m.queue,C=T.dispatch;return u!==m.memoizedState&&(rn.flags|=2048,vu(9,CA.bind(null,T,u),{destroy:void 0},null)),[a,C,s]}function CA(s,a){s.action=a}function sf(s){var a=Ai(),u=Fn;if(u!==null)return dv(a,u,s);Ai(),a=a.memoizedState,u=Ai();var m=u.queue.dispatch;return u.memoizedState=s,[a,m,!1]}function vu(s,a,u,m){return s={tag:s,create:a,inst:u,deps:m,next:null},a=rn.updateQueue,a===null&&(a=ef(),rn.updateQueue=a),u=a.lastEffect,u===null?a.lastEffect=s.next=s:(m=u.next,u.next=s,s.next=m,a.lastEffect=s),s}function fE(){return Ai().memoizedState}function of(s,a,u,m){var T=Fr();rn.flags|=s,T.memoizedState=vu(1|a,u,{destroy:void 0},m===void 0?null:m)}function Qd(s,a,u,m){var T=Ai();m=m===void 0?null:m;var C=T.memoizedState.inst;Fn!==null&&m!==null&&qd(m,Fn.memoizedState.deps)?T.memoizedState=vu(a,u,C,m):(rn.flags|=s,T.memoizedState=vu(1|a,u,C,m))}function hv(s,a){of(8390656,8,s,a)}function mE(s,a){Qd(2048,8,s,a)}function pv(s,a){return Qd(4,2,s,a)}function fv(s,a){return Qd(4,4,s,a)}function mv(s,a){if(typeof a=="function"){s=s();var u=a(s);return function(){typeof u=="function"?u():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function _v(s,a,u){u=u!=null?u.concat([s]):null,Qd(4,4,mv.bind(null,a,s),u)}function af(){}function Ev(s,a){var u=Ai();a=a===void 0?null:a;var m=u.memoizedState;return a!==null&&qd(a,m[1])?m[0]:(u.memoizedState=[s,a],s)}function gv(s,a){var u=Ai();a=a===void 0?null:a;var m=u.memoizedState;if(a!==null&&qd(a,m[1]))return m[0];if(m=s(),tl){Va(!0);try{s()}finally{Va(!1)}}return u.memoizedState=[m,a],m}function cf(s,a,u){return u===void 0||Qa&1073741824?s.memoizedState=a:(s.memoizedState=u,s=Nf(),rn.lanes|=s,bo|=s,u)}function Sv(s,a,u,m){return ns(u,a)?u:pu.current!==null?(s=cf(s,u,m),ns(s,a)||(Qi=!0),s):Qa&42?(s=Nf(),rn.lanes|=s,bo|=s,a):(Qi=!0,s.memoizedState=u)}function Zd(s,a,u,m,T){var C=Qt.p;Qt.p=C!==0&&8>C?C:8;var x=Xt.T,K={};Xt.T=K,EE(s,!1,a,u);try{var $=T(),ut=Xt.S;if(ut!==null&&ut(K,$),$!==null&&typeof $=="object"&&typeof $.then=="function"){var Pt=RA($,m);il(s,a,Pt,Hr(s))}else il(s,a,m,Hr(s))}catch(Kt){il(s,a,{then:function(){},status:"rejected",reason:Kt},Hr())}finally{Qt.p=C,Xt.T=x}}function Tv(){}function nl(s,a,u,m){if(s.tag!==5)throw Error(g(476));var T=vv(s).queue;Zd(s,T,a,We,u===null?Tv:function(){return yv(s),u(m)})}function vv(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:We,baseState:We,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ea,lastRenderedState:We},next:null};var u={};return a.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ea,lastRenderedState:u},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function yv(s){var a=vv(s).next.queue;il(s,a,{},Hr())}function _E(){return fr(Rh)}function Rv(){return Ai().memoizedState}function $d(){return Ai().memoizedState}function AA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var u=Hr();s=rc(u);var m=sc(a,s,u);m!==null&&(Ir(m,a,u),sh(m,a,u)),a={cache:oE()},s.payload=a;return}a=a.return}}function bv(s,a,u){var m=Hr();u={lane:m,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},uf(s)?Cv(a,u):(u=cu(s,a,u,m),u!==null&&(Ir(u,s,m),Av(u,a,m)))}function lf(s,a,u){var m=Hr();il(s,a,u,m)}function il(s,a,u,m){var T={lane:m,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(uf(s))Cv(a,T);else{var C=s.alternate;if(s.lanes===0&&(C===null||C.lanes===0)&&(C=a.lastRenderedReducer,C!==null))try{var x=a.lastRenderedState,K=C(x,u);if(T.hasEagerState=!0,T.eagerState=K,ns(K,x))return Bp(s,a,T,0),Gn===null&&Vp(),!1}catch{}finally{}if(u=cu(s,a,T,m),u!==null)return Ir(u,s,m),Av(u,a,m),!0}return!1}function EE(s,a,u,m){if(m={lane:2,revertLane:gh(),action:m,hasEagerState:!1,eagerState:null,next:null},uf(s)){if(a)throw Error(g(479))}else a=cu(s,u,m,2),a!==null&&Ir(a,s,2)}function uf(s){var a=s.alternate;return s===rn||a!==null&&a===rn}function Cv(s,a){Eu=Kd=!0;var u=s.pending;u===null?a.next=a:(a.next=u.next,u.next=a),s.pending=a}function Av(s,a,u){if(u&4194176){var m=a.lanes;m&=s.pendingLanes,u|=m,a.lanes=u,yd(s,u)}}var _o={readContext:fr,use:Jd,useCallback:fi,useContext:fi,useEffect:fi,useImperativeHandle:fi,useLayoutEffect:fi,useInsertionEffect:fi,useMemo:fi,useReducer:fi,useRef:fi,useState:fi,useDebugValue:fi,useDeferredValue:fi,useTransition:fi,useSyncExternalStore:fi,useId:fi};_o.useCacheRefresh=fi,_o.useMemoCache=fi,_o.useHostTransitionStatus=fi,_o.useFormState=fi,_o.useActionState=fi,_o.useOptimistic=fi;var Eo={readContext:fr,use:Jd,useCallback:function(s,a){return Fr().memoizedState=[s,a===void 0?null:a],s},useContext:fr,useEffect:hv,useImperativeHandle:function(s,a,u){u=u!=null?u.concat([s]):null,of(4194308,4,mv.bind(null,a,s),u)},useLayoutEffect:function(s,a){return of(4194308,4,s,a)},useInsertionEffect:function(s,a){of(4,2,s,a)},useMemo:function(s,a){var u=Fr();a=a===void 0?null:a;var m=s();if(tl){Va(!0);try{s()}finally{Va(!1)}}return u.memoizedState=[m,a],m},useReducer:function(s,a,u){var m=Fr();if(u!==void 0){var T=u(a);if(tl){Va(!0);try{u(a)}finally{Va(!1)}}}else T=a;return m.memoizedState=m.baseState=T,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:T},m.queue=s,s=s.dispatch=bv.bind(null,rn,s),[m.memoizedState,s]},useRef:function(s){var a=Fr();return s={current:s},a.memoizedState=s},useState:function(s){s=rf(s);var a=s.queue,u=lf.bind(null,rn,a);return a.dispatch=u,[s.memoizedState,u]},useDebugValue:af,useDeferredValue:function(s,a){var u=Fr();return cf(u,s,a)},useTransition:function(){var s=rf(!1);return s=Zd.bind(null,rn,s.queue,!0,!1),Fr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,u){var m=rn,T=Fr();if(Cn){if(u===void 0)throw Error(g(407));u=u()}else{if(u=a(),Gn===null)throw Error(g(349));mn&60||pE(m,a,u)}T.memoizedState=u;var C={value:u,getSnapshot:a};return T.queue=C,hv($T.bind(null,m,C,s),[s]),m.flags|=2048,vu(9,Za.bind(null,m,C,u,a),{destroy:void 0},null),u},useId:function(){var s=Fr(),a=Gn.identifierPrefix;if(Cn){var u=$o,m=Hi;u=(m&~(1<<32-ts(m)-1)).toString(32)+u,a=":"+a+"R"+u,u=zd++,0<u&&(a+="H"+u.toString(32)),a+=":"}else u=bA++,a=":"+a+"r"+u.toString(32)+":";return s.memoizedState=a},useCacheRefresh:function(){return Fr().memoizedState=AA.bind(null,rn)}};Eo.useMemoCache=uE,Eo.useHostTransitionStatus=_E,Eo.useFormState=lv,Eo.useActionState=lv,Eo.useOptimistic=function(s){var a=Fr();a.memoizedState=a.baseState=s;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=u,a=EE.bind(null,rn,!0,u),u.dispatch=a,[s,a]};var $a={readContext:fr,use:Jd,useCallback:Ev,useContext:fr,useEffect:mE,useImperativeHandle:_v,useInsertionEffect:pv,useLayoutEffect:fv,useMemo:gv,useReducer:nf,useRef:fE,useState:function(){return nf(ea)},useDebugValue:af,useDeferredValue:function(s,a){var u=Ai();return Sv(u,Fn.memoizedState,s,a)},useTransition:function(){var s=nf(ea)[0],a=Ai().memoizedState;return[typeof s=="boolean"?s:Xd(s),a]},useSyncExternalStore:ZT,useId:Rv};$a.useCacheRefresh=$d,$a.useMemoCache=uE,$a.useHostTransitionStatus=_E,$a.useFormState=uv,$a.useActionState=uv,$a.useOptimistic=function(s,a){var u=Ai();return nv(u,Fn,s,a)};var ys={readContext:fr,use:Jd,useCallback:Ev,useContext:fr,useEffect:mE,useImperativeHandle:_v,useInsertionEffect:pv,useLayoutEffect:fv,useMemo:gv,useReducer:hE,useRef:fE,useState:function(){return hE(ea)},useDebugValue:af,useDeferredValue:function(s,a){var u=Ai();return Fn===null?cf(u,s,a):Sv(u,Fn.memoizedState,s,a)},useTransition:function(){var s=hE(ea)[0],a=Ai().memoizedState;return[typeof s=="boolean"?s:Xd(s),a]},useSyncExternalStore:ZT,useId:Rv};ys.useCacheRefresh=$d,ys.useMemoCache=uE,ys.useHostTransitionStatus=_E,ys.useFormState=sf,ys.useActionState=sf,ys.useOptimistic=function(s,a){var u=Ai();return Fn!==null?nv(u,Fn,s,a):(u.baseState=s,[s,u.queue.dispatch])};function th(s,a,u,m){a=s.memoizedState,u=u(m,a),u=u==null?a:se({},a,u),s.memoizedState=u,s.lanes===0&&(s.updateQueue.baseState=u)}var yu={isMounted:function(s){return(s=s._reactInternals)?Mt(s)===s:!1},enqueueSetState:function(s,a,u){s=s._reactInternals;var m=Hr(),T=rc(m);T.payload=a,u!=null&&(T.callback=u),a=sc(s,T,m),a!==null&&(Ir(a,s,m),sh(a,s,m))},enqueueReplaceState:function(s,a,u){s=s._reactInternals;var m=Hr(),T=rc(m);T.tag=1,T.payload=a,u!=null&&(T.callback=u),a=sc(s,T,m),a!==null&&(Ir(a,s,m),sh(a,s,m))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var u=Hr(),m=rc(u);m.tag=2,a!=null&&(m.callback=a),a=sc(s,m,u),a!==null&&(Ir(a,s,u),sh(a,s,u))}};function Ru(s,a,u,m,T,C,x){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(m,C,x):a.prototype&&a.prototype.isPureReactComponent?!Dd(u,m)||!Dd(T,C):!0}function eh(s,a,u,m){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,m),a.state!==s&&yu.enqueueReplaceState(a,a.state,null)}function rl(s,a){var u=a;if("ref"in a){u={};for(var m in a)m!=="ref"&&(u[m]=a[m])}if(s=s.defaultProps){u===a&&(u=se({},u));for(var T in s)u[T]===void 0&&(u[T]=s[T])}return u}var nh=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function wv(s){nh(s)}function gE(s){console.error(s)}function Iv(s){nh(s)}function df(s,a){try{var u=s.onUncaughtError;u(a.value,{componentStack:a.stack})}catch(m){setTimeout(function(){throw m})}}function hf(s,a,u){try{var m=s.onCaughtError;m(u.value,{componentStack:u.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(T){setTimeout(function(){throw T})}}function ih(s,a,u){return u=rc(u),u.tag=3,u.payload={element:null},u.callback=function(){df(s,a)},u}function Ov(s){return s=rc(s),s.tag=3,s}function Nv(s,a,u,m){var T=u.type.getDerivedStateFromError;if(typeof T=="function"){var C=m.value;s.payload=function(){return T(C)},s.callback=function(){hf(a,u,m)}}var x=u.stateNode;x!==null&&typeof x.componentDidCatch=="function"&&(s.callback=function(){hf(a,u,m),typeof T!="function"&&(Ao===null?Ao=new Set([this]):Ao.add(this));var K=m.stack;this.componentDidCatch(m.value,{componentStack:K!==null?K:""})})}function Dv(s,a,u,m,T){if(u.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(a=u.alternate,a!==null&&rs(a,u,T,!0),u=vs.current,u!==null){switch(u.tag){case 13:return fo===null?Lf():u.alternate===null&&di===0&&(di=3),u.flags&=-257,u.flags|=65536,u.lanes=T,m===rE?u.flags|=16384:(a=u.updateQueue,a===null?u.updateQueue=new Set([m]):a.add(m),Cs(s,m,T)),!1;case 22:return u.flags|=65536,m===rE?u.flags|=16384:(a=u.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([m])},u.updateQueue=a):(u=a.retryQueue,u===null?a.retryQueue=new Set([m]):u.add(m)),Cs(s,m,T)),!1}throw Error(g(435,u.tag))}return Cs(s,m,T),Lf(),!1}if(Cn)return a=vs.current,a!==null?(!(a.flags&65536)&&(a.flags|=256),a.flags|=65536,a.lanes=T,m!==nE&&(s=Error(g(422),{cause:m}),kd(Cr(s,u)))):(m!==nE&&(a=Error(g(423),{cause:m}),kd(Cr(a,u))),s=s.current.alternate,s.flags|=65536,T&=-T,s.lanes|=T,m=Cr(m,u),T=ih(s.stateNode,m,T),kE(s,T),di!==4&&(di=2)),!1;var C=Error(g(520),{cause:m});if(C=Cr(C,u),hh===null?hh=[C]:hh.push(C),di!==4&&(di=2),a===null)return!0;m=Cr(m,u),u=a;do{switch(u.tag){case 3:return u.flags|=65536,s=T&-T,u.lanes|=s,s=ih(u.stateNode,m,s),kE(u,s),!1;case 1:if(a=u.type,C=u.stateNode,(u.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Ao===null||!Ao.has(C))))return u.flags|=65536,T&=-T,u.lanes|=T,T=Ov(T),Nv(T,s,u,m),kE(u,T),!1}u=u.return}while(u!==null);return!1}var pf=Error(g(461)),Qi=!1;function ei(s,a,u,m){a.child=s===null?qT(a,null,u,m):$c(a,s.child,u,m)}function sl(s,a,u,m,T){u=u.render;var C=a.ref;if("ref"in m){var x={};for(var K in m)K!=="ref"&&(x[K]=m[K])}else x=m;return cl(a),m=$p(s,a,u,x,C,T),K=Su(),s!==null&&!Qi?(el(s,a,T),So(s,a,T)):(Cn&&K&&tE(a),a.flags|=1,ei(s,a,m,T),a.child)}function tc(s,a,u,m,T){if(s===null){var C=u.type;return typeof C=="function"&&!HE(C)&&C.defaultProps===void 0&&u.compare===null?(a.tag=15,a.type=C,SE(s,a,C,m,T)):(s=Cf(u.type,null,m,a,a.mode,T),s.ref=a.ref,s.return=a,a.child=s)}if(C=s.child,!NE(s,T)){var x=C.memoizedProps;if(u=u.compare,u=u!==null?u:Dd,u(x,m)&&s.ref===a.ref)return So(s,a,T)}return a.flags|=1,s=yo(C,m),s.ref=a.ref,s.return=a,a.child=s}function SE(s,a,u,m,T){if(s!==null){var C=s.memoizedProps;if(Dd(C,m)&&s.ref===a.ref)if(Qi=!1,a.pendingProps=m=C,NE(s,T))s.flags&131072&&(Qi=!0);else return a.lanes=s.lanes,So(s,a,T)}return vE(s,a,u,m,T)}function TE(s,a,u){var m=a.pendingProps,T=m.children,C=(a.stateNode._pendingVisibility&2)!==0,x=s!==null?s.memoizedState:null;if(ol(s,a),m.mode==="hidden"||C){if(a.flags&128){if(m=x!==null?x.baseLanes|u:u,s!==null){for(T=a.child=s.child,C=0;T!==null;)C=C|T.lanes|T.childLanes,T=T.sibling;a.childLanes=C&~m}else a.childLanes=0,a.child=null;return ec(s,a,m,u)}if(u&536870912)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&Zp(a,x!==null?x.cachePool:null),x!==null?jd(a,x):fu(),sE(a);else return a.lanes=a.childLanes=536870912,ec(s,a,x!==null?x.baseLanes|u:u,u)}else x!==null?(Zp(a,x.cachePool),jd(a,x),ta(),a.memoizedState=null):(s!==null&&Zp(a,null),fu(),ta());return ei(s,a,T,u),a.child}function ec(s,a,u,m){var T=aE();return T=T===null?null:{parent:Ki._currentValue,pool:T},a.memoizedState={baseLanes:u,cachePool:T},s!==null&&Zp(a,null),fu(),sE(a),s!==null&&rs(s,a,m,!0),null}function ol(s,a){var u=a.ref;if(u===null)s!==null&&s.ref!==null&&(a.flags|=2097664);else{if(typeof u!="function"&&typeof u!="object")throw Error(g(284));(s===null||s.ref!==u)&&(a.flags|=2097664)}}function vE(s,a,u,m,T){return cl(a),u=$p(s,a,u,m,void 0,T),m=Su(),s!==null&&!Qi?(el(s,a,T),So(s,a,T)):(Cn&&m&&tE(a),a.flags|=1,ei(s,a,u,T),a.child)}function yE(s,a,u,m,T,C){return cl(a),a.updateQueue=null,u=cE(a,m,u,T),tf(s),m=Su(),s!==null&&!Qi?(el(s,a,C),So(s,a,C)):(Cn&&m&&tE(a),a.flags|=1,ei(s,a,u,C),a.child)}function Pv(s,a,u,m,T){if(cl(a),a.stateNode===null){var C=Zo,x=u.contextType;typeof x=="object"&&x!==null&&(C=fr(x)),C=new u(m,C),a.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=yu,a.stateNode=C,C._reactInternals=a,C=a.stateNode,C.props=m,C.state=a.memoizedState,C.refs={},rh(a),x=u.contextType,C.context=typeof x=="object"&&x!==null?fr(x):Zo,C.state=a.memoizedState,x=u.getDerivedStateFromProps,typeof x=="function"&&(th(a,u,x,m),C.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(x=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),x!==C.state&&yu.enqueueReplaceState(C,C.state,null),Cu(a,m,C,T),bu(),C.state=a.memoizedState),typeof C.componentDidMount=="function"&&(a.flags|=4194308),m=!0}else if(s===null){C=a.stateNode;var K=a.memoizedProps,$=rl(u,K);C.props=$;var ut=C.context,Pt=u.contextType;x=Zo,typeof Pt=="object"&&Pt!==null&&(x=fr(Pt));var Kt=u.getDerivedStateFromProps;Pt=typeof Kt=="function"||typeof C.getSnapshotBeforeUpdate=="function",K=a.pendingProps!==K,Pt||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(K||ut!==x)&&eh(a,C,m,x),ic=!1;var vt=a.memoizedState;C.state=vt,Cu(a,m,C,T),bu(),ut=a.memoizedState,K||vt!==ut||ic?(typeof Kt=="function"&&(th(a,u,Kt,m),ut=a.memoizedState),($=ic||Ru(a,u,$,m,vt,ut,x))?(Pt||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(a.flags|=4194308)):(typeof C.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=ut),C.props=m,C.state=ut,C.context=x,m=$):(typeof C.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{C=a.stateNode,LE(s,a),x=a.memoizedProps,Pt=rl(u,x),C.props=Pt,Kt=a.pendingProps,vt=C.context,ut=u.contextType,$=Zo,typeof ut=="object"&&ut!==null&&($=fr(ut)),K=u.getDerivedStateFromProps,(ut=typeof K=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(x!==Kt||vt!==$)&&eh(a,C,m,$),ic=!1,vt=a.memoizedState,C.state=vt,Cu(a,m,C,T),bu();var Nt=a.memoizedState;x!==Kt||vt!==Nt||ic||s!==null&&s.dependencies!==null&&Ef(s.dependencies)?(typeof K=="function"&&(th(a,u,K,m),Nt=a.memoizedState),(Pt=ic||Ru(a,u,Pt,m,vt,Nt,$)||s!==null&&s.dependencies!==null&&Ef(s.dependencies))?(ut||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(m,Nt,$),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(m,Nt,$)),typeof C.componentDidUpdate=="function"&&(a.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof C.componentDidUpdate!="function"||x===s.memoizedProps&&vt===s.memoizedState||(a.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||x===s.memoizedProps&&vt===s.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=Nt),C.props=m,C.state=Nt,C.context=$,m=Pt):(typeof C.componentDidUpdate!="function"||x===s.memoizedProps&&vt===s.memoizedState||(a.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||x===s.memoizedProps&&vt===s.memoizedState||(a.flags|=1024),m=!1)}return C=m,ol(s,a),m=(a.flags&128)!==0,C||m?(C=a.stateNode,u=m&&typeof u.getDerivedStateFromError!="function"?null:C.render(),a.flags|=1,s!==null&&m?(a.child=$c(a,s.child,null,T),a.child=$c(a,null,u,T)):ei(s,a,u,T),a.memoizedState=C.state,s=a.child):s=So(s,a,T),s}function RE(s,a,u,m){return Xa(),a.flags|=256,ei(s,a,u,m),a.child}var ff={dehydrated:null,treeContext:null,retryLane:0};function bE(s){return{baseLanes:s,cachePool:JT()}}function go(s,a,u){return s=s!==null?s.childLanes&~u:0,a&&(s|=wr),s}function Lv(s,a,u){var m=a.pendingProps,T=!1,C=(a.flags&128)!==0,x;if((x=C)||(x=s!==null&&s.memoizedState===null?!1:(Wi.current&2)!==0),x&&(T=!0,a.flags&=-129),x=(a.flags&32)!==0,a.flags&=-33,s===null){if(Cn){if(T?Ja(a):ta(),Cn){var K=sr,$;if($=K){t:{for($=K,K=Ts;$.nodeType!==8;){if(!K){K=null;break t}if($=Ys($.nextSibling),$===null){K=null;break t}}K=$}K!==null?(a.memoizedState={dehydrated:K,treeContext:Ya!==null?{id:Hi,overflow:$o}:null,retryLane:536870912},$=bs(18,null,null,0),$.stateNode=K,$.return=a,a.child=$,pr=a,sr=null,$=!0):$=!1}$||qa(a)}if(K=a.memoizedState,K!==null&&(K=K.dehydrated,K!==null))return K.data==="$!"?a.lanes=16:a.lanes=536870912,null;Ks(a)}return K=m.children,m=m.fallback,T?(ta(),T=a.mode,K=AE({mode:"hidden",children:K},T),m=ls(m,T,u,null),K.return=a,m.return=a,K.sibling=m,a.child=K,T=a.child,T.memoizedState=bE(u),T.childLanes=go(s,x,u),a.memoizedState=ff,m):(Ja(a),CE(a,K))}if($=s.memoizedState,$!==null&&(K=$.dehydrated,K!==null)){if(C)a.flags&256?(Ja(a),a.flags&=-257,a=wE(s,a,u)):a.memoizedState!==null?(ta(),a.child=s.child,a.flags|=128,a=null):(ta(),T=m.fallback,K=a.mode,m=AE({mode:"visible",children:m.children},K),T=ls(T,K,u,null),T.flags|=2,m.return=a,T.return=a,m.sibling=T,a.child=m,$c(a,s.child,null,u),m=a.child,m.memoizedState=bE(u),m.childLanes=go(s,x,u),a.memoizedState=ff,a=T);else if(Ja(a),K.data==="$!"){if(x=K.nextSibling&&K.nextSibling.dataset,x)var ut=x.dgst;x=ut,m=Error(g(419)),m.stack="",m.digest=x,kd({value:m,source:null,stack:null}),a=wE(s,a,u)}else if(Qi||rs(s,a,u,!1),x=(u&s.childLanes)!==0,Qi||x){if(x=Gn,x!==null){if(m=u&-u,m&42)m=1;else switch(m){case 2:m=1;break;case 8:m=4;break;case 32:m=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:m=64;break;case 268435456:m=134217728;break;default:m=0}if(m=m&(x.suspendedLanes|u)?0:m,m!==0&&m!==$.retryLane)throw $.retryLane=m,gs(s,m),Ir(x,s,m),pf}K.data==="$?"||Lf(),a=wE(s,a,u)}else K.data==="$?"?(a.flags|=128,a.child=s.child,a=LA.bind(null,s),K._reactRetry=a,a=null):(s=$.treeContext,sr=Ys(K.nextSibling),pr=a,Cn=!0,Ws=null,Ts=!1,s!==null&&(jr[Ss++]=Hi,jr[Ss++]=$o,jr[Ss++]=Ya,Hi=s.id,$o=s.overflow,Ya=a),a=CE(a,m.children),a.flags|=4096);return a}return T?(ta(),T=m.fallback,K=a.mode,$=s.child,ut=$.sibling,m=yo($,{mode:"hidden",children:m.children}),m.subtreeFlags=$.subtreeFlags&31457280,ut!==null?T=yo(ut,T):(T=ls(T,K,u,null),T.flags|=2),T.return=a,m.return=a,m.sibling=T,a.child=m,m=T,T=a.child,K=s.child.memoizedState,K===null?K=bE(u):($=K.cachePool,$!==null?(ut=Ki._currentValue,$=$.parent!==ut?{parent:ut,pool:ut}:$):$=JT(),K={baseLanes:K.baseLanes|u,cachePool:$}),T.memoizedState=K,T.childLanes=go(s,x,u),a.memoizedState=ff,m):(Ja(a),u=s.child,s=u.sibling,u=yo(u,{mode:"visible",children:m.children}),u.return=a,u.sibling=null,s!==null&&(x=a.deletions,x===null?(a.deletions=[s],a.flags|=16):x.push(s)),a.child=u,a.memoizedState=null,u)}function CE(s,a){return a=AE({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function AE(s,a){return WE(s,a,0,null)}function wE(s,a,u){return $c(a,s.child,null,u),s=CE(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function IE(s,a,u){s.lanes|=a;var m=s.alternate;m!==null&&(m.lanes|=a),PE(s.return,a,u)}function OE(s,a,u,m,T){var C=s.memoizedState;C===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:u,tailMode:T}:(C.isBackwards=a,C.rendering=null,C.renderingStartTime=0,C.last=m,C.tail=u,C.tailMode=T)}function mf(s,a,u){var m=a.pendingProps,T=m.revealOrder,C=m.tail;if(ei(s,a,m.children,u),m=Wi.current,m&2)m=m&1|2,a.flags|=128;else{if(s!==null&&s.flags&128)t:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&IE(s,u,a);else if(s.tag===19)IE(s,u,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break t;for(;s.sibling===null;){if(s.return===null||s.return===a)break t;s=s.return}s.sibling.return=s.return,s=s.sibling}m&=1}switch(Te(Wi,m),T){case"forwards":for(u=a.child,T=null;u!==null;)s=u.alternate,s!==null&&Xp(s)===null&&(T=u),u=u.sibling;u=T,u===null?(T=a.child,a.child=null):(T=u.sibling,u.sibling=null),OE(a,!1,T,u,C);break;case"backwards":for(u=null,T=a.child,a.child=null;T!==null;){if(s=T.alternate,s!==null&&Xp(s)===null){a.child=T;break}s=T.sibling,T.sibling=u,u=T,T=s}OE(a,!0,u,null,C);break;case"together":OE(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function So(s,a,u){if(s!==null&&(a.dependencies=s.dependencies),bo|=a.lanes,!(u&a.childLanes))if(s!==null){if(rs(s,a,u,!1),(u&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(g(153));if(a.child!==null){for(s=a.child,u=yo(s,s.pendingProps),a.child=u,u.return=a;s.sibling!==null;)s=s.sibling,u=u.sibling=yo(s,s.pendingProps),u.return=a;u.sibling=null}return a.child}function NE(s,a){return s.lanes&a?!0:(s=s.dependencies,!!(s!==null&&Ef(s)))}function kv(s,a,u){switch(a.tag){case 3:ho(a,a.stateNode.containerInfo),nc(a,Ki,s.memoizedState.cache),Xa();break;case 27:case 5:Xo(a);break;case 4:ho(a,a.stateNode.containerInfo);break;case 10:nc(a,a.type,a.memoizedProps.value);break;case 13:var m=a.memoizedState;if(m!==null)return m.dehydrated!==null?(Ja(a),a.flags|=128,null):u&a.child.childLanes?Lv(s,a,u):(Ja(a),s=So(s,a,u),s!==null?s.sibling:null);Ja(a);break;case 19:var T=(s.flags&128)!==0;if(m=(u&a.childLanes)!==0,m||(rs(s,a,u,!1),m=(u&a.childLanes)!==0),T){if(m)return mf(s,a,u);a.flags|=128}if(T=a.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),Te(Wi,Wi.current),m)break;return null;case 22:case 23:return a.lanes=0,TE(s,a,u);case 24:nc(a,Ki,s.memoizedState.cache)}return So(s,a,u)}function Mv(s,a,u){if(s!==null)if(s.memoizedProps!==a.pendingProps)Qi=!0;else{if(!NE(s,u)&&!(a.flags&128))return Qi=!1,kv(s,a,u);Qi=!!(s.flags&131072)}else Qi=!1,Cn&&a.flags&1048576&&GT(a,Hp,a.index);switch(a.lanes=0,a.tag){case 16:t:{s=a.pendingProps;var m=a.elementType,T=m._init;if(m=T(m._payload),a.type=m,typeof m=="function")HE(m)?(s=rl(m,s),a.tag=1,a=Pv(null,a,m,s,u)):(a.tag=0,a=vE(null,a,m,s,u));else{if(m!=null){if(T=m.$$typeof,T===J){a.tag=11,a=sl(null,a,m,s,u);break t}else if(T===ht){a.tag=14,a=tc(null,a,m,s,u);break t}}throw a=re(m)||m,Error(g(306,a,""))}}return a;case 0:return vE(s,a,a.type,a.pendingProps,u);case 1:return m=a.type,T=rl(m,a.pendingProps),Pv(s,a,m,T,u);case 3:t:{if(ho(a,a.stateNode.containerInfo),s===null)throw Error(g(387));var C=a.pendingProps;T=a.memoizedState,m=T.element,LE(s,a),Cu(a,C,null,u);var x=a.memoizedState;if(C=x.cache,nc(a,Ki,C),C!==T.cache&&_f(a,[Ki],u,!0),bu(),C=x.element,T.isDehydrated)if(T={element:C,isDehydrated:!1,cache:x.cache},a.updateQueue.baseState=T,a.memoizedState=T,a.flags&256){a=RE(s,a,C,u);break t}else if(C!==m){m=Cr(Error(g(424)),a),kd(m),a=RE(s,a,C,u);break t}else for(sr=Ys(a.stateNode.containerInfo.firstChild),pr=a,Cn=!0,Ws=null,Ts=!0,u=qT(a,null,C,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(Xa(),C===m){a=So(s,a,u);break t}ei(s,a,C,u)}a=a.child}return a;case 26:return ol(s,a),s===null?(u=Ry(a.type,null,a.pendingProps,null))?a.memoizedState=u:Cn||(u=a.type,s=a.pendingProps,m=Lu(jn.current).createElement(u),m[rr]=a,m[xr]=s,$i(m,u,s),Yn(m),a.stateNode=m):a.memoizedState=Ry(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return Xo(a),s===null&&Cn&&(m=a.stateNode=Ty(a.type,a.pendingProps,jn.current),pr=a,Ts=!0,sr=Ys(m.firstChild)),m=a.pendingProps.children,s!==null||Cn?ei(s,a,m,u):a.child=$c(a,null,m,u),ol(s,a),a.child;case 5:return s===null&&Cn&&((T=m=sr)&&(m=jA(m,a.type,a.pendingProps,Ts),m!==null?(a.stateNode=m,pr=a,sr=Ys(m.firstChild),Ts=!1,T=!0):T=!1),T||qa(a)),Xo(a),T=a.type,C=a.pendingProps,x=s!==null?s.memoizedProps:null,m=C.children,cg(T,C)?m=null:x!==null&&cg(T,x)&&(a.flags|=32),a.memoizedState!==null&&(T=$p(s,a,QT,null,null,u),Rh._currentValue=T),ol(s,a),ei(s,a,m,u),a.child;case 6:return s===null&&Cn&&((s=u=sr)&&(u=FA(u,a.pendingProps,Ts),u!==null?(a.stateNode=u,pr=a,sr=null,s=!0):s=!1),s||qa(a)),null;case 13:return Lv(s,a,u);case 4:return ho(a,a.stateNode.containerInfo),m=a.pendingProps,s===null?a.child=$c(a,null,m,u):ei(s,a,m,u),a.child;case 11:return sl(s,a,a.type,a.pendingProps,u);case 7:return ei(s,a,a.pendingProps,u),a.child;case 8:return ei(s,a,a.pendingProps.children,u),a.child;case 12:return ei(s,a,a.pendingProps.children,u),a.child;case 10:return m=a.pendingProps,nc(a,a.type,m.value),ei(s,a,m.children,u),a.child;case 9:return T=a.type._context,m=a.pendingProps.children,cl(a),T=fr(T),m=m(T),a.flags|=1,ei(s,a,m,u),a.child;case 14:return tc(s,a,a.type,a.pendingProps,u);case 15:return SE(s,a,a.type,a.pendingProps,u);case 19:return mf(s,a,u);case 22:return TE(s,a,u);case 24:return cl(a),m=fr(Ki),s===null?(T=aE(),T===null&&(T=Gn,C=oE(),T.pooledCache=C,C.refCount++,C!==null&&(T.pooledCacheLanes|=u),T=C),a.memoizedState={parent:m,cache:T},rh(a),nc(a,Ki,T)):(s.lanes&u&&(LE(s,a),Cu(a,null,null,u),bu()),T=s.memoizedState,C=a.memoizedState,T.parent!==m?(T={parent:m,cache:m},a.memoizedState=T,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=T),nc(a,Ki,m)):(m=C.cache,nc(a,Ki,m),m!==T.cache&&_f(a,[Ki],u,!0))),ei(s,a,a.pendingProps.children,u),a.child;case 29:throw a.pendingProps}throw Error(g(156,a.tag))}var DE=_e(null),al=null,na=null;function nc(s,a,u){Te(DE,a._currentValue),a._currentValue=u}function ia(s){s._currentValue=DE.current,Ge(DE)}function PE(s,a,u){for(;s!==null;){var m=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),s===u)break;s=s.return}}function _f(s,a,u,m){var T=s.child;for(T!==null&&(T.return=s);T!==null;){var C=T.dependencies;if(C!==null){var x=T.child;C=C.firstContext;t:for(;C!==null;){var K=C;C=T;for(var $=0;$<a.length;$++)if(K.context===a[$]){C.lanes|=u,K=C.alternate,K!==null&&(K.lanes|=u),PE(C.return,u,s),m||(x=null);break t}C=K.next}}else if(T.tag===18){if(x=T.return,x===null)throw Error(g(341));x.lanes|=u,C=x.alternate,C!==null&&(C.lanes|=u),PE(x,u,s),x=null}else x=T.child;if(x!==null)x.return=T;else for(x=T;x!==null;){if(x===s){x=null;break}if(T=x.sibling,T!==null){T.return=x.return,x=T;break}x=x.return}T=x}}function rs(s,a,u,m){s=null;for(var T=a,C=!1;T!==null;){if(!C){if(T.flags&524288)C=!0;else if(T.flags&262144)break}if(T.tag===10){var x=T.alternate;if(x===null)throw Error(g(387));if(x=x.memoizedProps,x!==null){var K=T.type;ns(T.pendingProps.value,x.value)||(s!==null?s.push(K):s=[K])}}else if(T===br.current){if(x=T.alternate,x===null)throw Error(g(387));x.memoizedState.memoizedState!==T.memoizedState.memoizedState&&(s!==null?s.push(Rh):s=[Rh])}T=T.return}s!==null&&_f(a,s,u,m),a.flags|=262144}function Ef(s){for(s=s.firstContext;s!==null;){if(!ns(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function cl(s){al=s,na=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function fr(s){return Uv(al,s)}function gf(s,a){return al===null&&cl(s),Uv(s,a)}function Uv(s,a){var u=a._currentValue;if(a={context:a,memoizedValue:u,next:null},na===null){if(s===null)throw Error(g(308));na=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else na=na.next=a;return u}var ic=!1;function rh(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function LE(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function rc(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function sc(s,a,u){var m=s.updateQueue;if(m===null)return null;if(m=m.shared,ai&2){var T=m.pending;return T===null?a.next=a:(a.next=T.next,T.next=a),m.pending=a,a=jp(s),FT(s,null,u),a}return Bp(s,m,a,u),jp(s)}function sh(s,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194176)!==0)){var m=a.lanes;m&=s.pendingLanes,u|=m,a.lanes=u,yd(s,u)}}function kE(s,a){var u=s.updateQueue,m=s.alternate;if(m!==null&&(m=m.updateQueue,u===m)){var T=null,C=null;if(u=u.firstBaseUpdate,u!==null){do{var x={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};C===null?T=C=x:C=C.next=x,u=u.next}while(u!==null);C===null?T=C=a:C=C.next=a}else T=C=a;u={baseState:m.baseState,firstBaseUpdate:T,lastBaseUpdate:C,shared:m.shared,callbacks:m.callbacks},s.updateQueue=u;return}s=u.lastBaseUpdate,s===null?u.firstBaseUpdate=a:s.next=a,u.lastBaseUpdate=a}var ME=!1;function bu(){if(ME){var s=_u;if(s!==null)throw s}}function Cu(s,a,u,m){ME=!1;var T=s.updateQueue;ic=!1;var C=T.firstBaseUpdate,x=T.lastBaseUpdate,K=T.shared.pending;if(K!==null){T.shared.pending=null;var $=K,ut=$.next;$.next=null,x===null?C=ut:x.next=ut,x=$;var Pt=s.alternate;Pt!==null&&(Pt=Pt.updateQueue,K=Pt.lastBaseUpdate,K!==x&&(K===null?Pt.firstBaseUpdate=ut:K.next=ut,Pt.lastBaseUpdate=$))}if(C!==null){var Kt=T.baseState;x=0,Pt=ut=$=null,K=C;do{var vt=K.lane&-536870913,Nt=vt!==K.lane;if(Nt?(mn&vt)===vt:(m&vt)===vt){vt!==0&&vt===mu&&(ME=!0),Pt!==null&&(Pt=Pt.next={lane:0,tag:K.tag,payload:K.payload,callback:null,next:null});t:{var Ee=s,Be=K;vt=a;var vi=u;switch(Be.tag){case 1:if(Ee=Be.payload,typeof Ee=="function"){Kt=Ee.call(vi,Kt,vt);break t}Kt=Ee;break t;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=Be.payload,vt=typeof Ee=="function"?Ee.call(vi,Kt,vt):Ee,vt==null)break t;Kt=se({},Kt,vt);break t;case 2:ic=!0}}vt=K.callback,vt!==null&&(s.flags|=64,Nt&&(s.flags|=8192),Nt=T.callbacks,Nt===null?T.callbacks=[vt]:Nt.push(vt))}else Nt={lane:vt,tag:K.tag,payload:K.payload,callback:K.callback,next:null},Pt===null?(ut=Pt=Nt,$=Kt):Pt=Pt.next=Nt,x|=vt;if(K=K.next,K===null){if(K=T.shared.pending,K===null)break;Nt=K,K=Nt.next,Nt.next=null,T.lastBaseUpdate=Nt,T.shared.pending=null}}while(!0);Pt===null&&($=Kt),T.baseState=$,T.firstBaseUpdate=ut,T.lastBaseUpdate=Pt,C===null&&(T.shared.lanes=0),bo|=x,s.lanes=x,s.memoizedState=Kt}}function xv(s,a){if(typeof s!="function")throw Error(g(191,s));s.call(a)}function Vv(s,a){var u=s.callbacks;if(u!==null)for(s.callbacks=null,s=0;s<u.length;s++)xv(u[s],a)}function oc(s,a){try{var u=a.updateQueue,m=u!==null?u.lastEffect:null;if(m!==null){var T=m.next;u=T;do{if((u.tag&s)===s){m=void 0;var C=u.create,x=u.inst;m=C(),x.destroy=m}u=u.next}while(u!==T)}}catch(K){On(a,a.return,K)}}function To(s,a,u){try{var m=a.updateQueue,T=m!==null?m.lastEffect:null;if(T!==null){var C=T.next;m=C;do{if((m.tag&s)===s){var x=m.inst,K=x.destroy;if(K!==void 0){x.destroy=void 0,T=a;var $=u;try{K()}catch(ut){On(T,$,ut)}}}m=m.next}while(m!==C)}}catch(ut){On(a,a.return,ut)}}function UE(s){var a=s.updateQueue;if(a!==null){var u=s.stateNode;try{Vv(a,u)}catch(m){On(s,s.return,m)}}}function oh(s,a,u){u.props=rl(s.type,s.memoizedProps),u.state=s.memoizedState;try{u.componentWillUnmount()}catch(m){On(s,a,m)}}function ac(s,a){try{var u=s.ref;if(u!==null){var m=s.stateNode;switch(s.tag){case 26:case 27:case 5:var T=m;break;default:T=m}typeof u=="function"?s.refCleanup=u(T):u.current=T}}catch(C){On(s,a,C)}}function ss(s,a){var u=s.ref,m=s.refCleanup;if(u!==null)if(typeof m=="function")try{m()}catch(T){On(s,a,T)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(T){On(s,a,T)}else u.current=null}function xE(s){var a=s.type,u=s.memoizedProps,m=s.stateNode;try{t:switch(a){case"button":case"input":case"select":case"textarea":u.autoFocus&&m.focus();break t;case"img":u.src?m.src=u.src:u.srcSet&&(m.srcset=u.srcSet)}}catch(T){On(s,s.return,T)}}function ah(s,a,u){try{var m=s.stateNode;UA(m,s.type,u,a),m[xr]=a}catch(T){On(s,s.return,T)}}function Bv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27||s.tag===4}function Sf(s){t:for(;;){for(;s.sibling===null;){if(s.return===null||Bv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==27&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue t;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Tf(s,a,u){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?u.nodeType===8?u.parentNode.insertBefore(s,a):u.insertBefore(s,a):(u.nodeType===8?(a=u.parentNode,a.insertBefore(s,u)):(a=u,a.appendChild(s)),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=Th));else if(m!==4&&m!==27&&(s=s.child,s!==null))for(Tf(s,a,u),s=s.sibling;s!==null;)Tf(s,a,u),s=s.sibling}function vf(s,a,u){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?u.insertBefore(s,a):u.appendChild(s);else if(m!==4&&m!==27&&(s=s.child,s!==null))for(vf(s,a,u),s=s.sibling;s!==null;)vf(s,a,u),s=s.sibling}var Rs=!1,mi=!1,VE=!1,jv=typeof WeakSet=="function"?WeakSet:Set,Zi=null,ch=!1;function wA(s,a){if(s=s.containerInfo,_c=bh,s=LT(s),Fs(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else t:{u=(u=s.ownerDocument)&&u.defaultView||window;var m=u.getSelection&&u.getSelection();if(m&&m.rangeCount!==0){u=m.anchorNode;var T=m.anchorOffset,C=m.focusNode;m=m.focusOffset;try{u.nodeType,C.nodeType}catch{u=null;break t}var x=0,K=-1,$=-1,ut=0,Pt=0,Kt=s,vt=null;e:for(;;){for(var Nt;Kt!==u||T!==0&&Kt.nodeType!==3||(K=x+T),Kt!==C||m!==0&&Kt.nodeType!==3||($=x+m),Kt.nodeType===3&&(x+=Kt.nodeValue.length),(Nt=Kt.firstChild)!==null;)vt=Kt,Kt=Nt;for(;;){if(Kt===s)break e;if(vt===u&&++ut===T&&(K=x),vt===C&&++Pt===m&&($=x),(Nt=Kt.nextSibling)!==null)break;Kt=vt,vt=Kt.parentNode}Kt=Nt}u=K===-1||$===-1?null:{start:K,end:$}}else u=null}u=u||{start:0,end:0}}else u=null;for(Ec={focusedElem:s,selectionRange:u},bh=!1,Zi=a;Zi!==null;)if(a=Zi,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,Zi=s;else for(;Zi!==null;){switch(a=Zi,C=a.alternate,s=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if(s&1024&&C!==null){s=void 0,u=a,T=C.memoizedProps,C=C.memoizedState,m=u.stateNode;try{var Ee=rl(u.type,T,u.elementType===u.type);s=m.getSnapshotBeforeUpdate(Ee,C),m.__reactInternalSnapshotBeforeUpdate=s}catch(Be){On(u,u.return,Be)}}break;case 3:if(s&1024){if(s=a.stateNode.containerInfo,u=s.nodeType,u===9)ug(s);else if(u===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":ug(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(s&1024)throw Error(g(163))}if(s=a.sibling,s!==null){s.return=a.return,Zi=s;break}Zi=a.return}return Ee=ch,ch=!1,Ee}function Fv(s,a,u){var m=u.flags;switch(u.tag){case 0:case 11:case 15:sa(s,u),m&4&&oc(5,u);break;case 1:if(sa(s,u),m&4)if(s=u.stateNode,a===null)try{s.componentDidMount()}catch(K){On(u,u.return,K)}else{var T=rl(u.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(T,a,s.__reactInternalSnapshotBeforeUpdate)}catch(K){On(u,u.return,K)}}m&64&&UE(u),m&512&&ac(u,u.return);break;case 3:if(sa(s,u),m&64&&(m=u.updateQueue,m!==null)){if(s=null,u.child!==null)switch(u.child.tag){case 27:case 5:s=u.child.stateNode;break;case 1:s=u.child.stateNode}try{Vv(m,s)}catch(K){On(u,u.return,K)}}break;case 26:sa(s,u),m&512&&ac(u,u.return);break;case 27:case 5:sa(s,u),a===null&&m&4&&xE(u),m&512&&ac(u,u.return);break;case 12:sa(s,u);break;case 13:sa(s,u),m&4&&Hv(s,u);break;case 22:if(T=u.memoizedState!==null||Rs,!T){a=a!==null&&a.memoizedState!==null||mi;var C=Rs,x=mi;Rs=T,(mi=a)&&!x?oa(s,u,(u.subtreeFlags&8772)!==0):sa(s,u),Rs=C,mi=x}m&512&&(u.memoizedProps.mode==="manual"?ac(u,u.return):ss(u,u.return));break;default:sa(s,u)}}function Gv(s){var a=s.alternate;a!==null&&(s.alternate=null,Gv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Rd(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var wi=null,os=!1;function ra(s,a,u){for(u=u.child;u!==null;)yf(s,a,u),u=u.sibling}function yf(s,a,u){if(Fi&&typeof Fi.onCommitFiberUnmount=="function")try{Fi.onCommitFiberUnmount(zl,u)}catch{}switch(u.tag){case 26:mi||ss(u,a),ra(s,a,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:mi||ss(u,a);var m=wi,T=os;for(wi=u.stateNode,ra(s,a,u),u=u.stateNode,a=u.attributes;a.length;)u.removeAttributeNode(a[0]);Rd(u),wi=m,os=T;break;case 5:mi||ss(u,a);case 6:T=wi;var C=os;if(wi=null,ra(s,a,u),wi=T,os=C,wi!==null)if(os)try{s=wi,m=u.stateNode,s.nodeType===8?s.parentNode.removeChild(m):s.removeChild(m)}catch(x){On(u,a,x)}else try{wi.removeChild(u.stateNode)}catch(x){On(u,a,x)}break;case 18:wi!==null&&(os?(a=wi,u=u.stateNode,a.nodeType===8?lg(a.parentNode,u):a.nodeType===1&&lg(a,u),Ih(a)):lg(wi,u.stateNode));break;case 4:m=wi,T=os,wi=u.stateNode.containerInfo,os=!0,ra(s,a,u),wi=m,os=T;break;case 0:case 11:case 14:case 15:mi||To(2,u,a),mi||To(4,u,a),ra(s,a,u);break;case 1:mi||(ss(u,a),m=u.stateNode,typeof m.componentWillUnmount=="function"&&oh(u,a,m)),ra(s,a,u);break;case 21:ra(s,a,u);break;case 22:mi||ss(u,a),mi=(m=mi)||u.memoizedState!==null,ra(s,a,u),mi=m;break;default:ra(s,a,u)}}function Hv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Ih(s)}catch(u){On(a,a.return,u)}}function BE(s){switch(s.tag){case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new jv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new jv),a;default:throw Error(g(435,s.tag))}}function jE(s,a){var u=BE(s);a.forEach(function(m){var T=$E.bind(null,s,m);u.has(m)||(u.add(m),m.then(T,T))})}function as(s,a){var u=a.deletions;if(u!==null)for(var m=0;m<u.length;m++){var T=u[m],C=s,x=a,K=x;t:for(;K!==null;){switch(K.tag){case 27:case 5:wi=K.stateNode,os=!1;break t;case 3:wi=K.stateNode.containerInfo,os=!0;break t;case 4:wi=K.stateNode.containerInfo,os=!0;break t}K=K.return}if(wi===null)throw Error(g(160));yf(C,x,T),wi=null,os=!1,C=T.alternate,C!==null&&(C.return=null),T.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)Wv(a,s),a=a.sibling}var zs=null;function Wv(s,a){var u=s.alternate,m=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:as(a,s),cs(s),m&4&&(To(3,s,s.return),oc(3,s),To(5,s,s.return));break;case 1:as(a,s),cs(s),m&512&&(mi||u===null||ss(u,u.return)),m&64&&Rs&&(s=s.updateQueue,s!==null&&(m=s.callbacks,m!==null&&(u=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=u===null?m:u.concat(m))));break;case 26:var T=zs;if(as(a,s),cs(s),m&512&&(mi||u===null||ss(u,u.return)),m&4){var C=u!==null?u.memoizedState:null;if(m=s.memoizedState,u===null)if(m===null)if(s.stateNode===null){t:{m=s.type,u=s.memoizedProps,T=T.ownerDocument||T;e:switch(m){case"title":C=T.getElementsByTagName("title")[0],(!C||C[Xl]||C[rr]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=T.createElement(m),T.head.insertBefore(C,T.querySelector("head > title"))),$i(C,m,u),C[rr]=s,Yn(C),m=C;break t;case"link":var x=Ay("link","href",T).get(m+(u.href||""));if(x){for(var K=0;K<x.length;K++)if(C=x[K],C.getAttribute("href")===(u.href==null?null:u.href)&&C.getAttribute("rel")===(u.rel==null?null:u.rel)&&C.getAttribute("title")===(u.title==null?null:u.title)&&C.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){x.splice(K,1);break e}}C=T.createElement(m),$i(C,m,u),T.head.appendChild(C);break;case"meta":if(x=Ay("meta","content",T).get(m+(u.content||""))){for(K=0;K<x.length;K++)if(C=x[K],C.getAttribute("content")===(u.content==null?null:""+u.content)&&C.getAttribute("name")===(u.name==null?null:u.name)&&C.getAttribute("property")===(u.property==null?null:u.property)&&C.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&C.getAttribute("charset")===(u.charSet==null?null:u.charSet)){x.splice(K,1);break e}}C=T.createElement(m),$i(C,m,u),T.head.appendChild(C);break;default:throw Error(g(468,m))}C[rr]=s,Yn(C),m=C}s.stateNode=m}else wy(T,s.type,s.stateNode);else s.stateNode=Cy(T,m,s.memoizedProps);else C!==m?(C===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):C.count--,m===null?wy(T,s.type,s.stateNode):Cy(T,m,s.memoizedProps)):m===null&&s.stateNode!==null&&ah(s,s.memoizedProps,u.memoizedProps)}break;case 27:if(m&4&&s.alternate===null){T=s.stateNode,C=s.memoizedProps;try{for(var $=T.firstChild;$;){var ut=$.nextSibling,Pt=$.nodeName;$[Xl]||Pt==="HEAD"||Pt==="BODY"||Pt==="SCRIPT"||Pt==="STYLE"||Pt==="LINK"&&$.rel.toLowerCase()==="stylesheet"||T.removeChild($),$=ut}for(var Kt=s.type,vt=T.attributes;vt.length;)T.removeAttributeNode(vt[0]);$i(T,Kt,C),T[rr]=s,T[xr]=C}catch(Ee){On(s,s.return,Ee)}}case 5:if(as(a,s),cs(s),m&512&&(mi||u===null||ss(u,u.return)),s.flags&32){T=s.stateNode;try{Ga(T,"")}catch(Ee){On(s,s.return,Ee)}}m&4&&s.stateNode!=null&&(T=s.memoizedProps,ah(s,T,u!==null?u.memoizedProps:T)),m&1024&&(VE=!0);break;case 6:if(as(a,s),cs(s),m&4){if(s.stateNode===null)throw Error(g(162));m=s.memoizedProps,u=s.stateNode;try{u.nodeValue=m}catch(Ee){On(s,s.return,Ee)}}break;case 3:if(zf=null,T=zs,zs=Hf(a.containerInfo),as(a,s),zs=T,cs(s),m&4&&u!==null&&u.memoizedState.isDehydrated)try{Ih(a.containerInfo)}catch(Ee){On(s,s.return,Ee)}VE&&(VE=!1,Kv(s));break;case 4:m=zs,zs=Hf(s.stateNode.containerInfo),as(a,s),cs(s),zs=m;break;case 12:as(a,s),cs(s);break;case 13:as(a,s),cs(s),s.child.flags&8192&&s.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Of=ti()),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,jE(s,m)));break;case 22:if(m&512&&(mi||u===null||ss(u,u.return)),$=s.memoizedState!==null,ut=u!==null&&u.memoizedState!==null,Pt=Rs,Kt=mi,Rs=Pt||$,mi=Kt||ut,as(a,s),mi=Kt,Rs=Pt,cs(s),a=s.stateNode,a._current=s,a._visibility&=-3,a._visibility|=a._pendingVisibility&2,m&8192&&(a._visibility=$?a._visibility&-2:a._visibility|1,$&&(a=Rs||mi,u===null||ut||a||ll(s)),s.memoizedProps===null||s.memoizedProps.mode!=="manual"))t:for(u=null,a=s;;){if(a.tag===5||a.tag===26||a.tag===27){if(u===null){ut=u=a;try{if(T=ut.stateNode,$)C=T.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{x=ut.stateNode,K=ut.memoizedProps.style;var Nt=K!=null&&K.hasOwnProperty("display")?K.display:null;x.style.display=Nt==null||typeof Nt=="boolean"?"":(""+Nt).trim()}}catch(Ee){On(ut,ut.return,Ee)}}}else if(a.tag===6){if(u===null){ut=a;try{ut.stateNode.nodeValue=$?"":ut.memoizedProps}catch(Ee){On(ut,ut.return,Ee)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break t;for(;a.sibling===null;){if(a.return===null||a.return===s)break t;u===a&&(u=null),a=a.return}u===a&&(u=null),a.sibling.return=a.return,a=a.sibling}m&4&&(m=s.updateQueue,m!==null&&(u=m.retryQueue,u!==null&&(m.retryQueue=null,jE(s,u))));break;case 19:as(a,s),cs(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,jE(s,m)));break;case 21:break;default:as(a,s),cs(s)}}function cs(s){var a=s.flags;if(a&2){try{if(s.tag!==27){t:{for(var u=s.return;u!==null;){if(Bv(u)){var m=u;break t}u=u.return}throw Error(g(160))}switch(m.tag){case 27:var T=m.stateNode,C=Sf(s);vf(s,C,T);break;case 5:var x=m.stateNode;m.flags&32&&(Ga(x,""),m.flags&=-33);var K=Sf(s);vf(s,K,x);break;case 3:case 4:var $=m.stateNode.containerInfo,ut=Sf(s);Tf(s,ut,$);break;default:throw Error(g(161))}}}catch(Pt){On(s,s.return,Pt)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function Kv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;Kv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function sa(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Fv(s,a.alternate,a),a=a.sibling}function ll(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:To(4,a,a.return),ll(a);break;case 1:ss(a,a.return);var u=a.stateNode;typeof u.componentWillUnmount=="function"&&oh(a,a.return,u),ll(a);break;case 26:case 27:case 5:ss(a,a.return),ll(a);break;case 22:ss(a,a.return),a.memoizedState===null&&ll(a);break;default:ll(a)}s=s.sibling}}function oa(s,a,u){for(u=u&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var m=a.alternate,T=s,C=a,x=C.flags;switch(C.tag){case 0:case 11:case 15:oa(T,C,u),oc(4,C);break;case 1:if(oa(T,C,u),m=C,T=m.stateNode,typeof T.componentDidMount=="function")try{T.componentDidMount()}catch(ut){On(m,m.return,ut)}if(m=C,T=m.updateQueue,T!==null){var K=m.stateNode;try{var $=T.shared.hiddenCallbacks;if($!==null)for(T.shared.hiddenCallbacks=null,T=0;T<$.length;T++)xv($[T],K)}catch(ut){On(m,m.return,ut)}}u&&x&64&&UE(C),ac(C,C.return);break;case 26:case 27:case 5:oa(T,C,u),u&&m===null&&x&4&&xE(C),ac(C,C.return);break;case 12:oa(T,C,u);break;case 13:oa(T,C,u),u&&x&4&&Hv(T,C);break;case 22:C.memoizedState===null&&oa(T,C,u),ac(C,C.return);break;default:oa(T,C,u)}a=a.sibling}}function lh(s,a){var u=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==u&&(s!=null&&s.refCount++,u!=null&&Hd(u))}function FE(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Hd(s))}function cc(s,a,u,m){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Au(s,a,u,m),a=a.sibling}function Au(s,a,u,m){var T=a.flags;switch(a.tag){case 0:case 11:case 15:cc(s,a,u,m),T&2048&&oc(9,a);break;case 3:cc(s,a,u,m),T&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Hd(s)));break;case 12:if(T&2048){cc(s,a,u,m),s=a.stateNode;try{var C=a.memoizedProps,x=C.id,K=C.onPostCommit;typeof K=="function"&&K(x,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch($){On(a,a.return,$)}}else cc(s,a,u,m);break;case 23:break;case 22:C=a.stateNode,a.memoizedState!==null?C._visibility&4?cc(s,a,u,m):aa(s,a):C._visibility&4?cc(s,a,u,m):(C._visibility|=4,ul(s,a,u,m,(a.subtreeFlags&10256)!==0)),T&2048&&lh(a.alternate,a);break;case 24:cc(s,a,u,m),T&2048&&FE(a.alternate,a);break;default:cc(s,a,u,m)}}function ul(s,a,u,m,T){for(T=T&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var C=s,x=a,K=u,$=m,ut=x.flags;switch(x.tag){case 0:case 11:case 15:ul(C,x,K,$,T),oc(8,x);break;case 23:break;case 22:var Pt=x.stateNode;x.memoizedState!==null?Pt._visibility&4?ul(C,x,K,$,T):aa(C,x):(Pt._visibility|=4,ul(C,x,K,$,T)),T&&ut&2048&&lh(x.alternate,x);break;case 24:ul(C,x,K,$,T),T&&ut&2048&&FE(x.alternate,x);break;default:ul(C,x,K,$,T)}a=a.sibling}}function aa(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var u=s,m=a,T=m.flags;switch(m.tag){case 22:aa(u,m),T&2048&&lh(m.alternate,m);break;case 24:aa(u,m),T&2048&&FE(m.alternate,m);break;default:aa(u,m)}a=a.sibling}}var vo=8192;function dl(s){if(s.subtreeFlags&vo)for(s=s.child;s!==null;)Rf(s),s=s.sibling}function Rf(s){switch(s.tag){case 26:dl(s),s.flags&vo&&s.memoizedState!==null&&$A(zs,s.memoizedState,s.memoizedProps);break;case 5:dl(s);break;case 3:case 4:var a=zs;zs=Hf(s.stateNode.containerInfo),dl(s),zs=a;break;case 22:s.memoizedState===null&&(a=s.alternate,a!==null&&a.memoizedState!==null?(a=vo,vo=16777216,dl(s),vo=a):dl(s));break;default:dl(s)}}function uh(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function dh(s){var a=s.deletions;if(s.flags&16){if(a!==null)for(var u=0;u<a.length;u++){var m=a[u];Zi=m,GE(m,s)}uh(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)zv(s),s=s.sibling}function zv(s){switch(s.tag){case 0:case 11:case 15:dh(s),s.flags&2048&&To(9,s,s.return);break;case 3:dh(s);break;case 12:dh(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&4&&(s.return===null||s.return.tag!==13)?(a._visibility&=-5,bf(s)):dh(s);break;default:dh(s)}}function bf(s){var a=s.deletions;if(s.flags&16){if(a!==null)for(var u=0;u<a.length;u++){var m=a[u];Zi=m,GE(m,s)}uh(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:To(8,a,a.return),bf(a);break;case 22:u=a.stateNode,u._visibility&4&&(u._visibility&=-5,bf(a));break;default:bf(a)}s=s.sibling}}function GE(s,a){for(;Zi!==null;){var u=Zi;switch(u.tag){case 0:case 11:case 15:To(8,u,a);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var m=u.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Hd(u.memoizedState.cache)}if(m=u.child,m!==null)m.return=u,Zi=m;else t:for(u=s;Zi!==null;){m=Zi;var T=m.sibling,C=m.return;if(Gv(m),m===u){Zi=null;break t}if(T!==null){T.return=C,Zi=T;break t}Zi=C}}}function IA(s,a,u,m){this.tag=s,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bs(s,a,u,m){return new IA(s,a,u,m)}function HE(s){return s=s.prototype,!(!s||!s.isReactComponent)}function yo(s,a){var u=s.alternate;return u===null?(u=bs(s.tag,a,s.key,s.mode),u.elementType=s.elementType,u.type=s.type,u.stateNode=s.stateNode,u.alternate=s,s.alternate=u):(u.pendingProps=a,u.type=s.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=s.flags&31457280,u.childLanes=s.childLanes,u.lanes=s.lanes,u.child=s.child,u.memoizedProps=s.memoizedProps,u.memoizedState=s.memoizedState,u.updateQueue=s.updateQueue,a=s.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=s.sibling,u.index=s.index,u.ref=s.ref,u.refCleanup=s.refCleanup,u}function ca(s,a){s.flags&=31457282;var u=s.alternate;return u===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,a=u.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Cf(s,a,u,m,T,C){var x=0;if(m=s,typeof s=="function")HE(s)&&(x=1);else if(typeof s=="string")x=ZA(s,u,nn.current)?26:s==="html"||s==="head"||s==="body"?27:5;else t:switch(s){case B:return ls(u.children,T,C,a);case V:x=8,T|=24;break;case G:return s=bs(12,u,a,T|2),s.elementType=G,s.lanes=C,s;case q:return s=bs(13,u,a,T),s.elementType=q,s.lanes=C,s;case it:return s=bs(19,u,a,T),s.elementType=it,s.lanes=C,s;case lt:return WE(u,T,C,a);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case z:case at:x=10;break t;case nt:x=9;break t;case J:x=11;break t;case ht:x=14;break t;case pt:x=16,m=null;break t}x=29,u=Error(g(130,s===null?"null":typeof s,"")),m=null}return a=bs(x,u,a,T),a.elementType=s,a.type=m,a.lanes=C,a}function ls(s,a,u,m){return s=bs(7,s,m,a),s.lanes=u,s}function WE(s,a,u,m){s=bs(22,s,m,a),s.elementType=lt,s.lanes=u;var T={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var C=T._current;if(C===null)throw Error(g(456));if(!(T._pendingVisibility&2)){var x=gs(C,2);x!==null&&(T._pendingVisibility|=2,Ir(x,C,2))}},attach:function(){var C=T._current;if(C===null)throw Error(g(456));if(T._pendingVisibility&2){var x=gs(C,2);x!==null&&(T._pendingVisibility&=-3,Ir(x,C,2))}}};return s.stateNode=T,s}function Ar(s,a,u){return s=bs(6,s,null,a),s.lanes=u,s}function KE(s,a,u){return a=bs(4,s.children!==null?s.children:[],s.key,a),a.lanes=u,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}function la(s){s.flags|=4}function zE(s,a){if(a.type!=="stylesheet"||a.state.loading&4)s.flags&=-16777217;else if(s.flags|=16777216,!hg(a)){if(a=vs.current,a!==null&&((mn&4194176)===mn?fo!==null:(mn&62914560)!==mn&&!(mn&536870912)||a!==fo))throw xd=rE,WT;s.flags|=8192}}function Af(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?ZS():536870912,s.lanes|=a,pl|=a)}function wu(s,a){if(!Cn)switch(s.tailMode){case"hidden":a=s.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?s.tail=null:u.sibling=null;break;case"collapsed":u=s.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:m.sibling=null}}function ui(s){var a=s.alternate!==null&&s.alternate.child===s.child,u=0,m=0;if(a)for(var T=s.child;T!==null;)u|=T.lanes|T.childLanes,m|=T.subtreeFlags&31457280,m|=T.flags&31457280,T.return=s,T=T.sibling;else for(T=s.child;T!==null;)u|=T.lanes|T.childLanes,m|=T.subtreeFlags,m|=T.flags,T.return=s,T=T.sibling;return s.subtreeFlags|=m,s.childLanes=u,a}function OA(s,a,u){var m=a.pendingProps;switch(eE(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ui(a),null;case 1:return ui(a),null;case 3:return u=a.stateNode,m=null,s!==null&&(m=s.memoizedState.cache),a.memoizedState.cache!==m&&(a.flags|=2048),ia(Ki),ji(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(s===null||s.child===null)&&(du(a)?la(a):s===null||s.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,Ws!==null&&(JE(Ws),Ws=null))),ui(a),null;case 26:return u=a.memoizedState,s===null?(la(a),u!==null?(ui(a),zE(a,u)):(ui(a),a.flags&=-16777217)):u?u!==s.memoizedState?(la(a),ui(a),zE(a,u)):(ui(a),a.flags&=-16777217):(s.memoizedProps!==m&&la(a),ui(a),a.flags&=-16777217),null;case 27:Ci(a),u=jn.current;var T=a.type;if(s!==null&&a.stateNode!=null)s.memoizedProps!==m&&la(a);else{if(!m){if(a.stateNode===null)throw Error(g(166));return ui(a),null}s=nn.current,du(a)?iE(a):(s=Ty(T,m,u),a.stateNode=s,la(a))}return ui(a),null;case 5:if(Ci(a),u=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&la(a);else{if(!m){if(a.stateNode===null)throw Error(g(166));return ui(a),null}if(s=nn.current,du(a))iE(a);else{switch(T=Lu(jn.current),s){case 1:s=T.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:s=T.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":s=T.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":s=T.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":s=T.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof m.is=="string"?T.createElement("select",{is:m.is}):T.createElement("select"),m.multiple?s.multiple=!0:m.size&&(s.size=m.size);break;default:s=typeof m.is=="string"?T.createElement(u,{is:m.is}):T.createElement(u)}}s[rr]=a,s[xr]=m;t:for(T=a.child;T!==null;){if(T.tag===5||T.tag===6)s.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===a)break t;for(;T.sibling===null;){if(T.return===null||T.return===a)break t;T=T.return}T.sibling.return=T.return,T=T.sibling}a.stateNode=s;t:switch($i(s,u,m),u){case"button":case"input":case"select":case"textarea":s=!!m.autoFocus;break t;case"img":s=!0;break t;default:s=!1}s&&la(a)}}return ui(a),a.flags&=-16777217,null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==m&&la(a);else{if(typeof m!="string"&&a.stateNode===null)throw Error(g(166));if(s=jn.current,du(a)){if(s=a.stateNode,u=a.memoizedProps,m=null,T=pr,T!==null)switch(T.tag){case 27:case 5:m=T.memoizedProps}s[rr]=a,s=!!(s.nodeValue===u||m!==null&&m.suppressHydrationWarning===!0||rg(s.nodeValue,u)),s||qa(a)}else s=Lu(s).createTextNode(m),s[rr]=a,a.stateNode=s}return ui(a),null;case 13:if(m=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(T=du(a),m!==null&&m.dehydrated!==null){if(s===null){if(!T)throw Error(g(318));if(T=a.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(g(317));T[rr]=a}else Xa(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;ui(a),T=!1}else Ws!==null&&(JE(Ws),Ws=null),T=!0;if(!T)return a.flags&256?(Ks(a),a):(Ks(a),null)}if(Ks(a),a.flags&128)return a.lanes=u,a;if(u=m!==null,s=s!==null&&s.memoizedState!==null,u){m=a.child,T=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(T=m.alternate.memoizedState.cachePool.pool);var C=null;m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(C=m.memoizedState.cachePool.pool),C!==T&&(m.flags|=2048)}return u!==s&&u&&(a.child.flags|=8192),Af(a,a.updateQueue),ui(a),null;case 4:return ji(),s===null&&El(a.stateNode.containerInfo),ui(a),null;case 10:return ia(a.type),ui(a),null;case 19:if(Ge(Wi),T=a.memoizedState,T===null)return ui(a),null;if(m=(a.flags&128)!==0,C=T.rendering,C===null)if(m)wu(T,!1);else{if(di!==0||s!==null&&s.flags&128)for(s=a.child;s!==null;){if(C=Xp(s),C!==null){for(a.flags|=128,wu(T,!1),s=C.updateQueue,a.updateQueue=s,Af(a,s),a.subtreeFlags=0,s=u,u=a.child;u!==null;)ca(u,s),u=u.sibling;return Te(Wi,Wi.current&1|2),a.child}s=s.sibling}T.tail!==null&&ti()>da&&(a.flags|=128,m=!0,wu(T,!1),a.lanes=4194304)}else{if(!m)if(s=Xp(C),s!==null){if(a.flags|=128,m=!0,s=s.updateQueue,a.updateQueue=s,Af(a,s),wu(T,!0),T.tail===null&&T.tailMode==="hidden"&&!C.alternate&&!Cn)return ui(a),null}else 2*ti()-T.renderingStartTime>da&&u!==536870912&&(a.flags|=128,m=!0,wu(T,!1),a.lanes=4194304);T.isBackwards?(C.sibling=a.child,a.child=C):(s=T.last,s!==null?s.sibling=C:a.child=C,T.last=C)}return T.tail!==null?(a=T.tail,T.rendering=a,T.tail=a.sibling,T.renderingStartTime=ti(),a.sibling=null,s=Wi.current,Te(Wi,m?s&1|2:s&1),a):(ui(a),null);case 22:case 23:return Ks(a),Fd(),m=a.memoizedState!==null,s!==null?s.memoizedState!==null!==m&&(a.flags|=8192):m&&(a.flags|=8192),m?u&536870912&&!(a.flags&128)&&(ui(a),a.subtreeFlags&6&&(a.flags|=8192)):ui(a),u=a.updateQueue,u!==null&&Af(a,u.retryQueue),u=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),m=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),m!==u&&(a.flags|=2048),s!==null&&Ge(mo),null;case 24:return u=null,s!==null&&(u=s.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),ia(Ki),ui(a),null;case 25:return null}throw Error(g(156,a.tag))}function Yv(s,a){switch(eE(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return ia(Ki),ji(),s=a.flags,s&65536&&!(s&128)?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Ci(a),null;case 13:if(Ks(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(g(340));Xa()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return Ge(Wi),null;case 4:return ji(),null;case 10:return ia(a.type),null;case 22:case 23:return Ks(a),Fd(),s!==null&&Ge(mo),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return ia(Ki),null;case 25:return null;default:return null}}function qv(s,a){switch(eE(a),a.tag){case 3:ia(Ki),ji();break;case 26:case 27:case 5:Ci(a);break;case 4:ji();break;case 13:Ks(a);break;case 19:Ge(Wi);break;case 10:ia(a.type);break;case 22:case 23:Ks(a),Fd(),s!==null&&Ge(mo);break;case 24:ia(Ki)}}var NA={getCacheForType:function(s){var a=fr(Ki),u=a.data.get(s);return u===void 0&&(u=s(),a.data.set(s,u)),u}},DA=typeof WeakMap=="function"?WeakMap:Map,ai=0,Gn=null,hn=null,mn=0,ni=0,Gr=null,ua=!1,lc=!1,hl=!1,Ro=0,di=0,bo=0,uc=0,wf=0,wr=0,pl=0,hh=null,Co=null,If=!1,Of=0,da=1/0,Iu=null,Ao=null,Ou=!1,dc=null,Nu=0,YE=0,qE=null,wo=0,XE=null;function Hr(){if(ai&2&&mn!==0)return mn&-mn;if(Xt.T!==null){var s=mu;return s!==0?s:gh()}return O_()}function Nf(){wr===0&&(wr=!(mn&536870912)||Cn?QS():536870912);var s=vs.current;return s!==null&&(s.flags|=32),wr}function Ir(s,a,u){(s===Gn&&ni===2||s.cancelPendingCommit!==null)&&(ha(s,0),Io(s,mn,wr,!1)),Ji(s,u),(!(ai&2)||s!==Gn)&&(s===Gn&&(!(ai&2)&&(uc|=u),di===4&&Io(s,mn,wr,!1)),No(s))}function Xv(s,a,u){if(ai&6)throw Error(g(327));var m=!u&&(a&60)===0&&(a&s.expiredLanes)===0||vd(s,a),T=m?PA(s,a):hc(s,a,!0),C=m;do{if(T===0){lc&&!m&&Io(s,a,0,!1);break}else if(T===6)Io(s,a,0,!ua);else{if(u=s.current.alternate,C&&!QE(u)){T=hc(s,a,!1),C=!1;continue}if(T===2){if(C=a,s.errorRecoveryDisabledLanes&C)var x=0;else x=s.pendingLanes&-536870913,x=x!==0?x:x&536870912?536870912:0;if(x!==0){a=x;t:{var K=s;T=hh;var $=K.current.memoizedState.isDehydrated;if($&&(ha(K,x).flags|=256),x=hc(K,x,!1),x!==2){if(hl&&!$){K.errorRecoveryDisabledLanes|=C,uc|=C,T=4;break t}C=Co,Co=T,C!==null&&JE(C)}T=x}if(C=!1,T!==2)continue}}if(T===1){ha(s,0),Io(s,a,0,!0);break}t:{switch(m=s,T){case 0:case 1:throw Error(g(345));case 4:if((a&4194176)===a){Io(m,a,wr,!ua);break t}break;case 2:Co=null;break;case 3:case 5:break;default:throw Error(g(329))}if(m.finishedWork=u,m.finishedLanes=a,(a&62914560)===a&&(C=Of+300-ti(),10<C)){if(Io(m,a,wr,!ua),Ba(m,0)!==0)break t;m.timeoutHandle=Ey(Jv.bind(null,m,u,Co,Iu,If,a,wr,uc,pl,ua,2,-0,0),C);break t}Jv(m,u,Co,Iu,If,a,wr,uc,pl,ua,0,-0,0)}}break}while(!0);No(s)}function JE(s){Co===null?Co=s:Co.push.apply(Co,s)}function Jv(s,a,u,m,T,C,x,K,$,ut,Pt,Kt,vt){var Nt=a.subtreeFlags;if((Nt&8192||(Nt&16785408)===16785408)&&(Tl={stylesheets:null,count:0,unsuspend:Iy},Rf(a),a=tw(),a!==null)){s.cancelPendingCommit=a(Mf.bind(null,s,u,m,T,x,K,$,1,Kt,vt)),Io(s,C,x,!ut);return}Mf(s,u,m,T,x,K,$,Pt,Kt,vt)}function QE(s){for(var a=s;;){var u=a.tag;if((u===0||u===11||u===15)&&a.flags&16384&&(u=a.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var m=0;m<u.length;m++){var T=u[m],C=T.getSnapshot;T=T.value;try{if(!ns(C(),T))return!1}catch{return!1}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Io(s,a,u,m){a&=~wf,a&=~uc,s.suspendedLanes|=a,s.pingedLanes&=~a,m&&(s.warmLanes|=a),m=s.expirationTimes;for(var T=a;0<T;){var C=31-ts(T),x=1<<C;m[C]=-1,T&=~x}u!==0&&$S(s,u,a)}function ph(){return ai&6?!0:(Eh(0),!1)}function Df(){if(hn!==null){if(ni===0)var s=hn.return;else s=hn,na=al=null,lE(s),hu=null,Vd=0,s=hn;for(;s!==null;)qv(s.alternate,s),s=s.return;hn=null}}function ha(s,a){s.finishedWork=null,s.finishedLanes=0;var u=s.timeoutHandle;u!==-1&&(s.timeoutHandle=-1,Gf(u)),u=s.cancelPendingCommit,u!==null&&(s.cancelPendingCommit=null,u()),Df(),Gn=s,hn=u=yo(s.current,null),mn=a,ni=0,Gr=null,ua=!1,lc=vd(s,a),hl=!1,pl=wr=wf=uc=bo=di=0,Co=hh=null,If=!1,a&8&&(a|=a&32);var m=s.entangledLanes;if(m!==0)for(s=s.entanglements,m&=a;0<m;){var T=31-ts(m),C=1<<T;a|=s[T],m&=~C}return Ro=a,Vp(),u}function Pf(s,a){rn=null,Xt.H=_o,a===Md?(a=Kp(),ni=3):a===WT?(a=Kp(),ni=4):ni=a===pf?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Gr=a,hn===null&&(di=1,df(s,Cr(a,s.current)))}function fh(){var s=Xt.H;return Xt.H=_o,s===null?_o:s}function mh(){var s=Xt.A;return Xt.A=NA,s}function Lf(){di=4,ua||(mn&4194176)!==mn&&vs.current!==null||(lc=!0),!(bo&134217727)&&!(uc&134217727)||Gn===null||Io(Gn,mn,wr,!1)}function hc(s,a,u){var m=ai;ai|=2;var T=fh(),C=mh();(Gn!==s||mn!==a)&&(Iu=null,ha(s,a)),a=!1;var x=di;t:do try{if(ni!==0&&hn!==null){var K=hn,$=Gr;switch(ni){case 8:Df(),x=6;break t;case 3:case 2:case 6:vs.current===null&&(a=!0);var ut=ni;if(ni=0,Gr=null,Du(s,K,$,ut),u&&lc){x=0;break t}break;default:ut=ni,ni=0,Gr=null,Du(s,K,$,ut)}}fl(),x=di;break}catch(Pt){Pf(s,Pt)}while(!0);return a&&s.shellSuspendCounter++,na=al=null,ai=m,Xt.H=T,Xt.A=C,hn===null&&(Gn=null,mn=0,Vp()),x}function fl(){for(;hn!==null;)Qv(hn)}function PA(s,a){var u=ai;ai|=2;var m=fh(),T=mh();Gn!==s||mn!==a?(Iu=null,da=ti()+500,ha(s,a)):lc=vd(s,a);t:do try{if(ni!==0&&hn!==null){a=hn;var C=Gr;e:switch(ni){case 1:ni=0,Gr=null,Du(s,a,C,1);break;case 2:if(KT(C)){ni=0,Gr=null,Zv(a);break}a=function(){ni===2&&Gn===s&&(ni=7),No(s)},C.then(a,a);break t;case 3:ni=7;break t;case 4:ni=5;break t;case 7:KT(C)?(ni=0,Gr=null,Zv(a)):(ni=0,Gr=null,Du(s,a,C,7));break;case 5:var x=null;switch(hn.tag){case 26:x=hn.memoizedState;case 5:case 27:var K=hn;if(!x||hg(x)){ni=0,Gr=null;var $=K.sibling;if($!==null)hn=$;else{var ut=K.return;ut!==null?(hn=ut,kf(ut)):hn=null}break e}}ni=0,Gr=null,Du(s,a,C,5);break;case 6:ni=0,Gr=null,Du(s,a,C,6);break;case 8:Df(),di=6;break t;default:throw Error(g(462))}}_h();break}catch(Pt){Pf(s,Pt)}while(!0);return na=al=null,Xt.H=m,Xt.A=T,ai=u,hn!==null?0:(Gn=null,mn=0,Vp(),di)}function _h(){for(;hn!==null&&!KC();)Qv(hn)}function Qv(s){var a=Mv(s.alternate,s,Ro);s.memoizedProps=s.pendingProps,a===null?kf(s):hn=a}function Zv(s){var a=s,u=a.alternate;switch(a.tag){case 15:case 0:a=yE(u,a,a.pendingProps,a.type,void 0,mn);break;case 11:a=yE(u,a,a.pendingProps,a.type.render,a.ref,mn);break;case 5:lE(a);default:qv(u,a),a=hn=ca(a,Ro),a=Mv(u,a,Ro)}s.memoizedProps=s.pendingProps,a===null?kf(s):hn=a}function Du(s,a,u,m){na=al=null,lE(a),hu=null,Vd=0;var T=a.return;try{if(Dv(s,T,a,u,mn)){di=1,df(s,Cr(u,s.current)),hn=null;return}}catch(C){if(T!==null)throw hn=T,C;di=1,df(s,Cr(u,s.current)),hn=null;return}a.flags&32768?(Cn||m===1?s=!0:lc||mn&536870912?s=!1:(ua=s=!0,(m===2||m===3||m===6)&&(m=vs.current,m!==null&&m.tag===13&&(m.flags|=16384))),ZE(a,s)):kf(a)}function kf(s){var a=s;do{if(a.flags&32768){ZE(a,ua);return}s=a.return;var u=OA(a.alternate,a,Ro);if(u!==null){hn=u;return}if(a=a.sibling,a!==null){hn=a;return}hn=a=s}while(a!==null);di===0&&(di=5)}function ZE(s,a){do{var u=Yv(s.alternate,s);if(u!==null){u.flags&=32767,hn=u;return}if(u=s.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!a&&(s=s.sibling,s!==null)){hn=s;return}hn=s=u}while(s!==null);di=6,hn=null}function Mf(s,a,u,m,T,C,x,K,$,ut){var Pt=Xt.T,Kt=Qt.p;try{Qt.p=2,Xt.T=null,$v(s,a,u,m,Kt,T,C,x,K,$,ut)}finally{Xt.T=Pt,Qt.p=Kt}}function $v(s,a,u,m,T,C,x,K){do ml();while(dc!==null);if(ai&6)throw Error(g(327));var $=s.finishedWork;if(m=s.finishedLanes,$===null)return null;if(s.finishedWork=null,s.finishedLanes=0,$===s.current)throw Error(g(177));s.callbackNode=null,s.callbackPriority=0,s.cancelPendingCommit=null;var ut=$.lanes|$.childLanes;if(ut|=$_,YC(s,m,ut,C,x,K),s===Gn&&(hn=Gn=null,mn=0),!($.subtreeFlags&10256)&&!($.flags&10256)||Ou||(Ou=!0,YE=ut,qE=u,ry(Td,function(){return ml(),null})),u=($.flags&15990)!==0,$.subtreeFlags&15990||u?(u=Xt.T,Xt.T=null,C=Qt.p,Qt.p=2,x=ai,ai|=4,wA(s,$),Wv($,s),EA(Ec,s.containerInfo),bh=!!_c,Ec=_c=null,s.current=$,Fv(s,$.alternate,$),KS(),ai=x,Qt.p=C,Xt.T=u):s.current=$,Ou?(Ou=!1,dc=s,Nu=m):ty(s,ut),ut=s.pendingLanes,ut===0&&(Ao=null),XS($.stateNode),No(s),a!==null)for(T=s.onRecoverableError,$=0;$<a.length;$++)ut=a[$],T(ut.value,{componentStack:ut.stack});return Nu&3&&ml(),ut=s.pendingLanes,m&4194218&&ut&42?s===XE?wo++:(wo=0,XE=s):wo=0,Eh(0),null}function ty(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Hd(a)))}function ml(){if(dc!==null){var s=dc,a=YE;YE=0;var u=I_(Nu),m=Xt.T,T=Qt.p;try{if(Qt.p=32>u?32:u,Xt.T=null,dc===null)var C=!1;else{u=qE,qE=null;var x=dc,K=Nu;if(dc=null,Nu=0,ai&6)throw Error(g(331));var $=ai;if(ai|=4,zv(x.current),Au(x,x.current,K,u),ai=$,Eh(0,!1),Fi&&typeof Fi.onPostCommitFiberRoot=="function")try{Fi.onPostCommitFiberRoot(zl,x)}catch{}C=!0}return C}finally{Qt.p=T,Xt.T=m,ty(s,a)}}return!1}function ey(s,a,u){a=Cr(u,a),a=ih(s.stateNode,a,2),s=sc(s,a,2),s!==null&&(Ji(s,2),No(s))}function On(s,a,u){if(s.tag===3)ey(s,s,u);else for(;a!==null;){if(a.tag===3){ey(a,s,u);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Ao===null||!Ao.has(m))){s=Cr(u,s),u=Ov(2),m=sc(a,u,2),m!==null&&(Nv(u,m,a,s),Ji(m,2),No(m));break}}a=a.return}}function Cs(s,a,u){var m=s.pingCache;if(m===null){m=s.pingCache=new DA;var T=new Set;m.set(a,T)}else T=m.get(a),T===void 0&&(T=new Set,m.set(a,T));T.has(u)||(hl=!0,T.add(u),s=ny.bind(null,s,a,u),a.then(s,s))}function ny(s,a,u){var m=s.pingCache;m!==null&&m.delete(a),s.pingedLanes|=s.suspendedLanes&u,s.warmLanes&=~u,Gn===s&&(mn&u)===u&&(di===4||di===3&&(mn&62914560)===mn&&300>ti()-Of?!(ai&2)&&ha(s,0):wf|=u,pl===mn&&(pl=0)),No(s)}function iy(s,a){a===0&&(a=ZS()),s=gs(s,a),s!==null&&(Ji(s,a),No(s))}function LA(s){var a=s.memoizedState,u=0;a!==null&&(u=a.retryLane),iy(s,u)}function $E(s,a){var u=0;switch(s.tag){case 13:var m=s.stateNode,T=s.memoizedState;T!==null&&(u=T.retryLane);break;case 19:m=s.stateNode;break;case 22:m=s.stateNode._retryCache;break;default:throw Error(g(314))}m!==null&&m.delete(a),iy(s,u)}function ry(s,a){return gd(s,a)}var Uf=null,pa=null,Oo=!1,pc=!1,tg=!1,_l=0;function No(s){s!==pa&&s.next===null&&(pa===null?Uf=pa=s:pa=pa.next=s),pc=!0,Oo||(Oo=!0,cy(eg))}function Eh(s,a){if(!tg&&pc){tg=!0;do for(var u=!1,m=Uf;m!==null;){if(s!==0){var T=m.pendingLanes;if(T===0)var C=0;else{var x=m.suspendedLanes,K=m.pingedLanes;C=(1<<31-ts(42|s)+1)-1,C&=T&~(x&~K),C=C&201326677?C&201326677|1:C?C|2:0}C!==0&&(u=!0,ay(m,C))}else C=mn,C=Ba(m,m===Gn?C:0),!(C&3)||vd(m,C)||(u=!0,ay(m,C));m=m.next}while(u);tg=!1}}function eg(){pc=Oo=!1;var s=0;_l!==0&&(xA()&&(s=_l),_l=0);for(var a=ti(),u=null,m=Uf;m!==null;){var T=m.next,C=sy(m,a);C===0?(m.next=null,u===null?Uf=T:u.next=T,T===null&&(pa=u)):(u=m,(s!==0||C&3)&&(pc=!0)),m=T}Eh(s)}function sy(s,a){for(var u=s.suspendedLanes,m=s.pingedLanes,T=s.expirationTimes,C=s.pendingLanes&-62914561;0<C;){var x=31-ts(C),K=1<<x,$=T[x];$===-1?(!(K&u)||K&m)&&(T[x]=ql(K,a)):$<=a&&(s.expiredLanes|=K),C&=~K}if(a=Gn,u=mn,u=Ba(s,s===a?u:0),m=s.callbackNode,u===0||s===a&&ni===2||s.cancelPendingCommit!==null)return m!==null&&m!==null&&Sd(m),s.callbackNode=null,s.callbackPriority=0;if(!(u&3)||vd(s,u)){if(a=u&-u,a===s.callbackPriority)return a;switch(m!==null&&Sd(m),I_(u)){case 2:case 8:u=po;break;case 32:u=Td;break;case 268435456:u=A_;break;default:u=Td}return m=oy.bind(null,s),u=gd(u,m),s.callbackPriority=a,s.callbackNode=u,a}return m!==null&&m!==null&&Sd(m),s.callbackPriority=2,s.callbackNode=null,2}function oy(s,a){var u=s.callbackNode;if(ml()&&s.callbackNode!==u)return null;var m=mn;return m=Ba(s,s===Gn?m:0),m===0?null:(Xv(s,m,a),sy(s,ti()),s.callbackNode!=null&&s.callbackNode===u?oy.bind(null,s):null)}function ay(s,a){if(ml())return null;Xv(s,a,!0)}function cy(s){VA(function(){ai&6?gd(b_,s):s()})}function gh(){return _l===0&&(_l=QS()),_l}function ly(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:wp(""+s)}function uy(s,a){var u=a.ownerDocument.createElement("input");return u.name=a.name,u.value=a.value,s.id&&u.setAttribute("form",s.id),a.parentNode.insertBefore(u,a),s=new FormData(s),u.parentNode.removeChild(u),s}function kA(s,a,u,m,T){if(a==="submit"&&u&&u.stateNode===T){var C=ly((T[xr]||null).action),x=m.submitter;x&&(a=(a=x[xr]||null)?ly(a.formAction):x.getAttribute("formAction"),a!==null&&(C=a,x=null));var K=new Dp("action","action",null,m,T);s.push({event:K,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(_l!==0){var $=x?uy(T,x):new FormData(T);nl(u,{pending:!0,data:$,method:T.method,action:C},null,$)}}else typeof C=="function"&&(K.preventDefault(),$=x?uy(T,x):new FormData(T),nl(u,{pending:!0,data:$,method:T.method,action:C},C,$))},currentTarget:T}]})}}for(var xf=0;xf<jT.length;xf++){var Sh=jT[xf],dy=Sh.toLowerCase(),hy=Sh[0].toUpperCase()+Sh.slice(1);Gs(dy,"on"+hy)}Gs(UT,"onAnimationEnd"),Gs(xT,"onAnimationIteration"),Gs(xp,"onAnimationStart"),Gs("dblclick","onDoubleClick"),Gs("focusin","onFocus"),Gs("focusout","onBlur"),Gs(Z_,"onTransitionRun"),Gs(SA,"onTransitionStart"),Gs(Ct,"onTransitionCancel"),Gs(VT,"onTransitionEnd"),Ql("onMouseEnter",["mouseout","mouseover"]),Ql("onMouseLeave",["mouseout","mouseover"]),Ql("onPointerEnter",["pointerout","pointerover"]),Ql("onPointerLeave",["pointerout","pointerover"]),qn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),qn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),qn("onBeforeInput",["compositionend","keypress","textInput","paste"]),qn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),qn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),qn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),py=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(fc));function fy(s,a){a=(a&4)!==0;for(var u=0;u<s.length;u++){var m=s[u],T=m.event;m=m.listeners;t:{var C=void 0;if(a)for(var x=m.length-1;0<=x;x--){var K=m[x],$=K.instance,ut=K.currentTarget;if(K=K.listener,$!==C&&T.isPropagationStopped())break t;C=K,T.currentTarget=ut;try{C(T)}catch(Pt){nh(Pt)}T.currentTarget=null,C=$}else for(x=0;x<m.length;x++){if(K=m[x],$=K.instance,ut=K.currentTarget,K=K.listener,$!==C&&T.isPropagationStopped())break t;C=K,T.currentTarget=ut;try{C(T)}catch(Pt){nh(Pt)}T.currentTarget=null,C=$}}}}function pn(s,a){var u=a[N_];u===void 0&&(u=a[N_]=new Set);var m=s+"__bubble";u.has(m)||(Bf(a,s,2,!1),u.add(m))}function ng(s,a,u){var m=0;a&&(m|=4),Bf(u,s,m,a)}var Vf="_reactListening"+Math.random().toString(36).slice(2);function El(s){if(!s[Vf]){s[Vf]=!0,eT.forEach(function(u){u!=="selectionchange"&&(py.has(u)||ng(u,!1,s),ng(u,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[Vf]||(a[Vf]=!0,ng("selectionchange",!1,a))}}function Bf(s,a,u,m){switch(My(a)){case 2:var T=nw;break;case 8:T=ky;break;default:T=Ch}u=T.bind(null,a,u,s),T=void 0,!V_||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(T=!0),m?T!==void 0?s.addEventListener(a,u,{capture:!0,passive:T}):s.addEventListener(a,u,!0):T!==void 0?s.addEventListener(a,u,{passive:T}):s.addEventListener(a,u,!1)}function jf(s,a,u,m,T){var C=m;if(!(a&1)&&!(a&2)&&m!==null)t:for(;;){if(m===null)return;var x=m.tag;if(x===3||x===4){var K=m.stateNode.containerInfo;if(K===T||K.nodeType===8&&K.parentNode===T)break;if(x===4)for(x=m.return;x!==null;){var $=x.tag;if(($===3||$===4)&&($=x.stateNode.containerInfo,$===T||$.nodeType===8&&$.parentNode===T))return;x=x.return}for(;K!==null;){if(x=Fa(K),x===null)return;if($=x.tag,$===5||$===6||$===26||$===27){m=C=x;continue t}K=K.parentNode}}m=m.return}hT(function(){var ut=C,Pt=U_(u),Kt=[];t:{var vt=BT.get(s);if(vt!==void 0){var Nt=Dp,Ee=s;switch(s){case"keypress":if(Op(u)===0)break t;case"keydown":case"keyup":Nt=aA;break;case"focusin":Ee="focus",Nt=nu;break;case"focusout":Ee="blur",Nt=nu;break;case"beforeblur":case"afterblur":Nt=nu;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Nt=hr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Nt=tA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Nt=iu;break;case UT:case xT:case xp:Nt=nA;break;case VT:Nt=ru;break;case"scroll":case"scrollend":Nt=Es;break;case"wheel":Nt=dA;break;case"copy":case"cut":case"paste":Nt=iA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Nt=mT;break;case"toggle":case"beforetoggle":Nt=hA}var Be=(a&4)!==0,vi=!Be&&(s==="scroll"||s==="scrollend"),mt=Be?vt!==null?vt+"Capture":null:vt;Be=[];for(var ct=ut,gt;ct!==null;){var jt=ct;if(gt=jt.stateNode,jt=jt.tag,jt!==5&&jt!==26&&jt!==27||gt===null||mt===null||(jt=eu(ct,mt),jt!=null&&Be.push(gl(ct,jt,gt))),vi)break;ct=ct.return}0<Be.length&&(vt=new Nt(vt,Ee,null,u,Pt),Kt.push({event:vt,listeners:Be}))}}if(!(a&7)){t:{if(vt=s==="mouseover"||s==="pointerover",Nt=s==="mouseout"||s==="pointerout",vt&&u!==M_&&(Ee=u.relatedTarget||u.fromElement)&&(Fa(Ee)||Ee[zc]))break t;if((Nt||vt)&&(vt=Pt.window===Pt?Pt:(vt=Pt.ownerDocument)?vt.defaultView||vt.parentWindow:window,Nt?(Ee=u.relatedTarget||u.toElement,Nt=ut,Ee=Ee?Fa(Ee):null,Ee!==null&&(vi=Mt(Ee),Be=Ee.tag,Ee!==vi||Be!==5&&Be!==27&&Be!==6)&&(Ee=null)):(Nt=null,Ee=ut),Nt!==Ee)){if(Be=hr,jt="onMouseLeave",mt="onMouseEnter",ct="mouse",(s==="pointerout"||s==="pointerover")&&(Be=mT,jt="onPointerLeave",mt="onPointerEnter",ct="pointer"),vi=Nt==null?vt:bd(Nt),gt=Ee==null?vt:bd(Ee),vt=new Be(jt,ct+"leave",Nt,u,Pt),vt.target=vi,vt.relatedTarget=gt,jt=null,Fa(Pt)===ut&&(Be=new Be(mt,ct+"enter",Ee,u,Pt),Be.target=gt,Be.relatedTarget=vi,jt=Be),vi=jt,Nt&&Ee)e:{for(Be=Nt,mt=Ee,ct=0,gt=Be;gt;gt=mc(gt))ct++;for(gt=0,jt=mt;jt;jt=mc(jt))gt++;for(;0<ct-gt;)Be=mc(Be),ct--;for(;0<gt-ct;)mt=mc(mt),gt--;for(;ct--;){if(Be===mt||mt!==null&&Be===mt.alternate)break e;Be=mc(Be),mt=mc(mt)}Be=null}else Be=null;Nt!==null&&my(Kt,vt,Nt,Be,!1),Ee!==null&&vi!==null&&my(Kt,vi,Ee,Be,!0)}}t:{if(vt=ut?bd(ut):window,Nt=vt.nodeName&&vt.nodeName.toLowerCase(),Nt==="select"||Nt==="input"&&vt.type==="file")var he=bT;else if(yT(vt))if(CT)he=NT;else{he=mA;var an=OT}else Nt=vt.nodeName,!Nt||Nt.toLowerCase()!=="input"||vt.type!=="checkbox"&&vt.type!=="radio"?ut&&Ad(ut.elementType)&&(he=bT):he=_A;if(he&&(he=he(s,ut))){RT(Kt,he,u,Pt);break t}an&&an(s,vt,ut),s==="focusout"&&ut&&vt.type==="number"&&ut.memoizedProps.value!=null&&k_(vt,"number",vt.value)}switch(an=ut?bd(ut):window,s){case"focusin":(yT(an)||an.contentEditable==="true")&&(Gi=an,X_=ut,Ld=null);break;case"focusout":Ld=X_=Gi=null;break;case"mousedown":J_=!0;break;case"contextmenu":case"mouseup":case"dragend":J_=!1,kT(Kt,u,Pt);break;case"selectionchange":if(gA)break;case"keydown":case"keyup":kT(Kt,u,Pt)}var ve;if(W_)t:{switch(s){case"compositionstart":var Ne="onCompositionStart";break t;case"compositionend":Ne="onCompositionEnd";break t;case"compositionupdate":Ne="onCompositionUpdate";break t}Ne=void 0}else su?Mp(s,u)&&(Ne="onCompositionEnd"):s==="keydown"&&u.keyCode===229&&(Ne="onCompositionStart");Ne&&(ET&&u.locale!=="ko"&&(su||Ne!=="onCompositionStart"?Ne==="onCompositionEnd"&&su&&(ve=pT()):(Ha=Pt,qc="value"in Ha?Ha.value:Ha.textContent,su=!0)),an=Pu(ut,Ne),0<an.length&&(Ne=new kp(Ne,s,null,u,Pt),Kt.push({event:Ne,listeners:an}),ve?Ne.data=ve:(ve=TT(u),ve!==null&&(Ne.data=ve)))),(ve=K_?vT(s,u):fA(s,u))&&(Ne=Pu(ut,"onBeforeInput"),0<Ne.length&&(an=new kp("onBeforeInput","beforeinput",null,u,Pt),Kt.push({event:an,listeners:Ne}),an.data=ve)),kA(Kt,s,ut,u,Pt)}fy(Kt,a)})}function gl(s,a,u){return{instance:s,listener:a,currentTarget:u}}function Pu(s,a){for(var u=a+"Capture",m=[];s!==null;){var T=s,C=T.stateNode;T=T.tag,T!==5&&T!==26&&T!==27||C===null||(T=eu(s,u),T!=null&&m.unshift(gl(s,T,C)),T=eu(s,a),T!=null&&m.push(gl(s,T,C))),s=s.return}return m}function mc(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function my(s,a,u,m,T){for(var C=a._reactName,x=[];u!==null&&u!==m;){var K=u,$=K.alternate,ut=K.stateNode;if(K=K.tag,$!==null&&$===m)break;K!==5&&K!==26&&K!==27||ut===null||($=ut,T?(ut=eu(u,C),ut!=null&&x.unshift(gl(u,ut,$))):T||(ut=eu(u,C),ut!=null&&x.push(gl(u,ut,$)))),u=u.return}x.length!==0&&s.push({event:a,listeners:x})}var MA=/\r\n?/g,_y=/\u0000|\uFFFD/g;function ig(s){return(typeof s=="string"?s:""+s).replace(MA,`
`).replace(_y,"")}function rg(s,a){return a=ig(a),ig(s)===a}function Th(){}function Vn(s,a,u,m,T,C){switch(u){case"children":typeof m=="string"?a==="body"||a==="textarea"&&m===""||Ga(s,m):(typeof m=="number"||typeof m=="bigint")&&a!=="body"&&Ga(s,""+m);break;case"className":Rp(s,"class",m);break;case"tabIndex":Rp(s,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Rp(s,u,m);break;case"style":lT(s,m,C);break;case"data":if(a!=="object"){Rp(s,"data",m);break}case"src":case"href":if(m===""&&(a!=="a"||u!=="href")){s.removeAttribute(u);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(u);break}m=wp(""+m),s.setAttribute(u,m);break;case"action":case"formAction":if(typeof m=="function"){s.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(u==="formAction"?(a!=="input"&&Vn(s,a,"name",T.name,T,null),Vn(s,a,"formEncType",T.formEncType,T,null),Vn(s,a,"formMethod",T.formMethod,T,null),Vn(s,a,"formTarget",T.formTarget,T,null)):(Vn(s,a,"encType",T.encType,T,null),Vn(s,a,"method",T.method,T,null),Vn(s,a,"target",T.target,T,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(u);break}m=wp(""+m),s.setAttribute(u,m);break;case"onClick":m!=null&&(s.onclick=Th);break;case"onScroll":m!=null&&pn("scroll",s);break;case"onScrollEnd":m!=null&&pn("scrollend",s);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(g(61));if(u=m.__html,u!=null){if(T.children!=null)throw Error(g(60));s.innerHTML=u}}break;case"multiple":s.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":s.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){s.removeAttribute("xlink:href");break}u=wp(""+m),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(u,""+m):s.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(u,""):s.removeAttribute(u);break;case"capture":case"download":m===!0?s.setAttribute(u,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(u,m):s.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?s.setAttribute(u,m):s.removeAttribute(u);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?s.removeAttribute(u):s.setAttribute(u,m);break;case"popover":pn("beforetoggle",s),pn("toggle",s),Cd(s,"popover",m);break;case"xlinkActuate":Qo(s,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Qo(s,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Qo(s,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Qo(s,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Qo(s,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Qo(s,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Qo(s,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Qo(s,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Qo(s,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":Cd(s,"is",m);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=ZC.get(u)||u,Cd(s,u,m))}}function sg(s,a,u,m,T,C){switch(u){case"style":lT(s,m,C);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(g(61));if(u=m.__html,u!=null){if(T.children!=null)throw Error(g(60));s.innerHTML=u}}break;case"children":typeof m=="string"?Ga(s,m):(typeof m=="number"||typeof m=="bigint")&&Ga(s,""+m);break;case"onScroll":m!=null&&pn("scroll",s);break;case"onScrollEnd":m!=null&&pn("scrollend",s);break;case"onClick":m!=null&&(s.onclick=Th);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!nT.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(T=u.endsWith("Capture"),a=u.slice(2,T?u.length-7:void 0),C=s[xr]||null,C=C!=null?C[u]:null,typeof C=="function"&&s.removeEventListener(a,C,T),typeof m=="function")){typeof C!="function"&&C!==null&&(u in s?s[u]=null:s.hasAttribute(u)&&s.removeAttribute(u)),s.addEventListener(a,m,T);break t}u in s?s[u]=m:m===!0?s.setAttribute(u,""):Cd(s,u,m)}}}function $i(s,a,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":pn("error",s),pn("load",s);var m=!1,T=!1,C;for(C in u)if(u.hasOwnProperty(C)){var x=u[C];if(x!=null)switch(C){case"src":m=!0;break;case"srcSet":T=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(g(137,a));default:Vn(s,a,C,x,u,null)}}T&&Vn(s,a,"srcSet",u.srcSet,u,null),m&&Vn(s,a,"src",u.src,u,null);return;case"input":pn("invalid",s);var K=C=x=T=null,$=null,ut=null;for(m in u)if(u.hasOwnProperty(m)){var Pt=u[m];if(Pt!=null)switch(m){case"name":T=Pt;break;case"type":x=Pt;break;case"checked":$=Pt;break;case"defaultChecked":ut=Pt;break;case"value":C=Pt;break;case"defaultValue":K=Pt;break;case"children":case"dangerouslySetInnerHTML":if(Pt!=null)throw Error(g(137,a));break;default:Vn(s,a,m,Pt,u,null)}}sT(s,C,K,$,ut,x,T,!1),bp(s);return;case"select":pn("invalid",s),m=x=C=null;for(T in u)if(u.hasOwnProperty(T)&&(K=u[T],K!=null))switch(T){case"value":C=K;break;case"defaultValue":x=K;break;case"multiple":m=K;default:Vn(s,a,T,K,u,null)}a=C,u=x,s.multiple=!!m,a!=null?Zl(s,!!m,a,!1):u!=null&&Zl(s,!!m,u,!0);return;case"textarea":pn("invalid",s),C=T=m=null;for(x in u)if(u.hasOwnProperty(x)&&(K=u[x],K!=null))switch(x){case"value":m=K;break;case"defaultValue":T=K;break;case"children":C=K;break;case"dangerouslySetInnerHTML":if(K!=null)throw Error(g(91));break;default:Vn(s,a,x,K,u,null)}aT(s,m,T,C),bp(s);return;case"option":for($ in u)if(u.hasOwnProperty($)&&(m=u[$],m!=null))switch($){case"selected":s.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:Vn(s,a,$,m,u,null)}return;case"dialog":pn("cancel",s),pn("close",s);break;case"iframe":case"object":pn("load",s);break;case"video":case"audio":for(m=0;m<fc.length;m++)pn(fc[m],s);break;case"image":pn("error",s),pn("load",s);break;case"details":pn("toggle",s);break;case"embed":case"source":case"link":pn("error",s),pn("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ut in u)if(u.hasOwnProperty(ut)&&(m=u[ut],m!=null))switch(ut){case"children":case"dangerouslySetInnerHTML":throw Error(g(137,a));default:Vn(s,a,ut,m,u,null)}return;default:if(Ad(a)){for(Pt in u)u.hasOwnProperty(Pt)&&(m=u[Pt],m!==void 0&&sg(s,a,Pt,m,u,void 0));return}}for(K in u)u.hasOwnProperty(K)&&(m=u[K],m!=null&&Vn(s,a,K,m,u,null))}function UA(s,a,u,m){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var T=null,C=null,x=null,K=null,$=null,ut=null,Pt=null;for(Nt in u){var Kt=u[Nt];if(u.hasOwnProperty(Nt)&&Kt!=null)switch(Nt){case"checked":break;case"value":break;case"defaultValue":$=Kt;default:m.hasOwnProperty(Nt)||Vn(s,a,Nt,null,m,Kt)}}for(var vt in m){var Nt=m[vt];if(Kt=u[vt],m.hasOwnProperty(vt)&&(Nt!=null||Kt!=null))switch(vt){case"type":C=Nt;break;case"name":T=Nt;break;case"checked":ut=Nt;break;case"defaultChecked":Pt=Nt;break;case"value":x=Nt;break;case"defaultValue":K=Nt;break;case"children":case"dangerouslySetInnerHTML":if(Nt!=null)throw Error(g(137,a));break;default:Nt!==Kt&&Vn(s,a,vt,Nt,m,Kt)}}L_(s,x,K,$,ut,Pt,C,T);return;case"select":Nt=x=K=vt=null;for(C in u)if($=u[C],u.hasOwnProperty(C)&&$!=null)switch(C){case"value":break;case"multiple":Nt=$;default:m.hasOwnProperty(C)||Vn(s,a,C,null,m,$)}for(T in m)if(C=m[T],$=u[T],m.hasOwnProperty(T)&&(C!=null||$!=null))switch(T){case"value":vt=C;break;case"defaultValue":K=C;break;case"multiple":x=C;default:C!==$&&Vn(s,a,T,C,m,$)}a=K,u=x,m=Nt,vt!=null?Zl(s,!!u,vt,!1):!!m!=!!u&&(a!=null?Zl(s,!!u,a,!0):Zl(s,!!u,u?[]:"",!1));return;case"textarea":Nt=vt=null;for(K in u)if(T=u[K],u.hasOwnProperty(K)&&T!=null&&!m.hasOwnProperty(K))switch(K){case"value":break;case"children":break;default:Vn(s,a,K,null,m,T)}for(x in m)if(T=m[x],C=u[x],m.hasOwnProperty(x)&&(T!=null||C!=null))switch(x){case"value":vt=T;break;case"defaultValue":Nt=T;break;case"children":break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(g(91));break;default:T!==C&&Vn(s,a,x,T,m,C)}oT(s,vt,Nt);return;case"option":for(var Ee in u)if(vt=u[Ee],u.hasOwnProperty(Ee)&&vt!=null&&!m.hasOwnProperty(Ee))switch(Ee){case"selected":s.selected=!1;break;default:Vn(s,a,Ee,null,m,vt)}for($ in m)if(vt=m[$],Nt=u[$],m.hasOwnProperty($)&&vt!==Nt&&(vt!=null||Nt!=null))switch($){case"selected":s.selected=vt&&typeof vt!="function"&&typeof vt!="symbol";break;default:Vn(s,a,$,vt,m,Nt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Be in u)vt=u[Be],u.hasOwnProperty(Be)&&vt!=null&&!m.hasOwnProperty(Be)&&Vn(s,a,Be,null,m,vt);for(ut in m)if(vt=m[ut],Nt=u[ut],m.hasOwnProperty(ut)&&vt!==Nt&&(vt!=null||Nt!=null))switch(ut){case"children":case"dangerouslySetInnerHTML":if(vt!=null)throw Error(g(137,a));break;default:Vn(s,a,ut,vt,m,Nt)}return;default:if(Ad(a)){for(var vi in u)vt=u[vi],u.hasOwnProperty(vi)&&vt!==void 0&&!m.hasOwnProperty(vi)&&sg(s,a,vi,void 0,m,vt);for(Pt in m)vt=m[Pt],Nt=u[Pt],!m.hasOwnProperty(Pt)||vt===Nt||vt===void 0&&Nt===void 0||sg(s,a,Pt,vt,m,Nt);return}}for(var mt in u)vt=u[mt],u.hasOwnProperty(mt)&&vt!=null&&!m.hasOwnProperty(mt)&&Vn(s,a,mt,null,m,vt);for(Kt in m)vt=m[Kt],Nt=u[Kt],!m.hasOwnProperty(Kt)||vt===Nt||vt==null&&Nt==null||Vn(s,a,Kt,vt,m,Nt)}var _c=null,Ec=null;function Lu(s){return s.nodeType===9?s:s.ownerDocument}function og(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ag(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function cg(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Ff=null;function xA(){var s=window.event;return s&&s.type==="popstate"?s===Ff?!1:(Ff=s,!0):(Ff=null,!1)}var Ey=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,gy=typeof Promise=="function"?Promise:void 0,VA=typeof queueMicrotask=="function"?queueMicrotask:typeof gy<"u"?function(s){return gy.resolve(null).then(s).catch(BA)}:Ey;function BA(s){setTimeout(function(){throw s})}function lg(s,a){var u=a,m=0;do{var T=u.nextSibling;if(s.removeChild(u),T&&T.nodeType===8)if(u=T.data,u==="/$"){if(m===0){s.removeChild(T),Ih(a);return}m--}else u!=="$"&&u!=="$?"&&u!=="$!"||m++;u=T}while(u);Ih(a)}function ug(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var u=a;switch(a=a.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":ug(u),Rd(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}s.removeChild(u)}}function jA(s,a,u,m){for(;s.nodeType===1;){var T=u;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!m&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(m){if(!s[Xl])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(C=s.getAttribute("rel"),C==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(C!==T.rel||s.getAttribute("href")!==(T.href==null?null:T.href)||s.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin)||s.getAttribute("title")!==(T.title==null?null:T.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(C=s.getAttribute("src"),(C!==(T.src==null?null:T.src)||s.getAttribute("type")!==(T.type==null?null:T.type)||s.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin))&&C&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var C=T.name==null?null:""+T.name;if(T.type==="hidden"&&s.getAttribute("name")===C)return s}else return s;if(s=Ys(s.nextSibling),s===null)break}return null}function FA(s,a,u){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!u||(s=Ys(s.nextSibling),s===null))return null;return s}function Ys(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return s}function Sy(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var u=s.data;if(u==="$"||u==="$!"||u==="$?"){if(a===0)return s;a--}else u==="/$"&&a++}s=s.previousSibling}return null}function Ty(s,a,u){switch(a=Lu(u),s){case"html":if(s=a.documentElement,!s)throw Error(g(452));return s;case"head":if(s=a.head,!s)throw Error(g(453));return s;case"body":if(s=a.body,!s)throw Error(g(454));return s;default:throw Error(g(451))}}var As=new Map,vy=new Set;function Hf(s){return typeof s.getRootNode=="function"?s.getRootNode():s.ownerDocument}var fa=Qt.d;Qt.d={f:GA,r:HA,D:WA,C:KA,L:zA,m:YA,X:XA,S:qA,M:JA};function GA(){var s=fa.f(),a=ph();return s||a}function HA(s){var a=js(s);a!==null&&a.tag===5&&a.type==="form"?yv(a):fa.r(s)}var Sl=typeof document>"u"?null:document;function yy(s,a,u){var m=Sl;if(m&&typeof a=="string"&&a){var T=es(a);T='link[rel="'+s+'"][href="'+T+'"]',typeof u=="string"&&(T+='[crossorigin="'+u+'"]'),vy.has(T)||(vy.add(T),s={rel:s,crossOrigin:u,href:a},m.querySelector(T)===null&&(a=m.createElement("link"),$i(a,"link",s),Yn(a),m.head.appendChild(a)))}}function WA(s){fa.D(s),yy("dns-prefetch",s,null)}function KA(s,a){fa.C(s,a),yy("preconnect",s,a)}function zA(s,a,u){fa.L(s,a,u);var m=Sl;if(m&&s&&a){var T='link[rel="preload"][as="'+es(a)+'"]';a==="image"&&u&&u.imageSrcSet?(T+='[imagesrcset="'+es(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(T+='[imagesizes="'+es(u.imageSizes)+'"]')):T+='[href="'+es(s)+'"]';var C=T;switch(a){case"style":C=ku(s);break;case"script":C=Mu(s)}As.has(C)||(s=se({rel:"preload",href:a==="image"&&u&&u.imageSrcSet?void 0:s,as:a},u),As.set(C,s),m.querySelector(T)!==null||a==="style"&&m.querySelector(vh(C))||a==="script"&&m.querySelector(yh(C))||(a=m.createElement("link"),$i(a,"link",s),Yn(a),m.head.appendChild(a)))}}function YA(s,a){fa.m(s,a);var u=Sl;if(u&&s){var m=a&&typeof a.as=="string"?a.as:"script",T='link[rel="modulepreload"][as="'+es(m)+'"][href="'+es(s)+'"]',C=T;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=Mu(s)}if(!As.has(C)&&(s=se({rel:"modulepreload",href:s},a),As.set(C,s),u.querySelector(T)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(yh(C)))return}m=u.createElement("link"),$i(m,"link",s),Yn(m),u.head.appendChild(m)}}}function qA(s,a,u){fa.S(s,a,u);var m=Sl;if(m&&s){var T=Jl(m).hoistableStyles,C=ku(s);a=a||"default";var x=T.get(C);if(!x){var K={loading:0,preload:null};if(x=m.querySelector(vh(C)))K.loading=5;else{s=se({rel:"stylesheet",href:s,"data-precedence":a},u),(u=As.get(C))&&Kf(s,u);var $=x=m.createElement("link");Yn($),$i($,"link",s),$._p=new Promise(function(ut,Pt){$.onload=ut,$.onerror=Pt}),$.addEventListener("load",function(){K.loading|=1}),$.addEventListener("error",function(){K.loading|=2}),K.loading|=4,Wf(x,a,m)}x={type:"stylesheet",instance:x,count:1,state:K},T.set(C,x)}}}function XA(s,a){fa.X(s,a);var u=Sl;if(u&&s){var m=Jl(u).hoistableScripts,T=Mu(s),C=m.get(T);C||(C=u.querySelector(yh(T)),C||(s=se({src:s,async:!0},a),(a=As.get(T))&&dg(s,a),C=u.createElement("script"),Yn(C),$i(C,"link",s),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},m.set(T,C))}}function JA(s,a){fa.M(s,a);var u=Sl;if(u&&s){var m=Jl(u).hoistableScripts,T=Mu(s),C=m.get(T);C||(C=u.querySelector(yh(T)),C||(s=se({src:s,async:!0,type:"module"},a),(a=As.get(T))&&dg(s,a),C=u.createElement("script"),Yn(C),$i(C,"link",s),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},m.set(T,C))}}function Ry(s,a,u,m){var T=(T=jn.current)?Hf(T):null;if(!T)throw Error(g(446));switch(s){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(a=ku(u.href),u=Jl(T).hoistableStyles,m=u.get(a),m||(m={type:"style",instance:null,count:0,state:null},u.set(a,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){s=ku(u.href);var C=Jl(T).hoistableStyles,x=C.get(s);if(x||(T=T.ownerDocument||T,x={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(s,x),(C=T.querySelector(vh(s)))&&!C._p&&(x.instance=C,x.state.loading=5),As.has(s)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},As.set(s,u),C||QA(T,s,u,x.state))),a&&m===null)throw Error(g(528,""));return x}if(a&&m!==null)throw Error(g(529,""));return null;case"script":return a=u.async,u=u.src,typeof u=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Mu(u),u=Jl(T).hoistableScripts,m=u.get(a),m||(m={type:"script",instance:null,count:0,state:null},u.set(a,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(g(444,s))}}function ku(s){return'href="'+es(s)+'"'}function vh(s){return'link[rel="stylesheet"]['+s+"]"}function by(s){return se({},s,{"data-precedence":s.precedence,precedence:null})}function QA(s,a,u,m){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?m.loading=1:(a=s.createElement("link"),m.preload=a,a.addEventListener("load",function(){return m.loading|=1}),a.addEventListener("error",function(){return m.loading|=2}),$i(a,"link",u),Yn(a),s.head.appendChild(a))}function Mu(s){return'[src="'+es(s)+'"]'}function yh(s){return"script[async]"+s}function Cy(s,a,u){if(a.count++,a.instance===null)switch(a.type){case"style":var m=s.querySelector('style[data-href~="'+es(u.href)+'"]');if(m)return a.instance=m,Yn(m),m;var T=se({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return m=(s.ownerDocument||s).createElement("style"),Yn(m),$i(m,"style",T),Wf(m,u.precedence,s),a.instance=m;case"stylesheet":T=ku(u.href);var C=s.querySelector(vh(T));if(C)return a.state.loading|=4,a.instance=C,Yn(C),C;m=by(u),(T=As.get(T))&&Kf(m,T),C=(s.ownerDocument||s).createElement("link"),Yn(C);var x=C;return x._p=new Promise(function(K,$){x.onload=K,x.onerror=$}),$i(C,"link",m),a.state.loading|=4,Wf(C,u.precedence,s),a.instance=C;case"script":return C=Mu(u.src),(T=s.querySelector(yh(C)))?(a.instance=T,Yn(T),T):(m=u,(T=As.get(C))&&(m=se({},u),dg(m,T)),s=s.ownerDocument||s,T=s.createElement("script"),Yn(T),$i(T,"link",m),s.head.appendChild(T),a.instance=T);case"void":return null;default:throw Error(g(443,a.type))}else a.type==="stylesheet"&&!(a.state.loading&4)&&(m=a.instance,a.state.loading|=4,Wf(m,u.precedence,s));return a.instance}function Wf(s,a,u){for(var m=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),T=m.length?m[m.length-1]:null,C=T,x=0;x<m.length;x++){var K=m[x];if(K.dataset.precedence===a)C=K;else if(C!==T)break}C?C.parentNode.insertBefore(s,C.nextSibling):(a=u.nodeType===9?u.head:u,a.insertBefore(s,a.firstChild))}function Kf(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function dg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var zf=null;function Ay(s,a,u){if(zf===null){var m=new Map,T=zf=new Map;T.set(u,m)}else T=zf,m=T.get(u),m||(m=new Map,T.set(u,m));if(m.has(s))return m;for(m.set(s,null),u=u.getElementsByTagName(s),T=0;T<u.length;T++){var C=u[T];if(!(C[Xl]||C[rr]||s==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var x=C.getAttribute(a)||"";x=s+x;var K=m.get(x);K?K.push(C):m.set(x,[C])}}return m}function wy(s,a,u){s=s.ownerDocument||s,s.head.insertBefore(u,a==="title"?s.querySelector("head > title"):null)}function ZA(s,a,u){if(u===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return s=a.disabled,typeof a.precedence=="string"&&s==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function hg(s){return!(s.type==="stylesheet"&&!(s.state.loading&3))}var Tl=null;function Iy(){}function $A(s,a,u){if(Tl===null)throw Error(g(475));var m=Tl;if(a.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&!(a.state.loading&4)){if(a.instance===null){var T=ku(u.href),C=s.querySelector(vh(T));if(C){s=C._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(m.count++,m=Uu.bind(m),s.then(m,m)),a.state.loading|=4,a.instance=C,Yn(C);return}C=s.ownerDocument||s,u=by(u),(T=As.get(T))&&Kf(u,T),C=C.createElement("link"),Yn(C);var x=C;x._p=new Promise(function(K,$){x.onload=K,x.onerror=$}),$i(C,"link",u),a.instance=C}m.stylesheets===null&&(m.stylesheets=new Map),m.stylesheets.set(a,s),(s=a.state.preload)&&!(a.state.loading&3)&&(m.count++,a=Uu.bind(m),s.addEventListener("load",a),s.addEventListener("error",a))}}function tw(){if(Tl===null)throw Error(g(475));var s=Tl;return s.stylesheets&&s.count===0&&pg(s,s.stylesheets),0<s.count?function(a){var u=setTimeout(function(){if(s.stylesheets&&pg(s,s.stylesheets),s.unsuspend){var m=s.unsuspend;s.unsuspend=null,m()}},6e4);return s.unsuspend=a,function(){s.unsuspend=null,clearTimeout(u)}}:null}function Uu(){if(this.count--,this.count===0){if(this.stylesheets)pg(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Yf=null;function pg(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Yf=new Map,a.forEach(ew,s),Yf=null,Uu.call(s))}function ew(s,a){if(!(a.state.loading&4)){var u=Yf.get(s);if(u)var m=u.get(null);else{u=new Map,Yf.set(s,u);for(var T=s.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<T.length;C++){var x=T[C];(x.nodeName==="LINK"||x.getAttribute("media")!=="not all")&&(u.set(x.dataset.precedence,x),m=x)}m&&u.set(null,m)}T=a.instance,x=T.getAttribute("data-precedence"),C=u.get(x)||m,C===m&&u.set(null,T),u.set(x,T),this.count++,m=Uu.bind(this),T.addEventListener("load",m),T.addEventListener("error",m),C?C.parentNode.insertBefore(T,C.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(T,s.firstChild)),a.state.loading|=4}}var Rh={$$typeof:at,Provider:null,Consumer:null,_currentValue:We,_currentValue2:We,_threadCount:0};function Oy(s,a,u,m,T,C,x,K){this.tag=1,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=w_(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=w_(0),this.hiddenUpdates=w_(null),this.identifierPrefix=m,this.onUncaughtError=T,this.onCaughtError=C,this.onRecoverableError=x,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=K,this.incompleteTransitions=new Map}function Ny(s,a,u,m,T,C,x,K,$,ut,Pt,Kt){return s=new Oy(s,a,u,x,K,$,ut,Kt),a=1,C===!0&&(a|=24),C=bs(3,null,null,a),s.current=C,C.stateNode=s,a=oE(),a.refCount++,s.pooledCache=a,a.refCount++,C.memoizedState={element:m,isDehydrated:u,cache:a},rh(C),s}function qf(s){return s?(s=Zo,s):Zo}function Dy(s,a,u,m,T,C){T=qf(T),m.context===null?m.context=T:m.pendingContext=T,m=rc(a),m.payload={element:u},C=C===void 0?null:C,C!==null&&(m.callback=C),u=sc(s,m,a),u!==null&&(Ir(u,s,a),sh(u,s,a))}function Py(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var u=s.retryLane;s.retryLane=u!==0&&u<a?u:a}}function fg(s,a){Py(s,a),(s=s.alternate)&&Py(s,a)}function Ly(s){if(s.tag===13){var a=gs(s,67108864);a!==null&&Ir(a,s,67108864),fg(s,67108864)}}var bh=!0;function nw(s,a,u,m){var T=Xt.T;Xt.T=null;var C=Qt.p;try{Qt.p=2,Ch(s,a,u,m)}finally{Qt.p=C,Xt.T=T}}function ky(s,a,u,m){var T=Xt.T;Xt.T=null;var C=Qt.p;try{Qt.p=8,Ch(s,a,u,m)}finally{Qt.p=C,Xt.T=T}}function Ch(s,a,u,m){if(bh){var T=mg(m);if(T===null)jf(s,a,m,Xf,u),_g(s,m);else if(Uy(T,s,a,u,m))m.stopPropagation();else if(_g(s,m),a&4&&-1<iw.indexOf(s)){for(;T!==null;){var C=js(T);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var x=Kc(C.pendingLanes);if(x!==0){var K=C;for(K.pendingLanes|=2,K.entangledLanes|=2;x;){var $=1<<31-ts(x);K.entanglements[1]|=$,x&=~$}No(C),!(ai&6)&&(da=ti()+500,Eh(0))}}break;case 13:K=gs(C,2),K!==null&&Ir(K,C,2),ph(),fg(C,2)}if(C=mg(m),C===null&&jf(s,a,m,Xf,u),C===T)break;T=C}T!==null&&m.stopPropagation()}else jf(s,a,m,null,u)}}function mg(s){return s=U_(s),Jf(s)}var Xf=null;function Jf(s){if(Xf=null,s=Fa(s),s!==null){var a=Mt(s);if(a===null)s=null;else{var u=a.tag;if(u===13){if(s=ge(a),s!==null)return s;s=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Xf=s,null}function My(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(zS()){case b_:return 2;case po:return 8;case Td:case C_:return 32;case A_:return 268435456;default:return 32}default:return 32}}var Qf=!1,ma=null,gc=null,Sc=null,Ah=new Map,wh=new Map,Tc=[],iw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _g(s,a){switch(s){case"focusin":case"focusout":ma=null;break;case"dragenter":case"dragleave":gc=null;break;case"mouseover":case"mouseout":Sc=null;break;case"pointerover":case"pointerout":Ah.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":wh.delete(a.pointerId)}}function vl(s,a,u,m,T,C){return s===null||s.nativeEvent!==C?(s={blockedOn:a,domEventName:u,eventSystemFlags:m,nativeEvent:C,targetContainers:[T]},a!==null&&(a=js(a),a!==null&&Ly(a)),s):(s.eventSystemFlags|=m,a=s.targetContainers,T!==null&&a.indexOf(T)===-1&&a.push(T),s)}function Uy(s,a,u,m,T){switch(a){case"focusin":return ma=vl(ma,s,a,u,m,T),!0;case"dragenter":return gc=vl(gc,s,a,u,m,T),!0;case"mouseover":return Sc=vl(Sc,s,a,u,m,T),!0;case"pointerover":var C=T.pointerId;return Ah.set(C,vl(Ah.get(C)||null,s,a,u,m,T)),!0;case"gotpointercapture":return C=T.pointerId,wh.set(C,vl(wh.get(C)||null,s,a,u,m,T)),!0}return!1}function At(s){var a=Fa(s.target);if(a!==null){var u=Mt(a);if(u!==null){if(a=u.tag,a===13){if(a=ge(u),a!==null){s.blockedOn=a,tT(s.priority,function(){if(u.tag===13){var m=Hr(),T=gs(u,m);T!==null&&Ir(T,u,m),fg(u,m)}});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){s.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Zf(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var u=mg(s.nativeEvent);if(u===null){u=s.nativeEvent;var m=new u.constructor(u.type,u);M_=m,u.target.dispatchEvent(m),M_=null}else return a=js(u),a!==null&&Ly(a),s.blockedOn=u,!1;a.shift()}return!0}function xy(s,a,u){Zf(s)&&u.delete(a)}function rw(){Qf=!1,ma!==null&&Zf(ma)&&(ma=null),gc!==null&&Zf(gc)&&(gc=null),Sc!==null&&Zf(Sc)&&(Sc=null),Ah.forEach(xy),wh.forEach(xy)}function $f(s,a){s.blockedOn===a&&(s.blockedOn=null,Qf||(Qf=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,rw)))}var tm=null;function em(s){tm!==s&&(tm=s,h.unstable_scheduleCallback(h.unstable_NormalPriority,function(){tm===s&&(tm=null);for(var a=0;a<s.length;a+=3){var u=s[a],m=s[a+1],T=s[a+2];if(typeof m!="function"){if(Jf(m||u)===null)continue;break}var C=js(u);C!==null&&(s.splice(a,3),a-=3,nl(C,{pending:!0,data:T,method:u.method,action:m},m,T))}}))}function Ih(s){function a($){return $f($,s)}ma!==null&&$f(ma,s),gc!==null&&$f(gc,s),Sc!==null&&$f(Sc,s),Ah.forEach(a),wh.forEach(a);for(var u=0;u<Tc.length;u++){var m=Tc[u];m.blockedOn===s&&(m.blockedOn=null)}for(;0<Tc.length&&(u=Tc[0],u.blockedOn===null);)At(u),u.blockedOn===null&&Tc.shift();if(u=(s.ownerDocument||s).$$reactFormReplay,u!=null)for(m=0;m<u.length;m+=3){var T=u[m],C=u[m+1],x=T[xr]||null;if(typeof C=="function")x||em(u);else if(x){var K=null;if(C&&C.hasAttribute("formAction")){if(T=C,x=C[xr]||null)K=x.formAction;else if(Jf(T)!==null)continue}else K=x.action;typeof K=="function"?u[m+1]=K:(u.splice(m,3),m-=3),em(u)}}}function Eg(s){this._internalRoot=s}or.prototype.render=Eg.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(g(409));var u=a.current,m=Hr();Dy(u,m,s,a,null,null)},or.prototype.unmount=Eg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;s.tag===0&&ml(),Dy(s.current,2,null,s,null,null),ph(),a[zc]=null}};function or(s){this._internalRoot=s}or.prototype.unstable_scheduleHydration=function(s){if(s){var a=O_();s={blockedOn:null,target:s,priority:a};for(var u=0;u<Tc.length&&a!==0&&a<Tc[u].priority;u++);Tc.splice(u,0,s),u===0&&At(s)}};var Vy=_.version;if(Vy!=="19.0.0")throw Error(g(527,Vy,"19.0.0"));Qt.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(g(188)):(s=Object.keys(s).join(","),Error(g(268,s)));return s=Vt(a),s=s!==null?ce(s):null,s=s===null?null:s.stateNode,s};var sw={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:Xt,findFiberByHostInstance:Fa,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var nm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nm.isDisabled&&nm.supportsFiber)try{zl=nm.inject(sw),Fi=nm}catch{}}return wS.createRoot=function(s,a){if(!R(s))throw Error(g(299));var u=!1,m="",T=wv,C=gE,x=Iv,K=null;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onUncaughtError!==void 0&&(T=a.onUncaughtError),a.onCaughtError!==void 0&&(C=a.onCaughtError),a.onRecoverableError!==void 0&&(x=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(K=a.unstable_transitionCallbacks)),a=Ny(s,1,!1,null,null,u,m,T,C,x,K,null),s[zc]=a.current,El(s.nodeType===8?s.parentNode:s),new Eg(a)},wS.hydrateRoot=function(s,a,u){if(!R(s))throw Error(g(299));var m=!1,T="",C=wv,x=gE,K=Iv,$=null,ut=null;return u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(T=u.identifierPrefix),u.onUncaughtError!==void 0&&(C=u.onUncaughtError),u.onCaughtError!==void 0&&(x=u.onCaughtError),u.onRecoverableError!==void 0&&(K=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&($=u.unstable_transitionCallbacks),u.formState!==void 0&&(ut=u.formState)),a=Ny(s,1,!0,a,u??null,m,T,C,x,K,$,ut),a.context=qf(null),u=a.current,m=Hr(),T=rc(m),T.callback=null,sc(u,T,m),a.current.lanes=m,Ji(a,m),No(a),s[zc]=a.current,El(s),new or(a)},wS.version="19.0.0",wS}var kj;function B7(){if(kj)return M0.exports;kj=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(_){console.error(_)}}return h(),M0.exports=V7(),M0.exports}var j7=B7();function Mj(h,_){if(typeof h=="function")return h(_);h!=null&&(h.current=_)}function BF(...h){return _=>{let E=!1;const g=h.map(R=>{const w=Mj(R,_);return!E&&typeof w=="function"&&(E=!0),w});if(E)return()=>{for(let R=0;R<g.length;R++){const w=g[R];typeof w=="function"?w():Mj(h[R],null)}}}}function Ur(...h){return Z.useCallback(BF(...h),h)}var p_=Z.forwardRef((h,_)=>{const{children:E,...g}=h,R=Z.Children.toArray(E),w=R.find(G7);if(w){const N=w.props.children,k=R.map(B=>B===w?Z.Children.count(N)>1?Z.Children.only(null):Z.isValidElement(N)?N.props.children:null:B);return Rt.jsx(oN,{...g,ref:_,children:Z.isValidElement(N)?Z.cloneElement(N,void 0,k):null})}return Rt.jsx(oN,{...g,ref:_,children:E})});p_.displayName="Slot";var oN=Z.forwardRef((h,_)=>{const{children:E,...g}=h;if(Z.isValidElement(E)){const R=W7(E),w=H7(g,E.props);return E.type!==Z.Fragment&&(w.ref=_?BF(_,R):R),Z.cloneElement(E,w)}return Z.Children.count(E)>1?Z.Children.only(null):null});oN.displayName="SlotClone";var F7=({children:h})=>Rt.jsx(Rt.Fragment,{children:h});function G7(h){return Z.isValidElement(h)&&h.type===F7}function H7(h,_){const E={..._};for(const g in _){const R=h[g],w=_[g];/^on[A-Z]/.test(g)?R&&w?E[g]=(...k)=>{w(...k),R(...k)}:R&&(E[g]=R):g==="style"?E[g]={...R,...w}:g==="className"&&(E[g]=[R,w].filter(Boolean).join(" "))}return{...h,...E}}function W7(h){var g,R;let _=(g=Object.getOwnPropertyDescriptor(h.props,"ref"))==null?void 0:g.get,E=_&&"isReactWarning"in _&&_.isReactWarning;return E?h.ref:(_=(R=Object.getOwnPropertyDescriptor(h,"ref"))==null?void 0:R.get,E=_&&"isReactWarning"in _&&_.isReactWarning,E?h.props.ref:h.props.ref||h.ref)}function jF(h){var _,E,g="";if(typeof h=="string"||typeof h=="number")g+=h;else if(typeof h=="object")if(Array.isArray(h)){var R=h.length;for(_=0;_<R;_++)h[_]&&(E=jF(h[_]))&&(g&&(g+=" "),g+=E)}else for(E in h)h[E]&&(g&&(g+=" "),g+=E);return g}function FF(){for(var h,_,E=0,g="",R=arguments.length;E<R;E++)(h=arguments[E])&&(_=jF(h))&&(g&&(g+=" "),g+=_);return g}const Uj=h=>typeof h=="boolean"?`${h}`:h===0?"0":h,xj=FF,GF=(h,_)=>E=>{var g;if((_==null?void 0:_.variants)==null)return xj(h,E==null?void 0:E.class,E==null?void 0:E.className);const{variants:R,defaultVariants:w}=_,N=Object.keys(R).map(V=>{const G=E==null?void 0:E[V],z=w==null?void 0:w[V];if(G===null)return null;const nt=Uj(G)||Uj(z);return R[V][nt]}),k=E&&Object.entries(E).reduce((V,G)=>{let[z,nt]=G;return nt===void 0||(V[z]=nt),V},{}),B=_==null||(g=_.compoundVariants)===null||g===void 0?void 0:g.reduce((V,G)=>{let{class:z,className:nt,...at}=G;return Object.entries(at).every(J=>{let[q,it]=J;return Array.isArray(it)?it.includes({...w,...k}[q]):{...w,...k}[q]===it})?[...V,z,nt]:V},[]);return xj(h,N,B,E==null?void 0:E.class,E==null?void 0:E.className)},UN="-",K7=h=>{const _=Y7(h),{conflictingClassGroups:E,conflictingClassGroupModifiers:g}=h;return{getClassGroupId:N=>{const k=N.split(UN);return k[0]===""&&k.length!==1&&k.shift(),HF(k,_)||z7(N)},getConflictingClassGroupIds:(N,k)=>{const B=E[N]||[];return k&&g[N]?[...B,...g[N]]:B}}},HF=(h,_)=>{var N;if(h.length===0)return _.classGroupId;const E=h[0],g=_.nextPart.get(E),R=g?HF(h.slice(1),g):void 0;if(R)return R;if(_.validators.length===0)return;const w=h.join(UN);return(N=_.validators.find(({validator:k})=>k(w)))==null?void 0:N.classGroupId},Vj=/^\[(.+)\]$/,z7=h=>{if(Vj.test(h)){const _=Vj.exec(h)[1],E=_==null?void 0:_.substring(0,_.indexOf(":"));if(E)return"arbitrary.."+E}},Y7=h=>{const{theme:_,classGroups:E}=h,g={nextPart:new Map,validators:[]};for(const R in E)aN(E[R],g,R,_);return g},aN=(h,_,E,g)=>{h.forEach(R=>{if(typeof R=="string"){const w=R===""?_:Bj(_,R);w.classGroupId=E;return}if(typeof R=="function"){if(q7(R)){aN(R(g),_,E,g);return}_.validators.push({validator:R,classGroupId:E});return}Object.entries(R).forEach(([w,N])=>{aN(N,Bj(_,w),E,g)})})},Bj=(h,_)=>{let E=h;return _.split(UN).forEach(g=>{E.nextPart.has(g)||E.nextPart.set(g,{nextPart:new Map,validators:[]}),E=E.nextPart.get(g)}),E},q7=h=>h.isThemeGetter,X7=h=>{if(h<1)return{get:()=>{},set:()=>{}};let _=0,E=new Map,g=new Map;const R=(w,N)=>{E.set(w,N),_++,_>h&&(_=0,g=E,E=new Map)};return{get(w){let N=E.get(w);if(N!==void 0)return N;if((N=g.get(w))!==void 0)return R(w,N),N},set(w,N){E.has(w)?E.set(w,N):R(w,N)}}},cN="!",lN=":",J7=lN.length,Q7=h=>{const{prefix:_,experimentalParseClassName:E}=h;let g=R=>{const w=[];let N=0,k=0,B=0,V;for(let J=0;J<R.length;J++){let q=R[J];if(N===0&&k===0){if(q===lN){w.push(R.slice(B,J)),B=J+J7;continue}if(q==="/"){V=J;continue}}q==="["?N++:q==="]"?N--:q==="("?k++:q===")"&&k--}const G=w.length===0?R:R.substring(B),z=Z7(G),nt=z!==G,at=V&&V>B?V-B:void 0;return{modifiers:w,hasImportantModifier:nt,baseClassName:z,maybePostfixModifierPosition:at}};if(_){const R=_+lN,w=g;g=N=>N.startsWith(R)?w(N.substring(R.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:N,maybePostfixModifierPosition:void 0}}if(E){const R=g;g=w=>E({className:w,parseClassName:R})}return g},Z7=h=>h.endsWith(cN)?h.substring(0,h.length-1):h.startsWith(cN)?h.substring(1):h,$7=h=>{const _=Object.fromEntries(h.orderSensitiveModifiers.map(g=>[g,!0]));return g=>{if(g.length<=1)return g;const R=[];let w=[];return g.forEach(N=>{N[0]==="["||_[N]?(R.push(...w.sort(),N),w=[]):w.push(N)}),R.push(...w.sort()),R}},t9=h=>({cache:X7(h.cacheSize),parseClassName:Q7(h),sortModifiers:$7(h),...K7(h)}),e9=/\s+/,n9=(h,_)=>{const{parseClassName:E,getClassGroupId:g,getConflictingClassGroupIds:R,sortModifiers:w}=_,N=[],k=h.trim().split(e9);let B="";for(let V=k.length-1;V>=0;V-=1){const G=k[V],{isExternal:z,modifiers:nt,hasImportantModifier:at,baseClassName:J,maybePostfixModifierPosition:q}=E(G);if(z){B=G+(B.length>0?" "+B:B);continue}let it=!!q,ht=g(it?J.substring(0,q):J);if(!ht){if(!it){B=G+(B.length>0?" "+B:B);continue}if(ht=g(J),!ht){B=G+(B.length>0?" "+B:B);continue}it=!1}const pt=w(nt).join(":"),lt=at?pt+cN:pt,bt=lt+ht;if(N.includes(bt))continue;N.push(bt);const Tt=R(ht,it);for(let Yt=0;Yt<Tt.length;++Yt){const Ht=Tt[Yt];N.push(lt+Ht)}B=G+(B.length>0?" "+B:B)}return B};function i9(){let h=0,_,E,g="";for(;h<arguments.length;)(_=arguments[h++])&&(E=WF(_))&&(g&&(g+=" "),g+=E);return g}const WF=h=>{if(typeof h=="string")return h;let _,E="";for(let g=0;g<h.length;g++)h[g]&&(_=WF(h[g]))&&(E&&(E+=" "),E+=_);return E};function r9(h,..._){let E,g,R,w=N;function N(B){const V=_.reduce((G,z)=>z(G),h());return E=t9(V),g=E.cache.get,R=E.cache.set,w=k,k(B)}function k(B){const V=g(B);if(V)return V;const G=n9(B,E);return R(B,G),G}return function(){return w(i9.apply(null,arguments))}}const yr=h=>{const _=E=>E[h]||[];return _.isThemeGetter=!0,_},KF=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,zF=/^\((?:(\w[\w-]*):)?(.+)\)$/i,s9=/^\d+\/\d+$/,o9=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,a9=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,c9=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,l9=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,u9=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,o_=h=>s9.test(h),vn=h=>!!h&&!Number.isNaN(Number(h)),up=h=>!!h&&Number.isInteger(Number(h)),jj=h=>h.endsWith("%")&&vn(h.slice(0,-1)),cd=h=>o9.test(h),d9=()=>!0,h9=h=>a9.test(h)&&!c9.test(h),xN=()=>!1,p9=h=>l9.test(h),f9=h=>u9.test(h),m9=h=>!ue(h)&&!de(h),_9=h=>__(h,XF,xN),ue=h=>KF.test(h),dp=h=>__(h,JF,h9),B0=h=>__(h,w9,vn),E9=h=>__(h,YF,xN),g9=h=>__(h,qF,f9),S9=h=>__(h,xN,p9),de=h=>zF.test(h),tC=h=>E_(h,JF),T9=h=>E_(h,I9),v9=h=>E_(h,YF),y9=h=>E_(h,XF),R9=h=>E_(h,qF),b9=h=>E_(h,O9,!0),__=(h,_,E)=>{const g=KF.exec(h);return g?g[1]?_(g[1]):E(g[2]):!1},E_=(h,_,E=!1)=>{const g=zF.exec(h);return g?g[1]?_(g[1]):E:!1},YF=h=>h==="position",C9=new Set(["image","url"]),qF=h=>C9.has(h),A9=new Set(["length","size","percentage"]),XF=h=>A9.has(h),JF=h=>h==="length",w9=h=>h==="number",I9=h=>h==="family-name",O9=h=>h==="shadow",N9=()=>{const h=yr("color"),_=yr("font"),E=yr("text"),g=yr("font-weight"),R=yr("tracking"),w=yr("leading"),N=yr("breakpoint"),k=yr("container"),B=yr("spacing"),V=yr("radius"),G=yr("shadow"),z=yr("inset-shadow"),nt=yr("drop-shadow"),at=yr("blur"),J=yr("perspective"),q=yr("aspect"),it=yr("ease"),ht=yr("animate"),pt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],lt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],bt=()=>["auto","hidden","clip","visible","scroll"],Tt=()=>["auto","contain","none"],Yt=()=>[o_,"px","full","auto",de,ue,B],Ht=()=>[up,"none","subgrid",de,ue],re=()=>["auto",{span:["full",up,de,ue]},de,ue],Xt=()=>[up,"auto",de,ue],se=()=>["auto","min","max","fr",de,ue],Ve=()=>[de,ue,B],me=()=>["start","end","center","between","around","evenly","stretch","baseline"],ke=()=>["start","end","center","stretch"],Zt=()=>[de,ue,B],xe=()=>["px",...Zt()],kt=()=>["px","auto",...Zt()],zt=()=>[o_,"auto","px","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",de,ue,B],Mt=()=>[h,de,ue],ge=()=>[jj,dp],rt=()=>["","none","full",V,de,ue],Vt=()=>["",vn,tC,dp],ce=()=>["solid","dashed","dotted","double"],fe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Qt=()=>["","none",at,de,ue],We=()=>["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",de,ue],we=()=>["none",vn,de,ue],le=()=>["none",vn,de,ue],_e=()=>[vn,de,ue],Ge=()=>[o_,"full","px",de,ue,B];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[cd],breakpoint:[cd],color:[d9],container:[cd],"drop-shadow":[cd],ease:["in","out","in-out"],font:[m9],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[cd],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[cd],shadow:[cd],spacing:[vn],text:[cd],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",o_,ue,de,q]}],container:["container"],columns:[{columns:[vn,ue,de,k]}],"break-after":[{"break-after":pt()}],"break-before":[{"break-before":pt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...lt(),ue,de]}],overflow:[{overflow:bt()}],"overflow-x":[{"overflow-x":bt()}],"overflow-y":[{"overflow-y":bt()}],overscroll:[{overscroll:Tt()}],"overscroll-x":[{"overscroll-x":Tt()}],"overscroll-y":[{"overscroll-y":Tt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Yt()}],"inset-x":[{"inset-x":Yt()}],"inset-y":[{"inset-y":Yt()}],start:[{start:Yt()}],end:[{end:Yt()}],top:[{top:Yt()}],right:[{right:Yt()}],bottom:[{bottom:Yt()}],left:[{left:Yt()}],visibility:["visible","invisible","collapse"],z:[{z:[up,"auto",de,ue]}],basis:[{basis:[o_,"full","auto",de,ue,k,B]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[vn,o_,"auto","initial","none",ue]}],grow:[{grow:["",vn,de,ue]}],shrink:[{shrink:["",vn,de,ue]}],order:[{order:[up,"first","last","none",de,ue]}],"grid-cols":[{"grid-cols":Ht()}],"col-start-end":[{col:re()}],"col-start":[{"col-start":Xt()}],"col-end":[{"col-end":Xt()}],"grid-rows":[{"grid-rows":Ht()}],"row-start-end":[{row:re()}],"row-start":[{"row-start":Xt()}],"row-end":[{"row-end":Xt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":se()}],"auto-rows":[{"auto-rows":se()}],gap:[{gap:Ve()}],"gap-x":[{"gap-x":Ve()}],"gap-y":[{"gap-y":Ve()}],"justify-content":[{justify:[...me(),"normal"]}],"justify-items":[{"justify-items":[...ke(),"normal"]}],"justify-self":[{"justify-self":["auto",...ke()]}],"align-content":[{content:["normal",...me()]}],"align-items":[{items:[...ke(),"baseline"]}],"align-self":[{self:["auto",...ke(),"baseline"]}],"place-content":[{"place-content":me()}],"place-items":[{"place-items":[...ke(),"baseline"]}],"place-self":[{"place-self":["auto",...ke()]}],p:[{p:xe()}],px:[{px:xe()}],py:[{py:xe()}],ps:[{ps:xe()}],pe:[{pe:xe()}],pt:[{pt:xe()}],pr:[{pr:xe()}],pb:[{pb:xe()}],pl:[{pl:xe()}],m:[{m:kt()}],mx:[{mx:kt()}],my:[{my:kt()}],ms:[{ms:kt()}],me:[{me:kt()}],mt:[{mt:kt()}],mr:[{mr:kt()}],mb:[{mb:kt()}],ml:[{ml:kt()}],"space-x":[{"space-x":Zt()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Zt()}],"space-y-reverse":["space-y-reverse"],size:[{size:zt()}],w:[{w:[k,"screen",...zt()]}],"min-w":[{"min-w":[k,"screen","none",...zt()]}],"max-w":[{"max-w":[k,"screen","none","prose",{screen:[N]},...zt()]}],h:[{h:["screen",...zt()]}],"min-h":[{"min-h":["screen","none",...zt()]}],"max-h":[{"max-h":["screen",...zt()]}],"font-size":[{text:["base",E,tC,dp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[g,de,B0]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",jj,ue]}],"font-family":[{font:[T9,ue,_]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[R,de,ue]}],"line-clamp":[{"line-clamp":[vn,"none",de,B0]}],leading:[{leading:[de,ue,w,B]}],"list-image":[{"list-image":["none",de,ue]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",de,ue]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Mt()}],"text-color":[{text:Mt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ce(),"wavy"]}],"text-decoration-thickness":[{decoration:[vn,"from-font","auto",de,dp]}],"text-decoration-color":[{decoration:Mt()}],"underline-offset":[{"underline-offset":[vn,"auto",de,ue]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:["px",...Zt()]}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",de,ue]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",de,ue]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...lt(),v9,E9]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:["auto","cover","contain",y9,_9]}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},up,de,ue],radial:["",de,ue],conic:[up,de,ue]},R9,g9]}],"bg-color":[{bg:Mt()}],"gradient-from-pos":[{from:ge()}],"gradient-via-pos":[{via:ge()}],"gradient-to-pos":[{to:ge()}],"gradient-from":[{from:Mt()}],"gradient-via":[{via:Mt()}],"gradient-to":[{to:Mt()}],rounded:[{rounded:rt()}],"rounded-s":[{"rounded-s":rt()}],"rounded-e":[{"rounded-e":rt()}],"rounded-t":[{"rounded-t":rt()}],"rounded-r":[{"rounded-r":rt()}],"rounded-b":[{"rounded-b":rt()}],"rounded-l":[{"rounded-l":rt()}],"rounded-ss":[{"rounded-ss":rt()}],"rounded-se":[{"rounded-se":rt()}],"rounded-ee":[{"rounded-ee":rt()}],"rounded-es":[{"rounded-es":rt()}],"rounded-tl":[{"rounded-tl":rt()}],"rounded-tr":[{"rounded-tr":rt()}],"rounded-br":[{"rounded-br":rt()}],"rounded-bl":[{"rounded-bl":rt()}],"border-w":[{border:Vt()}],"border-w-x":[{"border-x":Vt()}],"border-w-y":[{"border-y":Vt()}],"border-w-s":[{"border-s":Vt()}],"border-w-e":[{"border-e":Vt()}],"border-w-t":[{"border-t":Vt()}],"border-w-r":[{"border-r":Vt()}],"border-w-b":[{"border-b":Vt()}],"border-w-l":[{"border-l":Vt()}],"divide-x":[{"divide-x":Vt()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Vt()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...ce(),"hidden","none"]}],"divide-style":[{divide:[...ce(),"hidden","none"]}],"border-color":[{border:Mt()}],"border-color-x":[{"border-x":Mt()}],"border-color-y":[{"border-y":Mt()}],"border-color-s":[{"border-s":Mt()}],"border-color-e":[{"border-e":Mt()}],"border-color-t":[{"border-t":Mt()}],"border-color-r":[{"border-r":Mt()}],"border-color-b":[{"border-b":Mt()}],"border-color-l":[{"border-l":Mt()}],"divide-color":[{divide:Mt()}],"outline-style":[{outline:[...ce(),"none","hidden"]}],"outline-offset":[{"outline-offset":[vn,de,ue]}],"outline-w":[{outline:["",vn,tC,dp]}],"outline-color":[{outline:[h]}],shadow:[{shadow:["","none",G,b9,S9]}],"shadow-color":[{shadow:Mt()}],"inset-shadow":[{"inset-shadow":["none",de,ue,z]}],"inset-shadow-color":[{"inset-shadow":Mt()}],"ring-w":[{ring:Vt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Mt()}],"ring-offset-w":[{"ring-offset":[vn,dp]}],"ring-offset-color":[{"ring-offset":Mt()}],"inset-ring-w":[{"inset-ring":Vt()}],"inset-ring-color":[{"inset-ring":Mt()}],opacity:[{opacity:[vn,de,ue]}],"mix-blend":[{"mix-blend":[...fe(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":fe()}],filter:[{filter:["","none",de,ue]}],blur:[{blur:Qt()}],brightness:[{brightness:[vn,de,ue]}],contrast:[{contrast:[vn,de,ue]}],"drop-shadow":[{"drop-shadow":["","none",nt,de,ue]}],grayscale:[{grayscale:["",vn,de,ue]}],"hue-rotate":[{"hue-rotate":[vn,de,ue]}],invert:[{invert:["",vn,de,ue]}],saturate:[{saturate:[vn,de,ue]}],sepia:[{sepia:["",vn,de,ue]}],"backdrop-filter":[{"backdrop-filter":["","none",de,ue]}],"backdrop-blur":[{"backdrop-blur":Qt()}],"backdrop-brightness":[{"backdrop-brightness":[vn,de,ue]}],"backdrop-contrast":[{"backdrop-contrast":[vn,de,ue]}],"backdrop-grayscale":[{"backdrop-grayscale":["",vn,de,ue]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[vn,de,ue]}],"backdrop-invert":[{"backdrop-invert":["",vn,de,ue]}],"backdrop-opacity":[{"backdrop-opacity":[vn,de,ue]}],"backdrop-saturate":[{"backdrop-saturate":[vn,de,ue]}],"backdrop-sepia":[{"backdrop-sepia":["",vn,de,ue]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Zt()}],"border-spacing-x":[{"border-spacing-x":Zt()}],"border-spacing-y":[{"border-spacing-y":Zt()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",de,ue]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[vn,"initial",de,ue]}],ease:[{ease:["linear","initial",it,de,ue]}],delay:[{delay:[vn,de,ue]}],animate:[{animate:["none",ht,de,ue]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[J,de,ue]}],"perspective-origin":[{"perspective-origin":We()}],rotate:[{rotate:we()}],"rotate-x":[{"rotate-x":we()}],"rotate-y":[{"rotate-y":we()}],"rotate-z":[{"rotate-z":we()}],scale:[{scale:le()}],"scale-x":[{"scale-x":le()}],"scale-y":[{"scale-y":le()}],"scale-z":[{"scale-z":le()}],"scale-3d":["scale-3d"],skew:[{skew:_e()}],"skew-x":[{"skew-x":_e()}],"skew-y":[{"skew-y":_e()}],transform:[{transform:[de,ue,"","none","gpu","cpu"]}],"transform-origin":[{origin:We()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ge()}],"translate-x":[{"translate-x":Ge()}],"translate-y":[{"translate-y":Ge()}],"translate-z":[{"translate-z":Ge()}],"translate-none":["translate-none"],accent:[{accent:Mt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Mt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",de,ue]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Zt()}],"scroll-mx":[{"scroll-mx":Zt()}],"scroll-my":[{"scroll-my":Zt()}],"scroll-ms":[{"scroll-ms":Zt()}],"scroll-me":[{"scroll-me":Zt()}],"scroll-mt":[{"scroll-mt":Zt()}],"scroll-mr":[{"scroll-mr":Zt()}],"scroll-mb":[{"scroll-mb":Zt()}],"scroll-ml":[{"scroll-ml":Zt()}],"scroll-p":[{"scroll-p":Zt()}],"scroll-px":[{"scroll-px":Zt()}],"scroll-py":[{"scroll-py":Zt()}],"scroll-ps":[{"scroll-ps":Zt()}],"scroll-pe":[{"scroll-pe":Zt()}],"scroll-pt":[{"scroll-pt":Zt()}],"scroll-pr":[{"scroll-pr":Zt()}],"scroll-pb":[{"scroll-pb":Zt()}],"scroll-pl":[{"scroll-pl":Zt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",de,ue]}],fill:[{fill:["none",...Mt()]}],"stroke-w":[{stroke:[vn,tC,dp,B0]}],stroke:[{stroke:["none",...Mt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["before","after","placeholder","file","marker","selection","first-line","first-letter","backdrop","*","**"]}},D9=r9(N9);function Rr(...h){return D9(FF(h))}const P9=GF("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),kS=Z.forwardRef(({className:h,variant:_,size:E,asChild:g=!1,...R},w)=>{const N=g?p_:"button";return Rt.jsx(N,{className:Rr(P9({variant:_,size:E,className:h})),ref:w,...R})});kS.displayName="Button";const QF=Z.forwardRef(({className:h,..._},E)=>Rt.jsx("div",{ref:E,className:Rr("rounded-xl border bg-card text-card-foreground shadow",h),..._}));QF.displayName="Card";const ZF=Z.forwardRef(({className:h,..._},E)=>Rt.jsx("div",{ref:E,className:Rr("flex flex-col space-y-1.5 p-6",h),..._}));ZF.displayName="CardHeader";const $F=Z.forwardRef(({className:h,..._},E)=>Rt.jsx("div",{ref:E,className:Rr("font-semibold leading-none tracking-tight",h),..._}));$F.displayName="CardTitle";const t3=Z.forwardRef(({className:h,..._},E)=>Rt.jsx("div",{ref:E,className:Rr("text-sm text-muted-foreground",h),..._}));t3.displayName="CardDescription";const e3=Z.forwardRef(({className:h,..._},E)=>Rt.jsx("div",{ref:E,className:Rr("p-6 pt-0",h),..._}));e3.displayName="CardContent";const n3=Z.forwardRef(({className:h,..._},E)=>Rt.jsx("div",{ref:E,className:Rr("flex items-center p-6 pt-0",h),..._}));n3.displayName="CardFooter";const i3=Z.forwardRef(({className:h,type:_,...E},g)=>Rt.jsx("input",{type:_,className:Rr("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",h),ref:g,...E}));i3.displayName="Input";var jS=VF();const L9=MN(jS);var k9=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Xi=k9.reduce((h,_)=>{const E=Z.forwardRef((g,R)=>{const{asChild:w,...N}=g,k=w?p_:_;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),Rt.jsx(k,{...N,ref:R})});return E.displayName=`Primitive.${_}`,{...h,[_]:E}},{});function M9(h,_){h&&jS.flushSync(()=>h.dispatchEvent(_))}var U9="Label",r3=Z.forwardRef((h,_)=>Rt.jsx(Xi.label,{...h,ref:_,onMouseDown:E=>{var R;E.target.closest("button, input, select, textarea")||((R=h.onMouseDown)==null||R.call(h,E),!E.defaultPrevented&&E.detail>1&&E.preventDefault())}}));r3.displayName=U9;var s3=r3;const x9=GF("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o3=Z.forwardRef(({className:h,..._},E)=>Rt.jsx(s3,{ref:E,className:Rr(x9(),h),..._}));o3.displayName=s3.displayName;var aC={exports:{}},V9=aC.exports,Fj;function B9(){return Fj||(Fj=1,function(h,_){(function(E,g){h.exports=g()})(V9,function(){function E(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof P0<"u"?P0:typeof self<"u"?self:{};function R(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var w=function(t){try{return!!t()}catch{return!0}},N=!w(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),k=N,B=Function.prototype,V=B.call,G=k&&B.bind.bind(V,V),z=k?G:function(t){return function(){return V.apply(t,arguments)}},nt=z({}.isPrototypeOf),at=function(t){return t&&t.Math===Math&&t},J=at(typeof globalThis=="object"&&globalThis)||at(typeof window=="object"&&window)||at(typeof self=="object"&&self)||at(typeof g=="object"&&g)||at(typeof g=="object"&&g)||function(){return this}()||Function("return this")(),q=N,it=Function.prototype,ht=it.apply,pt=it.call,lt=typeof Reflect=="object"&&Reflect.apply||(q?pt.bind(ht):function(){return pt.apply(ht,arguments)}),bt=z,Tt=bt({}.toString),Yt=bt("".slice),Ht=function(t){return Yt(Tt(t),8,-1)},re=Ht,Xt=z,se=function(t){if(re(t)==="Function")return Xt(t)},Ve=typeof document=="object"&&document.all,me=Ve===void 0&&Ve!==void 0?function(t){return typeof t=="function"||t===Ve}:function(t){return typeof t=="function"},ke={},Zt=!w(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),xe=N,kt=Function.prototype.call,zt=xe?kt.bind(kt):function(){return kt.apply(kt,arguments)},Mt={},ge={}.propertyIsEnumerable,rt=Object.getOwnPropertyDescriptor,Vt=rt&&!ge.call({1:2},1);Mt.f=Vt?function(t){var e=rt(this,t);return!!e&&e.enumerable}:ge;var ce,fe,Qt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},We=w,we=Ht,le=Object,_e=z("".split),Ge=We(function(){return!le("z").propertyIsEnumerable(0)})?function(t){return we(t)==="String"?_e(t,""):le(t)}:le,Te=function(t){return t==null},nn=Te,gn=TypeError,jn=function(t){if(nn(t))throw new gn("Can't call method on "+t);return t},br=Ge,ho=jn,ji=function(t){return br(ho(t))},Xo=me,Ci=function(t){return typeof t=="object"?t!==null:Xo(t)},ki={},gd=ki,Sd=J,KC=me,KS=function(t){return KC(t)?t:void 0},ti=function(t,e){return arguments.length<2?KS(gd[t])||KS(Sd[t]):gd[t]&&gd[t][e]||Sd[t]&&Sd[t][e]},zS=J.navigator,b_=zS&&zS.userAgent,po=b_?String(b_):"",Td=J,C_=po,A_=Td.process,YS=Td.Deno,qS=A_&&A_.versions||YS&&YS.version,zl=qS&&qS.v8;zl&&(fe=(ce=zl.split("."))[0]>0&&ce[0]<4?1:+(ce[0]+ce[1])),!fe&&C_&&(!(ce=C_.match(/Edge\/(\d+)/))||ce[1]>=74)&&(ce=C_.match(/Chrome\/(\d+)/))&&(fe=+ce[1]);var Fi=fe,XS=Fi,Va=w,ts=J.String,Yl=!!Object.getOwnPropertySymbols&&!Va(function(){var t=Symbol("symbol detection");return!ts(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&XS&&XS<41}),JS=Yl&&!Symbol.sham&&typeof Symbol.iterator=="symbol",zC=ti,Tp=me,vp=nt,Kc=Object,Ba=JS?function(t){return typeof t=="symbol"}:function(t){var e=zC("Symbol");return Tp(e)&&vp(e.prototype,Kc(t))},vd=String,ql=function(t){try{return vd(t)}catch{return"Object"}},QS=me,ZS=ql,w_=TypeError,Ji=function(t){if(QS(t))return t;throw new w_(ZS(t)+" is not a function")},YC=Ji,$S=Te,yd=function(t,e){var n=t[e];return $S(n)?void 0:YC(n)},I_=zt,O_=me,tT=Ci,ja=TypeError,rr={exports:{}},xr=!0,zc=J,N_=Object.defineProperty,qC=J,XC=function(t,e){try{N_(zc,t,{value:e,configurable:!0,writable:!0})}catch{zc[t]=e}return e},D_="__core-js_shared__",Xl=rr.exports=qC[D_]||XC(D_,{});(Xl.versions||(Xl.versions=[])).push({version:"3.39.0",mode:"pure",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Rd=rr.exports,Fa=Rd,js=function(t,e){return Fa[t]||(Fa[t]=e||{})},bd=jn,Jl=Object,Yn=function(t){return Jl(bd(t))},eT=Yn,nT=z({}.hasOwnProperty),qn=Object.hasOwn||function(t,e){return nT(eT(t),e)},Ql=z,Jo=0,JC=Math.random(),iT=Ql(1 .toString),yp=function(t){return"Symbol("+(t===void 0?"":t)+")_"+iT(++Jo+JC,36)},QC=js,Cd=qn,Rp=yp,Qo=Yl,ms=JS,Yc=J.Symbol,P_=QC("wks"),bp=ms?Yc.for||Yc:Yc&&Yc.withoutSetter||Rp,xn=function(t){return Cd(P_,t)||(P_[t]=Qo&&Cd(Yc,t)?Yc[t]:bp("Symbol."+t)),P_[t]},Cp=zt,rT=Ci,es=Ba,L_=yd,sT=function(t,e){var n,i;if(O_(n=t.toString)&&!tT(i=I_(n,t))||O_(n=t.valueOf)&&!tT(i=I_(n,t)))return i;throw new ja("Can't convert object to primitive value")},k_=TypeError,Zl=xn("toPrimitive"),oT=function(t,e){if(!rT(t)||es(t))return t;var n,i=L_(t,Zl);if(i){if(n=Cp(i,t,e),!rT(n)||es(n))return n;throw new k_("Can't convert object to primitive value")}return sT(t)},aT=Ba,Ga=function(t){var e=oT(t,"string");return aT(e)?e:e+""},cT=Ci,Ap=J.document,lT=cT(Ap)&&cT(Ap.createElement),Ad=function(t){return lT?Ap.createElement(t):{}},ZC=Ad,uT=!Zt&&!w(function(){return Object.defineProperty(ZC("div"),"a",{get:function(){return 7}}).a!==7}),wp=Zt,M_=zt,U_=Mt,$l=Qt,tu=ji,dT=Ga,x_=qn,hT=uT,eu=Object.getOwnPropertyDescriptor;ke.f=wp?eu:function(t,e){if(t=tu(t),e=dT(e),hT)try{return eu(t,e)}catch{}if(x_(t,e))return $l(!M_(U_.f,t,e),t[e])};var V_=w,wd=me,Ha=/#|\.prototype\./,qc=function(t,e){var n=pT[Ip(t)];return n===Np||n!==Op&&(wd(e)?V_(e):!!e)},Ip=qc.normalize=function(t){return String(t).replace(Ha,".").toLowerCase()},pT=qc.data={},Op=qc.NATIVE="N",Np=qc.POLYFILL="P",B_=qc,Vr=Ji,Xc=N,Dp=se(se.bind),_s=function(t,e){return Vr(t),e===void 0?t:Xc?Dp(t,e):function(){return t.apply(e,arguments)}},Es={},Pp=Zt&&w(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),j_=Ci,Id=String,Lp=TypeError,hr=function(t){if(j_(t))return t;throw new Lp(Id(t)+" is not an object")},$C=Zt,tA=uT,eA=Pp,nu=hr,fT=Ga,nA=TypeError,F_=Object.defineProperty,iA=Object.getOwnPropertyDescriptor,G_="enumerable",kp="configurable",H_="writable";Es.f=$C?eA?function(t,e,n){if(nu(t),e=fT(e),nu(n),typeof t=="function"&&e==="prototype"&&"value"in n&&H_ in n&&!n[H_]){var i=iA(t,e);i&&i[H_]&&(t[e]=n.value,n={configurable:kp in n?n[kp]:i[kp],enumerable:G_ in n?n[G_]:i[G_],writable:!1})}return F_(t,e,n)}:F_:function(t,e,n){if(nu(t),e=fT(e),nu(n),tA)try{return F_(t,e,n)}catch{}if("get"in n||"set"in n)throw new nA("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var rA=Es,sA=Qt,Jc=Zt?function(t,e,n){return rA.f(t,e,sA(1,n))}:function(t,e,n){return t[e]=n,t},Qc=J,oA=lt,aA=se,cA=me,mT=ke.f,lA=B_,iu=ki,uA=_s,ru=Jc,_T=qn,dA=function(t){var e=function(n,i,r){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,r)}return oA(t,this,arguments)};return e.prototype=t.prototype,e},Ke=function(t,e){var n,i,r,o,c,l,d,p,f,S=t.target,v=t.global,y=t.stat,P=t.proto,I=v?Qc:y?Qc[S]:Qc[S]&&Qc[S].prototype,O=v?iu:iu[S]||ru(iu,S,{})[S],M=O.prototype;for(o in e)i=!(n=lA(v?o:S+(y?".":"#")+o,t.forced))&&I&&_T(I,o),l=O[o],i&&(d=t.dontCallGetSet?(f=mT(I,o))&&f.value:I[o]),c=i&&d?d:e[o],(n||P||typeof l!=typeof c)&&(p=t.bind&&i?uA(c,Qc):t.wrap&&i?dA(c):P&&cA(c)?aA(c):c,(t.sham||c&&c.sham||l&&l.sham)&&ru(p,"sham",!0),ru(O,o,p),P&&(_T(iu,r=S+"Prototype")||ru(iu,r,{}),ru(iu[r],o,c),t.real&&M&&(n||!M[o])&&ru(M,o,c)))},hA=Math.ceil,pA=Math.floor,W_=Math.trunc||function(t){var e=+t;return(e>0?pA:hA)(e)},Od=W_,K_=function(t){var e=+t;return e!=e||e===0?0:Od(e)},ET=K_,gT=Math.max,ST=Math.min,Mp=function(t,e){var n=ET(t);return n<0?gT(n+e,0):ST(n,e)},TT=K_,su=Math.min,vT=function(t){var e=TT(t);return e>0?su(e,9007199254740991):0},fA=vT,Wa=function(t){return fA(t.length)},yT=ji,RT=Mp,Nd=Wa,ou=function(t){return function(e,n,i){var r=yT(e),o=Nd(r);if(o===0)return!t&&-1;var c,l=RT(i,o);if(t&&n!=n){for(;o>l;)if((c=r[l++])!=c)return!0}else for(;o>l;l++)if((t||l in r)&&r[l]===n)return t||l||0;return!t&&-1}},z_={includes:ou(!0),indexOf:ou(!1)},Up=z_.includes;Ke({target:"Array",proto:!0,forced:w(function(){return!Array(1).includes()})},{includes:function(t){return Up(this,t,arguments.length>1?arguments[1]:void 0)}});var bT=J,CT=ki,Br=function(t,e){var n=CT[t+"Prototype"],i=n&&n[e];if(i)return i;var r=bT[t],o=r&&r.prototype;return o&&o[e]},Y_=Br("Array","includes"),AT=Ci,wT=Ht,IT=xn("match"),OT=function(t){var e;return AT(t)&&((e=t[IT])!==void 0?!!e:wT(t)==="RegExp")},mA=OT,_A=TypeError,NT={};NT[xn("toStringTag")]="z";var q_=String(NT)==="[object z]",ns=q_,Dd=me,Pd=Ht,DT=xn("toStringTag"),PT=Object,LT=Pd(function(){return arguments}())==="Arguments",Fs=ns?Pd:function(t){var e,n,i;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(r,o){try{return r[o]}catch{}}(e=PT(t),DT))=="string"?n:LT?Pd(e):(i=Pd(e))==="Object"&&Dd(e.callee)?"Arguments":i},EA=Fs,gA=String,Gi=function(t){if(EA(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return gA(t)},X_=xn("match"),Ld=Ke,J_=function(t){if(mA(t))throw new _A("The method doesn't accept regular expressions");return t},kT=jn,Ka=Gi,au=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[X_]=!1,"/./"[t](e)}catch{}}return!1},Q_=z("".indexOf);Ld({target:"String",proto:!0,forced:!au("includes")},{includes:function(t){return!!~Q_(Ka(kT(this)),Ka(J_(t)),arguments.length>1?arguments[1]:void 0)}});var MT=Br("String","includes"),za=nt,UT=Y_,xT=MT,xp=Array.prototype,Z_=String.prototype,SA=function(t){var e=t.includes;return t===xp||za(xp,t)&&e===xp.includes?UT:typeof t=="string"||t===Z_||za(Z_,t)&&e===Z_.includes?xT:e},Ct=R(SA),VT=Ji,BT=Yn,jT=Ge,Gs=Wa,is=TypeError,Zc="Reduce of empty array with no initial value",$_=function(t){return function(e,n,i,r){var o=BT(e),c=jT(o),l=Gs(o);if(VT(n),l===0&&i<2)throw new is(Zc);var d=t?l-1:0,p=t?-1:1;if(i<2)for(;;){if(d in c){r=c[d],d+=p;break}if(d+=p,t?d<0:l<=d)throw new is(Zc)}for(;t?d>=0:l>d;d+=p)d in c&&(r=n(r,c[d],d,o));return r}},Vp={left:$_(!1)},Bp=w,cu=function(t,e){var n=[][t];return!!n&&Bp(function(){n.call(null,e||function(){return 1},1)})},gs=J,FT=po,jp=Ht,Zo=function(t){return FT.slice(0,t.length)===t},Fp=Zo("Bun/")?"BUN":Zo("Cloudflare-Workers")?"CLOUDFLARE":Zo("Deno/")?"DENO":Zo("Node.js/")?"NODE":gs.Bun&&typeof Bun.version=="string"?"BUN":gs.Deno&&typeof Deno.version=="object"?"DENO":jp(gs.process)==="process"?"NODE":gs.window&&gs.document?"BROWSER":"REST",Cr=Fp==="NODE",lu=Vp.left;Ke({target:"Array",proto:!0,forced:!Cr&&Fi>79&&Fi<83||!cu("reduce")},{reduce:function(t){var e=arguments.length;return lu(this,t,e,e>1?arguments[1]:void 0)}});var uu=Br("Array","reduce"),Gp=nt,Hp=uu,jr=Array.prototype,Ss=function(t){var e=t.reduce;return t===jr||Gp(jr,t)&&e===jr.reduce?Hp:e},Ya=Ss,Hi=R(Ya),$o=Ht,Hs=Array.isArray||function(t){return $o(t)==="Array"},GT=Ke,tE=Hs,eE=z([].reverse),pr=[1,2];GT({target:"Array",proto:!0,forced:String(pr)===String(pr.reverse())},{reverse:function(){return tE(this)&&(this.length=this.length),eE(this)}});var sr=Br("Array","reverse"),Cn=nt,Ws=sr,Ts=Array.prototype,nE=function(t){var e=t.reverse;return t===Ts||Cn(Ts,t)&&e===Ts.reverse?Ws:e},qa=nE,iE=R(qa),HT=yp,du=js("keys"),Xa=function(t){return du[t]||(du[t]=HT(t))},kd=!w(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Md=qn,WT=me,rE=Yn,KT=kd,Ud=Xa("IE_PROTO"),Wp=Object,xd=Wp.prototype,Kp=KT?Wp.getPrototypeOf:function(t){var e=rE(t);if(Md(e,Ud))return e[Ud];var n=e.constructor;return WT(n)&&e instanceof n?n.prototype:e instanceof Wp?xd:null},hu=z,Vd=Ji,zp=Ci,Bd=function(t){return zp(t)||t===null},Yp=String,zT=TypeError,YT=function(t,e,n){try{return hu(Vd(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},$c=Ci,qT=jn,pu=function(t){if(Bd(t))return t;throw new zT("Can't set "+Yp(t)+" as a prototype")},qp=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=YT(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(i,r){return qT(i),pu(r),$c(i)&&(e?t(i,r):i.__proto__=r),i}}():void 0),jd={},fu={},Fd=qn,vs=ji,fo=z_.indexOf,Ja=fu,sE=z([].push),ta=function(t,e){var n,i=vs(t),r=0,o=[];for(n in i)!Fd(Ja,n)&&Fd(i,n)&&sE(o,n);for(;e.length>r;)Fd(i,n=e[r++])&&(~fo(o,n)||sE(o,n));return o},Ks=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Wi=ta,Xp=Ks.concat("length","prototype");jd.f=Object.getOwnPropertyNames||function(t){return Wi(t,Xp)};var Gd={};Gd.f=Object.getOwnPropertySymbols;var TA=ti,vA=jd,Ki=Gd,oE=hr,Hd=z([].concat),Wd=TA("Reflect","ownKeys")||function(t){var e=vA.f(oE(t)),n=Ki.f;return n?Hd(e,n(t)):e},Jp=qn,mu=Wd,_u=ke,yA=Es,Qp={},RA=ta,XT=Ks,mo=Object.keys||function(t){return RA(t,XT)},aE=Zt,Zp=Pp,JT=Es,Qa=hr,rn=ji,Fn=mo;Qp.f=aE&&!Zp?Object.defineProperties:function(t,e){Qa(t);for(var n,i=rn(e),r=Fn(e),o=r.length,c=0;o>c;)JT.f(t,n=r[c++],i[n]);return t};var pi,Kd=ti("document","documentElement"),Eu=hr,tl=Qp,zd=Ks,Yd=fu,gu=Kd,bA=Ad,fi="prototype",qd="script",$p=Xa("IE_PROTO"),tf=function(){},cE=function(t){return"<"+qd+">"+t+"</"+qd+">"},QT=function(t){t.write(cE("")),t.close();var e=t.parentWindow.Object;return t=null,e},Su=function(){try{pi=new ActiveXObject("htmlfile")}catch{}var t,e,n;Su=typeof document<"u"?document.domain&&pi?QT(pi):(e=bA("iframe"),n="java"+qd+":",e.style.display="none",gu.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(cE("document.F=Object")),t.close(),t.F):QT(pi);for(var i=zd.length;i--;)delete Su[fi][zd[i]];return Su()};Yd[$p]=!0;var el=Object.create||function(t,e){var n;return t!==null?(tf[fi]=Eu(t),n=new tf,tf[fi]=null,n[$p]=t):n=Su(),e===void 0?n:tl.f(n,e)},lE=Ci,Fr=Jc,Ai=Error,ef=z("".replace),Xd=String(new Ai("zxcasd").stack),Jd=/\n\s*at [^:]*:[^\n]*/,uE=Jd.test(Xd),ea=Qt,nf=!w(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",ea(1,7)),t.stack!==7)}),dE=Jc,hE=function(t,e){if(uE&&typeof t=="string"&&!Ai.prepareStackTrace)for(;e--;)t=ef(t,Jd,"");return t},ZT=nf,pE=Error.captureStackTrace,Za={},$T=Za,tv=xn("iterator"),ev=Array.prototype,rf=function(t){return t!==void 0&&($T.Array===t||ev[tv]===t)},nv=Fs,iv=yd,rv=Te,sv=Za,ov=xn("iterator"),Tu=function(t){if(!rv(t))return iv(t,ov)||iv(t,"@@iterator")||sv[nv(t)]},av=zt,cv=Ji,lv=hr,uv=ql,dv=Tu,CA=TypeError,sf=function(t,e){var n=arguments.length<2?dv(t):e;if(cv(n))return lv(av(n,t));throw new CA(uv(t)+" is not iterable")},vu=zt,fE=hr,of=yd,Qd=function(t,e,n){var i,r;fE(t);try{if(!(i=of(t,"return"))){if(e==="throw")throw n;return n}i=vu(i,t)}catch(o){r=!0,i=o}if(e==="throw")throw n;if(r)throw i;return fE(i),n},hv=_s,mE=zt,pv=hr,fv=ql,mv=rf,_v=Wa,af=nt,Ev=sf,gv=Tu,cf=Qd,Sv=TypeError,Zd=function(t,e){this.stopped=t,this.result=e},Tv=Zd.prototype,nl=function(t,e,n){var i,r,o,c,l,d,p,f=n&&n.that,S=!(!n||!n.AS_ENTRIES),v=!(!n||!n.IS_RECORD),y=!(!n||!n.IS_ITERATOR),P=!(!n||!n.INTERRUPTED),I=hv(e,f),O=function(U){return i&&cf(i,"normal",U),new Zd(!0,U)},M=function(U){return S?(pv(U),P?I(U[0],U[1],O):I(U[0],U[1])):P?I(U,O):I(U)};if(v)i=t.iterator;else if(y)i=t;else{if(!(r=gv(t)))throw new Sv(fv(t)+" is not iterable");if(mv(r)){for(o=0,c=_v(t);c>o;o++)if((l=M(t[o]))&&af(Tv,l))return l;return new Zd(!1)}i=Ev(t,r)}for(d=v?t.next:i.next;!(p=mE(d,i)).done;){try{l=M(p.value)}catch(U){cf(i,"throw",U)}if(typeof l=="object"&&l&&af(Tv,l))return l}return new Zd(!1)},vv=Gi,yv=Ke,_E=nt,Rv=Kp,$d=qp,AA=function(t,e,n){for(var i=mu(e),r=yA.f,o=_u.f,c=0;c<i.length;c++){var l=i[c];Jp(t,l)||n&&Jp(n,l)||r(t,l,o(e,l))}},bv=el,lf=Jc,il=Qt,EE=function(t,e){lE(e)&&"cause"in e&&Fr(t,"cause",e.cause)},uf=function(t,e,n,i){ZT&&(pE?pE(t,e):dE(t,"stack",hE(n,i)))},Cv=nl,Av=function(t,e){return t===void 0?arguments.length<2?"":e:vv(t)},_o=xn("toStringTag"),Eo=Error,$a=[].push,ys=function(t,e){var n,i=_E(th,this);$d?n=$d(new Eo,i?Rv(this):th):(n=i?this:bv(th),lf(n,_o,"Error")),e!==void 0&&lf(n,"message",Av(e)),uf(n,ys,n.stack,1),arguments.length>2&&EE(n,arguments[2]);var r=[];return Cv(t,$a,{that:r}),lf(n,"errors",r),n};$d?$d(ys,Eo):AA(ys,Eo,{name:!0});var th=ys.prototype=bv(Eo.prototype,{constructor:il(1,ys),message:il(1,""),name:il(1,"AggregateError")});yv({global:!0},{AggregateError:ys});var yu,Ru,eh,rl=me,nh=J.WeakMap,wv=rl(nh)&&/native code/.test(String(nh)),gE=J,Iv=Ci,df=Jc,hf=qn,ih=Rd,Ov=Xa,Nv=fu,Dv="Object already initialized",pf=gE.TypeError,Qi=gE.WeakMap;if(wv||ih.state){var ei=ih.state||(ih.state=new Qi);ei.get=ei.get,ei.has=ei.has,ei.set=ei.set,yu=function(t,e){if(ei.has(t))throw new pf(Dv);return e.facade=t,ei.set(t,e),e},Ru=function(t){return ei.get(t)||{}},eh=function(t){return ei.has(t)}}else{var sl=Ov("state");Nv[sl]=!0,yu=function(t,e){if(hf(t,sl))throw new pf(Dv);return e.facade=t,df(t,sl,e),e},Ru=function(t){return hf(t,sl)?t[sl]:{}},eh=function(t){return hf(t,sl)}}var tc,SE,TE,ec={set:yu,get:Ru,has:eh,enforce:function(t){return eh(t)?Ru(t):yu(t,{})},getterFor:function(t){return function(e){var n;if(!Iv(e)||(n=Ru(e)).type!==t)throw new pf("Incompatible receiver, "+t+" required");return n}}},ol=Zt,vE=qn,yE=Function.prototype,Pv=ol&&Object.getOwnPropertyDescriptor,RE=vE(yE,"name"),ff={PROPER:RE&&(function(){}).name==="something",CONFIGURABLE:RE&&(!ol||ol&&Pv(yE,"name").configurable)},bE=Jc,go=function(t,e,n,i){return i&&i.enumerable?t[e]=n:bE(t,e,n),t},Lv=w,CE=me,AE=Ci,wE=el,IE=Kp,OE=go,mf=xn("iterator"),So=!1;[].keys&&("next"in(TE=[].keys())?(SE=IE(IE(TE)))!==Object.prototype&&(tc=SE):So=!0);var NE=!AE(tc)||Lv(function(){var t={};return tc[mf].call(t)!==t});CE((tc=NE?{}:wE(tc))[mf])||OE(tc,mf,function(){return this});var kv={IteratorPrototype:tc,BUGGY_SAFARI_ITERATORS:So},Mv=Fs,DE=q_?{}.toString:function(){return"[object "+Mv(this)+"]"},al=q_,na=Es.f,nc=Jc,ia=qn,PE=DE,_f=xn("toStringTag"),rs=function(t,e,n,i){var r=n?t:t&&t.prototype;r&&(ia(r,_f)||na(r,_f,{configurable:!0,value:e}),i&&!al&&nc(r,"toString",PE))},Ef=kv.IteratorPrototype,cl=el,fr=Qt,gf=rs,Uv=Za,ic=function(){return this},rh=function(t,e,n,i){var r=e+" Iterator";return t.prototype=cl(Ef,{next:fr(+!i,n)}),gf(t,r,!1,!0),Uv[r]=ic,t},LE=Ke,rc=zt,sc=ff,sh=rh,kE=Kp,ME=rs,bu=go,Cu=Za,xv=kv,Vv=sc.PROPER,oc=xv.BUGGY_SAFARI_ITERATORS,To=xn("iterator"),UE="keys",oh="values",ac="entries",ss=function(){return this},xE=function(t,e,n,i,r,o,c){sh(n,e,i);var l,d,p,f=function(M){if(M===r&&I)return I;if(!oc&&M&&M in y)return y[M];switch(M){case UE:case oh:case ac:return function(){return new n(this,M)}}return function(){return new n(this)}},S=e+" Iterator",v=!1,y=t.prototype,P=y[To]||y["@@iterator"]||r&&y[r],I=!oc&&P||f(r),O=e==="Array"&&y.entries||P;if(O&&(l=kE(O.call(new t)))!==Object.prototype&&l.next&&(ME(l,S,!0,!0),Cu[S]=ss),Vv&&r===oh&&P&&P.name!==oh&&(v=!0,I=function(){return rc(P,this)}),r)if(d={values:f(oh),keys:o?I:f(UE),entries:f(ac)},c)for(p in d)(oc||v||!(p in y))&&bu(y,p,d[p]);else LE({target:e,proto:!0,forced:oc||v},d);return c&&y[To]!==I&&bu(y,To,I,{}),Cu[e]=I,d},ah=function(t,e){return{value:t,done:e}},Bv=ji,Sf=Za,Tf=ec;Es.f;var vf=xE,Rs=ah,mi="Array Iterator",VE=Tf.set,jv=Tf.getterFor(mi);vf(Array,"Array",function(t,e){VE(this,{type:mi,target:Bv(t),index:0,kind:e})},function(){var t=jv(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,Rs(void 0,!0);switch(t.kind){case"keys":return Rs(n,!1);case"values":return Rs(e[n],!1)}return Rs([n,e[n]],!1)},"values"),Sf.Arguments=Sf.Array;var Zi=Es,ch=function(t,e,n){return Zi.f(t,e,n)},wA=ti,Fv=ch,Gv=Zt,wi=xn("species"),os=nt,ra=TypeError,yf=function(t,e){if(os(e,t))return t;throw new ra("Incorrect invocation")},Hv=me,BE=Rd,jE=z(Function.toString);Hv(BE.inspectSource)||(BE.inspectSource=function(t){return jE(t)});var as=BE.inspectSource,zs=z,Wv=w,cs=me,Kv=Fs,sa=as,ll=function(){},oa=ti("Reflect","construct"),lh=/^\s*(?:class|function)\b/,FE=zs(lh.exec),cc=!lh.test(ll),Au=function(t){if(!cs(t))return!1;try{return oa(ll,[],t),!0}catch{return!1}},ul=function(t){if(!cs(t))return!1;switch(Kv(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return cc||!!FE(lh,sa(t))}catch{return!0}};ul.sham=!0;var aa,vo,dl,Rf,uh=!oa||Wv(function(){var t;return Au(Au.call)||!Au(Object)||!Au(function(){t=!0})||t})?ul:Au,dh=uh,zv=ql,bf=TypeError,GE=hr,IA=function(t){if(dh(t))return t;throw new bf(zv(t)+" is not a constructor")},bs=Te,HE=xn("species"),yo=function(t,e){var n,i=GE(t).constructor;return i===void 0||bs(n=GE(i)[HE])?e:IA(n)},ca=z([].slice),Cf=TypeError,ls=function(t,e){if(t<e)throw new Cf("Not enough arguments");return t},WE=/(?:ipad|iphone|ipod).*applewebkit/i.test(po),Ar=J,KE=lt,la=_s,zE=me,Af=qn,wu=w,ui=Kd,OA=ca,Yv=Ad,qv=ls,NA=WE,DA=Cr,ai=Ar.setImmediate,Gn=Ar.clearImmediate,hn=Ar.process,mn=Ar.Dispatch,ni=Ar.Function,Gr=Ar.MessageChannel,ua=Ar.String,lc=0,hl={},Ro="onreadystatechange";wu(function(){aa=Ar.location});var di=function(t){if(Af(hl,t)){var e=hl[t];delete hl[t],e()}},bo=function(t){return function(){di(t)}},uc=function(t){di(t.data)},wf=function(t){Ar.postMessage(ua(t),aa.protocol+"//"+aa.host)};ai&&Gn||(ai=function(t){qv(arguments.length,1);var e=zE(t)?t:ni(t),n=OA(arguments,1);return hl[++lc]=function(){KE(e,void 0,n)},vo(lc),lc},Gn=function(t){delete hl[t]},DA?vo=function(t){hn.nextTick(bo(t))}:mn&&mn.now?vo=function(t){mn.now(bo(t))}:Gr&&!NA?(Rf=(dl=new Gr).port2,dl.port1.onmessage=uc,vo=la(Rf.postMessage,Rf)):Ar.addEventListener&&zE(Ar.postMessage)&&!Ar.importScripts&&aa&&aa.protocol!=="file:"&&!wu(wf)?(vo=wf,Ar.addEventListener("message",uc,!1)):vo=Ro in Yv("script")?function(t){ui.appendChild(Yv("script"))[Ro]=function(){ui.removeChild(this),di(t)}}:function(t){setTimeout(bo(t),0)});var wr={set:ai,clear:Gn},pl=J,hh=Zt,Co=Object.getOwnPropertyDescriptor,If=function(t){if(!hh)return pl[t];var e=Co(pl,t);return e&&e.value},Of=function(){this.head=null,this.tail=null};Of.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var da,Iu,Ao,Ou,dc,Nu=Of,YE=/ipad|iphone|ipod/i.test(po)&&typeof Pebble<"u",qE=/web0s(?!.*chrome)/i.test(po),wo=J,XE=If,Hr=_s,Nf=wr.set,Ir=Nu,Xv=WE,JE=YE,Jv=qE,QE=Cr,Io=wo.MutationObserver||wo.WebKitMutationObserver,ph=wo.document,Df=wo.process,ha=wo.Promise,Pf=XE("queueMicrotask");if(!Pf){var fh=new Ir,mh=function(){var t,e;for(QE&&(t=Df.domain)&&t.exit();e=fh.get();)try{e()}catch(n){throw fh.head&&da(),n}t&&t.enter()};Xv||QE||Jv||!Io||!ph?!JE&&ha&&ha.resolve?((Ou=ha.resolve(void 0)).constructor=ha,dc=Hr(Ou.then,Ou),da=function(){dc(mh)}):QE?da=function(){Df.nextTick(mh)}:(Nf=Hr(Nf,wo),da=function(){Nf(mh)}):(Iu=!0,Ao=ph.createTextNode(""),new Io(mh).observe(Ao,{characterData:!0}),da=function(){Ao.data=Iu=!Iu}),Pf=function(t){fh.head||da(),fh.add(t)}}var Lf=Pf,hc=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},fl=J.Promise,PA=J,_h=fl,Qv=me,Zv=B_,Du=as,kf=xn,ZE=Fp,Mf=Fi,$v=_h&&_h.prototype,ty=kf("species"),ml=Qv(PA.PromiseRejectionEvent),ey=Zv("Promise",function(){var t=Du(_h),e=t!==String(_h);if(!e&&Mf===66||!$v.catch||!$v.finally)return!0;if(!Mf||Mf<51||!/native code/.test(t)){var n=new _h(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[ty]=i,!(n.then(function(){})instanceof i))return!0}return!(e||ZE!=="BROWSER"&&ZE!=="DENO"||ml)}),On={CONSTRUCTOR:ey,REJECTION_EVENT:ml},Cs={},ny=Ji,iy=TypeError,LA=function(t){var e,n;this.promise=new t(function(i,r){if(e!==void 0||n!==void 0)throw new iy("Bad Promise constructor");e=i,n=r}),this.resolve=ny(e),this.reject=ny(n)};Cs.f=function(t){return new LA(t)};var $E,ry,Uf=Ke,pa=Cr,Oo=J,pc=zt,tg=go,_l=rs,No=function(t){var e=wA(t);Gv&&e&&!e[wi]&&Fv(e,wi,{configurable:!0,get:function(){return this}})},Eh=Ji,eg=me,sy=Ci,oy=yf,ay=yo,cy=wr.set,gh=Lf,ly=function(t,e){try{arguments.length===1?console.error(t):console.error(t,e)}catch{}},uy=hc,kA=Nu,xf=ec,Sh=fl,dy=On,hy=Cs,fc="Promise",py=dy.CONSTRUCTOR,fy=dy.REJECTION_EVENT,pn=xf.getterFor(fc),ng=xf.set,Vf=Sh&&Sh.prototype,El=Sh,Bf=Vf,jf=Oo.TypeError,gl=Oo.document,Pu=Oo.process,mc=hy.f,my=mc,MA=!!(gl&&gl.createEvent&&Oo.dispatchEvent),_y="unhandledrejection",ig=function(t){var e;return!(!sy(t)||!eg(e=t.then))&&e},rg=function(t,e){var n,i,r,o=e.value,c=e.state===1,l=c?t.ok:t.fail,d=t.resolve,p=t.reject,f=t.domain;try{l?(c||(e.rejection===2&&UA(e),e.rejection=1),l===!0?n=o:(f&&f.enter(),n=l(o),f&&(f.exit(),r=!0)),n===t.promise?p(new jf("Promise-chain cycle")):(i=ig(n))?pc(i,n,d,p):d(n)):p(o)}catch(S){f&&!r&&f.exit(),p(S)}},Th=function(t,e){t.notified||(t.notified=!0,gh(function(){for(var n,i=t.reactions;n=i.get();)rg(n,t);t.notified=!1,e&&!t.rejection&&sg(t)}))},Vn=function(t,e,n){var i,r;MA?((i=gl.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),Oo.dispatchEvent(i)):i={promise:e,reason:n},!fy&&(r=Oo["on"+t])?r(i):t===_y&&ly("Unhandled promise rejection",n)},sg=function(t){pc(cy,Oo,function(){var e,n=t.facade,i=t.value;if($i(t)&&(e=uy(function(){pa?Pu.emit("unhandledRejection",i,n):Vn(_y,n,i)}),t.rejection=pa||$i(t)?2:1,e.error))throw e.value})},$i=function(t){return t.rejection!==1&&!t.parent},UA=function(t){pc(cy,Oo,function(){var e=t.facade;pa?Pu.emit("rejectionHandled",e):Vn("rejectionhandled",e,t.value)})},_c=function(t,e,n){return function(i){t(e,i,n)}},Ec=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Th(t,!0))},Lu=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw new jf("Promise can't be resolved itself");var i=ig(e);i?gh(function(){var r={done:!1};try{pc(i,e,_c(Lu,r,t),_c(Ec,r,t))}catch(o){Ec(r,o,t)}}):(t.value=e,t.state=1,Th(t,!1))}catch(r){Ec({done:!1},r,t)}}};py&&(Bf=(El=function(t){oy(this,Bf),Eh(t),pc($E,this);var e=pn(this);try{t(_c(Lu,e),_c(Ec,e))}catch(n){Ec(e,n)}}).prototype,($E=function(t){ng(this,{type:fc,done:!1,notified:!1,parent:!1,reactions:new kA,rejection:!1,state:0,value:null})}).prototype=tg(Bf,"then",function(t,e){var n=pn(this),i=mc(ay(this,El));return n.parent=!0,i.ok=!eg(t)||t,i.fail=eg(e)&&e,i.domain=pa?Pu.domain:void 0,n.state===0?n.reactions.add(i):gh(function(){rg(i,n)}),i.promise}),ry=function(){var t=new $E,e=pn(t);this.promise=t,this.resolve=_c(Lu,e),this.reject=_c(Ec,e)},hy.f=mc=function(t){return t===El||t===void 0?new ry(t):my(t)}),Uf({global:!0,wrap:!0,forced:py},{Promise:El}),_l(El,fc,!1,!0),No(fc);var og=xn("iterator"),ag=!1;try{var cg=0,Ff={next:function(){return{done:!!cg++}},return:function(){ag=!0}};Ff[og]=function(){return this},Array.from(Ff,function(){throw 2})}catch{}var xA=fl,Ey=function(t,e){try{if(!e&&!ag)return!1}catch{return!1}var n=!1;try{var i={};i[og]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},Gf=On.CONSTRUCTOR||!Ey(function(t){xA.all(t).then(void 0,function(){})}),gy=zt,VA=Ji,BA=Cs,lg=hc,ug=nl;Ke({target:"Promise",stat:!0,forced:Gf},{all:function(t){var e=this,n=BA.f(e),i=n.resolve,r=n.reject,o=lg(function(){var c=VA(e.resolve),l=[],d=0,p=1;ug(t,function(f){var S=d++,v=!1;p++,gy(c,e,f).then(function(y){v||(v=!0,l[S]=y,--p||i(l))},r)}),--p||i(l)});return o.error&&r(o.value),n.promise}});var jA=Ke,FA=On.CONSTRUCTOR;fl&&fl.prototype,jA({target:"Promise",proto:!0,forced:FA,real:!0},{catch:function(t){return this.then(void 0,t)}});var Ys=zt,Sy=Ji,Ty=Cs,As=hc,vy=nl;Ke({target:"Promise",stat:!0,forced:Gf},{race:function(t){var e=this,n=Ty.f(e),i=n.reject,r=As(function(){var o=Sy(e.resolve);vy(t,function(c){Ys(o,e,c).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var Hf=Cs;Ke({target:"Promise",stat:!0,forced:On.CONSTRUCTOR},{reject:function(t){var e=Hf.f(this);return(0,e.reject)(t),e.promise}});var fa=hr,GA=Ci,HA=Cs,Sl=function(t,e){if(fa(t),GA(e)&&e.constructor===t)return e;var n=HA.f(t);return(0,n.resolve)(e),n.promise},yy=Ke,WA=fl,KA=On.CONSTRUCTOR,zA=Sl,YA=ti("Promise"),qA=!KA;yy({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return zA(qA&&this===YA?WA:this,t)}});var XA=zt,JA=Ji,Ry=Cs,ku=hc,vh=nl;Ke({target:"Promise",stat:!0,forced:Gf},{allSettled:function(t){var e=this,n=Ry.f(e),i=n.resolve,r=n.reject,o=ku(function(){var c=JA(e.resolve),l=[],d=0,p=1;vh(t,function(f){var S=d++,v=!1;p++,XA(c,e,f).then(function(y){v||(v=!0,l[S]={status:"fulfilled",value:y},--p||i(l))},function(y){v||(v=!0,l[S]={status:"rejected",reason:y},--p||i(l))})}),--p||i(l)});return o.error&&r(o.value),n.promise}});var by=zt,QA=Ji,Mu=ti,yh=Cs,Cy=hc,Wf=nl,Kf="No one promise resolved";Ke({target:"Promise",stat:!0,forced:Gf},{any:function(t){var e=this,n=Mu("AggregateError"),i=yh.f(e),r=i.resolve,o=i.reject,c=Cy(function(){var l=QA(e.resolve),d=[],p=0,f=1,S=!1;Wf(t,function(v){var y=p++,P=!1;f++,by(l,e,v).then(function(I){P||S||(S=!0,r(I))},function(I){P||S||(P=!0,d[y]=I,--f||o(new n(d,Kf)))})}),--f||o(new n(d,Kf))});return c.error&&o(c.value),i.promise}});var dg=Ke,zf=lt,Ay=ca,wy=Cs,ZA=Ji,hg=hc,Tl=J.Promise,Iy=!1;dg({target:"Promise",stat:!0,forced:!Tl||!Tl.try||hg(function(){Tl.try(function(t){Iy=t===8},8)}).error||!Iy},{try:function(t){var e=arguments.length>1?Ay(arguments,1):[],n=wy.f(this),i=hg(function(){return zf(ZA(t),void 0,e)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var $A=Cs;Ke({target:"Promise",stat:!0},{withResolvers:function(){var t=$A.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var tw=Ke,Uu=fl,Yf=w,pg=ti,ew=me,Rh=yo,Oy=Sl,Ny=Uu&&Uu.prototype;tw({target:"Promise",proto:!0,real:!0,forced:!!Uu&&Yf(function(){Ny.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=Rh(this,pg("Promise")),n=ew(t);return this.then(n?function(i){return Oy(e,t()).then(function(){return i})}:t,n?function(i){return Oy(e,t()).then(function(){throw i})}:t)}});var qf=z,Dy=K_,Py=Gi,fg=jn,Ly=qf("".charAt),bh=qf("".charCodeAt),nw=qf("".slice),ky=function(t){return function(e,n){var i,r,o=Py(fg(e)),c=Dy(n),l=o.length;return c<0||c>=l?t?"":void 0:(i=bh(o,c))<55296||i>56319||c+1===l||(r=bh(o,c+1))<56320||r>57343?t?Ly(o,c):i:t?nw(o,c,c+2):r-56320+(i-55296<<10)+65536}},Ch={codeAt:ky(!1),charAt:ky(!0)},mg=Ch.charAt,Xf=Gi,Jf=ec,My=xE,Qf=ah,ma="String Iterator",gc=Jf.set,Sc=Jf.getterFor(ma);My(String,"String",function(t){gc(this,{type:ma,string:Xf(t),index:0})},function(){var t,e=Sc(this),n=e.string,i=e.index;return i>=n.length?Qf(void 0,!0):(t=mg(n,i),e.index+=t.length,Qf(t,!1))});var Ah=ki.Promise,wh={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Tc=J,iw=rs,_g=Za;for(var vl in wh)iw(Tc[vl],vl),_g[vl]=_g.Array;var Uy=Ah,At=R(Uy),Zf=Br("Array","values"),xy=Fs,rw=qn,$f=nt,tm=Zf,em=Array.prototype,Ih={DOMTokenList:!0,NodeList:!0},Eg=function(t){var e=t.values;return t===em||$f(em,t)&&e===em.values||rw(Ih,xy(t))?tm:e},or=R(Eg),Vy=Ke,sw=z,nm=Mp,s=RangeError,a=String.fromCharCode,u=String.fromCodePoint,m=sw([].join);Vy({target:"String",stat:!0,forced:!!u&&u.length!==1},{fromCodePoint:function(t){for(var e,n=[],i=arguments.length,r=0;i>r;){if(e=+arguments[r++],nm(e,1114111)!==e)throw new s(e+" is not a valid code point");n[r]=e<65536?a(e):a(55296+((e-=65536)>>10),e%1024+56320)}return m(n,"")}});var T=w,C=xr,x=xn("iterator"),K=!T(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return t.pathname="c%20d",e.forEach(function(r,o){e.delete("b"),i+=o+r}),n.delete("a",2),n.delete("b",void 0),!t.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!e.size&&C||!e.sort||t.href!=="https://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[x]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),$=go,ut=ca,Pt=Math.floor,Kt=function(t,e){var n=t.length;if(n<8)for(var i,r,o=1;o<n;){for(r=o,i=t[o];r&&e(t[r-1],i)>0;)t[r]=t[--r];r!==o++&&(t[r]=i)}else for(var c=Pt(n/2),l=Kt(ut(t,0,c),e),d=Kt(ut(t,c),e),p=l.length,f=d.length,S=0,v=0;S<p||v<f;)t[S+v]=S<p&&v<f?e(l[S],d[v])<=0?l[S++]:d[v++]:S<p?l[S++]:d[v++];return t},vt=Kt,Nt=Ke,Ee=J,Be=If,vi=ti,mt=zt,ct=z,gt=Zt,jt=K,he=go,an=ch,ve=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:$(t,i,e[i],n);return t},Ne=rs,tr=rh,Sn=ec,_a=yf,gg=me,b4=qn,C4=_s,A4=Fs,w4=hr,iD=Ci,us=Gi,I4=el,rD=Qt,sD=sf,O4=Tu,By=ah,im=ls,N4=vt,D4=xn("iterator"),rm="URLSearchParams",oD=rm+"Iterator",aD=Sn.set,Do=Sn.getterFor(rm),P4=Sn.getterFor(oD),cD=Be("fetch"),jy=Be("Request"),Sg=Be("Headers"),ow=jy&&jy.prototype,lD=Sg&&Sg.prototype,L4=Ee.TypeError,k4=Ee.encodeURIComponent,M4=String.fromCharCode,U4=vi("String","fromCodePoint"),x4=parseInt,Fy=ct("".charAt),uD=ct([].join),xu=ct([].push),dD=ct("".replace),V4=ct([].shift),hD=ct([].splice),pD=ct("".split),fD=ct("".slice),B4=ct(/./.exec),j4=/\+/g,F4=/^[0-9a-f]+$/i,mD=function(t,e){var n=fD(t,e,e+2);return B4(F4,n)?x4(n,16):NaN},G4=function(t){for(var e=0,n=128;n>0&&t&n;n>>=1)e++;return e},H4=function(t){var e=null;switch(t.length){case 1:e=t[0];break;case 2:e=(31&t[0])<<6|63&t[1];break;case 3:e=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:e=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return e>1114111?null:e},_D=function(t){for(var e=(t=dD(t,j4," ")).length,n="",i=0;i<e;){var r=Fy(t,i);if(r==="%"){if(Fy(t,i+1)==="%"||i+3>e){n+="%",i++;continue}var o=mD(t,i+1);if(o!=o){n+=r,i++;continue}i+=2;var c=G4(o);if(c===0)r=M4(o);else{if(c===1||c>4){n+="�",i++;continue}for(var l=[o],d=1;d<c&&!(++i+3>e||Fy(t,i)!=="%");){var p=mD(t,i+1);if(p!=p){i+=3;break}if(p>191||p<128)break;xu(l,p),i+=2,d++}if(l.length!==c){n+="�";continue}var f=H4(l);f===null?n+="�":r=U4(f)}}n+=r,i++}return n},W4=/[!'()~]|%20/g,K4={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},z4=function(t){return K4[t]},ED=function(t){return dD(k4(t),W4,z4)},aw=tr(function(t,e){aD(this,{type:oD,target:Do(t).entries,index:0,kind:e})},rm,function(){var t=P4(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,By(void 0,!0);var i=e[n];switch(t.kind){case"keys":return By(i.key,!1);case"values":return By(i.value,!1)}return By([i.key,i.value],!1)},!0),gD=function(t){this.entries=[],this.url=null,t!==void 0&&(iD(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?Fy(t,0)==="?"?fD(t,1):t:us(t)))};gD.prototype={type:rm,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,r,o,c,l,d=this.entries,p=O4(t);if(p)for(n=(e=sD(t,p)).next;!(i=mt(n,e)).done;){if(o=(r=sD(w4(i.value))).next,(c=mt(o,r)).done||(l=mt(o,r)).done||!mt(o,r).done)throw new L4("Expected sequence with length 2");xu(d,{key:us(c.value),value:us(l.value)})}else for(var f in t)b4(t,f)&&xu(d,{key:f,value:us(t[f])})},parseQuery:function(t){if(t)for(var e,n,i=this.entries,r=pD(t,"&"),o=0;o<r.length;)(e=r[o++]).length&&(n=pD(e,"="),xu(i,{key:_D(V4(n)),value:_D(uD(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],xu(n,ED(t.key)+"="+ED(t.value));return uD(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Gy=function(){_a(this,sm);var t=aD(this,new gD(arguments.length>0?arguments[0]:void 0));gt||(this.size=t.entries.length)},sm=Gy.prototype;if(ve(sm,{append:function(t,e){var n=Do(this);im(arguments.length,2),xu(n.entries,{key:us(t),value:us(e)}),gt||this.length++,n.updateURL()},delete:function(t){for(var e=Do(this),n=im(arguments.length,1),i=e.entries,r=us(t),o=n<2?void 0:arguments[1],c=o===void 0?o:us(o),l=0;l<i.length;){var d=i[l];if(d.key!==r||c!==void 0&&d.value!==c)l++;else if(hD(i,l,1),c!==void 0)break}gt||(this.size=i.length),e.updateURL()},get:function(t){var e=Do(this).entries;im(arguments.length,1);for(var n=us(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=Do(this).entries;im(arguments.length,1);for(var n=us(t),i=[],r=0;r<e.length;r++)e[r].key===n&&xu(i,e[r].value);return i},has:function(t){for(var e=Do(this).entries,n=im(arguments.length,1),i=us(t),r=n<2?void 0:arguments[1],o=r===void 0?r:us(r),c=0;c<e.length;){var l=e[c++];if(l.key===i&&(o===void 0||l.value===o))return!0}return!1},set:function(t,e){var n=Do(this);im(arguments.length,1);for(var i,r=n.entries,o=!1,c=us(t),l=us(e),d=0;d<r.length;d++)(i=r[d]).key===c&&(o?hD(r,d--,1):(o=!0,i.value=l));o||xu(r,{key:c,value:l}),gt||(this.size=r.length),n.updateURL()},sort:function(){var t=Do(this);N4(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=Do(this).entries,i=C4(t,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new aw(this,"keys")},values:function(){return new aw(this,"values")},entries:function(){return new aw(this,"entries")}},{enumerable:!0}),he(sm,D4,sm.entries,{}),he(sm,"toString",function(){return Do(this).serialize()},{enumerable:!0}),gt&&an(sm,"size",{get:function(){return Do(this).entries.length},configurable:!0,enumerable:!0}),Ne(Gy,rm),Nt({global:!0,forced:!jt},{URLSearchParams:Gy}),!jt&&gg(Sg)){var Y4=ct(lD.has),q4=ct(lD.set),SD=function(t){if(iD(t)){var e,n=t.body;if(A4(n)===rm)return e=t.headers?new Sg(t.headers):new Sg,Y4(e,"content-type")||q4(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),I4(t,{body:rD(0,us(n)),headers:rD(0,e)})}return t};if(gg(cD)&&Nt({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return cD(t,arguments.length>1?SD(arguments[1]):{})}}),gg(jy)){var cw=function(t){return _a(this,ow),new jy(t,arguments.length>1?SD(arguments[1]):{})};ow.constructor=cw,cw.prototype=ow,Nt({global:!0,dontCallGetSet:!0,forced:!0},{Request:cw})}}var Po,X4={URLSearchParams:Gy,getState:Do},J4=ki.URLSearchParams,TD=Zt,Q4=z,Z4=zt,$4=w,lw=mo,t5=Gd,e5=Mt,n5=Yn,i5=Ge,om=Object.assign,vD=Object.defineProperty,r5=Q4([].concat),s5=!om||$4(function(){if(TD&&om({b:1},om(vD({},"a",{enumerable:!0,get:function(){vD(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(r){e[r]=r}),om({},t)[n]!==7||lw(om({},e)).join("")!==i})?function(t,e){for(var n=n5(t),i=arguments.length,r=1,o=t5.f,c=e5.f;i>r;)for(var l,d=i5(arguments[r++]),p=o?r5(lw(d),o(d)):lw(d),f=p.length,S=0;f>S;)l=p[S++],TD&&!Z4(c,d,l)||(n[l]=d[l]);return n}:om,o5=hr,a5=Qd,c5=Zt,l5=Es,u5=Qt,uw=function(t,e,n){c5?l5.f(t,e,u5(0,n)):t[e]=n},d5=_s,h5=zt,p5=Yn,f5=function(t,e,n,i){try{return i?e(o5(n)[0],n[1]):e(n)}catch(r){a5(t,"throw",r)}},m5=rf,_5=uh,E5=Wa,yD=uw,g5=sf,S5=Tu,RD=Array,Oh=z,dw=2147483647,T5=/[^\0-\u007E]/,bD=/[.\u3002\uFF0E\uFF61]/g,CD="Overflow: input needs wider integers to process",AD=RangeError,v5=Oh(bD.exec),am=Math.floor,hw=String.fromCharCode,wD=Oh("".charCodeAt),ID=Oh([].join),Vu=Oh([].push),y5=Oh("".replace),R5=Oh("".split),b5=Oh("".toLowerCase),OD=function(t){return t+22+75*(t<26)},C5=function(t,e,n){var i=0;for(t=n?am(t/700):t>>1,t+=am(t/e);t>455;)t=am(t/35),i+=36;return am(i+36*t/(t+38))},A5=function(t){var e=[];t=function(M){for(var U=[],W=0,Q=M.length;W<Q;){var X=wD(M,W++);if(X>=55296&&X<=56319&&W<Q){var Y=wD(M,W++);(64512&Y)==56320?Vu(U,((1023&X)<<10)+(1023&Y)+65536):(Vu(U,X),W--)}else Vu(U,X)}return U}(t);var n,i,r=t.length,o=128,c=0,l=72;for(n=0;n<t.length;n++)(i=t[n])<128&&Vu(e,hw(i));var d=e.length,p=d;for(d&&Vu(e,"-");p<r;){var f=dw;for(n=0;n<t.length;n++)(i=t[n])>=o&&i<f&&(f=i);var S=p+1;if(f-o>am((dw-c)/S))throw new AD(CD);for(c+=(f-o)*S,o=f,n=0;n<t.length;n++){if((i=t[n])<o&&++c>dw)throw new AD(CD);if(i===o){for(var v=c,y=36;;){var P=y<=l?1:y>=l+26?26:y-l;if(v<P)break;var I=v-P,O=36-P;Vu(e,hw(OD(P+I%O))),v=am(I/O),y+=36}Vu(e,hw(OD(v))),l=C5(c,S,p===d),c=0,p++}}c++,o++}return ID(e,"")},w5=Ke,pw=Zt,I5=K,fw=J,ND=_s,Lo=z,Hy=go,ko=ch,O5=yf,mw=qn,_w=s5,cm=function(t){var e=p5(t),n=_5(this),i=arguments.length,r=i>1?arguments[1]:void 0,o=r!==void 0;o&&(r=d5(r,i>2?arguments[2]:void 0));var c,l,d,p,f,S,v=S5(e),y=0;if(!v||this===RD&&m5(v))for(c=E5(e),l=n?new this(c):RD(c);c>y;y++)S=o?r(e[y],y):e[y],yD(l,y,S);else for(l=n?new this:[],f=(p=g5(e,v)).next;!(d=h5(f,p)).done;y++)S=o?f5(p,r,[d.value,y],!0):d.value,yD(l,y,S);return l.length=y,l},Ea=ca,N5=Ch.codeAt,D5=function(t){var e,n,i=[],r=R5(y5(b5(t),bD,"."),".");for(e=0;e<r.length;e++)n=r[e],Vu(i,v5(T5,n)?"xn--"+A5(n):n);return ID(i,".")},yl=Gi,P5=rs,L5=ls,DD=X4,PD=ec,k5=PD.set,Wy=PD.getterFor("URL"),M5=DD.URLSearchParams,U5=DD.getState,Tg=fw.URL,Ew=fw.TypeError,Ky=fw.parseInt,x5=Math.floor,LD=Math.pow,Mo=Lo("".charAt),ga=Lo(/./.exec),vg=Lo([].join),V5=Lo(1 .toString),B5=Lo([].pop),lm=Lo([].push),gw=Lo("".replace),j5=Lo([].shift),F5=Lo("".split),yg=Lo("".slice),zy=Lo("".toLowerCase),G5=Lo([].unshift),Sw="Invalid scheme",Nh="Invalid host",kD="Invalid port",MD=/[a-z]/i,H5=/[\d+-.a-z]/i,Tw=/\d/,W5=/^0x/i,K5=/^[0-7]+$/,z5=/^\d+$/,UD=/^[\da-f]+$/i,Y5=/[\0\t\n\r #%/:<>?@[\\\]^|]/,q5=/[\0\t\n\r #/:<>?@[\\\]^|]/,X5=/^[\u0000-\u0020]+/,J5=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Q5=/[\t\n\r]/g,Rg=function(t){var e,n,i,r;if(typeof t=="number"){for(e=[],n=0;n<4;n++)G5(e,t%256),t=x5(t/256);return vg(e,".")}if(typeof t=="object"){for(e="",i=function(o){for(var c=null,l=1,d=null,p=0,f=0;f<8;f++)o[f]!==0?(p>l&&(c=d,l=p),d=null,p=0):(d===null&&(d=f),++p);return p>l?d:c}(t),n=0;n<8;n++)r&&t[n]===0||(r&&(r=!1),i===n?(e+=n?":":"::",r=!0):(e+=V5(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},Yy={},xD=_w({},Yy,{" ":1,'"':1,"<":1,">":1,"`":1}),VD=_w({},xD,{"#":1,"?":1,"{":1,"}":1}),vw=_w({},VD,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Bu=function(t,e){var n=N5(t,0);return n>32&&n<127&&!mw(e,t)?t:encodeURIComponent(t)},qy={ftp:21,file:null,http:80,https:443,ws:80,wss:443},bg=function(t,e){var n;return t.length===2&&ga(MD,Mo(t,0))&&((n=Mo(t,1))===":"||!e&&n==="|")},BD=function(t){var e;return t.length>1&&bg(yg(t,0,2))&&(t.length===2||(e=Mo(t,2))==="/"||e==="\\"||e==="?"||e==="#")},Z5=function(t){return t==="."||zy(t)==="%2e"},yw={},jD={},Rw={},FD={},GD={},bw={},HD={},WD={},Xy={},Jy={},Cw={},Aw={},ww={},Iw={},KD={},Ow={},um={},vc={},zD={},Dh={},Rl={},Nw=function(t,e,n){var i,r,o,c=yl(t);if(e){if(r=this.parse(c))throw new Ew(r);this.searchParams=null}else{if(n!==void 0&&(i=new Nw(n,!0)),r=this.parse(c,null,i))throw new Ew(r);(o=U5(new M5)).bindURL(this),this.searchParams=o}};Nw.prototype={type:"URL",parse:function(t,e,n){var i,r,o,c,l,d=this,p=e||yw,f=0,S="",v=!1,y=!1,P=!1;for(t=yl(t),e||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,t=gw(t,X5,""),t=gw(t,J5,"$1")),t=gw(t,Q5,""),i=cm(t);f<=i.length;){switch(r=i[f],p){case yw:if(!r||!ga(MD,r)){if(e)return Sw;p=Rw;continue}S+=zy(r),p=jD;break;case jD:if(r&&(ga(H5,r)||r==="+"||r==="-"||r==="."))S+=zy(r);else{if(r!==":"){if(e)return Sw;S="",p=Rw,f=0;continue}if(e&&(d.isSpecial()!==mw(qy,S)||S==="file"&&(d.includesCredentials()||d.port!==null)||d.scheme==="file"&&!d.host))return;if(d.scheme=S,e)return void(d.isSpecial()&&qy[d.scheme]===d.port&&(d.port=null));S="",d.scheme==="file"?p=Iw:d.isSpecial()&&n&&n.scheme===d.scheme?p=FD:d.isSpecial()?p=WD:i[f+1]==="/"?(p=GD,f++):(d.cannotBeABaseURL=!0,lm(d.path,""),p=zD)}break;case Rw:if(!n||n.cannotBeABaseURL&&r!=="#")return Sw;if(n.cannotBeABaseURL&&r==="#"){d.scheme=n.scheme,d.path=Ea(n.path),d.query=n.query,d.fragment="",d.cannotBeABaseURL=!0,p=Rl;break}p=n.scheme==="file"?Iw:bw;continue;case FD:if(r!=="/"||i[f+1]!=="/"){p=bw;continue}p=Xy,f++;break;case GD:if(r==="/"){p=Jy;break}p=vc;continue;case bw:if(d.scheme=n.scheme,r===Po)d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Ea(n.path),d.query=n.query;else if(r==="/"||r==="\\"&&d.isSpecial())p=HD;else if(r==="?")d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Ea(n.path),d.query="",p=Dh;else{if(r!=="#"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Ea(n.path),d.path.length--,p=vc;continue}d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Ea(n.path),d.query=n.query,d.fragment="",p=Rl}break;case HD:if(!d.isSpecial()||r!=="/"&&r!=="\\"){if(r!=="/"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,p=vc;continue}p=Jy}else p=Xy;break;case WD:if(p=Xy,r!=="/"||Mo(S,f+1)!=="/")continue;f++;break;case Xy:if(r!=="/"&&r!=="\\"){p=Jy;continue}break;case Jy:if(r==="@"){v&&(S="%40"+S),v=!0,o=cm(S);for(var I=0;I<o.length;I++){var O=o[I];if(O!==":"||P){var M=Bu(O,vw);P?d.password+=M:d.username+=M}else P=!0}S=""}else if(r===Po||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()){if(v&&S==="")return"Invalid authority";f-=cm(S).length+1,S="",p=Cw}else S+=r;break;case Cw:case Aw:if(e&&d.scheme==="file"){p=Ow;continue}if(r!==":"||y){if(r===Po||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()){if(d.isSpecial()&&S==="")return Nh;if(e&&S===""&&(d.includesCredentials()||d.port!==null))return;if(c=d.parseHost(S))return c;if(S="",p=um,e)return;continue}r==="["?y=!0:r==="]"&&(y=!1),S+=r}else{if(S==="")return Nh;if(c=d.parseHost(S))return c;if(S="",p=ww,e===Aw)return}break;case ww:if(!ga(Tw,r)){if(r===Po||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()||e){if(S!==""){var U=Ky(S,10);if(U>65535)return kD;d.port=d.isSpecial()&&U===qy[d.scheme]?null:U,S=""}if(e)return;p=um;continue}return kD}S+=r;break;case Iw:if(d.scheme="file",r==="/"||r==="\\")p=KD;else{if(!n||n.scheme!=="file"){p=vc;continue}switch(r){case Po:d.host=n.host,d.path=Ea(n.path),d.query=n.query;break;case"?":d.host=n.host,d.path=Ea(n.path),d.query="",p=Dh;break;case"#":d.host=n.host,d.path=Ea(n.path),d.query=n.query,d.fragment="",p=Rl;break;default:BD(vg(Ea(i,f),""))||(d.host=n.host,d.path=Ea(n.path),d.shortenPath()),p=vc;continue}}break;case KD:if(r==="/"||r==="\\"){p=Ow;break}n&&n.scheme==="file"&&!BD(vg(Ea(i,f),""))&&(bg(n.path[0],!0)?lm(d.path,n.path[0]):d.host=n.host),p=vc;continue;case Ow:if(r===Po||r==="/"||r==="\\"||r==="?"||r==="#"){if(!e&&bg(S))p=vc;else if(S===""){if(d.host="",e)return;p=um}else{if(c=d.parseHost(S))return c;if(d.host==="localhost"&&(d.host=""),e)return;S="",p=um}continue}S+=r;break;case um:if(d.isSpecial()){if(p=vc,r!=="/"&&r!=="\\")continue}else if(e||r!=="?")if(e||r!=="#"){if(r!==Po&&(p=vc,r!=="/"))continue}else d.fragment="",p=Rl;else d.query="",p=Dh;break;case vc:if(r===Po||r==="/"||r==="\\"&&d.isSpecial()||!e&&(r==="?"||r==="#")){if((l=zy(l=S))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(d.shortenPath(),r==="/"||r==="\\"&&d.isSpecial()||lm(d.path,"")):Z5(S)?r==="/"||r==="\\"&&d.isSpecial()||lm(d.path,""):(d.scheme==="file"&&!d.path.length&&bg(S)&&(d.host&&(d.host=""),S=Mo(S,0)+":"),lm(d.path,S)),S="",d.scheme==="file"&&(r===Po||r==="?"||r==="#"))for(;d.path.length>1&&d.path[0]==="";)j5(d.path);r==="?"?(d.query="",p=Dh):r==="#"&&(d.fragment="",p=Rl)}else S+=Bu(r,VD);break;case zD:r==="?"?(d.query="",p=Dh):r==="#"?(d.fragment="",p=Rl):r!==Po&&(d.path[0]+=Bu(r,Yy));break;case Dh:e||r!=="#"?r!==Po&&(r==="'"&&d.isSpecial()?d.query+="%27":d.query+=r==="#"?"%23":Bu(r,Yy)):(d.fragment="",p=Rl);break;case Rl:r!==Po&&(d.fragment+=Bu(r,xD))}f++}},parseHost:function(t){var e,n,i;if(Mo(t,0)==="["){if(Mo(t,t.length-1)!=="]"||(e=function(r){var o,c,l,d,p,f,S,v=[0,0,0,0,0,0,0,0],y=0,P=null,I=0,O=function(){return Mo(r,I)};if(O()===":"){if(Mo(r,1)!==":")return;I+=2,P=++y}for(;O();){if(y===8)return;if(O()!==":"){for(o=c=0;c<4&&ga(UD,O());)o=16*o+Ky(O(),16),I++,c++;if(O()==="."){if(c===0||(I-=c,y>6))return;for(l=0;O();){if(d=null,l>0){if(!(O()==="."&&l<4))return;I++}if(!ga(Tw,O()))return;for(;ga(Tw,O());){if(p=Ky(O(),10),d===null)d=p;else{if(d===0)return;d=10*d+p}if(d>255)return;I++}v[y]=256*v[y]+d,++l!=2&&l!==4||y++}if(l!==4)return;break}if(O()===":"){if(I++,!O())return}else if(O())return;v[y++]=o}else{if(P!==null)return;I++,P=++y}}if(P!==null)for(f=y-P,y=7;y!==0&&f>0;)S=v[y],v[y--]=v[P+f-1],v[P+--f]=S;else if(y!==8)return;return v}(yg(t,1,-1)),!e))return Nh;this.host=e}else if(this.isSpecial()){if(t=D5(t),ga(Y5,t)||(e=function(r){var o,c,l,d,p,f,S,v=F5(r,".");if(v.length&&v[v.length-1]===""&&v.length--,(o=v.length)>4)return r;for(c=[],l=0;l<o;l++){if((d=v[l])==="")return r;if(p=10,d.length>1&&Mo(d,0)==="0"&&(p=ga(W5,d)?16:8,d=yg(d,p===8?1:2)),d==="")f=0;else{if(!ga(p===10?z5:p===8?K5:UD,d))return r;f=Ky(d,p)}lm(c,f)}for(l=0;l<o;l++)if(f=c[l],l===o-1){if(f>=LD(256,5-o))return null}else if(f>255)return null;for(S=B5(c),l=0;l<c.length;l++)S+=c[l]*LD(256,3-l);return S}(t),e===null))return Nh;this.host=e}else{if(ga(q5,t))return Nh;for(e="",n=cm(t),i=0;i<n.length;i++)e+=Bu(n[i],Yy);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return mw(qy,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme==="file"&&e===1&&bg(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,r=t.host,o=t.port,c=t.path,l=t.query,d=t.fragment,p=e+":";return r!==null?(p+="//",t.includesCredentials()&&(p+=n+(i?":"+i:"")+"@"),p+=Rg(r),o!==null&&(p+=":"+o)):e==="file"&&(p+="//"),p+=t.cannotBeABaseURL?c[0]:c.length?"/"+vg(c,"/"):"",l!==null&&(p+="?"+l),d!==null&&(p+="#"+d),p},setHref:function(t){var e=this.parse(t);if(e)throw new Ew(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t==="blob")try{return new dm(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Rg(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(yl(t)+":",yw)},getUsername:function(){return this.username},setUsername:function(t){var e=cm(yl(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=Bu(e[n],vw)}},getPassword:function(){return this.password},setPassword:function(t){var e=cm(yl(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=Bu(e[n],vw)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?Rg(t):Rg(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,Cw)},getHostname:function(){var t=this.host;return t===null?"":Rg(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,Aw)},getPort:function(){var t=this.port;return t===null?"":yl(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=yl(t))===""?this.port=null:this.parse(t,ww))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+vg(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,um))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=yl(t))===""?this.query=null:(Mo(t,0)==="?"&&(t=yg(t,1)),this.query="",this.parse(t,Dh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=yl(t))!==""?(Mo(t,0)==="#"&&(t=yg(t,1)),this.fragment="",this.parse(t,Rl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var dm=function(t){var e=O5(this,ds),n=L5(arguments.length,1)>1?arguments[1]:void 0,i=k5(e,new Nw(t,!1,n));pw||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},ds=dm.prototype,Uo=function(t,e){return{get:function(){return Wy(this)[t]()},set:e&&function(n){return Wy(this)[e](n)},configurable:!0,enumerable:!0}};if(pw&&(ko(ds,"href",Uo("serialize","setHref")),ko(ds,"origin",Uo("getOrigin")),ko(ds,"protocol",Uo("getProtocol","setProtocol")),ko(ds,"username",Uo("getUsername","setUsername")),ko(ds,"password",Uo("getPassword","setPassword")),ko(ds,"host",Uo("getHost","setHost")),ko(ds,"hostname",Uo("getHostname","setHostname")),ko(ds,"port",Uo("getPort","setPort")),ko(ds,"pathname",Uo("getPathname","setPathname")),ko(ds,"search",Uo("getSearch","setSearch")),ko(ds,"searchParams",Uo("getSearchParams")),ko(ds,"hash",Uo("getHash","setHash"))),Hy(ds,"toJSON",function(){return Wy(this).serialize()},{enumerable:!0}),Hy(ds,"toString",function(){return Wy(this).serialize()},{enumerable:!0}),Tg){var YD=Tg.createObjectURL,qD=Tg.revokeObjectURL;YD&&Hy(dm,"createObjectURL",ND(YD,Tg)),qD&&Hy(dm,"revokeObjectURL",ND(qD,Tg))}P5(dm,"URL"),w5({global:!0,forced:!I5,sham:!pw},{URL:dm});var $5=Ke,XD=w,tH=ls,JD=Gi,eH=K,Dw=ti("URL"),nH=eH&&XD(function(){Dw.canParse()}),iH=XD(function(){return Dw.canParse.length!==1});$5({target:"URL",stat:!0,forced:!nH||iH},{canParse:function(t){var e=tH(arguments.length,1),n=JD(t),i=e<2||arguments[1]===void 0?void 0:JD(arguments[1]);try{return!!new Dw(n,i)}catch{return!1}}});var rH=Ke,sH=ls,QD=Gi,oH=K,aH=ti("URL");rH({target:"URL",stat:!0,forced:!oH},{parse:function(t){var e=sH(arguments.length,1),n=QD(t),i=e<2||arguments[1]===void 0?void 0:QD(arguments[1]);try{return new aH(n,i)}catch{return null}}});var Qy=R(ki.URL);let ZD=!0,$D=!0;function Zy(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function Ph(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(c,l){if(c!==e)return r.apply(this,arguments);const d=p=>{const f=n(p);f&&(l.handleEvent?l.handleEvent(f):l(f))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,d),r.apply(this,[c,d])};const o=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const d=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[c,d])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function cH(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(ZD=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function lH(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):($D=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function tP(){if(typeof window=="object"){if(ZD)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Pw(t,e){$D&&console.warn(t+" is deprecated, please use "+e+" instead.")}function eP(t){return Object.prototype.toString.call(t)==="[object Object]"}function nP(t){var e;return eP(t)?Hi(e=Object.keys(t)).call(e,function(n,i){const r=eP(t[i]),o=r?nP(t[i]):t[i],c=r&&!Object.keys(o).length;return o===void 0||c?n:Object.assign(n,{[i]:o})},{}):t}function Lw(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Lw(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{Lw(t,t.get(r),n)})}))}function iP(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&o.push(c)}),o.forEach(c=>{t.forEach(l=>{l.type===i&&l.trackId===c.id&&Lw(t,l,r)})}),r}const rP=tP;function sP(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const p=typeof c[d]=="object"?c[d]:{ideal:c[d]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const f=function(S,v){return S?S+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(p.ideal!==void 0){l.optional=l.optional||[];let S={};typeof p.ideal=="number"?(S[f("min",d)]=p.ideal,l.optional.push(S),S={},S[f("max",d)]=p.ideal,l.optional.push(S)):(S[f("",d)]=p.ideal,l.optional.push(S))}p.exact!==void 0&&typeof p.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",d)]=p.exact):["min","max"].forEach(S=>{p[S]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(S,d)]=p[S])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(e.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const d=function(p,f,S){f in p&&!(S in p)&&(p[S]=p[f],delete p[f])};d((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let d=c.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const p=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||p)){let f;if(delete c.video.facingMode,d.exact==="environment"||d.ideal==="environment"?f=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(S=>{let v=(S=S.filter(y=>y.kind==="videoinput")).find(y=>f.some(P=>{var I;return Ct(I=y.label.toLowerCase()).call(I,P)}));return!v&&S.length&&Ct(f).call(f,"back")&&(v=S[S.length-1]),v&&(c.video.deviceId=d.exact?{exact:v.deviceId}:{ideal:v.deviceId}),c.video=i(c.video),rP("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return rP("chrome: "+JSON.stringify(c)),l(c)},o=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,d){r(c,p=>{n.webkitGetUserMedia(p,l,f=>{d&&d(o(f))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,d=>c(d).then(p=>{if(d.audio&&!p.getAudioTracks().length||d.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return p},p=>At.reject(o(p))))}}}function oP(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function aP(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const o=new Event("track");o.track=i.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[n.stream],this.dispatchEvent(o)}),n.stream.getTracks().forEach(i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const o=new Event("track");o.track=i,o.receiver=r,o.transceiver={receiver:r},o.streams=[n.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Ph(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function cP(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){let d=r.apply(this,arguments);return d||(d=e(this,c),this._senders.push(d)),d};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){o.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const c=this._senders.find(l=>l.track===o);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function lP(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const o=function(l){const d={};return l.result().forEach(p=>{const f={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(S=>{f[S]=p.stat(S)}),d[f.id]=f}),d},c=function(l){return new Map(Object.keys(l).map(d=>[d,l[d]]))};if(arguments.length>=2){const l=function(d){i(c(o(d)))};return e.apply(this,[l,n])}return new At((l,d)=>{e.apply(this,[function(p){l(c(o(p)))},d])}).then(i,r)}}function uP(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>iP(o,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Ph(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>iP(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,r,o;return this.getSenders().forEach(c=>{c.track===n&&(i?o=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(r?o=!0:r=c),c.track===n)),o||i&&r?At.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():At.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function dP(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(d=>c.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(o);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function hP(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return dP(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(p=>this._reverseStreams[p.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(p=>{if(this.getSenders().find(S=>S.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const p=new t.MediaStream(d.getTracks());this._streams[d.id]=p,this._reverseStreams[p.id]=d,d=p}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;function o(d,p){let f=p.sdp;return Object.keys(d._reverseStreams||[]).forEach(S=>{const v=d._reverseStreams[S],y=d._streams[v.id];f=f.replace(new RegExp(y.id,"g"),v.id)}),new RTCSessionDescription({type:p.type,sdp:f})}t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(y=>y===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[p.id];if(v)v.addTrack(d),At.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new t.MediaStream([d]);this._streams[p.id]=y,this._reverseStreams[y.id]=p,this.addStream(y)}return this.getSenders().find(y=>y.track===d)},["createOffer","createAnswer"].forEach(function(d){const p=t.RTCPeerConnection.prototype[d],f={[d](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[v=>{const y=o(this,v);S[0].apply(null,[y])},v=>{S[1]&&S[1].apply(null,v)},arguments[2]]):p.apply(this,arguments).then(v=>o(this,v))}};t.RTCPeerConnection.prototype[d]=f[d]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(d,p){let f=p.sdp;return Object.keys(d._reverseStreams||[]).forEach(S=>{const v=d._reverseStreams[S],y=d._streams[v.id];f=f.replace(new RegExp(v.id,"g"),y.id)}),new RTCSessionDescription({type:p.type,sdp:f})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=l.get.apply(this);return d.type===""?d:o(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(S=>d.track===S)&&(p=this._streams[f])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function kw(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function pP(t,e){Ph(t,"negotiationneeded",n=>{const i=n.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var fP=Object.freeze({__proto__:null,fixNegotiationNeeded:pP,shimAddTrackRemoveTrack:hP,shimAddTrackRemoveTrackWithNative:dP,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const r=n.video&&n.video.width,o=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},r&&(n.video.mandatory.maxWidth=r),o&&(n.video.mandatory.maxHeight=o),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:cP,shimGetStats:lP,shimGetUserMedia:sP,shimMediaStream:oP,shimOnTrack:aP,shimPeerConnection:kw,shimSenderReceiverGetStats:uP});function mP(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,o,c){Pw("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(o,c)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c.audio,"autoGainControl","mozAutoGainControl"),r(c.audio,"noiseSuppression","mozNoiseSuppression")),o(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function _P(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Mw(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=t.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=c[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,o,c]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;l.forEach((p,f)=>{l.set(f,Object.assign({},p,{type:n[p.type]||p.type}))})}return l}).then(o,c)}}function EP(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):At.resolve(new Map)}}function gP(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Ph(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function SP(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){Pw("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&Ct(i=e.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function TP(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function vP(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:o}=r,c=o.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,o.sendEncodings=n,this.setParametersPromises.push(o.setParameters(c).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function yP(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function RP(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?At.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function bP(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?At.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var CP=Object.freeze({__proto__:null,shimAddTransceiver:vP,shimCreateAnswer:bP,shimCreateOffer:RP,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,At.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:yP,shimGetUserMedia:mP,shimOnTrack:_P,shimPeerConnection:Mw,shimRTCDataChannel:TP,shimReceiverGetStats:gP,shimRemoveStream:SP,shimSenderGetStats:EP});function AP(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),Ct(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return r&&r.forEach(c=>{var l;this._localStreams?Ct(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(r=>{Ct(i).call(i,r.track)&&this.removeTrack(r)})})}}function wP(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),Ct(o=this._remoteStreams).call(o,r))return;this._remoteStreams.push(r);const c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,n.dispatchEvent(o)})}),e.apply(n,arguments)}}}function IP(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(d,p){const f=arguments.length>=2?arguments[2]:arguments[0],S=n.apply(this,[f]);return p?(S.then(d,p),At.resolve()):S},e.createAnswer=function(d,p){const f=arguments.length>=2?arguments[2]:arguments[0],S=i.apply(this,[f]);return p?(S.then(d,p),At.resolve()):S};let l=function(d,p,f){const S=r.apply(this,[d]);return f?(S.then(p,f),At.resolve()):S};e.setLocalDescription=l,l=function(d,p,f){const S=o.apply(this,[d]);return f?(S.then(p,f),At.resolve()):S},e.setRemoteDescription=l,l=function(d,p,f){const S=c.apply(this,[d]);return f?(S.then(p,f),At.resolve()):S},e.addIceCandidate=l}function OP(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(NP(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,r){e.mediaDevices.getUserMedia(n).then(i,r)}).bind(e))}function NP(t){return t&&t.video!==void 0?Object.assign({},t,{video:nP(t.video)}):t}function DP(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let o=0;o<n.iceServers.length;o++){let c=n.iceServers[o];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(Pw("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,r.push(c)):r.push(n.iceServers[o])}n.iceServers=r}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function PP(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function LP(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function kP(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var MP=Object.freeze({__proto__:null,shimAudioContext:kP,shimCallbacksAPI:IP,shimConstraints:NP,shimCreateOfferLegacy:LP,shimGetUserMedia:OP,shimLocalStreamsAPI:AP,shimRTCIceServerUrls:DP,shimRemoteStreamsAPI:wP,shimTrackEventTransceiver:PP}),UP=`	
\v\f\r                　\u2028\u2029\uFEFF`,uH=jn,dH=Gi,Uw=UP,xP=z("".replace),hH=RegExp("^["+Uw+"]+"),pH=RegExp("(^|[^"+Uw+"])["+Uw+"]+$"),fH=function(t){return function(e){var n=dH(uH(e));return 1&t&&(n=xP(n,hH,"")),2&t&&(n=xP(n,pH,"$1")),n}},mH={trim:fH(3)},_H=ff.PROPER,EH=w,VP=UP,gH=mH.trim;Ke({target:"String",proto:!0,forced:function(t){return EH(function(){return!!VP[t]()||"​᠎"[t]()!=="​᠎"||_H&&VP[t].name!==t})}("trim")},{trim:function(){return gH(this)}});var SH=Br("String","trim"),TH=nt,vH=SH,xw=String.prototype,yH=function(t){var e=t.trim;return typeof t=="string"||t===xw||TH(xw,t)&&e===xw.trim?vH:e},ar=R(yH),BP={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":r.relatedAddress=i[o+1];break;case"rport":r.relatedPort=parseInt(i[o+1],10);break;case"tcptype":r.tcpType=i[o+1];break;case"ufrag":r.ufrag=i[o+1],r.usernameFragment=i[o+1];break;default:r[i[o]]===void 0&&(r[i[o]]=i[o+1])}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const o=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<o.length;c++)r=o[c].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?o.push(c+"="+n.parameters[c]):o.push(c)}),i+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(r.attribute=n.substring(i+1,o),r.value=n.substring(o+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],o=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");i.profile=r[2];for(let c=3;c<r.length;c++){const l=r[c],d=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(d){const p=e.parseRtpMap(d),f=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(p.parameters=f.length?e.parseFmtp(f[0]):{},p.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(p.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{o.forEach(l=>{c.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{r+=e.writeRtpMap(c),r+=e.writeFmtp(c),r+=e.writeRtcpFb(c)});let o=0;return i.codecs.forEach(c=>{c.maxptime>o&&(o=c.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{r+=e.writeExtmap(c)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),o=r.fecMechanisms.indexOf("RED")!==-1,c=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(v=>e.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),d=l.length>0&&l[0].ssrc;let p;const f=e.matchPrefix(n,"a=ssrc-group:FID").map(v=>v.substring(17).split(" ").map(y=>parseInt(y,10)));f.length>0&&f[0].length>1&&f[0][0]===d&&(p=f[0][1]),r.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let y={ssrc:d,codecPayloadType:parseInt(v.parameters.apt,10)};d&&p&&(y.rtx={ssrc:p}),i.push(y),o&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},i.push(y))}}),i.length===0&&d&&i.push({ssrc:d});let S=e.matchPrefix(n,"b=");return S.length&&(S=S[0].indexOf("b=TIAS:")===0?parseInt(S[0].substring(7),10):S[0].indexOf("b=AS:")===0?1e3*parseInt(S[0].substring(5),10)*.95-16e3:void 0,i.forEach(v=>{v.maxBitrate=S})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const c=e.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return o.length>0?(i=o[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const c=e.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let o;const c=i!==void 0?i:2;return o=n||e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+o+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(BP);var jP=BP.exports,hm=R(jP),RH=E({__proto__:null,default:hm},[jP]);function $y(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),r=hm.parseCandidate(n.candidate),o=Object.assign(i,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,Ph(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Vw(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Ph(t,"icecandidate",e=>{if(e.candidate){const n=hm.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function tR(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:i}=this.getConfiguration();i==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(i){if(!i||!i.sdp)return!1;const r=hm.splitSections(i.sdp);return r.shift(),r.some(o=>{const c=hm.parseMLine(o);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const i=function(d){const p=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const f=parseInt(p[1],10);return f!=f?-1:f}(arguments[0]),r=function(d){let p=65536;return e.browser==="firefox"&&(p=e.version<57?d===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),p}(i),o=function(d,p){let f=65536;e.browser==="firefox"&&e.version===57&&(f=65535);const S=hm.matchPrefix(d.sdp,"a=max-message-size:");return S.length>0?f=parseInt(S[0].substr(19),10):e.browser==="firefox"&&p!==-1&&(f=2147483637),f}(arguments[0],i);let c;c=r===0&&o===0?Number.POSITIVE_INFINITY:r===0||o===0?Math.max(r,o):Math.min(r,o);const l={};Object.defineProperty(l,"maxMessageSize",{get:()=>c}),this._sctp=l}return n.apply(this,arguments)}}function eR(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const o=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Ph(t,"datachannel",i=>(e(i.channel,i.target),i))}function Bw(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const c=new Event("connectionstatechange",r);o.dispatchEvent(c)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function jw(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(o=>ar(o).call(o)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function nR(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?At.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),At.resolve())})}function iR(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var bH=Object.freeze({__proto__:null,removeExtmapAllowMixed:jw,shimAddIceCandidateNullOrEmpty:nR,shimConnectionState:Bw,shimMaxMessageSize:tR,shimParameterlessSetLocalDescription:iR,shimRTCIceCandidate:$y,shimRTCIceCandidateRelayProtocol:Vw,shimSendThrowTypeError:eR});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=tP,i=function(o){const c={browser:null,version:null};if(o===void 0||!o.navigator)return c.browser="Not a browser.",c;const{navigator:l}=o;if(l.mozGetUserMedia)c.browser="firefox",c.version=Zy(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)c.browser="chrome",c.version=Zy(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=Zy(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return c}(t),r={browserDetails:i,commonShim:bH,extractVersion:Zy,disableLog:cH,disableWarnings:lH,sdp:RH};switch(i.browser){case"chrome":if(!fP||!kw||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=fP,nR(t,i),iR(t),sP(t,i),oP(t),kw(t,i),aP(t),hP(t,i),cP(t),lP(t),uP(t),pP(t,i),$y(t),Vw(t),Bw(t),tR(t,i),eR(t),jw(t,i);break;case"firefox":if(!CP||!Mw||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=CP,nR(t,i),iR(t),mP(t,i),Mw(t,i),_P(t),SP(t),EP(t),gP(t),TP(t),vP(t),yP(t),RP(t),bP(t),$y(t),Bw(t),tR(t,i),eR(t);break;case"safari":if(!MP||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=MP,nR(t,i),iR(t),DP(t),LP(t),IP(t),AP(t),wP(t),PP(t),OP(t),kP(t),$y(t),Vw(t),tR(t,i),eR(t),jw(t,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var FP=ql,CH=TypeError,GP=po.match(/firefox\/(\d+)/i),AH=!!GP&&+GP[1],wH=/MSIE|Trident/.test(po),HP=po.match(/AppleWebKit\/(\d+)\./),IH=!!HP&&+HP[1],OH=Ke,WP=z,NH=Ji,DH=Yn,KP=Wa,PH=function(t,e){if(!delete t[e])throw new CH("Cannot delete property "+FP(e)+" of "+FP(t))},zP=Gi,Fw=w,LH=vt,kH=cu,YP=AH,MH=wH,qP=Fi,XP=IH,ju=[],JP=WP(ju.sort),UH=WP(ju.push),xH=Fw(function(){ju.sort(void 0)}),VH=Fw(function(){ju.sort(null)}),BH=kH("sort"),QP=!Fw(function(){if(qP)return qP<70;if(!(YP&&YP>3)){if(MH)return!0;if(XP)return XP<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)ju.push({k:e+i,v:n})}for(ju.sort(function(o,c){return c.v-o.v}),i=0;i<ju.length;i++)e=ju[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return r!=="DGBEFHACIJK"}});OH({target:"Array",proto:!0,forced:xH||!VH||!BH||!QP},{sort:function(t){t!==void 0&&NH(t);var e=DH(this);if(QP)return t===void 0?JP(e):JP(e,t);var n,i,r=[],o=KP(e);for(i=0;i<o;i++)i in e&&UH(r,e[i]);for(LH(r,function(c){return function(l,d){return d===void 0?-1:l===void 0?1:c!==void 0?+c(l,d)||0:zP(l)>zP(d)?1:-1}}(t)),n=KP(r),i=0;i<n;)e[i]=r[i++];for(;i<o;)PH(e,i++);return e}});var jH=Br("Array","sort"),FH=nt,GH=jH,Gw=Array.prototype,HH=function(t){var e=t.sort;return t===Gw||FH(Gw,t)&&e===Gw.sort?GH:e},Cg=R(HH),Hw=J;Ke({global:!0,forced:Hw.globalThis!==Hw},{globalThis:Hw});var ZP=R(J),Ww={exports:{}};(function(t,e){(function(n,i){var r="function",o="undefined",c="object",l="string",d="major",p="model",f="name",S="type",v="vendor",y="version",P="architecture",I="console",O="mobile",M="tablet",U="smarttv",W="wearable",Q="embedded",X="Amazon",Y="Apple",ot="ASUS",Et="BlackBerry",Ot="Browser",Lt="Chrome",Ce="Firefox",Ae="Google",dn="Huawei",Kn="LG",Un="Microsoft",kr="Motorola",dt="Opera",yt="Samsung",Gt="Sharp",ft="Sony",A="Xiaomi",F="Zebra",H="Facebook",St="Chromium OS",oe="Mac OS",tn=function(oi){for(var Ti={},Tn=0;Tn<oi.length;Tn++)Ti[oi[Tn].toUpperCase()]=oi[Tn];return Ti},Si=function(oi,Ti){return typeof oi===l&&Jr(Ti).indexOf(Jr(oi))!==-1},Jr=function(oi){return oi.toLowerCase()},Bl=function(oi,Ti){if(typeof oi===l)return oi=oi.replace(/^\s\s*/,""),typeof Ti===o?oi:oi.substring(0,350)},cp=function(oi,Ti){for(var Tn,fs,Bc,zn,Fe,Qr,ad=0;ad<Ti.length&&!Fe;){var Pa=Ti[ad],bj=Ti[ad+1];for(Tn=fs=0;Tn<Pa.length&&!Fe&&Pa[Tn];)if(Fe=Pa[Tn++].exec(oi))for(Bc=0;Bc<bj.length;Bc++)Qr=Fe[++fs],typeof(zn=bj[Bc])===c&&zn.length>0?zn.length===2?typeof zn[1]==r?this[zn[0]]=zn[1].call(this,Qr):this[zn[0]]=zn[1]:zn.length===3?typeof zn[1]!==r||zn[1].exec&&zn[1].test?this[zn[0]]=Qr?Qr.replace(zn[1],zn[2]):i:this[zn[0]]=Qr?zn[1].call(this,Qr,zn[2]):i:zn.length===4&&(this[zn[0]]=Qr?zn[3].call(this,Qr.replace(zn[1],zn[2])):i):this[zn]=Qr||i;ad+=2}},CS=function(oi,Ti){for(var Tn in Ti)if(typeof Ti[Tn]===c&&Ti[Tn].length>0){for(var fs=0;fs<Ti[Tn].length;fs++)if(Si(Ti[Tn][fs],oi))return Tn==="?"?i:Tn}else if(Si(Ti[Tn],oi))return Tn==="?"?i:Tn;return oi},Zb={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},$b={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,y],[/opios[\/ ]+([\w\.]+)/i],[y,[f,dt+" Mini"]],[/\bopr\/([\w\.]+)/i],[y,[f,dt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[f,y],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[f,"UC"+Ot]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[y,[f,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[y,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[f,"IE"]],[/yabrowser\/([\w\.]+)/i],[y,[f,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+Ot],y],[/\bfocus\/([\w\.]+)/i],[y,[f,Ce+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[f,dt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[f,dt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[f,"MIUI "+Ot]],[/fxios\/([-\w\.]+)/i],[y,[f,Ce]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+Ot]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+Ot],y],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[f,y],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,H],y],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[f,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[f,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[f,Lt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,Lt+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[f,"Android "+Ot]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[y,CS,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[f,Ce+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,y],[/(cobalt)\/([\w\.]+)/i],[f,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[P,"amd64"]],[/(ia32(?=;))/i],[[P,Jr]],[/((?:i[346]|x)86)[;\)]/i],[[P,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[P,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[P,"armhf"]],[/windows (ce|mobile); ppc;/i],[[P,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[P,/ower/,"",Jr]],[/(sun4\w)[;\)]/i],[[P,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[P,Jr]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[v,yt],[S,M]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[v,yt],[S,O]],[/\((ip(?:hone|od)[\w ]*);/i],[p,[v,Y],[S,O]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[v,Y],[S,M]],[/(macintosh);/i],[p,[v,Y]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[v,Gt],[S,O]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[v,dn],[S,M]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[v,dn],[S,O]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[v,A],[S,O]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[v,A],[S,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[v,"OPPO"],[S,O]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[v,"Vivo"],[S,O]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[v,"Realme"],[S,O]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[v,kr],[S,O]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[v,kr],[S,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[v,Kn],[S,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[v,Kn],[S,O]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[v,"Lenovo"],[S,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[v,"Nokia"],[S,O]],[/(pixel c)\b/i],[p,[v,Ae],[S,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[v,Ae],[S,O]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[v,ft],[S,O]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[v,ft],[S,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[v,"OnePlus"],[S,O]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[v,X],[S,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[v,X],[S,O]],[/(playbook);[-\w\),; ]+(rim)/i],[p,v,[S,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[v,Et],[S,O]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[v,ot],[S,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[v,ot],[S,O]],[/(nexus 9)/i],[p,[v,"HTC"],[S,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[p,/_/g," "],[S,O]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[v,"Acer"],[S,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[v,"Meizu"],[S,O]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,p,[S,O]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,p,[S,M]],[/(surface duo)/i],[p,[v,Un],[S,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[v,"Fairphone"],[S,O]],[/(u304aa)/i],[p,[v,"AT&T"],[S,O]],[/\bsie-(\w*)/i],[p,[v,"Siemens"],[S,O]],[/\b(rct\w+) b/i],[p,[v,"RCA"],[S,M]],[/\b(venue[\d ]{2,7}) b/i],[p,[v,"Dell"],[S,M]],[/\b(q(?:mv|ta)\w+) b/i],[p,[v,"Verizon"],[S,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[v,"Barnes & Noble"],[S,M]],[/\b(tm\d{3}\w+) b/i],[p,[v,"NuVision"],[S,M]],[/\b(k88) b/i],[p,[v,"ZTE"],[S,M]],[/\b(nx\d{3}j) b/i],[p,[v,"ZTE"],[S,O]],[/\b(gen\d{3}) b.+49h/i],[p,[v,"Swiss"],[S,O]],[/\b(zur\d{3}) b/i],[p,[v,"Swiss"],[S,M]],[/\b((zeki)?tb.*\b) b/i],[p,[v,"Zeki"],[S,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],p,[S,M]],[/\b(ns-?\w{0,9}) b/i],[p,[v,"Insignia"],[S,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[v,"NextBook"],[S,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],p,[S,O]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],p,[S,O]],[/\b(ph-1) /i],[p,[v,"Essential"],[S,O]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[v,"Envizen"],[S,M]],[/\b(trio[-\w\. ]+) b/i],[p,[v,"MachSpeed"],[S,M]],[/\btu_(1491) b/i],[p,[v,"Rotor"],[S,M]],[/(shield[\w ]+) b/i],[p,[v,"Nvidia"],[S,M]],[/(sprint) (\w+)/i],[v,p,[S,O]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[v,Un],[S,O]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[v,F],[S,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[v,F],[S,O]],[/smart-tv.+(samsung)/i],[v,[S,U]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[v,yt],[S,U]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,Kn],[S,U]],[/(apple) ?tv/i],[v,[p,Y+" TV"],[S,U]],[/crkey/i],[[p,Lt+"cast"],[v,Ae],[S,U]],[/droid.+aft(\w)( bui|\))/i],[p,[v,X],[S,U]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[v,Gt],[S,U]],[/(bravia[\w ]+)( bui|\))/i],[p,[v,ft],[S,U]],[/(mitv-\w{5}) bui/i],[p,[v,A],[S,U]],[/Hbbtv.*(technisat) (.*);/i],[v,p,[S,U]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,Bl],[p,Bl],[S,U]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[S,U]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,p,[S,I]],[/droid.+; (shield) bui/i],[p,[v,"Nvidia"],[S,I]],[/(playstation [345portablevi]+)/i],[p,[v,ft],[S,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[v,Un],[S,I]],[/((pebble))app/i],[v,p,[S,W]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[v,Y],[S,W]],[/droid.+; (glass) \d/i],[p,[v,Ae],[S,W]],[/droid.+; (wt63?0{2,3})\)/i],[p,[v,F],[S,W]],[/(quest( 2| pro)?)/i],[p,[v,H],[S,W]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[S,Q]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[S,O]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[S,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[S,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[S,O]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[f,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,y],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[f,[y,CS,Zb]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,"Windows"],[y,CS,Zb]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,oe],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,y],[/\(bb(10);/i],[y,[f,Et]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[f,Ce+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[f,Lt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,St],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,y],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[f,y]]},ro=function(oi,Ti){if(typeof oi===c&&(Ti=oi,oi=i),!(this instanceof ro))return new ro(oi,Ti).getResult();var Tn=typeof n!==o&&n.navigator?n.navigator:i,fs=oi||(Tn&&Tn.userAgent?Tn.userAgent:""),Bc=Tn&&Tn.userAgentData?Tn.userAgentData:i,zn=Ti?function(Fe,Qr){var ad={};for(var Pa in Fe)Qr[Pa]&&Qr[Pa].length%2==0?ad[Pa]=Qr[Pa].concat(Fe[Pa]):ad[Pa]=Fe[Pa];return ad}($b,Ti):$b;return this.getBrowser=function(){var Fe={};return Fe[f]=i,Fe[y]=i,cp.call(Fe,fs,zn.browser),Fe[d]=function(Qr){return typeof Qr===l?Qr.replace(/[^\d\.]/g,"").split(".")[0]:i}(Fe[y]),Tn&&Tn.brave&&typeof Tn.brave.isBrave==r&&(Fe[f]="Brave"),Fe},this.getCPU=function(){var Fe={};return Fe[P]=i,cp.call(Fe,fs,zn.cpu),Fe},this.getDevice=function(){var Fe={};return Fe[v]=i,Fe[p]=i,Fe[S]=i,cp.call(Fe,fs,zn.device),!Fe[S]&&Bc&&Bc.mobile&&(Fe[S]=O),Fe[p]=="Macintosh"&&Tn&&typeof Tn.standalone!==o&&Tn.maxTouchPoints&&Tn.maxTouchPoints>2&&(Fe[p]="iPad",Fe[S]=M),Fe},this.getEngine=function(){var Fe={};return Fe[f]=i,Fe[y]=i,cp.call(Fe,fs,zn.engine),Fe},this.getOS=function(){var Fe={};return Fe[f]=i,Fe[y]=i,cp.call(Fe,fs,zn.os),!Fe[f]&&Bc&&Bc.platform!="Unknown"&&(Fe[f]=Bc.platform.replace(/chrome os/i,St).replace(/macos/i,oe)),Fe},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return fs},this.setUA=function(Fe){return fs=typeof Fe===l&&Fe.length>350?Bl(Fe,350):Fe,this},this.setUA(fs),this};ro.VERSION="0.7.34",ro.BROWSER=tn([f,y,d]),ro.CPU=tn([P]),ro.DEVICE=tn([p,v,S,I,O,U,M,W,Q]),ro.ENGINE=ro.OS=tn([f,y]),t.exports&&(e=t.exports=ro),e.UAParser=ro;var od=typeof n!==o&&(n.jQuery||n.Zepto);if(od&&!od.ua){var lp=new ro;od.ua=lp.getResult(),od.ua.get=function(){return lp.getUA()},od.ua.set=function(oi){lp.setUA(oi);var Ti=lp.getResult();for(var Tn in Ti)od.ua[Tn]=Ti[Tn]}}})(typeof window=="object"?window:g)})(Ww,Ww.exports);var WH=R(Ww.exports),KH=Fs,zH=qn,YH=Te,qH=Za,XH=xn("iterator"),JH=Object,QH=function(t){if(YH(t))return!1;var e=JH(t);return e[XH]!==void 0||"@@iterator"in e||zH(qH,KH(e))},ZH=R(QH),$P=wr.clear;Ke({global:!0,bind:!0,forced:J.clearImmediate!==$P},{clearImmediate:$P});var tL=J,$H=lt,t6=me,e6=Fp,n6=po,i6=ca,r6=ls,s6=tL.Function,o6=/MSIE .\./.test(n6)||e6==="BUN"&&function(){var t=tL.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),a6=Ke,eL=J,nL=wr.set,c6=function(t,e){var n=1;return o6?function(i,r){var o=r6(arguments.length,1)>n,c=t6(i)?i:s6(i),l=o?i6(arguments,n):[],d=o?function(){$H(c,this,l)}:c;return t(d)}:t},iL=eL.setImmediate?c6(nL):nL;a6({global:!0,bind:!0,forced:eL.setImmediate!==iL},{setImmediate:iL});var rL=R(ki.setImmediate),l6=J,u6=Lf,d6=Ji,h6=ls,p6=Zt;Ke({global:!0,dontCallGetSet:!0,forced:w(function(){return p6&&Object.getOwnPropertyDescriptor(l6,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){h6(arguments.length,1),u6(d6(t))}});var sL=R(ki.queueMicrotask);function oL(t,e){return function(){return t.apply(e,arguments)}}const{toString:f6}=Object.prototype,{getPrototypeOf:Kw}=Object,rR=(zw=Object.create(null),t=>{const e=f6.call(t);return zw[e]||(zw[e]=e.slice(8,-1).toLowerCase())});var zw;const Sa=t=>(t=t.toLowerCase(),e=>rR(e)===t),sR=t=>e=>typeof e===t,{isArray:pm}=Array,Ag=sR("undefined"),aL=Sa("ArrayBuffer"),m6=sR("string"),qs=sR("function"),cL=sR("number"),oR=t=>t!==null&&typeof t=="object",aR=t=>{if(rR(t)!=="object")return!1;const e=Kw(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||ZH(t))},_6=Sa("Date"),E6=Sa("File"),g6=Sa("Blob"),S6=Sa("FileList"),T6=Sa("URLSearchParams"),[v6,y6,R6,b6]=["ReadableStream","Request","Response","Headers"].map(Sa);function wg(t,e){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),pm(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const o=r?Object.getOwnPropertyNames(t):Object.keys(t),c=o.length;let l;for(n=0;n<c;n++)l=o[n],e.call(null,t[l],l,t)}}function lL(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,r=n.length;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const Lh=ZP!==void 0?ZP:typeof self<"u"?self:typeof window<"u"?window:P0,uL=t=>!Ag(t)&&t!==Lh,C6=(Yw=typeof Uint8Array<"u"&&Kw(Uint8Array),t=>Yw&&t instanceof Yw);var Yw;const A6=Sa("HTMLFormElement"),dL=(t=>{let{hasOwnProperty:e}=t;return(n,i)=>e.call(n,i)})(Object.prototype),w6=Sa("RegExp"),hL=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};wg(n,(r,o)=>{let c;(c=e(r,o,t))!==!1&&(i[o]=c||r)}),Object.defineProperties(t,i)},qw="abcdefghijklmnopqrstuvwxyz",pL="0123456789",fL={DIGIT:pL,ALPHA:qw,ALPHA_DIGIT:qw+qw.toUpperCase()+pL},I6=Sa("AsyncFunction"),mL=(_L=typeof rL=="function",EL=qs(Lh.postMessage),_L?rL:EL?(Xw="axios@".concat(Math.random()),cR=[],Lh.addEventListener("message",t=>{let{source:e,data:n}=t;e===Lh&&n===Xw&&cR.length&&cR.shift()()},!1),t=>{cR.push(t),Lh.postMessage(Xw,"*")}):t=>setTimeout(t));var _L,EL,Xw,cR;const O6=sL!==void 0?sL.bind(Lh):typeof process<"u"&&process.nextTick||mL;var wt={isArray:pm,isArrayBuffer:aL,isBuffer:function(t){return t!==null&&!Ag(t)&&t.constructor!==null&&!Ag(t.constructor)&&qs(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||qs(t.append)&&((e=rR(t))==="formdata"||e==="object"&&qs(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&aL(t.buffer),e},isString:m6,isNumber:cL,isBoolean:t=>t===!0||t===!1,isObject:oR,isPlainObject:aR,isReadableStream:v6,isRequest:y6,isResponse:R6,isHeaders:b6,isUndefined:Ag,isDate:_6,isFile:E6,isBlob:g6,isRegExp:w6,isFunction:qs,isStream:t=>oR(t)&&qs(t.pipe),isURLSearchParams:T6,isTypedArray:C6,isFileList:S6,forEach:wg,merge:function t(){const{caseless:e}=uL(this)&&this||{},n={},i=(r,o)=>{const c=e&&lL(n,o)||o;aR(n[c])&&aR(r)?n[c]=t(n[c],r):aR(r)?n[c]=t({},r):pm(r)?n[c]=r.slice():n[c]=r};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&wg(arguments[r],i);return n},extend:function(t,e,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return wg(e,(r,o)=>{n&&qs(r)?t[o]=oL(r,n):t[o]=r},{allOwnKeys:i}),t},trim:t=>ar(t)?ar(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let r,o,c;const l={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),o=r.length;o-- >0;)c=r[o],i&&!i(c,t,e)||l[c]||(e[c]=t[c],l[c]=!0);t=n!==!1&&Kw(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:rR,kindOfTest:Sa,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},toArray:t=>{if(!t)return null;if(pm(t))return t;let e=t.length;if(!cL(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=n.next())&&!i.done;){const r=i.value;e.call(t,r[0],r[1])}},matchAll:(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},isHTMLForm:A6,hasOwnProperty:dL,hasOwnProp:dL,reduceDescriptors:hL,freezeMethods:t=>{hL(t,(e,n)=>{if(qs(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];qs(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},i=r=>{r.forEach(o=>{n[o]=!0})};return pm(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:lL,global:Lh,isContextDefined:uL,ALPHABET:fL,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fL.ALPHA_DIGIT,n="";const{length:i}=e;for(;t--;)n+=e[Math.random()*i|0];return n},isSpecCompliantForm:function(t){return!!(t&&qs(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(i,r)=>{if(oR(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const o=pm(i)?[]:{};return wg(i,(c,l)=>{const d=n(c,r+1);!Ag(d)&&(o[l]=d)}),e[r]=void 0,o}}return i};return n(t,0)},isAsyncFn:I6,isThenable:t=>t&&(oR(t)||qs(t))&&qs(t.then)&&qs(t.catch),setImmediate:mL,asap:O6};function Ze(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}wt.inherits(Ze,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:wt.toJSONObject(this.config),code:this.code,status:this.status}}});const gL=Ze.prototype,SL={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{SL[t]={value:t}}),Object.defineProperties(Ze,SL),Object.defineProperty(gL,"isAxiosError",{value:!0}),Ze.from=(t,e,n,i,r,o)=>{const c=Object.create(gL);return wt.toFlatObject(t,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),Ze.call(c,t.message,e,n,i,r),c.cause=t,c.name=t.name,o&&Object.assign(c,o),c};function Jw(t){return wt.isPlainObject(t)||wt.isArray(t)}function TL(t){return wt.endsWith(t,"[]")?t.slice(0,-2):t}function vL(t,e,n){return t?t.concat(e).map(function(i,r){return i=TL(i),!n&&r?"["+i+"]":i}).join(n?".":""):e}const N6=wt.toFlatObject(wt,{},null,function(t){return/^is[A-Z]/.test(t)});function lR(t,e,n){if(!wt.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=wt.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,y){return!wt.isUndefined(y[v])})).metaTokens,r=n.visitor||p,o=n.dots,c=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&wt.isSpecCompliantForm(e);if(!wt.isFunction(r))throw new TypeError("visitor must be a function");function d(v){if(v===null)return"";if(wt.isDate(v))return v.toISOString();if(!l&&wt.isBlob(v))throw new Ze("Blob is not supported. Use a Buffer instead.");return wt.isArrayBuffer(v)||wt.isTypedArray(v)?l&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function p(v,y,P){let I=v;if(v&&!P&&typeof v=="object"){if(wt.endsWith(y,"{}"))y=i?y:y.slice(0,-2),v=JSON.stringify(v);else if(wt.isArray(v)&&function(O){return wt.isArray(O)&&!O.some(Jw)}(v)||(wt.isFileList(v)||wt.endsWith(y,"[]"))&&(I=wt.toArray(v)))return y=TL(y),I.forEach(function(O,M){!wt.isUndefined(O)&&O!==null&&e.append(c===!0?vL([y],M,o):c===null?y:y+"[]",d(O))}),!1}return!!Jw(v)||(e.append(vL(P,y,o),d(v)),!1)}const f=[],S=Object.assign(N6,{defaultVisitor:p,convertValue:d,isVisitable:Jw});if(!wt.isObject(t))throw new TypeError("data must be an object");return function v(y,P){if(!wt.isUndefined(y)){if(f.indexOf(y)!==-1)throw Error("Circular reference detected in "+P.join("."));f.push(y),wt.forEach(y,function(I,O){(!(wt.isUndefined(I)||I===null)&&r.call(e,I,wt.isString(O)?ar(O).call(O):O,P,S))===!0&&v(I,P?P.concat(O):[O])}),f.pop()}}(t),e}function yL(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Qw(t,e){this._pairs=[],t&&lR(t,this,e)}const RL=Qw.prototype;function D6(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function bL(t,e,n){if(!e)return t;const i=n&&n.encode||D6;wt.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let o;if(o=r?r(e,n):wt.isURLSearchParams(e)?e.toString():new Qw(e,n).toString(i),o){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}RL.append=function(t,e){this._pairs.push([t,e])},RL.toString=function(t){const e=t?function(n){return t.call(this,n,yL)}:yL;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var CL=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){wt.forEach(this.handlers,function(e){e!==null&&t(e)})}},AL={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wL={exports:{}},P6=Ke,L6=Zt,IL=Es.f;P6({target:"Object",stat:!0,forced:Object.defineProperty!==IL,sham:!L6},{defineProperty:IL});var OL=ki.Object,k6=wL.exports=function(t,e,n){return OL.defineProperty(t,e,n)};OL.defineProperty.sham&&(k6.sham=!0);var NL=R(wL.exports),M6=TypeError,DL=Hs,U6=uh,x6=Ci,V6=xn("species"),PL=Array,B6=function(t){var e;return DL(t)&&(e=t.constructor,(U6(e)&&(e===PL||DL(e.prototype))||x6(e)&&(e=e[V6])===null)&&(e=void 0)),e===void 0?PL:e},LL=function(t,e){return new(B6(t))(e===0?0:e)},j6=w,F6=Fi,G6=xn("species"),kL=function(t){return F6>=51||!j6(function(){var e=[];return(e.constructor={})[G6]=function(){return{foo:1}},e[t](Boolean).foo!==1})},H6=Ke,W6=w,K6=Hs,z6=Ci,Y6=Yn,q6=Wa,ML=function(t){if(t>9007199254740991)throw M6("Maximum allowed index exceeded");return t},UL=uw,X6=LL,J6=kL,Q6=Fi,xL=xn("isConcatSpreadable"),Z6=Q6>=51||!W6(function(){var t=[];return t[xL]=!1,t.concat()[0]!==t}),$6=function(t){if(!z6(t))return!1;var e=t[xL];return e!==void 0?!!e:K6(t)};H6({target:"Array",proto:!0,forced:!Z6||!J6("concat")},{concat:function(t){var e,n,i,r,o,c=Y6(this),l=X6(c,0),d=0;for(e=-1,i=arguments.length;e<i;e++)if($6(o=e===-1?c:arguments[e]))for(r=q6(o),ML(d+r),n=0;n<r;n++,d++)n in o&&UL(l,d,o[n]);else ML(d+1),UL(l,d++,o);return l.length=d,l}});var VL={},tW=Ht,eW=ji,BL=jd.f,nW=ca,jL=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];VL.f=function(t){return jL&&tW(t)==="Window"?function(e){try{return BL(e)}catch{return nW(jL)}}(t):BL(eW(t))};var fm={},iW=xn;fm.f=iW;var FL=ki,rW=qn,sW=fm,oW=Es.f,Ii=function(t){var e=FL.Symbol||(FL.Symbol={});rW(e,t)||oW(e,t,{value:sW.f(t)})},aW=zt,cW=ti,lW=xn,uW=go,GL=function(){var t=cW("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=lW("toPrimitive");e&&!e[i]&&uW(e,i,function(r){return aW(n,this)},{})},dW=_s,hW=Ge,pW=Yn,fW=Wa,mW=LL,HL=z([].push),_W=function(t){var e=t===1,n=t===2,i=t===3,r=t===4,o=t===6,c=t===7,l=t===5||o;return function(d,p,f,S){for(var v,y,P=pW(d),I=hW(P),O=fW(I),M=dW(p,f),U=0,W=S||mW,Q=e?W(d,O):n||c?W(d,0):void 0;O>U;U++)if((l||U in I)&&(y=M(v=I[U],U,P),t))if(e)Q[U]=y;else if(y)switch(t){case 3:return!0;case 5:return v;case 6:return U;case 2:HL(Q,v)}else switch(t){case 4:return!1;case 7:HL(Q,v)}return o?-1:i||r?r:Q}},WL={forEach:_W(0)},uR=Ke,Ig=J,Zw=zt,EW=z,mm=Zt,_m=Yl,gW=w,mr=qn,SW=nt,$w=hr,dR=ji,tI=Ga,TW=Gi,eI=Qt,Em=el,KL=mo,vW=jd,zL=VL,yW=Gd,YL=ke,qL=Es,RW=Qp,XL=Mt,JL=go,bW=ch,nI=js,QL=fu,ZL=yp,CW=xn,AW=fm,wW=Ii,IW=GL,OW=rs,$L=ec,hR=WL.forEach,ws=Xa("hidden"),pR="Symbol",Og="prototype",NW=$L.set,tk=$L.getterFor(pR),Ta=Object[Og],kh=Ig.Symbol,fR=kh&&kh[Og],DW=Ig.RangeError,PW=Ig.TypeError,iI=Ig.QObject,ek=YL.f,Mh=qL.f,nk=zL.f,LW=XL.f,ik=EW([].push),bl=nI("symbols"),Ng=nI("op-symbols"),kW=nI("wks"),rI=!iI||!iI[Og]||!iI[Og].findChild,rk=function(t,e,n){var i=ek(Ta,e);i&&delete Ta[e],Mh(t,e,n),i&&t!==Ta&&Mh(Ta,e,i)},sI=mm&&gW(function(){return Em(Mh({},"a",{get:function(){return Mh(this,"a",{value:7}).a}})).a!==7})?rk:Mh,oI=function(t,e){var n=bl[t]=Em(fR);return NW(n,{type:pR,tag:t,description:e}),mm||(n.description=e),n},mR=function(t,e,n){t===Ta&&mR(Ng,e,n),$w(t);var i=tI(e);return $w(n),mr(bl,i)?(n.enumerable?(mr(t,ws)&&t[ws][i]&&(t[ws][i]=!1),n=Em(n,{enumerable:eI(0,!1)})):(mr(t,ws)||Mh(t,ws,eI(1,Em(null))),t[ws][i]=!0),sI(t,i,n)):Mh(t,i,n)},aI=function(t,e){$w(t);var n=dR(e),i=KL(n).concat(ck(n));return hR(i,function(r){mm&&!Zw(sk,n,r)||mR(t,r,n[r])}),t},sk=function(t){var e=tI(t),n=Zw(LW,this,e);return!(this===Ta&&mr(bl,e)&&!mr(Ng,e))&&(!(n||!mr(this,e)||!mr(bl,e)||mr(this,ws)&&this[ws][e])||n)},ok=function(t,e){var n=dR(t),i=tI(e);if(n!==Ta||!mr(bl,i)||mr(Ng,i)){var r=ek(n,i);return!r||!mr(bl,i)||mr(n,ws)&&n[ws][i]||(r.enumerable=!0),r}},ak=function(t){var e=nk(dR(t)),n=[];return hR(e,function(i){mr(bl,i)||mr(QL,i)||ik(n,i)}),n},ck=function(t){var e=t===Ta,n=nk(e?Ng:dR(t)),i=[];return hR(n,function(r){!mr(bl,r)||e&&!mr(Ta,r)||ik(i,bl[r])}),i};_m||(kh=function(){if(SW(fR,this))throw new PW("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?TW(arguments[0]):void 0,e=ZL(t),n=function(i){var r=this===void 0?Ig:this;r===Ta&&Zw(n,Ng,i),mr(r,ws)&&mr(r[ws],e)&&(r[ws][e]=!1);var o=eI(1,i);try{sI(r,e,o)}catch(c){if(!(c instanceof DW))throw c;rk(r,e,o)}};return mm&&rI&&sI(Ta,e,{configurable:!0,set:n}),oI(e,t)},JL(fR=kh[Og],"toString",function(){return tk(this).tag}),JL(kh,"withoutSetter",function(t){return oI(ZL(t),t)}),XL.f=sk,qL.f=mR,RW.f=aI,YL.f=ok,vW.f=zL.f=ak,yW.f=ck,AW.f=function(t){return oI(CW(t),t)},mm&&bW(fR,"description",{configurable:!0,get:function(){return tk(this).description}})),uR({global:!0,wrap:!0,forced:!_m,sham:!_m},{Symbol:kh}),hR(KL(kW),function(t){wW(t)}),uR({target:pR,stat:!0,forced:!_m},{useSetter:function(){rI=!0},useSimple:function(){rI=!1}}),uR({target:"Object",stat:!0,forced:!_m,sham:!mm},{create:function(t,e){return e===void 0?Em(t):aI(Em(t),e)},defineProperty:mR,defineProperties:aI,getOwnPropertyDescriptor:ok}),uR({target:"Object",stat:!0,forced:!_m},{getOwnPropertyNames:ak}),IW(),OW(kh,pR),QL[ws]=!0;var lk=Yl&&!!Symbol.for&&!!Symbol.keyFor,MW=Ke,UW=ti,xW=qn,VW=Gi,uk=js,BW=lk,cI=uk("string-to-symbol-registry"),jW=uk("symbol-to-string-registry");MW({target:"Symbol",stat:!0,forced:!BW},{for:function(t){var e=VW(t);if(xW(cI,e))return cI[e];var n=UW("Symbol")(e);return cI[e]=n,jW[n]=e,n}});var FW=Ke,GW=qn,HW=Ba,WW=ql,KW=lk,dk=js("symbol-to-string-registry");FW({target:"Symbol",stat:!0,forced:!KW},{keyFor:function(t){if(!HW(t))throw new TypeError(WW(t)+" is not a symbol");if(GW(dk,t))return dk[t]}});var hk=Hs,zW=me,pk=Ht,YW=Gi,fk=z([].push),qW=Ke,mk=ti,_k=lt,XW=zt,Dg=z,Ek=w,gk=me,Sk=Ba,Tk=ca,JW=function(t){if(zW(t))return t;if(hk(t)){for(var e=t.length,n=[],i=0;i<e;i++){var r=t[i];typeof r=="string"?fk(n,r):typeof r!="number"&&pk(r)!=="Number"&&pk(r)!=="String"||fk(n,YW(r))}var o=n.length,c=!0;return function(l,d){if(c)return c=!1,d;if(hk(this))return d;for(var p=0;p<o;p++)if(n[p]===l)return d}}},QW=Yl,ZW=String,Fu=mk("JSON","stringify"),_R=Dg(/./.exec),vk=Dg("".charAt),$W=Dg("".charCodeAt),t8=Dg("".replace),e8=Dg(1 .toString),n8=/[\uD800-\uDFFF]/g,yk=/^[\uD800-\uDBFF]$/,Rk=/^[\uDC00-\uDFFF]$/,bk=!QW||Ek(function(){var t=mk("Symbol")("stringify detection");return Fu([t])!=="[null]"||Fu({a:t})!=="{}"||Fu(Object(t))!=="{}"}),Ck=Ek(function(){return Fu("\uDF06\uD834")!=='"\\udf06\\ud834"'||Fu("\uDEAD")!=='"\\udead"'}),i8=function(t,e){var n=Tk(arguments),i=JW(e);if(gk(i)||t!==void 0&&!Sk(t))return n[1]=function(r,o){if(gk(i)&&(o=XW(i,this,ZW(r),o)),!Sk(o))return o},_k(Fu,null,n)},r8=function(t,e,n){var i=vk(n,e-1),r=vk(n,e+1);return _R(yk,t)&&!_R(Rk,r)||_R(Rk,t)&&!_R(yk,i)?"\\u"+e8($W(t,0),16):t};Fu&&qW({target:"JSON",stat:!0,forced:bk||Ck},{stringify:function(t,e,n){var i=Tk(arguments),r=_k(bk?i8:Fu,null,i);return Ck&&typeof r=="string"?t8(r,n8,r8):r}});var Ak=Gd,s8=Yn;Ke({target:"Object",stat:!0,forced:!Yl||w(function(){Ak.f(1)})},{getOwnPropertySymbols:function(t){var e=Ak.f;return e?e(s8(t)):[]}}),Ii("asyncIterator"),Ii("hasInstance"),Ii("isConcatSpreadable"),Ii("iterator"),Ii("match"),Ii("matchAll"),Ii("replace"),Ii("search"),Ii("species"),Ii("split");var o8=GL;Ii("toPrimitive"),o8();var a8=ti,c8=rs;Ii("toStringTag"),c8(a8("Symbol"),"Symbol"),Ii("unscopables"),rs(J.JSON,"JSON",!0);var l8=ki.Symbol,u8=xn,d8=Es.f,wk=u8("metadata"),Ik=Function.prototype;Ik[wk]===void 0&&d8(Ik,wk,{value:null}),Ii("asyncDispose"),Ii("dispose"),Ii("metadata");var h8=l8,p8=z,lI=ti("Symbol"),f8=lI.keyFor,m8=p8(lI.prototype.valueOf),Ok=lI.isRegisteredSymbol||function(t){try{return f8(m8(t))!==void 0}catch{return!1}};Ke({target:"Symbol",stat:!0},{isRegisteredSymbol:Ok});for(var _8=js,Nk=ti,E8=z,g8=Ba,S8=xn,ER=Nk("Symbol"),Dk=ER.isWellKnownSymbol,Pk=Nk("Object","getOwnPropertyNames"),T8=E8(ER.prototype.valueOf),Lk=_8("wks"),uI=0,kk=Pk(ER),v8=kk.length;uI<v8;uI++)try{var Mk=kk[uI];g8(ER[Mk])&&S8(Mk)}catch{}var Uk=function(t){if(Dk&&Dk(t))return!0;try{for(var e=T8(t),n=0,i=Pk(Lk),r=i.length;n<r;n++)if(Lk[i[n]]==e)return!0}catch{}return!1};Ke({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Uk}),Ii("customMatcher"),Ii("observable"),Ke({target:"Symbol",stat:!0},{isRegistered:Ok}),Ke({target:"Symbol",stat:!0,forced:!0},{isWellKnown:Uk}),Ii("matcher"),Ii("metadataKey"),Ii("patternMatch"),Ii("replaceAll");var gm=R(h8),xk=R(fm.f("iterator"));function Pg(t){return Pg=typeof gm=="function"&&typeof xk=="symbol"?function(e){return typeof e}:function(e){return e&&typeof gm=="function"&&e.constructor===gm&&e!==gm.prototype?"symbol":typeof e},Pg(t)}var y8=R(fm.f("toPrimitive"));function R8(t){var e=function(n,i){if(Pg(n)!=="object"||n===null)return n;var r=n[y8];if(r!==void 0){var o=r.call(n,i);if(Pg(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(t,"string");return Pg(e)==="symbol"?e:String(e)}function D(t,e,n){return(e=R8(e))in t?NL(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Vk=R(J4),b8={isBrowser:!0,classes:{URLSearchParams:Vk!==void 0?Vk:Qw,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const dI=typeof window<"u"&&typeof document<"u",hI=typeof navigator=="object"&&navigator||void 0,C8=dI&&(!hI||["ReactNative","NativeScript","NS"].indexOf(hI.product)<0),A8=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",w8=dI&&window.location.href||"http://localhost";function Bk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function jk(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Bk(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var Wr=jk(jk({},Object.freeze({__proto__:null,hasBrowserEnv:dI,hasStandardBrowserEnv:C8,hasStandardBrowserWebWorkerEnv:A8,navigator:hI,origin:w8})),b8),I8=hr,O8=zt,N8=qn,D8=nt,P8=function(){var t=I8(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},Fk=RegExp.prototype,Gk=function(t){var e=t.flags;return e!==void 0||"flags"in Fk||N8(t,"flags")||!D8(Fk,t)?e:O8(P8,t)},L8=Ch.charAt,Hk=zt,k8=hr,M8=me,U8=Ht,x8=/./.exec,V8=TypeError,B8=Ke,Wk=zt,Kk=se,j8=rh,gR=ah,zk=jn,Yk=vT,Lg=Gi,F8=hr,G8=Te,H8=Ht,W8=OT,qk=Gk,K8=yd,z8=w,Y8=yo,q8=function(t,e,n){return e+(n?L8(t,e).length:1)},X8=function(t,e){var n=t.exec;if(M8(n)){var i=Hk(n,t,e);return i!==null&&k8(i),i}if(U8(t)==="RegExp")return Hk(x8,t,e);throw new V8("RegExp#exec called on incompatible receiver")},Xk=ec,J8=xn("matchAll"),Jk="RegExp String",Qk=Jk+" Iterator",Q8=Xk.set,Z8=Xk.getterFor(Qk),$8=TypeError,pI=Kk("".indexOf),SR=Kk("".matchAll),fI=!!SR&&!z8(function(){SR("a",/./)}),tK=j8(function(t,e,n,i){Q8(this,{type:Qk,regexp:t,string:e,global:n,unicode:i,done:!1})},Jk,function(){var t=Z8(this);if(t.done)return gR(void 0,!0);var e=t.regexp,n=t.string,i=X8(e,n);return i===null?(t.done=!0,gR(void 0,!0)):t.global?(Lg(i[0])===""&&(e.lastIndex=q8(n,Yk(e.lastIndex),t.unicode)),gR(i,!1)):(t.done=!0,gR(i,!1))}),Zk=function(t){var e,n,i,r=F8(this),o=Lg(t),c=Y8(r,RegExp),l=Lg(qk(r));return e=new c(c===RegExp?r.source:r,l),n=!!~pI(l,"g"),i=!!~pI(l,"u"),e.lastIndex=Yk(r.lastIndex),new tK(e,o,n,i)};B8({target:"String",proto:!0,forced:fI},{matchAll:function(t){var e,n,i,r,o=zk(this);if(G8(t)){if(fI)return SR(o,t)}else{if(W8(t)&&(e=Lg(zk(qk(t))),!~pI(e,"g")))throw new $8("`.matchAll` does not allow non-global regexes");if(fI)return SR(o,t);if((i=K8(t,J8))===void 0&&H8(t)==="RegExp"&&(i=Zk),i)return Wk(i,t,o)}return n=Lg(o),r=new RegExp(t,"g"),Wk(Zk,r,n)}});var eK=Br("String","matchAll"),nK=nt,iK=eK,mI=String.prototype,rK=function(t){var e=t.matchAll;return typeof t=="string"||t===mI||nK(mI,t)&&e===mI.matchAll?iK:e},sK=R(rK);function $k(t){function e(n,i,r,o){let c=n[o++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),d=o>=n.length;return c=!c&&wt.isArray(r)?r.length:c,d?(wt.hasOwnProp(r,c)?r[c]=[r[c],i]:r[c]=i,!l):(r[c]&&wt.isObject(r[c])||(r[c]=[]),e(n,i,r[c],o)&&wt.isArray(r[c])&&(r[c]=function(p){const f={},S=Object.keys(p);let v;const y=S.length;let P;for(v=0;v<y;v++)P=S[v],f[P]=p[P];return f}(r[c])),!l)}if(wt.isFormData(t)&&wt.isFunction(t.entries)){const n={};return wt.forEachEntry(t,(i,r)=>{e(function(o){return sK(wt).call(wt,/\w+|\[(\w*)]/g,o).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),r,n,0)}),n}return null}const _I={transitional:AL,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,r=wt.isObject(t);if(r&&wt.isHTMLForm(t)&&(t=new FormData(t)),wt.isFormData(t))return i?JSON.stringify($k(t)):t;if(wt.isArrayBuffer(t)||wt.isBuffer(t)||wt.isStream(t)||wt.isFile(t)||wt.isBlob(t)||wt.isReadableStream(t))return t;if(wt.isArrayBufferView(t))return t.buffer;if(wt.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return lR(c,new Wr.classes.URLSearchParams,Object.assign({visitor:function(d,p,f,S){return Wr.isNode&&wt.isBuffer(d)?(this.append(p,d.toString("base64")),!1):S.defaultVisitor.apply(this,arguments)}},l))}(t,this.formSerializer).toString();if((o=wt.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return lR(o?{"files[]":t}:t,c&&new c,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(c,l,d){if(wt.isString(c))try{return(l||JSON.parse)(c),ar(wt).call(wt,c)}catch(p){if(p.name!=="SyntaxError")throw p}return(d||JSON.stringify)(c)}(t)):t}],transformResponse:[function(t){const e=this.transitional||_I.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(wt.isResponse(t)||wt.isReadableStream(t))return t;if(t&&wt.isString(t)&&(n&&!this.responseType||i)){const r=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(o){if(r)throw o.name==="SyntaxError"?Ze.from(o,Ze.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Wr.classes.FormData,Blob:Wr.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};wt.forEach(["delete","get","head","post","put","patch"],t=>{_I.headers[t]={}});var EI=_I;const oK=wt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),tM=Symbol("internals");function kg(t){var e;return t&&ar(e=String(t)).call(e).toLowerCase()}function TR(t){return t===!1||t==null?t:wt.isArray(t)?t.map(TR):String(t)}function gI(t,e,n,i,r){return wt.isFunction(i)?i.call(this,e,n):(r&&(e=n),wt.isString(e)?wt.isString(i)?e.indexOf(i)!==-1:wt.isRegExp(i)?i.test(e):void 0:void 0)}class vR{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function o(d,p,f){const S=kg(p);if(!S)throw new Error("header name must be a non-empty string");const v=wt.findKey(r,S);(!v||r[v]===void 0||f===!0||f===void 0&&r[v]!==!1)&&(r[v||p]=TR(d))}const c=(d,p)=>wt.forEach(d,(f,S)=>o(f,S,p));if(wt.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(wt.isString(e)&&(e=ar(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ar(l=e).call(l)))c((d=>{const p={};let f,S,v;return d&&d.split(`
`).forEach(function(y){var P,I;v=y.indexOf(":"),f=ar(P=y.substring(0,v)).call(P).toLowerCase(),S=ar(I=y.substring(v+1)).call(I),!f||p[f]&&oK[f]||(f==="set-cookie"?p[f]?p[f].push(S):p[f]=[S]:p[f]=p[f]?p[f]+", "+S:S)}),p})(e),n);else if(wt.isHeaders(e))for(const[d,p]of e.entries())o(p,d,i);else e!=null&&o(n,e,i);var l;return this}get(e,n){if(e=kg(e)){const i=wt.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(o){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=l.exec(o);)c[d[1]]=d[2];return c}(r);if(wt.isFunction(n))return n.call(this,r,i);if(wt.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=kg(e)){const i=wt.findKey(this,e);return!(!i||this[i]===void 0||n&&!gI(0,this[i],i,n))}return!1}delete(e,n){const i=this;let r=!1;function o(c){if(c=kg(c)){const l=wt.findKey(i,c);!l||n&&!gI(0,i[l],l,n)||(delete i[l],r=!0)}}return wt.isArray(e)?e.forEach(o):o(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const o=n[i];e&&!gI(0,this[o],o,e,!0)||(delete this[o],r=!0)}return r}normalize(e){const n=this,i={};return wt.forEach(this,(r,o)=>{var c;const l=wt.findKey(i,o);if(l)return n[l]=TR(r),void delete n[o];const d=e?function(p){return ar(p).call(p).toLowerCase().replace(/([a-z\d])(\w*)/g,(f,S,v)=>S.toUpperCase()+v)}(o):ar(c=String(o)).call(c);d!==o&&delete n[o],n[d]=TR(r),i[d]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return wt.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&wt.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,i]=e;return n+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return r.forEach(c=>n.set(c)),n}static accessor(e){const n=(this[tM]=this[tM]={accessors:{}}).accessors,i=this.prototype;function r(o){const c=kg(o);n[c]||(function(l,d){const p=wt.toCamelCase(" "+d);["get","set","has"].forEach(f=>{Object.defineProperty(l,f+p,{value:function(S,v,y){return this[f].call(this,d,S,v,y)},configurable:!0})})}(i,o),n[c]=!0)}return wt.isArray(e)?e.forEach(r):r(e),this}}vR.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),wt.reduceDescriptors(vR.prototype,(t,e)=>{let{value:n}=t,i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[i]=r}}}),wt.freezeMethods(vR);var va=vR;function SI(t,e){const n=this||EI,i=e||n,r=va.from(i.headers);let o=i.data;return wt.forEach(t,function(c){o=c.call(n,o,r.normalize(),e?e.status:void 0)}),r.normalize(),o}function eM(t){return!(!t||!t.__CANCEL__)}function Sm(t,e,n){Ze.call(this,t??"canceled",Ze.ERR_CANCELED,e,n),this.name="CanceledError"}function nM(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new Ze("Request failed with status code "+n.status,[Ze.ERR_BAD_REQUEST,Ze.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}wt.inherits(Sm,Ze,{__CANCEL__:!0});const yR=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(o,c){o=o||10;const l=new Array(o),d=new Array(o);let p,f=0,S=0;return c=c!==void 0?c:1e3,function(v){const y=Date.now(),P=d[S];p||(p=y),l[f]=v,d[f]=y;let I=S,O=0;for(;I!==f;)O+=l[I++],I%=o;if(f=(f+1)%o,f===S&&(S=(S+1)%o),y-p<c)return;const M=P&&y-P;return M?Math.round(1e3*O/M):void 0}}(50,250);return function(o,c){let l,d,p=0,f=1e3/c;const S=function(v){p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,d&&(clearTimeout(d),d=null),o.apply(null,v)};return[function(){const v=Date.now(),y=v-p;for(var P=arguments.length,I=new Array(P),O=0;O<P;O++)I[O]=arguments[O];y>=f?S(I,v):(l=I,d||(d=setTimeout(()=>{d=null,S(l)},f-y)))},()=>l&&S(l)]}(o=>{const c=o.loaded,l=o.lengthComputable?o.total:void 0,d=c-i,p=r(d);i=c,t({loaded:c,total:l,progress:l?c/l:void 0,bytes:d,rate:p||void 0,estimated:p&&l&&c<=l?(l-c)/p:void 0,event:o,lengthComputable:l!=null,[e?"download":"upload"]:!0})},n)},iM=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},rM=t=>function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return wt.asap(()=>t(...n))};var aK=Wr.hasStandardBrowserEnv?((t,e)=>n=>(n=new Qy(n,Wr.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new Qy(Wr.origin),Wr.navigator&&/(msie|trident)/i.test(Wr.navigator.userAgent)):()=>!0,cK=Wr.hasStandardBrowserEnv?{write(t,e,n,i,r,o){const c=[t+"="+encodeURIComponent(e)];wt.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),wt.isString(i)&&c.push("path="+i),wt.isString(r)&&c.push("domain="+r),o===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function sM(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}(t,e):e}function oM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const aM=t=>t instanceof va?function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?oM(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):oM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t):t;function Uh(t,e){e=e||{};const n={};function i(p,f,S,v){return wt.isPlainObject(p)&&wt.isPlainObject(f)?wt.merge.call({caseless:v},p,f):wt.isPlainObject(f)?wt.merge({},f):wt.isArray(f)?f.slice():f}function r(p,f,S,v){return wt.isUndefined(f)?wt.isUndefined(p)?void 0:i(void 0,p,0,v):i(p,f,0,v)}function o(p,f){if(!wt.isUndefined(f))return i(void 0,f)}function c(p,f){return wt.isUndefined(f)?wt.isUndefined(p)?void 0:i(void 0,p):i(void 0,f)}function l(p,f,S){return S in e?i(p,f):S in t?i(void 0,p):void 0}const d={url:o,method:o,data:o,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(p,f,S)=>r(aM(p),aM(f),0,!0)};return wt.forEach(Object.keys(Object.assign({},t,e)),function(p){const f=d[p]||r,S=f(t[p],e[p],p);wt.isUndefined(S)&&f!==l||(n[p]=S)}),n}var cM=t=>{const e=Uh({},t);let n,{data:i,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:c,headers:l,auth:d}=e;if(e.headers=l=va.from(l),e.url=bL(sM(e.baseURL,e.url),t.params,t.paramsSerializer),d&&l.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),wt.isFormData(i)){if(Wr.hasStandardBrowserEnv||Wr.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((n=l.getContentType())!==!1){const[p,...f]=n?n.split(";").map(S=>ar(S).call(S)).filter(Boolean):[];l.setContentType([p||"multipart/form-data",...f].join("; "))}}if(Wr.hasStandardBrowserEnv&&(r&&wt.isFunction(r)&&(r=r(e)),r||r!==!1&&aK(e.url))){const p=o&&c&&cK.read(c);p&&l.set(o,p)}return e},lK=typeof XMLHttpRequest<"u"&&function(t){return new At(function(e,n){const i=cM(t);let r=i.data;const o=va.from(i.headers).normalize();let c,l,d,p,f,{responseType:S,onUploadProgress:v,onDownloadProgress:y}=i;function P(){p&&p(),f&&f(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let I=new XMLHttpRequest;function O(){if(!I)return;const U=va.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders());nM(function(W){e(W),P()},function(W){n(W),P()},{data:S&&S!=="text"&&S!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:U,config:t,request:I}),I=null}I.open(i.method.toUpperCase(),i.url,!0),I.timeout=i.timeout,"onloadend"in I?I.onloadend=O:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(O)},I.onabort=function(){I&&(n(new Ze("Request aborted",Ze.ECONNABORTED,t,I)),I=null)},I.onerror=function(){n(new Ze("Network Error",Ze.ERR_NETWORK,t,I)),I=null},I.ontimeout=function(){let U=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const W=i.transitional||AL;i.timeoutErrorMessage&&(U=i.timeoutErrorMessage),n(new Ze(U,W.clarifyTimeoutError?Ze.ETIMEDOUT:Ze.ECONNABORTED,t,I)),I=null},r===void 0&&o.setContentType(null),"setRequestHeader"in I&&wt.forEach(o.toJSON(),function(U,W){I.setRequestHeader(W,U)}),wt.isUndefined(i.withCredentials)||(I.withCredentials=!!i.withCredentials),S&&S!=="json"&&(I.responseType=i.responseType),y&&([d,f]=yR(y,!0),I.addEventListener("progress",d)),v&&I.upload&&([l,p]=yR(v),I.upload.addEventListener("progress",l),I.upload.addEventListener("loadend",p)),(i.cancelToken||i.signal)&&(c=U=>{I&&(n(!U||U.type?new Sm(null,t,I):U),I.abort(),I=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const M=function(U){const W=/^([-+\w]{1,25})(:?\/\/|:)/.exec(U);return W&&W[1]||""}(i.url);M&&Wr.protocols.indexOf(M)===-1?n(new Ze("Unsupported protocol "+M+":",Ze.ERR_BAD_REQUEST,t)):I.send(r||null)})},uK=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i,r=new AbortController;const o=function(p){if(!i){i=!0,l();const f=p instanceof Error?p:this.reason;r.abort(f instanceof Ze?f:new Sm(f instanceof Error?f.message:f))}};let c=e&&setTimeout(()=>{c=null,o(new Ze("timeout ".concat(e," of ms exceeded"),Ze.ETIMEDOUT))},e);const l=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(p=>{p.unsubscribe?p.unsubscribe(o):p.removeEventListener("abort",o)}),t=null)};t.forEach(p=>p.addEventListener("abort",o));const{signal:d}=r;return d.unsubscribe=()=>wt.asap(l),d}},TI=R(Uy),lM=fm.f("asyncIterator"),dK=R(lM);function vI(t,e){this.v=t,this.k=e}function Mg(t){var e,n;function i(o,c){try{var l=t[o](c),d=l.value,p=d instanceof vI;TI.resolve(p?d.v:d).then(function(f){if(p){var S=o==="return"?"return":"next";if(!d.k||f.done)return i(S,f);f=t[S](f).value}r(l.done?"return":"normal",f)},function(f){i("throw",f)})}catch(f){r("throw",f)}}function r(o,c){switch(o){case"return":e.resolve({value:c,done:!0});break;case"throw":e.reject(c);break;default:e.resolve({value:c,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(o,c){return new TI(function(l,d){var p={key:o,arg:c,resolve:l,reject:d,next:null};n?n=n.next=p:(e=n=p,i(o,c))})},typeof t.return!="function"&&(this.return=void 0)}function Xs(t){return function(){return new Mg(t.apply(this,arguments))}}function De(t){return new vI(t,0)}function RR(t){var e={},n=!1;function i(r,o){return n=!0,{done:!1,value:new vI(o=new TI(function(c){c(t[r](o))}),1)}}return e[gm!==void 0&&xk||"@@iterator"]=function(){return this},e.next=function(r){return n?(n=!1,r):i("next",r)},typeof t.throw=="function"&&(e.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof t.return=="function"&&(e.return=function(r){return n?(n=!1,r):i("return",r)}),e}Mg.prototype[typeof gm=="function"&&dK||"@@asyncIterator"]=function(){return this},Mg.prototype.next=function(t){return this._invoke("next",t)},Mg.prototype.throw=function(t){return this._invoke("throw",t)},Mg.prototype.return=function(t){return this._invoke("return",t)};var yI=R(lM);function RI(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=yI,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new bR(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function bR(t){function e(n){if(Object(n)!==n)return At.reject(new TypeError(n+" is not an object."));var i=n.done;return At.resolve(n.value).then(function(r){return{value:r,done:i}})}return bR=function(n){this.s=n,this.n=n.next},bR.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?At.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?At.reject(n):e(i.apply(this.s,arguments))}},new bR(t)}const hK=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,r=0;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},pK=function(){var t=Xs(function*(e,n){var i,r=!1,o=!1;try{for(var c,l=RI(fK(e));r=!(c=yield De(l.next())).done;r=!1){const d=c.value;yield*RR(RI(hK(d,n)))}}catch(d){o=!0,i=d}finally{try{r&&l.return!=null&&(yield De(l.return()))}finally{if(o)throw i}}});return function(e,n){return t.apply(this,arguments)}}(),fK=function(){var t=Xs(function*(e){if(e[yI])return void(yield*RR(RI(e)));const n=e.getReader();try{for(;;){const{done:i,value:r}=yield De(n.read());if(i)break;yield r}}finally{yield De(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),uM=(t,e,n,i)=>{const r=pK(t,e);let o,c=0,l=d=>{o||(o=!0,i&&i(d))};return new ReadableStream({async pull(d){try{const{done:p,value:f}=await r.next();if(p)return l(),void d.close();let S=f.byteLength;if(n){let v=c+=S;n(v)}d.enqueue(new Uint8Array(f))}catch(p){throw l(p),p}},cancel:d=>(l(d),r.return())},{highWaterMark:2})};function dM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function hM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?dM(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const CR=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",pM=CR&&typeof ReadableStream=="function",mK=CR&&(typeof TextEncoder=="function"?(fM=new TextEncoder,t=>fM.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var fM;const mM=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return!!t(...n)}catch{return!1}},_K=pM&&mM(()=>{let t=!1;const e=new Request(Wr.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),bI=pM&&mM(()=>wt.isReadableStream(new Response("").body)),AR={stream:bI&&(t=>t.body)};var _M;CR&&(_M=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!AR[t]&&(AR[t]=wt.isFunction(_M[t])?e=>e[t]():(e,n)=>{throw new Ze("Response type '".concat(t,"' is not supported"),Ze.ERR_NOT_SUPPORT,n)})}));const EK=async(t,e)=>{const n=wt.toFiniteNumber(t.getContentLength());return n??(async i=>i==null?0:wt.isBlob(i)?i.size:wt.isSpecCompliantForm(i)?(await new Request(Wr.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:wt.isArrayBufferView(i)||wt.isArrayBuffer(i)?i.byteLength:(wt.isURLSearchParams(i)&&(i+=""),wt.isString(i)?(await mK(i)).byteLength:void 0))(e)};var gK=CR&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:o,timeout:c,onDownloadProgress:l,onUploadProgress:d,responseType:p,headers:f,withCredentials:S="same-origin",fetchOptions:v}=cM(t);p=p?(p+"").toLowerCase():"text";let y,P=uK([r,o&&o.toAbortSignal()],c);const I=P&&P.unsubscribe&&(()=>{P.unsubscribe()});let O;try{if(d&&_K&&n!=="get"&&n!=="head"&&(O=await EK(f,i))!==0){let X,Y=new Request(e,{method:"POST",body:i,duplex:"half"});if(wt.isFormData(i)&&(X=Y.headers.get("content-type"))&&f.setContentType(X),Y.body){const[ot,Et]=iM(O,yR(rM(d)));i=uM(Y.body,65536,ot,Et)}}wt.isString(S)||(S=S?"include":"omit");const M="credentials"in Request.prototype;y=new Request(e,hM(hM({},v),{},{signal:P,method:n.toUpperCase(),headers:f.normalize().toJSON(),body:i,duplex:"half",credentials:M?S:void 0}));let U=await fetch(y);const W=bI&&(p==="stream"||p==="response");if(bI&&(l||W&&I)){const X={};["status","statusText","headers"].forEach(Ot=>{X[Ot]=U[Ot]});const Y=wt.toFiniteNumber(U.headers.get("content-length")),[ot,Et]=l&&iM(Y,yR(rM(l),!0))||[];U=new Response(uM(U.body,65536,ot,()=>{Et&&Et(),I&&I()}),X)}p=p||"text";let Q=await AR[wt.findKey(AR,p)||"text"](U,t);return!W&&I&&I(),await new At((X,Y)=>{nM(X,Y,{data:Q,headers:va.from(U.headers),status:U.status,statusText:U.statusText,config:t,request:y})})}catch(M){throw I&&I(),M&&M.name==="TypeError"&&/fetch/i.test(M.message)?Object.assign(new Ze("Network Error",Ze.ERR_NETWORK,t,y),{cause:M.cause||M}):Ze.from(M,M&&M.code,t,y)}});const EM={http:null,xhr:lK,fetch:gK};wt.forEach(EM,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const gM=t=>"- ".concat(t),SK=t=>wt.isFunction(t)||t===null||t===!1;var SM=t=>{t=wt.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let o=0;o<e;o++){let c;if(n=t[o],i=n,!SK(n)&&(i=EM[(c=String(n)).toLowerCase()],i===void 0))throw new Ze("Unknown adapter '".concat(c,"'"));if(i)break;r[c||"#"+o]=i}if(!i){const o=Object.entries(r).map(c=>{let[l,d]=c;return"adapter ".concat(l," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new Ze("There is no suitable adapter to dispatch the request "+(e?o.length>1?`since :
`+o.map(gM).join(`
`):" "+gM(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i};function CI(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Sm(null,t)}function TM(t){return CI(t),t.headers=va.from(t.headers),t.data=SI.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),SM(t.adapter||EI.adapter)(t).then(function(e){return CI(t),e.data=SI.call(t,t.transformResponse,e),e.headers=va.from(e.headers),e},function(e){return eM(e)||(CI(t),e&&e.response&&(e.response.data=SI.call(t,t.transformResponse,e.response),e.response.headers=va.from(e.response.headers))),At.reject(e)})}const TK="1.7.9",wR={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{wR[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const vM={};wR.transitional=function(t,e,n){function i(r,o){return"[Axios v1.7.9] Transitional option '"+r+"'"+o+(n?". "+n:"")}return(r,o,c)=>{if(t===!1)throw new Ze(i(o," has been removed"+(e?" in "+e:"")),Ze.ERR_DEPRECATED);return e&&!vM[o]&&(vM[o]=!0,console.warn(i(o," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,o,c)}},wR.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var IR={assertOptions:function(t,e,n){if(typeof t!="object")throw new Ze("options must be an object",Ze.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const o=i[r],c=e[o];if(c){const l=t[o],d=l===void 0||c(l,o,t);if(d!==!0)throw new Ze("option "+o+" must be "+d,Ze.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Ze("Unknown option "+o,Ze.ERR_BAD_OPTION)}},validators:wR};const yc=IR.validators;let OR=class{constructor(t){this.defaults=t,this.interceptors={request:new CL,response:new CL}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=Uh(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:r}=e;n!==void 0&&IR.assertOptions(n,{silentJSONParsing:yc.transitional(yc.boolean),forcedJSONParsing:yc.transitional(yc.boolean),clarifyTimeoutError:yc.transitional(yc.boolean)},!1),i!=null&&(wt.isFunction(i)?e.paramsSerializer={serialize:i}:IR.assertOptions(i,{encode:yc.function,serialize:yc.function},!0)),IR.assertOptions(e,{baseUrl:yc.spelling("baseURL"),withXsrfToken:yc.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=r&&wt.merge(r.common,r[e.method]);r&&wt.forEach(["delete","get","head","post","put","patch","common"],y=>{delete r[y]}),e.headers=va.concat(o,r);const c=[];let l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(e)===!1||(l=l&&y.synchronous,c.unshift(y.fulfilled,y.rejected))});const d=[];let p;this.interceptors.response.forEach(function(y){d.push(y.fulfilled,y.rejected)});let f,S=0;if(!l){const y=[TM.bind(this),void 0];for(y.unshift.apply(y,c),y.push.apply(y,d),f=y.length,p=At.resolve(e);S<f;)p=p.then(y[S++],y[S++]);return p}f=c.length;let v=e;for(S=0;S<f;){const y=c[S++],P=c[S++];try{v=y(v)}catch(I){P.call(this,I);break}}try{p=TM.call(this,v)}catch(y){return At.reject(y)}for(S=0,f=d.length;S<f;)p=p.then(d[S++],d[S++]);return p}getUri(t){return bL(sM((t=Uh(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};wt.forEach(["delete","get","head","options"],function(t){OR.prototype[t]=function(e,n){return this.request(Uh(n||{},{method:t,url:e,data:(n||{}).data}))}}),wt.forEach(["post","put","patch"],function(t){function e(n){return function(i,r,o){return this.request(Uh(o||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}OR.prototype[t]=e(),OR.prototype[t+"Form"]=e(!0)});var NR=OR;class AI{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new At(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let o=i._listeners.length;for(;o-- >0;)i._listeners[o](r);i._listeners=null}),this.promise.then=r=>{let o;const c=new At(l=>{i.subscribe(l),o=l}).then(r);return c.cancel=function(){i.unsubscribe(o)},c},e(function(r,o,c){i.reason||(i.reason=new Sm(r,o,c),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new AI(function(i){e=i}),cancel:e}}}var vK=AI;const wI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(wI).forEach(t=>{let[e,n]=t;wI[n]=e});var yK=wI;const er=function t(e){const n=new NR(e),i=oL(NR.prototype.request,n);return wt.extend(i,NR.prototype,n,{allOwnKeys:!0}),wt.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return t(Uh(e,r))},i}(EI);er.Axios=NR,er.CanceledError=Sm,er.CancelToken=vK,er.isCancel=eM,er.VERSION=TK,er.toFormData=lR,er.AxiosError=Ze,er.Cancel=er.CanceledError,er.all=function(t){return At.all(t)},er.spread=function(t){return function(e){return t.apply(null,e)}},er.isAxiosError=function(t){return wt.isObject(t)&&t.isAxiosError===!0},er.mergeConfig=Uh,er.AxiosHeaders=va,er.formToJSON=t=>$k(wt.isHTMLForm(t)?new FormData(t):t),er.getAdapter=SM,er.HttpStatusCode=yK,er.default=er;var Or=er;const RK=()=>{};function Ug(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:RK};return t.promise=new At((e,n)=>{t.resolve=i=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(i),t.value=i)},t.reject=i=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(i))}}),t}const DR=new Map,PR=new Map,Rc=new Map;let _i=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),He=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const yM=new WH;let ya=yM.getResult(),II=null;function Me(t){if(!II){ya=yM.getResult();const e=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return He.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return He.CHROME;case"Safari":case"Mobile Safari":return He.SAFARI;case"Edge":return He.EDGE;case"Firefox":return He.FIREFOX;case"QQ":case"QQBrowser":return He.QQ;case"Opera":return He.OPERA;case"WeChat":return He.WECHAT;default:return l.browser.name||""}}(ya),n=RM(ya),i=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(ya),r=ya.os.version,o=RM(ya,!1),c=ya.device.type;if(!(e&&n&&i&&r))return{name:e,version:n,os:i,osVersion:r,browserVersion:o,deviceType:c};II={name:e,version:n,os:i,osVersion:r,browserVersion:o,deviceType:c}}return II}function RM(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function LR(){return Me().os}function bM(){const t=Me();return"".concat(t.os," ").concat(t.osVersion)}function kR(){const t=Me();return!!(ya.engine.name==="WebKit"&&t.os===_i.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==He.SAFARI||_r()&&t.name!==He.SAFARI)}function Cl(){return Me().name===He.CHROME}function Mi(){return Me().name===He.SAFARI}function CM(){return Me().name===He.EDGE}function Ln(){return Me().name===He.FIREFOX}function _r(){return Me().os===_i.IOS}function Tm(t){const e=Me();return!(e.name!==He.CHROME||!e.osVersion)&&Number(e.version)>=t}function AM(t){const e=Me();return!(e.name!==He.CHROME||!e.osVersion)&&Number(e.version)<t}function OI(t,e,n){const i=Me();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}function NI(t){const e=Me();return!(e.name!==He.EDGE||!e.osVersion)&&Number(e.version)>=t}function wM(t){const e=Me();return!(e.name!==He.SAFARI||!e.osVersion)&&Number(e.version)>=t}function IM(t,e,n){const i=Me();if(i.os!==_i.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t}function OM(t,e,n){const i=Me();if(i.name!==He.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}function DI(t){const e=Me();return!(e.name!==He.OPERA||!e.osVersion)&&Number(e.version)>=t}function NM(){const t=Me();if(t.os!==_i.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function vm(){const t=Me();if(t.os!==_i.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function PI(){const t=Me();if(t.os!==_i.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function DM(){const t=Me();if(t.os!==_i.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function xo(){return Mi()&&navigator.maxTouchPoints>0}function PM(){return Me().name===He.WECHAT}function LM(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function LI(){const t=LR();return function(){const{deviceType:e}=Me();return e==="mobile"||e==="tablet"}()||t===_i.ANDROID||t===_i.IOS||t===_i.HARMONY_OS}function Al(){const t=Me();return t.name!==He.EDGE&&t.name!==He.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function MR(){return LR()===_i.ANDROID}function xg(){const t=Me();return MR()&&(t.name===He.CHROME||t.name===He.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function ie(t,e,n){return(e=function(i){var r=function(o){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var l=c.call(o,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function kM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ut(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?kM(Object(n),!0).forEach(function(i){ie(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let L=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({});class st extends Error{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),ie(this,"code",void 0),ie(this,"message",void 0),ie(this,"data",void 0),ie(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return e==="error"&&(n||console).error(this.toString()),e==="warning"&&(n||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}}function wl(t,e){if(typeof t!="boolean")throw new st(L.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function hi(t,e,n){if(!Ct(n).call(n,t))throw new st(L.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function $e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(t))throw new st(L.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function kI(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new st(L.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&$e(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&$e(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&$e(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&$e(t.ideal,"".concat(e,".ideal"),1,1/0)}else $e(t,e,1,1/0)}function Oi(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new st(L.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!MM(t,n,i,r))throw new st(L.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function Il(t,e){if(!Array.isArray(t))throw new st(L.INVALID_PARAMS,"".concat(e," should be an array"))}function Nn(t){return t==null}function MM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!i||function(r){if(typeof r!="string")return!1;for(let o=0;o<r.length;o+=1){const c=r.charCodeAt(o);if(c<0||c>255)return!1}return!0}(t))}var Vg=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(Vg||{}),MI=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(MI||{});const UM=new class{constructor(){ie(this,"_clientSize",null),ie(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),ie(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),ie(this,"getStyle",t=>window.getComputedStyle(t,null)),ie(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const i=this.getStyle(t),{display:r,visibility:o,opacity:c,filter:l}=i;return(r==="none"||Ct(e=["hidden","collapse"]).call(e,o)||Number(c)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(d=>{var p;const f=d.split("(")[0];return Ct(p=["brightness","blur","opacity"]).call(p,f)}).map(d=>{const[p,f]=d.split(/\(|\)/);return[p,Number(f.match(/^[0-9\.]+/))]}).forEach(d=>{const[p,f]=d;switch(p){case"brightness":(f<.1||f>3)&&(n=!1);break;case"blur":f>3&&(n=!1);break;case"opacity":f<.1&&(n=!1)}}),n)}),ie(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,i=!0;const r=c=>e(c);let o=t;for(;o&&i;)r(o)||(n=!1,i=!1),o=o.parentElement,o||(i=!1);return n}),ie(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),ie(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:i,right:r,top:o,bottom:c}=t.getBoundingClientRect(),l=this.getClientWidth(),d=this.getClientHeight();return{width:e,height:n,left:i,right:r,top:o,bottom:c,clientWidth:l,clientHeight:d,clientMin:Math.min(l,d)}}),ie(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),ie(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),ie(this,"checkCoverForAPoint",(t,e,n)=>{const i=this.elementFromPoint(t,e);return i!==null&&i!==n}),ie(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,r=t/6,o=e/6,c=[],l=10**6;for(let d=0;d<5;d++)for(let p=0;p<5;p++){const f=(n*l+(d===0?.1:d===4?(r*d*l-1e5)/l:r*d)*l)/l,S=(i*l+(p===0?.1:p===4?(o*p*l-1e5)/l:o*p)*l)/l;c.push({x:f,y:S})}return[...c]}),ie(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),ie(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),ie(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:r,clientWidth:o,clientMin:c}=this._clientSize;let l,d,p,f;if(t<0)l=0;else{if(!(t<o))return!1;l=t}if(e<0)return!1;if(d=e<o?e:o,n<0)p=0;else{if(!(n<r))return!1;p=n}if(i<0)return!1;f=i<r?i:r;const S=d-l,v=f-p;return this.checkSizeIsVisible(S,v,c)}),ie(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),ie(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Vg.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(Vg.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Vg.SIZE)}}return this.returnHiddenResult(Vg.STYLE)}return this.returnHiddenResult(MI.UNMOUNTED)}return this.returnHiddenResult(MI.INVALID_HTML_ELEMENT)}),ie(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function UI(t){return new TextEncoder().encode(t)}const xM=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},xI=async t=>function(e,n){let i="";return new Uint8Array(e).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",UI(t)),16);let An=class{constructor(){ie(this,"_events",{}),ie(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],i=this._indexOfListener(n,e);i!==-1&&n.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(o=>o);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(let o=0;o<e.length;o+=1){const c=e[o];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];[...this._events[t]||[]].forEach(r=>{r.once&&this.off(t,r.listener);try{r.listener.apply(this,n)}catch(o){console.error("safeEmit event:".concat(t," error ").concat(o==null?void 0:o.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},Bg=null;function VM(){if(Bg)return Bg;if(window.electron)return Bg=window.electron;if(!window.require)return null;try{return Bg=window.require("electron"),Bg}catch{return null}}let ii=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),Dn=function(t){return t.TRACER="tracer",t}({});function BM(t){return $e(t.timeout,"config.timeout",0,1e5),$e(t.timeoutFactor,"config.timeoutFactor",0,100,!1),$e(t.maxRetryCount,"config.maxRetryConfig",0,1/0),$e(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let bK=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),ze=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function jg(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function jM(t){return Oi(t.turnServerURL,"turnServerURL"),Oi(t.username,"username"),Oi(t.password,"password"),t.udpport&&$e(t.udpport,"udpport",1,99999,!0),t.forceturn&&wl(t.forceturn,"forceturn"),t.security&&wl(t.security,"security"),t.tcpport&&$e(t.tcpport,"tcpport",1,99999,!0),!0}function VI(t){return t.level!==void 0&&hi(t.level,"level",[1,2,3]),t.delay!==void 0&&$e(t.delay,"delay",0,3e3,!0),!0}let ye=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Ui=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),hs=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),ym=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function xi(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return t.getListeners(e).length===0?At.reject(new st(L.UNEXPECTED_ERROR,"can not emit promise")):new At((o,c)=>{t.emit(e,...i,o,c)})}function cn(t,e){if(t.getListeners(e).length===0)return At.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return xi(t,e,...i)}function Is(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return Fg(t,e,...i)}function Fg(t,e){let n=null,i=null;for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];if(t.emit(e,...o,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new st(L.UNEXPECTED_ERROR,"handler is not sync");return n}const Xn=new class extends An{set networkState(t){this.emit(ym.NETWORK_STATE_CHANGE,t,this._networkState),t===hs.ONLINE?this.emit(ym.ONLINE):t===hs.OFFLINE&&(this.onlineWaiter=new At(e=>{this.once(ym.ONLINE,()=>{this.onlineWaiter=void 0,e(hs.ONLINE)})}),this.emit(ym.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===hs.ONLINE}constructor(){super(),ie(this,"_moduleName","network-indicator"),ie(this,"_networkState",hs.ONLINE),ie(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=hs.ONLINE}),window.addEventListener("offline",()=>{this.networkState=hs.OFFLINE})}};function UR(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function Rm(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function xR(t){At!==void 0?At.resolve().then(t):setTimeout(t,0)}function kn(t){return JSON.parse(JSON.stringify(t))}function xh(t){try{return kn(t)}catch{return t}}const FM={};function Gu(t,e){FM[e]||(FM[e]=!0,t())}function Vh(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return n}function Hu(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function GM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const i=new Uint8Array(e);i.set(n),n=i}return n}function HM(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=Hi(e).call(e,(c,l)=>c+l.length,0),r=new Uint8Array(new ArrayBuffer(i));let o=0;return e.forEach(c=>{r.set(c,o),o+=c.length}),r}function bc(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function WM(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?bc(n):n.size}),e+138}function CK(t){const e=new st(L.TIMEOUT,"timeout");return new At((n,i)=>{window.setTimeout(()=>i(e),t)})}function Ni(t){return new At(e=>{window.setTimeout(e,t)})}function ln(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+ln(t-n.length,"")}function Bh(){return ln(32,"").toUpperCase()}const VR=()=>{},KM=new class{constructor(){ie(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var r=arguments.length,o=new Array(r>4?r-4:0),c=4;c<r;c++)o[c-4]=arguments[c];if(this.fnMap.has(e)){const l=this.fnMap.get(e);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const d=window.setTimeout(()=>{const p=this.fnMap.get(e);p&&p.fn(...p.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:d,args:o,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(e,Ut(Ut({},l),{},{fn:t,args:o,skipFn:i}))}else{const l=window.setTimeout(()=>{const d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:l,args:o,skipFn:i})}}},zM=KM.throttleByKey.bind(KM);function YM(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function BI(t,e){if(!YM(t)||!YM(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=BI(t[i],e[i]);return n}{const n=Ut({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=BI(t[i],e[i]):n[i]=e[i]);return n}}function qM(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let i=0;for(;t>0&&(n[i]=255&t,t>>=8,i++,i!==e););return n}function jI(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function XM(t){const e="0123456789abcdef";function n(W){let Q,X="";for(Q=0;Q<=3;Q++)X+=e.charAt(W>>8*Q+4&15)+e.charAt(W>>8*Q&15);return X}function i(W,Q){const X=(65535&W)+(65535&Q);return(W>>16)+(Q>>16)+(X>>16)<<16|65535&X}function r(W,Q,X,Y,ot,Et){return i(function(Ot,Lt){return Ot<<Lt|Ot>>>32-Lt}(i(i(Q,W),i(Y,Et)),ot),X)}function o(W,Q,X,Y,ot,Et,Ot){return r(Q&X|~Q&Y,W,Q,ot,Et,Ot)}function c(W,Q,X,Y,ot,Et,Ot){return r(Q&Y|X&~Y,W,Q,ot,Et,Ot)}function l(W,Q,X,Y,ot,Et,Ot){return r(Q^X^Y,W,Q,ot,Et,Ot)}function d(W,Q,X,Y,ot,Et,Ot){return r(X^(Q|~Y),W,Q,ot,Et,Ot)}const p=function(W){let Q;const X=1+(W.length+8>>6),Y=new Array(16*X);for(Q=0;Q<16*X;Q++)Y[Q]=0;for(Q=0;Q<W.length;Q++)Y[Q>>2]|=W.charCodeAt(Q)<<Q%4*8;return Y[Q>>2]|=128<<Q%4*8,Y[16*X-2]=8*W.length,Y}(t);let f,S,v,y,P,I=1732584193,O=-271733879,M=-1732584194,U=271733878;for(f=0;f<p.length;f+=16)S=I,v=O,y=M,P=U,I=o(I,O,M,U,p[f+0],7,-680876936),U=o(U,I,O,M,p[f+1],12,-389564586),M=o(M,U,I,O,p[f+2],17,606105819),O=o(O,M,U,I,p[f+3],22,-1044525330),I=o(I,O,M,U,p[f+4],7,-176418897),U=o(U,I,O,M,p[f+5],12,1200080426),M=o(M,U,I,O,p[f+6],17,-1473231341),O=o(O,M,U,I,p[f+7],22,-45705983),I=o(I,O,M,U,p[f+8],7,1770035416),U=o(U,I,O,M,p[f+9],12,-1958414417),M=o(M,U,I,O,p[f+10],17,-42063),O=o(O,M,U,I,p[f+11],22,-1990404162),I=o(I,O,M,U,p[f+12],7,1804603682),U=o(U,I,O,M,p[f+13],12,-40341101),M=o(M,U,I,O,p[f+14],17,-1502002290),O=o(O,M,U,I,p[f+15],22,1236535329),I=c(I,O,M,U,p[f+1],5,-165796510),U=c(U,I,O,M,p[f+6],9,-1069501632),M=c(M,U,I,O,p[f+11],14,643717713),O=c(O,M,U,I,p[f+0],20,-373897302),I=c(I,O,M,U,p[f+5],5,-701558691),U=c(U,I,O,M,p[f+10],9,38016083),M=c(M,U,I,O,p[f+15],14,-660478335),O=c(O,M,U,I,p[f+4],20,-405537848),I=c(I,O,M,U,p[f+9],5,568446438),U=c(U,I,O,M,p[f+14],9,-1019803690),M=c(M,U,I,O,p[f+3],14,-187363961),O=c(O,M,U,I,p[f+8],20,1163531501),I=c(I,O,M,U,p[f+13],5,-1444681467),U=c(U,I,O,M,p[f+2],9,-51403784),M=c(M,U,I,O,p[f+7],14,1735328473),O=c(O,M,U,I,p[f+12],20,-1926607734),I=l(I,O,M,U,p[f+5],4,-378558),U=l(U,I,O,M,p[f+8],11,-2022574463),M=l(M,U,I,O,p[f+11],16,1839030562),O=l(O,M,U,I,p[f+14],23,-35309556),I=l(I,O,M,U,p[f+1],4,-1530992060),U=l(U,I,O,M,p[f+4],11,1272893353),M=l(M,U,I,O,p[f+7],16,-155497632),O=l(O,M,U,I,p[f+10],23,-1094730640),I=l(I,O,M,U,p[f+13],4,681279174),U=l(U,I,O,M,p[f+0],11,-358537222),M=l(M,U,I,O,p[f+3],16,-722521979),O=l(O,M,U,I,p[f+6],23,76029189),I=l(I,O,M,U,p[f+9],4,-640364487),U=l(U,I,O,M,p[f+12],11,-421815835),M=l(M,U,I,O,p[f+15],16,530742520),O=l(O,M,U,I,p[f+2],23,-995338651),I=d(I,O,M,U,p[f+0],6,-198630844),U=d(U,I,O,M,p[f+7],10,1126891415),M=d(M,U,I,O,p[f+14],15,-1416354905),O=d(O,M,U,I,p[f+5],21,-57434055),I=d(I,O,M,U,p[f+12],6,1700485571),U=d(U,I,O,M,p[f+3],10,-1894986606),M=d(M,U,I,O,p[f+10],15,-1051523),O=d(O,M,U,I,p[f+1],21,-2054922799),I=d(I,O,M,U,p[f+8],6,1873313359),U=d(U,I,O,M,p[f+15],10,-30611744),M=d(M,U,I,O,p[f+6],15,-1560198380),O=d(O,M,U,I,p[f+13],21,1309151649),I=d(I,O,M,U,p[f+4],6,-145523070),U=d(U,I,O,M,p[f+11],10,-1120210379),M=d(M,U,I,O,p[f+2],15,718787259),O=d(O,M,U,I,p[f+9],21,-343485551),I=i(I,S),O=i(O,v),M=i(M,y),U=i(U,P);return n(I)+n(O)+n(M)+n(U)}let AK=1,JM=console,zi=class{static setLogger(t){JM=t}constructor(t,e){ie(this,"id",void 0),ie(this,"lockingPromise",At.resolve()),ie(this,"locks",0),ie(this,"name",""),ie(this,"lockId",void 0),this.lockId=AK++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");JM.debug("".concat(n," ").concat(i))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new At(r=>{e=()=>{this.locks-=1,this.logger("unlocked",t),r()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function bm(t,e){return function(n,i,r){const o=r.value;if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this[e];if(!c)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const l=await c.lock("From ".concat(t,".").concat(i));try{for(var d=arguments.length,p=new Array(d),f=0;f<d;f++)p[f]=arguments[f];return await o.apply(this,p)}finally{l()}},r}}const ri={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function FI(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function Ra(t,e,n,i){const r=Object.assign({},ri,i);let o=r.timeout;const c=async()=>{await function(p){return new At(f=>{window.setTimeout(f,p)})}(o),o*=r.timeoutFactor,o=Math.min(r.maxRetryTimeout,o)};let l=!1;const d=new At(async(p,f)=>{e=e||(()=>!1),n=n||(()=>!0);for(let S=0;S<r.maxRetryCount;S+=1){if(l)return f(new st(L.OPERATION_ABORTED));try{const v=await t();if(!e(v,S)||S+1===r.maxRetryCount)return p(v);await c()}catch(v){if(!n(v,S)||S+1===r.maxRetryCount)return f(v);await c()}}});return d.cancel=()=>l=!0,d}let BR,QM=class{constructor(t){ie(this,"input",[]),ie(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Hi(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},jR=0,GI=0;function HI(t,e,n,i){return new At((r,o)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),jR+=bc(e.data)):n&&(e.data.size?jR+=e.data.size:e.data instanceof FormData?jR+=WM(e.data):jR+=bc(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Or.request(e).then(c=>{typeof c.data=="string"?GI+=bc(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?GI+=c.data.byteLength:GI+=bc(JSON.stringify(c.data)),r(c.data)}).catch(c=>{Or.isCancel(c)?o(new st(L.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?o(new st(L.NETWORK_TIMEOUT,c.message)):c.response?o(new st(L.NETWORK_RESPONSE_ERROR,c.response.status)):o(new st(L.NETWORK_ERROR,c.message))})})}async function wK(t,e){const n=new Blob([e.data],{type:"buffer"});return await HI(t,Ut(Ut({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const ZM=()=>window.isSecureContext!==void 0;function Vo(t){if(Array.isArray(t))return t.map(n=>n);if(!$M(t))return t;const e={};for(const n in t){const i=t[n];$M(i)||Array.isArray(i)?e[n]=Vo(i):e[n]=i}return e}function $M(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let WI=class{constructor(t){ie(this,"input",[]),ie(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Cc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Gg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Cc,remoteCandidate:Cc},updateInterval:0},t1={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},e1={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},n1={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},i1={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};let KI=class{constructor(t,e){ie(this,"onFirstVideoReceived",void 0),ie(this,"onFirstVideoDecoded",void 0),ie(this,"onFirstAudioReceived",void 0),ie(this,"onFirstVideoDecodedTimeout",void 0),ie(this,"onFirstAudioDecoded",void 0),ie(this,"onSelectedLocalCandidateChanged",void 0),ie(this,"onSelectedRemoteCandidateChanged",void 0),ie(this,"videoIsReady",!1),ie(this,"videoIsReady2",{}),ie(this,"pc",void 0),ie(this,"options",void 0),ie(this,"intervalTimer",void 0),ie(this,"stats",Vo(Gg)),ie(this,"isFirstVideoReceived",{}),ie(this,"isFirstVideoDecoded",{}),ie(this,"isFirstAudioReceived",{}),ie(this,"isFirstAudioDecoded",{}),ie(this,"isFirstVideoDecodedTimeout",{}),ie(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new At(t=>{t({local:Ut({},Cc),remote:Ut({},Cc)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,o=0,c=0;for(const l of n)t[l].forEach((d,p)=>{if(!this.lossRateWindowStats[e-1][l][p]||!this.lossRateWindowStats[0][l][p])return;const f=this.lossRateWindowStats[e-1][l][p].packets-this.lossRateWindowStats[0][l][p].packets,S=this.lossRateWindowStats[e-1][l][p].packetsLost-this.lossRateWindowStats[0][l][p].packetsLost;l==="videoSend"||l==="audioSend"?(i+=f,o+=S):(r+=f,c+=S),Number.isNaN(f)||Number.isNaN(f)?d.packetLostRate=0:d.packetLostRate=f<=0||S<=0?0:S/(f+S)});t.sendPacketLossRate=i<=0||o<=0?0:o/(i+o),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}},IK=class extends KI{constructor(){super(...arguments),ie(this,"_stats",Gg),ie(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=Vo(Gg);const n=e.filter(r=>r.type==="ssrc");this.processSSRCStats(n);const i=e.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const i=Ct(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const r=Vo(e1);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=Vo(t1),o=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),o){const c=o.stats,l=Date.now()-o.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(o.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<o.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Ut({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=Vo(i1);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=Vo(n1);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new At((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(r=>{i[r]=n.stat(r)}),e.push(i)}),e}},Hg=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),FR=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),zI=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),Os=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Cm=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Cm||{});function Wg(t,e,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Cm.kNone;if(!e)return;const o=Number(e[n]);if(typeof o!="number")return;const c=Number(e[i]);if(typeof c!="number")return;if(!t)return c?o/c*r:void 0;const l=Number(t[n]);if(typeof l!="number")return;const d=Number(t[i]);if(typeof d!="number")return;const p=c-d;return p?(o-l)/p*r:void 0}let r1=class extends KI{constructor(){super(...arguments),ie(this,"_stats",Gg),ie(this,"report",void 0),ie(this,"lastDecodeVideoReceiverStats",new Map),ie(this,"lastVideoFramesRecv",new Map),ie(this,"lastVideoFramesSent",new Map),ie(this,"lastVideoFramesDecode",new Map),ie(this,"lastVideoFramesOutput",new Map),ie(this,"lastVideoJBDelay",new Map),ie(this,"lastAudioJBDelay",new Map),ie(this,"mediaBytesSent",new Map),ie(this,"mediaBytesRetransmit",new Map),ie(this,"mediaBytesTargetEncode",new Map),ie(this,"lastDecodeAudioReceiverStats",new Map),ie(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Vo(Gg),this.report.forEach(t=>{switch(t.type){case Os.OUTBOUND:case Os.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===Os.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===Os.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case Os.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case Os.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:Ut({},Cc),remote:Ut({},Cc)};return t.forEach(n=>{let i;if(n.type===Os.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===Os.CANDIDATE_PAIR&&n.selected&&(i=n),i){const r=(o,c)=>{o.type=c.type,o.id=c.id,c.address&&(o.address=c.address),c.candidateType&&(o.candidateType=c.candidateType),c.port&&(o.port=c.port),c.priority&&(o.priority=c.priority),c.protocol&&(o.protocol=c.protocol),c.relayProtocol&&(o.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const o=t.get(i.localCandidateId);o&&r(e.local,o)}if(i.remoteCandidateId){const o=t.get(i.remoteCandidateId);o&&r(e.remote,o)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===Os.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===Os.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===Os.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ut({},e),Ut({},this.stats.selectedCandidatePair.localCandidate)),t.type===Os.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ut({},e),Ut({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=Vo(i1),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=Wg(n,e,"totalProcessingDelay","jitterBufferEmittedCount",Cm.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,Ut({},e))}processVideoInboundStats(t){let e=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);e||(e=Vo(t1),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=this.lastVideoFramesOutput.get(e.ssrc),o=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const c=e.decodedFrame?e.decodedFrame.width:0,l=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,c,l),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const c=n.stats,l=o-n.lts;e.framesDecodeFreezeTime=c.framesDecodeFreezeTime,e.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=l,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<c.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=Wg(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=Wg(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",Cm.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=Wg(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",Cm.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=Wg(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",Cm.kMillisecondsFromSeconds),i&&o-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:o,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:o,rate:0}),e.framesDroppedCount&&t.framesReceived&&(r&&o-r.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-r.count)/((o-r.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:o,rate:Math.max(e.outputFrameRate,0)})):r?e.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:Ut({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);e||(e=Vo(e1),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new WI(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const r=new WI(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const r=new WI(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-i.lastFrameCount,o=t.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*o/r}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,Os.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=Vo(n1),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,Os.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(or(n=this.report).call(n)).find(r=>r.type===e&&r.ssrc===t);return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,r,o,c;const l=e?this.report.get(e):void 0,d=(i=l==null?void 0:l.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof d!="number")return;let p=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,f=(o=l==null?void 0:l.frameHeight)!==null&&o!==void 0?o:t.frameHeight,S=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof p=="number"&&typeof f=="number"||(p=0,f=0),S==null){const v=Date.now(),y=this.lastVideoFramesSent.get(n.ssrc);y&&v-y.lts>=800?(S=Math.round((d-y.count)/((v-y.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:v,rate:S})):y?S=y.rate:this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:v,rate:0})}n.sentFrame={width:p,height:f,frameRate:Math.max(0,S)}}processVideoTrackReceiverStats(t,e,n){var i,r,o,c,l;const d=e?this.report.get(e):void 0,p=(i=d==null?void 0:d.framesReceived)!==null&&i!==void 0?i:t.framesReceived,f=(r=d==null?void 0:d.frameWidth)!==null&&r!==void 0?r:t.frameWidth,S=(o=d==null?void 0:d.frameHeight)!==null&&o!==void 0?o:t.frameHeight,v=(c=d==null?void 0:d.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,y=(l=d==null?void 0:d.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof p=="number"){const P=this.lastVideoFramesRecv.get(n.ssrc),I=Date.now();n.framesReceivedCount=p;let O=0;P&&I-P.lts>=800?(O=Math.round((p-P.count)/((I-P.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:I,rate:O})):P?O=P.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:I,rate:0}),n.receivedFrame={width:f||0,height:S||0,frameRate:O||0},n.decodedFrame={width:f||0,height:S||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:f||0,height:S||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(v&&y){const P=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=P.jitterBufferMs;const O=y-P.jitterBufferEmittedCount;O>0&&(I=1e3*(v-P.jitterBufferDelay)/O),n.jitterBufferMs=I,n.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:v,jitterBufferEmittedCount:y,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,r,o,c;const l=e?this.report.get(e):void 0,d=(i=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&i!==void 0?i:0,p=(o=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;n.aecReturnLoss=d,n.aecReturnLossEnhancement=p}processAudioTrackReceiverStats(t,e,n){var i,r,o,c,l,d,p;const f=e?this.report.get(e):void 0,S=(i=f==null?void 0:f.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,v=(r=f==null?void 0:f.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,y=(o=f==null?void 0:f.jitterBufferDelay)!==null&&o!==void 0?o:t.jitterBufferDelay,P=(c=f==null?void 0:f.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,I=(l=f==null?void 0:f.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,O=(d=f==null?void 0:f.totalSamplesDuration)!==null&&d!==void 0?d:t==null?void 0:t.totalSamplesDuration,M=(p=f==null?void 0:f.concealedSamples)!==null&&p!==void 0?p:t.concealedSamples;if(S&&v&&(n.accelerateRate=S/v),y&&P){const W=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Q=W.jitterBufferMs;const X=P-W.jitterBufferEmittedCount;X>0&&(Q=1e3*(y-W.jitterBufferDelay)/X),n.jitterBufferMs=Math.round(Q),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:y,jitterBufferEmittedCount:P,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=I;let U=1920;O&&v&&(U=v/O/50,n.receivedFrames=Math.round(v/U)),M&&(n.droppedFrames=Math.round(M/U))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{n=n===null?r.diffMean():n+r.diffMean()});const i=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},OK=class extends KI{updateStats(){return At.resolve()}};function YI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const o=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return o?o<76?new IK(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new r1(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(c){if(!window.RTCStatsReport)return!1;const l=c.getStats();return!!(l instanceof At||function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"}(l))}(t)?new r1(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new OK(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}const s1="websdk_ng_install_id";function qI(){try{if(j("INSTALL_ID"))return j("INSTALL_ID");let t=window.localStorage.getItem(s1);return t||(t=Bh(),window.localStorage.setItem(s1,t)),Je("INSTALL_ID",t),t}catch{return}}const Js=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],i=e[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.23.1"),XI=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let jh=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Vi=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let l=0;l<6;l++)r.push("1");const o=r.join(""),c={};return c[t]=i,c[e]=o,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Vi;const GR={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},JI={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},QI="v4.23.1-0-gea45199f-dirty(1/16/2025, 3:18:04 PM)",ZI={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"]},wn=Ut(Ut(Ut({},ZI),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:JI,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},GR),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Je(t,e,n){var i,r,o;Ct(i=Object.keys(wn)).call(i,t)&&(!n&&Ct(r=Object.keys(ba)).call(r,t)||(wn[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"||e!==!0||(wn.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&e&&(o=!!e,wn.USE_NEW_NETWORK_CONFIG=o,o&&(wn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],wn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],wn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],wn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],wn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",wn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",wn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(wn.ENABLE_INSTANT_VIDEO=!0,wn.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(wn.ENABLE_AUT_CC=!0)))}function j(t){return wn[t]}XI||(wn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],wn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],wn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],wn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],wn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],wn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],wn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",wn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",wn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",wn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",wn.AREAS=["NORTH_AMERICA","OVERSEA"]);let o1=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const ba={};var Re=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(Re||{});let NK=class{constructor(t,e,n,i){ie(this,"state",void 0),this.state={codec:t,audioCodec:e,mode:n,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:jh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(t){this.state=function(e,n){switch(n.type){case Re.SET_SESSION_ID:return Ut(Ut({},e),{},{sessionId:n.sessionId});case Re.SET_P2P_ID:return Ut(Ut({},e),{},{p2pId:n.p2pId});case Re.SET_UID:return Ut(Ut({},e),{},{uid:n.uid});case Re.SET_INT_UID:return Ut(Ut({},e),{},{intUid:n.intUid});case Re.SET_PUB_ID:return Ut(Ut({},e),{},{pubId:n.pubId});case Re.KEY_METRIC_CLIENT_CREATED:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{clientCreated:n.metric})});case Re.KEY_METRIC_JOIN_START:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{joinStart:n.metric})});case Re.AVOID_JOIN_START:return Ut(Ut({},e),{},{avoidJoinStart:n.avoidJoinStart});case Re.KEY_METRIC_JOIN_END:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{joinEnd:n.metric})});case Re.KEY_METRIC_REQUEST_AP_START:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{requestAPStart:n.metric})});case Re.KEY_METRIC_REQUEST_AP_END:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{requestAPEnd:n.metric})});case Re.KEY_METRIC_JOIN_GATEWAY_START:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{joinGatewayStart:n.metric})});case Re.KEY_METRIC_JOIN_GATEWAY_END:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{joinGatewayEnd:n.metric})});case Re.KEY_METRIC_PEER_CONNECTION_START:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{peerConnectionStart:n.metric})});case Re.KEY_METRIC_PEER_CONNECTION_END:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{peerConnectionEnd:n.metric})});case Re.KEY_METRIC_DESCRIPTION_START:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{descriptionStart:n.metric})});case Re.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{signalChannelOpen:n.metric})});case Re.KEY_METRIC_ICE_CONNECTION_END:return Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{iceConnectionEnd:n.metric})});case Re.KEY_METRIC_PUBLISH:{const i=e.keyMetrics.publish,r=i.findIndex(o=>o.trackId===n.metric.trackId);return r!==-1?(i[r]=Ut(Ut({},i[r]),n.metric),Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{publish:[...i]})})):Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,n.metric]})})}case Re.KEY_METRIC_SUBSCRIBE:{const i=e.keyMetrics.subscribe,r=i.findIndex(o=>o.userId===n.metric.userId&&o.type===n.metric.type);return r!==-1?(i[r]=Ut(Ut({},i[r]),n.metric),Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{subscribe:[...i]})})):Ut(Ut({},e),{},{keyMetrics:Ut(Ut({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,n.metric]})})}case Re.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=n.mode,e;case Re.RECORD_JOIN_CHANNEL_SERVICE:return typeof n.index!="number"?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,n.record]:(e.joinChannelServiceRecords[n.index]=Ut(Ut({},e.joinChannelServiceRecords[n.index]),n.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case Re.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case Re.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case Re.SET_USE_P2P:return Ut(Ut({},e),{},{useP2P:n.val});case Re.SET_TRANSPORT_TYPE:return Ut(Ut({},e),{},{p2pTransport:n.val});default:return e}}(this.state,t)}set sessionId(t){this.dispatch({type:Re.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set cid(t){this.state.cid=t}get cid(){return this.state.cid}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:Re.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:Re.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:Re.SET_UID,uid:t})}get uid(){return this.state.uid}set intUid(t){this.dispatch({type:Re.SET_INT_UID,intUid:t})}get intUid(){return this.state.intUid}set pubId(t){this.dispatch({type:Re.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:Re.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(t){this.dispatch({type:Re.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}set p2pTransport(t){this.dispatch({type:Re.SET_TRANSPORT_TYPE,val:t})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(t){this.state.hasStartJoinChannel=t}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(t){this.state.isABTestSuccess=t}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Re.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Re.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Re.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Re.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Re.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Re.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Re.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Re.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Re.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Re.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Re.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Re.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,e,n,i){this.dispatch({type:Re.KEY_METRIC_PUBLISH,metric:Ut(Ut({trackId:t,type:e},n&&{publishStart:n}),i&&{publishEnd:i})})}subscribe(t,e,n,i,r,o,c){this.dispatch({type:Re.KEY_METRIC_SUBSCRIBE,metric:Ut(Ut(Ut(Ut(Ut({userId:t,type:e},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),r&&{firstFrame:r}),o&&{streamAdded:o}),c&&{firstDecoded:c})})}massSubscribe(t,e,n,i){t.forEach(r=>{this.dispatch({type:Re.KEY_METRIC_SUBSCRIBE,metric:Ut(Ut(Ut({userId:r.userId,type:r.type},e&&{subscribeStart:e}),n&&{subscribeEnd:n}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,e){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(n=>n.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof e!="number"?(this.dispatch({type:Re.RECORD_JOIN_CHANNEL_SERVICE,record:Ut(Ut({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(e<0||e>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Re.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:e}),e)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Re.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Re.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:Re.AVOID_JOIN_START,avoidJoinStart:t})}},HR=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});let DK=0;var a1=(()=>{var t={8:(i,r,o)=>{o.r(r),o.d(r,{Parser:()=>Ot,Printer:()=>Kn,parse:()=>yt,print:()=>Gt});const c=`
`,l="".concat("\r").concat(c),d=" ";let p;function f(ft){return ft>="0"&&ft<="9"}function S(ft){return ft>="!"&&ft<="~"}function v(ft){return S(ft)||ft>=""&&ft<="ÿ"}function y(ft){return ft==="!"||ft>="#"&&ft<="'"||ft>="*"&&ft<="+"||ft>="-"&&ft<="."||ft>="0"&&ft<="9"||ft>="A"&&ft<="Z"||ft>="^"&&ft<="~"}function P(ft){return ft>="1"&&ft<="9"}function I(ft){return ft>="A"&&ft<="Z"||ft>="a"&&ft<="z"}function O(ft){return ft==="d"||ft==="h"||ft==="m"||ft==="s"}function M(ft){return ft>""&&ft<"	"||ft>"\v"&&ft<"\f"||ft>""&&ft<"ÿ"}function U(ft){return I(ft)||f(ft)||ft==="+"||ft==="/"}function W(ft){return f(ft)||I(ft)||ft==="+"||ft==="/"||ft==="-"||ft==="_"}function Q(ft){return I(ft)||f(ft)||ft==="+"||ft==="/"}function X(ft,A){var F=Object.keys(ft);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(ft);A&&(H=H.filter(function(St){return Object.getOwnPropertyDescriptor(ft,St).enumerable})),F.push.apply(F,H)}return F}function Y(ft){for(var A=1;A<arguments.length;A++){var F=arguments[A]!=null?arguments[A]:{};A%2?X(Object(F),!0).forEach(function(H){ot(ft,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ft,Object.getOwnPropertyDescriptors(F)):X(Object(F)).forEach(function(H){Object.defineProperty(ft,H,Object.getOwnPropertyDescriptor(F,H))})}return ft}function ot(ft,A,F){return A in ft?Object.defineProperty(ft,A,{value:F,enumerable:!0,configurable:!0,writable:!0}):ft[A]=F,ft}(function(ft){ft.VERSION="v",ft.ORIGIN="o",ft.SESSION_NAME="s",ft.INFORMATION="i",ft.URI="u",ft.EMAIL="e",ft.PHONE="p",ft.CONNECTION="c",ft.BANDWIDTH="b",ft.TIME="t",ft.REPEAT="r",ft.ZONE_ADJUSTMENTS="z",ft.KEY="k",ft.ATTRIBUTE="a",ft.MEDIA="m"})(p||(p={}));class Et{consumeText(A,F){let H=F;for(;H<A.length;){const St=A[H];if(St==="\0"||St==="\r"||St===c)break;H+=1}if(H-F==0)throw new Error("Invalid text, at ".concat(A));return H}consumeUnicastAddress(A,F,H){return this.consumeTill(A,F,d)}consumeOneOrMore(A,F,H){let St=F;for(;H(A[St]);)St++;if(St-F==0)throw new Error("Invalid rule at ".concat(F,"."));return St}consumeSpace(A,F){if(A[F]===d)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(A,F){let H=F;for(let St=0;St<4;St++)if(H=this.consumeDecimalUChar(A,H),St!==3){if(A[H]!==".")throw new Error("Invalid IP4 address.");H++}return H}consumeDecimalUChar(A,F){let H=F;for(let oe=0;oe<3&&f(A[H]);oe++,H++);if(H-F==0)throw new Error("Invalid decimal uchar.");const St=parseInt(A.slice(F,H));if(St>=0&&St<=255)return H;throw new Error("Invalid decimal uchar")}consumeIP6Address(A,F){let H=this.consumeHexpart(A,F);return A[H]===":"&&(H+=1,H=this.consumeIP4Address(A,H)),H}consumeHexpart(A,F){let H=F;if(A[H]===":"&&A[H+1]===":"){H+=2;try{H=this.consumeHexseq(A,H)}catch{}return H}if(H=this.consumeHexseq(A,H),A[H]===":"&&A[H+1]===":"){H+=2;try{H=this.consumeHexseq(A,H)}catch{}return H}return H}consumeHexseq(A,F){let H=F;for(;H=this.consumeHex4(A,H),A[H]===":"&&A[H+1]!==":";)H+=1;return H}consumeHex4(A,F){let H=0;for(;H<4;H++)if(!((St=A[F+H])>="0"&&St<="9"||St>="a"&&St<="f"||St>="A"&&St<="F")){if(H===0)throw new Error("Invalid hex 4");break}var St;return F+H}consumeFQDN(A,F){let H=F;for(;f(A[H])||I(A[H])||A[H]==="-"||A[H]===".";)H+=1;if(H-F<4)throw new Error("Invalid FQDN");return H}consumeExtnAddr(A,F){return this.consumeOneOrMore(A,F,v)}consumeMulticastAddress(A,F,H){switch(H){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(A,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(A,F);default:try{return this.consumeFQDN(A,F)}catch{return this.consumeExtnAddr(A,F)}}}consumeIP6MulticastAddress(A,F){const H=this.consumeHexpart(A,F);return A[H]==="/"?this.consumeInteger(A,H+1):H}consumeIP4MulticastAddress(A,F){let H=F+3;const St=A.slice(F,H),oe=parseInt(St);if(oe<224||oe>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let tn=0;tn<3;tn++){if(A[H]!==".")throw new Error("Invalid IP4 multicast address.");H+=1,H=this.consumeDecimalUChar(A,H)}return A[H]==="/"&&(H+=1),H=this.consumeTTL(A,H),A[H]==="/"&&(H=this.consumeInteger(A,H)),H}consumeInteger(A,F){if(!P(A[F]))throw new Error("Invalid integer.");for(F+=1;f(A[F]);)F+=1;return F}consumeTTL(A,F){if(A[F]==="0")return F+1;if(!P(A[F]))throw new Error("Invalid TTL.");F+=1;for(let H=0;H<2&&f(A[F]);H++)F+=1;return F}consumeToken(A,F){return this.consumeOneOrMore(A,F,y)}consumeTime(A,F){let H=F;if(A[H]==="0")return H+1;for(P(A[H])&&(H+=1);f(A[H]);)H++;if(H-F<10)throw new Error("Invalid time");return H}consumeAddress(A,F){return this.consumeTill(A,F,d)}consumeTypedTime(A,F){let H=F;return H=this.consumeOneOrMore(A,H,f),O(A[H])?H+1:H}consumeRepeatInterval(A,F){if(!P(A[F]))throw new Error("Invalid repeat interval");for(F+=1;f(A[F]);)F+=1;return O(A[F])&&(F+=1),F}consumePort(A,F){return this.consumeOneOrMore(A,F,f)}consume(A,F,H){for(let St=0;St<H.length;St++){if(F+St>=A.length)throw new Error("consume exceeding value length");if(A[F+St]!==H[St])throw new Error("consume ".concat(H," failed at ").concat(St))}return F+H.length}consumeTill(A,F,H){let St=F;for(;St<A.length&&(typeof H!="string"||A[St]!==H)&&(typeof H!="function"||!H(A[St]));)St++;return St}}class Ot extends Et{constructor(){super(),ot(this,"records",[]),ot(this,"currentLine",0)}parse(A){const F=this.probeEOL(A);this.records=A.split(F).filter(lp=>!!ar(lp).call(lp)).map(this.parseLine),this.currentLine=0;const H=this.parseVersion(),St=this.parseOrigin(),oe=this.parseSessionName(),tn=this.parseInformation(),Si=this.parseUri(),Jr=this.parseEmail(),Bl=this.parsePhone(),cp=this.parseConnection(),CS=this.parseBandWidth(),Zb=this.parseTimeFields(),$b=this.parseKey(),ro=this.parseSessionAttribute(),od=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:H,origin:St,sessionName:oe,information:tn,uri:Si,emails:Jr,phones:Bl,connection:cp,bandwidths:CS,timeFields:Zb,key:$b,attributes:ro,mediaDescriptions:od}}getCurrentRecord(){const A=this.records[this.currentLine];if(!A)throw new Error("Record doesn't exit.");return A}probeEOL(A){for(let F=0;F<A.length;F++)if(A[F]===c)return A[F-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(A,F){if(A.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const H=A[0];if(A[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:H,value:A.slice(2),line:F,cur:0}}parseSessionAttribute(){const A=new Ce;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==p.ATTRIBUTE)break;const H={attField:this.extractOneOrMore(F,St=>y(St)&&St!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,H.attValue=this.extractOneOrMore(F,M)),A.parse(H),this.currentLine++}return A.digest()}parseMediaAttributes(A){const F=new Ae(A);for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==p.ATTRIBUTE)break;const St={attField:this.extractOneOrMore(H,oe=>y(oe)&&oe!==":"),_cur:0};H.value[H.cur]===":"&&(H.cur+=1,St.attValue=this.extractOneOrMore(H,M)),F.parse(St),this.currentLine++}return F.digest()}parseKey(){const A=this.getCurrentRecord();if(A.type===p.KEY){if(A.value==="prompt"||A.value==="clear:"||A.value==="base64:"||A.value==="uri:")return A.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const A=this.getCurrentRecord();if(A.type===p.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const H=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);let St=!1;A.value[A.cur]==="-"&&(St=!0,A.cur+=1);const oe=this.extract(A,this.consumeTypedTime);F.push({time:H,typedTime:oe,back:St})}catch{break}if(F.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const A=[];for(;;){const F=this.getCurrentRecord();if(F.type!==p.REPEAT)break;{const H=this.extract(F,this.consumeRepeatInterval),St=this.parseTypedTime(F);A.push({repeatInterval:H,typedTimes:St}),this.currentLine++}}return A}parseTypedTime(A){const F=[];for(;;)try{this.consumeSpaceForRecord(A),F.push(this.extract(A,this.consumeTypedTime))}catch{break}if(F.length===0)throw new Error("Invalid typed time.");return F}parseTime(){const A=this.getCurrentRecord(),F=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);const H=this.extract(A,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:H}}parseBandWidth(){const A=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==p.BANDWIDTH)break;{const H=this.extractOneOrMore(F,y);if(F.value[F.cur]!==":")throw new Error("Invalid bandwidth field.");F.cur++;const St=this.extractOneOrMore(F,f);A.push({bwtype:H,bandwidth:St}),this.currentLine++}}return A}parseVersion(){const A=this.getCurrentRecord();if(A.type!==p.VERSION)throw new Error("first sdp record must be version");const F=A.value.slice(0,this.consumeOneOrMore(A.value,0,f));if(F.length!==A.value.length)throw new Error('invalid proto version, "v='.concat(A.value,'"'));return this.currentLine++,F}parseOrigin(){const A=this.getCurrentRecord();if(A.type!==p.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(A,v);this.consumeSpaceForRecord(A);const H=this.extractOneOrMore(A,f);this.consumeSpaceForRecord(A);const St=this.extractOneOrMore(A,f);this.consumeSpaceForRecord(A);const oe=this.extractOneOrMore(A,y);this.consumeSpaceForRecord(A);const tn=this.extractOneOrMore(A,y);this.consumeSpaceForRecord(A);const Si=this.extract(A,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:H,sessVersion:St,nettype:oe,addrtype:tn,unicastAddress:Si}}parseSessionName(){const A=this.getCurrentRecord();if(A.type===p.SESSION_NAME){const F=this.extract(A,this.consumeText);return this.currentLine++,F}}parseInformation(){const A=this.getCurrentRecord();if(A.type!==p.INFORMATION)return;const F=this.extract(A,this.consumeText);return this.currentLine++,F}parseUri(){const A=this.getCurrentRecord();if(A.type===p.URI)return this.currentLine++,A.value}parseEmail(){const A=[];for(;;){const F=this.getCurrentRecord();if(F.type!==p.EMAIL)break;A.push(F.value),this.currentLine++}return A}parsePhone(){const A=[];for(;;){const F=this.getCurrentRecord();if(F.type!==p.PHONE)break;A.push(F.value),this.currentLine++}return A}parseConnection(){const A=this.getCurrentRecord();if(A.type===p.CONNECTION){const F=this.extractOneOrMore(A,y);this.consumeSpaceForRecord(A);const H=this.extractOneOrMore(A,y);this.consumeSpaceForRecord(A);const St=this.extract(A,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:H,address:St}}}parseMedia(){const A=this.getCurrentRecord(),F=this.extract(A,this.consumeToken);this.consumeSpaceForRecord(A);let H=this.extract(A,this.consumePort);A.value[A.cur]==="/"&&(A.cur+=1,H+=this.extract(A,this.consumeInteger)),this.consumeSpaceForRecord(A);const St=[];for(St.push(this.extract(A,this.consumeToken));A.value[A.cur]==="/";)A.cur+=1,St.push(this.extract(A,this.consumeToken));if(St.length===0)throw new Error("Invalid proto");const oe=this.parseFmt(A);return this.currentLine++,{mediaType:F,port:H,protos:St,fmts:oe}}parseTimeFields(){const A=[];for(;this.getCurrentRecord().type===p.TIME;){const F=this.parseTime(),H=this.parseRepeat(),St=this.parseZone();A.push({time:F,repeats:H,zones:St})}return A}parseMediaDescription(){const A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.MEDIA;){const F=this.parseMedia(),H=this.parseInformation(),St=this.parseConnections(),oe=this.parseBandWidth(),tn=this.parseKey(),Si=this.parseMediaAttributes(F);A.push({media:F,information:H,connections:St,bandwidths:oe,key:tn,attributes:Si})}return A}parseConnections(){const A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.CONNECTION;)A.push(this.parseConnection());return A}parseFmt(A){const F=[];for(;;)try{this.consumeSpaceForRecord(A),F.push(this.extract(A,this.consumeToken))}catch{break}if(F.length===0)throw new Error("Invalid fmts");return F}extract(A,F){for(var H=arguments.length,St=new Array(H>2?H-2:0),oe=2;oe<H;oe++)St[oe-2]=arguments[oe];const tn=F.call(this,A.value,A.cur,...St),Si=A.value.slice(A.cur,tn);return A.cur=tn,Si}extractOneOrMore(A,F){const H=this.consumeOneOrMore(A.value,A.cur,F),St=A.value.slice(A.cur,H);return A.cur=H,St}consumeSpaceForRecord(A){if(A.value[A.cur]!==d)throw new Error("Invalid space at ".concat(A.cur,"."));A.cur+=1}}class Lt extends Et{constructor(){super(...arguments),ot(this,"attributes",void 0),ot(this,"digested",!1)}extractOneOrMore(A,F,H){const St=this.consumeOneOrMore(A.attValue,A._cur,F),oe=A.attValue.slice(A._cur,St),[tn,Si]=H||[];if(typeof tn=="number"&&oe.length<tn)throw new Error("error in length, should be more or equal than ".concat(tn," characters."));if(typeof Si=="number"&&oe.length>Si)throw new Error("error in length, should be less or equal than ".concat(Si," characters."));return A._cur=St,oe}consumeAttributeSpace(A){if(A.attValue[A._cur]!==d)throw new Error("Invalid space at ".concat(A._cur,"."));A._cur+=1}extract(A,F){if(!A.attValue)throw new Error("Nothing to extract from attValue.");for(var H=arguments.length,St=new Array(H>2?H-2:0),oe=2;oe<H;oe++)St[oe-2]=arguments[oe];const tn=F.call(this,A.attValue,A._cur,...St),Si=A.attValue.slice(A._cur,tn);return A._cur=tn,Si}atEnd(A){if(!A.attValue)throw new Error;return A._cur>=A.attValue.length}peekChar(A){if(!A.attValue)throw new Error;return A.attValue[A._cur]}peek(A,F){if(!A.attValue)throw new Error;for(let H=0;H<F.length;H++)if(F[H]!==A.attValue[A._cur+H])return!1;return!0}parseIceUfrag(A){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(A,U,[4,256])}parseIcePwd(A){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(A,U,[22,256])}parseIceOptions(A){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(A);){F.push(this.extractOneOrMore(A,U));try{this.consumeAttributeSpace(A)}catch(H){if(this.atEnd(A))break;throw H}}this.attributes.iceOptions=F}parseFingerprint(A){const F=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const H=this.extract(A,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:H})}parseExtmap(A){const F=this.extractOneOrMore(A,f);let H;this.peekChar(A)==="/"&&(this.extract(A,this.consume,"/"),H=this.extract(A,this.consumeToken)),this.consumeAttributeSpace(A);const St=this.extract(A,this.consumeTill,d),oe=Y(Y({entry:parseInt(F,10)},H&&{direction:H}),{},{extensionName:St});this.peekChar(A)===d&&(this.consumeAttributeSpace(A),oe.extensionAttributes=this.extract(A,this.consumeTill)),this.attributes.extmaps.push(oe)}parseSetup(A){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(A,this.consumeTill);if(F!=="active"&&F!=="passive"&&F!=="actpass"&&F!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class Ce extends Lt{constructor(){super(...arguments),ot(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"group":this.parseGroup(A);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"fingerprint":this.parseFingerprint(A);break;case"setup":this.parseSetup(A);break;case"tls-id":this.parseTlsId(A);break;case"identity":this.parseIdentity(A);break;case"extmap":this.parseExtmap(A);break;case"msid-semantic":this.parseMsidSemantic(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(F){throw console.error("parsing session attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),F}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(A){const F=this.extract(A,this.consumeToken),H=[];for(;!this.atEnd(A)&&this.peekChar(A)===d;)this.consumeAttributeSpace(A),H.push(this.extract(A,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:H})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(A){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(A,W)}parseIdentity(A){const F=this.extractOneOrMore(A,Q),H=[];for(;!this.atEnd(A)&&this.peekChar(A)===d;){this.consumeAttributeSpace(A);const St=this.extract(A,this.consumeToken);this.extract(A,this.consume,"=");const oe=this.extractOneOrMore(A,tn=>tn!==d&&M(tn));H.push({name:St,value:oe})}this.attributes.identities.push({assertionValue:F,extensions:H})}parseMsidSemantic(A){this.peekChar(A)===d&&this.consumeAttributeSpace(A);const F={semantic:this.extract(A,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(A)}catch{break}if(this.peekChar(A)==="*"){this.extract(A,this.consume,"*"),F.applyForAll=!0;break}{const H=this.extract(A,this.consumeTill,d);F.identifierList.push(H)}}this.attributes.msidSemantic=F}}class Ae extends Lt{constructor(A){super(),ot(this,"attributes",void 0),A.protos.indexOf("RTP")!==-1||A.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"extmap":this.parseExtmap(A);break;case"setup":this.parseSetup(A);break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"candidate":this.parseCandidate(A);break;case"remote-candidate":this.parseRemoteCandidate(A);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(A);break;case"rtpmap":this.parseRtpmap(A);break;case"ptime":this.parsePtime(A);break;case"maxptime":this.parseMaxPtime(A);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(A);break;case"ssrc":this.parseSSRC(A);break;case"fmtp":this.parseFmtp(A);break;case"rtcp-fb":this.parseRtcpFb(A);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(A);break;case"mid":this.parseMid(A);break;case"msid":this.parseMsid(A);break;case"imageattr":this.parseImageAttr(A);break;case"rid":this.parseRid(A);break;case"simulcast":this.parseSimulcast(A);break;case"sctp-port":this.parseSctpPort(A);break;case"max-message-size":this.parseMaxMessageSize(A);break;case"ssrc-group":this.parseSSRCGroup(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(F){throw console.error("parsing media attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),F}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}parseCandidate(A){const F=this.extractOneOrMore(A,U,[1,32]);this.consumeAttributeSpace(A);const H=this.extractOneOrMore(A,f,[1,5]);this.consumeAttributeSpace(A);const St=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const oe=this.extractOneOrMore(A,f,[1,10]);this.consumeAttributeSpace(A);const tn=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);const Si=this.extract(A,this.consumePort);this.consumeAttributeSpace(A),this.extract(A,this.consume,"typ"),this.consumeAttributeSpace(A);const Jr={foundation:F,componentId:H,transport:St,priority:oe,connectionAddress:tn,port:Si,type:this.extract(A,this.consumeToken),extension:{}};for(this.peek(A," raddr")&&(this.extract(A,this.consume," raddr"),this.consumeAttributeSpace(A),Jr.relAddr=this.extract(A,this.consumeAddress)),this.peek(A," rport")&&(this.extract(A,this.consume," rport"),this.consumeAttributeSpace(A),Jr.relPort=this.extract(A,this.consumePort));this.peekChar(A)===d;){this.consumeAttributeSpace(A);const Bl=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A),Jr.extension[Bl]=this.extractOneOrMore(A,S)}this.attributes.candidates.push(Jr)}parseRemoteCandidate(A){const F=[];for(;;){const H=this.extractOneOrMore(A,f,[1,5]);this.consumeAttributeSpace(A);const St=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);const oe=this.extract(A,this.consumePort);F.push({componentId:H,connectionAddress:St,port:oe});try{this.consumeAttributeSpace(A)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(A){const F=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const H=this.extract(A,this.consumeTill,"/");this.extract(A,this.consume,"/");const St={encodingName:H,clockRate:this.extractOneOrMore(A,f)};this.atEnd(A)||this.peekChar(A)!=="/"||(this.extract(A,this.consume,"/"),St.encodingParameters=parseInt(this.extract(A,this.consumeTill),10));const oe=this.attributes.payloads.find(tn=>tn.payloadType===parseInt(F,10));oe?oe.rtpMap=St:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:St,rtcpFeedbacks:[]})}parsePtime(A){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(A,this.consumeTill)}parseMaxPtime(A){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(A,this.consumeTill)}parseDirection(A){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=A.attField}parseSSRC(A){const F=this.extractOneOrMore(A,f);this.consumeAttributeSpace(A);const H=this.extract(A,this.consumeTill,":");let St;this.peekChar(A)===":"&&(this.extract(A,this.consume,":"),St=this.extract(A,this.consumeTill));const oe=this.attributes.ssrcs.find(tn=>tn.ssrcId===parseInt(F,10));oe?oe.attributes[H]=St:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[H]:St}})}parseFmtp(A){const F=this.extract(A,this.consumeTill,d);this.consumeAttributeSpace(A);const H=this.extract(A,this.consumeTill),St={};H.split(";").forEach(tn=>{let[Si,Jr]=tn.split("=");Si=ar(Si).call(Si);const Bl=typeof Jr=="string"?ar(Jr).call(Jr):null;typeof Si=="string"&&Si.length>0&&(St[Si]=Bl)});const oe=this.attributes.payloads.find(tn=>tn.payloadType===parseInt(F,10));oe?oe.fmtp={parameters:St}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:St}})}parseFmtParameters(A){const F={},H=this.extract(A,this.consumeTill,"=");A._cur++;const St=this.extract(A,this.consumeTill,";");for(F[H]=St;A.attValue[A._cur]===";";){const oe=this.extract(A,this.consumeTill,"=");A._cur++;const tn=this.extract(A,this.consumeTill,";");F[oe]=tn}return F}parseRtcpFb(A){let F="";F=this.peekChar(A)==="*"?this.extract(A,this.consume,"*"):this.extract(A,this.consumeTill,d),this.consumeAttributeSpace(A);const H=this.extract(A,this.consumeTill,d);let St;if(H==="trr-int")St={type:H,interval:this.extract(A,this.consumeTill)};else{const oe={type:H};this.peekChar(A)===d&&(this.consumeAttributeSpace(A),oe.parameter=this.extract(A,this.consumeToken),this.peekChar(A)===d&&(oe.additional=this.extract(A,this.consumeTill))),St=oe}if(F==="*")this.attributes.rtcpFeedbackWildcards.push(St);else{const oe=this.attributes.payloads.find(tn=>tn.payloadType===parseInt(F,10));oe?oe.rtcpFeedbacks.push(St):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[St]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(A){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(A,this.consumePort)};this.peekChar(A)===d&&(this.consumeAttributeSpace(A),F.netType=this.extractOneOrMore(A,y),this.consumeAttributeSpace(A),F.addressType=this.extractOneOrMore(A,y),this.consumeAttributeSpace(A),F.address=this.extract(A,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(A){const F={id:this.extractOneOrMore(A,y,[1,64])};this.peekChar(A)===d&&(this.consumeAttributeSpace(A),F.appdata=this.extractOneOrMore(A,y,[1,64])),this.attributes.msids.push(F)}parseImageAttr(A){this.attributes.imageattr.push(A.attValue)}parseRid(A){const F=this.extractOneOrMore(A,St=>I(St)||f(St)||St==="_"||St==="-");this.consumeAttributeSpace(A);const H={id:F,direction:this.extract(A,this.consumeToken),params:[]};if(this.peekChar(A)===d){if(this.consumeAttributeSpace(A),this.peek(A,"pt=")){this.extract(A,this.consume,"pt=");const St=[];for(;;){const oe=this.extract(A,this.consumeToken);St.push(oe);try{this.extract(A,this.consume,",")}catch{break}}H.payloads=St,this.peekChar(A)===d&&this.extract(A,this.consume,d)}for(;;){const St=this.extract(A,this.consumeToken);switch(St){case"depend":{const oe={type:St,rids:this.extract(A,this.consume,"=").split(",")};H.params.push(oe);break}default:{const oe={type:St};this.peekChar(A)==="="&&(this.extract(A,this.consume,"="),oe.val=this.extract(A,this.consumeTill,";")),H.params.push(oe)}}try{this.extract(A,this.consume,";")}catch{break}}}this.attributes.rids.push(H)}parseSimulcast(A){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=A.attValue,this.extract(A,this.consumeTill)}parseSctpPort(A){this.attributes.sctpPort=this.extractOneOrMore(A,f,[1,5])}parseMaxMessageSize(A){this.attributes.maxMessageSize=this.extractOneOrMore(A,f,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(A){this.attributes.mid=this.extract(A,this.consumeToken)}parseSSRCGroup(A){const F=this.extract(A,this.consumeToken),H=[];for(;;)try{this.consumeAttributeSpace(A);const St=this.extract(A,this.consumeInteger);H.push(parseInt(St,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:H})}}function dn(ft,A,F){return A in ft?Object.defineProperty(ft,A,{value:F,enumerable:!0,configurable:!0,writable:!0}):ft[A]=F,ft}class Kn{constructor(){dn(this,"eol",l)}print(A,F){let H="";return F&&(this.eol=F),H+=this.printVersion(A.version),H+=this.printOrigin(A.origin),H+=this.printSessionName(A.sessionName),H+=this.printInformation(A.information),H+=this.printUri(A.uri),H+=this.printEmail(A.emails),H+=this.printPhone(A.phones),H+=this.printConnection(A.connection),H+=this.printBandwidth(A.bandwidths),H+=this.printTimeFields(A.timeFields),H+=this.printKey(A.key),H+=this.printSessionAttributes(A.attributes),H+=this.printMediaDescription(A.mediaDescriptions),H}printVersion(A){return"v=".concat(A).concat(this.eol)}printOrigin(A){return"o=".concat(A.username," ").concat(A.sessId," ").concat(A.sessVersion," ").concat(A.nettype," ").concat(A.addrtype," ").concat(A.unicastAddress).concat(this.eol)}printSessionName(A){return A?"s=".concat(A).concat(this.eol):""}printInformation(A){return A?"i=".concat(A).concat(this.eol):""}printUri(A){return A?"u=".concat(A).concat(this.eol):""}printEmail(A){let F="";for(const H of A)F+="e=".concat(H).concat(this.eol);return F}printPhone(A){let F="";for(const H of A)F+="e=".concat(H).concat(this.eol);return F}printConnection(A){return A?"c=".concat(A.nettype," ").concat(A.addrtype," ").concat(A.address).concat(this.eol):""}printBandwidth(A){let F="";for(const H of A)F+="b=".concat(H.bwtype,":").concat(H.bandwidth).concat(this.eol);return F}printTimeFields(A){let F="";for(const H of A){F+="t=".concat(H.time.startTime," ").concat(H.time.startTime).concat(this.eol);for(const St of H.repeats)F+="r=".concat(St.repeatInterval," ").concat(St.typedTimes.join(" ")).concat(this.eol);H.zoneAdjustments&&(F+="z=",F+="z=".concat(H.zoneAdjustments.map(St=>"".concat(St.time," ").concat(St.back?"-":""," ").concat(St.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(A){return A?"k=".concat(A).concat(this.eol):""}printAttributes(A){let F="";for(const H of A)F+="a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol);return F}printMediaDescription(A){let F="";for(const H of A)F+=this.printMedia(H.media),F+=this.printInformation(H.information),F+=this.printConnections(H.connections),F+=this.printBandwidth(H.bandwidths),F+=this.printKey(H.key),F+=this.printMediaAttributes(H);return F}printConnections(A){let F="";for(const H of A)F+=this.printConnection(H);return F}printMedia(A){return"m=".concat(A.mediaType," ").concat(A.port," ").concat(A.protos.join("/")," ").concat(A.fmts.join(" ")).concat(this.eol)}printSessionAttributes(A){return new kr(this.eol).print(A)}printMediaAttributes(A){return new dt(this.eol).print(A)}}class Un{constructor(A){dn(this,"eol",void 0),this.eol=A}printIceUfrag(A){return A===void 0?"":"a=ice-ufrag:".concat(A).concat(this.eol)}printIcePwd(A){return A===void 0?"":"a=ice-pwd:".concat(A).concat(this.eol)}printIceOptions(A){return A===void 0?"":"a=ice-options:".concat(A.join(d)).concat(this.eol)}printFingerprints(A){return A.length>0?A.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(d).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(A){return A.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(d).concat(F.extensionName).concat(F.extensionAttributes?"".concat(d).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(A){return A===void 0?"":"a=setup:".concat(A).concat(this.eol)}printUnrecognized(A){return A.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class kr extends Un{print(A){let F="";return F+=this.printGroups(A.groups),F+=this.printMsidSemantic(A.msidSemantic),F+=this.printIceLite(A.iceLite),F+=this.printIceUfrag(A.iceUfrag),F+=this.printIcePwd(A.icePwd),F+=this.printIceOptions(A.iceOptions),F+=this.printFingerprints(A.fingerprints),F+=this.printSetup(A.setup),F+=this.printTlsId(A.tlsId),F+=this.printIdentity(A.identities),F+=this.printExtmap(A.extmaps),F+=this.printUnrecognized(A.unrecognized),F}printGroups(A){let F="";return A.length>0&&(F+=A.map(H=>"a=group:".concat(H.semantic).concat(H.identificationTag.map(St=>"".concat(d).concat(St)).join("")).concat(this.eol)).join("")),F}printIceLite(A){return A===void 0?"":"a=ice-lite"+this.eol}printTlsId(A){return A?"a=tls-id:".concat(A).concat(this.eol):""}printIdentity(A){return A.length===0?"":A.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(H=>"".concat(d).concat(H.name).concat(H.value?"=".concat(H.value):"")))).join(this.eol)+this.eol}printMsidSemantic(A){if(!A)return"";let F="a=msid-semantic:".concat(A.semantic);return A.applyForAll?F+="".concat(d,"*"):A.identifierList.length>0&&(F+=A.identifierList.map(H=>"".concat(d).concat(H))),F+this.eol}}class dt extends Un{print(A){const F=A.attributes;let H="";return H+=this.printRTCP(F.rtcp),H+=this.printIceUfrag(F.iceUfrag),H+=this.printIcePwd(F.icePwd),H+=this.printIceOptions(F.iceOptions),H+=this.printCandidates(F.candidates),H+=this.printRemoteCandidatesList(F.remoteCandidatesList),H+=this.printEndOfCandidates(F.endOfCandidates),H+=this.printFingerprints(F.fingerprints),H+=this.printSetup(F.setup),H+=this.printMid(F.mid),H+=this.printExtmap(F.extmaps),H+=this.printRTPRelated(F),H+=this.printPtime(F.ptime),H+=this.printMaxPtime(F.maxPtime),H+=this.printDirection(F.direction),H+=this.printSSRCGroups(F.ssrcGroups),H+=this.printSSRC(F.ssrcs),H+=this.printRTCPMux(F.rtcpMux),H+=this.printRTCPMuxOnly(F.rtcpMuxOnly),H+=this.printRTCPRsize(F.rtcpRsize),H+=this.printMSId(F.msids),H+=this.printImageattr(F.imageattr),H+=this.printRid(F.rids),H+=this.printSimulcast(F.simulcast),H+=this.printSCTPPort(F.sctpPort),H+=this.printMaxMessageSize(F.maxMessageSize),H+=this.printUnrecognized(F.unrecognized),H}printCandidates(A){return A.map(F=>"a=candidate:".concat(F.foundation).concat(d).concat(F.componentId).concat(d).concat(F.transport).concat(d).concat(F.priority).concat(d).concat(F.connectionAddress).concat(d).concat(F.port).concat(d,"typ").concat(d).concat(F.type).concat(F.relAddr?"".concat(d,"raddr").concat(d).concat(F.relAddr):"").concat(F.relPort?"".concat(d,"rport").concat(d).concat(F.relPort):"").concat(Object.keys(F.extension).map(H=>"".concat(d).concat(H).concat(d).concat(F.extension[H])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(A){return A.map(F=>"a=remote-candidates:".concat(F.join(d)).concat(this.eol)).join("")}printEndOfCandidates(A){return A===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(A){if(!A.payloads)return"";const F=A.payloads;let H="";H+=A.rtcpFeedbackWildcards.map(St=>this.printRTCPFeedback("*",St)).join("");for(const St of F)H+=this.printRtpMap(St.payloadType,St.rtpMap),H+=this.printFmtp(St.payloadType,St.fmtp),H+=St.rtcpFeedbacks.map(oe=>this.printRTCPFeedback(St.payloadType,oe)).join("");return H}printFmtp(A,F){if(!F)return"";const H=Object.keys(F.parameters);return H.length===1&&F.parameters[H[0]]===null?"a=fmtp:".concat(A).concat(d).concat(H[0]).concat(this.eol):"a=fmtp:".concat(A).concat(d).concat(Object.keys(F.parameters).map(St=>"".concat(St,"=").concat(F.parameters[St])).join(";")).concat(this.eol)}printRtpMap(A,F){return F?"a=rtpmap:".concat(A).concat(d).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(A,F){let H="a=rtcp-fb:".concat(A).concat(d),St=F;return St.type==="trr-int"?H+="ttr-int".concat(d).concat(St.interval):(H+="".concat(St.type),St.parameter&&(H+="".concat(d).concat(St.parameter),St.additional&&(H+="".concat(d).concat(St.additional)))),H+this.eol}printPtime(A){return A===void 0?"":"a=ptime:".concat(A).concat(this.eol)}printMaxPtime(A){return A===void 0?"":"a=maxptime:".concat(A).concat(this.eol)}printDirection(A){return A===void 0?"":"a=".concat(A).concat(this.eol)}printSSRC(A){return A.map(F=>Object.keys(F.attributes).map(H=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(d).concat(H).concat(F.attributes[H]?":".concat(F.attributes[H]):"").concat(this.eol)).join("")).join("")}printRTCPMux(A){return A===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(A){return A===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(A){return A===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(A){if(A===void 0)return"";let F="a=rtcp:".concat(A.port);return A.netType&&(F+="".concat(d).concat(A.netType)),A.addressType&&(F+="".concat(d).concat(A.addressType)),A.address&&(F+="".concat(d).concat(A.address)),F+this.eol}printMSId(A){return A.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(d).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(A){return A.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(A){return A.map(F=>{let H="a=rid:".concat(F.id).concat(d).concat(F.direction);return F.payloads&&(H+="".concat(d,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(H+="".concat(d).concat(F.params.map(St=>St.type==="depend"?"depend=".concat(St.rids.join(",")):"".concat(St.type,"=").concat(St.val)).join(";"))),H+this.eol}).join("")}printSimulcast(A){return A===void 0?"":"a=simulcast:".concat(A).concat(this.eol)}printSCTPPort(A){return A===void 0?"":"a=sctp-port:".concat(A).concat(this.eol)}printMaxMessageSize(A){return A===void 0?"":"a=max-message-size:".concat(A).concat(this.eol)}printMid(A){return A===void 0?"":"a=mid:".concat(A).concat(this.eol)}printSSRCGroups(A){return A.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(H=>"".concat(d).concat(H.toString(10))).join("")).concat(this.eol)).join("")}}function yt(ft){return new Ot().parse(ft)}function Gt(ft,A){return new Kn().print(ft,A)}}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var o in r)n.o(r,o)&&!n.o(i,o)&&Object.defineProperty(i,o,{enumerable:!0,get:r[o]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function Kr(t){return a1.parse(t)}function Wu(t,e){return a1.print(t,e)}var PK=Br("Array","keys"),LK=Fs,kK=qn,MK=nt,UK=PK,$I=Array.prototype,xK={DOMTokenList:!0,NodeList:!0},VK=function(t){var e=t.keys;return t===$I||MK($I,t)&&e===$I.keys||kK(xK,LK(t))?UK:e},Ns=R(VK);function Pn(t,e,n){return(e=function(i){var r=function(o){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var l=c.call(o,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function pe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?c1(Object(n),!0).forEach(function(i){Pn(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const l1=new class extends An{constructor(){super(...arguments),Pn(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class BK{constructor(e){Pn(this,"logger",void 0),Pn(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function tO(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function u1(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Qs={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},WR=Date.now(),Kg=t=>{for(const e in Qs)if(Object.prototype.hasOwnProperty.call(Qs,e)&&Qs[e]===t)return e;return"DEFAULT"},b=new class{constructor(){Pn(this,"proxyServerURL",void 0),Pn(this,"logLevel",Qs.DEBUG),Pn(this,"uploadState","collecting"),Pn(this,"uploadLogWaitingList",[]),Pn(this,"uploadLogUploadingList",[]),Pn(this,"uploadErrorCount",0),Pn(this,"currentLogID",0),Pn(this,"url",void 0),Pn(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Qs.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Qs.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Qs.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Qs.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Qs.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Je("UPLOAD_LOG",!0)}disableLogUpload(){Je("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new BK(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-WR<100)return void setTimeout(()=>{this.log(...e)},Date.now()-WR);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=tO()+" Agora-SDK [".concat(Kg(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const r=tO()+" %cAgora-SDK [".concat(Kg(i),"]:");let o=[];if(!j("USE_NEW_LOG"))switch(i){case Qs.DEBUG:o=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,o);break;case Qs.INFO:o=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,o);break;case Qs.WARNING:o=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,o);break;case Qs.ERROR:o=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-WR<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-WR);const i=Math.max(0,Math.min(4,e[0]));e[0]=tO()+" Agora-SDK [".concat(Kg(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!j("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=u1()+" Agora-SDK [".concat(Kg(t),"]:"):n[0]=u1()+" Agora-SDK [".concat(Kg(t),"]:");let r="";n.forEach(o=>{typeof o=="object"&&(o=JSON.stringify(o)),r+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:Js,process_id:j("PROCESS_ID"),payload:JSON.stringify(t)};return Ra(async()=>{const n=await Or.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(j("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(j("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:t.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),l1.reportLogUploadError(i),!0},{timeout:j("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:j("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,j("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var d1;function jK(t){return Oi(t.reportId,"params.reportId",0,100,!1),Oi(t.category,"params.category",0,100,!1),Oi(t.event,"params.event",0,100,!1),Oi(t.label,"params.label",0,100,!1),$e(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(d1={}).FREE="free",d1.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const FK={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Ei=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),yn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let GK=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function $t(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,i){const r=i.value;if(typeof r=="function"){const o=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var c,l=arguments.length,d=new Array(l),p=0;p<l;p++)d[p]=arguments[p];let f=d;if(t.argsMap)try{f=t.argsMap(this,...d)}catch(v){b.warning(v),f=[]}try{JSON.stringify(f)}catch{b.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),f=[]}const S=(t.report||Wt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(o,".").concat(String(n)),options:f,tag:Dn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const v=r.apply(this,d);return v instanceof At?v.then(y=>(S.onSuccess(t.reportResult&&y),y)).catch(y=>{throw S.onError(y),y}):(S.onSuccess(t.reportResult&&v),v)}catch(v){throw S.onError(v),v}}}return i}}const Wt=new class{constructor(){Pn(this,"baseInfoMap",new Map),Pn(this,"proxyServer",void 0),Pn(this,"eventUploadTimer",void 0),Pn(this,"setSessionIdTimer",void 0),Pn(this,"url",void 0),Pn(this,"sids",new Set),Pn(this,"backupUrl",void 0),Pn(this,"_appId",void 0),Pn(this,"_aid",0),Pn(this,"keyEventUploadPendingItems",[]),Pn(this,"normalEventUploadPendingItems",[]),Pn(this,"apiInvokeUploadPendingItems",[]),Pn(this,"apiInvokeCount",0),Pn(this,"apiInvokeLoggedCount",0),Pn(this,"ltsList",[]),Pn(this,"lastSendNormalEventTime",Date.now()),Pn(this,"customReportCounterTimer",void 0),Pn(this,"customReportCount",0),Pn(this,"extApiInvoke",async t=>{for(const e of t){const n=pe(pe({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Dn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),j("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),j("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,i]=e;return n+i}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,o=!!j("SHOW_REPORT_INVOKER_LOG"),c=!!j("SHOW_REPORT_USER_INVOKER_LOG"),l=o||c&&e.id;l&&(this.apiInvokeLoggedCount+=1);const d=this.apiInvokeLoggedCount;function p(y,P){if(l){let I="[apiInvoke-".concat(d,"]");e.id&&(I+="[".concat(e.id,"]")),e.name&&(I+="[".concat(e.name,"]")),b.info("".concat(I," ").concat(y),y==="start"?e.options:P||"")}}const f=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});p("start");let S=!1;Ni(e.timeout).then(()=>{S||(this.sendApiInvoke(pe(pe({},f()),{},{error:L.API_INVOKE_TIMEOUT,success:!1})),p("timeout"))});const v=new st(L.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:y=>{const P=()=>{if(S)throw v;return S=!0,this.sendApiInvoke(pe(pe({},f()),{},{success:!0},e.reportResult&&{result:y})),p("onSuccess"),y};return n?zM(P,e.name+"Success",n,()=>S=!0):P()},onError:y=>{const P=()=>{if(S)throw y;S=!0,this.sendApiInvoke(pe(pe({},f()),{},{success:!1,error:y})),p("onFailure",y.toString())};return n?zM(P,e.name+"Error",n,()=>S=!0):P()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:j("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:XI?"global":"oversea",areas:j("AREAS")&&j("AREAS").join(",")},e.extend),{stringUid:o,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:p,clientRole:f}=e,S=Date.now(),v=pe(pe({},i),{},{eventType:Ei.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:QI,lts:S,elapse:S-n,extend:JSON.stringify(r),mode:e.mode,process:j("PROCESS_ID"),appType:j("APP_TYPE"),success:!0,version:Js,stringUid:o,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:p,clientType:Ct(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:f,serviceId:j("PROCESS_ID"),extensionID:j("PLUGIN_INFO").join(",")||""});var y;this.send({type:yn.SESSION,data:v},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe({},i),{},{role:e.role,eventType:Ei.JOIN_CHOOSE_SERVER,lts:r,eventElapse:e.elapse||r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0});this.send({type:yn.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe({},i),{},{eventType:Ei.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||r-n.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:yn.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const r=Date.now(),{firstSuccess:o,avoidJoinStartTime:c,addr:l,isProxy:d}=e,p=r-(o&&c?c:n.startTime),f=pe(pe({},i),{},{eventType:Ei.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:p,eventElapse:r-e.lts,firstSuccess:o,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:qI(),isABTestSuccess:e.isABTestSuccess?1:0}),S=f.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=r),o)this.send({type:yn.JOIN_GATEWAY,data:f},!0);else{let v;if(l)if(d){const P=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),I=l.match(/p=[0-9]{1,6}/g);v={isSuccess:S,gatewayIp:P&&P.length?P[0].split("=")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split("=")[1]:"",isProxy:d?1:0}}else{const P=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),I=l.match(/(:|p=)[0-9]{1,6}/g);v={isSuccess:S,gatewayIp:P&&P.length?P[0].split("//")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split(/:|p=/g)[1]:"",isProxy:d?1:0}}else v={isSuccess:S,gatewayIp:"",port:"",isProxy:d?1:0};delete f.success,delete f.eventType,delete f.firstSuccess,f.vid=Number(f.vid);const y=Object.assign({},f,v,{eventType:Ei.REJOIN_GATEWAY});this.send({type:yn.RE_JOIN_GATEWAY,data:y},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),r=pe(pe({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:yn.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe({},i),{},{eventType:Ei.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:yn.PUBLISH,data:o},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const r=i.info,o=Date.now(),c=pe(pe({},r),{},{eventType:Ei.SUBSCRIBE,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:yn.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const n=[...Ns(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const o=r.info,c=Date.now(),l=pe(pe({},o),{},{eventType:Ei.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:yn.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const o=r.info,c=Date.now(),l=pe(pe(pe({},o),i),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const o=r.info,c=Date.now(),l=pe(pe(pe({},o),i),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:n,data:l},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe(pe({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:Ei.AB_TEST,lts:r});this.send({type:yn.AB_TEST,data:o},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe(pe({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:Ei.PC_STATS,lts:r,preallocation:e.preallocation?1:0});this.send({type:yn.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe(pe({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Ei.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:yn.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const o=r.info,c=Date.now(),l=pe(pe(pe({},o),i),{},{eventType:e,lts:c});this.send({type:n,data:l},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe({},i),{},{eventType:Ei.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-n.startTime,success:e.succ});this.send({type:yn.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe({},i),{},{eventType:Ei.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:yn.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe({},i),{},{eventType:Ei.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:yn.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(t){this.proxyServer=t,t?b.debug("reportProxyServerurl: ".concat(t)):b.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:yn.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now();(function(o,c,l){const d=o[c];if(!d||typeof d!="string")return[o];o[c]="";const p=bc(JSON.stringify(o));let f=0;const S=[];let v=0;for(let y=0;y<d.length;y++)v+=d.charCodeAt(y)<=127?1:3,v<=l-p||(S[S.length]=Ut(Ut({},o),{},{[c]:d.substring(f,y)}),f=y,v=d.charCodeAt(y)<=127?1:3);return f!==d.length-1&&(S[S.length]=Ut(Ut({},o),{},{[c]:d.substring(f)})),S})(pe(pe(pe({},i),e),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(o=>this.send({type:yn.WORKER_EVENT,data:o},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe(pe({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:yn.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe(pe({},i),e),{},{elapse:r-n.startTime,lts:r,extend:e.extend||void 0});this.send({type:yn.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),o=pe(pe(pe({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:yn.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>j("CUSTOM_REPORT_LIMIT"))throw new st(L.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=e.map(r=>({type:yn.USER_ANALYTICS,data:pe(pe({sid:t},r),{},{lts:n})}));try{j("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw b.error("send custom report message failed",r.toString()),new st(L.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=j("NOT_REPORT_EVENT");if(t.tag&&Ct(e)&&Ct(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:r,cid:o}=n.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof st){const{code:d,message:p}=t.error;c=d||p||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:i,cid:o,uid:r,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:yn.API_INVOKE,data:l},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const o=t.shift();n.length<20?n.push(o):i.push(o)}t.push(...i);for(const o of[...n]){var r;this.ltsList.indexOf(o.data.lts)!==-1?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),Cg(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),j("ENABLE_EVENT_REPORT")&&n.length&&(j("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((o=>c=>{j("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-j("NORMAL_EVENT_QUEUE_CAPACITY")),b.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){Xn.networkState===hs.OFFLINE&&await At.race([Xn.onlineWaiter,Ni(2*ri.maxRetryTimeout)]);const e=r=>{let o=new Uint8Array;return r.forEach(c=>{const l=UI(JSON.stringify(c.data)),d=new ArrayBuffer(5),p=(S=>{let v=0;return Object.entries(yn).forEach(y=>{let[P,I]=y;I===S.type&&(v=GK[P])}),v})(c),f=new DataView(d);f.setUint16(0,l.byteLength,!0),f.setUint8(2,255&p),f.setUint8(3,p>>>8&255),f.setUint8(4,p>>>16&255),o=xM(o,new Uint8Array(d)),o=xM(o,l)}),o},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await HI(i,{timeout:1e4,data:e(t),headers:pe(pe({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o){if(r===1)throw o;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(l=>{const d=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return d&&d.info.vid&&+d.info.vid||0})(t[0]),i=n?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(l=>JSON.stringify(l)),vid:n,aid:i};Xn.networkState===hs.OFFLINE&&await At.race([Xn.onlineWaiter,Ni(2*ri.maxRetryTimeout)]);const o=e?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(j("EVENT_REPORT_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(o));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(j("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(o)));try{e?await wK(c,{timeout:1e4,data:r}):await HI(c,{timeout:1e4,data:r})}catch(d){if(l===1)throw d;continue}return}}createBaseInfo(t,e){const n=Object.assign({},FK);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:Dn.TRACER}).onSuccess()}};l1.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Xn.networkState,Wt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Dn.TRACER}).onSuccess("logUploadError")});class et extends st{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Pn(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,b)}throw(){super.throw(b)}}const Di={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ue(){return Di}function h1(){return"setSinkId"in HTMLAudioElement.prototype&&(!j("RESTRICTION_SET_PLAYBACK_DEVICE")||(Cl()||CM())&&!LI())}function p1(){return!Di.supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&Al()}let Pi=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Am(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function Pe(t,e,n,i,r){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:r}}function Bo(t,e,n,i,r){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:r}}function eO(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const HK={"90p":Pe(160,90),"90p_1":Pe(160,90),"120p":Pe(160,120,15,30,65),"120p_1":Pe(160,120,15,30,65),"120p_3":Pe(120,120,15,30,50),"120p_4":Pe(212,120),"180p":Pe(320,180,15,30,140),"180p_1":Pe(320,180,15,30,140),"180p_3":Pe(180,180,15,30,100),"180p_4":Pe(240,180,15,30,120),"240p":Pe(320,240,15,40,200),"240p_1":Pe(320,240,15,40,200),"240p_3":Pe(240,240,15,40,140),"240p_4":Pe(424,240,15,40,220),"360p":Pe(640,360,15,80,400),"360p_1":Pe(640,360,15,80,400),"360p_3":Pe(360,360,15,80,260),"360p_4":Pe(640,360,30,80,600),"360p_6":Pe(360,360,30,80,400),"360p_7":Pe(480,360,15,80,320),"360p_8":Pe(480,360,30,80,490),"360p_9":Pe(640,360,15,80,800),"360p_10":Pe(640,360,24,80,800),"360p_11":Pe(640,360,24,80,1e3),"480p":Pe(640,480,15,100,500),"480p_1":Pe(640,480,15,100,500),"480p_2":Pe(640,480,30,100,1e3),"480p_3":Pe(480,480,15,100,400),"480p_4":Pe(640,480,30,100,750),"480p_6":Pe(480,480,30,100,600),"480p_8":Pe(848,480,15,100,610),"480p_9":Pe(848,480,30,100,930),"480p_10":Pe(640,480,10,100,400),"720p":Pe(1280,720,15,120,1130),"720p_auto":Pe(1280,720,30,900,3e3),"720p_1":Pe(1280,720,15,120,1130),"720p_2":Pe(1280,720,30,120,2e3),"720p_3":Pe(1280,720,30,120,1710),"720p_5":Pe(960,720,15,120,910),"720p_6":Pe(960,720,30,120,1380),"1080p":Pe(1920,1080,15,120,2080),"1080p_1":Pe(1920,1080,15,120,2080),"1080p_2":Pe(1920,1080,30,120,3e3),"1080p_3":Pe(1920,1080,30,120,3150),"1080p_5":Pe(1920,1080,60,120,4780),"1440p":Pe(2560,1440,30,120,4850),"1440p_1":Pe(2560,1440,30,120,4850),"1440p_2":Pe(2560,1440,60,120,7350),"4k":Pe(3840,2160,30,120,8910),"4k_1":Pe(3840,2160,30,120,8910),"4k_3":Pe(3840,2160,60,120,13500)},WK={"480p":Bo(640,480,5),"480p_1":Bo(640,480,5),"480p_2":Bo(640,480,30),"480p_3":Bo(640,480,15),"720p":Bo(1280,720,5),"720p_auto":Pe(1280,720,30,900,3e3),"720p_1":Bo(1280,720,5),"720p_2":Bo(1280,720,30),"720p_3":Bo(1280,720,15),"1080p":Bo(1920,1080,5),"1080p_1":Bo(1920,1080,5),"1080p_2":Bo(1920,1080,30),"1080p_3":Bo(1920,1080,15)},KK={"1SL1TL":eO(1,1),"3SL3TL":eO(3,3),"2SL3TL":eO(2,3)};function Ac(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},HK[t]):t}function nO(t){return typeof t=="string"?Object.assign({},WK[t]):t}function KR(t){return typeof t=="string"?Object.assign({},KK[t]):t}const zK={speech_low_quality:Am(16e3,!1),speech_standard:Am(32e3,!1,18),music_standard:Am(48e3,!1),standard_stereo:Am(48e3,!0,56),high_quality:Am(48e3,!1,128),high_quality_stereo:Am(48e3,!0,192)};function zR(t){return typeof t=="string"?Object.assign({},zK[t]):t}const wm=[];function f1(t){return hi(t,"mediaSource",["screen","window","application"]),!0}let Bt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),un=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Im=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),YK=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),qK=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),Fh=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Om=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Nm=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),Dm=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Ds=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const iO={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},rO={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},m1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},XK={uplinkNetworkQuality:0,downlinkNetworkQuality:0},_1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Er=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Ps=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),zg=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),Gh=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),cr=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),wc=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const sO={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let YR=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Le(t,e,n,i,r){var o,c,l={};return Object.keys(i).forEach(function(d){l[d]=i[d]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=Hi(o=iE(c=n.slice()).call(c)).call(o,function(d,p){return p(t,e,d)||d},l),r&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),l.initializer===void 0?(Object.defineProperty(t,e,l),null):l}function tt(t,e,n){return(e=function(i){var r=function(o){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var l=c.call(o,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function E1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Rn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?E1(Object(n),!0).forEach(function(i){tt(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class g1 extends An{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Fh.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),tt(this,"trackMediaType",void 0),tt(this,"_ID",void 0),tt(this,"_rtpTransceiver",void 0),tt(this,"_lowRtpTransceiver",void 0),tt(this,"_hints",[]),tt(this,"_isClosed",!1),tt(this,"_originMediaStreamTrack",void 0),tt(this,"mediaStreamTrack",void 0),tt(this,"_external",{}),this._ID=n||ln(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){Ct(wm).call(wm,i)||wm.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Gu(()=>{var n;Wt.reportApiInvoke(null,{name:ii.GET_MEDIA_STREAM_TRACK,options:[],tag:Dn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Im.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=wm.indexOf(e);n!==-1&&wm.splice(n,1)}(this),this.emit(Om.CLOSED),this.removeAllListeners(Fh.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===Im.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Fh.TRANSCEIVER_UPDATED,e,n)}}class Pm extends g1{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),tt(this,"_enabled",!0),tt(this,"_muted",!1),tt(this,"_isExternalTrack",!1),tt(this,"_isClosed",!1),tt(this,"_enabledMutex",void 0),tt(this,"processor",void 0),tt(this,"_processorContext",void 0),tt(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new zi("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,b.debug("[".concat(this.getTrackId(),"] close")),this.emit(Bt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Bt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Om.TRACK_ENDED)}stateCheck(e,n){if(b.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),wl(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new st(L.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",b);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new st(L.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",b)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():At.resolve([])}}const S1=window.AudioContext||window.webkitAudioContext;let Ls=null;const Qe=new class extends An{constructor(){super(...arguments),tt(this,"prevState",void 0),tt(this,"curState",void 0),tt(this,"currentTime",void 0),tt(this,"currentTimeStuckAt",void 0),tt(this,"interruptDetectorTrack",void 0),tt(this,"onLocalAudioTrackMute",()=>{b.info("ios15-interruption-start"),this.emit(Pi.IOS_15_16_INTERRUPTION_START)}),tt(this,"onLocalAudioTrackUnmute",async()=>{b.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?b.info("ios15-interruption-end-canceled"):(Ls&&await Ls.suspend(),this.emit(Pi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){b.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){b.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Lm(){if(!Ls){if(function(){if(!S1)return void b.error("your browser is not support web audio");b.info("create audio context");const t=Rn({},j("WEBAUDIO_INIT_OPTIONS"));b.debug("audio context init option:",JSON.stringify(t)),Ls=new S1(t),Qe.curState=Ls.state,Ls.onstatechange=()=>{Qe.prevState=Qe.curState,Qe.curState=Ls?Ls.state:void 0;const{prevState:e,curState:n}=Qe,i=n==="running",r=n==="interrupted",o=e==="running",c=e==="suspended",l=e==="interrupted",d=Me().osVersion;(_r()||xo())&&o&&r&&(b.info("ios".concat(d,"-interruption-start")),Qe.emit(Pi.IOS_INTERRUPTION_START)),(_r()||xo())&&(c||l)&&i&&(b.info("ios".concat(d,"-interruption-end")),Qe.emit(Pi.IOS_INTERRUPTION_END)),e!==n&&Qe.emit(Pi.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=Ls)===null||e===void 0?void 0:e.currentTime;Qe.currentTime!==n?(Qe.currentTimeStuckAt&&(b.debug("AudioContext current time resume at ".concat(n)),Qe.currentTimeStuckAt=void 0),Qe.currentTime=n):(n!==Qe.currentTimeStuckAt&&(Wt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Dn.TRACER}).onSuccess(),b.warning("AudioContext current time stuck at ".concat(n))),Qe.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,o=!1,c=!1;function l(I){e.state==="running"?d(!1):_r()||xo()?e.state==="suspended"&&(d(!0),I&&e.resume().then(p,p)):e.state!=="closed"&&(d(!0),I&&e.resume().then(p,p))}function d(I){if(r!==I){r=I;for(let O=0,M=n;O<M.length;O+=1){const U=M[O];I?window.addEventListener(U,f,{capture:!0,passive:!0}):window.removeEventListener(U,f,{capture:!0,passive:!0})}}}function p(){l(!1)}function f(){l(!0)}function S(I){if(!c)if(i.paused)if(I){let O;v(!1),c=!0;try{O=i.play(),O?O.then(y,y):(i.addEventListener("playing",y),i.addEventListener("abort",y),i.addEventListener("error",y))}catch{y()}}else v(!0);else v(!1)}function v(I){if(o!==I){o=I;for(let O=0,M=n;O<M.length;O++){const U=M[O];I?window.addEventListener(U,P,{capture:!0,passive:!0}):window.removeEventListener(U,P,{capture:!0,passive:!0})}}}function y(){i.removeEventListener("playing",y),i.removeEventListener("abort",y),i.removeEventListener("error",y),c=!1,S(!1)}function P(){S(!0)}if(_r()){const I=e.createMediaStreamDestination(),O=document.createElement("div");O.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=O.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=I.stream,S(!0)}Qe.on(Pi.STATE_CHANGE,function(){l(!0)}),l(!1)}(Ls)}(),!Ls)throw new st(L.NOT_SUPPORTED,"can not create audio context");return Ls}return Ls}function Hh(t){if(function(){if(oO!==null)return oO;const i=Lm(),r=i.createBufferSource(),o=i.createGain(),c=i.createGain();r.connect(o),r.connect(c),r.disconnect(o);let l=!1;try{r.disconnect(o)}catch{l=!0}return r.disconnect(),oO=l,l}())return;const e=t.connect,n=t.disconnect;t.connect=(i,r,o)=>{var c;return t._inputNodes||(t._inputNodes=[]),Ct(c=t._inputNodes).call(c,i)||(i instanceof AudioNode?(t._inputNodes.push(i),e.call(t,i,r,o)):e.call(t,i,r)),t},t.disconnect=(i,r,o)=>{n.call(t),i?UR(t._inputNodes,i):t._inputNodes=[];for(const c of t._inputNodes)e.call(t,c)}}let oO=null;function aO(t,e){let n=!1;const i=1/e;if(j("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):t(performance.now()/1e3)},1e3*i)}else{const r=Lm();let o=r.createGain();o.gain.value=0,o.connect(r.destination);const c=()=>{if(n)return void(o=null);const l=r.createOscillator();l.onended=c,l.connect(o),l.start(0),l.stop(r.currentTime+i),t(r.currentTime)};c()}return()=>{n=!0}}class T1{constructor(){tt(this,"context",void 0),tt(this,"analyserNode",void 0),tt(this,"sourceNode",void 0),this.context=Lm(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||_r()||xo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}const n=Hi(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{b.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class v1 extends An{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),tt(this,"outputNode",void 0),tt(this,"outputTrack",void 0),tt(this,"isPlayed",!1),tt(this,"sourceNode",void 0),tt(this,"context",void 0),tt(this,"audioBufferNode",void 0),tt(this,"destNode",void 0),tt(this,"audioOutputLevel",0),tt(this,"volumeLevelAnalyser",void 0),tt(this,"_processedNode",void 0),tt(this,"playNode",void 0),tt(this,"isDestroyed",!1),tt(this,"onNoAudioInput",void 0),tt(this,"isNoAudioInput",!1),tt(this,"_noAudioInputCount",0),this.context=Lm(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Hh(this.outputNode),this.volumeLevelAnalyser=new T1}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Ds.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const o=i.outputBuffer.getChannelData(r);for(let c=0;c<o.length;c+=1)o[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ue().webAudioMediaStreamDest)throw new st(L.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&xR(()=>{Qe.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;_r()||xo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let o=0;o<i.length;o++)i[o]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await Ni(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class y1 extends v1{get isFreeze(){return!1}constructor(e,n,i){var r;if(super(),tt(this,"sourceNode",void 0),tt(this,"track",void 0),tt(this,"clonedTrack",void 0),tt(this,"audioElement",void 0),tt(this,"isCurrentTrackCloned",!1),tt(this,"isRemoteTrack",!1),tt(this,"originVolumeLevelAnalyser",void 0),tt(this,"rebuildWebAudio",async()=>{if(b.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void b.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>b.info("resume success")),b.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),Hh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),Hh(this.outputNode),this.emit(Ds.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new st(L.UNEXPECTED_ERROR);this.track=e;const o=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(o),Hh(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,b.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const d=this.context.createMediaStreamSource(new MediaStream([l]));Hh(d),this.originVolumeLevelAnalyser=new T1,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=o;const c=Me();n&&c.os===_i.IOS&&Number((r=c.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(Qe.on(Pi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),Hh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Ds.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Qe.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),b.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Hh(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function R1(t,e,n){const i=(o,c)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||c:o:c,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function JK(t,e){const n=await b1(t.mediaSource),{sourceId:i,audio:r}=await function(o){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new At((l,d)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const f=document.createElement("div");f.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const S=document.createElement("div");S.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",S.setAttribute("style","height: 12%;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const P=document.createElement("button");P.innerHTML="cancel",P.setAttribute("style","width: 85px;"),P.onclick=()=>{document.body.removeChild(M);const U=new Error("NotAllowedError");U.name="NotAllowedError",d(U)};let I=c;const O=document.createElement("div");if(c){const U=document.createElement("input");U.setAttribute("type","checkbox");const W=document.createElement("span");U.setAttribute("style","margin-right: 6px;"),W.innerText="Share audio",U.checked=I,U.onchange=()=>{I=U.checked},O.appendChild(U),O.appendChild(W)}y.appendChild(O),y.appendChild(P),f.appendChild(S),f.appendChild(v),f.appendChild(y);const M=document.createElement("div");M.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),M.appendChild(p),M.appendChild(f),document.body.appendChild(M),o.map(U=>{if(U.id){const W=document.createElement("div");W.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Q=U.thumbnail;try{const{width:X}=Q.getSize();X>1920&&(Q=Q.resize({width:1920}))}catch(X){throw X&&X.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),X}W.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Q.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+U.name.replace(/[\u00A0-\u9999<>\&]/g,function(X){return"&#"+X.charCodeAt(0)+";"})+"</span>",W.onclick=()=>{document.body.removeChild(M),l({sourceId:U.id,audio:I})},v.appendChild(W)}})})}(n,e);return await R1(i,t,r)}async function b1(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=VM();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new st(L.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new At((o,c)=>{n.desktopCapturer.getSources({types:e},(l,d)=>{l?c(l):o(d)})}));try{return await i}catch(o){throw new st(L.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}const cO=new zi("safari");let C1=!1,A1=!1;async function ks(t,e){let n=0,i=null;for(;n<2;)try{i=await QK(t,e,n>0);break}catch(r){if(r instanceof st)throw b.error("[".concat(e,"] ").concat(r.toString())),r;const o=qR(r.name||r.code||r,r.message);if(o.code===L.MEDIA_OPTION_INVALID){b.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await Ni(500);continue}throw b.error("[".concat(e,"] ").concat(o.toString())),o}if(!i)throw new st(L.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function QK(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new st(L.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=Ue(),r=new MediaStream;if(t.audioSource&&r.addTrack(t.audioSource),t.videoSource&&r.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return b.debug("Using Video Source/ Audio Source"),r;if(t.screen)if(VM())t.screen.sourceId?km(r,await R1(t.screen.sourceId,t.screen,!!t.screenAudio)):km(r,await JK(t.screen,!!t.screenAudio));else if(Cl()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new st(L.NOT_SUPPORTED,"This browser does not support screen sharing");b.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const v=await(c=t.screen.extensionId,l=e,new At((y,P)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},I=>{if(!I||!I.streamId)return b.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),I),void P(new st(L.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(I.streamId)})}catch(I){b.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),I.toString()),P(new st(L.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=v,km(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var o;t.screen.mediaSource&&f1(t.screen.mediaSource);const v={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(o=t.screen.displaySurface)!==null&&o!==void 0?o:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:P,systemAudio:I,preferCurrentTab:O}=t.screen,M={selfBrowserSurface:y,surfaceSwitching:P,systemAudio:I,preferCurrentTab:O};!y&&delete M.selfBrowserSurface,!P&&delete M.surfaceSwitching,!I&&delete M.systemAudio,!O&&delete M.preferCurrentTab,b.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:v,audio:t.screenAudio,controls:M})),km(r,await navigator.mediaDevices.getDisplayMedia(Rn({video:v,audio:t.screenAudio},M)))}else{if(!Ln())throw b.error("[".concat(e,"] This browser does not support screenSharing")),new st(L.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&f1(t.screen.mediaSource);const v={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};b.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(v))),km(r,await navigator.mediaDevices.getUserMedia(v))}}var c,l;if(!t.video&&!t.audio)return r;let d={video:t.video,audio:t.audio},p=j("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),d=BI(d,p)}catch{}b.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(d)),Me();let f,S=null;(Mi()||_r()||kR())&&(S=await cO.lock());try{f=await navigator.mediaDevices.getUserMedia(d)}catch(v){throw S&&S(),v}return d.audio&&(C1=!0),d.video&&(A1=!0),km(r,f),S&&S(),r}function qR(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new st(L.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new st(L.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new st(L.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new st(L.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new st(L.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new st(L.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return b.error("getUserMedia unexpected error",t),new st(L.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function km(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],r=e.getVideoTracks()[0],o=e.getAudioTracks()[0];o&&(i&&t.removeTrack(i),t.addTrack(o)),r&&(n&&t.removeTrack(n),t.addTrack(r))}const Ms=new class extends An{get state(){return this._state}set state(t){t!==this._state&&(this.emit(Gh.STATE_CHANGE,t),this._state=t)}constructor(){super(),tt(this,"_state",zg.IDLE),tt(this,"isAccessMicrophonePermission",!1),tt(this,"isAccessCameraPermission",!1),tt(this,"lastAccessMicrophonePermission",!1),tt(this,"lastAccessCameraPermission",!1),tt(this,"checkdeviceMatched",!1),tt(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(j("ENUMERATE_DEVICES_INTERVAL")||(MR()||LR()===_i.HARMONY_OS)&&Al())&&this.updateDevicesInfo()},j("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>b.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new st(L.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let o=!this.isAccessMicrophonePermission&&t,c=!this.isAccessCameraPermission&&e;r.audio&&(o=!1),r.video&&(c=!1);let l=null,d=null,p=null;if(!n&&(o||c)){if(cO.isLocked&&(b.debug("[device manager] wait GUM lock"),(await cO.lock())(),b.debug("[device manager] GUM unlock")),C1&&(o=!1,this.isAccessMicrophonePermission=!0),A1&&(c=!1,this.isAccessCameraPermission=!0),b.debug("[device manager] check media device permissions",t,e,o,c),o&&c){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(f){const S=qR(f.name||f.code||f,f.message);if(S.code===L.PERMISSION_DENIED)throw S;b.warning("getUserMedia failed in getDevices",S)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{l=await navigator.mediaDevices.getUserMedia({audio:t})}catch(f){const S=qR(f.name||f.code||f,f.message);if(S.code===L.PERMISSION_DENIED)throw S;b.warning("getUserMedia failed in getDevices",S)}this.isAccessMicrophonePermission=!0}else if(c){try{d=await navigator.mediaDevices.getUserMedia({video:e})}catch(f){const S=qR(f.name||f.code||f,f.message);if(S.code===L.PERMISSION_DENIED)throw S;b.warning("getUserMedia failed in getDevices",S)}this.isAccessCameraPermission=!0}b.debug("[device manager] mic permission",t,"cam permission",e)}try{const f=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(S=>S.stop()),d&&d.getTracks().forEach(S=>S.stop()),p&&p.getTracks().forEach(S=>S.stop()),l=null,d=null,p=null,f}catch(f){return l&&l.getTracks().forEach(S=>S.stop()),d&&d.getTracks().forEach(S=>S.stop()),p&&p.getTracks().forEach(S=>S.stop()),l=null,d=null,p=null,new st(L.ENUMERATE_DEVICES_FAILED,f.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new st(L.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=zg.INITING;try{await this.updateDevicesInfo(),this.state=zg.INITEND}catch(t){throw b.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=zg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new st(L.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=t.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),o=t.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");r&&o?o.groupId===r.groupId?b.debug("[device-check] default input ".concat(r.label," and output ").concat(o.label," is the same group")):b.debug("[device-check] default input ".concat(r.label," and output ").concat(o.label," is not the same group")):b.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(r=>{if(!r.deviceId)return;const o=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((o?o.state:"INACTIVE")!=="ACTIVE"){const c={initAt:e,updateAt:e,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),c),n.push(c)}o&&(o.updateAt=e)}),this.deviceInfoMap.forEach((r,o)=>{r.state==="ACTIVE"&&r.updateAt!==e&&(r.state="INACTIVE",n.push(r))}),this.state!==zg.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Gh.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Gh.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Gh.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(r=>r.kind==="audioinput"),n=t.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of e)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let lO=!1;const Us=new class extends An{constructor(){super(...arguments),tt(this,"onAutoplayFailed",void 0),tt(this,"onAudioAutoplayFailed",void 0)}};function w1(){if(Me(),!lO){const t=e=>{e.preventDefault(),lO=!1,xg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};lO=!0,xg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),b.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Us.onAutoplayFailed?Us.onAutoplayFailed():Us.onAudioAutoplayFailed?b.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):b.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Us.emit("autoplay-failed")}}function I1(t,e,n,i){if(!t)return;const r=Wt.getBaseInfoBySessionId(t);if(!r)return;const o=r.info,c=Date.now(),l=Rn(Rn({},o),{},{vid:o.vid===void 0?0:Number(o.vid),lts:c,elapse:c-r.startTime,cbRegistered:Us.onAutoplayFailed||Us.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});Wt.send({type:yn.AUTOPLAY_FAILED,data:l},!0)}const ZK=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Nr=new class{constructor(){tt(this,"onAutoplayFailed",void 0),tt(this,"elementMap",new Map),tt(this,"elementStateMap",new Map),tt(this,"elementsNeedToResume",[]),tt(this,"sinkIdMap",new Map),tt(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const r=this.elementStateMap.get(n),o=i.srcObject.getAudioTracks()[0],c=o&&o.readyState;if(b.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(c," ").concat(t)),c==="live"){if(t)return i.pause(),void i.play();if(Qe.curState==="running")return vm()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),tt(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(b.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Qe.on(Pi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qe.on(Pi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Qe.on(Pi.STATE_CHANGE,()=>{_r()&&Qe.prevState==="suspended"&&Qe.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(i){throw new st(L.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,cr.INIT),this.setVolume(e,n);const o=this.sinkIdMap.get(e);if(o)try{r.setSinkId(o).catch(l=>{b.warning("[".concat(e,"] set sink id failed"),l.toString())})}catch(l){b.warning("[".concat(e,"] set sink id failed"),l.toString())}const c=r.play();c&&c.then&&c.catch(l=>{i&&I1(i,"audio",l.message,e),b.warning("audio element play warning",l.toString()),this.elementMap.has(e)&&l.name==="NotAllowedError"&&(b.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),xR(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),w1()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){ZK.forEach(n=>{e.addEventListener(n,i=>{const r=this.elementStateMap.get(t),o=i.type==="pause"?"paused":i.type;if(b.debug("[".concat(t,"] audio-element-status change ").concat(r," => ").concat(o)),i.type==="error"){const c=e==null?void 0:e.error;c&&b.error("[".concat(t,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(t,o)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{b.debug("Auto resume audio element success")}).catch(n=>{b.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new At(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{xg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Hn(){return function(t,e,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new st(L.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",b);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];const l=i.apply(this,o);return l instanceof At?new At((d,p)=>{l.then(d).catch(p)}):l}),n}}class O1 extends An{constructor(e){super(),tt(this,"name","VideoProcessorDestination"),tt(this,"ID","0"),tt(this,"_source",void 0),tt(this,"videoContext",void 0),tt(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new st(L.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new st(L.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Er.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Er.ON_TRACK,void 0)}}class N1 extends An{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),tt(this,"constraintsMap",new Map),tt(this,"statsRegistry",[]),tt(this,"usageRegistry",[]),tt(this,"trackId",void 0),tt(this,"direction",void 0),tt(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await xi(this,Ps.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var i;return b.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),cn(this,Ps.REQUEST_UPDATE_CONSTRAINTS,Array.from(or(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return b.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),cn(this,Ps.REQUEST_UPDATE_CONSTRAINTS,Array.from(or(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:o}of this.statsRegistry)try{const c=o();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){b.error(new st(L.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof At&&(i=await i),e.push(Rn(Rn({},i),{},{direction:this.direction}))}catch(i){b.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class D1 extends An{constructor(e){super(),tt(this,"name","AudioProcessorDestination"),tt(this,"ID","0"),tt(this,"inputTrack",void 0),tt(this,"inputNode",void 0),tt(this,"audioProcessorContext",void 0),tt(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new st(L.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new st(L.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Er.ON_TRACK,void 0),this.emit(Er.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Er.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Er.ON_NODE,this.inputNode))}}class P1 extends An{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,i){super(),tt(this,"constraintsMap",new Map),tt(this,"statsRegistry",[]),tt(this,"audioContext",void 0),tt(this,"trackId",void 0),tt(this,"direction",void 0),tt(this,"usageRegistry",[]),tt(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=i}async getConstraints(){return xi(this,Ps.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var i;return b.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),cn(this,Ps.REQUEST_UPDATE_CONSTRAINTS,Array.from(or(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),cn(this,Ps.REQUEST_UPDATE_CONSTRAINTS,Array.from(or(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:o}of this.statsRegistry)try{const c=o();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){b.error(new st(L.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof At&&(i=await i),e.push(Rn(Rn({},i),{},{direction:this.direction}))}catch(i){b.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class uO extends An{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),tt(this,"context",void 0),tt(this,"processSourceNode",void 0),tt(this,"outputTrack",void 0),tt(this,"processedNode",void 0),tt(this,"clonedTrack",void 0),tt(this,"outputNode",void 0),this.outputNode=new $K}setVolume(){}createOutputTrack(){throw new st(L.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class $K{disconnect(){}connect(){}}function L1(t){return new At((e,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const o=_r()?"canplay":"playing";r.addEventListener(o,()=>{const c=r.videoWidth,l=r.videoHeight;!c&&Ln()||(i=!0,r.srcObject=null,r.remove(),e([c,l]))}),r.srcObject=new MediaStream([t]),r.play().catch(VR),setTimeout(()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))},4e3)})}function XR(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=Ac(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!LM()&&n.frameRate&&(e.frameRate=n.frameRate),CM()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),Ln()&&(e.frameRate={ideal:30,max:30}),e}function k1(t){const e={};return LM()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,Cl()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function M1(t){const e=k1(t);if(t.encoderConfig){const n=zR(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),MR()&&(e.sampleRate=void 0),e}const tz=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:i,height:r}=t.getMediaStreamTrackSettings();let{frameRate:o=n,width:c=i,height:l=r}=e;if(!o||!c||!l)return;c=jI(c),l=jI(l),o=jI(o);const{max:d,min:p}=function(y,P,I){const O=200*Math.pow(I/15,.6)*Math.pow(y*P/640/360,.75);return{min:Math.floor(O),max:Math.floor(4*O)}}(c,l,o),{bitrateMax:f,bitrateMin:S}=e||{};f||b.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(o,"] => [brMax: ").concat(f,", brMin: ").concat(S,"]"));const{maxFramerate:v}=j("ENCODER_CONFIG_LIMIT");return v&&typeof v=="number"&&(o=Math.min(o,v)),{frameRate:o,bitrateMax:f||d,bitrateMin:S||p,scaleResolutionDownBy:1,scale:0}},U1=async(t,e,n)=>await(async(i,r,o)=>{const c=function(p){const f=[];for(let S=0;S<p.length;S+=2)f.push(parseInt(p.slice(S,S+2),16));return Uint8Array.from(f)}(XM(""+r+o)).slice(0,16),l=c.slice(0,12),d=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},d,i))})(t.buffer,e,n),dO=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new At((n,i)=>{e.toBlob(async r=>{if(e.remove(),r){const o=await x1(r);n({buffer:o,width:e.width,height:e.height})}else i(new st(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},x1=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var V1,B1,j1,F1,G1,H1,W1,K1,z1,Y1,q1,X1,J1,Q1,Z1,$1,tU,eU,In,nU,iU,rU,sU,oU,aU,Ic,cU,lU,uU,dU,hU,pU,fU,mU,_U,EU,gU,SU,TU,Bi;let Mn=(V1=$t({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),B1=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),j1=Hn(),F1=bm("LocalAudioTrack","_enabledMutex"),G1=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),H1=Hn(),W1=bm("LocalAudioTrack","_enabledMutex"),K1=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),z1=Hn(),Y1=Hn(),q1=Hn(),X1=$t({argsMap:t=>[t.getTrackId()]}),J1=Hn(),Q1=$t({argsMap:t=>[t.getTrackId()]}),Z1=Hn(),$1=$t({argsMap:t=>[t.getTrackId()]}),tU=$t({argsMap:(t,e)=>[t.getTrackId(),e.name]}),eU=$t({argsMap:t=>[t.getTrackId()]}),Le((In=class extends Pm{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Nr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i){super(t,n),tt(this,"trackMediaType",Dm.AUDIO),tt(this,"_encoderConfig",void 0),tt(this,"_trackSource",void 0),tt(this,"metadata",[]),tt(this,"_enabled",!0),tt(this,"_volume",100),tt(this,"_useAudioElement",!0),tt(this,"_bypassWebAudio",!1),tt(this,"processor",void 0),tt(this,"_processorContext",void 0),tt(this,"_processorDestination",void 0),tt(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new uO,j("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),j("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Mi()&&!Ls?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){$e(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Nr.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void b.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,cn(this,Bt.NEED_REPLACE_TRACK,this).then(()=>{b.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{b.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!h1())throw new st(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Nr.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await cn(this,Bt.NEED_ENABLE_TRACK,this),b.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(i){throw n||(this._enabled=!1),b.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await cn(this,Bt.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,b.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await cn(this,Bt.NEED_MUTE_TRACK,this):await cn(this,Bt.NEED_UNMUTE_TRACK,this))}getStats(){return Gu(()=>{b.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Is(this,Bt.GET_STATS)||Rn({},iO)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Ds.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Ds.ON_AUDIO_BUFFER),this._source.on(Ds.ON_AUDIO_BUFFER,n=>t(n))}play(){b.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(b.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Nr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){b.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Nr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];b.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Nr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Bt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return At.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new st(L.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new st(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(Er.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await cn(this,Bt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Bt.NEED_REPLACE_TRACK,this))}),t.on(Er.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Er.ON_TRACK),t.removeAllListeners(Er.ON_NODE)}bindProcessorContextEvents(t){t.on(Ps.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Ps.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof uO&&(this._trackSource=new y1(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new P1(this._source.context,this.getTrackId(),"local"),e=new D1(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(Ds.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Nr.stop(this.getTrackId()),this._source.play()),cn(this,Bt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{b.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{b.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[V1],Object.getOwnPropertyDescriptor(In.prototype,"setVolume"),In.prototype),Le(In.prototype,"setPlaybackDevice",[B1,j1],Object.getOwnPropertyDescriptor(In.prototype,"setPlaybackDevice"),In.prototype),Le(In.prototype,"setEnabled",[F1,G1,H1],Object.getOwnPropertyDescriptor(In.prototype,"setEnabled"),In.prototype),Le(In.prototype,"setMuted",[W1,K1,z1],Object.getOwnPropertyDescriptor(In.prototype,"setMuted"),In.prototype),Le(In.prototype,"getStats",[Y1],Object.getOwnPropertyDescriptor(In.prototype,"getStats"),In.prototype),Le(In.prototype,"setAudioFrameCallback",[q1],Object.getOwnPropertyDescriptor(In.prototype,"setAudioFrameCallback"),In.prototype),Le(In.prototype,"play",[X1,J1],Object.getOwnPropertyDescriptor(In.prototype,"play"),In.prototype),Le(In.prototype,"stop",[Q1,Z1],Object.getOwnPropertyDescriptor(In.prototype,"stop"),In.prototype),Le(In.prototype,"close",[$1],Object.getOwnPropertyDescriptor(In.prototype,"close"),In.prototype),Le(In.prototype,"pipe",[tU],Object.getOwnPropertyDescriptor(In.prototype,"pipe"),In.prototype),Le(In.prototype,"unpipe",[eU],Object.getOwnPropertyDescriptor(In.prototype,"unpipe"),In.prototype),In),JR=(nU=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),iU=Hn(),rU=bm("MicrophoneAudioTrack","_enabledMutex"),sU=$t({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),oU=Hn(),aU=$t({argsMap:t=>[t.getTrackId()]}),Le((Ic=class extends Mn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?zR(e.encoderConfig):{},i,j("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),tt(this,"_config",void 0),tt(this,"_deviceName","default"),tt(this,"_constraints",void 0),tt(this,"_originalConstraints",void 0),tt(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(vm()||PI())&&Qe.bindInterruptDetectorTrack(this)}async setDevice(t){if(b.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await Ms.getDeviceById(t),n={};n.audio=Rn({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await ks(n,this.getTrackId())}catch(r){throw b.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await ks({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await Ms.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}b.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return b.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),t),j("AUTO_RESET_AUDIO_ROUTE")&&(_r()||xo())){const c=navigator.audioSession;c&&(t||(c.type="playback"),c.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await cn(this,Bt.NEED_DISABLE_TRACK,this)}catch(c){throw b.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=Rn({},this._constraints),o=Ms.searchDeviceIdByName(this._deviceName);o&&!r.deviceId&&(r.deviceId=o);try{n||(this._enabled=!0);const c=await ks({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await cn(this,Bt.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),b.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}b.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(vm()||PI())&&Qe.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((_r()||xo())&&this._enabled&&!this._isClosed&&Qe.duringInterruption){const t=async()=>{Qe.off(Pi.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Qe.on(Pi.IOS_INTERRUPTION_END,t)}else b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Om.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=Ms.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const i=await ks({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Ps.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Ps.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[nU,iU],Object.getOwnPropertyDescriptor(Ic.prototype,"setDevice"),Ic.prototype),Le(Ic.prototype,"setEnabled",[rU,sU,oU],Object.getOwnPropertyDescriptor(Ic.prototype,"setEnabled"),Ic.prototype),Le(Ic.prototype,"close",[aU],Object.getOwnPropertyDescriptor(Ic.prototype,"close"),Ic.prototype),Ic),ez=(cU=$t({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),lU=Hn(),uU=$t({argsMap:t=>[t.getTrackId()]}),dU=Hn(),hU=$t({argsMap:t=>[t.getTrackId()]}),pU=Hn(),fU=$t({argsMap:t=>[t.getTrackId()]}),mU=Hn(),_U=$t({argsMap:t=>[t.getTrackId()]}),EU=Hn(),gU=$t({argsMap:t=>[t.getTrackId()]}),SU=$t({argsMap:t=>[t.getTrackId()]}),TU=Hn(),Le((Bi=class extends Mn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),tt(this,"source",void 0),tt(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(Ds.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(Om.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){$e(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[cU,lU],Object.getOwnPropertyDescriptor(Bi.prototype,"startProcessAudioBuffer"),Bi.prototype),Le(Bi.prototype,"pauseProcessAudioBuffer",[uU,dU],Object.getOwnPropertyDescriptor(Bi.prototype,"pauseProcessAudioBuffer"),Bi.prototype),Le(Bi.prototype,"seekAudioBuffer",[hU,pU],Object.getOwnPropertyDescriptor(Bi.prototype,"seekAudioBuffer"),Bi.prototype),Le(Bi.prototype,"resumeProcessAudioBuffer",[fU,mU],Object.getOwnPropertyDescriptor(Bi.prototype,"resumeProcessAudioBuffer"),Bi.prototype),Le(Bi.prototype,"stopProcessAudioBuffer",[_U,EU],Object.getOwnPropertyDescriptor(Bi.prototype,"stopProcessAudioBuffer"),Bi.prototype),Le(Bi.prototype,"close",[gU],Object.getOwnPropertyDescriptor(Bi.prototype,"close"),Bi.prototype),Le(Bi.prototype,"setAudioBufferPlaybackSpeed",[SU,TU],Object.getOwnPropertyDescriptor(Bi.prototype,"setAudioBufferPlaybackSpeed"),Bi.prototype),Bi);class ci extends Mn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Lm().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,ln(8,"track-mix-")),tt(this,"trackList",void 0),tt(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(b.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):b.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){b.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}UR(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof ci?n.emit(Fh.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class nz extends v1{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(Ds.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),tt(this,"audioBuffer",void 0),tt(this,"sourceNode",void 0),tt(this,"startPlayTime",0),tt(this,"startPlayOffset",0),tt(this,"pausePlayTime",0),tt(this,"options",void 0),tt(this,"currentLoopCount",0),tt(this,"currentPlaybackSpeed",100),tt(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):b.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const vU=new Map;class hO{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(b.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){tt(this,"trackId",void 0),tt(this,"config",void 0),tt(this,"onFirstVideoFrameDecoded",void 0),tt(this,"onVideoStateChanged",void 0),tt(this,"freezeTimeCounterList",[]),tt(this,"renderFreezeAccTime",0),tt(this,"isKeepLastFrame",!1),tt(this,"timeUpdatedCount",0),tt(this,"freezeTime",0),tt(this,"playbackTime",0),tt(this,"lastTimeUpdatedTime",0),tt(this,"autoplayFailed",!1),tt(this,"videoTrack",void 0),tt(this,"videoElement",void 0),tt(this,"cacheVideoElement",void 0),tt(this,"renderStats",void 0),tt(this,"_videoState",wc.VideoStateStopped),tt(this,"videoElementCheckInterval",void 0),tt(this,"videoElementFreezeTimeout",void 0),tt(this,"_videoElementStatus",cr.NONE),tt(this,"isGettingVideoDimensions",!1),tt(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return b.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),tt(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Qe.curState==="running"&&(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(bM())),DM()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),tt(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=cr.PLAYING;break;case"loadeddata":if(this.videoState=wc.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=cr.CANPLAY;break;case"stalled":this.videoElementStatus=cr.STALLED;break;case"suspend":this.videoElementStatus=cr.SUSPEND;break;case"pause":this.videoElementStatus=cr.PAUSED,_r()||xo()||Mi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=cr.WAITING;break;case"abort":this.videoElementStatus=cr.ABORT;break;case"ended":this.videoElementStatus=cr.ENDED;break;case"emptied":this.videoElementStatus=cr.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=cr.ERROR,b.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,o=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Ol.lastVisibleTime<Ol.lastHiddenTime||o<Ol.lastHiddenTime||o<Ol.lastVisibleTime)return;for(r>j("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),tt(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(bM())),DM()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Qe.on(Pi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qe.on(Pi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{e&&I1(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(b.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):b.warning("[".concat(this.trackId,"] play warning: "),r)});const i=Me();if((i.name==="Safari"&&Number(i.version)===15||vm())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return b.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new At((o,c)=>{i.toBlob(async l=>{if(i.remove(),l){const d=await x1(l);o({buffer:d,width:i.width,height:i.height})}else c(new st(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await dO(e)}destroy(){this.renderStats=void 0,Qe.off(Pi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qe.off(Pi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=wc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=cr.INIT,!this.videoElementCheckInterval&&(yU.forEach(o=>{this.videoElement.addEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(o){return o!==document.body&&document.body.contains(o)})(this.videoElement)||(this.videoElementStatus=cr.DESTROYED)},1e3),j("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let o;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,j("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===wc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=wc.VideoStateFrozen:document.addEventListener("visibilitychange",c))},d=(p,f)=>{if(this.videoElementStatus===cr.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=f.mediaTime):this.renderStats={lastTs:f.mediaTime,curTs:f.mediaTime,lastRenderNum:0,renderNum:0},o){const y=f.presentationTime-o.presentationTime;this.videoState===wc.VideoStateStarting&&(this.videoState=wc.VideoStateDecoding),this.videoState===wc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,j("VIDEO_FREEZE_DURATION"))),y<j("VIDEO_FREEZE_DURATION")&&this.videoState===wc.VideoStateFrozen&&(this.videoState=wc.VideoStateDecoding),y>j("VIDEO_FREEZE_DURATION")&&Ol.lastVisibleTime>=Ol.lastHiddenTime&&o.timestamp>Ol.lastVisibleTime&&o.timestamp>Ol.lastHiddenTime&&(this.renderFreezeAccTime+=y)}o=Rn(Rn({},f),{},{timestamp:p})}var S,v;j("ENABLE_VIDEO_FRAME_CALLBACK")&&((S=(v=this.videoElement).requestVideoFrameCallback)===null||S===void 0||S.call(v,d))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),MR()&&!j("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=Me();i.name==="Safari"&&Number(i.version)===15||vm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Ln()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Ln()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(o=>{b.debug("[".concat(this.trackId,"] playback interrupted"),o.toString())})}resetVideoElement(){yU.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=cr.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{b.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{b.error(i)}),this.autoplayFailed=!1,xg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};xg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),w1()}}const yU=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class RU extends hO{constructor(e){super(e),tt(this,"container",void 0),tt(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await dO(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",j("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var bU,CU,AU,wU,IU,OU,NU,DU,PU,LU,kU,MU,UU,xU,VU,BU,jU,FU,GU,HU,WU,KU,zU,YU,Ie,qU,XU,JU,QU,ZU,$U,tx,ex,xs;let En=(bU=$t({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),CU=Hn(),AU=$t({argsMap:t=>[t.getTrackId()]}),wU=bm("LocalVideoTrack","_enabledMutex"),IU=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),OU=Hn(),NU=bm("LocalVideoTrack","_enabledMutex"),DU=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),PU=Hn(),LU=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),kU=Hn(),MU=Hn(),UU=$t({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),xU=Hn(),VU=Hn(),BU=Hn(),jU=Hn(),FU=Hn(),GU=Hn(),HU=Hn(),WU=$t({argsMap:(t,e)=>[t.getTrackId(),e.name]}),KU=$t({argsMap:t=>[t.getTrackId()]}),zU=$t({argsMap:t=>[t.getTrackId()]}),YU=$t({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),Ie=class a3 extends Pm{get videoHeight(){if(Mi()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(Mi()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==cr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,i,r,o,c){if(super(e,o),tt(this,"trackMediaType",Dm.VIDEO),tt(this,"_player",void 0),tt(this,"isUseScaleResolutionDownBy",!1),tt(this,"_videoVisibleTimer",null),tt(this,"_previousVideoVisibleStatus",void 0),tt(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),tt(this,"_encoderConfig",void 0),tt(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),tt(this,"_optimizationMode",void 0),tt(this,"_videoHeight",void 0),tt(this,"_videoWidth",void 0),tt(this,"_forceBitrateLimit",void 0),tt(this,"_enabled",!0),tt(this,"_processorDestination",void 0),tt(this,"_processorContext",void 0),Mi()){const{width:l,height:d}=e.getSettings();this._videoWidth=l,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=i,this._optimizationMode=r,this._hints=c||[],this._hints.indexOf(un.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(OI(He.CHROME,115)&&LR().indexOf("Windows")!==-1){const l=function(d,p){if("VideoFrame"in window&&"TransformStream"in window&&Ue().supportWebRTCInsertableStream){const f=new MediaStreamTrackProcessor(d),S=new MediaStreamTrackGenerator({kind:"video"});let v,y,P=Date.now();const I=()=>{O&&(clearInterval(O),O=void 0),v&&(v.close(),v=void 0),d.stop(),y=void 0,S.removeEventListener("ended",I)};let O=window.setInterval(()=>{if(y&&v&&Date.now()-P>1e3)try{S.readyState==="live"?y.enqueue(v.clone()):I()}catch{I()}},1e3);const M=new TransformStream({transform:(U,W)=>{S.readyState==="live"?(y=W,P=Date.now(),v===void 0?(v=U,W.enqueue(U.clone())):(W.enqueue(v),v=U)):U.close()}});return S.addEventListener("ended",I),f.readable.pipeThrough(M).pipeTo(S.writable),S}}(e);l&&(b.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(un.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new N1(this.getTrackId(),"local"),this._processorDestination=new O1(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(b.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}b.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Rn(Rn(Rn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new hO(i):this._player=new RU(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Om.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,b.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await cn(this,Bt.NEED_DISABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void b.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await cn(this,Bt.NEED_ENABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,b.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await cn(this,Bt.NEED_MUTE_TRACK,this):await cn(this,Bt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new st(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=Ac(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=XR({encoderConfig:e});(Mi()||_r()||xo())&&(i.deviceId=void 0),b.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const o=new st(L.UNEXPECTED_ERROR,r.toString());throw b.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}}this._encoderConfig=e,this._hints.indexOf(un.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Bt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(b)}}getStats(){return Gu(()=>{b.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Is(this,Bt.GET_STATS)||Rn({},rO)}async setBeautyEffect(e){b.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await dO(e)}async setBitrateLimit(e){b.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void b.error(L.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await cn(this,Bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,b.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return b.error(L.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,b.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){L1(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(VR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new st(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");b.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=Ac(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(un.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Bt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(b)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!n||!i)return;const{bitrateMax:r,bitrateMin:o}=this._encoderConfig;if(o==null||r==null){const{max:c,min:l}=function(d,p,f,S,v){const y=j("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:S,max:v};if(v===void 0){var P;const O=Math.floor(200*Math.pow(f/15,.6)*Math.pow(d*p/640/360,.75));v=y==="STANDARD_BITRATE"?4*O:2*O,S=(P=S)!==null&&P!==void 0?P:O}else{var I;S=(I=S)!==null&&I!==void 0?I:Math.floor(v/10)}return{min:S,max:v}}(e,n,i,o,r);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,b.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:o,slot:c}=r;if(this.isPlaying&&o instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=UM.checkOneElementVisible(o),d=Object.assign({},l);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const p=Wt.reportApiInvoke(null,{tag:Dn.TRACER,name:ii.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(i){throw new st(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new st(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=Rn(Rn({},i),Ac(e))),i=xh(i);const r=ln(8,"track-video-cloned-"),o=new a3(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,xh(this._scalabilityMode),this._optimizationMode,r,xh(this._hints));return e&&i&&o.setEncoderConfiguration(i),b.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),o}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new st(L.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new st(L.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(Gu(()=>{Wt.reportApiInvoke(null,{name:ii.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Dn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!j("ENABLE_VIDEO_SEI")||!j("ENABLE_ENCODED_TRANSFORM"))return void b.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new st(L.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void b.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"?this.safeEmit("sei-to-send",e):b.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(Er.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await cn(this,Bt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Bt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Er.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ps.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ps.REQUEST_CONSTRAINTS)}},Le(Ie.prototype,"play",[bU,CU],Object.getOwnPropertyDescriptor(Ie.prototype,"play"),Ie.prototype),Le(Ie.prototype,"stop",[AU],Object.getOwnPropertyDescriptor(Ie.prototype,"stop"),Ie.prototype),Le(Ie.prototype,"setEnabled",[wU,IU,OU],Object.getOwnPropertyDescriptor(Ie.prototype,"setEnabled"),Ie.prototype),Le(Ie.prototype,"setMuted",[NU,DU,PU],Object.getOwnPropertyDescriptor(Ie.prototype,"setMuted"),Ie.prototype),Le(Ie.prototype,"setEncoderConfiguration",[LU,kU],Object.getOwnPropertyDescriptor(Ie.prototype,"setEncoderConfiguration"),Ie.prototype),Le(Ie.prototype,"getStats",[MU],Object.getOwnPropertyDescriptor(Ie.prototype,"getStats"),Ie.prototype),Le(Ie.prototype,"setBeautyEffect",[UU,xU],Object.getOwnPropertyDescriptor(Ie.prototype,"setBeautyEffect"),Ie.prototype),Le(Ie.prototype,"getCurrentFrameData",[VU],Object.getOwnPropertyDescriptor(Ie.prototype,"getCurrentFrameData"),Ie.prototype),Le(Ie.prototype,"getCurrentFrameImage",[BU],Object.getOwnPropertyDescriptor(Ie.prototype,"getCurrentFrameImage"),Ie.prototype),Le(Ie.prototype,"setBitrateLimit",[jU],Object.getOwnPropertyDescriptor(Ie.prototype,"setBitrateLimit"),Ie.prototype),Le(Ie.prototype,"setOptimizationMode",[FU],Object.getOwnPropertyDescriptor(Ie.prototype,"setOptimizationMode"),Ie.prototype),Le(Ie.prototype,"setScalabiltyMode",[GU],Object.getOwnPropertyDescriptor(Ie.prototype,"setScalabiltyMode"),Ie.prototype),Le(Ie.prototype,"updateMediaStreamTrackResolution",[HU],Object.getOwnPropertyDescriptor(Ie.prototype,"updateMediaStreamTrackResolution"),Ie.prototype),Le(Ie.prototype,"pipe",[WU],Object.getOwnPropertyDescriptor(Ie.prototype,"pipe"),Ie.prototype),Le(Ie.prototype,"unpipe",[KU],Object.getOwnPropertyDescriptor(Ie.prototype,"unpipe"),Ie.prototype),Le(Ie.prototype,"close",[zU],Object.getOwnPropertyDescriptor(Ie.prototype,"close"),Ie.prototype),Le(Ie.prototype,"replaceTrack",[YU],Object.getOwnPropertyDescriptor(Ie.prototype,"replaceTrack"),Ie.prototype),Ie),pO=(qU=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),XU=Hn(),JU=bm("CameraVideoTrack","_enabledMutex"),QU=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),ZU=Hn(),$U=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),tx=Hn(),ex=$t({argsMap:t=>[t.getTrackId()]}),xs=class c3 extends En{get __className__(){return"CameraVideoTrack"}constructor(e,n,i,r,o,c){super(e,Ac(n.encoderConfig),r,o,c),tt(this,"_config",void 0),tt(this,"_originalConstraints",void 0),tt(this,"_constraints",void 0),tt(this,"_enabled",!0),tt(this,"_deviceName","default"),tt(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(vm()||PI())&&!function(){const l=Me();if(l.os!==_i.IOS||!l.osVersion)return!1;const d=l.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2}()&&PM()&&this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=Ac(this._config.encoderConfig),Qe.on(Pi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Qe.on(Pi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(b.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await Ms.getDeviceById(e),i={};i.video=Rn({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await ks(i,this.getTrackId())}catch(o){throw b.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),r=await ks({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Ms.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}b.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){b.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:Rn(Rn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await ks(n,this.getTrackId())}catch(r){throw b.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await ks({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=Rn({},n.video),b.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await ks({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await cn(this,Bt.NEED_ENABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),b.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await cn(this,Bt.NEED_DISABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new st(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=Ac(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const i=kn(this._config);i.encoderConfig=e;const r=XR(i);(Mi()||_r()||xo())&&(r.deviceId=void 0),b.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(o){const c=new st(L.UNEXPECTED_ERROR,o.toString());throw b.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(un.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Bt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(b)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((_r()||xo())&&this._enabled&&!this._isClosed&&Qe.duringInterruption){const e=async()=>{Qe.off(Pi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Qe.on(Pi.IOS_INTERRUPTION_END,e)}else b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Om.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=Ms.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await ks({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Qe.off(Pi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Qe.off(Pi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=Rn(Rn({},i),Ac(e))),i=xh(i);const r=ln(8,"track-cam-cloned-"),o=new c3(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,xh(Rn(Rn({},this._config),{},{encoderConfig:i})),xh(this._constraints),xh(this._scalabilityMode),this._optimizationMode,r);return e&&i&&o.setEncoderConfiguration(i),b.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),o}bindProcessorContextEvents(){this.processorContext.on(Ps.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on(Ps.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},Le(xs.prototype,"setDevice",[qU,XU],Object.getOwnPropertyDescriptor(xs.prototype,"setDevice"),xs.prototype),Le(xs.prototype,"setEnabled",[JU,QU,ZU],Object.getOwnPropertyDescriptor(xs.prototype,"setEnabled"),xs.prototype),Le(xs.prototype,"setEncoderConfiguration",[$U,tx],Object.getOwnPropertyDescriptor(xs.prototype,"setEncoderConfiguration"),xs.prototype),Le(xs.prototype,"close",[ex],Object.getOwnPropertyDescriptor(xs.prototype,"close"),xs.prototype),xs);function fO(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=Rn(Rn({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?b.debug("[".concat(t,"] set content hint to"),n.optimizationMode):b.debug("[".concat(t,"] set content hint failed")))):b.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var nx,ix,rx,sx,Zs,ox,ax,cx,lx,ux,dx,lr;class hx extends g1{getUserId(){return this._userId}constructor(e,n,i,r){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(ln(5,""))),tt(this,"_userId",void 0),tt(this,"_uintId",void 0),tt(this,"_isDestroyed",!1),tt(this,"store",void 0),tt(this,"processor",void 0),tt(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,b.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Mm=(nx=$t({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),ix=$t({argsMap:t=>[t.getTrackId()]}),rx=$t({argsMap:(t,e)=>[t.getTrackId(),e.name]}),sx=$t({argsMap:t=>[t.getTrackId()]}),Le((Zs=class extends hx{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==cr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i){super(t,e,n,i),tt(this,"_videoVisibleTimer",null),tt(this,"_previousVideoVisibleStatus",void 0),tt(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),tt(this,"trackMediaType",Dm.VIDEO),tt(this,"_videoWidth",void 0),tt(this,"_videoHeight",void 0),tt(this,"_player",void 0),tt(this,"processorDestination",void 0),tt(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new N1(this.getTrackId(),"remote"),this.processorDestination=new O1(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Gu(()=>{b.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Is(this,Bt.GET_STATS)||Rn({},_1)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(b.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}b.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=Rn(Rn({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new hO(n):this._player=new RU(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Nm.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(Nm.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Nm.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,b.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){L1(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(VR)}_updatePlayerSource(){b.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:o}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=UM.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const d=Wt.reportApiInvoke(null,{tag:Dn.TRACER,name:ii.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new st(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new st(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Er.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Er.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(Fh.SEI_RECEIVED,t)}}).prototype,"play",[nx],Object.getOwnPropertyDescriptor(Zs.prototype,"play"),Zs.prototype),Le(Zs.prototype,"stop",[ix],Object.getOwnPropertyDescriptor(Zs.prototype,"stop"),Zs.prototype),Le(Zs.prototype,"pipe",[rx],Object.getOwnPropertyDescriptor(Zs.prototype,"pipe"),Zs.prototype),Le(Zs.prototype,"unpipe",[sx],Object.getOwnPropertyDescriptor(Zs.prototype,"unpipe"),Zs.prototype),Zs),Um=(ox=$t({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),ax=$t({argsMap:(t,e)=>[t.getTrackId(),e]}),cx=$t({argsMap:t=>[t.getTrackId()]}),lx=$t({argsMap:t=>[t.getTrackId()]}),ux=$t({argsMap:(t,e)=>[t.getTrackId(),e.name]}),dx=$t({argsMap:t=>[t.getTrackId()]}),Le((lr=class extends hx{get isPlaying(){return this._useAudioElement?Nr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),tt(this,"trackMediaType",Dm.AUDIO),tt(this,"_source",void 0),tt(this,"_useAudioElement",!0),tt(this,"_volume",100),tt(this,"processorContext",void 0),tt(this,"processorDestination",void 0),tt(this,"_played",!1),tt(this,"_bypassWebAudio",!1),j("DISABLE_WEBAUDIO")?(this._source=new uO,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new y1(t,!0),j("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Ds.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Nm.FIRST_FRAME_DECODED)}),this.processorContext=new P1(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new D1(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Ds.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Ds.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Ds.ON_AUDIO_BUFFER),this._source.on(Ds.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?Nr.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!h1())throw new st(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Nr.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Gu(()=>{b.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Is(this,Bt.GET_STATS)||Rn({},m1)}play(){b.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(b.debug("[".concat(this.getTrackId(),"] use audio element to play")),Nr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){b.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Nr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];b.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Nr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new st(L.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new st(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new st(L.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Er.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Er.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Er.ON_TRACK),this.processorDestination.removeAllListeners(Er.ON_NODE)}}).prototype,"setVolume",[ox],Object.getOwnPropertyDescriptor(lr.prototype,"setVolume"),lr.prototype),Le(lr.prototype,"setPlaybackDevice",[ax],Object.getOwnPropertyDescriptor(lr.prototype,"setPlaybackDevice"),lr.prototype),Le(lr.prototype,"play",[cx],Object.getOwnPropertyDescriptor(lr.prototype,"play"),lr.prototype),Le(lr.prototype,"stop",[lx],Object.getOwnPropertyDescriptor(lr.prototype,"stop"),lr.prototype),Le(lr.prototype,"pipe",[ux],Object.getOwnPropertyDescriptor(lr.prototype,"pipe"),lr.prototype),Le(lr.prototype,"unpipe",[dx],Object.getOwnPropertyDescriptor(lr.prototype,"unpipe"),lr.prototype),lr);const Ol=new class extends An{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),tt(this,"_lastHiddenTime",0),tt(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),b.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class px extends An{constructor(e,n){super(),tt(this,"trackMediaType",Dm.DATA),tt(this,"_version",1),tt(this,"_type",3),tt(this,"_config",void 0),tt(this,"_originDataChannel",void 0),tt(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),tt(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),tt(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return j("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new At((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var r;n(new st(L.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new st(L.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new st(L.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[YR.OPEN,YR.CLOSE,YR.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),e.addEventListener(n,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class iz extends px{constructor(e){super(e),tt(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(j("SHOW_DATASTREAM2_LOG")&&b.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let o=n.data.slice(this._dataStreamPacketHeader.byteLength);o=this._dataStreamPacketHandler.deserialize(o),this.emit(YR.MESSAGE,o)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class rz extends px{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function QR(){const t=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>Qy.revokeObjectURL(t),0),new Worker(Qy.createObjectURL(t))}var xm=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t}(xm||{});function fx(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==71)return;const i=t.getUint16(1),r=3+i,o=new Uint8Array(t.byteLength-r);o.set(new Uint8Array(t.buffer,r,t.byteLength-r));const c={m:n,tlvLen:i,tlv:[],frame:o};let l=3;for(;l<r;){const d=t.getUint8(l),p=t.getUint16(l+1),f=3;if(d===xm.AUDIO_LEVEL){let S=t.getUint8(l+f);for(let v=1;v<p;v++)S=S<<8|t.getUint8(l+f+v);c.tlv.push({tag:d,length:p,value:e?127^S>>1:127&S})}else if(d===xm.METADATA){const S=new Uint8Array(p);for(let v=0;v<p;v++)S[v]=t.getUint8(l+f+v);c.tlv.push({tag:d,length:p,value:S})}l+=f+p}return c}const ZR=new Map;async function sz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ue().supportWebRTCEncodedTransform)return void b.warning("browser not support audio encoded transform");if(ZR.has(t)||!t.track)return;const n={track:t.track};if(Cl()){if(!t.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void b.error("create audio-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=e.metadata&&e.metadata();d?function(p,f){const{chunk:S,controller:v}=f;S.data=function(y,P,I){const O=I.byteLength,M=O+1+2,U=3+M,W=new ArrayBuffer(y.byteLength+U),Q=new DataView(W);Q.setUint8(0,71),Q.setUint16(1,M),Q.setUint8(3,P),Q.setUint16(4,O);for(let Y=0;Y<O;Y++)Q.setUint8(6+Y,I[Y]);const X=new Uint8Array(Q.buffer);return X.set(new Uint8Array(y),U),X.buffer}(S.data,xm.METADATA,p),v.enqueue(S)}(d,{chunk:c,controller:l}):l.enqueue(c)}});r.readable.pipeThrough(o).pipeTo(r.writable)}else if(Mi()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=QR(),o=new MessageChannel;await new At(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"tx",port:o.port2},[o.port2]);t.transform=c,await new At(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),o.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=ZR.get(t);if(r){ZR.delete(t);try{var o,c;(o=r.controller)===null||o===void 0||o.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){b.warning(l&&l.message)}}}ZR.set(t,n),t.track.addEventListener("ended",i)}const $R=127,Wh=1e-10,mO=139/13,tb=new Map;function _O(t,e,n){const i="".concat(t,"-").concat(e,"-").concat(n);let r=0;return tb.has(i)?r=tb.get(i):(r=Math.log(function(c,l){const d=c-l;l<d&&(l=d);let p=1;for(let f=c,S=1;f>l;f--,S++)p=p*f/S;return p}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,tb.set(i,r)),r<Wh&&(r=Wh),r}function mx(t,e,n){const i=e.length,r=t.length/i;let o=!1;for(let c=0,l=0;c<i;c++){let d=0;for(let p=l+r;l<p;l++)t[l]>n&&d++;e[c]!==d&&(e[c]=d,o=!0)}return o}window.cache=tb;let oz=0;class _x{constructor(e){tt(this,"id",void 0),tt(this,"immediates",[]),tt(this,"lastNonSilence",-1),tt(this,"immediateSpeechActivityScore",Wh),tt(this,"lastLevelChangedTime",Date.now()),tt(this,"levels",[]),tt(this,"longs",[]),tt(this,"longSpeechActivityScore",Wh),tt(this,"mediums",[]),tt(this,"mediumSpeechActivityScore",Wh),tt(this,"minLevel",0),tt(this,"nextMinLevel",0),tt(this,"nextMinLevelWindowLength",0),tt(this,"energyScore",0),this.id=e||"".concat(oz++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,i=this.minLevel+mO;let r=!1;for(let o=0;o<e.length;++o){let c=n[o];c<i&&(c=0);const l=Math.floor(c/mO);e[o]!==l&&(e[o]=l,r=!0)}return r}computeLongs(){return mx(this.mediums,this.longs,4)}computeMediums(){return mx(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=_O(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=_O(this.longs[0],10,47),this.longSpeechActivityScore>Wh&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=_O(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(iE(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=e;return e<0&&(i=0),e>$R&&(i=$R),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+mO?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>$R&&(n=$R),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class az{constructor(e){tt(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class EO{constructor(e,n,i){tt(this,"isDominant",void 0),tt(this,"energyRanking",void 0),tt(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=i}}class cz extends An{constructor(e){super(),tt(this,"dominantId",null),tt(this,"lastDecisionTime",0),tt(this,"lastLevelChangedTime",0),tt(this,"lastLevelIdleTime",0),tt(this,"relativeSpeechActivities",[]),tt(this,"speakers",new Map),tt(this,"enableSilence",!1),tt(this,"timeoutToSilenceInterval",0),tt(this,"decisionMaker",null),tt(this,"loudest",[]),tt(this,"numLoudestToTrack",3),tt(this,"energyExpireTimeMs",250),tt(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const i=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const o=r.levelChanged(n,i);return this.updateLoudestList(r,o,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new _x(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,i){const r=e.id===this.dominantId;if(n<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==e;)++d;return new EO(r,d,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new EO(r,0,e.energyScore);const o=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const d=this.loudest[c];if(d.getLastLevelChangedTime()<o&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(d.id!==e.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<e.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new EO(r,l,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new az(this),this.decisionMaker.execute())}makeDecision(e){let n=null,i=null;const r=this.speakers.size;let o=null;if(r===0)o=null;else if(r===1){var c;const l=or(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(o=l.id,l.evaluateSpeechActivityScores(e),e-l.lastNonSilence>this.timeoutToSilenceInterval&&(o=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){const f=this.speakers.entries().next();f.value&&(o=f.value[0],l=f.value[1])}else o=l.id;l!=null&&l.evaluateSpeechActivityScores(e);const d=this.relativeSpeechActivities;let p=2;for(const f of this.speakers.entries()){const[S,v]=f;if(v===l)continue;v.evaluateSpeechActivityScores(e);for(let O=0;O<d.length;++O){const M=l==null?Wh:l.getSpeechActivityScore(O);d[O]=Math.log(v.getSpeechActivityScore(O)/M)}const y=d[0],P=d[1],I=d[2];y>3&&P>2&&I>0&&P>p&&(p=P,o=S)}this.enableSilence&&l!=null&&o===l.id&&e-l.lastNonSilence>this.timeoutToSilenceInterval&&(o=null)}o==null&&!this.enableSilence||o===this.dominantId||(n=this.dominantId,this.dominantId=o,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=n;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(e){const n=[];for(const r of or(i=this.speakers).call(i)){var i;const o=e-r.getLastLevelChangedTime();36e5<o&&(this.dominantId==null||r.id!==this.dominantId)?n.push(r.id):300<o&&r.levelTimedOut()}n.forEach(r=>this.speakers.delete(r))}}const Vm=new Map;let Ca=null,eb=null,Kh=[];const lz=1e3/15,Aa=new Map,nb=new Map;class uz{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){tt(this,"id",void 0),tt(this,"track",void 0),tt(this,"score",0),tt(this,"active",!0),tt(this,"muted",!1),tt(this,"timer",0),tt(this,"actives",0),tt(this,"inactives",0),this.id=e,this.track=n,this.setActive(Aa.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const r=[],o=[];return Array.from(or(Aa).call(Aa)).forEach(c=>{c.active?r.push(c):o.push(c)}),{actives:r,inactives:o}}();if(n.length>3){let r;n.forEach(o=>{(!r||r.score>o.score)&&(r=o)}),r&&r.setActive(!1)}if(n.length<3&&i.length>0){let r;i.forEach(o=>{(!r||r.score<o.score)&&o.id!==this.id&&(r=o)}),r&&e&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let i;return Array.from(or(Aa).call(Aa)).forEach(r=>{!r.active||r.id===n||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let i;return Array.from(or(Aa).call(Aa)).forEach(r=>{r.active||r.id===n||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>lz&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let ib;function Ex(t){const e=Aa.get(t);e&&(Aa.delete(t),e.clearTimer())}const rb=new Map,dz=new Map;async function gO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ue().supportWebRTCEncodedTransform)return void b.warning("browser not support audio encoded transform");if(rb.has(t))return;const n={track:t.track};if(Cl()){if(!t.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");OI(He.CHROME,87,116)||(e.enableTopn=!1);let r=null;try{r=t.createEncodedStreams()}catch(c){return void b.error("create audio-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)),e.enableTopn?function(d,p,f){var S;const v=fx(new DataView(p.data));if(!v)return f.enqueue(p);const y=d.track.id;dz.set(y,d.track);const P=(S=v.tlv.find(Q=>Q.tag===xm.AUDIO_LEVEL))===null||S===void 0?void 0:S.value;let I=0;typeof P=="number"&&(I=127-P);const O=Math.round(Math.pow(10,I/60)-1),{selected:M,speaker:U}=function(Q,X){let Y=Vm.get(Q);if(Y||(Y=function(ot){const Et=new _x;return Vm.set(ot,Et),Ca||(Ca=new cz(j("TOPN_SILENCE_THRESHOLD")||500),Ca.on("ActiveSpeakerChanged",Ot=>{Ot!=null&&(eb=Ot)})),Ca.addSpeakers([Et]),Et}(Q)),Vm.size<=3)return{selected:!0,speaker:Y};if(!Ca)throw new Error("no active speaker detector");return Ca.levelChanged(Y.id,X),Kh=Ca.loudest.map(ot=>ot.id),eb&&!Ct(Kh).call(Kh,eb)&&Kh.length>=3&&Kh.pop(),{selected:Ct(Kh).call(Kh,Y.id)||Y.id===eb,speaker:Y}}(d,O),W=function(Q,X,Y){const ot=Aa.get(Q)||new uz(Q,X);return ot.score=Y,Aa.set(Q,ot),function(Et){if(nb.set(Et,!0),!ib)return void(ib=Date.now());const Ot=Date.now();Ot-ib>1e3&&(nb.get(Et)?nb.set(Et,!1):(Ex(Et),nb.delete(Et)),ib=Ot)}(Q),ot}(y,d.track,U.energyScore);W.addSample(M),W.active&&(p.data=v.frame.buffer,f.enqueue(p))}(t,c,l):e.enableMetadata?function(d,p,f){const S=fx(new DataView(d.data));if(!S)return p.enqueue(d);const v=S.tlv.find(y=>y.tag===xm.METADATA);v&&f&&v.value instanceof Uint8Array&&f(v.value),d.data=S.frame.buffer,p.enqueue(d)}(c,l,e.onMetadata):l.enqueue(c)}});r.readable.pipeThrough(o).pipeTo(r.writable)}else if(Mi()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=QR(),o=new MessageChannel;await new At(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"rx",port:o.port2},[o.port2]);t.transform=c,await new At(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),o.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}function i(){t.track.removeEventListener("ended",i),function(r){const o=rb.get(r);if(o){(function(d){const p=Vm.get(d);p&&(Vm.delete(d),Ca&&(Ca.removeSpeakers([p]),Vm.size===0&&(Ca.destroy(),Ca=null)))})(r),Ex(r.track.id),rb.delete(r);try{var c,l;(c=o.controller)===null||c===void 0||c.terminate(),(l=o.worker)===null||l===void 0||l.terminate()}catch(d){b.warning(d&&d.message)}}}(t)}rb.set(t,n),t.track.addEventListener("ended",i)}function hz(t,e,n){let i=new Uint8Array(t,e,n),r=[],o=0;for(;r.length<n;)o+3<n&&i[o]===0&&i[o+1]===0&&i[o+2]===3&&(i[o+3]===0||i[o+3]===1||i[o+3]===2||i[o+3]===3)?(r.push(i[o],i[o+1],i[o+3]),o+=4):(r.push(i[o]),o++);return new Uint8Array(r)}const sb=new Map;async function pz(t,e){if(!Ue().supportWebRTCEncodedTransform)return void b.warning("browser not support video encoded transform");if(sb.has(t)||!t.track)return;const n={track:t.track};if(Cl()){if(!t.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(l){return void b.error("create video-encoded-streams error",l&&l.message)}const o=[];e.on("sei-to-send",l=>{o.push(l)});const c=new TransformStream({transform(l,d){n.controller||(n.controller=d),t.track&&t.track.id!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const p=o.shift();p&&(l.data=function(f,S){const v=function(U){const W=U.length;let Q=[],X=0;for(;X<W;)X+2<W&&U[X]===0&&U[X+1]===0&&(U[X+2]===0||U[X+2]===1||U[X+2]===2||U[X+2]===3)?(Q.push(U[X],U[X+1],3,U[X+2]),X+=3):(Q.push(U[X]),X++);return new Uint8Array(Q)}(S),y=v.length,P=Math.floor(y/255),I=y%255,O=new Uint8Array(6+P+1+y+f.byteLength);O[0]=0,O[1]=0,O[2]=0,O[3]=1,O[4]=6,O[5]=101;let M=0;for(;M<P;)O[6+M]=255,M++;return O[6+M]=I,M++,O.set(v,6+M),O.set(new Uint8Array(f),6+M+y),O.buffer}(l.data,p)),d.enqueue(l)}});r.readable.pipeThrough(c).pipeTo(r.writable)}else{if(!Mi())return;{if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=QR(),o=new MessageChannel;await new At(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"tx",port:o.port2},[o.port2]);t.transform=c,await new At(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),e.on("sei-to-send",l=>{o.port1.postMessage({sei:l})}),o.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=sb.get(t);if(r){sb.delete(t);try{var o,c;(o=r.controller)===null||o===void 0||o.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){b.warning(l&&l.message)}}}sb.set(t,n),t.track.addEventListener("ended",i)}const Yg=new Map;async function SO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ue().supportWebRTCEncodedTransform)return void b.warning("browser not support video encoded transform");if(!t.track)return;if(Yg.has(t)){const r=Yg.get(t);return void(r&&(r.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(Cl()){if(!t.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void b.error("create video-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=function(p){const f=new DataView(p.data);let S=0;for(;S+4<p.data.byteLength;){if(f.getUint8(S+0)===0&&f.getUint8(S+1)===0&&f.getUint8(S+2)===0&&f.getUint8(S+3)===1&&f.getUint8(S+4)===6){let v=S+6,y=0,P=0;for(;(P=f.getUint8(v++))===255;)y+=255;y+=P;const I=hz(p.data,v,y);return new Uint8Array(I)}S++}return null}(c);d&&n.onSei&&n.onSei(d),l.enqueue(c)}});r.readable.pipeThrough(o).pipeTo(r.writable)}else if(Mi()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const r=QR(),o=new MessageChannel;await new At(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"rx",port:o.port2},[o.port2]);t.transform=c,await new At(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),o.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(b.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.sei&&n.onSei&&n.onSei(l.data.sei)},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}(function(r){const o=Yg.get(r);if(o){Yg.delete(r);try{var c,l;(c=o.controller)===null||c===void 0||c.terminate(),(l=o.worker)===null||l===void 0||l.terminate()}catch(d){b.warning(d&&d.message)}}})(t)}Yg.set(t,n),t.track.addEventListener("ended",i)}(function(){const t=Me();Di.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Di.getStreamFromExtension=t.name===He.CHROME&&Number(t.version)>34,Di.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),Di.supportMinBitrate=t.name===He.CHROME||t.name===He.EDGE,Di.supportSetRtpSenderParameters=function(){const e=Me();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Al()||!(!Mi()&&!kR())||e.name===He.FIREFOX&&Number(e.version)>=64)}(),t.name===He.SAFARI&&(Number(t.version)>=14?Di.supportDualStream=!0:Di.supportDualStream=!1),Di.webAudioMediaStreamDest=function(){const e=Me();return!(e.name===He.SAFARI&&Number(e.version)<12)}(),Di.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Di.supportWebGL=typeof WebGLRenderingContext<"u",Di.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Al()||(Di.webAudioWithAEC=!0),Di.supportShareAudio=function(){const e=Me();return(e.os===_i.WIN_10||e.os===_i.WIN_81||e.os===_i.WIN_7||e.os===_i.LINUX||e.os===_i.MAC_OS||e.os===_i.CHROMIUM_OS)&&e.name===He.CHROME&&Number(e.version)>=74}(),Di.supportDataChannel=!!(Tm(76)||function(e){const n=Me();return!(n.name!==He.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||wM(14)),Di.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!Ln()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Di.supportWebRTCEncodedTransform=function(){const e=Me();return e.name==="Chrome"&&Number(e.version)>=87||e.name==="Safari"&&Number(e.version)>=15}(),Di.supportWebRTCInsertableStream=function(){const e=Me();return(e.name===He.CHROME||e.name===He.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Di.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Di.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,xR(()=>{Di.supportDualStreamEncoding=function(){const e=Me();return!!j("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&j("CHROME_DUAL_STREAM_USE_ENCODING"))}(),b.debug("browser ua: ",navigator.userAgent),b.info("browser info: ",t),b.info("browser compatibility: ",Di)})})();const fz=["CHINA","GLOBAL"],gx=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],zh=[],Bm=[];function Yh(t,e){return!!e&&zh.some(n=>n.uid===t&&n.channelName===e)}function TO(){return Bm.length>0}var mz=WL.forEach,Sx=cu("forEach")?[].forEach:function(t){return mz(this,t,arguments.length>1?arguments[1]:void 0)};Ke({target:"Array",proto:!0,forced:[].forEach!==Sx},{forEach:Sx});var _z=Br("Array","forEach"),Ez=Fs,gz=qn,Sz=nt,Tz=_z,vO=Array.prototype,vz={DOMTokenList:!0,NodeList:!0},yz=function(t){var e=t.forEach;return t===vO||Sz(vO,t)&&e===vO.forEach||gz(vz,Ez(t))?Tz:e},Rz=R(yz),bz=Yn,Tx=mo;Ke({target:"Object",stat:!0,forced:w(function(){Tx(1)})},{keys:function(t){return Tx(bz(t))}});var vx=R(ki.Object.keys),Cz=R(Ya),Az=R(qa),wz=Ke,yx=Hs,Iz=uh,Oz=Ci,Rx=Mp,Nz=Wa,Dz=ji,Pz=uw,Lz=xn,kz=ca,Mz=kL("slice"),Uz=Lz("species"),yO=Array,xz=Math.max;wz({target:"Array",proto:!0,forced:!Mz},{slice:function(t,e){var n,i,r,o=Dz(this),c=Nz(o),l=Rx(t,c),d=Rx(e===void 0?c:e,c);if(yx(o)&&(n=o.constructor,(Iz(n)&&(n===yO||yx(n.prototype))||Oz(n)&&(n=n[Uz])===null)&&(n=void 0),n===yO||n===void 0))return kz(o,l,d);for(i=new(n===void 0?yO:n)(xz(d-l,0)),r=0;l<d;l++,r++)l in o&&Pz(i,r,o[l]);return i.length=r,i}});var Vz=Br("Array","slice"),Bz=nt,jz=Vz,RO=Array.prototype,Fz=function(t){var e=t.slice;return t===RO||Bz(RO,t)&&e===RO.slice?jz:e},Gz=R(Fz);function Ft(t,e,n,i,r){var o,c,l,d={};return Rz(o=vx(i)).call(o,function(p){d[p]=i[p]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=Cz(c=Az(l=Gz(n).call(n)).call(l)).call(c,function(p,f){return f(t,e,p)||p},d),r&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(r):void 0,d.initializer=void 0),d.initializer===void 0&&(NL(t,e,d),d=null),d}let ob=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),bO=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),jo=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),gr=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Jt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),fn=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),ne=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),ee=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),qg=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),be=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Sr=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),ae=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function ab(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw b.error("Invalid Channel Name ".concat(t)),new et(L.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function cb(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||MM(t,1,255)))throw new et(L.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&b.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Nl=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const Hz={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},CO={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function AO(t,e){Oi(t.url,"".concat(e,".url"),1,1e3,!1),Nn(t.x)||$e(t.x,"".concat(e,".x"),0,1e4),Nn(t.y)||$e(t.y,"".concat(e,".y"),0,1e4),Nn(t.width)||$e(t.width,"".concat(e,".width"),0,1e4),Nn(t.height)||$e(t.height,"".concat(e,".height"),0,1e4),Nn(t.zOrder)||$e(t.zOrder,"".concat(e,".zOrder"),0,255),Nn(t.alpha)||$e(t.alpha,"".concat(e,".alpha"),0,1,!1)}const Wz={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Ku=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),wO=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),li=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function bx(t){if(!t.channelName)throw new et(L.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new et(L.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Oi(t.token,"info.token",1,2047),cb(t.uid),ab(t.channelName),!0}let Tr=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Dl=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),zr=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),jm=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),qe=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),yi=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),lb=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),gi=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),je=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const Cx=[je.AFRICA,je.ASIA,je.CHINA,je.EUROPE,je.GLOBAL,je.INDIA,je.JAPAN,je.NORTH_AMERICA,je.OCEANIA,je.OVERSEA,je.SOUTH_AMERICA];let Yi=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const ub={CHINA:{},ASIA:{CODE:Yi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Yi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Yi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Yi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Yi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Yi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Yi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Yi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Yi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Yi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Yi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Yi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Yi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};XI&&(ub.CHINA={CODE:Yi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Xg=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function Ax(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class wx extends An{constructor(e,n){super(),D(this,"onICEConnectionStateChange",void 0),D(this,"onConnectionStateChange",void 0),D(this,"onDTLSTransportStateChange",void 0),D(this,"onDTLSTransportError",void 0),D(this,"onICETransportStateChange",void 0),D(this,"onFirstAudioReceived",void 0),D(this,"onFirstVideoReceived",void 0),D(this,"onFirstAudioDecoded",void 0),D(this,"onFirstVideoDecoded",void 0),D(this,"onFirstVideoDecodedTimeout",void 0),D(this,"onSelectedLocalCandidateChanged",void 0),D(this,"onSelectedRemoteCandidateChanged",void 0),D(this,"onICECandidateError",void 0),D(this,"getLocalVideoStats",void 0)}}class Ix extends wx{constructor(e,n){super(e,n),D(this,"establishPromise",void 0)}}let xt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),nr=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),Pl=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const Ox=["disconnected","failed"];let _t=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Ye=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),qt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Fo=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Go=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Ri=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Nx=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Oc=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),$s=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),wa=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Fm=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Wn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Gm=function(t){return t.ABORT="abort",t}({}),zu=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),Kz=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const zz={[ob.ACCESS_POINT]:{[gr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[gr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[gr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[gr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[gr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[gr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[ob.UNILBS]:{[jo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[jo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[jo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[jo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[jo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[jo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[jo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[jo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[jo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[jo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[jo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[jo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[ob.STRING_UID_ALLOCATOR]:{[bO.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[bO.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[bO.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Hm(t){const e=zz[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===ob.ACCESS_POINT){const i=t%1e4;if(i.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const Yz={[Jt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Jt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Jt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Jt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Jt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Jt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Jt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Jt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Jt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Jt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Jt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Jt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Jt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Jt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Jt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Jt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Jt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Jt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Jt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Jt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Jt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Jt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Jt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Jt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Jt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Jt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Jt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Jt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Jt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Jt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Jt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Jt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Jt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Jt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Jt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Jt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Jt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Jt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Jt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Jt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Jt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Jt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Jt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Jt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Jt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Jt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Jt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Jt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Jt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Jt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Jt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Jt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Jt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Jt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Jt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Jt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Jt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Jt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Jt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Jt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Jt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Jt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Jt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Jg(t){return Yz[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function Dx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function IO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Dx(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Dx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Px(t,e){if(typeof t=="string")return t;const{proxy:n,host:i,port:r}=t;if(e){const o=j("JOIN_GATEWAY_FALLBACK_PORT")||443;return o===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(o,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const qz=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Xz=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Jz=/wss:\/\/(.+):([0-9]+)\/?/,Qz=/wss:\/\/(.[^\/]+)\/?/;let Zz=0;class $z{constructor(e,n){D(this,"id",0),D(this,"store",void 0),D(this,"recordIndex",void 0),D(this,"websockets",[]),D(this,"try443PortDuration",2e3),D(this,"forceCloseWSDuration",5e3),D(this,"try443PortTimeout",null),D(this,"forceCloseTimeout",null),D(this,"isTry443PortFailed",!1),D(this,"isNormalPortFailed",!1),D(this,"useDoubleDomain",!1),D(this,"useProxy",!1),D(this,"startTime",Date.now()),this.id=++Zz,this.try443PortDuration=j("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];b.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(e,n,i){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:i});const r=j("GATEWAY_DOMAINS"),o=Date.now(),c=[],l=r.find(v=>{var y;return Ct(y=e.host).call(y,v)});l||(this.useDoubleDomain=!1);const d=[];if(this.useDoubleDomain)r.forEach(v=>{d.push(Px(IO(IO({},e),{},{host:e.host.replace(l,v)}),n))});else{const v=IO({},e);if(n&&l){const y=r.find(P=>P!==l);y&&(v.host=v.host.replace(l,y))}d.push(Px(v,n))}try{d.forEach(v=>{const y=new WebSocket(v);y.binaryType="arraybuffer",c.push(y),this.logger("ws is connecting:",y.url)})}catch(v){if(this.logger("ws create failed"),c.forEach(y=>y.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,i);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new et(L.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const p=Ug();this.store&&this.store.recordJoinChannelService({urls:c.map(v=>v.url),service:"gateway"},this.recordIndex),c.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-o,"ms")),this.websockets.forEach(y=>{y!==v&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,p.resolve(v)},v.onclose=y=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(v.readyState));const P=c.every(I=>I.readyState===WebSocket.CLOSED||I.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(P)),P&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(y.reason)),p.reject({code:y.code,reason:lb.A_ROUND_WS_FAILED})):!n&&P&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),S()),n?this.isTry443PortFailed=P:this.isNormalPortFailed=P},v.onmessage=y=>this.logger("".concat(v.url," onmessage: ").concat(y.data))}),this.websockets.push(...c);const f=()=>{this.websockets.forEach(v=>v.readyState!==WebSocket.OPEN&&v.close())},S=()=>{if(p.isResolved)return f();Me().os===_i.MAC_OS&&Ln()&&f(),this.createWebSocket(e,!0,!0).then(v=>{p.resolve(v)}).catch(v=>{this.isNormalPortFailed&&p.reject(v),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.forceCloseTimeout=null,f()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,f()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",p.isResolved),this.try443PortTimeout=null,S()},this.try443PortDuration)})(),p.promise}chooseBestWebsocket(e,n,i,r){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(o){let c,l,d;return[,c,l,d]=o.match(qz)||[],c||([,l,d]=o.match(Xz)||[]),l&&d||([,l,d]=o.match(Jz)||[]),l&&d||([,l]=o.match(Qz)||[]),l||b.warning("un-destructible url: ",o),{proxy:c,host:l,port:d||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(b.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function Lx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class kx extends An{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;Ct(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(ae.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ae.CONNECTED):this._state==="closed"?this.emit(ae.CLOSED):this._state==="failed"&&this.emit(ae.FAILED))}resetReconnectCount(e){b.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],o=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),D(this,"connectionID",0),D(this,"currentURLIndex",0),D(this,"urls",[]),D(this,"_reconnectMode","tryNext"),D(this,"reconnectReason",void 0),D(this,"_initMutex",void 0),D(this,"name",void 0),D(this,"_state","closed"),D(this,"reconnectInterrupter",void 0),D(this,"websocket",void 0),D(this,"retryConfig",void 0),D(this,"reconnectCount",0),D(this,"forceCloseTimeout",5e3),D(this,"onlineReconnectListener",void 0),D(this,"useCompress",void 0),D(this,"tryDoubleDomain",!1),D(this,"use443PortOnly",!1),D(this,"wsInflateLength",0),D(this,"wsDeflateLength",0),D(this,"closeEstablishingWs",()=>{}),D(this,"store",void 0),D(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=e,this.retryConfig=function(S){for(var v=1;v<arguments.length;v++){var y=arguments[v]!=null?arguments[v]:{};v%2?Lx(Object(y),!0).forEach(function(P){D(S,P,y[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(y)):Lx(Object(y)).forEach(function(P){Object.defineProperty(S,P,Object.getOwnPropertyDescriptor(y,P))})}return S}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=o,this._initMutex=new zi("websocket",c?c.clientId:void 0);const{timeout:l,timeoutFactor:d}=n,p=Math.max(300,Math.floor(3*l/5)),f=Math.max(1.2,Math.floor(8*d)/10);hs.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=f),Xn.on(ym.NETWORK_STATE_CHANGE,(S,v)=>{S!==v&&(this.resetReconnectCount("network state change: ".concat(v," -> ").concat(S)),S===hs.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=f):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const r=Ug(),o=this.urls[this.currentURLIndex];j("ENABLE_PREALLOC_PC")&&this.emit(Nx.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(r.resolve).catch(r.reject),this.once(ae.CLOSED,()=>{r.reject(new st(L.WS_DISCONNECT))}),this.once(ae.CONNECTED,r.resolve),await r.promise}catch{}finally{i()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void b.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),b.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new st(L.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new st(L.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const i=Ug();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=f=>{var S;(S=this.store)===null||S===void 0||S.signalChannelOpen(),b.debug("[".concat(this.name,"] websocket opened:"),f),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},o=async f=>{var S;if(b.debug("[".concat(this.name,"] websocket close ").concat((S=this.websocket)===null||S===void 0?void 0:S.url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new st(L.WS_DISCONNECT,"websocket close: ".concat(f.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const v=Is(this,ae.WILL_RECONNECT,this.reconnectMode,f.reason)||this.reconnectMode,y=await this.reconnectWithAction(v);if(this.state==="closed")return void b.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return i.reject(new st(L.WS_DISCONNECT,"websocket reconnect failed: ".concat(f.code))),this.close(!0);i.resolve()}},c=f=>{this.emit(ae.ON_MESSAGE,f)},l=f=>{b.warn("[".concat(this.connectionID,"] ws open error ").concat(f))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),j("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=j("GATEWAY_WSS_ADDRESS")),b.debug("[".concat(this.name,"] start connect, url:"),e);const d=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;const f=await this.chooseBestWebsocketConnection(e);this.websocket=f,r&&r(this.websocket.url),this.websocket.onclose=o,this.websocket.onmessage=c,this.websocket.onerror=l,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(f){const S=this.state==="closed",v=f instanceof st,y=v&&f.code===L.WS_ABORT,P=v&&f.code===L.WS_ERR,I=v?f.message:f&&(f.reason||f.toString());b.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[f]},d),S||P?(i.reject(S?new st(L.WS_DISCONNECT,"websocket is closed: ".concat(I)):new st(L.WS_ERR,"init websocket failed: ".concat(I))),P&&b.error("[".concat(this.name,"] init websocket failed: ").concat(I))):o&&o(f)}return i.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;b.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Xn.isOnline||!Xn.onlineWaiter||(this.onlineReconnectListener=Xn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=FI(this.reconnectCount,this.retryConfig);b.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(e)),await At.race([Ni(c),this.onlineReconnectListener||new At(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(c,l)=>{this.emit(ae.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(e==="retry")await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);b.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(b.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await xi(this,ae.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(c){var o;b.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(o=c.data)===null||o===void 0?void 0:o.desc;return Array.isArray(l)&&Ct(l).call(l,"dynamic key expired")?(this.emit(ae.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class OO extends kx{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const i=Ug(),r=function(c,l){return new $z(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{b.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new st(L.WS_ABORT,"choose best websocket aborted"))};const o=j("GATEWAY_DOMAINS");return b.debug("[choose-best-ws] currentDomain: ",e,", domains: ",o,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Qg extends kx{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new At((i,r)=>{let o=!1;const c=[];this.closeEstablishingWs=()=>{b.debug("[choose-best-ws] close establishing websockets"),c.forEach(P=>{P.onclose=null,P.onopen=null,P.onmessage=null,P.close()}),r(new st(L.WS_ABORT,"choose best websocket aborted"))};const l=j("GATEWAY_DOMAINS");let d;const p=e.indexOf("?h="),f=l.find(P=>p!==-1?Ct(e).call(e,P,p):Ct(e).call(e,P));b.debug("[choose-best-ws] currentDomain: ",f,", domains: ",l);let S=!this.tryDoubleDomain||!f;if(!S&&f){var v;const P=Date.now();try{l.forEach(I=>{const O=p===-1?e.replace(f,I):e.substr(0,p)+e.substr(p).replace(f,I),M=new WebSocket(O);M.binaryType="arraybuffer",c.push(M),b.debug("[choose-best-ws] ws is connecting:",M.url)})}catch{for(b.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(O=>O.close());c.length;)c.pop();S=!0}(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:c.map(I=>I.url),service:"gateway"},n),c.forEach(I=>{I.onopen=()=>{if(o)return;const O=Date.now()-P;b.debug("[choose-best-ws] ws open cost ".concat(O,"ms")),c.filter(M=>M!==I).forEach(M=>{b.debug("[choose-best-ws]close backup websocket: ".concat(M.url)),M.close()}),o=!0,i(I)},I.onclose=O=>{d=O,!o&&(c.find(M=>!(M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING))||(b.debug("[choose-best-ws] all websocket is closed"),o=!0,r(d)))},I.onmessage=O=>{b.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(O.data))}}),Ni(this.forceCloseTimeout).then(()=>{c.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(S){var y;let P;b.debug("[choose-best-ws] use single url: ",e),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[e],service:"gateway"},n);try{P=new WebSocket(e),c.push(P),P.binaryType="arraybuffer"}catch(I){const O=new st(L.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return b.error("[".concat(this.name,"]").concat(O)),void r(O)}P.onopen=()=>{i(P)},P.onclose=I=>{r(I)},P.onmessage=I=>{b.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(I.data))},Ni(this.forceCloseTimeout).then(()=>{P&&P.readyState!==WebSocket.OPEN&&P.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class tY extends An{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===fn.CONNECTED?this.emit(ne.WS_CONNECTED):e===fn.RECONNECTING?this.emit(ne.WS_RECONNECTING,this._websocketReconnectReason):e===fn.CLOSED&&this.emit(ne.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),D(this,"_disconnectedReason",void 0),D(this,"_websocketReconnectReason",void 0),D(this,"_connectionState",fn.CLOSED),D(this,"reconnectToken",void 0),D(this,"websocket",void 0),D(this,"openConnectionTime",void 0),D(this,"clientId",void 0),D(this,"lastMsgTime",Date.now()),D(this,"uploadCache",[]),D(this,"uploadCacheInterval",void 0),D(this,"rttRolling",new QM(5)),D(this,"pingpongTimer",void 0),D(this,"wsInflateDataTimer",void 0),D(this,"pingpongTimeoutCount",0),D(this,"joinResponse",void 0),D(this,"multiIpOption",void 0),D(this,"initError",void 0),D(this,"spec",void 0),D(this,"store",void 0),D(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ne.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const o="res-@".concat(r._id);this.emit(o,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===be.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===be.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(ze.UID_BANNED);break;case 15:this.close(ze.IP_BANNED);break;case 16:this.close(ze.CHANNEL_BANNED)}if(r._type===be.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case Jt.ERR_LICENSE_MISSING:this.close(ze.LICENSE_MISSING);break;case Jt.ERR_LICENSE_EXPIRED:this.close(ze.LICENSE_EXPIRED);break;case Jt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ze.LICENSE_MINUTES_EXCEEDED);break;case Jt.ERR_LICENSE_PERIOD_INVALID:this.close(ze.LICENSE_PERIOD_INVALID);break;case Jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ze.LICENSE_MULTIPLE_SDK_SERVICE);break;case Jt.ERR_LICENSE_ILLEGAL:this.close(ze.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new OO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===fn.CONNECTED&&this.reconnect("retry",Ui.OFFLINE)})}async request(e,n,i,r){const o=ln(6,""),c={_id:o,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new At((P,I)=>{if(this.connectionState===fn.CONNECTED)return P();const O=()=>{this.off(ne.WS_CLOSED,M),P()},M=()=>{this.off(ne.WS_CONNECTED,O),I(new et(L.WS_ABORT))};this.once(ne.WS_CONNECTED,O),this.once(ne.WS_CLOSED,M),e!==ee.PUBLISH&&e!==ee.PUBLISH_DATASTREAM&&e!==ee.SUBSCRIBE&&e!==ee.SUBSCRIBE_DATASTREAM&&e!==ee.UNSUBSCRIBE&&e!==ee.UNSUBSCRIBE_DATASTREAM&&e!==ee.UNPUBLISH&&e!==ee.UNPUBLISH_DATASTREAM&&e!==ee.CONTROL&&e!==ee.RESTART_ICE||this.once(ne.DISCONNECT_P2P,()=>{I(new et(L.DISCONNECT_P2P))}),e!==ee.PUBLISH&&e!==ee.RESTART_ICE||this.once(ne.ABORT_P2P_EXECUTION,()=>{I(new et(L.DISCONNECT_P2P))})});if(this.connectionState!==fn.CONNECTING&&this.connectionState!==fn.RECONNECTING||e===ee.JOIN||e===ee.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const p=new At((P,I)=>{let O=!1;const M=(W,Q)=>{O=!0,P({isSuccess:W==="success",message:Q||{}}),this.off(ne.WS_CLOSED,U),this.off(ne.WS_RECONNECTING,U),this.emit(ne.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(o),M);const U=()=>{I(new et(L.WS_ABORT,"type: ".concat(e))),this.off(ne.WS_CLOSED,U),this.off(ne.WS_RECONNECTING,U),this.off("res-@".concat(o),M)};this.once(ne.WS_CLOSED,U),this.once(ne.WS_RECONNECTING,U),Ni(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(b.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(ne.REQUEST_TIMEOUT,e,n))})});let f=null;try{f=await p}catch(P){if(this.connectionState===fn.CLOSED||e===ee.LEAVE)throw new et(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?P.throw():e===ee.JOIN||e===ee.REJOIN?null:(await d(),await this.request(e,n))}if(f.isSuccess)return f.message;const S=Number(f.message.error_code||f.message.code),v=Jg(S),y=new et(L.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(f.message.error_str),{code:S,data:f.message,desc:v.desc});return v.action==="success"?f.message:(b.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(S,", message: ").concat(v.desc,", action: ").concat(v.action)),S===Jt.ERR_TOO_MANY_BROADCASTERS?((e===ee.JOIN||e===ee.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(S===Jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,b.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ui.MULTI_IP)):this.reconnect(v.action,Ui.SERVER_ERROR),e===ee.JOIN||e===ee.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new At(i=>{const r=o=>{(!n||n(o))&&(this.off(e,r),i(o))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void b.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(qg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const o=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==fn.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new At((n,i)=>{this.once(ne.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ne.WS_CLOSED,r=>i(this.initError||new et(L.WS_ABORT,r))),this.connectionState=fn.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||ze.LEAVE,this.connectionState=fn.CLOSED,b.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ne.ABORT_P2P_EXECUTION);const e=await xi(this,ne.REQUEST_JOIN_INFO),n=await this.request(ee.JOIN,e);if(!n)return this.emit(ne.REPORT_JOIN_GATEWAY,lb.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ne.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=fn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new et(L.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Fg(this,ne.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(ee.REJOIN,e);return!!n&&(this.connectionState=fn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(be.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(be.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(be.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(be.MUTE_AUDIO,{uid:i.uid}):this.emit(be.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(be.MUTE_VIDEO,{uid:i.uid}):this.emit(be.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(be.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(be.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(be.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(be.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(be.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){b.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Jg(e.code);if(e.code===28&&"detail"in e&&(b.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(ne.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ze.UID_BANNED),void this.close()):void this.reconnect(n.action,Ui.SERVER_ERROR);b.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=j("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(b.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ui.TIMEOUT):this.request(ee.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),j("REPORT_STATS")&&this.send(ee.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(qg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(ae.RECONNECT_CREATE_CONNECTION,e=>{this.emit(ne.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(ae.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ae.CLOSED,()=>{this.connectionState=fn.CLOSED}),this.websocket.on(ae.FAILED,()=>{this._disconnectedReason=ze.NETWORK_ERROR,this.connectionState=fn.CLOSED}),this.websocket.on(ae.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===fn.CONNECTED?this.connectionState=fn.RECONNECTING:this.connectionState=fn.CONNECTING}),this.websocket.on(ae.WILL_RECONNECT,(e,n,i)=>{const r=Fg(this,ne.IS_P2P_DISCONNECTED),o=r||e!=="retry";r&&e==="retry"&&(b.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=lb.P2P_DISCONNECTED),o&&(b.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(ne.REPORT_JOIN_GATEWAY,n||lb.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ne.DISCONNECT_P2P)),i(e)}),this.websocket.on(ae.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{b.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Ui.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(ne.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof et){if(e.code===L.UNEXPECTED_RESPONSE&&e.data.code===Jt.ERR_NO_AUTHORIZED)return this.initError=new et(L.TOKEN_EXPIRE,"dynamic key expired"),void this.close(ze.TOKEN_EXPIRE);b.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ui.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(ae.REQUEST_NEW_URLS,(e,n)=>{xi(this,ne.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(ae.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(be.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Nx.PRE_CONNECT_PC,()=>{this.emit(ne.PRE_CONNECT_PC)})}}let eY=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Jn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function Mx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function db(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Mx(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Wm(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(j("TURN_DOMAIN")):(b.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function NO(t,e){t.addresses||(t.addresses=[]);const n=function(l,d){if(j("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(S=>{let{ip:v,port:y}=S;return{address:"".concat(v,":").concat(y)}});const p=j("GATEWAY_DOMAINS");let f=p[1]&&Ct(d).call(d,p[1])?1:0;return l.map(S=>{let{domain_prefix:v,port:y,ip:P}=S;if(v)return{address:"".concat(v,".").concat(p[f++%p.length],":").concat(y)};const I=/^[\.\:\d]+$/.test(P),O=I?"".concat(P.replace(/[^\d]/g,"-"),".").concat(p[f++%p.length],":").concat(y):"".concat(P,":").concat(y);return I||b.debug("Cannot recognized as ip address: ".concat(P,", use as host")),{ip:P,port:y,address:O}})}(t.addresses,e),i=Array.isArray(t.detail)&&t.detail[18];if(i&&typeof i=="string"){const l=i.split(";");for(let d=0;d<l.length;d++){var r;const p=ar(r=l[d]).call(r);n[d]&&p&&(n[d].ip6=p)}}const o=t.detail&&t.detail.candidate;let c;if(o){const[l,d]=o.split(":");l&&d&&(c={port:Number(d),ip:l,address:"".concat(l,":").concat(d)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function ps(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function Ux(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(ps(e.width),"x").concat(ps(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function xx(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function Zg(t,e){let n,i,r;switch(e){case Jn.CHOOSE_SERVER:i=4096,r="choose server";break;case Jn.CLOUD_PROXY:i=1048576,r="proxy";break;case Jn.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case Jn.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new et(L.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(o=>{o.buffer&&o.buffer.flag===i&&(n={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map(c=>db(db({},c),{},{ticket:o.buffer.cert})),server_ts:t.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:db(db({},o.buffer.detail),t.detail),flag:o.buffer.flag,opid:t.opid,cert:o.buffer.cert})}),!n)throw new et(L.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function Vx(t,e){return await At.all(t.addresses.map(async n=>({address:Wm(n.ip),tcpport:n.port,udpport:n.port,username:e&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():Vi.username,password:e&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await xI(e.toString()):Vi.password})))}function DO(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||n.height,r=e.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min(ps(t.height),ps(t.width)),1):(b.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Yu(t){let{candidateType:e,relayProtocol:n,type:i,address:r,port:o,protocol:c}=t;const l={candidateType:e,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const d=r.split(".");d.length>=4&&(d[1]="*",d[2]="*"),l.address=d.join("."),l.port=o}return l}function hb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:j("SVC_MODE");if(j("ENABLE_SVC"))return function(e){return e in FR}(t)?t:FR.L1T3}const Bx={[xt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[xt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function pb(t,e,n){e.forEach(i=>{var r;const o=Bx[t].find(l=>{var d;let{key:p}=l;return Ct(d=i.extensionName).call(d,p)});if(!o)return;const c=n.find(l=>{let{extensionName:d}=l;return Ct(d).call(d,o.key)});c&&Ct(r=c.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=c.extensionName)})}function Km(t,e){e.forEach(n=>{var i;const r=Bx[t].find(o=>{var c;let{key:l}=o;return Ct(c=n.extensionName).call(c,l)});Ct(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function jx(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ct(t).call(t,"abs-send-time")}function fb(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ct(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function Fx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Gx(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Fx(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function $g(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:o,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:d}=e,{useXR:p}=n;let f=[],S=[],v=[],y=[],P=!1,I=!1;if(Kr(t).mediaDescriptions.forEach(M=>{i&&i!==M.attributes.direction||(M.media.mediaType!=="video"||P||(S=M.attributes.payloads,y=M.attributes.extmaps,P=!0),M.media.mediaType!=="audio"||I||(f=M.attributes.payloads,v=M.attributes.extmaps,I=!0))}),!y||S.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!v||f.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(S.forEach(M=>{var U;(U=M.rtpMap)!==null&&U!==void 0&&U.clockRate&&(M.rtpMap.clockRate=parseInt(M.rtpMap.clockRate)),p&&M.rtcpFeedbacks.push({type:"rrtr"})}),f.forEach(M=>{var U;(U=M.rtpMap)!==null&&U!==void 0&&U.clockRate&&(M.rtpMap.clockRate=parseInt(M.rtpMap.clockRate)),p&&M.rtcpFeedbacks.push({type:"rrtr"})}),r&&(f=f.filter(M=>{var U;return((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())!=="rtx"}),S=S.filter(M=>{var U;return((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())!=="rtx"})),o&&(S=S.filter(M=>{var U;return!/(red)|(ulpfec)|(flexfec)/i.test(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")})),c&&(f=f.filter(M=>{var U;return!/(red)|(ulpfec)|(flexfec)/i.test(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(f=f.filter(M=>{var U;return Ct(l).call(l,((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"")})),d&&(d==null?void 0:d.length)>0){const M=S.filter(U=>{var W;return Ct(d).call(d,((W=U.rtpMap)===null||W===void 0?void 0:W.encodingName.toLowerCase())||"")});S=M.concat(r?[]:kO(M,S))}const O=j("UNSUPPORTED_VIDEO_CODEC");return O&&O.length>0&&(S=S.filter(M=>!(M.rtpMap&&Ct(O).call(O,M.rtpMap.encodingName.toLowerCase())))),{audioCodecs:f,videoCodecs:S,audioExtensions:v,videoExtensions:y}}function qu(t){const e=Kr(t);let n,i;for(const r of e.mediaDescriptions){if(!n){const o=r.attributes.iceUfrag,c=r.attributes.icePwd;if(!o||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:o,icePwd:c}}if(!i){const o=r.attributes.fingerprints;o.length>0&&(i={fingerprints:o})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function Hx(t,e){const n=[],i=t.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),r=t.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),o=t.attributes.ssrcs;if(r)r.ssrcIds.forEach(c=>{var l;const d=(l=i.find(p=>p.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:e?d:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:e?l:void 0})}else{if(o.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function Wx(t,e,n){const{cname:i}=t;let r=[];e&&(r=Kx(e)),r.length===0&&(r=t.iceParameters.candidates.map(f=>({foundation:f.foundation,componentId:"1",transport:f.protocol,priority:f.priority.toString(),connectionAddress:f.ip,port:f.port.toString(),type:f.type,extension:{}})),b.debug("Using candidates from gateway."));const o={fingerprints:t.dtlsParameters.fingerprints.map(f=>({hashFunction:f.algorithm,fingerprint:f.fingerprint}))},c={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let l;switch(t.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}const d=_b(t.rtpCapabilities),p=[];return Array.isArray(n)&&n.length>0&&n.forEach(f=>{p.push({kind:xt.VIDEO,ssrcId:f.v,rtx:f.v_rtx,mslabel:"".concat(f.v,"_").concat(f.a)},{kind:xt.AUDIO,ssrcId:f.a,mslabel:"".concat(f.v,"_").concat(f.a)})}),{dtlsParameters:o,iceParameters:c,candidates:r,rtpCapabilities:d,setup:l,cname:i,preSSRCs:p}}function Kx(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],b.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),b.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function qh(t,e,n){const i=[],r=[];return t.forEach(o=>{let{ssrcId:c,rtx:l}=o;const d=ln(8,"track-"),p={ssrcId:c,attributes:Gx({label:d,mslabel:n=n||ln(10,""),msid:"".concat(n," ").concat(d)},e&&{cname:e})};if(i.push(p),l!==void 0){const f={ssrcId:l,attributes:Gx({label:d,mslabel:n,msid:"".concat(n," ").concat(d)},e&&{cname:e})};i.push(f),r.push({semantic:"FID",ssrcIds:[c,l]})}}),t.length>1&&r.push({semantic:"SIM",ssrcIds:t.map(o=>{let{ssrcId:c}=o;return c})}),{ssrcs:i,ssrcGroups:r}}function zm(t,e){e instanceof Mn&&t.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const o=e._encoderConfig;o&&r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(o.bitrate&&!Ln()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function PO(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function LO(t,e){var n;if(!(e instanceof En&&e._encoderConfig&&e._hints.indexOf(un.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;Ue().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach(r=>{var o,c;Ct(o=["h264","h265","vp8","vp9","av1"]).call(o,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Ue().supportMinBitrate&&!Ct(n=e._hints).call(n,un.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach(r=>{var o,c;Ct(o=["h264","h265","vp8","vp9","av1"]).call(o,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(j("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function zx(t){if(t.media.mediaType!=="video")return;const e=Me();if(e.name!==He.SAFARI&&e.os!==_i.IOS)return;const n=t.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function mb(t,e,n){if(!e)return;let i,r;if(t.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),e.twcc===!0){const o=i.find(c=>fb(c.extensionName));if(o){const c=o.extensionName;t.attributes.extmaps.find(d=>fb(d.extensionName))||t.attributes.extmaps.push({entry:o.entry,extensionName:c}),function(d,p){return p.filter(f=>!!d.find(S=>S.payloadType===f.payloadType&&!!S.rtcpFeedbacks.find(v=>v.type==="transport-cc")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(p=>p.type==="transport-cc")||d.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const o=t.attributes.extmaps.findIndex(c=>fb(c.extensionName));o!==-1&&t.attributes.extmaps.splice(o,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(e.remb===!0){const o=i.find(c=>jx(c.extensionName));if(o){const c=o.extensionName;t.attributes.extmaps.find(d=>d.extensionName===c)||t.attributes.extmaps.push({entry:o.entry,extensionName:c}),function(d,p){return p.filter(f=>!!d.find(S=>S.payloadType===f.payloadType&&!!S.rtcpFeedbacks.find(v=>v.type==="goog-remb")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(p=>p.type==="goog-remb")||d.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const o=t.attributes.extmaps.findIndex(c=>jx(c.extensionName));o!==-1&&t.attributes.extmaps.splice(o,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function Yx(t,e,n){if(Ln()||t.media.mediaType!=="video"||!(e instanceof En)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!j("SIMULCAST")||n==="vp9"&&j("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,r=t.attributes.ssrcs[0],o=t.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===r.ssrcId),c={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let l=1;l<i;l++)t.attributes.ssrcs.push({ssrcId:r.ssrcId+l,attributes:kn(r.attributes)}),c.ssrcIds.push(r.ssrcId+l),o&&(t.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+l,attributes:kn(r.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+l,o.ssrcIds[1]+l]}));t.attributes.ssrcGroups.unshift(c)}async function qx(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:o,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const f=$g(p,l,d,"sendonly"),S=$g(p,l,d,"recvonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ho(f,S,"videoExtensions",v,y,P),Ho(f,S,"videoCodecs",v,y,P),Ho(f,S,"audioExtensions",v,y,P),Ho(f,S,"audioCodecs",v,y,P),j("RAISE_H264_BASELINE_PRIORITY")){const I=[],O=[];P.videoCodecs.forEach((M,U)=>{var W;if(((W=M.rtpMap)===null||W===void 0?void 0:W.encodingName.toLocaleLowerCase())==="h264"){var Q,X;const Y=P.videoCodecs[U+1],ot=Y&&$x(M,Y),Et=(Q=M.fmtp)===null||Q===void 0?void 0:Q.parameters["profile-level-id"],Ot=(X=M.fmtp)===null||X===void 0?void 0:X.parameters["packetization-mode"];!Et||Et!==j("FIRST_H264_PROFILE_LEVEL_ID")||j("FIRST_PACKETIZATION_MODE")&&Ot!==j("FIRST_PACKETIZATION_MODE")?ot?O.push([M,Y]):O.push([M]):ot?I.push([M,Y]):I.push([M])}}),I.length>0&&O.length>0&&(b.debug("raising H264 baseline profile priority"),P.videoCodecs.forEach((M,U)=>{var W;if(((W=M.rtpMap)===null||W===void 0?void 0:W.encodingName.toLocaleLowerCase())==="h264"){const Q=$x(M,P.videoCodecs[U+1]),X=I.shift()||O.shift()||[];X.length>0&&(Q?P.videoCodecs.splice(U,2,...X):P.videoCodecs.splice(U,1,...X))}}),y.videoCodecs=y.videoCodecs.filter(M=>{var U,W;return!(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((W=M.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"])!==j("FIRST_H264_PROFILE_LEVEL_ID"))}),j("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(M=>{var U,W;return!(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((W=M.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"])!==j("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:v,recv:y,sendrecv:P}}(t,e,i);try{n.close()}catch{}return{send:r,recv:o,sendrecv:c}}function Xx(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=$g(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ho(t,e,"videoExtensions",n,i,r),Ho(t,e,"videoCodecs",n,i,r),Ho(t,e,"audioExtensions",n,i,r),Ho(t,e,"audioCodecs",n,i,r),j("RAISE_H264_BASELINE_PRIORITY")){const o=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(o!==-1){const c=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<o){b.debug("raising H264 baseline profile priority");const l=r.videoCodecs[o];r.videoCodecs.splice(o,1),r.videoCodecs.splice(c,0,l)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function Ho(t,e,n,i,r,o){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return t[n].forEach(l=>{e[n].some((d,p)=>{if(l.entry===d.entry&&l.extensionName===d.extensionName)return c.push(p),!0})?o[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return t[n].forEach(l=>{e[n].some((d,p)=>{if(l.payloadType===d.payloadType&&JSON.stringify(l)===JSON.stringify(d))return c.push(p),!0})?o[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}}function _b(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let r,o;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...i.audioCodecs],o.videoCodecs=[...n.videoCodecs,...i.videoCodecs],o.audioExtensions=[...n.audioExtensions,...i.audioExtensions],o.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):o=i,{send:r,recv:o}}function Ym(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function tS(t,e,n,i){let r=[];if(t===xt.VIDEO){if(j("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=e.videoCodecs.filter(o=>{var c;return Ct(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===j("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let o=[];const c=[],l=[],d=[];if(n.videoCodecs.forEach(p=>{const f=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"";Ct(f).call(f,i)?o.push(p):Ct(f).call(f,"vp9")?c.push(p):Ct(f).call(f,"vp8")?l.push(p):Ct(f).call(f,"h264")&&d.push(p)}),o.length===0){let p="";c.length!==0?(o=c,p="vp9"):l.length!==0?(o=l,p="vp8"):d.length!==0&&(o=d,p="h264"),b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(p))}o.length!==0&&(r=e.videoCodecs.filter(p=>o.some(f=>f.payloadType===p.payloadType)))}if(r.length===0&&(b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs),j("USE_PUB_RTX")||j("USE_SUB_RTX")){const o=kO(r,e.videoCodecs);r=[...r,...o]}}else r=e.audioCodecs.filter(o=>{var c;return Ct(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,i)}),r.length===0&&(b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter(o=>{var c;return Ct(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return r}function kO(t,e){const n=t.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&Ct(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Eb(t,e,n){const i=e.toString(),r=Qx(i,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:i});const o=await t.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let c=o.sdp;c=Jx(c,n||{}),r==null||r(c||""),await t.setLocalDescription({type:"answer",sdp:c})}function Jx(t,e,n){const i=Kr(t),{useXR:r}=e;return i.mediaDescriptions.forEach(o=>{var c;o.attributes.mid&&(Array.isArray(n)&&!Ct(n).call(n,o.attributes.mid)||(o.media.mediaType==="audio"&&Ym(o),r&&Ct(c=["audio","video"]).call(c,o.media.mediaType)&&o.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(d=>d.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),Wu(i)}function Qx(t,e,n,i){if(j("SDP_LOGGING"))return b.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(i,`
`),t),e==="offer"?r=>{Qx(r,"answer",n==="local"?"remote":"local",i)}:void 0}function Zx(t){const e=j("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>Ct(t).call(t,n))}function $x(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function t2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function to(t,e){return typeof j(t)===e?j(t):void 0}function nY(){try{const t=j("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?t2(Object(i),!0).forEach(function(r){D(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t2(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t)}catch(t){return b.debug("handle gateway attributes failed: ",t),{}}}const e2={};function Xh(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&b.debug("install service ".concat(t.name)),e2[t.name]=t}function Xu(t){const e=e2[t];if(!e)throw new st(L.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function n2(t,e){return Xu("DataStream").create(t,e)}function i2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ll(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?i2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const MO=new Map;class iY extends An{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(yi.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(yi.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){b.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var i,r,o;super(),D(this,"store",void 0),D(this,"joinInfo",void 0),D(this,"key",void 0),D(this,"ntpOffset",0),D(this,"signal",void 0),D(this,"role",void 0),D(this,"inChannelInfo",{joinAt:null,duration:0}),D(this,"spec",void 0),D(this,"_state","DISCONNECTED"),D(this,"_statsCollector",void 0),D(this,"_disconnectedReason",void 0),D(this,"isSignalRecover",!1),D(this,"hasChangeBGPAddress",!1),D(this,"trafficStatsInterval",void 0),D(this,"networkQualityInterval",void 0),D(this,"_joinGatewayStartTime",0),D(this,"_signalTimeout",!1),D(this,"_clientRoleOptions",void 0),D(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(i={spec:Ll(Ll({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(r=(o=Xu("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(o,i)):new tY(Ll(Ll({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let o=MO.get(e.cname);if(o||(o=new Map,MO.set(e.cname,o)),this._isProactiveJoin=!0,o.has(e.uid)){const p=new et(L.UID_CONFLICT);throw Wt.joinGateway(e.sid,{lts:r,succ:!1,ec:p.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),p}o.set(e.uid,!0),this.joinInfo=e,this.key=n;let c=0;this.joinGatewayStartTime=r;const l=e.proxyServer;try{b.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const p=e.gatewayAddrs.map(f=>{let{address:S}=f;const[v,y]=S.split(":"),P={host:v,port:y};return e.proxyServer&&(P.proxy=e.proxyServer),P});c=(await this.signal.init(p)).uid,b.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(p){var d;throw b.error("[".concat(this.store.clientId,"] User join failed"),p.toString()),Wt.joinGateway(e.sid,{lts:r,succ:!1,ec:((d=p.data)===null||d===void 0?void 0:d.desc)||p.code,errorMsg:p.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:"0",preload:e.preload}),o.delete(e.uid),this.signal.close(),p}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),b.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(p=>{b.warning("[".concat(this.store.clientId,"] get traffic stats error"),p.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(yi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(yi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(yi.NETWORK_QUALITY,{uplinkNetworkQuality:xx(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:xx(this._statsCollector.trafficStats.B_dnq)}):this.emit(yi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==ze.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==fn.CONNECTED||await function(i,r){return r===1/0?i:At.race([i,CK(r)])}(this.signal.request(ee.LEAVE,void 0,!0),3e3)}catch(i){b.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==ze.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:j("PUB_EXTEND"),twcc:!!j("PUBLISH_TWCC"),rtx:!!j("USE_PUB_RTX")};try{return(await this.signal.request(ee.PUBLISH,r,!0))._message}catch(o){if(i&&o.data&&o.data.code===Jt.ERR_PUBLISH_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),o.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw o}}async publishDataChannel(e,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(ee.PUBLISH_DATASTREAM,o,!0)}catch(c){if(i&&c.data&&c.data.code===Jt.ERR_PUBLISH_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw c}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ee.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(i){b.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await At.all(e.map(n=>this.signal.request(ee.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){b.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX")||void 0,extend:j("SUB_EXTEND"),svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return await this.signal.request(ee.PRE_SUBSCRIBE,r,!0)}catch(o){if(i&&o.data&&o.data.code===Jt.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),o.toString()),this.presubscribe(e,n,!1);throw o}}async subscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX"),extend:j("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return(await this.signal.request(ee.SUBSCRIBE,r,!0))._message}catch(o){if(i&&o.data&&o.data.code===Jt.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),o.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw o}}async subscribeDataChannel(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(ee.SUBSCRIBE_DATASTREAM,r,!0)}catch(o){if(i&&o.data&&o.data.code===Jt.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),o.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw o}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!j("USE_SUB_RTX"),twcc:!!j("SUBSCRIBE_TWCC"),svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return await this.signal.request(ee.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===Jt.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,o=i.width,c=i.height,l=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(l=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,r||(l=!1)),l?{stream_type:0,width:o,height:c,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(n)return this.signal.request(ee.SET_VIDEO_PROFILE,n);b.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(ee.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(i){b.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await At.all(e.map(i=>this.signal.request(ee.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){b.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(ee.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){b.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(ee.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ee.GATEWAY_INFO)}async renewToken(e){await this.signal.request(ee.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),j("CLIENT_ROLE_OPTIONS")&&(b.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(j("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},j("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),j("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},j("CLIENT_ROLE_OPTIONS")),b.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(j("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(ee.SET_CLIENT_ROLE,{role:e,level:r,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(ee.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(ee.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(ee.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(ee.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(ee.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Ll({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ee.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=MO.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Vi.username,password:Vi.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Ll(Ll({},Vi),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(ee.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&xR(()=>{this.emit(yi.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new et(L.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=j("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}var r;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(yi.UPDATE_GATEWAY_CONFIG),r=this.store.clientId,Ct(Bm).call(Bm,r)||Bm.push(r);const o=!(Ln()||AM(87)||p1())&&typeof j("ENABLE_PRE_SUB")=="boolean"&&j("ENABLE_PRE_SUB"),c=!p1()&&to("ENABLE_PREALLOC_PC","boolean"),l=nY(),d=Ll({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Js,browser:navigator.userAgent,process_id:j("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:j("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:Ll({enableEncodedTransform:!!j("ENABLE_AUDIO_METADATA")&&Tm(87)||!!j("ENABLE_AUDIO_TOPN")&&OI(He.CHROME,87,116)||void 0,enableAudioMetadata:!!j("ENABLE_AUDIO_METADATA")&&Tm(87),topnSmoothLevel:j("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:j("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:j("TOPN_SWITCH_HOLD_MS"),topnAudioGain:j("TOPN_AUDIO_GAIN"),enablePublishedUserList:j("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:j("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:to("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:to("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:to("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:j("USE_PUB_RTX")===!0||j("USE_SUB_RTX")===!0||void 0,disableFEC:j("DISABLE_FEC"),enableNTPReport:!!j("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!j("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!j("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:to("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!j("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!j("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:to("USE_XR","boolean"),enableLossbasedBwe:to("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!j("ENABLE_AUT_CC")||void 0,enableCCFallback:to("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:c,preSubNum:o?to("PRE_SUB_NUM","number"):void 0,enablePubTWCC:to("PUBLISH_TWCC","boolean"),enableSubTWCC:to("SUBSCRIBE_TWCC","boolean"),enablePubRTX:to("USE_PUB_RTX","boolean"),enableSubRTX:to("USE_SUB_RTX","boolean"),enableSubSVC:j("ENABLE_SVC")?j("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0,enableSvcExtended:j("ENABLE_SVC")&&Array.isArray(j("SVC_EXTENDED"))&&j("SVC_EXTENDED").length!==0?j("SVC_EXTENDED"):void 0},l)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(d.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(d.aes_mode=this.joinInfo.aesmode,j("ENCRYPT_AES")?(d.aes_secret=this.joinInfo.aespassword,d.aes_encrypt=!0):d.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(d.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(d.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(d.default_video_stream=this.joinInfo.defaultVideoStream),d}getRejoinMessage(){if(!this.joinInfo)throw new et(L.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ne.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ne.WS_RECONNECTING,e=>{this.joinInfo&&Wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Ui.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Wt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ne.WS_CLOSED,e=>{let n;switch(e){case ze.LEAVE:n=Ui.LEAVE;break;case ze.UID_BANNED:case ze.IP_BANNED:case ze.CHANNEL_BANNED:case ze.SERVER_ERROR:n=Ui.SERVER_ERROR;break;case ze.FALLBACK:n=Ui.FALLBACK;break;case ze.LICENSE_MISSING:case ze.LICENSE_EXPIRED:case ze.LICENSE_MINUTES_EXCEEDED:case ze.LICENSE_PERIOD_INVALID:case ze.LICENSE_MULTIPLE_SDK_SERVICE:case ze.LICENSE_ILLEGAL:case ze.TOKEN_EXPIRE:n=e;break;default:n=Ui.NETWORK_ERROR}b.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Ui.NETWORK_ERROR)),this.joinInfo&&Wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===ze.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==ze.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ne.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=j("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(b.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(Wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void b.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Je("EVENT_REPORT_DOMAIN",e[1]),Je("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Je("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(be.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(ne.REQUEST_RECOVER,(e,n,i)=>{if(!this.joinInfo)return i(new et(L.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,xi(this,yi.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(ne.REQUEST_JOIN_INFO,async(e,n,i)=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:o,dtlsParameters:c,rtpCapabilities:l}=await xi(this,yi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(r=this.joinInfo)===null||r===void 0?void 0:r.turnServer});try{e(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:c,rtpCapabilities:l,version:"2"}}))}catch(d){n(d)}}),this.signal.on(ne.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(ne.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let i,r="";var o;e instanceof et?(i=((o=e.data)===null||o===void 0?void 0:o.desc)||e.code,r=e.message):i=e,Wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(ne.IS_P2P_DISCONNECTED,e=>{e(Fg(this,yi.IS_P2P_DISCONNECTED))}),this.signal.on(ne.DISCONNECT_P2P,()=>{this.emit(yi.DISCONNECT_P2P)}),this.signal.on(ne.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ne.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ne.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(yi.JOIN_RESPONSE,e,n)}),this.signal.on(ne.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=j("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const i=Kx(e);this.emit(yi.PRE_CONNECT_PC,{candidates:i,fingerprint:n})}}}),this.signal.on(ne.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof j("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(j("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(ee.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(ee.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw b.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(ee.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(ee.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw b.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const n={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(ee.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,n){const i={action:e.find(r=>r.stream_type===qe.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(ee.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,n){const i={action:e.find(r=>r.stream_type===qe.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(ee.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,n){const i={action:e===xt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ee.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,n){const i={action:e===xt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ee.CONTROL,i,!0,!0)}catch(r){throw b.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(ee.RESTART_ICE,n,!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||Ui.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!j("GATEWAY_WSS_ADDRESS"))return j("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(b.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(ee.SET_PARAMETER,{enablePublishAudioFilter:e})}}let gb=0,UO=0;function Ia(t,e,n,i){return new At((r,o)=>{e.timeout=e.timeout||j("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),gb+=bc(e.data)):n&&(e.data.size?gb+=e.data.size:e.data instanceof FormData?gb+=WM(e.data):gb+=bc(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Or.request(e).then(c=>{typeof c.data=="string"?UO+=bc(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?UO+=c.data.byteLength:UO+=bc(JSON.stringify(c.data)),i&&r({data:c.data,headers:c.headers}),r(c.data)}).catch(c=>{Or.isCancel(c)?o(new et(L.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?o(new et(L.NETWORK_TIMEOUT,c.message)):c.response?o(new et(L.NETWORK_RESPONSE_ERROR,c.response.status)):o(new et(L.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(dt){var yt=0;return function(){return yt<dt.length?{done:!1,value:dt[yt++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(dt,yt,Gt){return dt==Array.prototype||dt==Object.prototype||(dt[yt]=Gt.value),dt},i,r=function(dt){dt=[typeof globalThis=="object"&&globalThis,dt,typeof window=="object"&&window,typeof self=="object"&&self,typeof g=="object"&&g];for(var yt=0;yt<dt.length;++yt){var Gt=dt[yt];if(Gt&&Gt.Math==Math)return Gt}throw Error("Cannot find global object")}(this);function o(dt,yt){if(yt)t:{var Gt=r;dt=dt.split(".");for(var ft=0;ft<dt.length-1;ft++){var A=dt[ft];if(!(A in Gt))break t;Gt=Gt[A]}(yt=yt(ft=Gt[dt=dt[dt.length-1]]))!=ft&&yt!=null&&n(Gt,dt,{configurable:!0,writable:!0,value:yt})}}function c(dt){return(dt={next:dt})[Symbol.iterator]=function(){return this},dt}function l(dt){var yt=typeof Symbol<"u"&&Symbol.iterator&&dt[Symbol.iterator];return yt?yt.call(dt):{next:e(dt)}}if(o("Symbol",function(dt){function yt(A,F){this.A=A,n(this,"description",{configurable:!0,writable:!0,value:F})}if(dt)return dt;yt.prototype.toString=function(){return this.A};var Gt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ft=0;return function A(F){if(this instanceof A)throw new TypeError("Symbol is not a constructor");return new yt(Gt+(F||"")+"_"+ft++,F)}}),o("Symbol.iterator",function(dt){if(dt)return dt;dt=Symbol("Symbol.iterator");for(var yt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Gt=0;Gt<yt.length;Gt++){var ft=r[yt[Gt]];typeof ft=="function"&&typeof ft.prototype[dt]!="function"&&n(ft.prototype,dt,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return dt}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var d;t:{var p={};try{p.__proto__={a:!0},d=p.a;break t}catch{}d=!1}i=d?function(dt,yt){if(dt.__proto__=yt,dt.__proto__!==yt)throw new TypeError(dt+" is not extensible");return dt}:null}var f=i;function S(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function v(dt){if(dt.m)throw new TypeError("Generator is already running");dt.m=!0}function y(dt,yt){return dt.h=3,{value:yt}}function P(dt){this.g=new S,this.G=dt}function I(dt,yt,Gt,ft){try{var A=yt.call(dt.g.j,Gt);if(!(A instanceof Object))throw new TypeError("Iterator result "+A+" is not an object");if(!A.done)return dt.g.m=!1,A;var F=A.value}catch(H){return dt.g.j=null,dt.g.s(H),O(dt)}return dt.g.j=null,ft.call(dt.g,F),O(dt)}function O(dt){for(;dt.g.h;)try{var yt=dt.G(dt.g);if(yt)return dt.g.m=!1,{value:yt.value,done:!1}}catch(Gt){dt.g.v=void 0,dt.g.s(Gt)}if(dt.g.m=!1,dt.g.l){if(yt=dt.g.l,dt.g.l=null,yt.F)throw yt.D;return{value:yt.return,done:!0}}return{value:void 0,done:!0}}function M(dt){this.next=function(yt){return dt.o(yt)},this.throw=function(yt){return dt.s(yt)},this.return=function(yt){return function(Gt,ft){v(Gt.g);var A=Gt.g.j;return A?I(Gt,"return"in A?A.return:function(F){return{value:F,done:!0}},ft,Gt.g.return):(Gt.g.return(ft),O(Gt))}(dt,yt)},this[Symbol.iterator]=function(){return this}}function U(dt,yt){return yt=new M(new P(yt)),f&&dt.prototype&&f(yt,dt.prototype),yt}if(S.prototype.o=function(dt){this.v=dt},S.prototype.s=function(dt){this.l={D:dt,F:!0},this.h=this.C||this.u},S.prototype.return=function(dt){this.l={return:dt},this.h=this.u},P.prototype.o=function(dt){return v(this.g),this.g.j?I(this,this.g.j.next,dt,this.g.o):(this.g.o(dt),O(this))},P.prototype.s=function(dt){return v(this.g),this.g.j?I(this,this.g.j.throw,dt,this.g.o):(this.g.s(dt),O(this))},o("Array.prototype.entries",function(dt){return dt||function(){return function(yt,Gt){yt instanceof String&&(yt+="");var ft=0,A=!1,F={next:function(){if(!A&&ft<yt.length){var H=ft++;return{value:Gt(H,yt[H]),done:!1}}return A=!0,{done:!0,value:void 0}}};return F[Symbol.iterator]=function(){return F},F}(this,function(yt,Gt){return[yt,Gt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var W=function(dt,yt){for(var Gt=0;Gt<dt.length;Gt++)yt(dt[Gt])},Q=function(dt){return dt.replace(/\r?\n|\r/g,`\r
`)},X=function(dt,yt,Gt){return yt instanceof Blob?(Gt=Gt!==void 0?Gt+"":typeof yt.name=="string"?yt.name:"blob",yt.name===Gt&&Object.prototype.toString.call(yt)!=="[object Blob]"||(yt=new File([yt],Gt)),[String(dt),yt]):[String(dt),String(yt)]},Y=function(dt,yt){if(dt.length<yt)throw new TypeError(yt+" argument required, but only "+dt.length+" present.")},ot=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Et=ot.FormData,Ot=ot.XMLHttpRequest&&ot.XMLHttpRequest.prototype.send,Lt=ot.Request&&ot.fetch,Ce=ot.navigator&&ot.navigator.sendBeacon,Ae=ot.Element&&ot.Element.prototype,dn=ot.Symbol&&Symbol.toStringTag;dn&&(Blob.prototype[dn]||(Blob.prototype[dn]="Blob"),"File"in ot&&!File.prototype[dn]&&(File.prototype[dn]="File"));try{new File([],"")}catch{ot.File=function(yt,Gt,ft){return yt=new Blob(yt,ft||{}),Object.defineProperties(yt,{name:{value:Gt},lastModified:{value:+(ft&&ft.lastModified!==void 0?new Date(ft.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),dn&&Object.defineProperty(yt,dn,{value:"File"}),yt}}var Kn=function(dt){return dt.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Un=function(dt){this.i=[];var yt=this;dt&&W(dt.elements,function(Gt){if(Gt.name&&!Gt.disabled&&Gt.type!=="submit"&&Gt.type!=="button"&&!Gt.matches("form fieldset[disabled] *"))if(Gt.type==="file"){var ft=Gt.files&&Gt.files.length?Gt.files:[new File([],"",{type:"application/octet-stream"})];W(ft,function(A){yt.append(Gt.name,A)})}else Gt.type==="select-multiple"||Gt.type==="select-one"?W(Gt.options,function(A){!A.disabled&&A.selected&&yt.append(Gt.name,A.value)}):Gt.type==="checkbox"||Gt.type==="radio"?Gt.checked&&yt.append(Gt.name,Gt.value):(ft=Gt.type==="textarea"?Q(Gt.value):Gt.value,yt.append(Gt.name,ft))})};if((t=Un.prototype).append=function(dt,yt,Gt){Y(arguments,2),this.i.push(X(dt,yt,Gt))},t.delete=function(dt){Y(arguments,1);var yt=[];dt=String(dt),W(this.i,function(Gt){Gt[0]!==dt&&yt.push(Gt)}),this.i=yt},t.entries=function dt(){var yt,Gt=this;return U(dt,function(ft){if(ft.h==1&&(yt=0),ft.h!=3)return yt<Gt.i.length?ft=y(ft,Gt.i[yt]):(ft.h=0,ft=void 0),ft;yt++,ft.h=2})},t.forEach=function(dt,yt){Y(arguments,1);for(var Gt=l(this),ft=Gt.next();!ft.done;ft=Gt.next()){var A=l(ft.value);ft=A.next().value,A=A.next().value,dt.call(yt,A,ft,this)}},t.get=function(dt){Y(arguments,1);var yt=this.i;dt=String(dt);for(var Gt=0;Gt<yt.length;Gt++)if(yt[Gt][0]===dt)return yt[Gt][1];return null},t.getAll=function(dt){Y(arguments,1);var yt=[];return dt=String(dt),W(this.i,function(Gt){Gt[0]===dt&&yt.push(Gt[1])}),yt},t.has=function(dt){Y(arguments,1),dt=String(dt);for(var yt=0;yt<this.i.length;yt++)if(this.i[yt][0]===dt)return!0;return!1},t.keys=function dt(){var yt,Gt,ft,A,F=this;return U(dt,function(H){if(H.h==1&&(yt=l(F),Gt=yt.next()),H.h!=3)return Gt.done?void(H.h=0):(ft=Gt.value,A=l(ft),y(H,A.next().value));Gt=yt.next(),H.h=2})},t.set=function(dt,yt,Gt){Y(arguments,2),dt=String(dt);var ft=[],A=X(dt,yt,Gt),F=!0;W(this.i,function(H){H[0]===dt?F&&(F=!ft.push(A)):ft.push(H)}),F&&ft.push(A),this.i=ft},t.values=function dt(){var yt,Gt,ft,A,F=this;return U(dt,function(H){if(H.h==1&&(yt=l(F),Gt=yt.next()),H.h!=3)return Gt.done?void(H.h=0):(ft=Gt.value,(A=l(ft)).next(),y(H,A.next().value));Gt=yt.next(),H.h=2})},Un.prototype._asNative=function(){for(var dt=new Et,yt=l(this),Gt=yt.next();!Gt.done;Gt=yt.next()){var ft=l(Gt.value);Gt=ft.next().value,ft=ft.next().value,dt.append(Gt,ft)}return dt},Un.prototype._blob=function(){var dt="----formdata-polyfill-"+Math.random(),yt=[],Gt="--"+dt+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ft,A){return typeof ft=="string"?yt.push(Gt+Kn(Q(A))+`"\r
\r
`+Q(ft)+`\r
`):yt.push(Gt+Kn(Q(A))+'"; filename="'+Kn(ft.name)+`"\r
Content-Type: `+(ft.type||"application/octet-stream")+`\r
\r
`,ft,`\r
`)}),yt.push("--"+dt+"--"),new Blob(yt,{type:"multipart/form-data; boundary="+dt})},Un.prototype[Symbol.iterator]=function(){return this.entries()},Un.prototype.toString=function(){return"[object FormData]"},Ae&&!Ae.matches&&(Ae.matches=Ae.matchesSelector||Ae.mozMatchesSelector||Ae.msMatchesSelector||Ae.oMatchesSelector||Ae.webkitMatchesSelector||function(dt){for(var yt=(dt=(this.document||this.ownerDocument).querySelectorAll(dt)).length;0<=--yt&&dt.item(yt)!==this;);return-1<yt}),dn&&(Un.prototype[dn]="FormData"),Ot){var kr=ot.XMLHttpRequest.prototype.setRequestHeader;ot.XMLHttpRequest.prototype.setRequestHeader=function(dt,yt){kr.call(this,dt,yt),dt.toLowerCase()==="content-type"&&(this.B=!0)},ot.XMLHttpRequest.prototype.send=function(dt){dt instanceof Un?(dt=dt._blob(),this.B||this.setRequestHeader("Content-Type",dt.type),Ot.call(this,dt)):Ot.call(this,dt)}}Lt&&(ot.fetch=function(dt,yt){return yt&&yt.body&&yt.body instanceof Un&&(yt.body=yt.body._blob()),Lt.call(this,dt,yt)}),Ce&&(ot.navigator.sendBeacon=function(dt,yt){return yt instanceof Un&&(yt=yt._asNative()),Ce.call(this,dt,yt)}),ot.FormData=Un}})();const eS=()=>{const t=j("AREAS");return t.length===0&&t.push(je.GLOBAL),Hi(t).call(t,(e,n,i)=>{const r=r2(n);return r?i===0?r:"".concat(e,",").concat(r):e},"")},r2=t=>t===je.OVERSEA?"".concat(Yi.ASIA,",").concat(Yi.EUROPE,",").concat(Yi.AFRICA,",").concat(Yi.NORTH_AMERICA,",").concat(Yi.SOUTH_AMERICA,",").concat(Yi.OCEANIA):Yi[t],Sb={GLOBAL:{ASIA:[je.CHINA,je.JAPAN,je.INDIA,je.KOREA,je.HKMC],EUROPE:[],NORTH_AMERICA:[je.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Tb=Object.keys(Sb[je.GLOBAL]),xO=[je.CHINA,je.NORTH_AMERICA,je.EUROPE,je.ASIA,je.JAPAN,je.INDIA,je.OCEANIA,je.SOUTH_AMERICA,je.AFRICA,je.KOREA,je.HKMC,je.US],rY=function(t,e){let n=[];if(Ct(t).call(t,je.GLOBAL)){const o=[je.GLOBAL,je.OVERSEA],c=Object.keys(ub);if(e===je.GLOBAL)throw new et(L.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===je.CHINA)n=[je.OVERSEA];else if(r=e,Ct(Tb).call(Tb,r)){const l=(i=e,Sb[je.GLOBAL][i]||[]),d=[...o,e,...l];n=c.filter(p=>!Ct(d).call(d,p))}else if(function(l){let d=!1;return Tb.forEach(p=>{var f;Ct(f=Sb[je.GLOBAL][p]).call(f,l)&&(d=!0)}),d}(e)){const l=function(p){let f;return Tb.forEach(S=>{var v;Ct(v=Sb[je.GLOBAL][S]).call(v,p)&&(f=S)}),f}(e),d=[...o,l,e];n=c.filter(p=>!Ct(d).call(d,p))}else n=t;n=function(l){const d=[];return xO.forEach(p=>{Ct(l).call(l,p)&&d.push(p)}),d.concat(l.filter(p=>!Ct(xO).call(xO,p)))}(n)}else n=t;var i,r;return n};function s2(t){var e,n;if(!t&&Ct(e=j("AREAS")).call(e,je.EXTENSIONS))return b.debug("update area from ap : reset"),void VO(fz,!0);if(!Ct(n=j("AREAS")).call(n,je.GLOBAL)||!t)return;let i=ub.EXTENSIONS;i&&(i={CODE:r2(je.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},b.debug("update area from ap success: ".concat(t,",config is "),i),Je("AREAS",[je.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?Je(r,i[r][0]):Je(r,i[r])}))}function VO(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Wt.reportApiInvoke(null,{name:ii.SET_AREA,options:t,tag:Dn.TRACER});try{let i=[];if(typeof t=="string"&&(i=[t]),Array.isArray(t)&&(t.forEach(o=>{if(!Ct(Cx).call(Cx,o))throw new et(L.INVALID_PARAMS,"invalid area code")}),i=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:o,excludedArea:c}=t;if(!o)throw new et(L.INVALID_PARAMS,"area code is needed");let l=o;typeof o=="string"&&(l=[o]),i=c?rY(l,c):l}if(!e){if(ba.AREAS){const o=new et(L.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(o),void b.warning("setArea is prohibited because of config-distribute")}if(Ct(i).call(i,je.GLOBAL)&&j("AREAS")===je.EXTENSIONS){const o=new et(L.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(o),void b.warning("setArea is prohibited because of ap extensions")}}Je("AREAS",i,e);const r=(o=>{const c={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return o.map(l=>{const d=ub[l],p=Object.keys(d);p&&p.map(f=>{f!=="CODE"&&(c[f]=c[f].concat(d[f]))})}),c})(i);Object.keys(r).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?Je(o,r[o][0]):Je(o,r[o])}),b.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function o2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Nc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?o2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let BO=1;function sY(t,e,n,i,r){BO+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:BO,requestId:BO,version:Js,cname:n.cname},c={service_name:e,json_body:JSON.stringify(o)};let l,d,p=t[0];return Ra(async()=>{l=Date.now();const f=await Ia(p,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-l,f.code!==0){const y=new et(L.UNEXPECTED_RESPONSE,"live streaming ap error, code"+f.code,{retry:!0,responseTime:d});throw b.error(y.toString()),y}const S=JSON.parse(f.json_body);if(S.code!==200){const y=new et(L.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(S.code,", reason: ").concat(S.reason),{code:S.code,responseTime:d});throw b.error(y.toString()),y}if(!S.servers||S.servers.length===0){const y=new et(L.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:S.code,responseTime:d});throw b.error(y.toString()),y}const v=function(y,P){return{addressList:y.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(P))),workerToken:y.workerToken,vid:y.vid}}(S,e);return j("LIVE_STREAMING_ADDRESS")&&(v.addressList=j("LIVE_STREAMING_ADDRESS")instanceof Array?j("LIVE_STREAMING_ADDRESS"):[j("LIVE_STREAMING_ADDRESS")]),Nc(Nc({},v),{},{responseTime:d})},(f,S)=>(Wt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(f.addressList),firstSuccess:S===0,responseTime:d,serverIp:t[S%t.length]}),!1),(f,S)=>(Wt.apworkerEvent(n.sid,{success:!1,sc:f.data&&f.data.code||200,serviceName:e,responseTime:d,serverIp:t[S%t.length]}),!!(f.code!==L.OPERATION_ABORTED&&f.code!==L.UNEXPECTED_RESPONSE||f.data&&f.data.retry)&&(p=t[(S+1)%t.length],!0)),r)}let jO=1;function a2(t,e,n,i){let{url:r,areaCode:o}=t;const{clientId:c,sid:l}=e,d=Date.now();let p;const f=e.role,[S,v]=GO(e,o,[Jn.CHOOSE_SERVER]);let y=Xn.networkState;return Ra(async()=>{y&&Xn.networkState===hs.OFFLINE&&Xn.onlineWaiter&&await At.race([Xn.onlineWaiter,Ni(i&&i.maxRetryTimeout||ri.maxRetryTimeout)]),y=Xn.networkState;const{data:P,headers:I}=await Ia(r,{data:S,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=I.http3==="1"?1:-1,Wt.reportResourceTiming(r,l),l2(P,r,e,d,[Jn.CHOOSE_SERVER],p);const O=Zg(P,Jn.CHOOSE_SERVER);return FO(O),NO(O,r)},P=>(P&&Wt.joinChooseServer(l,{role:f,lts:d,succ:!0,csAddr:r,opid:v,serverList:P.gatewayAddrs.map(I=>I.address),ec:null,cid:P.cid.toString(),uid:P.uid.toString(),csIp:P.csIp,unilbsServerIds:[Jn.CHOOSE_SERVER].toString(),isHttp3:p,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:P.res.detail&&P.res.detail[38]}),!1),P=>P.code!==L.OPERATION_ABORTED&&(P.code===L.CAN_NOT_GET_GATEWAY_SERVER?P.data.retry:(Wt.joinChooseServer(l,{role:f,lts:d,succ:!1,csAddr:r,serverList:null,opid:v,ec:P.code,csIp:P.data&&P.data.csIp,unilbsServerIds:[Jn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:y}),isHttp3:p,corssRegionTagReq:e.apRequestDetail}),b.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),P),!0)),i)}function c2(t,e,n,i){let r,{url:o,areaCode:c,serviceIds:l}=t;const d=Date.now(),p=e.role,[f,S]=GO(e,c,l);let v;return Ra(async()=>{v&&Xn.networkState===hs.OFFLINE&&Xn.onlineWaiter&&await At.race([Xn.onlineWaiter,Ni(i&&i.maxRetryTimeout||ri.maxRetryTimeout)]),v=Xn.networkState;const{data:y,headers:P}=await Ia(o,{data:f,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=P.http3==="1"?1:-1,Wt.reportResourceTiming(o,e.sid),l2(y,o,e,d,l,r);const I=Zg(y,Jn.CHOOSE_SERVER),O=Zg(y,e.cloudProxyServer==="proxy5"?Jn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Jn.CLOUD_PROXY:Jn.CLOUD_PROXY_FALLBACK);return FO(I),{gatewayInfo:NO(I,o),proxyInfo:O,url:o}},y=>(y.gatewayInfo&&Wt.joinChooseServer(e.sid,{role:p,lts:d,succ:!0,csAddr:o,serverList:y.gatewayInfo.gatewayAddrs.map(P=>P.address),ec:null,opid:S,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:r,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:y.gatewayInfo.res.detail&&y.gatewayInfo.res.detail[38]}),y.proxyInfo&&Wt.joinWebProxyAP(e.sid,{lts:d,sucess:1,apServerAddr:o,turnServerAddrList:y.proxyInfo.addresses.map(P=>P.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:l.toString()}),!1),y=>y.code!==L.OPERATION_ABORTED&&(y.code===L.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(Wt.joinWebProxyAP(e.sid,{lts:d,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:y.code,eventType:e.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:v})}),b.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),y),!0)),i)}const l2=(t,e,n,i,r,o)=>{const{sid:c,clientId:l,cloudProxyServer:d}=n,p=[],f=S=>{S.flag===4096?Wt.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:S.error.message,csIp:S.error.data&&S.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:o,corssRegionTagReq:n.apRequestDetail}):S.flag!==1048576&&S.flag!==4194304&&S.flag!==4194310||Wt.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:S.error.code,eventType:d,unilbsServerIds:r.toString()})};if(t.response_body.forEach(S=>{const v=S.buffer.code;if(S.uri===23&&v===0&&!S.buffer.edges_services)if(S.buffer.flag===4194310)b.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),S.buffer.edges_services=[];else{const y={error:new et(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:S.buffer.flag};p.push(y),f(y)}if(v!==0){const y=Hm(v),P={error:new et(L.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:t.detail[502]}),flag:S.buffer.flag};S.buffer.flag===4194310?b.warning(P.error.toString()):p.push(P),f(P)}}),p.length)throw b.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(p.map(S=>"flag: ".concat(S.flag,", message: ").concat(S.error.message,", retry: ").concat(S.error.data.retry)).join(" | "))),new et(L.CAN_NOT_GET_GATEWAY_SERVER,p.map(S=>"flag: ".concat(S.flag,", message: ").concat(S.error.message)).join(" | "),{retry:!!p.find(S=>S.error.data.retry),csIp:t.detail[502],desc:[...new Set(p.map(S=>{var v;return S==null||(v=S.error)===null||v===void 0||(v=v.data)===null||v===void 0?void 0:v.desc}).filter(S=>!!S))]})},FO=t=>{var e,n,i,r;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new et(L.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(j("AP_AREA")&&((i=t.detail)!==null&&i!==void 0&&i[23]&&typeof((r=t.detail)===null||r===void 0?void 0:r[23])=="string"?s2(t.detail[23].toLowerCase()):s2()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const c=t.detail[19],l=c==null?void 0:c.split(";");for(let d=0;d<l.length;d++){var o;const p=ar(o=l[d]).call(o);t.addresses[d]&&l&&(t.addresses[d].fingerprint=p)}}if(j("GATEWAY_ADDRESS")&&j("GATEWAY_ADDRESS").length>0){b.debug("assign gateway address to",j("GATEWAY_ADDRESS"));const c=j("GATEWAY_ADDRESS").map(l=>{var d,p;const f=(d=(p=t.addresses.find(S=>S.ip===l.ip&&S.port===l.port))===null||p===void 0?void 0:p.fingerprint)!==null&&d!==void 0?d:"";return{ip:l.ip,port:l.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:f}});t.addresses=c}},oY=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const i=Hm(n.buffer.code);throw new et(L.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw b.debug("update ticket request received ap response without response body:",e),new et(L.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},GO=(t,e,n)=>{const i=Math.floor(Math.random()*1e12),r=t.role==="host"?"1":t.role==="audience"?"2":void 0,o={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Nc(Nc(Nc({6:t.stringUid,11:e,12:j("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};o.request_bodies.forEach(l=>{t.multiIP&&t.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]},aY=(t,e)=>{const n=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(o=>({ip:o.ip,port:o.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let qm=0;function Xm(t){return At.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const nS=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:o}=t,c=0;const l=e;let d,p=0;const f=async()=>{const S=(()=>{const v=c*l,y=v+l;return n.slice(v,y).map(i)})();o&&o.push(...S);try{d=await Xm(S)}catch(v){if(p+=l,c++,!(p>=n.length))return void await f();r(v)}S.forEach(v=>v.cancel())};return await f(),d},u2=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:i}=t;const r=e.length;let o=0;const c=async()=>{const l=n(e.shift());try{return await l}catch(d){if(o++,o>=r||i!=null&&i(d))throw d;return c()}};return c()};async function HO(t,e,n,i){return{gatewayInfo:await async function(o,c,l,d){let p=null;const f=[],S=async()=>{const y=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(O=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:eS()})),P=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),I=await nS({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(b.debug("[".concat(o.clientId,"] Connect to choose_server:"),O.url),a2(O,o,c,l)),allFailedhandler:O=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},P),O[0]},promisesCollector:f});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I},v=async()=>{if(await Ni(1e3),p!==null)return p;const y=j("WEBCS_DOMAIN_BACKUP_LIST").map(O=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:eS()})),P=d.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),I=await nS({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(b.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),O.url),a2(O,o,c,l)),allFailedhandler:O=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},P),O[0]},promisesCollector:f});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I};try{return p=await Xm([S(),v()]),f.length&&f.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),p}catch(y){throw y[0]}}(t,e,n,i)}}async function d2(t,e,n,i,r){const o=t.cloudProxyServer;if(o==="disabled"){if(t.useLocalAccessPoint)return await HO(t,e,n,r);if(j("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:v,proxyInfo:y}=await f2(t,e,n,r);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:v};const P=y.map(I=>({turnServerURL:I.address,tcpport:I.tcpport||Vi.tcpport,udpport:I.udpport||Vi.udpport,username:I.username||Vi.username,password:I.password||Vi.password,forceturn:!1,security:!0}));if(r.useP2P){var c;const I=(c=t.uid)!==null&&c!==void 0?c:v.uid,O="glb:".concat(I.toString()),M=await xI(O),U=y.map(W=>({turnServerURL:W.address,tcpport:W.tcpport||Vi.tcpport,udpport:W.udpport||Vi.udpport,username:O,password:M,forceturn:!1,security:!0}));P.push(...U)}return t.turnServer={mode:"manual",servers:P},{gatewayInfo:v}}return await HO(t,e,n,r)}const{proxyInfo:l,gatewayInfo:d}=await f2(t,e,n,r),p={gatewayInfo:d},f=l.map(v=>({turnServerURL:v.address,tcpport:o==="proxy3"?void 0:v.tcpport?v.tcpport:Vi.tcpport,udpport:o==="proxy4"?void 0:v.udpport?v.udpport:Vi.udpport,username:v.username||Vi.username,password:v.password||Vi.password,forceturn:o!=="proxy4",security:o==="proxy5"}));if(r.useP2P){var S;const v=(S=t.uid)!==null&&S!==void 0?S:d.uid,y="glb:".concat(v.toString()),P=await xI(y),I=l.map(O=>({turnServerURL:O.address,tcpport:o==="proxy3"?void 0:O.tcpport||Vi.tcpport,udpport:o==="proxy4"?void 0:O.udpport||Vi.udpport,username:y,password:P,forceturn:o!=="proxy4",security:o==="proxy5"}));f.push(...I)}return t.turnServer={mode:"manual",servers:f},b.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(o)),p}async function h2(t,e,n,i,r){const o=j("ACCOUNT_REGISTER").slice(0,j("AJAX_REQUEST_CONCURRENT"));let c=[];c=e.proxyServer?o.map(d=>"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1")):o.map(d=>"https://".concat(d,"/api/v1"));const l=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const d=await async function(p,f,S,v,y){const P=Date.now(),I={sid:S.sid,opid:10,appid:S.appId,string_uid:f};let O=p[0];const M=await Ra(()=>Ia(O+"".concat(O.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,W)=>{if(U.code===0){if(U.uid<=0||U.uid>=Math.pow(2,32))throw b.error("Invalid Uint Uid ".concat(f," => ").concat(U.uid),U),Wt.reqUserAccount(I.sid,{lts:P,success:!1,serverAddr:O,stringUid:I.string_uid,uid:U.uid,errorCode:L.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new et(L.INVALID_UINT_UID_FROM_STRING_UID);return Wt.reqUserAccount(I.sid,{lts:P,success:!0,serverAddr:O,stringUid:I.string_uid,uid:U.uid,errorCode:null,extend:I}),!1}const Q=Hm(U.code);return Q.retry&&(O=p[(W+1)%p.length]),Wt.reqUserAccount(I.sid,{lts:P,success:!1,serverAddr:O,stringUid:I.string_uid,uid:U.uid,errorCode:Q.desc,extend:I}),Q.retry},(U,W)=>U.code!==L.OPERATION_ABORTED&&(Wt.reqUserAccount(I.sid,{lts:P,success:!1,serverAddr:O,stringUid:I.string_uid,uid:null,errorCode:U.code,extend:I}),O=p[(W+1)%p.length],!0),y);if(M.code!==0){const U=Hm(M.code);throw new et(L.UNEXPECTED_RESPONSE,U.desc)}return M}(c,t,e,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},l),d.uid}catch(d){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},l),d}}async function cY(t,e,n){const i=j("ACCOUNT_REGISTER");let r=[];r=e.proxyServer?i.map(o=>"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1")):i.map(o=>"https://".concat(o,"/api/v1"));try{return await u2({referenceList:r,asyncMapHandler:c=>async function(l,d,p,f){const S=Date.now(),v={sid:p.sid,opid:10,appid:p.appId,string_uid:d};try{const y=await Ia(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(y.code!==0){const P=Hm(y.code);throw new et(L.UNEXPECTED_RESPONSE,"preload sua error:".concat(P.desc),P)}if(y.uid<=0||y.uid>=Math.pow(2,32))throw new et(L.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:S,url:l,req:v,uid:y.uid,elapse:Date.now()-S}}catch(y){throw y}}(c,t,e,n),closeFn:c=>c.code===L.OPERATION_ABORTED||c.code===L.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(o){throw o}}async function lY(t,e,n){const i=j("CDS_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),r=i.map(d=>function(p,f,S,v){const y=Me(),P={flag:64,cipher_method:0,features:Nc(Nc(Nc(Nc(Nc({install_id:qI(),device:y.name,system:y.os,system_general:navigator.userAgent,vendor:f.appId,version:Js,cname:f.cname,session_id:f.sid,proxyServer:f.proxyServer,sdk_type:eY.WEB_RTC,browser_name:y.name,browser_version:y.version,user_agent:navigator.userAgent,channel_name:f.cname},f.stringUid&&{string_uid:f.stringUid}),f.uid&&{uid:f.uid+""}),y.os&&{os_name:y.os}),y.osVersion&&{os_version:y.osVersion}),{},{detail:""})};return Ra(()=>Ia(p,{data:P,timeout:1e3,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,I=>I.code!==L.OPERATION_ABORTED,v)}(d,t,e,n));let o=null,c=null,l={};try{o=await Xm(r)}catch(d){if(d.code===L.OPERATION_ABORTED)throw d;c=d}if(r.forEach(d=>d.cancel()),Wt.reportApiInvoke(t.sid,{name:ii.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:o}}).onSuccess(),o&&o.test_tags)try{l=function(d){if(!d.test_tags)return{};const p=d.test_tags,f=Object.keys(p),S={};return f.forEach(v=>{var y;const P=ar(y=v.slice(4)).call(y),I=JSON.parse(p[v]),O=I[1];S[P]={tag:I[0]||"",value:O}}),S}(o)}catch{}return l}async function p2(t,e){const n=j("WEBCS_DOMAIN").concat(j("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:eS(),serviceIds:[Jn.CHOOSE_SERVER,Jn.CLOUD_PROXY_FALLBACK]}));try{return await u2({referenceList:n,asyncMapHandler:r=>async function(o,c,l){let d,{url:p,areaCode:f,serviceIds:S}=o;const v=Date.now(),[y,P]=GO(c,f,S);let I=Xn.networkState;try{I&&Xn.networkState===hs.OFFLINE&&Xn.onlineWaiter&&await At.race([Xn.onlineWaiter,Ni(ri.maxRetryTimeout)]),I=Xn.networkState;const{data:O,headers:M}=await Ia(p,{data:y,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=M.http3==="1"?1:-1,(X=>{const Y=[];if(X.response_body.forEach(ot=>{const Et=ot.buffer.code;if(ot.uri===23&&Et===0&&!ot.buffer.edges_services)if(ot.buffer.flag===4194310)ot.buffer.edges_services=[];else{const Ot={error:new et(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:X.detail[502]}),flag:ot.buffer.flag};Y.push(Ot)}if(Et!==0){const Ot=Hm(Et),Lt={error:new et(L.CAN_NOT_GET_GATEWAY_SERVER,Ot.desc,{desc:Ot.desc,retry:Ot.retry,csIp:X.detail[502]}),flag:ot.buffer.flag};ot.buffer.flag===4194310?b.warning(Lt.error.toString()):Y.push(Lt)}}),Y.length)throw new et(L.CAN_NOT_GET_GATEWAY_SERVER,Y.map(ot=>"flag: ".concat(ot.flag,", message: ").concat(ot.error.message)).join(" | "),{retry:!!Y.find(ot=>ot.error.data.retry),csIp:X.detail[502],desc:[...new Set(Y.map(ot=>{var Et;return ot==null||(Et=ot.error)===null||Et===void 0||(Et=Et.data)===null||Et===void 0?void 0:Et.desc}).filter(ot=>!!ot))]})})(O);const W=Zg(O,Jn.CHOOSE_SERVER),Q=Zg(O,Jn.CLOUD_PROXY_FALLBACK);return FO(W),{gatewayInfo:NO(W,p),proxyInfo:Q,opid:P,requestTime:v,url:p,isHttp3:d,elapse:Date.now()-v}}catch(O){throw O}}(r,t,e),closeFn:r=>r.code===L.OPERATION_ABORTED||r.code===L.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function f2(t,e,n,i){const r=j("PROXY_SERVER_TYPE3"),o=(y,P,I)=>{let O=I||r;return Array.isArray(O)&&(O=P%2==0?r[1]:r[0]),"https://".concat(O,"/ap/?url=").concat(y)};let c=null;const l=[],d=async()=>{const y=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map((O,M)=>{let U;return U=t.cloudProxyServer==="disabled"&&t.proxyServer?o("".concat(O,"/api/v2/transpond/webrtc?v=2"),M,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):o("".concat(O,"/api/v2/transpond/webrtc?v=2"),M),{url:U,areaCode:eS(),serviceIds:[Jn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Jn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Jn.CLOUD_PROXY:Jn.CLOUD_PROXY_FALLBACK]}}),P=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),I=await nS({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(b.debug("[".concat(t.clientId,"] Connect to choose_server:"),O.url),c2(O,t,e,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},P),O[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I},p=async()=>{if(await Ni(1e3),c!==null)return c;const y=j("WEBCS_DOMAIN_BACKUP_LIST").map((O,M)=>{let U;return U=t.cloudProxyServer==="disabled"&&t.proxyServer?o("".concat(O,"/api/v2/transpond/webrtc?v=2"),M,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):o("".concat(O,"/api/v2/transpond/webrtc?v=2"),M),{url:U,areaCode:eS(),serviceIds:[Jn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Jn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Jn.CLOUD_PROXY:Jn.CLOUD_PROXY_FALLBACK]}}),P=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),I=await nS({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(b.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),O.url),c2(O,t,e,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},P),O[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},P),I};let f,S,v;try{({gatewayInfo:f,proxyInfo:S,url:v}=await Xm([d(),p()]))}catch(y){throw y[0]}if(l.length&&l.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!f||!S)throw new et(L.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=v,t.cloudProxyServer!=="disabled"&&Array.isArray(r)&&v){const y=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1];Ct(r).call(r,y)&&(t.proxyServer=y,b.setProxyServer(y),Wt.setProxyServer(y))}return c={gatewayInfo:f,proxyInfo:await Vx(S,f.uid)},c}async function uY(t,e,n){const i=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(o=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")),r=i.map(o=>function(c,l,d,p){const f={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:Js,cname:l.cname,uid:l.uid.toString(),requestId:jO,seq:jO};jO+=1;const S={service_name:"tele_channel",json_body:JSON.stringify(f)};return Ra(async()=>{const v=await Ia(c,{data:S,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(v.code!==0){const P=new et(L.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw b.error(P.toString()),P}const y=JSON.parse(v.json_body);if(y.code!==200){const P=new et(L.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw b.error(P.toString()),P}if(!y.servers||y.servers.length===0){const P=new et(L.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw b.error(P.toString()),P}return{vid:y.vid,workerToken:y.workerToken,addressList:(j("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(P.wss))}},void 0,v=>!!(v.code!==L.OPERATION_ABORTED&&v.code!==L.UNEXPECTED_RESPONSE||v.data&&v.data.retry),p)}(o,t,e,n));try{const o=await Xm(r);return r.forEach(c=>c.cancel()),o}catch(o){throw o[0]}}async function dY(t,e,n){let i=null;const r=[],o=async c=>{const l=j(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return c&&(await Ni(1e3),i!==null)?i:await nS({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:d=>(b.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),d),function(p,f,S,v){const[y]=aY(f,[Jn.CHOOSE_SERVER]);let P=Xn.networkState;return Ra(async()=>{P&&Xn.networkState===hs.OFFLINE&&Xn.onlineWaiter&&await At.race([Xn.onlineWaiter,Ni(v&&v.maxRetryTimeout||ri.maxRetryTimeout)]),P=Xn.networkState;const I=await Ia(p,{data:y,cancelToken:S,headers:{"Content-Type":"multipart/form-data;"}},!0);return oY(I,p)},()=>!1,I=>I.code!==L.OPERATION_ABORTED&&(I.code===L.UPDATE_TICKET_FAILED?I.data.retry:(b.warning("[".concat(f.clientId,"] update ticket network error, retry"),I),!0)),v)}(d,t,e,n)),allFailedhandler:d=>{throw d[0]},promisesCollector:r})};try{return i=await Xm([o(!1),o(!0)]),r.length&&r.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function m2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function WO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?m2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class hY extends An{get isSuccess(){return!!this.configs}constructor(e,n){super(),D(this,"configs",void 0),D(this,"store",void 0),D(this,"joinInfo",void 0),D(this,"cancelToken",void 0),D(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),D(this,"interval",void 0),D(this,"mutex",void 0),D(this,"mutableParamsRead",!1),D(this,"configCache",{}),D(this,"limit_bitrate",void 0),this.mutex=new zi("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),j("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},j("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Wt.reportApiInvoke(null,{options:void 0,name:ii.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Dn.TRACER}).onSuccess(JSON.stringify(ba))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void b.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await lY(this.joinInfo,this.cancelToken,this.retryConfig),b.debug("[config-distribute] get config distribute",JSON.stringify(e));const i=function(r){var o;const c=Cg(o=Object.keys(r).filter(p=>/^webrtc_ng_global_parameter/.test(p))).call(o);for(let p=0;p<c.length;p++)for(let f=c.length-1;f>p;f--){const S=c[f],v=r[S].value;if(typeof v.__priority=="number"){const y=v.__priority,P=c[f-1],I=r[P].value;if(typeof I.__priority=="number"){if(!(y>I.__priority))continue;{const O=S;c[f]=c[f-1],c[f-1]=O}}else{const O=S;c[f]=c[f-1],c[f-1]=O}}}const l=Date.now();let d={};return c.forEach(p=>{const f=r[p].value.__expires;f&&f<=l||(d[p]=r[p])}),d}(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const r=new et(L.NETWORK_RESPONSE_ERROR,i);b.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){Ax(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(Xg.UPDATE_BITRATE_LIMIT,e):this.emit(Xg.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&WO({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},i=Object.keys(e),r=[];i.forEach(o=>{const c=e[o].value;n[o]=c;const l=c.__id;if(l&&this.configCache[o]&&this.configCache[o].__id===l)return;const d=c.__type,p=e[o].value,f=e[o].tag;let S=0;d?d===o1.REALTIME&&(S=1):Object.keys(p).some(v=>Object.prototype.hasOwnProperty.call(ZI,v)||!TO()&&Object.prototype.hasOwnProperty.call(GR,v)?(S=1,!0):void 0),r.push({tag:f,isApplied:S,feature:o,params:JSON.stringify(c)})}),r.forEach(o=>{let{tag:c,feature:l,params:d,isApplied:p}=o;this.store.sessionId&&Wt.abTest(this.store.sessionId,{intSucc:1,isApplied:p,tag:c,feature:l,params:d,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){b.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(r){const o={};return Object.keys(r).forEach(c=>{const l=r[c].value,d=l.__expires,p=l.__type;Object.keys(l).forEach(f=>{f==="__id"||f==="__type"||f==="__priority"||f==="__expires"||Object.prototype.hasOwnProperty.call(o,f)||(o[f]=WO(WO({value:l[f]},d&&{expires:d}),p&&{type:p}))})}),o}(e);try{var i;const r=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,r&&Ax(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(l){try{const d=Date.now();Object.keys(l).forEach(p=>{const{value:f,type:S,expires:v}=l[p];v&&v<=d||((S===o1.REALTIME||Object.prototype.hasOwnProperty.call(ZI,p))&&(ba[p]=f,wn[p]=f,b.debug("Update realtime parameters from config distribute",p,f)),S||TO()||!Object.prototype.hasOwnProperty.call(GR,p)||(ba[p]=f,wn[p]=f,b.debug("Update gateway parameters from config distribute",p,f)))})}catch(d){b.error("Error update config immediately: ".concat(l),d.message)}}(n);const o=JSON.stringify(n),c=window.btoa(o);window.localStorage.setItem("websdk_ng_global_parameter",c),b.debug("Caching global parameters ".concat(o))}catch(r){b.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(wn,i)){const{value:r,expires:o}=e[i];if(o&&o<=n)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(wn[i],r)||(ba[i]=r,wn[i]=r,this.emit(Xg.UPDATE_CLIENT_ROLE_OPTIONS,r),b.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(n){b.error("Error handling global parameter config:",n.message)}}}class pY extends An{constructor(){super(...arguments),D(this,"resultStorage",new Map)}setLocalAudioStats(e,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(e,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,n){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(e,n,i){if(j("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(i),r.result.length>=5)){var o;const c=Ct(o=r.result).call(o,!0);r.isPrevNormal&&!c&&this.emit("exception",_2[e],e,n),!r.isPrevNormal&&c&&this.emit("exception",_2[e]+2e3,e+"_RECOVER",n),r.isPrevNormal=c,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof ci&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=ps(n._encoderConfig.frameRate));const r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof ci&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const _2={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},qi=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function E2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Jh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?E2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class iS{constructor(e){D(this,"store",void 0),D(this,"onStatsException",void 0),D(this,"onUploadPublishDuration",void 0),D(this,"onStatsChanged",void 0),D(this,"localStats",new Map),D(this,"remoteStats",new Map),D(this,"updateStatsInterval",void 0),D(this,"trafficStats",void 0),D(this,"trafficStatsPeerList",[]),D(this,"uplinkStats",void 0),D(this,"exceptionMonitor",void 0),D(this,"p2pChannel",void 0),D(this,"scalabilityMode",FR.L1T1),D(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new pY,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(_t.LocalAudioTrack)||Jh({},iO)}getLocalVideoTrackStats(){return this.localStats.get(_t.LocalVideoTrack)||Jh({},rO)}getRemoteAudioTrackStats(e){const n=(o,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===o);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const o=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.audioStats;o&&(i[e]=n(e,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[c,{audioStats:l}]=o;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(e){const n={};if(e){var i;const r=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;r&&(n[e]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[o,{networkStats:c}]=r;c&&(n[o]=c)});return n}getRemoteVideoTrackStats(e){const n=(o,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===o);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const o=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.videoStats;o&&(i[e]=n(e,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[c,{videoStats:l}]=o;l&&(i[c]=n(c,l))});return i}getRTCStats(){let e=0,n=0,i=0,r=0;const o=this.localStats.get(_t.LocalAudioTrack);o&&(e+=o.sendBytes,n+=o.sendBitrate);const c=this.localStats.get(_t.LocalVideoTrack);c&&(e+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(_t.LocalVideoLowTrack);l&&(e+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:f,videoStats:S}=p;f&&(i+=f.receiveBytes,r+=f.receiveBitrate),S&&(i+=S.receiveBytes,r+=S.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:n,SendBytes:e,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),o=r!=null&&r.videoSSRC?qi.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,c=r!=null&&r.audioSSRC?qi.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,o>c?o:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&b.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,i){if(!e)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,o=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!o}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case _t.LocalVideoTrack:case _t.LocalVideoLowTrack:{const c=r,l=Jh({},rO),d=e.getStats(),p=e.getLocalMedia(i);if(d){const f=d.videoSend.find(S=>S.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(f){const S=e.getLocalVideoSize(),v=e.getEncoderConfig(_t.LocalVideoTrack);f.codec!=="H264"&&f.codec!=="H265"&&f.codec!=="VP8"&&f.codec!=="VP9"&&f.codec!=="AV1X"&&f.codec!=="AV1"||(l.codecType=f.codec),l.sendBytes=f.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,f.inputFrame?(l.captureFrameRate=f.inputFrame.frameRate,l.captureResolutionHeight=f.inputFrame.height,l.captureResolutionWidth=f.inputFrame.width):S&&(l.captureResolutionWidth=S.width,l.captureResolutionHeight=S.height),f.sentFrame?(l.sendFrameRate=f.sentFrame.frameRate,l.sendResolutionHeight=f.sentFrame.height,l.sendResolutionWidth=f.sentFrame.width):S&&(l.sendResolutionWidth=S.width,l.sendResolutionHeight=S.height),f.avgEncodeMs&&(l.encodeDelay=f.avgEncodeMs),v&&v.bitrateMax&&(l.targetSendBitrate=1e3*v.bitrateMax),l.sendPackets=f.packets,l.sendPacketsLost=f.packetsLost,l.sendJitterMs=f.jitterMs,l.sendRttMs=f.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(f)&&(l.totalFreezeTime+=1),f.scalabilityMode&&this.scalabilityMode!==f.scalabilityMode&&(b.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(f.scalabilityMode)),this.scalabilityMode=f.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(i,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,l);break}case _t.LocalAudioTrack:{const c=r,l=Jh({},iO),d=e.getStats(),p=e.getLocalMedia(i);if(d){const f=d.audioSend.find(S=>S.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(f){if(f.codec!=="opus"&&f.codec!=="aac"&&f.codec!=="PCMU"&&f.codec!=="PCMA"&&f.codec!=="G722"||(l.codecType=f.codec),f.inputLevel)l.sendVolumeLevel=Math.round(32767*f.inputLevel);else{const S=e.getLocalAudioVolume();S&&(l.sendVolumeLevel=Math.round(32767*S))}l.sendBytes=f.bytes,l.sendPackets=f.packets,l.sendPacketsLost=f.packetsLost,l.sendJitterMs=f.jitterMs,l.sendRttMs=f.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(_t.LocalAudioTrack,l),l&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,l);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[o,{videoStats:c,audioStats:l,videoPcStats:d}]=n;const p=l,f=c,S=d,v=Jh({},m1),y=Jh({},_1),P=Jh({},XK),{audioTrack:I,videoTrack:O,audioSSRC:M,videoSSRC:U}=e.getRemoteMedia(o);let W;W=this.store.useP2P?e.getStats(!0):e.getStats();const Q=(i=W)===null||i===void 0?void 0:i.audioRecv.find(Et=>Et.ssrc===M),X=(r=W)===null||r===void 0?void 0:r.videoRecv.find(Et=>Et.ssrc===U),Y=this.trafficStats&&this.trafficStats.peer_delay.find(Et=>Et.peer_uid===o);if(Q&&(Q.codec!=="opus"&&Q.codec!=="aac"&&Q.codec!=="PCMU"&&Q.codec!=="PCMA"&&Q.codec!=="G722"||(v.codecType=Q.codec),Q.outputLevel?v.receiveLevel=Math.round(32767*Q.outputLevel):I&&(v.receiveLevel=Math.round(32767*I.getVolumeLevel())),v.receiveBytes=Q.bytes,v.receivePackets=Q.packets,v.receivePacketsLost=Q.packetsLost,v.receivePacketsDiscarded=Q.packetsDiscarded,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.receiveBitrate=p?8*Math.max(0,v.receiveBytes-p.receiveBytes):0,v.totalDuration=p?p.totalDuration+1:1,v.totalFreezeTime=p?p.totalFreezeTime:0,v.freezeRate=v.totalFreezeTime/v.totalDuration,v.receiveDelay=Q.jitterBufferMs,v.totalDuration>10&&iS.isRemoteAudioFreeze(I)&&(v.totalFreezeTime+=1)),X){var ot;X.codec!=="H264"&&X.codec!=="H265"&&X.codec!=="VP8"&&X.codec!=="VP9"&&X.codec!=="AV1X"&&X.codec!=="AV1"||(y.codecType=X.codec),y.receiveBytes=X.bytes,y.receiveBitrate=f?8*Math.max(0,y.receiveBytes-f.receiveBytes):0,y.decodeFrameRate=X.decodeFrameRate<0?0:X.decodeFrameRate,y.renderFrameRate=X.decodeFrameRate<0?0:X.decodeFrameRate,X.outputFrame&&(y.renderFrameRate=X.outputFrame.frameRate),X.receivedFrame?(y.receiveFrameRate=X.receivedFrame.frameRate,y.receiveResolutionHeight=X.receivedFrame.height,y.receiveResolutionWidth=X.receivedFrame.width):O&&(y.receiveResolutionHeight=O._videoHeight||0,y.receiveResolutionWidth=O._videoWidth||0),X.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round(X.framesRateFirefox)),y.receivePackets=X.packets,y.receivePacketsLost=X.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost);const Et=f?f.totalFreezeTime:0,Ot=f?f.totalDuration:0;y.totalDuration=f?f.totalDuration+1:1,y.totalFreezeTime=(ot=X.totalFreezesDuration)!==null&&ot!==void 0?ot:Et||0,y.receiveDelay=X.jitterBufferMs||0;const Lt=!!U&&e.getRemoteVideoIsReady(U);X.totalFreezesDuration===void 0&&O&&Lt&&iS.isRemoteVideoFreeze(O,X,S)&&(y.totalFreezeTime+=1),y.freezeRate=Math.max(0,Math.min((y.totalFreezeTime-Et)/(y.totalDuration-Ot),1))}Y&&(v.end2EndDelay=Y.B_ad,y.end2EndDelay=Y.B_vd,v.transportDelay=Y.B_ed,y.transportDelay=Y.B_ed,v.currentPacketLossRate=Y.B_ealr4/100,y.currentPacketLossRate=Y.B_evlr4/100,P.uplinkNetworkQuality=Y.B_punq?Y.B_punq:0,P.downlinkNetworkQuality=Y.B_pdnq?Y.B_pdnq:0),this.remoteStats.set(o,{audioStats:v,videoStats:y,videoPcStats:X,networkStats:P}),I&&this.exceptionMonitor.setRemoteAudioStats(I,v),O&&this.exceptionMonitor.setRemoteVideoStats(O,y)})}}class g2{constructor(){D(this,"destChannelMediaInfos",new Map),D(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){bx(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){bx(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){ab(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function S2(t){if(!(t instanceof g2))return new et(L.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new et(L.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new et(L.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Ju{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){D(this,"uid",void 0),D(this,"_uintid",void 0),D(this,"_trust_in_room_",!0),D(this,"_trust_audio_enabled_state_",!0),D(this,"_trust_video_enabled_state_",!0),D(this,"_trust_audio_mute_state_",!0),D(this,"_trust_video_mute_state_",!0),D(this,"_audio_muted_",!1),D(this,"_video_muted_",!1),D(this,"_audio_enabled_",!0),D(this,"_video_enabled_",!0),D(this,"_audio_added_",!1),D(this,"_video_added_",!1),D(this,"_is_pre_created",!1),D(this,"_video_pre_subscribed",!1),D(this,"_audio_pre_subscribed",!1),D(this,"_trust_video_stream_added_state_",!0),D(this,"_trust_audio_stream_added_state_",!0),D(this,"_audioTrack",void 0),D(this,"_videoTrack",void 0),D(this,"_dataChannels",[]),D(this,"_audioSSRC",void 0),D(this,"_videoSSRC",void 0),D(this,"_audioOrtc",void 0),D(this,"_videoOrtc",void 0),D(this,"_cname",void 0),D(this,"_rtxSsrcId",void 0),D(this,"_videoMid",void 0),D(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function T2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function v2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?T2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const rS="9",y2=4e4;let fY=class{get localCapabilities(){return kn(this._localCapabilities)}get rtpCapabilities(){return kn(this._rtpCapabilities)}get candidates(){return kn(this._candidates)}get iceParameters(){return kn(this._iceParameters)}get dtlsParameters(){return kn(this._dtlsParameters)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];D(this,"sessionDesc",void 0),D(this,"_localCapabilities",void 0),D(this,"_rtpCapabilities",void 0),D(this,"_candidates",void 0),D(this,"_originCandidates",void 0),D(this,"_iceParameters",void 0),D(this,"_isUseExtmapAllowMixed",void 0),D(this,"_dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname",void 0),D(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=e,t=kn(t);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:o,setup:c,localCapabilities:l,cname:d}=t;this._rtpCapabilities=o,this._candidates=r,this._originCandidates=kn(r),this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=l,this.setup=c,this.cname=d,this.sessionDesc=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(t){const e=this.candidates,n=this.dtlsParameters,i=this.iceParameters,r=this.rtpCapabilities.send;let o=this.sessionDesc.mediaDescriptions.length-1;for(let c=1;c<t;c++){const l=2*c+2e4,d=2*c+y2,{ssrcs:p,ssrcGroups:f}=qh([{ssrcId:l}],this.cname),{ssrcs:S,ssrcGroups:v}=qh([{ssrcId:d,rtx:j("USE_SUB_RTX")?d+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:rS,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.videoCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:e,extmaps:r.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:r.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:rS,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.audioCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:e,extmaps:r.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:r.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Wu(this.sessionDesc)}send(t,e,n,i){const{ssrcs:r,ssrcGroups:o}=qh(e,this.cname,j("SYNC_GROUP")?n:void 0),c=this.findPreloadMediaDesc(r);if(c){if(Ln()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){const l=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const l=this.findAvailableMediaIndex(t,r);let d;return l===-1||l===1&&(Mi()||function(){const p=Me();return!(p.name!==He.CHROME||!p.osVersion)&&Number(p.version)<=90}()||j("ENABLE_ENCODED_TRANSFORM")&&Cl())||l===0&&j("USE_SUB_RTX")||NM()?(d=this.createOrRecycleSendMedia(t,r,o,"sendonly",i),this.updateBundleMids()):(d=kn(this.sessionDesc.mediaDescriptions[l]),d.attributes.direction="sendonly",d.attributes.ssrcs=r,d.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(d,i)),Ln()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,d.attributes.mid),{mid:d.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t,needExchangeSDP:e}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:e}}batchSend(t){const e=t.map(r=>{let{kind:o,ssrcMsg:c,mslabel:l}=r;return this.send(o,c,l)}),n=[];let i=!1;return e.forEach(r=>{let{mid:o,needExchangeSDP:c}=r;c&&(i=!0),n.push(o)}),{mids:n,needExchangeSDP:i}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.mid==="0"||Ln()||NM()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(t){const e=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t);if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));e.attributes.direction="inactive"}unmute(t){const e=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t);if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));e.attributes.direction="sendonly"}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Ct(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Ct(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}receive(t,e,n,i){t.forEach((r,o)=>{this.createOrRecycleRecvMedia(r,[],"recvonly",e,n,i[o])}),this.updateBundleMids()}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(t){const e=this.sessionDesc||Kr((n=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=t;const i=this.rtpCapabilities.send,r=this.localCapabilities.send;for(const o of e.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,o.media.mediaType==="application"&&(o.attributes.sctpPort="5000"),o.media.mediaType==="video"){if(i.videoCodecs.length===0){const c=r.videoCodecs.filter(l=>{var d,p;return(d=l.rtpMap)===null||d===void 0?void 0:Ct(p=d.encodingName.toLowerCase()).call(p,"vp8")})||[r.videoCodecs[0]];o.media.fmts=c.map(l=>l.payloadType.toString(10)),o.attributes.payloads=c,o.attributes.extmaps=[]}else if(o.media.fmts=i.videoCodecs.map(c=>c.payloadType.toString(10)),o.attributes.payloads=i.videoCodecs,o.attributes.extmaps=i.videoExtensions,j("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:c,ssrcGroups:l}=qh([{ssrcId:y2,rtx:j("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=c,o.attributes.ssrcGroups=l}}if(o.media.mediaType==="audio"){if(i.audioCodecs.length===0){const c=r.audioCodecs.filter(l=>{var d,p;return(d=l.rtpMap)===null||d===void 0?void 0:Ct(p=d.encodingName.toLowerCase()).call(p,"opus")})||[r.audioCodecs[0]];o.media.fmts=c.map(l=>l.payloadType.toString(10)),o.attributes.payloads=c,o.attributes.extmaps=[]}else if(o.media.fmts=i.audioCodecs.map(c=>c.payloadType.toString(10)),o.attributes.payloads=i.audioCodecs,o.attributes.extmaps=i.audioExtensions,Ym(o),j("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:c,ssrcGroups:l}=qh([{ssrcId:2e4}],this.cname);o.attributes.ssrcs=c,o.attributes.ssrcGroups=l}}}return this.sessionDesc=e,this.currentMidIndex=e.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(t){const e=this._originCandidates.filter(i=>i.transport==="udp"),n=[];if(e.forEach(i=>{n.push(v2(v2({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),e.length!==0){switch(t){case nr.TCP_RELAY:this._candidates=n;break;case nr.UDP_TCP_RELAY:case nr.RELAY:this._candidates=[...e,...n];break;default:this._candidates=e}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=kn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}findAvailableMediaIndex(t,e){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===t&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(Ln()){if(i){const r=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(r||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!r||r!==n.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const t="".concat(this.currentMidIndex),e={media:{mediaType:"application",port:rS,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(e),{mediaDesc:e,needExchangeSDP:!0}}createOrRecycleRecvMedia(t,e,n,i,r,o){const c=t._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,d=tS(c,l,this.localCapabilities.send,c===xt.VIDEO?i:r),p=c===xt.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let S={media:{mediaType:c,port:rS,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};S=this.mungRecvMediaDsec(S,t,o);const v=this.findFirstClosedMedia(c);if(v){const y=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[y]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}updateRemoteCodec(t,e,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(S=>S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"").filter(S=>{var v;return Ct(v=Object.keys(HR)).call(v,S)}))],r=new Set(e);if(i.every(S=>r.has(S)))return b.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(e)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter(S=>e.some(v=>{var y;return Ct(y=S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"").call(y,v)}));if(o.length===0)return b.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(e)),!1;const c=[...new Set(o.map(S=>S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||""))];let l;if(b.debug("updateRemoteCodec, from ".concat(i," to ").concat(c)),t.length===0)l=this.sessionDesc.mediaDescriptions.filter(S=>S.media.mediaType==="video"&&S.attributes.direction==="recvonly");else if(l=this.sessionDesc.mediaDescriptions.filter(S=>S.attributes.mid&&Ct(t).call(t,S.attributes.mid)&&S.attributes.direction==="recvonly"),l.length!==t.length)return b.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(e)),!1;if(j("USE_PUB_RTX")||j("USE_SUB_RTX")){const S=kO(o,this.rtpCapabilities.recv.videoCodecs);o.push(...S)}this._rtpCapabilities.recv.videoCodecs=o;const d=this.localCapabilities.send,p=this.rtpCapabilities.recv,f=tS(xt.VIDEO,p,d,n);return l.forEach(S=>{const v=f.map(y=>y.payloadType.toString(10));b.debug("updateRemoteCodec mid: ".concat(S.attributes.mid,", from"),S.attributes.payloads,"to",f),S.attributes.payloads=f,S.media.fmts=v}),!0}createOrRecycleSendMedia(t,e,n,i,r){const o=this.rtpCapabilities.send,c=t===xt.VIDEO?o.videoCodecs:o.audioCodecs,l=t===xt.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const d="".concat(this.currentMidIndex);let p={media:{mediaType:t,port:rS,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};p=this.mungSendMediaDesc(p,r);const f=this.findFirstClosedMedia(t);if(f){const S=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[S]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,e,n){const i=kn(t);return PO(i),zm(i,e),LO(i,e),zx(i),mb(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=kn(t);return mb(n,e,this.localCapabilities.recv),Ym(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>Ln()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}getSSRC(t){var e;return(e=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t))===null||e===void 0?void 0:e.attributes.ssrcs}};function R2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function kl(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?R2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var Jm=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(Jm||{});const vb=new Map;function b2(t,e,n,i){let{scale:r}=t;if(r===0&&i===Jm.UP||r>=e.length-1&&i===Jm.DOWN)return t;let o=kl(kl({},t),{},{scale:i===Jm.DOWN?++r:--r});switch(n){case"maintain-framerate":o=kl(kl({},o),e[r].motion);break;case"maintain-resolution":o=kl(kl({},o),e[r].detail);break;case"balanced":o=kl(kl({},o),e[r].balanced)}return o}function C2(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:A2(e)};vb.set(t,n)}else vb.delete(t)}function A2(t){const e=kl({},t),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:o}=e,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:p,BITRATE_MAX_THRESHOLD:f,BWE_SCALE_UP_THRESHOLD:S,BWE_SCALE_DOWN_THRESHOLD:v,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:P,BALANCE_BITRATE_FACTOR:I,BALANCE_FRAMERATE_FACTOR:O,BALANCE_RESOLUTION_FACTOR:M,MOTION_RESOLUTION_FACTOR:U,MOTION_BITRATE_FACTOR:W,DETAIL_FRAMERATE_FACTOR:Q,DETAIL_BITRATE_FACTOR:X}=JI,Y=Math.min(e.frameRate,l),ot=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(v,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(y,1)*Y),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o}}];for(let Et=1;Et<=d;Et++){const Ot={bwe_up:Math.round(Math.pow(S,Et)*n),bwe_down:Math.round(Math.pow(v,Et+1)*n),fps_up:Math.round(Math.pow(P,Et)*Y),fps_down:Math.round(Math.pow(y,Et+1)*Y)},Lt={scaleResolutionDownBy:r/Math.pow(M,Et),frameRate:Math.max(Math.round(Math.pow(O,Et)*i),c),bitrateMax:Math.max(Math.round(Math.pow(I,Et)*n),f),bitrateMin:Math.max(Math.round(Math.pow(I,Et)*o),p)},Ce={scaleResolutionDownBy:r/Math.pow(U,Et),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(W,Et)*n),f),bitrateMin:Math.max(Math.round(Math.pow(W,Et)*o),p)},Ae={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Q,Et)*i),c),bitrateMax:Math.max(Math.round(Math.pow(X,Et)*n),f),bitrateMin:Math.max(Math.round(Math.pow(X,Et)*o),p)};ot.push({scale:Et,threshold:Ot,balanced:Lt,motion:Ce,detail:Ae})}return ot}function mY(t,e,n,i,r,o){const c=vb.get(t)||{overUse:0,underUse:0,adaptationList:A2(r)},{adaptationList:l}=c;vb.set(t,c);const{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:p}=JI,{scale:f}=i;let S,v;return typeof e=="number"&&e>0&&function(y,P,I,O){if(P>=I.length)return!1;let{threshold:{fps_down:M}}=I[P];return j("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(M=I[0].threshold.fps_down),y<M}(e,f,l,o)&&(c.overUse++,v=Hg.CPU,c.overUse>d)||typeof n=="number"&&n>0&&function(y,P,I){if(P>=I.length)return!1;const{threshold:{bwe_down:O}}=I[P];return y<O}(n,f,l)&&(c.overUse++,v=Hg.BANDWIDTH,c.overUse>d)?(c.overUse=0,c.underUse=0,S=b2(i,l,o,Jm.DOWN),[S,v]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(y,P,I,O){if(P===0)return;let{threshold:{fps_up:M}}=I[P];return j("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(M=I[1].threshold.fps_up),y>M}(e,f,l,o)&&function(y,P,I){if(P===0)return;const{threshold:{bwe_up:O}}=I[P];return y>O}(n,f,l)&&(c.underUse++,c.underUse>p&&(c.overUse=0,c.underUse=0,S=b2(i,l,o,Jm.UP),S.scale===0&&(v=Hg.NONE))),[S,v])}function w2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function KO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?w2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function _Y(t){var e;return!!j("ENABLE_AG_ADAPTATION")&&!!(t instanceof pO||Ct(e=t._hints).call(e,un.CUSTOM_TRACK))&&(!!j("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const i=Me();if(i.os!==_i.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return Number(r[0])>=n}(14)&&IM(17,4)||wM(14)&&OM(17,4,!0)))}const yb=new Map;function Rb(t,e){const n=yb.get(t);if(n){const{timer:i}=n;window.clearTimeout(i),yb.delete(t)}e.qualityLimitationReason=Hg.NONE,C2(t)}function EY(t,e){var n;let i;switch(e){case _t.LocalAudioTrack:i=qe.Audio;break;case _t.LocalVideoTrack:i=Ct(n=t._hints).call(n,un.SCREEN_TRACK)?qe.Screen:qe.High;break;case _t.LocalVideoLowTrack:i=qe.Low}return i}function zO(t){const e=Ue();if(t.some(n=>n._bypassWebAudio))throw new st(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new st(L.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function YO(t,e){zO(t);const n=new ci;return t.forEach(i=>n.addAudioTrack(i)),n}const gY=!Ue().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&Al();function bb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return gY?(n={spec:e,store:t},Xu("PlanBConnection").create(n)):new Ml(e,t)}function qO(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function I2(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(jg(t.turnServer.servers))return!1;if(j("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var Oe;function O2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Oa(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?O2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Ml=(Oe=class OS extends Ix{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return Ct(n=Object.keys(HR)).call(n,e)}))]}constructor(e,n){super(e,n),D(this,"id",ln(5,"connection-")),D(this,"store",void 0),D(this,"peerConnection",void 0),D(this,"forceTurn",!1),D(this,"remoteSDP",void 0),D(this,"initialOffer",void 0),D(this,"transportEventReceiver",void 0),D(this,"statsFilter",void 0),D(this,"extension",{useXR:j("USE_XR")}),D(this,"localCapabilities",void 0),D(this,"remoteCodecs",void 0),D(this,"localCandidateCount",0),D(this,"allCandidatesReceived",!1),D(this,"isPreallocation",!1),D(this,"preSSRCMap",new Map),D(this,"dataStreamChannelMap",new Map),D(this,"establishPromise",void 0),D(this,"recoveredDataChannelIds",[]),D(this,"currentDataChannelId",1),D(this,"supportAV1RtpSpec",!1),D(this,"mutex",void 0),D(this,"qualityLimitationReason",Hg.NONE),this.store=n,this.forceTurn=I2(e),this.mutex=new zi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(OS.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=YI(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Ln()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void b.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();r==null||r(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else b.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=qu(i.sdp),o=await qx({filterRTX:!j("USE_PUB_RTX")&&!j("USE_SUB_RTX"),filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterVideoCodec:j("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=_b(o),this.initialOffer=i,j("ENABLE_SVC")&&this.store.codec=="av1"){const l=await async function(){try{const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:FR.L1T3}]});const p=await d.createOffer();if(!p.sdp)return void d.close();const f=Kr(p.sdp).mediaDescriptions[0];if(!f)return;const S=f.attributes.extmaps.find(v=>v.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return d.close(),S}catch{return}}();var e;l&&(this.supportAV1RtpSpec=!0,(e=o.send)===null||e===void 0||e.videoExtensions.push(l))}let c;return i.sdp&&Zx(i.sdp)&&(c=kn(o),(n=c).send&&(Km(xt.VIDEO,n.send.videoExtensions),Km(xt.AUDIO,n.send.audioExtensions)),n.recv&&(Km(xt.VIDEO,n.recv.videoExtensions),Km(xt.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(Km(xt.VIDEO,n.sendrecv.videoExtensions),Km(xt.AUDIO,n.sendrecv.audioExtensions))),Oa(Oa({},r),{},{rtpCapabilities:c||o,offerSDP:i.sdp})}catch(i){throw new st(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&Zx(this.initialOffer.sdp)&&(n=e.rtpCapabilities,i=this.localCapabilities,n.send&&(pb(xt.VIDEO,n.send.videoExtensions,i.send.videoExtensions),pb(xt.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(pb(xt.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),pb(xt.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new fY(Oa(Oa({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),o=Jx(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),j("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(j("PRELOAD_MEDIA_COUNT"));const p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const f=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(f)}const{preSSRCs:d}=e;if(Array.isArray(d)&&d.length>0){const{mids:p}=this.remoteSDP.batchSend(d.map(f=>({kind:f.kind,ssrcMsg:[{ssrcId:f.ssrcId,rtx:f.rtx}],mslabel:f.mslabel})));p.forEach((f,S)=>{this.preSSRCMap.set(d[S].ssrcId,f)}),await Eb(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:i}=e;if(Array.isArray(i)&&i.length>0){const{mids:r}=this.remoteSDP.batchSend(i.map(o=>Object.assign({},{kind:o.kind,ssrcMsg:[{ssrcId:o.ssrcId,rtx:o.rtx}],mslabel:o.mslabel})));r.forEach((o,c)=>{this.preSSRCMap.set(i[c].ssrcId,o)})}await Eb(this.peerConnection,this.remoteSDP,this.extension),b.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Xs(function*(){const o=yield De(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=hb();e.forEach(O=>{const M=r.peerConnection.addTransceiver(O._mediaStreamTrack,Oa({direction:"sendonly"},O.trackMediaType==="video"&&r.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(M),O._updateRtpTransceiver(M)}),Ln()&&j("SIMULCAST")===!0&&(yield De(r.applySimulcastForFirefox(c,e)));const d=yield De(r.peerConnection.createOffer()),p=r.remoteSDP.predictReceivingMids(e.length),f=r.mungSendOfferSDP(d.sdp,e,p),S=Kr(f),v=p.map(O=>{const M=S.mediaDescriptions.find(U=>U.attributes.mid===O);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return Hx(M,j("USE_PUB_RTX"))});let y;try{y=yield v}catch(O){y=[],r.remoteSDP.receive(e,n,i,y);const M=r.remoteSDP.toString();throw yield De(r.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield De(r.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield De(r.stopSending(p,!0)),O}r.remoteSDP.receive(e,n,i,y);const P=r.remoteSDP.toString(),I=r.logSDPExchange(f,"offer","local","send");return yield De(r.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield De(r.applySimulcastEncodings(c,e)),yield De(r.applySendEncodings(c,e)),I==null||I(P),yield De(r.peerConnection.setRemoteDescription({type:"answer",sdp:P})),c.map((O,M)=>{const U=p[M];return{localSSRC:v[M],id:U,transceiver:O}})}catch(c){throw c instanceof st?c:new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")b.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const o=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:o,negotiated:!0,ordered:!1,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}n.forEach(o=>{o._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),b.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else b.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof st?i:new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof st?n:new st(L.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(d=>{var p;Rb(this.id+d.mid,this),d.direction="inactive",(p=d.stop)===null||p===void 0||p.call(d)});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);c&&(await Eb(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const l=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:o,transceiver:l}}catch(o){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await Eb(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const o=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:r,transceiver:o}})}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(o=>{Array.from(this.preSSRCMap.entries()).some(c=>{let[l,d]=c;if(d===o)return this.preSSRCMap.delete(l),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const o=this.remoteSDP.toString();r==null||r(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const o=this.remoteSDP.toString();r==null||r(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Xs(function*(){const i=yield De(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Ue().supportPCSetConfiguration,o=j("FORCE_TURN_TCP")||n.forceTurn;if(e===nr.RELAY&&!r)return;if(r&&!o){const S=e===nr.RELAY?"relay":"all",v=n.peerConnection.getConfiguration();v.iceTransportPolicy!==S&&(b.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(S,"]")),v.iceTransportPolicy=S,n.peerConnection.setConfiguration(v))}n.remoteSDP.updateCandidates(e);const c=yield De(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=qu(c.sdp),{remoteIceParameters:d}=yield l.iceParameters;n.remoteSDP.restartICE(d);const p=n.remoteSDP.toString(),f=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield De(n.peerConnection.setLocalDescription(c)),f==null||f(p),yield De(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(r){b.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{Rb(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Oa(Oa({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const o=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new st(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?Ln()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:Oa(Oa({},Cc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Oa(Oa({},Cc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"";b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(e.url||"",", host_candidate:").concat(r)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(jg(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...OS.turnServerConfigToIceServers(e.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...OS.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&Ue().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Wm(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!j("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var o;r&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:o}=i.getSelectedCandidatePair();b.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(O=>O.track===e._mediaStreamTrack)),!n)return b.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return b.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ue().supportSetRtpSenderParameters)return b.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},c={};switch(e._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;case"balanced":o.degradationPreference="balanced"}const l=function(I,O){return I.getTransceivers().find(M=>M.sender.track===O||M.receiver.track===O)}(this.peerConnection,e._mediaStreamTrack),d=tz(e);if(_Y(e)&&l&&n&&d&&this.getLocalVideoStats&&Ct(i=["vp8","vp9"]).call(i,this.store.codec)){var p;const I=o.degradationPreference||(Ct(p=e._hints).call(p,un.CUSTOM_TRACK)?j("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(O,M,U,W,Q,X){if(Rb(O,U),Q(M),W!=="balanced"&&W!=="maintain-framerate"&&W!=="maintain-resolution")return;let Y=-1;C2(O,M);const ot=window.setInterval(()=>{const Ot=yb.get(O);if(!j("ENABLE_AG_ADAPTATION")||!Ot)return Rb(O,U),void Q(M);const Lt=X();if(Lt.sendPackets>0&&Lt.OutgoingAvailableBandwidth>0){if(Y===-1)return void(Y=Date.now());if(Date.now()-Y<1e3)return;const Ce=Lt.sendFrameRate,Ae=Lt.OutgoingAvailableBandwidth,[dn,Kn]=mY(O,Ce,Ae,Ot.adaptationConfig,M,W);Kn&&(U.qualityLimitationReason=Kn),dn&&Ot.adaptationConfig.scale!==dn.scale&&(b.debug("[".concat(O,"] applyAdaptation: ").concat(U.qualityLimitationReason,`
           sendFps `).concat(Ce,", bwe ").concat(Ae,", switch from ").concat(Ot.adaptationConfig.scale," to ").concat(dn.scale," ")),Ot.adaptationConfig=KO(KO({},Ot.adaptationConfig),dn),Q(dn))}},j("CHECK_LOCAL_STATS_INTERVAL")),Et=KO({},M);yb.set(O,{timer:ot,adaptationConfig:Et,originConfig:M,adaptationFunc:Q}),b.debug("[".concat(O,"] start adaptation, originConfig: ").concat(JSON.stringify(M),", degradationPreference: ").concat(W))})(this.id+l.mid,d,this,I,O=>{n&&this.updateAdaptation(n,O)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var f;const{bitrateMax:I,frameRate:O,scaleResolutionDownBy:M}=e._encoderConfig;I&&(c.maxBitrate=1e3*I),(Ct(f=e._hints).call(f,un.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(O&&(c.maxFramerate=ps(O)),M&&M>=1&&(c.scaleResolutionDownBy=M))}const{maxFramerate:S}=j("ENCODER_CONFIG_LIMIT");if(S&&typeof S=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,S):S),j("DSCP_TYPE")&&Al()){var v;const I=j("DSCP_TYPE");Ct(v=["very-low","low","medium","high"]).call(v,I)&&(c.networkPriority=I)}const y=n.getParameters(),P=(r=y.encodings)===null||r===void 0?void 0:r[0];Ln()&&!P&&(o.encodings=[c]),P&&Object.assign(P,c),Object.assign(y,o),b.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await n.setParameters(y),await async function(I,O,M){try{var U;if(!Ue().supportSetRtpSenderParameters||!function(ot){return ot==="vp9"||ot==="av1"}(I)||!j("ENABLE_SVC"))return;const W={},Q={},X=O.getParameters(),Y=(U=X.encodings)===null||U===void 0?void 0:U[0];Q.scalabilityMode=hb(M),Y&&Object.assign(Y,Q),Object.assign(X,W),await O.setParameters(X),b.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(X.encodings)))}catch(W){b.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",W)}}(this.store.codec,n,j("SVC_MODE"))}async updateAdaptation(e,n){var i,r;if(!e)return b.debug("[updateAdaptation] no rtpSender found");if(!Ue().supportSetRtpSenderParameters)return b.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const o={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:d}=n;c&&(o.maxBitrate=1e3*c),l&&(o.maxFramerate=ps(l)),d&&d>=1&&Ct(i=["vp8","vp9"]).call(i,this.store.codec)&&(o.scaleResolutionDownBy=d);const p=e.getParameters(),f=(r=p.encodings)===null||r===void 0?void 0:r[0];f&&Object.assign(f,o),Object.assign(p,{});try{await e.setParameters(p),b.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(p.encodings)))}catch(S){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?b.debug("[updateAdaptation] peerConnection not connected}"):b.debug("[updateAdaptation] updateRtpSenderEncodings failed",S):b.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!Ue().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],o=n[i];o instanceof En&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,r.sender)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=Kr(e);return n.forEach((o,c)=>{const l=i[c],d=r.mediaDescriptions.find(p=>p.attributes.mid===l);d&&(zm(d,o),Yx(d,o,this.store.codec))}),Wu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,o,c,l;const p=e[d],f=n[d];if(f instanceof En&&!Ct(i=f._hints).call(i,un.LOW_STREAM)&&(r=f._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=f._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=f._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const S={},v={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,S))}}}async applySimulcastEncodings(e,n){if(!Ln()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof En&&this.isVP8Simulcast(r)){const o=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=o.sender.getParameters();await o.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,o,c;return!!(e instanceof En&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Ct(n=e._hints).call(n,un.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(o=e._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(j("SDP_LOGGING"))return b.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?o=>{this.logSDPExchange(o,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(Ue().supportPCSetConfiguration){const n=OS.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Ft(Oe.prototype,"updateRemoteRTPCapabilities",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateRemoteRTPCapabilities"),Oe.prototype),Ft(Oe.prototype,"connect",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"connect"),Oe.prototype),Ft(Oe.prototype,"updateRemoteConnect",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateRemoteConnect"),Oe.prototype),Ft(Oe.prototype,"createDataChannels",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"createDataChannels"),Oe.prototype),Ft(Oe.prototype,"receive",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"receive"),Oe.prototype),Ft(Oe.prototype,"batchReceive",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"batchReceive"),Oe.prototype),Ft(Oe.prototype,"stopReceiving",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"stopReceiving"),Oe.prototype),Ft(Oe.prototype,"muteRemote",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"muteRemote"),Oe.prototype),Ft(Oe.prototype,"unmuteRemote",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"unmuteRemote"),Oe.prototype),Ft(Oe.prototype,"muteLocal",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"muteLocal"),Oe.prototype),Ft(Oe.prototype,"unmuteLocal",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"unmuteLocal"),Oe.prototype),Ft(Oe.prototype,"close",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"close"),Oe.prototype),Ft(Oe.prototype,"updateEncoderConfig",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateEncoderConfig"),Oe.prototype),Ft(Oe.prototype,"updateSendParameters",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateSendParameters"),Oe.prototype),Ft(Oe.prototype,"replaceTrack",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"replaceTrack"),Oe.prototype),Ft(Oe.prototype,"updateAdaptation",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateAdaptation"),Oe.prototype),Ft(Oe.prototype,"getRemoteSSRC",[Dr],Object.getOwnPropertyDescriptor(Oe.prototype,"getRemoteSSRC"),Oe.prototype),Oe);function Dr(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,o=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{o()}},n}function XO(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=ps(e.width),i.height=ps(e.height);const r=ps(e.framerate||15);document.body.append(n),document.body.append(i);let o=t._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const c=i.getContext("2d");if(!c)throw new et(L.UNEXPECTED_ERROR,"can not get canvas context");const l=Ue(),d=i.captureStream(l.supportRequestFrame?0:r).getVideoTracks()[0];d.canvas||(d.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const f=n.videoWidth,S=n.videoHeight/f,v=i.width*S;Math.abs(v-i.height)>=2&&(b.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(v)),i.height=v)}c.drawImage(n,0,0,i.width,i.height),d.requestFrame&&d.requestFrame(),o!==t._mediaStreamTrack&&(o=t._mediaStreamTrack,n.srcObject=new MediaStream([o]))},i.stopCapture=aO(()=>i.startCapture&&i.startCapture(),r);const p=d.stop;return d.stop=()=>{p.call(d),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),b.debug("clean low stream renderer")},d}var Cb=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(Cb||{}),Qn=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(Qn||{}),Qh=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(Qh||{}),Zn=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(Zn||{}),Zh=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(Zh||{}),N2=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(N2||{}),Dc=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(Dc||{}),Yr=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t}(Yr||{}),D2=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(D2||{}),Pr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Pr||{}),Ab=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(Ab||{});const wb=1e3,SY=Math.max(6,3);function te(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function P2(t){const e={[Pr.CONN_TYPE]:0,[Pr.RTT]:t.rtt,[Pr.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[Pr.CONN_TYPE]=1),n==="tcp"&&(e[Pr.CONN_TYPE]=3),n==="tls"&&(e[Pr.CONN_TYPE]=4);break}case"srflx":e[Pr.CONN_TYPE]=2;break;case"unknown":e[Pr.CONN_TYPE]=5;break;default:e[Pr.CONN_TYPE]=0}return e}function L2(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class k2 extends An{constructor(e){super(),D(this,"store",void 0),D(this,"uploadWRTCStatsTimer",void 0),D(this,"uploadOutboundDenoiserStatsTimer",void 0),D(this,"uploadExtStatsTimer",void 0),D(this,"uploadExtUsageStatsTimer",void 0),D(this,"uploadInboundExtStatsTimer",void 0),D(this,"requestStats",void 0),D(this,"requestTransportStats",void 0),D(this,"requestLocalMedia",void 0),D(this,"requestRemoteMedia",void 0),D(this,"requestAllTracks",void 0),D(this,"requestVideoIsReady",void 0),D(this,"requestUploadStats",void 0),D(this,"requestUpload",void 0),D(this,"uploadOutboundStarted",!1),D(this,"uploadInboundStarted",!1),D(this,"uploadTransportStarted",!1),D(this,"uploadBaseStatsStarted",!1),D(this,"uploadExtensionUsageStarted",!1),D(this,"lastRecvStats",void 0),D(this,"lastSendStats",void 0),D(this,"lastRefRecvStats",void 0),D(this,"lastRefSendStats",void 0),D(this,"lastFullRecvStats",void 0),D(this,"lastFullSendStats",void 0),D(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%3==0,i=e%6==0;let r,o;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),r||o){var c;const l={};if(this.uploadTransportStarted&&r){const p=this.getTransportStats(r,o,n);p&&(l.misc=[p])}if(this.uploadOutboundStarted&&r){const p=this.getOutboundStats(r,i?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,i);p&&(l.outbound=[p])}if(this.uploadInboundStarted&&o){const p=this.getInboundStats(o,i?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,i);p&&(l.inbound=p)}const d=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;d&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[Ab.RTC_PEER_CONNECTION_STATE]=zI[d]):l.misc=[{addition:{[Ab.RTC_PEER_CONNECTION_STATE]:zI[d]}}]),this.requestUploadStats(l)}this.lastRecvStats=o,this.lastSendStats=r,i&&(this.lastFullRecvStats=o,this.lastFullSendStats=r),n&&(this.lastRefRecvStats=o,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const r=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[Ab.RTC_PEER_CONNECTION_STATE]:zI[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===SY+1&&(e=1)},wb)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[Pr.RTT]:e.rtt,[Pr.CONN_TYPE]:void 0,[Pr.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=P2(e);if(this.store.useP2P){if(n){const o=P2(n);r[Pr.CONN_TYPE]+=o[Pr.CONN_TYPE]<<3}r[Pr.CONN_TYPE]+=110}else r[Pr.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,n,i,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const o=this.requestLocalMedia();if(!o||o.length===0)return;let c,l,d;return o.forEach(p=>{let[f,{track:S,ssrcs:v}]=p;switch(f){case _t.LocalVideoLowTrack:case _t.LocalVideoTrack:if(f===_t.LocalVideoTrack){const y=function(O,M,U,W,Q,X){const Y=M.videoSend.find(Lt=>Lt.ssrc===O);if(!Y)return;const ot={},{sentFrame:Et,inputFrame:Ot}=Y;if(X&&(te(ot,Qn.QP_SUM,Y.qpSumPerFrame),Ot&&Et)){const Lt=Ot.frameRate,Ce=Et.frameRate;ot[Qn.FREEZE]=function(Ae,dn){let Kn=!0;return Kn=!(Ae<=5)&&(Ae<=10?dn<3:Ae<=20?dn<4:dn<5),Kn}(Lt,Ce)?1:0}if(Q){switch(Et&&(te(ot,Qn.HEIGHT,Et.height),te(ot,Qn.WIDTH,Et.width),te(ot,Qn.FRAME_RATE,Et.frameRate)),ot[Qn.DISABLED]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0,Y.adaptionChangeReason){case"none":ot[Qn.ADAPTATION]=0;break;case"cpu":ot[Qn.ADAPTATION]=1;break;case"bandwidth":ot[Qn.ADAPTATION]=2;break;case"other":ot[Qn.ADAPTATION]=3}let Lt=0;Y.adaptionChangeReason&&(Lt+=L2(Y.adaptionChangeReason)),M.qualityLimitationReason&&(Lt+=L2(M.qualityLimitationReason)<<3),ot[Qn.ADAPTATION]=Lt,ot[Qn.PLAYER_STATUS]=sO[W._player?W._player.videoElementStatus:"uninit"],te(ot,Qn.NACKS,Y.nacksCount),te(ot,Qn.PLIS,Y.plisCount),te(ot,Qn.FIRS,Y.firsCount),te(ot,Qn.AVG_ENCODE,Y.avgEncodeMs),te(ot,Qn.HUGE_FRAME_SENT,Y.hugeFramesSent),te(ot,Qn.BYTES_RETRANSMIT,Y.retransmittedBytesSent),te(ot,Qn.PACKAGES_RETRANSMIT,Y.retransmittedPacketsSent),te(ot,Qn.KEY_FRAMES_ENCODED,Y.keyFramesEncoded);const Ce=U&&U.videoSend.find(Ae=>Ae.ssrc===O);if(Ce){let Ae=Q?wb:6e3;Ce.timestamp&&Y.timestamp&&(Ae=Y.timestamp-Ce.timestamp),Ce.packets!=null&&Y.packets!=null&&te(ot,Qn.PACKAGE_RATE,1e3*(Y.packets-Ce.packets)/Ae),Y.packetsLost!=null&&Ce.packetsLost!=null&&te(ot,Qn.PACKAGE_LOST,Y.packetsLost-Ce.packetsLost),Ce.bytes!=null&&Y.bytes!=null&&te(ot,Qn.BITRATE,8*(Y.bytes-Ce.bytes)/Ae)}}return ot}(v[0].ssrcId,e,n,S,i,r),P=S&&function(O,M,U,W){const Q=M.videoSend.find(Y=>Y.ssrc===O);if(!Q)return null;const X={};if(W){const Y=Q.inputFrame,ot=Y&&Y.height||U.videoHeight||0,Et=Y&&Y.width||U.videoWidth||0,Ot=Y&&Y.frameRate||0;te(X,Cb.HEIGHT,ot),te(X,Cb.WIDTH,Et),te(X,Cb.FRAME_RATE,Ot)}return X}(v[0].ssrcId,e,S,i),I=function(O,M){const U={};return M&&(te(U,Qn.RETRANSMIT,O.bitrate.retransmit),te(U,Qn.TARGET_ENCODED,O.bitrate.targetEncoded),te(U,Qn.ACTUAL_ENCODED,O.bitrate.actualEncoded),te(U,Qn.TRANSMIT,O.bitrate.transmit),te(U,Qn.BANDWIDTH,O.sendBandwidth)),U}(e,i);l=Object.assign({},y,P,I)}else d=function(y,P,I,O){const M=P.videoSend.find(W=>W.ssrc===y);if(!M)return;const U={};if(O){const W=M.sentFrame;if(W&&(te(U,Qh.HEIGHT,W.height),te(U,Qh.WIDTH,W.width),te(U,Qh.FRAME_RATE,W.frameRate)),I){const Q=I.videoSend.find(X=>X.ssrc===y);if(Q){let X=6e3;Q.timestamp&&M.timestamp&&(X=M.timestamp-Q.timestamp),Q.packets!=null&&M.packets!=null&&te(U,Qh.PACKAGE_RATE,1e3*(M.packets-Q.packets)/X),M.packetsLost!=null&&Q.packetsLost!=null&&te(U,Qh.PACKAGE_LOST,M.packetsLost-Q.packetsLost),Q.bytes!=null&&M.bytes!=null&&te(U,Qh.BITRATE,8*(M.bytes-Q.bytes)/X)}}}return U}(v[0].ssrcId,e,n,i);break;case _t.LocalAudioTrack:c=S&&function(y,P,I,O,M){const U=P.audioSend.find(Q=>Q.ssrc===y);if(!U)return;const W={};if(M){W[Dc.DISABLED]=O._originMediaStreamTrack&&!O._originMediaStreamTrack.enabled||O._mediaStreamTrack&&!O._mediaStreamTrack.enabled?1:0;const Q=100*O._source.getAccurateVolumeLevel(),X=U.inputLevel;if(X!=null){const ot=Math.ceil(50*Math.log10(100*X+1));te(W,Dc.LEVEL,ot)}te(W,N2.PCM_LEVEL,Q),te(W,Dc.AEC_RETURN_LOSS,U.aecReturnLoss),te(W,Dc.AEC_RETURN_LOSS_ENH,U.aecReturnLossEnhancement),te(W,Dc.BYTES_RETRANSMIT,U.retransmittedBytesSent),te(W,Dc.PACKAGES_RETRANSMIT,U.retransmittedPacketsSent),W[Dc.FREEZE]=0;const Y=I&&I.audioSend.find(ot=>ot.ssrc===y);if(Y){let ot=6e3;Y.timestamp&&U.timestamp&&(ot=U.timestamp-Y.timestamp),Y.bytes!=null&&U.bytes!=null&&te(W,Dc.BITRATE,8*(U.bytes-Y.bytes)/ot),Y.packets!=null&&U.packets!=null&&te(W,Dc.PACKAGE_RATE,1e3*(U.packets-Y.packets)/ot)}}return W}(v[0].ssrcId,e,n,S,i)}}),{high:l,low:d,audio:c}}getInboundStats(e,n,i,r){if(!this.requestRemoteMedia)return;const o=this.requestRemoteMedia()||[],c=[];return o.forEach(l=>{let[d,p]=l;const f={peer:d.uid};if(p.has(xt.VIDEO)&&d.videoTrack){const S=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,v=d.videoTrack?function(y,P,I,O,M,U,W,Q){const X=P.videoRecv.find(Ae=>Ae.ssrc===y);if(!X)return;const Y={},{receivedFrame:ot,outputFrame:Et,decodeFrameRate:Ot}=X,Lt=I&&I.videoRecv.find(Ae=>Ae.ssrc===y);if(te(Y,Zh.FRAME_RATE_DECODE,Ot),X.framesRateFirefox&&te(Y,Zn.FRAME_RATE,X.framesRateFirefox),ot&&te(Y,Zn.FRAME_RATE,ot.frameRate),te(Y,Zn.FRAMES_DROPPED,X.framesDroppedCount),te(Y,Zn.BYTES_RETRANSMIT,X.retransmittedBytesReceived),te(Y,Zn.PACKAGES_RETRANSMIT,X.retransmittedPacketsReceived),te(Y,Zn.PACKAGES_DISCARDED,X.packetsDiscarded),te(Y,Zn.AVG_DECODE,X.avgDecodeMs),te(Y,Zn.AVG_PROCESSING_DELAY,X.avgProcessingDelayMs),te(Y,Zn.AVG_ASSEMBLY_TIME,X.avgFramesAssembledFromMultiplePacketsMs),te(Y,Zn.AVG_INTER_FRAME_DELAY,X.avgInterFrameDelayMs),te(Y,Zn.KEY_FRAMES_DECODED,X.keyFramesDecoded),Lt){const Ae=P.timestamp-I.timestamp||wb*(Q?6:W?3:1);X.packetsLost!=null&&Lt.packetsLost!=null&&te(Y,Zn.PACKAGE_LOST,X.packetsLost-Lt.packetsLost),Lt.bytes!=null&&X.bytes!=null&&te(Y,Zn.BITRATE,8*(X.bytes-Lt.bytes)/Ae),Lt.packets!=null&&X.packets!=null&&te(Y,Zn.PACKAGE_RATE,1e3*(X.packets-Lt.packets)/Ae)}if(Q&&(te(Y,Zn.QP_SUM,X.qpSumPerFrame),Y[Zn.FREEZE]=M&&iS.isRemoteVideoFreeze(O,X,Lt)?1:0),W){var Ce;ot?(te(Y,Zn.HEIGHT,ot.height),te(Y,Zn.WIDTH,ot.width)):O&&(te(Y,Zn.HEIGHT,O._videoHeight||0),te(Y,Zn.WIDTH,O._videoWidth||0)),Et&&te(Y,Zh.FRAME_RATE_OUTPUT,Et.frameRate);const Ae=(Ce=O._player)===null||Ce===void 0?void 0:Ce.rendFrameRate.toFixed(0);if(Ae&&te(Y,Zh.FRAME_RATE_RENDER,+Ae),te(Y,Zn.JITTER_BUFFER,X.jitterBufferMs),te(Y,Zn.CURRENT_DELAY,X.currentDelayMs),te(Y,Zn.FIRS,X.firsCount),te(Y,Zn.NACKS,X.nacksCount),te(Y,Zn.PLIS,X.plisCount),O){Y[Zn.DISABLED]=O._originMediaStreamTrack.enabled&&O._mediaStreamTrack.enabled?0:1;const dn=O._player;if(dn){const{freezeTimeCounterList:Kn,renderFreezeAccTime:Un,videoElementStatus:kr}=dn;if(Kn&&Kn.length>0&&te(Y,Zh.FREEZE_TIME,Kn.splice(0,1)[0]),U&&Ol.visibility==="visible"&&kr===cr.PLAYING&&Ue().supportRequestVideoFrameCallback){const dt=Math.min(6e3,Un);dn.renderFreezeAccTime=Math.max(0,Un-dt),te(Y,Zh.FREEZE_TIME_RENDER,dt)}if(typeof X.totalFreezesDuration=="number"){const dt=Lt&&Lt.totalFreezesDuration?X.totalFreezesDuration-Lt.totalFreezesDuration:X.totalFreezesDuration;te(Y,Zh.FREEZE_DURATION,1e3*dt)}}}if(Y[Zn.PLAYER_STATUS]=sO[O._player?O._player.videoElementStatus:"uninit"],Lt&&X.totalInterFrameDelay!==void 0&&X.totalSquaredInterFrameDelay!==void 0&&Lt.totalInterFrameDelay!==void 0&&Lt.totalSquaredInterFrameDelay!==void 0){const dn=X.totalInterFrameDelay-Lt.totalInterFrameDelay,Kn=X.totalSquaredInterFrameDelay-Lt.totalSquaredInterFrameDelay,Un=X.framesDecodeCount-Lt.framesDecodeCount,kr=dn/Un*1e3,dt=Math.round(1e3*Math.sqrt((Kn-Math.pow(dn,2)/Un)/Un));!isNaN(dt)&&kr+dt>Math.max(3*kr,kr+150)&&(Y[Zn.I_FRAME_DELAY]=dt)}}return Y}(d._videoSSRC,e,n,d.videoTrack,S===!0,this.needUploadRenderFreezeTime,i,r):void 0;v&&(f.video=v)}if(p.has(xt.AUDIO)&&d.audioTrack){const S=d.audioTrack?function(v,y,P,I,O,M){const U=y.audioRecv.find(Y=>Y.ssrc===v);if(!U)return;const W={},Q=P&&P.audioRecv.find(Y=>Y.ssrc===v);if(te(W,Yr.JITTER,U.jitterMs),te(W,Yr.BYTES_RETRANSMIT,U.retransmittedBytesReceived),te(W,Yr.PACKAGES_RETRANSMIT,U.retransmittedPacketsReceived),te(W,Yr.PACKAGES_DISCARDED,U.packetsDiscarded),te(W,Yr.AVG_PROCESSING_DELAY,U.avgProcessingDelayMs),Q){const Y=y.timestamp-P.timestamp||wb*(M?6:O?3:1);U.packets!=null&&Q.packets!=null&&te(W,Yr.PACKAGE_RATE,1e3*(U.packets-Q.packets)/Y),O&&Q.bytes!=null&&U.bytes!=null&&te(W,Yr.BITRATE,8*(U.bytes-Q.bytes)/Y),U.packetsLost!=null&&Q.packetsLost!=null&&te(W,Yr.PACKAGE_LOST,U.packetsLost-Q.packetsLost)}if(M){const{receivedFrames:Y,droppedFrames:ot}=U;Y!=null&&ot!=null&&(W[Yr.FREEZE]=(X=Y)===0||100*ot/X>20?1:0)}var X;if(O){const Y=100*I._source.getAccurateVolumeLevel(),ot=U.outputLevel;if(ot!=null){const Et=Math.ceil(50*Math.log10(100*ot+1));te(W,D2.LEVEL,Et)}if(te(W,Yr.PCM_LEVEL,Y),I&&(W[Yr.DISABLED]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),te(W,Yr.JITTER_BUFFER,U.jitterBufferMs),te(W,Yr.CURRENT_DELAY,U.jitterBufferMs),W[Yr.PLAYER_STATUS]=sO[Nr.getPlayerState(I.getTrackId())],Q){const Et=U.concealedSamples-Q.concealedSamples;Et>0&&te(W,Yr.CONCEALED_SAMPLES,Et)}}return W}(d._audioSSRC,e,n,d.audioTrack,i,r):void 0;S&&(f.audio=S)}(f.video||f.audio)&&c.push(f)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof JR);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(qg.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,i]=e;i.has(xt.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(xt.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const o=this.requestAllTracks&&this.requestAllTracks()||[];for(const p of o)!p.muted&&p.enabled&&(r=r.concat(await p.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[p,f]of c)f.has(xt.VIDEO)&&p.videoTrack&&(r=r.concat(await p.videoTrack.getProcessorUsage())),f.has(xt.AUDIO)&&p.audioTrack&&(r=r.concat(await p.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(p,f){const S={};for(const{id:I,value:O,level:M,direction:U}of p){var v;const W=(v=f.get(I))!==null&&v!==void 0?v:0,Q=O===2?W+j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:W;var y,P;f.set(I,Q),S[I]?(O===2&&(S[I].value=O),M>S[I].level&&(S[I].level=M),U==="remote"&&(S[I].remoteUidCount+=1),S[I].totalTs=(y=f.get(I))!==null&&y!==void 0?y:0):S[I]={value:O,level:M,remoteUidCount:U==="local"?0:1,totalTs:(P=f.get(I))!==null&&P!==void 0?P:0}}return Object.keys(S).map(I=>{const{level:O,value:M,totalTs:U}=S[I];return{id:I,level:O,value:M,totalTs:U}})}(r,e);const l=Date.now(),d=l>n?l:n+1;this.requestUpload&&this.requestUpload(qg.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:d})},j("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const TY=j("ICE_RESTART_INTERVAL");let Ib=new Map,Qm=new Map,Qu=[nr.UDP_TCP_RELAY,nr.TCP_RELAY,nr.RELAY],JO=j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ue().supportPCSetConfiguration;function M2(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Ib.get(t.id);n&&(window.clearTimeout(n),Ib.delete(t.id));const i=Qm.get(t.id);e&&i&&i.index===Qu.length-1&&(b.debug("[".concat(t.id,"] reset ICE restart policy")),Qm.delete(t.id))}function U2(t,e,n){if(Ib.size===0&&Qm.size===0&&(Array.isArray(j("RESTART_SEQUENCE"))&&j("RESTART_SEQUENCE").length>0&&!function(l,d){if(l.length!==d.length)return!1;for(let p=0;p<l.length;p+=1){const f=l[p];if(l.filter(S=>S===f).length!==d.filter(S=>S===f).length)return!1}return!0}(Qu,j("RESTART_SEQUENCE"))&&(Qu=j("RESTART_SEQUENCE").filter(l=>{var d;if(Ct(d=Object.values(nr)).call(d,l))return!0}),b.debug("use reconnection policy from config distribution, queues: ".concat(Qu.join(" => ")))),JO=j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ue().supportPCSetConfiguration),Qu.length===0)return void n();let i,{index:r=0,type:o}=Qm.get(t.id)||{};if(JO&&o===nr.RELAY)return void n();let c=o&&r>=Qu.length-1;if(JO)o=nr.RELAY;else{if(c)return void n();o?(r++,o=Qu[r]):(o=Qu[0],r=0)}b.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(o,", index: ").concat(r)),e(o),Qm.set(t.id,{index:r,type:o}),i=window.setTimeout(()=>U2(t,e,n),TY),Ib.set(t.id,i)}var Se;function x2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Pc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?x2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function V2(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=yI,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new Ob(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Ob(t){function e(n){if(Object(n)!==n)return At.reject(new TypeError(n+" is not an object."));var i=n.done;return At.resolve(n.value).then(function(r){return{value:r,done:i}})}return Ob=function(n){this.s=n,this.n=n.next},Ob.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?At.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?At.reject(n):e(i.apply(this.s,arguments))}},new Ob(t)}let sS=(Se=class extends An{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(qt.StateChange,e,this._state)}constructor(t,e){super(),D(this,"isPlanB",void 0),D(this,"store",void 0),D(this,"statsUploader",void 0),D(this,"connection",void 0),D(this,"localTrackMap",new Map),D(this,"remoteUserMap",new Map),D(this,"localDataChannels",[]),D(this,"remoteDataChannelMap",new Map),D(this,"pendingLocalTracks",[]),D(this,"pendingRemoteTracks",[]),D(this,"pendingLocalDataChannels",[]),D(this,"pendingRemoteDataChannels",[]),D(this,"statsCollector",void 0),D(this,"shouldForwardP2PCreation",void 0),D(this,"iceFailedCount",0),D(this,"dtlsFailedCount",0),D(this,"mutex",void 0),D(this,"_state",Ye.Disconnected),D(this,"_pcStatsUploadType",j("NEW_ICE_RESTART")?Pl.FIRST_CONNECTION:Pl.OLD_FIRST_CONNECTION),D(this,"_isStartRestartIce",!1),D(this,"_restartTimer",void 0),D(this,"_isTryConnecting",!1),D(this,"_iceError",null),D(this,"_forceTurn",!1),D(this,"_isWaitPcToRePub",!1),D(this,"handleMuteLocalTrack",async(n,i,r)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ye.Connected)return void r(new st(L.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(p=>p[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const d=this.createMuteMessage(c);await cn(this,qt.RequestMuteLocal,d),i()}catch(c){r(c)}finally{o()}}),D(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ye.Connected)return void r(new st(L.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(p=>p[0]==="videoLowTrack");if(l){const p=l[1];if(p.track._originMediaStreamTrack.stop(),!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ue().supportDualStreamEncoding){const f=n._mediaStreamTrack.clone();p.track._mediaStreamTrack=f,p.track._originMediaStreamTrack=f}else{const f=XO(n,Fg(this,qt.RequestLowStreamParameter));p.track._mediaStreamTrack=f,p.track._originMediaStreamTrack=f}await new At((f,S)=>{this.handleReplaceTrack(p.track,f,S,!0)})}await this.connection.unmuteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const d=this.createUnmuteMessage(c);await cn(this,qt.RequestUnmuteLocal,d),i()}catch(c){r(c)}finally{o()}}),D(this,"handleUpdateVideoEncoder",async(n,i,r,o)=>{let c;o||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(_t.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==Ye.Connected)return void i();const{id:p,track:f}=d;await this.connection.updateSendParameters(p,f),await this.connection.updateEncoderConfig(p,f),this.emit(qt.UpdateVideoEncoder,f),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),D(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(_t.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Ye.Connected)return void i();const{id:l,track:d}=c;await this.connection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{o()}}),D(this,"handleReplaceMixingTrack",async(n,i,r,o)=>{if(!this.connection||this.state!==Ye.Connected)return void i();const c=YO([n]);let l;b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof o=="boolean"&&o||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(p){r(p)}finally{var d;(d=l)===null||d===void 0||d()}}),D(this,"handleReplaceTrack",async(n,i,r,o)=>{let c;b.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof o=="boolean"&&o||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const p=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:S}]=f;return n===S});if(!this.connection||!p||this.state!==Ye.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,p[1].id)),this.isPlanB){const f=p[1];f.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],f)}if(p[0]===_t.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ue().supportDualStreamEncoding){const f=this.localTrackMap.get(_t.LocalVideoLowTrack);if(f){const S=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=S,f.track._originMediaStreamTrack=S,await new At((v,y)=>{this.handleReplaceTrack(f.track,v,y,!0)})}}i()}catch(p){r(p)}finally{var d;(d=c)===null||d===void 0||d()}}),D(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),D(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),D(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),D(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),D(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new k2(this.store),this.bindStatsUploaderEvents(),this.mutex=new zi("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ue().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&Al(),this.shouldForwardP2PCreation=j("FORWARD_P2P_CREATION")&&Ue().supportPCSetConfiguration&&LI(),this.shouldForwardP2PCreation&&(this.connection=bb(this.store),this.emit(qt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=Ye.New,this._forceTurn=I2(t),b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=bb(this.store,t),this.emit(qt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new st(L.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=j("NEW_ICE_RESTART")?Pl.FIRST_CONNECTION:Pl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new st(L.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");j("ENABLE_PREALLOC_PC")&&this.state===Ye.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ye.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(r=>{var o;let[c]=r;return Ct(o=[_t.LocalVideoLowTrack,_t.LocalVideoTrack]).call(o,c)}),n=e.map(r=>{let[,{id:o}]=r;return o}),i=e.map(r=>{let[o]=r;return o});if(this.connection instanceof Ml){if(Wt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!Ct(t).call(t,this.store.codec)){const r=["vp9","vp8","h264"].find(o=>Ct(t).call(t,o));r&&(this.store.codec=r,b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof Ml&&this.connection.peerConnectionState!=="closed"&&Ct(t=[Ye.New,Ye.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Ye.Connected){if(this.state===Ye.Disconnected)throw new st(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var i;Ct(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var i=this;return Xs(function*(){const r=yield De(i.mutex.lock("From P2PChannel.publish"));try{var o;const c=i.connection&&Ct(o=["disconnected","failed"]).call(o,i.connection.peerConnectionState);if(!i.connection||i.state!==Ye.Connected||c){if(i.state===Ye.Disconnected)throw new st(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const d=t.filter(p=>i.pendingLocalTracks.indexOf(p)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(d),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,qi.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(t,e,n);if(l.length===0)return void(yield De(i.tryToUnmuteAudio(t)));yield*RR(V2(i.doPublish(i.connection,l)))}finally{r()}})()}doPublish(t,e){var n=this;return Xs(function*(){e.forEach(v=>{let{track:y,type:P}=v;const I=Date.now();n.store.publish(y.getTrackId(),P===_t.LocalAudioTrack?"audio":"video",I)}),n.bindLocalTrackEvents(e);const i=e.map(v=>{let{track:y}=v;return y}),r=yield De(t.send(i,n.store.codec,n.store.audioCodec)),o=(yield De(r.next())).value,c=n.createGatewayPublishMessage(e,o);let l;try{l=yield c}catch(v){throw r.throw(v),(v==null?void 0:v.code)===L.WS_ABORT&&e.forEach(y=>{let{track:P}=y;n.pendingLocalTracks.indexOf(P)===-1&&n.pendingLocalTracks.push(P)}),n.unbindLocalTrackEvents(e),v}const d=n.mapPubResToRemoteConfig(c,l,i),p=(yield De(r.next(d))).value;if(n.state===Ye.Disconnected)throw new st(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");j("ENABLE_VIDEO_SEI");const f=j("ENABLE_ENCODED_TRANSFORM"),S=j("ENABLE_AUDIO_METADATA");i.forEach(async v=>{const y=v.getRTCRtpTransceiver();y&&f&&(v.trackMediaType===xt.VIDEO?await pz(y.sender,v):v.trackMediaType===xt.AUDIO&&await sz(y.sender,{metadata:S?()=>{const P=v.metadata.shift();return P&&P.value}:void 0}))}),e.forEach(v=>{let{type:y}=v;n.statsCollector.addLocalStats(y)}),n.assignLocalTracks(e,p),n.statsUploader.startUploadOutboundStats(),e.forEach(v=>{let{track:y,type:P}=v;const I=Date.now();n.store.publish(y.getTrackId(),P===_t.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof En))return b.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,r=function(o,c){const l={};return o.height&&o.width&&(l.scaleResolutionDownBy=DO(o,c)),l.maxFramerate=o.framerate?ps(o.framerate):void 0,l.maxBitrate=o.bitrate?1e3*o.bitrate:void 0,l}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==_t.LocalVideoLowTrack||!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ue().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const o=i._originMediaStreamTrack;if(!o.canvas)return b.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,l){const d=c.canvas;l.width&&(d.width=ps(l.width)),l.height&&(d.height=ps(l.height)),l.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=aO(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},ps(l.framerate)))})(o,t)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),b.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return Xs(function*(){if(!e.connection||e.state!==Ye.Connected)return;const n=yield De(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(_t.LocalVideoTrack);if(!r)throw new st(L.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(_t.LocalVideoLowTrack))throw new st(L.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const o=[{track:e.getLowVideoTrack(r.track,t),type:_t.LocalVideoLowTrack}];if(yield*RR(V2(e.doPublish(e.connection,o))),r.track.muted||!r.track.enabled){var i;const c=(i=e.localTrackMap.get(_t.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield De(e.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(b.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await xi(this,qt.RequestRePublish,this.pendingLocalTracks),this.emit(qt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(b.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await xi(this,qt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:i}=this.pendingRemoteTracks[e];(i!==xt.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==xt.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await xi(this,qt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===xt.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(qt.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Ye.Connected)return void t.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Ye.Connected)return void t.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ye.Connected)return;const t=this.localTrackMap.get(_t.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[_t.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[r,{track:o}]=i;return{type:r,track:o}})),e.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Ye.Connected)throw new st(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(t,new Map([[i.id,i]]));const o=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:d}=c;return l.uid===t.uid&&d===i.id});o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),n.map(i=>i.id)}async subscribe(t,e,n,i,r){var o;if(!this.connection||this.state!==Ye.Connected)throw new st(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o=this.remoteUserMap.get(t))!==null&&o!==void 0&&o.has(e))return;let c,l,d;const p=this.connection.getPreMedia(n);if(p)b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),d=p.transceiver,c=p.track,l=p.id;else if(r){const v=r.find(P=>{let{stream_type:I}=P;return I===e});if(!v)throw new st(L.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const y=await this.connection.receive(e,v.ssrcs,String(t._uintid),v.attributes);this.connection instanceof Ml&&(d=y.transceiver),c=y.track,l=y.id}else{const v=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof Ml&&(d=v.transceiver),c=v.track,l=v.id}e===xt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new Um(c,t.uid,t._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),d&&t._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new Mm(c,t.uid,t._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),d&&t._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._videoTrack)),d&&j("ENABLE_ENCODED_TRANSFORM")&&(e==xt.VIDEO?await SO(d.receiver,{onSei:j("ENABLE_VIDEO_SEI")&&(v=>{var y;return(y=t._videoTrack)===null||y===void 0?void 0:y._onSei(v)})}):e==xt.AUDIO&&await gO(d.receiver,{enableTopn:!!j("ENABLE_AUDIO_TOPN"),enableMetadata:!!j("ENABLE_AUDIO_METADATA"),onMetadata:v=>{this.safeEmit(qt.AudioMetadata,v)}}));const f=this.remoteUserMap.get(t);f?f.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(v=>{let{user:y,kind:P}=v;return y.uid===t.uid&&e===P});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(qt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Ye.Connected)throw new st(L.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(r=>{var o;let{user:c,mediaType:l}=r;return!((o=this.remoteUserMap.get(c))!==null&&o!==void 0&&o.has(l))});const e=[],n=new Map;t.forEach(r=>{if(!this.connection)return;const o=this.connection.getPreMedia(r.ssrcId);o?n.set(r.ssrcId,o):e.push(r)});const i=await this.connection.batchReceive(e.map(r=>{let{user:o,mediaType:c,ssrcId:l,rtxSsrcId:d}=r;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:d}],mslabel:String(o._uintid)}}));e.forEach((r,o)=>{n.set(r.ssrcId,i[o])});for(const{user:r,mediaType:o,ssrcId:c}of t){const l=n.get(c);if(!l)return void b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(o,", ").concat(c));const{track:d,id:p,transceiver:f}=l;f&&j("ENABLE_ENCODED_TRANSFORM")&&(o==xt.VIDEO?await SO(f.receiver,{onSei:j("ENABLE_VIDEO_SEI")&&(y=>{var P;return(P=r._videoTrack)===null||P===void 0?void 0:P._onSei(y)})}):o==xt.AUDIO&&await gO(f.receiver,{enableTopn:!!j("ENABLE_AUDIO_TOPN"),enableMetadata:!!j("ENABLE_AUDIO_METADATA"),onMetadata:y=>{this.safeEmit(qt.AudioMetadata,y)}})),o===xt.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(d):(r._audioTrack=new Um(d,r.uid,r._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),f&&r._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(d):(r._videoTrack=new Mm(d,r.uid,r._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),f&&r._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(r,r._videoTrack)),j("ENABLE_VIDEO_SEI")&&f&&(o==xt.VIDEO?await SO(f.receiver,{onSei:y=>{var P;(P=r._videoTrack)===null||P===void 0||P._onSei(y)}}):o==xt.AUDIO&&await gO(f.receiver));const S=this.remoteUserMap.get(r);S?S.set(o,p):this.remoteUserMap.set(r,new Map([[o,p]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const v=this.pendingRemoteTracks.findIndex(y=>{let{user:P,kind:I}=y;return P.uid===r.uid&&o===I});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(qt.MediaReconnectEnd,r.uid))}}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:d}=c;return e!==void 0?l.uid===t.uid&&e===d:l.uid===t.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Ye.Connected||n||i.forEach(c=>{let{kind:l}=c;var d;if(l===xt.AUDIO)(d=t._audioTrack)===null||d===void 0||d._destroy(),t._audioTrack=void 0;else if(l===xt.VIDEO){var p;(p=t._videoTrack)===null||p===void 0||p._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Ye.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const o=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:d}]=c;var p,f;if(d===xt.VIDEO&&l._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===xt.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(d===xt.AUDIO){var S;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((S=l._audioTrack)===null||S===void 0||S._destroy(),l._audioTrack=void 0)}}),o}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const o=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(t);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:o}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:p}=l;return o!==void 0?d.uid===r.uid&&o===p:d.uid===r.uid});c.forEach(l=>{const d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),e=e.concat(c)}if(!this.connection||this.state!==Ye.Connected)return void e.forEach(r=>{let{user:o,kind:c}=r;var l;if(c===xt.AUDIO)(l=o._audioTrack)===null||l===void 0||l._destroy(),o._audioTrack=void 0;else if(c===xt.VIDEO){var d;(d=o._videoTrack)===null||d===void 0||d._destroy(),o._videoTrack=void 0}});const n=Hi(t).call(t,(r,o)=>{let{user:c,mediaType:l}=o;const d=this.filterTobeUnSubscribedTracks(c,l);return r.concat(d)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:o}]=r;return o}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[o,{kind:c}]=r;var l,d;if(c===xt.VIDEO&&o._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===xt.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),(d=o._videoTrack)===null||d===void 0||d._destroy(),o._videoTrack=void 0;else if(c===xt.AUDIO){var p;this.unbindRemoteTrackEvents(o._audioTrack),(p=o._audioTrack)===null||p===void 0||p._destroy(),o._audioTrack=void 0}}),i}isPreSubScribe(t){return!this.connection||this.state!==Ye.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void b.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===xt.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||b.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(_t.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(_t.LocalAudioTrack);if((e==null?void 0:e.track)instanceof ci){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==_t.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===_t.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===_t.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(_t.LocalAudioTrack),l=i?this.localTrackMap.get(_t.LocalVideoLowTrack):this.localTrackMap.get(_t.LocalVideoTrack);Wt.publish(this.store.sessionId,{eventElapse:qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(un.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var o;n||(n=[]);const c=n.find(d=>d instanceof Mn),l=i?(o=this.localTrackMap.get(_t.LocalVideoTrack))===null||o===void 0?void 0:o.track:n.find(d=>d instanceof En);Wt.publish(this.store.sessionId,{eventElapse:qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(un.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===xt.VIDEO?n._videoSSRC:n._audioSSRC;r&&Wt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===xt.VIDEO,audio:i===xt.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:qi.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){b.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new zi("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=bb(this.store),this.emit(qt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(_t.LocalAudioTrack);if((t==null?void 0:t.track)instanceof ci){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ye.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(_t.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(_t.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof En||e&&e.track instanceof Mn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(Ns(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(_t.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Cg(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.connection&&(b.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ye.Reconnecting,j("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=bb(this.store),this.emit(qt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case _t.LocalVideoTrack:Ct(e=i._hints).call(e,un.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case _t.LocalAudioTrack:i instanceof ci?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case _t.LocalVideoLowTrack:}}),this.emit(qt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Ns(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(qt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Ns(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),b.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((t instanceof Ju?t.uid:t)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof Ju?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return Xs(function*(){if(!e.connection||e.state!==Ye.Connected)return;const n=yield De(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield De(e.connection.restartICE(t));const o=yield De(i.next());if(o.done)return;const c=o.value,l=yield c;switch(qO(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case nr.UDP_TCP_RELAY:e._pcStatsUploadType=Pl.UDP_TCP_RESTART;break;case nr.TCP_RELAY:e._pcStatsUploadType=Pl.TCP_RESTART;break;case nr.RELAY:e._pcStatsUploadType=Pl.RELAY_RESTART;break;default:e._pcStatsUploadType=Pl.OLD_RESTART}e._isTryConnecting=!0,i.next(l)}catch(o){var r;(r=i)===null||r===void 0||r.throw(o)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(_t.LocalVideoTrack),n=this.localTrackMap.get(_t.LocalAudioTrack),i=t.videoSend.find(y=>y.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(y=>y.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const o=Is(this,qt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,p=(d&&o?(d+o)/2:d||o)||0,f=100*t.sendPacketLossRate*.7/50+.3*p/1500,S=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,v=e==null?void 0:e.track;if(v&&v._encoderConfig&&v._hints.indexOf(un.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,P=t.bitrate.actualEncoded;if(y&&P){const I=(1e3*y-P)/(1e3*y);return gx[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,o=i._videoSSRC,c=t.audioRecv.find(P=>P.ssrc===r),l=t.videoRecv.find(P=>P.ssrc===o);if(!c&&!l)return void(e+=1);const d=Is(this,qt.NeedSignalRTT),p=t.rtt,f=(p&&d?(p+d)/2:p||d)||0,S=c?c.jitterMs:void 0,v=t.recvPacketLossRate;let y=.7*v*100/50+.3*f/1500;S&&(y=.6*v*100/50+.2*f/1500+.2*S/400),e+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new At((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(b.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==Ye.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return t===c});if(!i)return;const r=i[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:r}]),this.bindLocalTrackEvents([{track:e,type:r}]),i[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,i[1].id)),this.isPlanB){const o=i[1];o.id=e._mediaStreamTrack.id,this.localTrackMap.set(r,o)}if(r===_t.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ue().supportDualStreamEncoding){const o=this.localTrackMap.get(_t.LocalVideoLowTrack);if(o){const c=t._mediaStreamTrack.clone();o.track._originMediaStreamTrack.stop(),o.track._mediaStreamTrack=c,o.track._originMediaStreamTrack=c,await new At((l,d)=>{this.handleReplaceTrack(o.track,l,d,!0)})}}}filterTobePublishedTracks(t,e,n){const i=[],r=this.getAllTracks();t=Rm(t=t.filter(d=>r.indexOf(d)===-1));let o,c=!1;const l=this.localTrackMap.get(_t.LocalAudioTrack);for(const d of t){if(d instanceof En&&(this.localTrackMap.has(_t.LocalVideoTrack)||c?new st(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:_t.LocalVideoTrack}),c=!0),e)){const p=this.getLowVideoTrack(d,n);i.push({track:p,type:_t.LocalVideoLowTrack})}if(d instanceof Mn)if(l){const p=l.track;if(p instanceof ci)zO([d]),p.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{const f=YO([p,d]);b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),this.replaceTrack(p,f)}}else o instanceof ci?(zO([d]),o.addAudioTrack(d)):o||!d._useAudioElement&&Ue().webAudioMediaStreamDest&&!d._bypassWebAudio?o=YO(o?[d,o]:[d]):o=d}return o&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),i.push({track:o,type:_t.LocalAudioTrack})),i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Rm(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof Mn){const r=this.localTrackMap.get(_t.LocalAudioTrack);if(!r)continue;r.track instanceof ci?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([_t.LocalAudioTrack,r]),r.track.close())):e.push([_t.LocalAudioTrack,r])}if(i instanceof En){const r=this.localTrackMap.get(_t.LocalVideoTrack);if(!r)continue;e.push([_t.LocalVideoTrack,r]);const o=this.localTrackMap.get(_t.LocalVideoLowTrack);o&&e.push([_t.LocalVideoLowTrack,o])}}return e}filterTobePublishedDataChannels(t){return t=(t=Rm(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Rm(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case _t.LocalVideoTrack:n.addListener(Bt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Bt.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _t.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case _t.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof ci?t.trackList.forEach(n=>{n.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Bt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Bt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Bt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case _t.LocalVideoTrack:n.off(Bt.GET_STATS,this.handleGetLocalVideoStats),n.off(Bt.GET_RTC_STATS,this.handleGetRTCStats),n.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _t.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case _t.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof ci?t.trackList.forEach(e=>{e.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Bt.GET_STATS,this.handleGetLocalAudioStats),e.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Bt.GET_STATS,this.handleGetLocalAudioStats),t.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Bt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Mm&&e.addListener(Bt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Um&&e.addListener(Bt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Bt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(xt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(xt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let o,c,{track:l,type:d}=n;switch(d){case _t.LocalAudioTrack:o=qe.Audio,c={dtx:l instanceof JR&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case _t.LocalVideoTrack:o=Ct(r=l._hints).call(r,un.SCREEN_TRACK)?qe.Screen:qe.High,c=Pc(Pc({},Ux(l)),{},{codec:this.store.codec,svc_mode:hb()});break;case _t.LocalVideoLowTrack:o=qe.Low,c=Pc(Pc({},Ux(l)),{},{codec:this.store.codec,svc_mode:hb()})}return{stream_type:o,attributes:c,ssrcs:e[i]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case _t.LocalVideoTrack:i=Ct(n=o._hints).call(n,un.SCREEN_TRACK)?qe.Screen:qe.High;break;case _t.LocalAudioTrack:i=qe.Audio;break;case _t.LocalVideoLowTrack:i=qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:o}=n;this.localTrackMap.set(o,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(qt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Ml&&M2(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Pl.DISCONNECTED_OR_FAILED,Is(this,qt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));Wt.reportApiInvoke(this.store.sessionId,{name:ii.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:Dn.TRACER}).onSuccess(),this.republish()}if(j("NEW_ICE_RESTART")&&t instanceof Ml&&!Ln()&&!this._forceTurn){if(Ct(Ox).call(Ox,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=r=>{qO(t)&&(b.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),Is(this,qt.QueryClientConnectionState)==="CONNECTED"&&this.emit(qt.RequestRestartICE,r))},i=()=>{qO(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),b.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(qt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{U2(t,n,i)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&j("ICE_RESTART")&&Is(this,qt.QueryClientConnectionState)==="CONNECTED"&&this.emit(qt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(qt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(qt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Dn.TRACER}).onSuccess(),this.emit(qt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(Ns(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Nm.FIRST_FRAME_DECODED),Wt.firstRemoteFrame(this.store.sessionId,Ei.FIRST_AUDIO_DECODE,yn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(Ns(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&Wt.firstRemoteFrame(this.store.sessionId,Ei.FIRST_AUDIO_RECEIVED,yn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(Ns(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&Wt.firstRemoteFrame(this.store.sessionId,Ei.FIRST_VIDEO_RECEIVED,yn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(qt.ConnectionTypeChange,i),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Yu(n))," -> ").concat(JSON.stringify(Yu(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Yu(n))," -> ").concat(JSON.stringify(Yu(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Pc(Pc({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof Ml&&function(e){Qm.delete(e.id),M2(e)}(t),t.close(),this.emit(qt.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(_t.LocalAudioTrack);if(t instanceof Mn&&(n==null?void 0:n.track)instanceof ci)return n.track.isActive||e.push([_t.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return t===o});if(i&&(e.push(i),i[0]===_t.LocalVideoTrack)){const r=this.localTrackMap.get(_t.LocalVideoLowTrack);r&&e.push([_t.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(_t.LocalAudioTrack);if(t instanceof Mn&&(n==null?void 0:n.track)instanceof ci)return n.track.isActive&&e.push([_t.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return t===o});if(i)if(i[0]===_t.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(_t.LocalVideoLowTrack);r&&e.push([_t.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case _t.LocalAudioTrack:i=qe.Audio;break;case _t.LocalVideoTrack:i=Ct(n=o._hints).call(n,un.SCREEN_TRACK)?qe.Screen:qe.High;break;case _t.LocalVideoLowTrack:i=qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case _t.LocalAudioTrack:i=qe.Audio;break;case _t.LocalVideoTrack:i=Ct(n=o._hints).call(n,un.SCREEN_TRACK)?qe.Screen:qe.High;break;case _t.LocalVideoLowTrack:i=qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[o,c]=r;n.push([t,{kind:o,id:c}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:o}]=n;switch(r){case xt.VIDEO:return void(i._videoSSRC&&e.push({stream_type:xt.VIDEO,ssrcId:i._videoSSRC}));case xt.AUDIO:return void(i._audioSSRC&&e.push({stream_type:xt.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[i,{kind:r}]=n;if(e.has(i)){let o=e.get(i);r===xt.VIDEO?o|=gi.Video:o|=gi.Audio,e.set(i,o)}else r===xt.VIDEO?e.set(i,gi.Video):e.set(i,gi.Audio)}),{users:Array.from(e.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(_t.LocalVideoTrack),n=this.localTrackMap.get(_t.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new At((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new At((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e,n){return t.map((i,r)=>{var o;let{stream_type:c}=i;const l=(o=e.find(d=>{let{stream_type:p}=d;return c===p}))===null||o===void 0?void 0:o.attributes;if(l&&j("DISABLE_SCREEN_SHARE_REMB")){const d=n[r]._hints;(Ct(d).call(d,un.SCREEN_TRACK)||Ct(d).call(d,un.SCREEN_LOW_TRACK))&&(l.remb=!1,b.debug("disable remb for screen share, hints:",d))}return l})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof Mn){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(o=>{let[,{id:c}]=o;return c})));const r=this.createUnmuteMessage(i);return void await cn(this,qt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(qt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(qt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ni(FI(this.dtlsFailedCount,ri)),this.emit(qt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await xi(this,qt.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(qt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(_t.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof En)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof En).length>1)throw new st(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Mn).length>1&&(t.some(e=>e instanceof Mn&&e._bypassWebAudio)||!Ue().webAudioMediaStreamDest))throw new st(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof En&&this.pendingLocalTracks.some(n=>n instanceof En))throw new st(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Mn&&this.pendingLocalTracks.some(n=>n instanceof Mn)&&(!Ue().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Mn&&n._bypassWebAudio)))throw new st(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const i=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ue().supportDualStreamEncoding,r=Pc(Pc({},{width:160,height:120,framerate:15,bitrate:50}),e);let o;o=i?t._mediaStreamTrack.clone():XO(t,r);const c=ln(8,"track-low-"),l=new En(o,Pc(Pc({},i&&{scaleResolutionDownBy:DO(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(Fh.TRANSCEIVER_UPDATED,d=>{t._updateRtpTransceiver(d,Im.LOW_STREAM)}),l._hints.push(un.LOW_STREAM),Ct(n=t._hints).call(n,un.SCREEN_TRACK)&&l._hints.push(un.SCREEN_LOW_TRACK),t.on("sei-to-send",d=>{l.emit("sei-to-send",d)}),t.addListener(Bt.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ml){var r,o,c,l;const d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:p,dtlsTransportState:f,peerConnectionState:S}=this.connection,{local:v,remote:y}=await this.connection.getSelectedCandidatePair();Wt.pcStats(this.store.sessionId,{startTime:d,eventElapse:t-d||0,iceconnectionsate:p,dtlsstate:f,connectionstate:S,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=v==null?void 0:v.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(o=v.candidateType)!==null&&o!==void 0?o:"",selectedLocalCandidateAddress:"".concat(v.address,":").concat(v.port),selectedRemoteCandidateProtocol:(c=y.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=y.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,e,n,i){var r;const o=Array.from(Ns(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===o.uid&&d.type==="video");Wt.firstRemoteVideoDecode(this.store.sessionId,Ei.FIRST_VIDEO_DECODE,yn.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:e,videoheight:n,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0,firstFrame:(l==null?void 0:l.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const o=await this.connection.getRemoteSSRC(r);return o!==void 0&&o!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===_t.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Im.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ft(Se.prototype,"startP2PConnection",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"startP2PConnection"),Se.prototype),Ft(Se.prototype,"connect",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"connect"),Se.prototype),Ft(Se.prototype,"updateRemoteRTPCapabilities",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"updateRemoteRTPCapabilities"),Se.prototype),Ft(Se.prototype,"publishDataChannel",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"publishDataChannel"),Se.prototype),Ft(Se.prototype,"unpublish",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"unpublish"),Se.prototype),Ft(Se.prototype,"unpublishDataChannel",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"unpublishDataChannel"),Se.prototype),Ft(Se.prototype,"unpublishLowStream",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"unpublishLowStream"),Se.prototype),Ft(Se.prototype,"subscribeDataChannel",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"subscribeDataChannel"),Se.prototype),Ft(Se.prototype,"subscribe",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"subscribe"),Se.prototype),Ft(Se.prototype,"massSubscribe",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"massSubscribe"),Se.prototype),Ft(Se.prototype,"unsubscribe",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"unsubscribe"),Se.prototype),Ft(Se.prototype,"unsubscribeDataChannel",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"unsubscribeDataChannel"),Se.prototype),Ft(Se.prototype,"massUnsubscribe",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"massUnsubscribe"),Se.prototype),Ft(Se.prototype,"muteRemote",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"muteRemote"),Se.prototype),Ft(Se.prototype,"unmuteRemote",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"unmuteRemote"),Se.prototype),Ft(Se.prototype,"hasRemoteMediaWithLock",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"hasRemoteMediaWithLock"),Se.prototype),Ft(Se.prototype,"disconnectForReconnect",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"disconnectForReconnect"),Se.prototype),Ft(Se.prototype,"updateBitrateLimit",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"updateBitrateLimit"),Se.prototype),Ft(Se.prototype,"remoteMediaSsrcChanged",[ur],Object.getOwnPropertyDescriptor(Se.prototype,"remoteMediaSsrcChanged"),Se.prototype),Se);function ur(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,o=await r.lock("From P2PChannel.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{o()}},n}function B2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function j2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?B2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const vY=Date.now(),QO=new Map,Nb=new Map;async function F2(t){const e=QO.get(t),n=Array.isArray(e)&&e[e.length-1],i=Nb.get(t);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const o=n.sendTs-i.firstSendTs,c=o-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-o);let l=n.mediaDelay+c;l<=0?(e.pop(),G2(n.context,r),l=0):l=Math.min(l,20),setTimeout(()=>e.length&&F2(t),l)}function G2(t,e){t.safeEmit(ye.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function yY(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return G2(n,{uid:t.uid,payload:t.payload});const i="".concat(n.id,"-").concat(t.uid),r=QO.get(i)||[],o=r.findIndex(p=>t.sendTs>=p.sendTs),c=j2(j2({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});o===-1?r.push(c):r.splice(o,0,c),QO.set(i,r);let l=!1;var d;Nb.has(i)?l=!((d=Nb.get(i))===null||d===void 0||!d.isSyncing):Nb.set(i,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||F2(i)}const RY=Me().name;function H2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function W2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?H2(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Zm="websdk_ng_cache_parameter",bY=j("MAX_PRELOAD_ASYNC_LENGTH"),$h=new Map,tp=[];let ZO=null,$O=0,t0=0;const Db=new Map,CY=function(t,e){const n=[];let i=0;const r=async()=>{const o=n.shift();o&&await o(),n.length>0&&i<e?r():i--};return async function(){for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return new At(async(d,p)=>{n.push(async()=>{try{const f=await t(...c);d(f)}catch(f){p(f)}}),i<e&&(i++,r())})}}(K2,bY),e0=Or.CancelToken.source();async function K2(t,e,n,i,r,o){try{if(!j("ENABLE_PRELOAD"))return;if(!Ue().supportWebCrypto)return void Gu(()=>{b.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new st(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Oi(n,"token",1,2047),Oi(t,"appid",1,2047),ab(e),i&&cb(i);const c=Bh();b.debug("preload channel ".concat(e,", uid is ").concat(i));const l={appId:t,cname:e,token:n||t,uid:typeof i!="string"?i:null,sid:c,proxyServer:r};let d,p;typeof i=="string"?(l.stringUid=i,[p,d]=await At.all([cY(i,{sid:c,appId:t},e0.token),p2(W2(W2({},l),{},{token:n||t,uid:0}),e0.token)]),l.uid=p.uid,d.gatewayInfo.uid=l.uid,d.gatewayInfo.res.uid=l.uid):(o&&(l.stringUid=o),d=await p2(l,e0.token));const f={sid:c,appId:t,cname:e,token:n||t,uid:l.stringUid||i,intUid:l.uid||d.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:p,ap:d};await async function(S){let v;try{S.uid&&Y2({appId:S.appId,cname:S.cname,token:S.token,uid:S.uid,stringUid:S.stringUid});const y=Q2(S),P=await async function(O,M){try{const U=await window.crypto.subtle.importKey("raw",GM(M),"AES-GCM",!1,["encrypt"]),W=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},U,Vh(window.btoa(JSON.stringify(O))));return Hu(new Uint8Array(W))}catch{return}}(S,S.token||S.appId);if(!P)return;v=J2(Zm);const I=v?JSON.parse(v):[];I.push({[y]:P}),I.length>j("AP_CACHE_NUM")&&I.shift(),Pb(Zm,JSON.stringify(I))}catch(y){b.warn("Error caching server parameters:",y.message),Pb(Zm,"")}}(f),$O++}catch(c){throw t0++,function(l){ZO||(ZO=window.setTimeout(()=>{let p="";Db.forEach((f,S)=>{p+="".concat(S,": ").concat(f," ;")}),Wt.reportApiInvoke(null,{name:ii.PRELOAD,options:{success:$O,failed:t0,err:p}}).onError(l),$O=0,t0=0,Db.clear(),ZO=null},1e4));const d=Db.get(l.code)||0;Db.set(l.code,d+1)}(c),c}}async function z2(t){try{if(j("AP_REQUEST_DETAIL")||j("ENABLE_ROLE_SELECT_EDGE"))return;const e=Y2(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const o=await window.crypto.subtle.importKey("raw",GM(r),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o,Vh(i));return JSON.parse(window.atob(Hu(new Uint8Array(c))))}catch{return}}(e,t.token||t.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<j("AP_CACHE_LIFETIME"))return n}catch(e){b.warn("Error get preloadInfo",e.message)}}function Y2(t){let e;try{if(e=J2(Zm),!e)return;const n=JSON.parse(e),i=Q2(t),r=function(c,l){for(let d=c.length-1;d>=0;d--)if(l(c[d]))return d;return-1}(n,c=>i in c);if(r===-1)return;const o=n.splice(r,1)[0];return Pb(Zm,JSON.stringify(n)),o[i]}catch(n){b.warn("Error delete preload info: ".concat(e),n.message),Pb(Zm,"")}}function n0(t){if(t){let e=$h.get(t);e&&(window.clearTimeout(e),e=null,$h.delete(t)),Ct(tp).call(tp,t)||t.cloudProxyServer!=="disabled"||tp.push(t)}if($h.size<j("AP_CACHE_NUM")&&tp.length>0){const e=tp.shift();$h.set(e,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:o,uid:c,proxyServer:l}=e;try{await CY(n,i,r,c,l,o),$h.has(e)&&n0(e)}catch(d){b.warn("update preload failed",d.message),q2(e)}},j("AP_UPDATE_INTERVAL")))}}function q2(t){const e=tp.indexOf(t);e!==-1&&tp.splice(e,1);let n=$h.get(t);n&&(window.clearTimeout(n),n=null,$h.delete(t),n0())}function X2(t,e){const n=t.sua,i=t.ap;e&&n&&Wt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),Wt.reportResourceTiming(t.ap.url,t.sid),Wt.joinWebProxyAP(t.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[Jn.CHOOSE_SERVER,Jn.CLOUD_PROXY_FALLBACK].toString()}),Wt.joinChooseServer(t.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Jn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function J2(t){return window.atob(window.localStorage.getItem(t)||"")}function Pb(t,e){window.localStorage.setItem(t,window.btoa(e))}function Q2(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),XM(e)}function AY(t){let e=function(){const n=OY.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&($n(i,10),Zu(i,r));let o=n.cid;o!==void 0&&($n(i,16),$n(i,o));let c=n.cname;c!==void 0&&($n(i,26),Zu(i,c));let l=n.deviceId;l!==void 0&&($n(i,34),Zu(i,l));let d=n.elapse;d!==void 0&&($n(i,40),$u(i,d));let p=n.fileSize;p!==void 0&&($n(i,48),$u(i,$m(p)));let f=n.height;f!==void 0&&($n(i,56),$u(i,$m(f)));let S=n.jpg;S!==void 0&&($n(i,66),$n(i,S.length),$2(i,S));let v=n.networkType;v!==void 0&&($n(i,72),$u(i,$m(v)));let y=n.osType;y!==void 0&&($n(i,80),$u(i,$m(y)));let P=n.requestId;P!==void 0&&($n(i,90),Zu(i,P));let I=n.sdkVersion;I!==void 0&&($n(i,98),Zu(i,I));let O=n.sequence;O!==void 0&&($n(i,104),$u(i,$m(O)));let M=n.sid;M!==void 0&&($n(i,114),Zu(i,M));let U=n.timestamp;U!==void 0&&($n(i,120),$u(i,U));let W=n.uid;W!==void 0&&($n(i,128),$n(i,W));let Q=n.vid;Q!==void 0&&($n(i,136),$n(i,Q));let X=n.width;X!==void 0&&($n(i,144),$u(i,$m(X)));let Y=n.service;Y!==void 0&&($n(i,152),$n(i,Y));let ot=n.callbackData;ot!==void 0&&($n(i,162),$n(i,ot.length),$2(i,ot));let Et=n.ticket;Et!==void 0&&($n(i,170),Zu(i,Et));let Ot=n.vendorConfigs;Ot!==void 0&&($n(i,178),Zu(i,Ot))}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function wY(t){return function(n){let i={};t:for(;!NY(n);){let r=oS(n);switch(r>>>3){case 0:break t;case 1:i.code=oS(n);break;case 2:i.msg=tV(n,oS(n));break;case 3:i.requestId=tV(n,oS(n));break;case 4:i.timestamp=DY(n,!1);break;default:IY(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function IY(t,e){switch(e){case 0:for(;128&Wo(t););break;case 2:i0(t,oS(t));break;case 5:i0(t,4);break;case 1:i0(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function $m(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let OY=[];function i0(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function NY(t){return t.offset>=t.limit}function Lb(t,e){let n=t.bytes,i=t.offset,r=t.limit,o=i+e;if(o>n.length){let c=new Uint8Array(2*o);c.set(n),t.bytes=c}return t.offset=o,o>r&&(t.limit=o),i}function Z2(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function $2(t,e){let n=Lb(t,e.length);t.bytes.set(e,n)}function tV(t,e){let n=Z2(t,e),i=String.fromCharCode,r=t.bytes,o="�",c="";for(let l=0;l<e;l++){let d,p,f,S,v=r[l+n];128&v?(224&v)==192?l+1>=e?c+=o:(d=r[l+n+1],(192&d)!=128?c+=o:(S=(31&v)<<6|63&d,S<128?c+=o:(c+=i(S),l++))):(240&v)==224?l+2>=e?c+=o:(d=r[l+n+1],p=r[l+n+2],(49344&(d|p<<8))!=32896?c+=o:(S=(15&v)<<12|(63&d)<<6|63&p,S<2048||S>=55296&&S<=57343?c+=o:(c+=i(S),l+=2))):(248&v)==240?l+3>=e?c+=o:(d=r[l+n+1],p=r[l+n+2],f=r[l+n+3],(12632256&(d|p<<8|f<<16))!=8421504?c+=o:(S=(7&v)<<18|(63&d)<<12|(63&p)<<6|63&f,S<65536||S>1114111?c+=o:(S-=65536,c+=i(55296+(S>>10),56320+(1023&S)),l+=3))):c+=o:c+=i(v)}return c}function Zu(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}$n(t,i);let r=Lb(t,i),o=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?o[r++]=l:(l<2048?o[r++]=l>>6&31|192:(l<65536?o[r++]=l>>12&15|224:(o[r++]=l>>18&7|240,o[r++]=l>>12&63|128),o[r++]=l>>6&63|128),o[r++]=63&l|128)}}function Wo(t){return t.bytes[Z2(t,1)]}function eV(t,e){let n=Lb(t,1);t.bytes[n]=e}function oS(t){let e,n=0,i=0;do e=Wo(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function $n(t,e){for(e>>>=0;e>=128;)eV(t,127&e|128),e>>>=7;eV(t,e)}function DY(t,e){let n,i=0,r=0,o=0;return n=Wo(t),i=127&n,128&n&&(n=Wo(t),i|=(127&n)<<7,128&n&&(n=Wo(t),i|=(127&n)<<14,128&n&&(n=Wo(t),i|=(127&n)<<21,128&n&&(n=Wo(t),r=127&n,128&n&&(n=Wo(t),r|=(127&n)<<7,128&n&&(n=Wo(t),r|=(127&n)<<14,128&n&&(n=Wo(t),r|=(127&n)<<21,128&n&&(n=Wo(t),o=127&n,128&n&&(n=Wo(t),o|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|o<<24,unsigned:e}}function $u(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,o=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=Lb(t,o),l=t.bytes;switch(o){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=o!==9?128|r:127&r;case 8:l[c+7]=o!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=o!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=o!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=o!==5?128|i:127&i;case 4:l[c+3]=o!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=o!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=o!==2?n>>>7|128:n>>>7&127;case 1:l[c]=o!==1?128|n:127&n}}const nV={},iV={},rV=4294967296,PY=18446744073709552e3,LY=PY/2;oV(0,!0);const sV=oV(0),kY=aS(0,-2147483648,!1),MY=aS(-1,2147483647,!1);function oV(t,e){let n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=iV[t],i)?i:(n=aS(t,0,!0),r&&(iV[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=nV[t],i)?i:(n=aS(t,t<0?-1:0,!1),r&&(nV[t]=n),n)}function aS(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function aV(t,e){if(isNaN(t))return sV;{if(t<=-9223372036854776e3)return kY;if(t+1>=LY)return MY}return t<0?sV:aS(t%rV|0,t/rV|0,e)}function cV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class r0 extends An{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(wa.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),D(this,"name","AgoraRTCImageModeration"),D(this,"_connectionState",$s.CONNECTING),D(this,"_sequence",0),D(this,"_moderationStartTime",void 0),D(this,"_workerConnection",void 0),D(this,"_workerMessageLengthLimit",void 0),D(this,"_qualityRatio",void 0),D(this,"_connectInfo",void 0),D(this,"_cancelTokenSource",Or.CancelToken.source()),D(this,"_retryConfig",void 0),D(this,"_moderationInterval",void 0),D(this,"_moderationTimer",null),D(this,"_moderationMode",1),D(this,"_quality",1),D(this,"_qualityTimer",null),D(this,"_ticket",void 0),D(this,"_moderationIntervalMinimum",void 0),D(this,"_uploadFailedNum",0),D(this,"_uploadNum",0),D(this,"_uploadTimer",null),D(this,"_extraInfo",void 0),D(this,"_vendor",""),D(this,"_encoder",new TextEncoder),D(this,"_moderationId",void 0),D(this,"inspectImage",()=>{if(this.connectionState!==$s.CONNECTED)throw new et(L.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===$s.CONNECTED?this.requestToInspectImage():b.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ln(5,"image-moderation-"),this._workerMessageLengthLimit=j("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=j("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=j("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Qg("worker-"+this._moderationId,ri),this.on(wa.STATE_CHANGE,(i,r)=>{b.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Fm[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(wa.STATE_CHANGE,Fm.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new At((r,o)=>{this.on(wa.CONNECTION_STATE_CHANGE,(c,l)=>{c===$s.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{o(c)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),b.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===$s.CONNECTED&&this.inspectImage()}async requestAP(e,n,i){const r=j("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),o=await function(d,p,f,S){let{appId:v,areaCode:y,cname:P,sid:I,token:O,uid:M}=p;qm++;const U="moderation_plugin",W={service_name:U,json_body:JSON.stringify({appId:v,areaCode:y,cname:P,command:"allocateEdge",requestId:qm,seq:qm,sid:I,appToken:O,ts:Date.now(),uid:M+""})};let Q,X,Y=d[0];return Ra(async()=>{Q=Date.now();const ot=await Ia(Y,{data:W,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(X=Date.now()-Q,ot.code!==0){const Lt=new et(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ot.code,{retry:!0,responseTime:X});throw b.error(Lt.toString()),Lt}const Et=JSON.parse(ot.json_body);if(Et.code!==200){const Lt=new et(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Et.code,", reason: ").concat(Et.reason),{code:Et.code,responseTime:X});throw b.error(Lt.toString()),Lt}if(!Et.servers||!Array.isArray(Et.servers)||Et.servers.length===0){const Lt=new et(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Et.code,responseTime:X});throw b.error(Lt.toString()),Lt}if(!Et.servers.some(Lt=>!!Lt.wss)){const Lt=new et(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Et.code,responseTime:X});throw b.error(Lt.toString()),Lt}const Ot=j("IMAGE_MODERATION_WORKER_HOST");return{addressList:Et.servers.map(Lt=>{let{address:Ce,wss:Ae}=Lt;if(Ce&&Ae)return"wss://".concat(Ce.replace(/\./g,"-"),".").concat(Ot,":").concat(Ae,"/moderation")}).filter(Lt=>!!Lt),workerToken:Et.workerToken,vid:Et.vid,ticket:Et.appTicket,responseTime:X}},(ot,Et)=>(Wt.apworkerEvent(I,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(ot.addressList),firstSuccess:Et===0,responseTime:X,serverIp:d[Et%d.length]}),!1),(ot,Et)=>(Wt.apworkerEvent(I,{success:!1,sc:ot.data&&ot.data.code||200,serviceName:U,responseTime:X,serverIp:d[Et%d.length]}),!!(ot.code!==L.OPERATION_ABORTED&&ot.code!==L.UNEXPECTED_RESPONSE||ot.data&&ot.data.retry)&&(Y=d[(Et+1)%d.length],!0)),S)}(r,e,n,i);this.emit(wa.STATE_CHANGE,Fm.AP_CONNECTED);const{addressList:c,ticket:l}=o;return this._ticket=l,c}async connectWorker(e){this.emit(wa.STATE_CHANGE,Fm.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(ae.CONNECTED,async()=>{this.emit(wa.STATE_CHANGE,Fm.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=$s.CONNECTED}),this._workerConnection.on(ae.CLOSED,()=>{this.connectionState=$s.CLOSED}),this._workerConnection.on(ae.FAILED,()=>{this.connectionState=$s.CLOSED}),this._workerConnection.on(ae.RECONNECTING,()=>{this.connectionState=this.connectionState===$s.CONNECTED?$s.RECONNECTING:$s.CONNECTING}),this._workerConnection.on(ae.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=wY(new Uint8Array(e.data));j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,b.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Wt.reportApiInvoke(this._connectInfo.sid||null,{name:ii.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Dn.TRACER}).onError(new et(L.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},j("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else b.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(ae.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(ae.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=Is(this,wa.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,n);this._workerConnection.sendMessage(i,!0,!0)}else j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:i,cname:r,cid:o,vid:c,sid:l,uid:d}=n;const p=Date.now(),f=await e.getCurrentFrameImage("image/jpeg",this.quality),S=await U1(f,i,r),v=this._sequence+"-"+o+"-"+d+"-"+p+"-"+ln(12,""),y={appId:i,cid:o,cname:r,deviceId:"",elapse:r0.intToLong(Number(p-this._moderationStartTime)),fileSize:f.buffer.byteLength,height:f.height,width:f.width,jpg:S,networkType:6,osType:7,requestId:v,sdkVersion:"4.23.1",sequence:this._sequence,sid:l,timestamp:aV(p),uid:d,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;const P=AY(y);if(P.byteLength<this._workerMessageLengthLimit){if(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=function(O){for(var M=1;M<arguments.length;M++){var U=arguments[M]!=null?arguments[M]:{};M%2?cV(Object(U),!0).forEach(function(W){D(O,W,U[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(U)):cV(Object(U)).forEach(function(W){Object.defineProperty(O,W,Object.getOwnPropertyDescriptor(U,W))})}return O}({},y);delete I.jpg,b.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return P}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(e,{appId:i,cname:r,cid:o,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Or.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=$s.CLOSED,this.emit(wa.STATE_CHANGE,Fm.CLOSED)}}function lV(t){if($e(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new et(L.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new et(L.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const UY={name:"ImageModeration",create:function(t){let{config:e}=t;return lV(e),new r0(e)}};var uV,dV,hV,pV,fV,mV,_V,EV,gV,SV,TV,vV,yV,RV,bV,CV,AV,wV,IV,OV,NV,DV,PV,LV,kV,MV,UV,xV,VV,BV,jV,FV,GV,HV,WV,KV,zV,YV,qV,XV,JV,Dt;function QV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ko(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?QV(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):QV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}zi.setLogger(b);let xY=(uV=$t(),dV=$t({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof Pm))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),hV=$t({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==Dm.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),pV=$t({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),fV=$t({argsMap:(t,e,n)=>[e,n]}),mV=$t({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),_V=$t({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),EV=$t({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),gV=$t(),SV=$t(),TV=$t(),vV=$t(),yV=$t(),RV=$t(),bV=$t(),CV=$t(),AV=$t(),wV=$t(),IV=$t(),OV=$t(),NV=$t(),DV=$t(),PV=$t(),LV=$t({argsMap:(t,e)=>[e]}),kV=$t(),MV=$t(),UV=$t(),xV=$t(),VV=$t(),BV=$t(),jV=$t(),FV=$t(),GV=$t({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),HV=$t(),WV=$t(),KV=$t(),zV=$t(),YV=$t(),qV=$t(),XV=$t({reportResult:!0}),JV=$t(),Dt=class extends An{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),D(this,"store",void 0),D(this,"_uid",void 0),D(this,"_channelName",void 0),D(this,"_uintUid",void 0),D(this,"_users",[]),D(this,"_config",void 0),D(this,"_clientId",void 0),D(this,"_appId",void 0),D(this,"_sessionId",null),D(this,"_key",void 0),D(this,"_rtmConfig",{}),D(this,"_joinInfo",void 0),D(this,"_gateway",void 0),D(this,"_statsCollector",void 0),D(this,"_configDistribute",void 0),D(this,"_leaveMutex",void 0),D(this,"_publishMutex",void 0),D(this,"_renewTokenMutex",void 0),D(this,"_subscribeMutex",void 0),D(this,"_encryptionMode","none"),D(this,"_encryptionSecret",null),D(this,"_encryptionSalt",null),D(this,"_encryptDataStream",!1),D(this,"_encryptDataStreamKey",null),D(this,"_encryptDataStreamIv",null),D(this,"_proxyServer",void 0),D(this,"_turnServer",{servers:[],mode:"auto"}),D(this,"_cloudProxyServerMode","disabled"),D(this,"_isDualStreamEnabled",!1),D(this,"_defaultStreamFallbackType",void 0),D(this,"_lowStreamParameter",void 0),D(this,"_streamFallbackTypeCacheMap",new Map),D(this,"_remoteStreamTypeCacheMap",new Map),D(this,"_axiosCancelSource",Or.CancelToken.source()),D(this,"_audioVolumeIndicationInterval",void 0),D(this,"_networkQualityInterval",void 0),D(this,"_userOfflineTimeout",void 0),D(this,"_streamRemovedTimeout",void 0),D(this,"_liveTranscodeStreamingClient",void 0),D(this,"_liveRawStreamingClient",void 0),D(this,"_channelMediaRelayClient",void 0),D(this,"_networkQualitySensitivity","normal"),D(this,"_p2pChannel",void 0),D(this,"_useLocalAccessPoint",!1),D(this,"_setLocalAPVersion",void 0),D(this,"_joinAndNotLeaveYet",!1),D(this,"_numberOfJoinCount",0),D(this,"_remoteDefaultVideoStreamType",void 0),D(this,"_inspect",void 0),D(this,"_moderation",void 0),D(this,"_license",void 0),D(this,"_pendingPublishedUsers",[]),D(this,"ntpAlignErrorCount",0),D(this,"remoteInboundOffset",0),D(this,"_peerConnectionState",void 0),D(this,"_handleLocalTrackEnable",(r,o,c)=>{this.publish(r,!1).then(o).catch(c)}),D(this,"_handleLocalTrackDisable",(r,o,c)=>{this.unpublish(r).then(o).catch(c)}),D(this,"_handleUserOnline",r=>{if(j("BLOCK_LOCAL_CLIENT")&&Yh(r.uid,this.channelName))return void b.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&b.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const o=this._users.find(c=>c.uid===r.uid);if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit(ye.USER_JOINED,o));else{const c=new Ju(r.uid,r.uint_id||r.uid);this._users.push(c),b.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(ye.USER_JOINED,c)}}),D(this,"_handleUserOffline",r=>{if(j("BLOCK_LOCAL_CLIENT")&&Yh(r.uid,this.channelName))return;const o=this._users.find(c=>c.uid===r.uid);o&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:UR(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),b.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(ye.USER_LEAVED,o,r.reason))}),D(this,"_handleAddAudioOrVideoStream",(r,o,c,l,d,p,f)=>{if(j("BLOCK_LOCAL_CLIENT")&&Yh(o,this.channelName))return;const S=this._users.find(y=>y.uid===o);if(!S)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));b.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(r)),this.store.subscribe(S.uid,r,void 0,void 0,void 0,Date.now());const v=r==="audio"?S.hasAudio:S.hasVideo;S._uintid||(S._uintid=d||o),r==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,r==="audio"?(S._audio_added_=!0,c!==void 0&&(S._audioSSRC=c),l!==void 0&&(S._cname=l),p&&(S._audioOrtc=p)):(S._video_added_=!0,c!==void 0&&(S._videoSSRC=c),l!==void 0&&(S._cname=l),f!==void 0&&(S._rtxSsrcId=f),p&&(S._videoOrtc=p)),(r==="audio"?S.hasAudio:S.hasVideo)&&!v&&(b.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(r)),this.safeEmit(ye.USER_PUBLISHED,S,r)),r==="video"?Wt.onGatewayStream(this._sessionId,Ei.ON_ADD_VIDEO_STREAM,yn.ON_ADD_VIDEO_STREAM,{peer:d||o,ssrc:S._videoSSRC}):Wt.onGatewayStream(this._sessionId,Ei.ON_ADD_AUDIO_STREAM,yn.ON_ADD_AUDIO_STREAM,{peer:d||o,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,r,c).then(y=>{if(y&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof sS))return this._p2pChannel.unsubscribe(S,r,!0).then(()=>this._subscribe(S,r,!0).catch(P=>{b.error("[".concat(this._clientId,"] resubscribe error"),P.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,r)&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,r,!0).catch(y=>{b.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),D(this,"_handleRemoveStream",r=>{if(j("BLOCK_LOCAL_CLIENT")&&Yh(r.uid,this.channelName))return;const o=this._users.find(l=>l.uid===r.uid);if(!o)return void b.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));b.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let c=()=>{};o.hasAudio&&o.hasVideo?c=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(ye.USER_UNPUBLISHED,o,"audio"),b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(ye.USER_UNPUBLISHED,o,"video")}:o.hasVideo?c=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(ye.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(c=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(ye.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof sS&&this._p2pChannel.unsubscribe(o).then(l=>{if(l)return this._gateway.unsubscribe(l,o.uid)}),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),Wt.onGatewayStream(this._sessionId,Ei.ON_REMOVE_STREAM,yn.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),c()}),D(this,"_handleSetStreamLocalEnable",(r,o,c)=>{if(j("BLOCK_LOCAL_CLIENT")&&Yh(o,this.channelName))return;const l=this._users.find(f=>f.uid===o);if(!l)return void b.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));b.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(c?"enabled":"disabled"," with uid ").concat(o));const d=r==="audio"?l.hasAudio:l.hasVideo;if(r==="audio"){l._trust_audio_enabled_state_=!0;const f=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===f)return;{const S=l._audio_enabled_?"enable-local-audio":"disable-local-audio";b.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(S)),this.safeEmit(ye.USER_INFO_UPDATED,o,S)}}else{l._trust_video_enabled_state_=!0;const f=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===f)return;{const S=l._video_enabled_?"enable-local-video":"disable-local-video";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(S)),this.safeEmit(ye.USER_INFO_UPDATED,o,S)}}const p=r==="audio"?l.hasAudio:l.hasVideo;return d!==p?!d&&p?(b.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(r)),void this.safeEmit(ye.USER_PUBLISHED,l,r)):(r==="video"&&l._videoTrack&&l._videoTrack._destroy(),r==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,r),b.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(r)),void this.safeEmit(ye.USER_UNPUBLISHED,l,r)):void 0}),D(this,"_handleMuteStream",(r,o,c)=>{if(j("BLOCK_LOCAL_CLIENT")&&Yh(r,this.channelName))return;b.debug("[".concat(this._clientId,"] receive mute message"),r,o,c);const l=this._users.find(f=>f.uid===r);if(!l)return void b.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const d=o==="audio"?l.hasAudio:l.hasVideo;if(o==="audio"){l._trust_audio_mute_state_=!0;const f=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===f)return;{const S=l._audio_muted_?"mute-audio":"unmute-audio";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(S)),this.safeEmit(ye.USER_INFO_UPDATED,r,S)}}else{l._trust_video_mute_state_=!0;const f=l._video_muted_;if(l._video_muted_=c,l._video_muted_===f)return;{const S=l._video_muted_?"mute-video":"unmute-video";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(S)),this.safeEmit(ye.USER_INFO_UPDATED,r,S)}}const p=o==="audio"?l.hasAudio:l.hasVideo;if(d!==p){if(!d&&p)return(o==="audio"?l._audioSSRC:l._videoSSRC)?(b.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(o)),void this.safeEmit(ye.USER_PUBLISHED,l,o)):void b.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),o==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,o),b.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(o)),this.safeEmit(ye.USER_UNPUBLISHED,l,o)}}),D(this,"_handleP2PLost",async r=>{b.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():b.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),D(this,"_handleTokenWillExpire",()=>{b.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(ye.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),D(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),b.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),D(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(ye.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(ye.NETWORK_QUALITY,r)}),D(this,"_handleP2PAddAudioOrVideoStream",(r,o,c,l)=>{const d=this._users.find(f=>f.uid===o);if(!d)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));b.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(r)),this.store.subscribe(d.uid,r,void 0,void 0,void 0,Date.now());const p=r==="audio"?d.hasAudio:d.hasVideo;r==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,r==="audio"?(d._audio_added_=!0,c!==void 0&&(d._audioSSRC=c),l!==void 0&&(d._audioMid=l)):(d._video_added_=!0,c!==void 0&&(d._videoSSRC=c),l!==void 0&&(d._videoMid=l)),(r==="audio"?d.hasAudio:d.hasVideo)&&!p&&(b.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(r)),this.safeEmit(ye.USER_PUBLISHED,d,r)),this._p2pChannel.hasPendingRemoteMedia(d,r)&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,r,!0).catch(f=>{b.error("[".concat(this._clientId,"] resubscribe error"),f.toString())}))}),this._config=t,this._clientId=e||ln(5,"client-"),this.store=new NK(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new zi("client-leave",this._clientId),this._publishMutex=new zi("client-publish",this._clientId),this._renewTokenMutex=new zi("client-renewtoken",this._clientId),this._subscribeMutex=new zi("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),b.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Js," build: ").concat(QI,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{VI(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(r){b.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new iS(this.store),this._statsCollector.onStatsException=(r,o,c)=>{b.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(o,", uid: ").concat(c)),this.safeEmit(ye.EXCEPTION,{code:r,msg:o,uid:c})},this._statsCollector.onUploadPublishDuration=(r,o,c,l)=>{const d=this._users.find(p=>p.uid===r);d&&Wt.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:o,videoPublishDuration:c,peer:d._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new iY(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||ri,httpRetryConfig:t.httpRetryConfig||ri,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new hY(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},Xu("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new sS(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,r){let o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Je("JOIN_GATEWAY_USE_443PORT_ONLY",o),Je("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof OO&&(l.use443PortOnly=o,l.tryDoubleDomain=c),async function(d,p,f){DR.get(d)||DR.set(d,[]),PR.get(d)||PR.set(d,p),Rc.get(d)||Rc.set(d,0);const S=DR.get(d),v=PR.get(d);if(!S||!v)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Rc.get(d)===v){const M=Ug();S.push(M),await M.promise}Rc.set(d,Rc.get(d)+1);for(var y=arguments.length,P=new Array(y>3?y-3:0),I=3;I<y;I++)P[I-3]=arguments[I];const O=await f(...P);return Rc.set(d,Rc.get(d)-1),Rc.get(d)===v-1&&S.length>0&&(S[0].resolve(),S.shift()),Rc.get(d)===0&&(DR.set(d,[]),PR.set(d,0),Rc.set(d,0)),O}("client.join",j("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,r)}async join(t,e,n,i,r){const o=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(BR||BR||(BR=(window.location.protocol.split(":")[0]||"").toUpperCase(),BR))==="HTTPS",l=ZM()?window.isSecureContext:"Browser Not Support";(!ZM()&&!c||!window.isSecureContext)&&b.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),b.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Wt.setAppId(t);try{if(!n&&n!==null)throw new et(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Oi(n,"token",1,2047),Oi(t,"appid",1,2047),ab(e),i&&cb(i),r&&Oi(r,"optionalInfo",1,2047)}catch(I){throw Wt.reportApiInvoke(Bh(),{name:ii.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Dn.TRACER}).onError(I),I}if(this._leaveMutex.isLocked&&(b.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),b.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const I=new et(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Wt.reportApiInvoke(Bh(),{name:ii.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Dn.TRACER}).onError(I),I}this._gateway.state="CONNECTING";const d=await z2({appId:t,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new et(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const p=(d==null?void 0:d.sid)||Bh();b.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(o)),this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId);const f=Wt.reportApiInvoke(p,{id:this._clientId,name:ii.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Dn.TRACER}),S=Ko(Ko(Ko({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!d},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:j("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(S.stringUid=i,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async I=>{const O=function(){const Q=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),X=new Uint8Array(new ArrayBuffer(Q.length));for(let Y=0;Y<Q.length;Y+=1)X[Y]=Q.charCodeAt(Y);return X}(),M=await window.crypto.subtle.importKey("spki",O,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),U=UI(I),W=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},M,U);return function(Q){let X="";for(let Y=0;Y<Q.length;Y+=1)X+=String.fromCharCode(Q[Y]);return window.btoa(X)}(new Uint8Array(W))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new et(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const I=new TextEncoder,O=j("USE_PURE_ENCRYPTION_MASTER_KEY")?I.encode(S.appId+this._encryptionSecret+this._encryptionSecret):I.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(M,U,W){const Q=await window.crypto.subtle.importKey("raw",U,"PBKDF2",!1,["deriveBits","deriveKey"]),X=M==="aes-128-gcm2"?128:256,Y=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:W},Q,X+96);return new Uint8Array(Y).subarray(X/8)}(this._encryptionMode,O,Vh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(M,U,W){const Q=await window.crypto.subtle.importKey("raw",U,"PBKDF2",!1,["deriveBits","deriveKey"]),X=M==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:W},Q,{name:"AES-GCM",length:X},!0,["encrypt","decrypt"])}(this._encryptionMode,O,Vh(this._encryptionSalt))}else l?b.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):b.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,b.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:S.stringUid});const v=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&v===this._sessionId&&Wt.joinChannelTimeout(this._sessionId,5)},5e3);try{var y;let I;const O=S.cloudProxyServer;if(Ct(y=["proxy3","proxy4","proxy5"]).call(y,O)){const X=j("PROXY_SERVER_TYPE3");Array.isArray(X)?S.proxyServer=X[0]:S.proxyServer=X}if(Wt.setProxyServer(S.proxyServer),b.setProxyServer(S.proxyServer),this.store.requestAPStart(),d){if(b.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(d.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=d.intUid),I={gatewayInfo:d.ap.gatewayInfo},j("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(d.ap.proxyInfo.addresses.length===0)b.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const X=(await Vx(d.ap.proxyInfo,d.ap.gatewayInfo.uid)).map(Y=>({turnServerURL:Y.address,tcpport:Y.tcpport||Vi.tcpport,udpport:Y.udpport||Vi.udpport,username:Y.username||Vi.username,password:Y.password||Vi.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:X}}X2(d,S.stringUid)}else{if(S.stringUid&&!S.uid){let X;[X,I]=await At.all([h2(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||ri,this.store),d2(S,this._axiosCancelSource.token,this._config.httpRetryConfig||ri,!0,this.store)]),b.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(X)),S.uid=X,I.gatewayInfo.uid=X,I.gatewayInfo.res.uid=X}else I=await d2(S,this._axiosCancelSource.token,this._config.httpRetryConfig||ri,!0,this.store);if(!this._joinAndNotLeaveYet)throw new et(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(Xg.UPDATE_BITRATE_LIMIT,X=>{this._p2pChannel.updateBitrateLimit(X)}),this._configDistribute.on(Xg.UPDATE_CLIENT_ROLE_OPTIONS,X=>{this._setClientRoleOptions(X)})},0),this._key=n||t;const M=I.gatewayInfo,U=S.uid?S.uid:M.uid;this._joinInfo=Ko(Ko({},S),{},{cid:M.cid,uid:U,vid:M.vid,apResponse:M.res,apGatewayAddress:M.apGatewayAddress,uni_lbs_ip:M.uni_lbs_ip,gatewayAddrs:M.gatewayAddrs}),this.store.intUid=U,this.store.cid=M.cid;const W=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new et(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));f.onSuccess(W),this._appId=t,this._channelName=S.cname,this._uid=W,this.store.uid=W,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Mi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Q=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return b.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(Q)),setTimeout(()=>{b.startUpload()},5e3),this.store.joinEnd(),P=this,Ct(zh).call(zh,P)||zh.push(P),this._cloudProxyServerMode==="disabled"&&Ue().supportWebCrypto&&j("ENABLE_PRELOAD")&&n0(this._joinInfo),W}catch(I){const O=Array.isArray(I)?I[0]:I;throw O&&O.code===L.OPERATION_ABORTED?b.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),O):b.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),O),O.code!==L.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(O),O}var P}_joinGateway(){if(!this._joinInfo||!this._key)throw new et(L.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!j("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){b.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Mi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=zh.indexOf(e);n!==-1&&zh.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return b.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",ze.LEAVE),b.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Pm))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new et(L.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new et(L.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof Pm))throw new et(L.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new et(L.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}b.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(r=>{const o=this._configDistribute.getBitrateLimit();r instanceof En&&o&&r.setBitrateLimit(o.uplink)});try{await this._publishHighStream(n),b.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw b.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(t){$e(t.id,"id",0,65535,!0),wl(t.ordered,"ordered"),Oi(t.metadata,"metadata",0,512),b.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===t.id)!==-1)throw new et(L.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new et(L.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new et(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return n2(r,!1)}(t),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw b.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new et(L.CREATE_DATACHANNEL_ERROR);try{await At.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==L.DISCONNECT_P2P)throw r}}return b.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw b.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new et(L.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof Pm))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);b.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(Wn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),b.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw b.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),b.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),b.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(i=>"".concat(i.id))))}catch(n){throw b.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof Ju)){const i=this.remoteUsers.find(r=>r.uid===t);if(!i)throw new et(L.INVALID_REMOTE_USER,"user is not in the channel");t=i}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(hi(e,"mediaType",["audio","video"]),this.store.useP2P)throw new et(L.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new et(L.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===xt.AUDIO,i=e===xt.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:o,ortc:c,rtxSsrcId:l,cname:d,uint_id:p}=await this._gateway.presubscribe(t,e,!0);if(o==null)throw new et(L.UNEXPECTED_RESPONSE,"no ssrc id");let f=this._users.find(v=>v.uid===t);f||(f=new Ju(t,p||t),f._is_pre_created=!0,this._users.push(f)),d&&(f._cname=d),f._uintid||(f._uintid=p||t),n&&(f._audioSSRC=o,f._audio_pre_subscribed=!0,c&&(f._audioOrtc=c)),i&&(f._videoSSRC=o,f._video_pre_subscribed=!0,c&&(f._videoOrtc=c),l!=null&&(f._rtxSsrcId=l)),b.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o)),await this._p2pChannel.subscribe(f,e,o,l,c);const S=n?f._audioTrack:f._videoTrack;if(!S)throw new et(L.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(f._trust_audio_stream_added_state_=!0,f._audio_added_=!0),i&&(f._trust_video_stream_added_state_=!0,f._video_added_=!0),S}catch(o){throw b.error("[".concat(this._clientId,"] presub user ").concat(t," error"),o),o}finally{r()}}async _subscribeDataChannel(t,e){var n;if($e(e,"channelId",0,65535,!0),!this._joinInfo)throw new et(L.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===t))throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new et(L.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new et(L.INVALID_REMOTE_USER,"user is not published");const r=(n=t._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===e);if(!r)throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new et(L.REMOTE_USER_IS_NOT_PUBLISHED);const o=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(t,[r]);if(l&&Ct(l).call(l,r.id))try{var c;if(typeof r._originDataChannelId!="number")throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new et(L.CREATE_DATACHANNEL_ERROR);const d={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(c=r.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(t.uid,d,!0),await r._waitTillOpen()}catch(d){if((d==null?void 0:d.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[r]),d;await this._p2pChannel.unsubscribeDataChannel(t,[r]),this._p2pChannel.setPendingRemoteDataChannel(t,r.id)}return b.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),r}finally{o()}}async _p2pSubscribe(t,e,n){if(hi(e,"mediaType",["audio","video"]),!this._joinInfo)throw new et(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(o=>o===t)){const o=new et(L.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),o}if(!t.hasAudio&&!t.hasVideo){const o=new et(L.INVALID_REMOTE_USER,"user is not published");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),o}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const o=new et(L.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),o}const r=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const c=e==="audio"?t._audioSSRC:t._videoSSRC,l=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,c,l)}catch(c){throw c}b.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{b.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const o=e==="audio"?t._audioTrack:t._videoTrack;if(!o)throw new et(L.UNEXPECTED_ERROR,"can not find remote track in user object");return o}catch(o){throw b.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),o),o}finally{r()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(hi(e,"mediaType",["audio","video"]),!this._joinInfo)throw new et(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===t)){const p=new et(L.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),p}if(!t.hasAudio&&!t.hasVideo){const p=new et(L.INVALID_REMOTE_USER,"user is not published");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),p}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const p=new et(L.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),p}let r=e==="audio"?t._audioSSRC:t._videoSSRC,o=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?xt.AUDIO:xt.VIDEO,ssrcId:r};const d=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const f=e==="audio"?t._audioSSRC:t._videoSSRC;f!==void 0&&f!==r&&(r=f,o=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?xt.AUDIO:xt.VIDEO,ssrcId:r}),qi.markSubscribeStart(this.store.clientId,r),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,r,c,o);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(t.uid,l,!0)}catch(S){if((S==null?void 0:S.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),S;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(f){throw this._p2pChannel.reportSubscribeEvent(!1,f==null?void 0:f.code,t,e),f}b.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(f=>{b.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const p=e==="audio"?t._audioTrack:t._videoTrack;if(!p)throw new et(L.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw b.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),p),p}finally{d()}}async massSubscribe(t){if(Il(t,"subscribeList"),!this._joinInfo)throw new et(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:d,mediaType:p}=l;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(p)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:d,mediaType:p}=l;return{user:d,mediaType:p}}),o=await this._p2pChannel.globalLock();try{var c;for(let d=t.length-1;d>=0;d--){const p=t[d],{user:f,mediaType:S}=p;if(hi(S,"mediaType",["audio","video"]),!f){const I=new et(L.INVALID_PARAMS,"user property does not exist in subscribeList item");throw b.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===f)){const I=new et(L.INVALID_REMOTE_USER,"user is not in the channel");b.error("[".concat(this._clientId,"] can not massSubscribe ").concat(f.uid,", this user is not in the channel")),r[d].error=I,t.splice(d,1);continue}if(S==="audio"&&(!f.hasAudio||f._audioSSRC===void 0)||S==="video"&&(!f.hasVideo||f._videoSSRC===void 0)){const I=new et(L.REMOTE_USER_IS_NOT_PUBLISHED);b.error("[".concat(this._clientId,"] can not subscribe ").concat(f.uid," with mediaType ").concat(S,", remote user is not published")),r[d].error=I,t.splice(d,1);continue}const y=gi.Video|gi.LwoVideo,P=n.get(f);if(P){if(S==="video"?P&y:P&gi.Audio){t.splice(d,1),b.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(f.uid,", mediaType:").concat(S," twice"));continue}n.set(f,P|(S==="video"?y:gi.Audio))}else n.set(f,S==="video"?y:gi.Audio)}for(let d=t.length-1;d>=0;d--){const p=t[d],{user:f,mediaType:S}=p,v=gi.Video|gi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(f,S)){await this._p2pChannel.unmuteRemoteNoLock(f,S);const y=n.get(f);n.set(f,S==="video"?y^v:y^gi.Audio),t.splice(d,1)}}this.store.massSubscribe(t.map(d=>({userId:d.user.uid,type:d.mediaType})),e);let l=Hi(c=Array.from(n.entries())).call(c,(d,p)=>{let[f,S]=p;if(S===0)return d;const v={stream_id:f.uid,stream_type:S};return S&gi.Audio&&(v.audio_ssrc=f._audioSSRC),S&gi.Video&&(v.video_ssrc=f._videoSSRC),d.push(v),d},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(p=>{let{user:f,mediaType:S}=p;return{user:f,mediaType:S,ssrcId:S===xt.VIDEO?f._videoSSRC:f._audioSSRC,rtxSsrcId:S===xt.VIDEO?f._rtxSsrcId:void 0}}));const d=new Map;if(l=l.filter(p=>p.video_ssrc&&!this._p2pChannel.isPreSubScribe(p.video_ssrc)||p.audio_ssrc&&!this._p2pChannel.isPreSubScribe(p.audio_ssrc)||!p.video_ssrc&&!p.audio_ssrc),l.length>0){const p=await this._gateway.subscribeAll(l,!0);((p==null?void 0:p.users)||[]).forEach(f=>{let{stream_id:S,video_error_code:v,audio_error_code:y,error_code:P}=f;(v||y||P)&&d.set(S,{video_error_code:v,audio_error_code:y,error_code:P})})}if(Array.from(d.entries()).length>0){const p=[];Array.from(d.entries()).forEach(f=>{let[S,v]=f;const y=this.remoteUsers.find(P=>P.uid===S);if(y){let P;v.error_code||v.video_error_code&&v.audio_error_code?P=void 0:v.video_error_code?P=xt.VIDEO:v.audio_error_code&&(P=xt.AUDIO),p.push({user:y,mediaType:P})}}),p.length>0&&await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of r){const f=d.get(p.user.uid);if(f){const S=f.error_code||p.mediaType==="audio"&&f.audio_error_code||p.mediaType==="video"&&f.video_error_code;if(S){const v=Jg(S);b.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(v.desc)),p.error=new et(L.SUBSCRIBE_FAILED,"code ".concat(S,": ").concat(v.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(r.filter(p=>!p.error).map(p=>({userId:p.user.uid,type:p.mediaType})),void 0,Date.now()),r.forEach(p=>{var f;Wt.subscribe(this.store.sessionId,{succ:!!p.error,ec:((f=p.error)===null||f===void 0?void 0:f.code)||null,video:p.mediaType===xt.VIDEO,audio:p.mediaType===xt.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===xt.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(p.user._videoSSRC)},!0)}),b.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(p=>{let{user:f,mediaType:S}=p;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(S)}).join("; "))),r}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(t),d}}finally{o(),i()}}async unsubscribe(t,e,n){if(!(t instanceof Ju)){const o=this.remoteUsers.find(c=>c.uid===t);if(!o)throw new et(L.INVALID_REMOTE_USER,"user is not in the channel");t=o}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&hi(e,"mediaType",["audio","video"]),!this._joinInfo)throw new et(L.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(o=>o===t)){const o=new et(L.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),o}b.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const o=await this._p2pChannel.unsubscribe(t,e);o&&await this._gateway.unsubscribe(o,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&UR(this._users,t),b.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(o){if(o.code===L.DISCONNECT_P2P)return void b.warning("disconnecting p2p, abort unsubscribe request.");throw b.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),o.toString()),o}finally{r()}}async _unsubscribeDataChannel(t,e){if(e&&$e(e,"id",0,65535,!0),!this._joinInfo)throw new et(L.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new et(L.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}let i;if(typeof e=="number"){const r=t._dataChannels.find(o=>o.id===e);r&&(i=[r])}else i=t._dataChannels;if(i===void 0){const r=new et(L.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),r}b.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(t,i);r&&await this._gateway.unsubscribeDataChannel(r,t.uid),b.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===L.DISCONNECT_P2P)return void b.warning("disconnecting p2p, abort unsubscribe request.");throw b.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}}async massUnsubscribe(t){if(Il(t,"unsubscribeList"),!this._joinInfo)throw new et(L.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");b.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:r}=t[n];if(!i){const l=new et(L.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw b.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(hi(r,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===i)){b.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const c=gi.Video|gi.LwoVideo;if(e.has(i)){const l=e.get(i);let d;switch(r){case"video":d=l&c;break;case"audio":d=l&gi.Audio;break;default:d=l&(gi.Audio|c)}if(d){b.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),t.splice(n,1);continue}r?r==="audio"?e.set(i,l|gi.Audio):r==="video"&&e.set(i,l|c):e.set(i,l|gi.Audio|c)}else r?r==="audio"?e.set(i,gi.Audio):r==="video"&&e.set(i,c):e.set(i,gi.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),b.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(i=>{let{user:r,mediaType:o}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(o,";")}).join()))}catch(n){if(n.code===L.DISCONNECT_P2P)return void b.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw b.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new st(L.INVALID_PARAMS);Nn(n.width)||kI(n.width,"streamParameter.width"),Nn(n.height)||kI(n.height,"streamParameter.height"),Nn(n.framerate)||kI(n.framerate,"streamParameter.framerate"),Nn(n.bitrate)||$e(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&b.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),b.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,_t.LocalVideoLowTrack)}async enableDualStream(){if(!Ue().supportDualStream)throw Wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new et(L.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new et(L.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),b.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new et(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(_t.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),b.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){hi(i,"role",["audience","host"])}(t),e&&VI(e),this.mode==="rtc"||this.mode==="p2p")throw b.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new et(L.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new et(L.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new et(L.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&j("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",Ui.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),b.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&VI(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{b.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(Oi(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new et(L.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new et(L.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Wt.setProxyServer(this._proxyServer),b.setProxyServer(this._proxyServer),b.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new et(L.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new et(L.INVALID_OPERATION,"You have already set the proxy")}if(jg(t))return this._turnServer={servers:t,mode:"original-manual"},void b.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>jM(n)),this._turnServer={servers:t,mode:"manual"},b.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new et(L.INVALID_OPERATION,"you should set license before join channel");if(Oi(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new et(L.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,b.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new et(L.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new et(L.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new et(L.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new et(L.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,b.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new et(L.INVALID_OPERATION,"Stop proxy server after leave channel");Wt.setProxyServer(),b.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",b.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new et(L.INVALID_PARAMS,"accessPoints is required.");Il(t.accessPoints.serverList,"accessPoints.serverList"),Oi(t.accessPoints.domain,"accessPoints.domain");const e=(v,y)=>{$e(v,y,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new et(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");j("CLOSE_AFB_FOR_LOCAL_AP")&&(Je("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Je("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,o=t.accessPoints.serverList.map(v=>i.test(v)?"".concat(v.replace(/\./g,"-"),".").concat(r):v),c=o.map(v=>"".concat(v,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Je("WEBCS_DOMAIN",c),Je("WEBCS_DOMAIN_BACKUP_LIST",c),Je("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Il(t.report.hostname,"report.hostname"),Je("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Je("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Je("EVENT_REPORT_DOMAIN",o[0]),Je("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),Je("STATS_COLLECTOR_PORT",l),t.report?Je("ENABLE_EVENT_REPORT",!0):Je("ENABLE_EVENT_REPORT",!1);let d="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Il(t.log.hostname,"log.hostname"),d=t.log.hostname[0]):d=o[0];let p=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),p=t.log.port),Je("LOG_UPLOAD_SERVER","".concat(d,":").concat(p));let f=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Il(t.cds.hostname,"cds.hostname"),f=t.cds.hostname):f=o;let S=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),S=t.cds.port),Je("CDS_AP",f.map(v=>"".concat(v,":").concat(S))),t.cds?Je("ENABLE_CONFIG_DISTRIBUTE",!0):Je("ENABLE_CONFIG_DISTRIBUTE",!1),b.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(Il(t,"serverList"),Oi(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new et(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Je("WEBCS_DOMAIN",t),Je("WEBCS_DOMAIN_BACKUP_LIST",t),Je("GATEWAY_DOMAINS",[e]),Je("EVENT_REPORT_DOMAIN",t[0]),Je("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Je("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),b.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(hi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw b.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else b.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){hi(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(i=>i.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw b.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}b.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){hi(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw b.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}b.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,i){(function(o){hi(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Oi(e,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(Ct(r).call(r,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new et(L.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new et(L.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(wl(i,"encryptDataStream"),!Ct(r).call(r,t))throw new et(L.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||b.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=Hu(n))}async renewToken(t){if(Oi(t,"token",1,2047),!this._key||!this._joinInfo)throw new et(L.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(j("USE_NEW_TOKEN")){b.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await dY(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ri);b.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:i})}else b.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});b.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,b.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?b.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(ye.VOLUME_INDICATOR,t)},j("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new et(L.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new et(L.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new et(L.LIVE_STREAMING_TASK_CONFLICT);const n=e?Nl.TRANSCODE:Nl.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(Nl.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new et(L.INVALID_PARAMS,"can not find live streaming url to stop");await At.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){S2(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){S2(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof sS&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new et(L.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const r=new TextEncoder;t.payload=r.encode(t.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ct(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,t.payload=await async function(r,o,c){var l;const d=Hi(l=Array.from(c)).call(l,(I,O)=>I+O,0),p={serverTs:0,seq:DK++,length:c.length,checkSum:d},f=new Uint8Array(qM(d,2)),S=new ArrayBuffer(10),v=new DataView(S);v.setUint32(0,p.serverTs),v.setUint16(4,p.seq),v.setUint16(6,p.length),v.setUint16(8,p.checkSum);const y=16-c.length%16;c=HM(c,new Uint8Array(y));const P=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:128,additionalData:f},o,c);return HM(new Uint8Array(S),new Uint8Array(P))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new et(L.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ee.DATA_STREAM,{payload:Hu(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-vY},!n)}sendMetadata(t){if(!this._joinInfo)throw new et(L.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new et(L.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ee.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Hu(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(jK),!this._joinInfo)throw new et(L.INVALID_OPERATION,"can not send custom report, not joined");await Wt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){hi(e.spatialLayer,"spatialLayer",[0,1,2,3]),hi(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw b.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(wl(e,"apRTM"),$e(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,b.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(b.debug("[".concat(this._clientId,"] reset client")),function(t){const e=Bm.indexOf(t);e!==-1&&Bm.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Or.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&q2(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Wt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new zi("client-publish",this._clientId),this._subscribeMutex=new zi("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const i=t||Bh();t?b.debug("[".concat(this._clientId,"] new Session ").concat(i)):b.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=t?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,Wt.addSid(i);const o={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};Wt.sessionInit(this._sessionId,Ko({cname:e.channel,appid:e.appId},o)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new et(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new et(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");b.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(Wn.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(o){if(o.code!==L.DISCONNECT_P2P)throw n.throw(o),o}await n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof En&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(o=>{b.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new et(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new et(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));b.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(o){if(o.code!==L.DISCONNECT_P2P)throw n.throw(o),o}n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new et(L.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Xu("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,o)=>{Wt.reportApiInvoke(this._sessionId,{name:ii.ON_LIVE_STREAM_ERROR,options:[r,o],tag:Dn.TRACER}).onSuccess(),this.safeEmit(ye.LIVE_STREAMING_ERROR,r,o)},n.onLiveStreamWarning=(r,o)=>{Wt.reportApiInvoke(this._sessionId,{name:ii.ON_LIVE_STREAM_WARNING,options:[r,o],tag:Dn.TRACER}).onSuccess(),this.safeEmit(ye.LIVE_STREAMING_WARNING,r,o)},n.on(wO.REQUEST_WORKER_MANAGER_LIST,(r,o,c)=>{if(!this._joinInfo)return c(new et(L.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,d,p,f){const S=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(v=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(v+"/api/v1?action=uap"):"https://".concat(v,"/api/v1?action=uap"));return await sY(S,l,d,p,f)})(r,this._joinInfo,this._axiosCancelSource.token,ri).then(o).catch(c)}),n};return t===Nl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new et(L.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},Xu("ChannelMediaRelay").create(t));i.on("state",r=>{r===zr.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(ye.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(ye.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,o)=>{var c;r==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(o))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,r=[];if(e){const o=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{n.every(d=>d.uid!==c._uintid||d.stream_id!==l.id)&&o.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(n)&&n.length>0&&n.forEach(o=>{const{uid:c,stream_id:l,ordered:d,max_retrans_times:p,metadata:f}=o,S=this._users.find(v=>v._uintid===c);if(!S)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(b.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),Ct(r).call(r,S)||r.push(S),S._uintid||(S._uintid=c),S._dataChannels.findIndex(v=>v.id===o.stream_id)===-1){const v={id:l,ordered:!!d,maxRetransmits:p,metadata:f},y=function(P){return n2(P,!0)}(v);S._dataChannels.push(y),b.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published datachannel")),e||this.safeEmit(ye.USER_PUBLISHED,S,"datachannel",v)}this._p2pChannel.hasPendingRemoteDataChannel(S,o.stream_id)&&(b.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(S.uid," after reconnect.")),this._subscribeDataChannel(S,o.stream_id).catch(v=>{b.error("[".concat(this._clientId,"] resubscribe datachannel error"),v.toString())}))}),e&&(this.safeEmit(ye.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(o=>{const{uid:c,stream_id:l}=o,d=this._users.find(f=>f._uintid===c);if(!d)return void b.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const p=d._dataChannels.find(f=>f.id===o.stream_id);p&&(b.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(d,[p]).then(f=>{if(d._dataChannels=d._dataChannels.filter(S=>S!==p),f)return this._gateway.unsubscribeDataChannel(f,d.uid)}),b.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(p.id)),this.safeEmit(ye.USER_UNPUBLISHED,d,"datachannel",p._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){b.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(ye.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),n()}}else b.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(yi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void b.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(i=>{const{value:r,type:o,expires:c}=e[i];c&&c<=n||o||TO()||!Object.prototype.hasOwnProperty.call(GR,i)||(ba[i]=r,wn[i]=r,b.debug("Update gateway parameters from config distribute",i,r))})}catch(e){b.error("Error update config from local cache",e.message)}})()}),this._gateway.on(yi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(yi.CONNECTION_STATE_CHANGE,(t,e,n)=>{var i;if(n===ze.FALLBACK)return;const r=()=>{this.safeEmit(ye.CONNECTION_STATE_CHANGE,t,e,n)};if(Wt.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:ii.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:Dn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),b.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var o;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(d=>{b.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(d=>{b.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((o=this._joinInfo)===null||o===void 0?void 0:o.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{b.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{b.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{b.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(b.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,xt.AUDIO,!1)),c._trust_video_mute_state_||(b.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,xt.VIDEO,!1)),c._trust_audio_enabled_state_||(b.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(b.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(b.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(b.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(b.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(yi.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new et(L.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await z2(Ko(Ko({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,X2(i),this._joinInfo.preload=!0):(n=await HO(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ri,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:c}=o;const[l,d]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:d}):r.push({host:l,port:d})}),t(r)}catch(n){e(n)}}),this._gateway.on(yi.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(ye.NETWORK_QUALITY,t)}),this._gateway.on(yi.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(ye.STREAM_TYPE_CHANGED,t,e),Wt.reportApiInvoke(this._sessionId,{name:ii.STREAM_TYPE_CHANGE,options:[t,e],tag:Dn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(yi.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(yi.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let i=await this._p2pChannel.getEstablishParams();j("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(t)),e(i)}catch(i){n(i)}}),this._gateway.on(yi.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;t.attributes?n=t.attributes.userAttributes.preSubSsrcs:b.debug("no attributes in joinResponse");const i=Wx(t.ortc,e,n);this._p2pChannel.connect(i)}),this._gateway.on(yi.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:r,cid:o}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(r),icePwd:"".concat(o,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=j("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(be.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(be.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(be.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(be.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(be.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(be.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(be.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(be.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(be.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,xt.AUDIO,!0)),this._gateway.signal.on(be.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,xt.AUDIO,!1)),this._gateway.signal.on(be.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,xt.VIDEO,!0)),this._gateway.signal.on(be.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,xt.VIDEO,!1)),this._gateway.signal.on(be.RECEIVE_METADATA,t=>{const e=Vh(t.metadata);this.safeEmit(ye.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(be.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=Vh(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ct(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<10)throw new et(L.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(10));n=await async function(o,c,l){const d=l.subarray(0,10),p=d.slice(8,10),f=(p[0]<<8)+p[1],S=(d[6]<<8)+d[7],v=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o,tagLength:128,additionalData:new Uint8Array(qM(f,2))},c,l.subarray(10));return new Uint8Array(v).subarray(0,S)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(t.ordered||t.syncWithAudio){const r=this._p2pChannel.getStats(),o=this.remoteUsers.find(l=>l.uid===t.uid),c=r==null?void 0:r.audioRecv.find(l=>l.ssrc===(o==null?void 0:o._audioSSRC));i=c==null?void 0:c.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),yY(Ko(Ko({},t),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(be.ON_CRYPT_ERROR,()=>{Gu(()=>{b.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(ye.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(be.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(be.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{b.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,ze.TOKEN_EXPIRE),this.safeEmit(ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(be.ON_STREAM_FALLBACK_UPDATE,t=>{b.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(ye.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(be.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),b.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(be.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(be.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(ne.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case ee.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var n,i;const o=r.some(d=>{let{stream_type:p}=d;return p===qe.Audio}),c=r.some(d=>{let{stream_type:p}=d;return p!==qe.Audio}),l=r.some(d=>{let{stream_type:p}=d;return p===qe.Screen||p===qe.ScreenLow});e.state==="offer"&&Wt.publish(this._joinInfo.sid,{eventElapse:qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:L.TIMEOUT,audio:o,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:o?(n=r.find(d=>{let{stream_type:p}=d;return p===qe.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=r.find(d=>{let{stream_type:p}=d;return p!==qe.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case ee.SUBSCRIBE:e&&Wt.subscribe(this._joinInfo.sid,{succ:!1,ec:L.TIMEOUT,audio:e.stream_type===xt.AUDIO,video:e.stream_type===xt.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:qi.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(be.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(be.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;j("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(i=>!Yh(i.string_id||i.stream_id,this.channelName)));const e=[],n=[];for(const i of t.users){let r=this._users.find(f=>f._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new Ju(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.getListeners(ye.PUBLISHED_USER_LIST).length===0&&(b.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(ye.USER_JOINED,r)));const o=gi.Audio&i.stream_type,c=(gi.Video|gi.LwoVideo)&i.stream_type,l=!!(65280&i.stream_type),d=o&&r.hasAudio,p=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),o&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),o&&!d&&this.getListeners(ye.PUBLISHED_USER_LIST).length===0&&(b.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(ye.USER_PUBLISHED,r,"audio")),c&&!p&&this.getListeners(ye.PUBLISHED_USER_LIST).length===0&&(b.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(ye.USER_PUBLISHED,r,"video")),(o&&!d||c&&!p||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),o&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(b.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{b.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(ye.PUBLISHED_USER_LIST).length>0?j("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(b.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(ye.PUBLISHED_USER_LIST,e)):b.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(be.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof sS&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var i;return Ct(i=Object.keys(HR)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(be.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Wn.PUBLISH,(t,e,n)=>{const{uid:i}=t;t.forEach(r=>{const{kind:o,ssrcs:c,mid:l,isMuted:d}=r;this._handleP2PAddAudioOrVideoStream(o,i,c[0].ssrcId,l);const p=this._users.find(f=>f.uid===i);return p&&this.store.useP2P?this._p2pChannel.mockSubscribe(p,o,c[0].ssrcId,l).then(()=>{e()}).catch(n):e(),this._handleMuteStream(i,o,!!d)})}),this._gateway.signal.on(Wn.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}catch(r){n(r)}}),this._gateway.signal.on(ne.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Wn.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:r}=t,o=this._users.find(c=>c.uid===r);if(!o)return b.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();try{i.forEach(async c=>{let{stream_type:l}=c;const d=l===qe.Audio?xt.AUDIO:xt.VIDEO;await this._p2pChannel.unsubscribe(o,d),this._handleMuteStream(r,d,!0)}),e()}catch(c){n(c)}}}),this._gateway.signal.on(Wn.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case zu.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,xt.VIDEO,!0);break;case zu.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,xt.AUDIO,!0);break;case zu.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,xt.VIDEO,!1);break;case zu.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,xt.AUDIO,!1)}}),this._gateway.signal.on(Wn.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:r}=t;i!==Sr.SEND_ONLY||r?e(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){n(i)}}),this._gateway.signal.on(Wn.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(qt.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:i}=t;e(await this._gateway.sendExtensionMessage(Wn.RESTART_ICE,t,i===Sr.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(qt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Wn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(qt.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(Wn.CONTROL,t,!0),e()}catch(i){n(i)}}),this._p2pChannel.on(qt.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(qt.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(qt.StateChange,(t,e)=>{e===Ye.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(qt.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(ye.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on(qt.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(qt.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(qt.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(qt.RequestRePublishDataChannel,(t,e,n)=>{At.all(t.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(o=>{this._uid&&this._gateway.publishDataChannel(this._uid,o,!0)})}catch(o){if(o.code!==L.DISCONNECT_P2P)throw o}})).then(e).catch(n)}),this._p2pChannel.on(qt.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:i,kind:r}of t)r===xt.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){n(i)}}),this._p2pChannel.on(qt.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(qt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(qt.MediaReconnectStart,t=>{this.safeEmit(ye.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(qt.MediaReconnectEnd,t=>{this.safeEmit(ye.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(qt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(qt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(c){return void e.throw(c)}const{iceParameters:o}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:o})}),this._p2pChannel.on(qt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(qt.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),c=Wx(r,o);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(qt.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(qt.P2PLost,()=>{this.safeEmit(ye.P2P_LOST,this.store.uid)}),this._p2pChannel.on(qt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(qt.ConnectionTypeChange,t=>{this.safeEmit(ye.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(qt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(qt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(qt.AudioMetadata,t=>{this.safeEmit(ye.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new et(L.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new et(L.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},Xu("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:o,token:c,uid:l,cid:d,vid:p}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:o,token:c,uid:l,cid:d,vid:p?Number(p):0},ri)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(Ri.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(ye.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===Fo.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(ye.CONTENT_INSPECT_ERROR,new et(L.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Ri.INSPECT_RESULT,(e,n)=>{var i;if((n==null?void 0:n.code)===L.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return b.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(ye.CONTENT_INSPECT_RESULT,e,n)}),t.on(Ri.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new et(L.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(wl(t,"enabled"),t){if(!e)throw new et(L.INVALID_PARAMS,"config is required");if(lV(e),!this._joinInfo)throw new et(L.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const i=(n={config:e},Xu("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:o,sid:c,token:l,uid:d,cid:p,vid:f}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:o,sid:c,token:l,uid:d,cid:p,vid:f?Number(f):0},ri)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new et(L.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(wa.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(ye.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===$s.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new et(L.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(wa.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){hi(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new et(L.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,b.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return b.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){wl(t,"enabled"),Je("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Ft(Dt.prototype,"leave",[uV],Object.getOwnPropertyDescriptor(Dt.prototype,"leave"),Dt.prototype),Ft(Dt.prototype,"publish",[dV],Object.getOwnPropertyDescriptor(Dt.prototype,"publish"),Dt.prototype),Ft(Dt.prototype,"unpublish",[hV],Object.getOwnPropertyDescriptor(Dt.prototype,"unpublish"),Dt.prototype),Ft(Dt.prototype,"subscribe",[pV],Object.getOwnPropertyDescriptor(Dt.prototype,"subscribe"),Dt.prototype),Ft(Dt.prototype,"presubscribe",[fV],Object.getOwnPropertyDescriptor(Dt.prototype,"presubscribe"),Dt.prototype),Ft(Dt.prototype,"massSubscribe",[mV],Object.getOwnPropertyDescriptor(Dt.prototype,"massSubscribe"),Dt.prototype),Ft(Dt.prototype,"unsubscribe",[_V],Object.getOwnPropertyDescriptor(Dt.prototype,"unsubscribe"),Dt.prototype),Ft(Dt.prototype,"massUnsubscribe",[EV],Object.getOwnPropertyDescriptor(Dt.prototype,"massUnsubscribe"),Dt.prototype),Ft(Dt.prototype,"setLowStreamParameter",[gV],Object.getOwnPropertyDescriptor(Dt.prototype,"setLowStreamParameter"),Dt.prototype),Ft(Dt.prototype,"enableDualStream",[SV],Object.getOwnPropertyDescriptor(Dt.prototype,"enableDualStream"),Dt.prototype),Ft(Dt.prototype,"disableDualStream",[TV],Object.getOwnPropertyDescriptor(Dt.prototype,"disableDualStream"),Dt.prototype),Ft(Dt.prototype,"setClientRole",[vV],Object.getOwnPropertyDescriptor(Dt.prototype,"setClientRole"),Dt.prototype),Ft(Dt.prototype,"_setClientRoleOptions",[yV],Object.getOwnPropertyDescriptor(Dt.prototype,"_setClientRoleOptions"),Dt.prototype),Ft(Dt.prototype,"setProxyServer",[RV],Object.getOwnPropertyDescriptor(Dt.prototype,"setProxyServer"),Dt.prototype),Ft(Dt.prototype,"setTurnServer",[bV],Object.getOwnPropertyDescriptor(Dt.prototype,"setTurnServer"),Dt.prototype),Ft(Dt.prototype,"setLicense",[CV],Object.getOwnPropertyDescriptor(Dt.prototype,"setLicense"),Dt.prototype),Ft(Dt.prototype,"startProxyServer",[AV],Object.getOwnPropertyDescriptor(Dt.prototype,"startProxyServer"),Dt.prototype),Ft(Dt.prototype,"stopProxyServer",[wV],Object.getOwnPropertyDescriptor(Dt.prototype,"stopProxyServer"),Dt.prototype),Ft(Dt.prototype,"setLocalAccessPointsV2",[IV],Object.getOwnPropertyDescriptor(Dt.prototype,"setLocalAccessPointsV2"),Dt.prototype),Ft(Dt.prototype,"setLocalAccessPoints",[OV],Object.getOwnPropertyDescriptor(Dt.prototype,"setLocalAccessPoints"),Dt.prototype),Ft(Dt.prototype,"setRemoteDefaultVideoStreamType",[NV],Object.getOwnPropertyDescriptor(Dt.prototype,"setRemoteDefaultVideoStreamType"),Dt.prototype),Ft(Dt.prototype,"setRemoteVideoStreamType",[DV],Object.getOwnPropertyDescriptor(Dt.prototype,"setRemoteVideoStreamType"),Dt.prototype),Ft(Dt.prototype,"setStreamFallbackOption",[PV],Object.getOwnPropertyDescriptor(Dt.prototype,"setStreamFallbackOption"),Dt.prototype),Ft(Dt.prototype,"setEncryptionConfig",[LV],Object.getOwnPropertyDescriptor(Dt.prototype,"setEncryptionConfig"),Dt.prototype),Ft(Dt.prototype,"renewToken",[kV],Object.getOwnPropertyDescriptor(Dt.prototype,"renewToken"),Dt.prototype),Ft(Dt.prototype,"enableAudioVolumeIndicator",[MV],Object.getOwnPropertyDescriptor(Dt.prototype,"enableAudioVolumeIndicator"),Dt.prototype),Ft(Dt.prototype,"startLiveStreaming",[UV],Object.getOwnPropertyDescriptor(Dt.prototype,"startLiveStreaming"),Dt.prototype),Ft(Dt.prototype,"setLiveTranscoding",[xV],Object.getOwnPropertyDescriptor(Dt.prototype,"setLiveTranscoding"),Dt.prototype),Ft(Dt.prototype,"stopLiveStreaming",[VV],Object.getOwnPropertyDescriptor(Dt.prototype,"stopLiveStreaming"),Dt.prototype),Ft(Dt.prototype,"startChannelMediaRelay",[BV],Object.getOwnPropertyDescriptor(Dt.prototype,"startChannelMediaRelay"),Dt.prototype),Ft(Dt.prototype,"updateChannelMediaRelay",[jV],Object.getOwnPropertyDescriptor(Dt.prototype,"updateChannelMediaRelay"),Dt.prototype),Ft(Dt.prototype,"stopChannelMediaRelay",[FV],Object.getOwnPropertyDescriptor(Dt.prototype,"stopChannelMediaRelay"),Dt.prototype),Ft(Dt.prototype,"sendCustomReportMessage",[GV],Object.getOwnPropertyDescriptor(Dt.prototype,"sendCustomReportMessage"),Dt.prototype),Ft(Dt.prototype,"pickSVCLayer",[HV],Object.getOwnPropertyDescriptor(Dt.prototype,"pickSVCLayer"),Dt.prototype),Ft(Dt.prototype,"setRTMConfig",[WV],Object.getOwnPropertyDescriptor(Dt.prototype,"setRTMConfig"),Dt.prototype),Ft(Dt.prototype,"enableContentInspect",[KV],Object.getOwnPropertyDescriptor(Dt.prototype,"enableContentInspect"),Dt.prototype),Ft(Dt.prototype,"disableContentInspect",[zV],Object.getOwnPropertyDescriptor(Dt.prototype,"disableContentInspect"),Dt.prototype),Ft(Dt.prototype,"setImageModeration",[YV],Object.getOwnPropertyDescriptor(Dt.prototype,"setImageModeration"),Dt.prototype),Ft(Dt.prototype,"setP2PTransport",[qV],Object.getOwnPropertyDescriptor(Dt.prototype,"setP2PTransport"),Dt.prototype),Ft(Dt.prototype,"getJoinChannelServiceRecords",[XV],Object.getOwnPropertyDescriptor(Dt.prototype,"getJoinChannelServiceRecords"),Dt.prototype),Ft(Dt.prototype,"setPublishAudioFilterEnabled",[JV],Object.getOwnPropertyDescriptor(Dt.prototype,"setPublishAudioFilterEnabled"),Dt.prototype),Dt);class cS{constructor(e,n){D(this,"id",0),D(this,"element",void 0),D(this,"peerPair",void 0),D(this,"context",void 0),D(this,"audioPlayerElement",void 0),D(this,"audioTrack",void 0),cS.count+=1,this.id=cS.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(i,r)=>{const o=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(o),i.iceGatheringState==="complete"?i.localDescription:new At(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await e(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await e(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new et(L.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(r){throw new et(L.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new et(L.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){b.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var ZV,kb;D(cS,"count",0);const VY=window.AudioContext||window.webkitAudioContext,BY=new(ZV=$t({report:Wt}),Ft((kb=class{constructor(){D(this,"units",[]),D(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return b.debug("the system does not need to process local aec"),-1;this.context||(this.context=new VY);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new cS(t,this.context),this.units.push(e)),e.startEchoCancellation(),b.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Me().name!==He.SAFARI}}).prototype,"processExternalMediaAEC",[ZV],Object.getOwnPropertyDescriptor(kb.prototype,"processExternalMediaAEC"),kb.prototype),kb);function $V(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function tB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$V(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$V(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const s0=window||document;function eB(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!s0)return;const n=si._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=r=>{if(!(r&&r.blockedURI&&(si.onSecurityPolicyViolation||si.getListeners(Oc.SECURITY_POLICY_VIOLATION).length>0)))return;const o=r.blockedURI;j("CSP_DETECTED_HOSTNAME_LIST").some(c=>Ct(o).call(o,c))&&(si.onSecurityPolicyViolation&&typeof si.onSecurityPolicyViolation=="function"&&si.onSecurityPolicyViolation(r),si.getListeners(Oc.SECURITY_POLICY_VIOLATION).length>0&&si.safeEmit(Oc.SECURITY_POLICY_VIOLATION,r))};n&&s0.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||si.getListeners(Oc.SECURITY_POLICY_VIOLATION).length>0)&&s0.addEventListener("securitypolicyviolation",i),si._cspEventHandlerPointer=i}var jY=nt,FY=Gk,nB=RegExp.prototype,GY=function(t){return t===nB||jY(nB,t)?FY(t):t.flags},dr=R(GY);function t_(t){let e=t.length;for(;--e>=0;)t[e]=0}const o0=256,iB=286,lS=30,uS=15,a0=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Mb=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),HY=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),rB=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ul=new Array(576);t_(Ul);const dS=new Array(60);t_(dS);const hS=new Array(512);t_(hS);const pS=new Array(256);t_(pS);const c0=new Array(29);t_(c0);const Ub=new Array(lS);function l0(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let sB,oB,aB;function u0(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}t_(Ub);const cB=t=>t<256?hS[t]:hS[256+(t>>>7)],fS=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Vs=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,fS(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Lc=(t,e,n)=>{Vs(t,n[2*e],n[2*e+1])},lB=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},uB=(t,e,n)=>{const i=new Array(16);let r,o,c=0;for(r=1;r<=uS;r++)c=c+n[r-1]<<1,i[r]=c;for(o=0;o<=e;o++){let l=t[2*o+1];l!==0&&(t[2*o]=lB(i[l]++,l))}},dB=t=>{let e;for(e=0;e<iB;e++)t.dyn_ltree[2*e]=0;for(e=0;e<lS;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},hB=t=>{t.bi_valid>8?fS(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},pB=(t,e,n,i)=>{const r=2*e,o=2*n;return t[r]<t[o]||t[r]===t[o]&&i[e]<=i[n]},d0=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&pB(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!pB(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},fB=(t,e,n)=>{let i,r,o,c,l=0;if(t.sym_next!==0)do i=255&t.pending_buf[t.sym_buf+l++],i+=(255&t.pending_buf[t.sym_buf+l++])<<8,r=t.pending_buf[t.sym_buf+l++],i===0?Lc(t,r,e):(o=pS[r],Lc(t,o+o0+1,e),c=a0[o],c!==0&&(r-=c0[o],Vs(t,r,c)),i--,o=cB(i),Lc(t,o,n),c=Mb[o],c!==0&&(i-=Ub[o],Vs(t,i,c)));while(l<t.sym_next);Lc(t,256,e)},h0=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,o=e.stat_desc.elems;let c,l,d,p=-1;for(t.heap_len=0,t.heap_max=573,c=0;c<o;c++)n[2*c]!==0?(t.heap[++t.heap_len]=p=c,t.depth[c]=0):n[2*c+1]=0;for(;t.heap_len<2;)d=t.heap[++t.heap_len]=p<2?++p:0,n[2*d]=1,t.depth[d]=0,t.opt_len--,r&&(t.static_len-=i[2*d+1]);for(e.max_code=p,c=t.heap_len>>1;c>=1;c--)d0(t,n,c);d=o;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],d0(t,n,1),l=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=l,n[2*d]=n[2*c]+n[2*l],t.depth[d]=(t.depth[c]>=t.depth[l]?t.depth[c]:t.depth[l])+1,n[2*c+1]=n[2*l+1]=d,t.heap[1]=d++,d0(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((f,S)=>{const v=S.dyn_tree,y=S.max_code,P=S.stat_desc.static_tree,I=S.stat_desc.has_stree,O=S.stat_desc.extra_bits,M=S.stat_desc.extra_base,U=S.stat_desc.max_length;let W,Q,X,Y,ot,Et,Ot=0;for(Y=0;Y<=uS;Y++)f.bl_count[Y]=0;for(v[2*f.heap[f.heap_max]+1]=0,W=f.heap_max+1;W<573;W++)Q=f.heap[W],Y=v[2*v[2*Q+1]+1]+1,Y>U&&(Y=U,Ot++),v[2*Q+1]=Y,Q>y||(f.bl_count[Y]++,ot=0,Q>=M&&(ot=O[Q-M]),Et=v[2*Q],f.opt_len+=Et*(Y+ot),I&&(f.static_len+=Et*(P[2*Q+1]+ot)));if(Ot!==0){do{for(Y=U-1;f.bl_count[Y]===0;)Y--;f.bl_count[Y]--,f.bl_count[Y+1]+=2,f.bl_count[U]--,Ot-=2}while(Ot>0);for(Y=U;Y!==0;Y--)for(Q=f.bl_count[Y];Q!==0;)X=f.heap[--W],X>y||(v[2*X+1]!==Y&&(f.opt_len+=(Y-v[2*X+1])*v[2*X],v[2*X+1]=Y),Q--)}})(t,e),uB(n,p,t.bl_count)},mB=(t,e,n)=>{let i,r,o=-1,c=e[1],l=0,d=7,p=4;for(c===0&&(d=138,p=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=c,c=e[2*(i+1)+1],++l<d&&r===c||(l<p?t.bl_tree[2*r]+=l:r!==0?(r!==o&&t.bl_tree[2*r]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,o=r,c===0?(d=138,p=3):r===c?(d=6,p=3):(d=7,p=4))},_B=(t,e,n)=>{let i,r,o=-1,c=e[1],l=0,d=7,p=4;for(c===0&&(d=138,p=3),i=0;i<=n;i++)if(r=c,c=e[2*(i+1)+1],!(++l<d&&r===c)){if(l<p)do Lc(t,r,t.bl_tree);while(--l!=0);else r!==0?(r!==o&&(Lc(t,r,t.bl_tree),l--),Lc(t,16,t.bl_tree),Vs(t,l-3,2)):l<=10?(Lc(t,17,t.bl_tree),Vs(t,l-3,3)):(Lc(t,18,t.bl_tree),Vs(t,l-11,7));l=0,o=r,c===0?(d=138,p=3):r===c?(d=6,p=3):(d=7,p=4)}};let EB=!1;const gB=(t,e,n,i)=>{Vs(t,0+(i?1:0),3),hB(t),fS(t,n),fS(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var WY=t=>{EB||((()=>{let e,n,i,r,o;const c=new Array(16);for(i=0,r=0;r<28;r++)for(c0[r]=i,e=0;e<1<<a0[r];e++)pS[i++]=r;for(pS[i-1]=r,o=0,r=0;r<16;r++)for(Ub[r]=o,e=0;e<1<<Mb[r];e++)hS[o++]=r;for(o>>=7;r<lS;r++)for(Ub[r]=o<<7,e=0;e<1<<Mb[r]-7;e++)hS[256+o++]=r;for(n=0;n<=uS;n++)c[n]=0;for(e=0;e<=143;)Ul[2*e+1]=8,e++,c[8]++;for(;e<=255;)Ul[2*e+1]=9,e++,c[9]++;for(;e<=279;)Ul[2*e+1]=7,e++,c[7]++;for(;e<=287;)Ul[2*e+1]=8,e++,c[8]++;for(uB(Ul,287,c),e=0;e<lS;e++)dS[2*e+1]=5,dS[2*e]=lB(e,5);sB=new l0(Ul,a0,257,iB,uS),oB=new l0(dS,Mb,0,lS,uS),aB=new l0(new Array(0),HY,0,19,7)})(),EB=!0),t.l_desc=new u0(t.dyn_ltree,sB),t.d_desc=new u0(t.dyn_dtree,oB),t.bl_desc=new u0(t.bl_tree,aB),t.bi_buf=0,t.bi_valid=0,dB(t)},KY=(t,e,n,i)=>{let r,o,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(l=>{let d,p=4093624447;for(d=0;d<=31;d++,p>>>=1)if(1&p&&l.dyn_ltree[2*d]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(d=32;d<o0;d++)if(l.dyn_ltree[2*d]!==0)return 1;return 0})(t)),h0(t,t.l_desc),h0(t,t.d_desc),c=(l=>{let d;for(mB(l,l.dyn_ltree,l.l_desc.max_code),mB(l,l.dyn_dtree,l.d_desc.max_code),h0(l,l.bl_desc),d=18;d>=3&&l.bl_tree[2*rB[d]+1]===0;d--);return l.opt_len+=3*(d+1)+5+5+4,d})(t),r=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=r&&(r=o)):r=o=n+5,n+4<=r&&e!==-1?gB(t,e,n,i):t.strategy===4||o===r?(Vs(t,2+(i?1:0),3),fB(t,Ul,dS)):(Vs(t,4+(i?1:0),3),((l,d,p,f)=>{let S;for(Vs(l,d-257,5),Vs(l,p-1,5),Vs(l,f-4,4),S=0;S<f;S++)Vs(l,l.bl_tree[2*rB[S]+1],3);_B(l,l.dyn_ltree,d-1),_B(l,l.dyn_dtree,p-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),fB(t,t.dyn_ltree,t.dyn_dtree)),dB(t),i&&hB(t)},zY=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(pS[n]+o0+1)]++,t.dyn_dtree[2*cB(e)]++),t.sym_next===t.sym_end),YY=t=>{Vs(t,2,3),Lc(t,256,Ul),(e=>{e.bi_valid===16?(fS(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},qY={_tr_init:WY,_tr_stored_block:gB,_tr_flush_block:KY,_tr_tally:zY,_tr_align:YY},mS=(t,e,n,i)=>{let r=65535&t,o=t>>>16&65535,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do r=r+e[i++]|0,o=o+r|0;while(--c);r%=65521,o%=65521}return r|o<<16};const XY=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var vr=(t,e,n,i)=>{const r=XY,o=i+n;t^=-1;for(let c=i;c<o;c++)t=t>>>8^r[255&(t^e[c])];return~t},ep={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},xb={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:JY,_tr_stored_block:p0,_tr_flush_block:QY,_tr_tally:td,_tr_align:ZY}=qY,{Z_NO_FLUSH:ed,Z_PARTIAL_FLUSH:$Y,Z_FULL_FLUSH:tq,Z_FINISH:zo,Z_BLOCK:SB,Z_OK:Lr,Z_STREAM_END:TB,Z_STREAM_ERROR:kc,Z_DATA_ERROR:eq,Z_BUF_ERROR:f0,Z_DEFAULT_COMPRESSION:nq,Z_FILTERED:iq,Z_HUFFMAN_ONLY:Vb,Z_RLE:rq,Z_FIXED:sq,Z_DEFAULT_STRATEGY:oq,Z_UNKNOWN:aq,Z_DEFLATED:Bb}=xb,np=258,Mc=262,e_=42,ip=113,_S=666,rp=(t,e)=>(t.msg=ep[e],e),vB=t=>2*t-(t>4?9:0),nd=t=>{let e=t.length;for(;--e>=0;)t[e]=0},cq=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do n=t.head[--i],t.head[i]=n>=r?n-r:0;while(--e);e=r,i=e;do n=t.prev[--i],t.prev[i]=n>=r?n-r:0;while(--e)};let id=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const eo=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},no=(t,e)=>{QY(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,eo(t.strm)},Bn=(t,e)=>{t.pending_buf[t.pending++]=e},ES=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},m0=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),r===0?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),t.state.wrap===1?t.adler=mS(t.adler,e,r,n):t.state.wrap===2&&(t.adler=vr(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},yB=(t,e)=>{let n,i,r=t.max_chain_length,o=t.strstart,c=t.prev_length,l=t.nice_match;const d=t.strstart>t.w_size-Mc?t.strstart-(t.w_size-Mc):0,p=t.window,f=t.w_mask,S=t.prev,v=t.strstart+np;let y=p[o+c-1],P=p[o+c];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do if(n=e,p[n+c]===P&&p[n+c-1]===y&&p[n]===p[o]&&p[++n]===p[o+1]){o+=2,n++;do;while(p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&o<v);if(i=np-(v-o),o=v-np,i>c){if(t.match_start=e,c=i,i>=l)break;y=p[o+c-1],P=p[o+c]}}while((e=S[e&f])>d&&--r!=0);return c<=t.lookahead?c:t.lookahead},n_=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Mc)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),cq(t),i+=e),t.strm.avail_in===0)break;if(n=m0(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=id(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=id(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Mc&&t.strm.avail_in!==0)},RB=(t,e)=>{let n,i,r,o=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,c=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<o&&(n===0&&e!==zo||e===ed||n!==i+t.strm.avail_in)))break;c=e===zo&&n===i+t.strm.avail_in?1:0,p0(t,0,0,c),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,eo(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(m0(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(c===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?4:e!==ed&&e!==zo&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(m0(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,o=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=o||(i||e===zo)&&e!==ed&&t.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,c=e===zo&&t.strm.avail_in===0&&n===i?1:0,p0(t,t.block_start,n,c),t.block_start+=n,eo(t.strm)),c?3:1)},_0=(t,e)=>{let n,i;for(;;){if(t.lookahead<Mc){if(n_(t),t.lookahead<Mc&&e===ed)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=id(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Mc&&(t.match_length=yB(t,n)),t.match_length>=3)if(i=td(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=id(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=id(t,t.ins_h,t.window[t.strstart+1]);else i=td(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(no(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===zo?(no(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(no(t,!1),t.strm.avail_out===0)?1:2},i_=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<Mc){if(n_(t),t.lookahead<Mc&&e===ed)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=id(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Mc&&(t.match_length=yB(t,n),t.match_length<=5&&(t.strategy===iq||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=td(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=r&&(t.ins_h=id(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(no(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(i=td(t,0,t.window[t.strstart-1]),i&&no(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=td(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===zo?(no(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(no(t,!1),t.strm.avail_out===0)?1:2};function Uc(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const gS=[new Uc(0,0,0,0,RB),new Uc(4,4,8,4,_0),new Uc(4,5,16,8,_0),new Uc(4,6,32,32,_0),new Uc(4,4,16,16,i_),new Uc(8,16,32,32,i_),new Uc(8,16,128,128,i_),new Uc(8,32,128,256,i_),new Uc(32,128,258,1024,i_),new Uc(32,258,258,4096,i_)];function lq(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Bb,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),nd(this.dyn_ltree),nd(this.dyn_dtree),nd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),nd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),nd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const SS=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==e_&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==ip&&e.status!==_S?1:0},bB=t=>{if(SS(t))return rp(t,kc);t.total_in=t.total_out=0,t.data_type=aq;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?e_:ip,t.adler=e.wrap===2?0:1,e.last_flush=-2,JY(e),Lr},CB=t=>{const e=bB(t);return e===Lr&&(n=>{n.window_size=2*n.w_size,nd(n.head),n.max_lazy_match=gS[n.level].max_lazy,n.good_match=gS[n.level].good_length,n.nice_match=gS[n.level].nice_length,n.max_chain_length=gS[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},AB=(t,e,n,i,r,o)=>{if(!t)return kc;let c=1;if(e===nq&&(e=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),r<1||r>9||n!==Bb||i<8||i>15||e<0||e>9||o<0||o>sq||i===8&&c!==1)return rp(t,kc);i===8&&(i=9);const l=new lq;return t.state=l,l.strm=t,l.status=e_,l.wrap=c,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=e,l.strategy=o,l.method=n,CB(t)};var uq=(t,e)=>{if(SS(t)||e>SB||e<0)return t?rp(t,kc):kc;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===_S&&e!==zo)return rp(t,t.avail_out===0?f0:kc);const i=n.last_flush;if(n.last_flush=e,n.pending!==0){if(eo(t),t.avail_out===0)return n.last_flush=-1,Lr}else if(t.avail_in===0&&vB(e)<=vB(i)&&e!==zo)return rp(t,f0);if(n.status===_S&&t.avail_in!==0)return rp(t,f0);if(n.status===e_&&n.wrap===0&&(n.status=ip),n.status===e_){let r=Bb+(n.w_bits-8<<4)<<8,o=-1;if(o=n.strategy>=Vb||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=o<<6,n.strstart!==0&&(r|=32),r+=31-r%31,ES(n,r),n.strstart!==0&&(ES(n,t.adler>>>16),ES(n,65535&t.adler)),t.adler=1,n.status=ip,eo(t),n.pending!==0)return n.last_flush=-1,Lr}if(n.status===57){if(t.adler=0,Bn(n,31),Bn(n,139),Bn(n,8),n.gzhead)Bn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Bn(n,255&n.gzhead.time),Bn(n,n.gzhead.time>>8&255),Bn(n,n.gzhead.time>>16&255),Bn(n,n.gzhead.time>>24&255),Bn(n,n.level===9?2:n.strategy>=Vb||n.level<2?4:0),Bn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Bn(n,255&n.gzhead.extra.length),Bn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=vr(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Bn(n,0),Bn(n,0),Bn(n,0),Bn(n,0),Bn(n,0),Bn(n,n.level===9?2:n.strategy>=Vb||n.level<2?4:0),Bn(n,3),n.status=ip,eo(t),n.pending!==0)return n.last_flush=-1,Lr}if(n.status===69){if(n.gzhead.extra){let r=n.pending,o=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+o>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(t.adler=vr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=l,eo(t),n.pending!==0)return n.last_flush=-1,Lr;r=0,o-=l}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending+=o,n.gzhead.hcrc&&n.pending>r&&(t.adler=vr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(t.adler=vr(t.adler,n.pending_buf,n.pending-o,o)),eo(t),n.pending!==0)return n.last_flush=-1,Lr;o=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Bn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>o&&(t.adler=vr(t.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(t.adler=vr(t.adler,n.pending_buf,n.pending-o,o)),eo(t),n.pending!==0)return n.last_flush=-1,Lr;o=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Bn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>o&&(t.adler=vr(t.adler,n.pending_buf,n.pending-o,o))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(eo(t),n.pending!==0))return n.last_flush=-1,Lr;Bn(n,255&t.adler),Bn(n,t.adler>>8&255),t.adler=0}if(n.status=ip,eo(t),n.pending!==0)return n.last_flush=-1,Lr}if(t.avail_in!==0||n.lookahead!==0||e!==ed&&n.status!==_S){let r=n.level===0?RB(n,e):n.strategy===Vb?((o,c)=>{let l;for(;;){if(o.lookahead===0&&(n_(o),o.lookahead===0)){if(c===ed)return 1;break}if(o.match_length=0,l=td(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,l&&(no(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,c===zo?(no(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(no(o,!1),o.strm.avail_out===0)?1:2})(n,e):n.strategy===rq?((o,c)=>{let l,d,p,f;const S=o.window;for(;;){if(o.lookahead<=np){if(n_(o),o.lookahead<=np&&c===ed)return 1;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(p=o.strstart-1,d=S[p],d===S[++p]&&d===S[++p]&&d===S[++p])){f=o.strstart+np;do;while(d===S[++p]&&d===S[++p]&&d===S[++p]&&d===S[++p]&&d===S[++p]&&d===S[++p]&&d===S[++p]&&d===S[++p]&&p<f);o.match_length=np-(f-p),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(l=td(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(l=td(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),l&&(no(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,c===zo?(no(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(no(o,!1),o.strm.avail_out===0)?1:2})(n,e):gS[n.level].func(n,e);if(r!==3&&r!==4||(n.status=_S),r===1||r===3)return t.avail_out===0&&(n.last_flush=-1),Lr;if(r===2&&(e===$Y?ZY(n):e!==SB&&(p0(n,0,0,!1),e===tq&&(nd(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),eo(t),t.avail_out===0))return n.last_flush=-1,Lr}return e!==zo?Lr:n.wrap<=0?TB:(n.wrap===2?(Bn(n,255&t.adler),Bn(n,t.adler>>8&255),Bn(n,t.adler>>16&255),Bn(n,t.adler>>24&255),Bn(n,255&t.total_in),Bn(n,t.total_in>>8&255),Bn(n,t.total_in>>16&255),Bn(n,t.total_in>>24&255)):(ES(n,t.adler>>>16),ES(n,65535&t.adler)),eo(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Lr:TB)},dq=(t,e)=>{let n=e.length;if(SS(t))return kc;const i=t.state,r=i.wrap;if(r===2||r===1&&i.status!==e_||i.lookahead)return kc;if(r===1&&(t.adler=mS(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){r===0&&(nd(i.head),i.strstart=0,i.block_start=0,i.insert=0);let d=new Uint8Array(i.w_size);d.set(e.subarray(n-i.w_size,n),0),e=d,n=i.w_size}const o=t.avail_in,c=t.next_in,l=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,n_(i);i.lookahead>=3;){let d=i.strstart,p=i.lookahead-2;do i.ins_h=id(i,i.ins_h,i.window[d+3-1]),i.prev[d&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=d,d++;while(--p);i.strstart=d,i.lookahead=2,n_(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=l,t.avail_in=o,i.wrap=r,Lr},TS={deflateInit:(t,e)=>AB(t,e,Bb,15,8,oq),deflateInit2:AB,deflateReset:CB,deflateResetKeep:bB,deflateSetHeader:(t,e)=>SS(t)||t.state.wrap!==2?kc:(t.state.gzhead=e,Lr),deflate:uq,deflateEnd:t=>{if(SS(t))return kc;const e=t.state.status;return t.state=null,e===ip?rp(t,eq):Lr},deflateSetDictionary:dq,deflateInfo:"pako deflate (from Nodeca project)"};const hq=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var wB=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)hq(n,i)&&(t[i]=n[i])}}return t},IB=t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,o=t.length;i<o;i++){let c=t[i];n.set(c,r),r+=c.length}return n};let OB=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{OB=!1}const vS=new Uint8Array(256);for(let t=0;t<256;t++)vS[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;vS[254]=vS[254]=1;var E0=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,r,o,c=t.length,l=0;for(r=0;r<c;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),o=0,r=0;o<l;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[o++]=n:n<2048?(e[o++]=192|n>>>6,e[o++]=128|63&n):n<65536?(e[o++]=224|n>>>12,e[o++]=128|n>>>6&63,e[o++]=128|63&n):(e[o++]=240|n>>>18,e[o++]=128|n>>>12&63,e[o++]=128|n>>>6&63,e[o++]=128|63&n);return e},pq=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,r;const o=new Array(2*n);for(r=0,i=0;i<n;){let c=t[i++];if(c<128){o[r++]=c;continue}let l=vS[c];if(l>4)o[r++]=65533,i+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&i<n;)c=c<<6|63&t[i++],l--;l>1?o[r++]=65533:c<65536?o[r++]=c:(c-=65536,o[r++]=55296|c>>10&1023,o[r++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&OB)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let d="";for(let p=0;p<l;p++)d+=String.fromCharCode(c[p]);return d})(o,r)},fq=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+vS[t[n]]>e?n:e},NB=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const DB=Object.prototype.toString,{Z_NO_FLUSH:mq,Z_SYNC_FLUSH:_q,Z_FULL_FLUSH:Eq,Z_FINISH:gq,Z_OK:jb,Z_STREAM_END:Sq,Z_DEFAULT_COMPRESSION:Tq,Z_DEFAULT_STRATEGY:vq,Z_DEFLATED:yq}=xb;function Fb(t){this.options=wB({level:Tq,method:yq,chunkSize:16384,windowBits:15,memLevel:8,strategy:vq},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new NB,this.strm.avail_out=0;let n=TS.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==jb)throw new Error(ep[n]);if(e.header&&TS.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?E0(e.dictionary):DB.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=TS.deflateSetDictionary(this.strm,i),n!==jb)throw new Error(ep[n]);this._dict_set=!0}}function Rq(t,e){const n=new Fb(e);if(n.push(t,!0),n.err)throw n.msg||ep[n.err];return n.result}Fb.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,o;if(this.ended)return!1;for(o=e===~~e?e:e===!0?gq:mq,typeof t=="string"?n.input=E0(t):DB.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(o===_q||o===Eq)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=TS.deflate(n,o),r===Sq)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=TS.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===jb;if(n.avail_out!==0){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Fb.prototype.onData=function(t){this.chunks.push(t)},Fb.prototype.onEnd=function(t){t===jb&&(this.result=IB(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var bq={deflate:Rq};const Gb=16209;var Cq=function(t,e){let n,i,r,o,c,l,d,p,f,S,v,y,P,I,O,M,U,W,Q,X,Y,ot,Et,Ot;const Lt=t.state;n=t.next_in,Et=t.input,i=n+(t.avail_in-5),r=t.next_out,Ot=t.output,o=r-(e-t.avail_out),c=r+(t.avail_out-257),l=Lt.dmax,d=Lt.wsize,p=Lt.whave,f=Lt.wnext,S=Lt.window,v=Lt.hold,y=Lt.bits,P=Lt.lencode,I=Lt.distcode,O=(1<<Lt.lenbits)-1,M=(1<<Lt.distbits)-1;t:do{y<15&&(v+=Et[n++]<<y,y+=8,v+=Et[n++]<<y,y+=8),U=P[v&O];e:for(;;){if(W=U>>>24,v>>>=W,y-=W,W=U>>>16&255,W===0)Ot[r++]=65535&U;else{if(!(16&W)){if(64&W){if(32&W){Lt.mode=16191;break t}t.msg="invalid literal/length code",Lt.mode=Gb;break t}U=P[(65535&U)+(v&(1<<W)-1)];continue e}for(Q=65535&U,W&=15,W&&(y<W&&(v+=Et[n++]<<y,y+=8),Q+=v&(1<<W)-1,v>>>=W,y-=W),y<15&&(v+=Et[n++]<<y,y+=8,v+=Et[n++]<<y,y+=8),U=I[v&M];;){if(W=U>>>24,v>>>=W,y-=W,W=U>>>16&255,16&W){if(X=65535&U,W&=15,y<W&&(v+=Et[n++]<<y,y+=8,y<W&&(v+=Et[n++]<<y,y+=8)),X+=v&(1<<W)-1,X>l){t.msg="invalid distance too far back",Lt.mode=Gb;break t}if(v>>>=W,y-=W,W=r-o,X>W){if(W=X-W,W>p&&Lt.sane){t.msg="invalid distance too far back",Lt.mode=Gb;break t}if(Y=0,ot=S,f===0){if(Y+=d-W,W<Q){Q-=W;do Ot[r++]=S[Y++];while(--W);Y=r-X,ot=Ot}}else if(f<W){if(Y+=d+f-W,W-=f,W<Q){Q-=W;do Ot[r++]=S[Y++];while(--W);if(Y=0,f<Q){W=f,Q-=W;do Ot[r++]=S[Y++];while(--W);Y=r-X,ot=Ot}}}else if(Y+=f-W,W<Q){Q-=W;do Ot[r++]=S[Y++];while(--W);Y=r-X,ot=Ot}for(;Q>2;)Ot[r++]=ot[Y++],Ot[r++]=ot[Y++],Ot[r++]=ot[Y++],Q-=3;Q&&(Ot[r++]=ot[Y++],Q>1&&(Ot[r++]=ot[Y++]))}else{Y=r-X;do Ot[r++]=Ot[Y++],Ot[r++]=Ot[Y++],Ot[r++]=Ot[Y++],Q-=3;while(Q>2);Q&&(Ot[r++]=Ot[Y++],Q>1&&(Ot[r++]=Ot[Y++]))}break}if(64&W){t.msg="invalid distance code",Lt.mode=Gb;break t}U=I[(65535&U)+(v&(1<<W)-1)]}}break}}while(n<i&&r<c);Q=y>>3,n-=Q,y-=Q<<3,v&=(1<<y)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<c?c-r+257:257-(r-c),Lt.hold=v,Lt.bits=y};const Hb=15,Aq=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),wq=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Iq=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Oq=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var yS=(t,e,n,i,r,o,c,l)=>{const d=l.bits;let p,f,S,v,y,P,I=0,O=0,M=0,U=0,W=0,Q=0,X=0,Y=0,ot=0,Et=0,Ot=null;const Lt=new Uint16Array(16),Ce=new Uint16Array(16);let Ae,dn,Kn,Un=null;for(I=0;I<=Hb;I++)Lt[I]=0;for(O=0;O<i;O++)Lt[e[n+O]]++;for(W=d,U=Hb;U>=1&&Lt[U]===0;U--);if(W>U&&(W=U),U===0)return r[o++]=20971520,r[o++]=20971520,l.bits=1,0;for(M=1;M<U&&Lt[M]===0;M++);for(W<M&&(W=M),Y=1,I=1;I<=Hb;I++)if(Y<<=1,Y-=Lt[I],Y<0)return-1;if(Y>0&&(t===0||U!==1))return-1;for(Ce[1]=0,I=1;I<Hb;I++)Ce[I+1]=Ce[I]+Lt[I];for(O=0;O<i;O++)e[n+O]!==0&&(c[Ce[e[n+O]]++]=O);if(t===0?(Ot=Un=c,P=20):t===1?(Ot=Aq,Un=wq,P=257):(Ot=Iq,Un=Oq,P=0),Et=0,O=0,I=M,y=o,Q=W,X=0,S=-1,ot=1<<W,v=ot-1,t===1&&ot>852||t===2&&ot>592)return 1;for(;;){Ae=I-X,c[O]+1<P?(dn=0,Kn=c[O]):c[O]>=P?(dn=Un[c[O]-P],Kn=Ot[c[O]-P]):(dn=96,Kn=0),p=1<<I-X,f=1<<Q,M=f;do f-=p,r[y+(Et>>X)+f]=Ae<<24|dn<<16|Kn;while(f!==0);for(p=1<<I-1;Et&p;)p>>=1;if(p!==0?(Et&=p-1,Et+=p):Et=0,O++,--Lt[I]==0){if(I===U)break;I=e[n+c[O]]}if(I>W&&(Et&v)!==S){for(X===0&&(X=W),y+=M,Q=I-X,Y=1<<Q;Q+X<U&&(Y-=Lt[Q+X],!(Y<=0));)Q++,Y<<=1;if(ot+=1<<Q,t===1&&ot>852||t===2&&ot>592)return 1;S=Et&v,r[S]=W<<24|Q<<16|y-o}}return Et!==0&&(r[y+Et]=I-X<<24|64<<16),l.bits=W,0};const{Z_FINISH:PB,Z_BLOCK:Nq,Z_TREES:Wb,Z_OK:sp,Z_STREAM_END:Dq,Z_NEED_DICT:Pq,Z_STREAM_ERROR:Yo,Z_DATA_ERROR:LB,Z_MEM_ERROR:kB,Z_BUF_ERROR:Lq,Z_DEFLATED:MB}=xb,Kb=16180,zb=16190,xl=16191,g0=16192,S0=16194,Yb=16199,qb=16200,T0=16206,bi=16209,UB=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function kq(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const op=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Kb||e.mode>16211?1:0},xB=t=>{if(op(t))return Yo;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Kb,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,sp},VB=t=>{if(op(t))return Yo;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,xB(t)},BB=(t,e)=>{let n;if(op(t))return Yo;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Yo:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,VB(t))},jB=(t,e)=>{if(!t)return Yo;const n=new kq;t.state=n,n.strm=t,n.window=null,n.mode=Kb;const i=BB(t,e);return i!==sp&&(t.state=null),i};let v0,y0,FB=!0;const Mq=t=>{if(FB){v0=new Int32Array(512),y0=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(yS(1,t.lens,0,288,v0,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;yS(2,t.lens,0,32,y0,0,t.work,{bits:5}),FB=!1}t.lencode=v0,t.lenbits=9,t.distcode=y0,t.distbits=5},GB=(t,e,n,i)=>{let r;const o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(e.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),o.window.set(e.subarray(n-i,n-i+r),o.wnext),(i-=r)?(o.window.set(e.subarray(n-i,n),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0};var Uq=(t,e)=>{let n,i,r,o,c,l,d,p,f,S,v,y,P,I,O,M,U,W,Q,X,Y,ot,Et=0;const Ot=new Uint8Array(4);let Lt,Ce;const Ae=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(op(t)||!t.output||!t.input&&t.avail_in!==0)return Yo;n=t.state,n.mode===xl&&(n.mode=g0),c=t.next_out,r=t.output,d=t.avail_out,o=t.next_in,i=t.input,l=t.avail_in,p=n.hold,f=n.bits,S=l,v=d,ot=sp;t:for(;;)switch(n.mode){case Kb:if(n.wrap===0){n.mode=g0;break}for(;f<16;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}if(2&n.wrap&&p===35615){n.wbits===0&&(n.wbits=15),n.check=0,Ot[0]=255&p,Ot[1]=p>>>8&255,n.check=vr(n.check,Ot,2,0),p=0,f=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){t.msg="incorrect header check",n.mode=bi;break}if((15&p)!==MB){t.msg="unknown compression method",n.mode=bi;break}if(p>>>=4,f-=4,Y=8+(15&p),n.wbits===0&&(n.wbits=Y),Y>15||Y>n.wbits){t.msg="invalid window size",n.mode=bi;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&p?16189:xl,p=0,f=0;break;case 16181:for(;f<16;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}if(n.flags=p,(255&dr(n))!==MB){t.msg="unknown compression method",n.mode=bi;break}if(57344&dr(n)){t.msg="unknown header flags set",n.mode=bi;break}n.head&&(n.head.text=p>>8&1),512&dr(n)&&4&n.wrap&&(Ot[0]=255&p,Ot[1]=p>>>8&255,n.check=vr(n.check,Ot,2,0)),p=0,f=0,n.mode=16182;case 16182:for(;f<32;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}n.head&&(n.head.time=p),512&dr(n)&&4&n.wrap&&(Ot[0]=255&p,Ot[1]=p>>>8&255,Ot[2]=p>>>16&255,Ot[3]=p>>>24&255,n.check=vr(n.check,Ot,4,0)),p=0,f=0,n.mode=16183;case 16183:for(;f<16;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&dr(n)&&4&n.wrap&&(Ot[0]=255&p,Ot[1]=p>>>8&255,n.check=vr(n.check,Ot,2,0)),p=0,f=0,n.mode=16184;case 16184:if(1024&dr(n)){for(;f<16;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}n.length=p,n.head&&(n.head.extra_len=p),512&dr(n)&&4&n.wrap&&(Ot[0]=255&p,Ot[1]=p>>>8&255,n.check=vr(n.check,Ot,2,0)),p=0,f=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&dr(n)&&(y=n.length,y>l&&(y=l),y&&(n.head&&(Y=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(o,o+y),Y)),512&dr(n)&&4&n.wrap&&(n.check=vr(n.check,i,y,o)),l-=y,o+=y,n.length-=y),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&dr(n)){if(l===0)break t;y=0;do Y=i[o+y++],n.head&&Y&&n.length<65536&&(n.head.name+=String.fromCharCode(Y));while(Y&&y<l);if(512&dr(n)&&4&n.wrap&&(n.check=vr(n.check,i,y,o)),l-=y,o+=y,Y)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&dr(n)){if(l===0)break t;y=0;do Y=i[o+y++],n.head&&Y&&n.length<65536&&(n.head.comment+=String.fromCharCode(Y));while(Y&&y<l);if(512&dr(n)&&4&n.wrap&&(n.check=vr(n.check,i,y,o)),l-=y,o+=y,Y)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&dr(n)){for(;f<16;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}if(4&n.wrap&&p!==(65535&n.check)){t.msg="header crc mismatch",n.mode=bi;break}p=0,f=0}n.head&&(n.head.hcrc=dr(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=xl;break;case 16189:for(;f<32;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}t.adler=n.check=UB(p),p=0,f=0,n.mode=zb;case zb:if(n.havedict===0)return t.next_out=c,t.avail_out=d,t.next_in=o,t.avail_in=l,n.hold=p,n.bits=f,Pq;t.adler=n.check=1,n.mode=xl;case xl:if(e===Nq||e===Wb)break t;case g0:if(n.last){p>>>=7&f,f-=7&f,n.mode=T0;break}for(;f<3;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}switch(n.last=1&p,p>>>=1,f-=1,3&p){case 0:n.mode=16193;break;case 1:if(Mq(n),n.mode=Yb,e===Wb){p>>>=2,f-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=bi}p>>>=2,f-=2;break;case 16193:for(p>>>=7&f,f-=7&f;f<32;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}if((65535&p)!=(p>>>16^65535)){t.msg="invalid stored block lengths",n.mode=bi;break}if(n.length=65535&p,p=0,f=0,n.mode=S0,e===Wb)break t;case S0:n.mode=16195;case 16195:if(y=n.length,y){if(y>l&&(y=l),y>d&&(y=d),y===0)break t;r.set(i.subarray(o,o+y),c),l-=y,o+=y,d-=y,c+=y,n.length-=y;break}n.mode=xl;break;case 16196:for(;f<14;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}if(n.nlen=257+(31&p),p>>>=5,f-=5,n.ndist=1+(31&p),p>>>=5,f-=5,n.ncode=4+(15&p),p>>>=4,f-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=bi;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;f<3;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}n.lens[Ae[n.have++]]=7&p,p>>>=3,f-=3}for(;n.have<19;)n.lens[Ae[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Lt={bits:n.lenbits},ot=yS(0,n.lens,0,19,n.lencode,0,n.work,Lt),n.lenbits=Lt.bits,ot){t.msg="invalid code lengths set",n.mode=bi;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;Et=n.lencode[p&(1<<n.lenbits)-1],O=Et>>>24,M=Et>>>16&255,U=65535&Et,!(O<=f);){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}if(U<16)p>>>=O,f-=O,n.lens[n.have++]=U;else{if(U===16){for(Ce=O+2;f<Ce;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}if(p>>>=O,f-=O,n.have===0){t.msg="invalid bit length repeat",n.mode=bi;break}Y=n.lens[n.have-1],y=3+(3&p),p>>>=2,f-=2}else if(U===17){for(Ce=O+3;f<Ce;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}p>>>=O,f-=O,Y=0,y=3+(7&p),p>>>=3,f-=3}else{for(Ce=O+7;f<Ce;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}p>>>=O,f-=O,Y=0,y=11+(127&p),p>>>=7,f-=7}if(n.have+y>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=bi;break}for(;y--;)n.lens[n.have++]=Y}}if(n.mode===bi)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=bi;break}if(n.lenbits=9,Lt={bits:n.lenbits},ot=yS(1,n.lens,0,n.nlen,n.lencode,0,n.work,Lt),n.lenbits=Lt.bits,ot){t.msg="invalid literal/lengths set",n.mode=bi;break}if(n.distbits=6,n.distcode=n.distdyn,Lt={bits:n.distbits},ot=yS(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Lt),n.distbits=Lt.bits,ot){t.msg="invalid distances set",n.mode=bi;break}if(n.mode=Yb,e===Wb)break t;case Yb:n.mode=qb;case qb:if(l>=6&&d>=258){t.next_out=c,t.avail_out=d,t.next_in=o,t.avail_in=l,n.hold=p,n.bits=f,Cq(t,v),c=t.next_out,r=t.output,d=t.avail_out,o=t.next_in,i=t.input,l=t.avail_in,p=n.hold,f=n.bits,n.mode===xl&&(n.back=-1);break}for(n.back=0;Et=n.lencode[p&(1<<n.lenbits)-1],O=Et>>>24,M=Et>>>16&255,U=65535&Et,!(O<=f);){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}if(M&&!(240&M)){for(W=O,Q=M,X=U;Et=n.lencode[X+((p&(1<<W+Q)-1)>>W)],O=Et>>>24,M=Et>>>16&255,U=65535&Et,!(W+O<=f);){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}p>>>=W,f-=W,n.back+=W}if(p>>>=O,f-=O,n.back+=O,n.length=U,M===0){n.mode=16205;break}if(32&M){n.back=-1,n.mode=xl;break}if(64&M){t.msg="invalid literal/length code",n.mode=bi;break}n.extra=15&M,n.mode=16201;case 16201:if(n.extra){for(Ce=n.extra;f<Ce;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,f-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;Et=n.distcode[p&(1<<n.distbits)-1],O=Et>>>24,M=Et>>>16&255,U=65535&Et,!(O<=f);){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}if(!(240&M)){for(W=O,Q=M,X=U;Et=n.distcode[X+((p&(1<<W+Q)-1)>>W)],O=Et>>>24,M=Et>>>16&255,U=65535&Et,!(W+O<=f);){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}p>>>=W,f-=W,n.back+=W}if(p>>>=O,f-=O,n.back+=O,64&M){t.msg="invalid distance code",n.mode=bi;break}n.offset=U,n.extra=15&M,n.mode=16203;case 16203:if(n.extra){for(Ce=n.extra;f<Ce;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,f-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=bi;break}n.mode=16204;case 16204:if(d===0)break t;if(y=v-d,n.offset>y){if(y=n.offset-y,y>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=bi;break}y>n.wnext?(y-=n.wnext,P=n.wsize-y):P=n.wnext-y,y>n.length&&(y=n.length),I=n.window}else I=r,P=c-n.offset,y=n.length;y>d&&(y=d),d-=y,n.length-=y;do r[c++]=I[P++];while(--y);n.length===0&&(n.mode=qb);break;case 16205:if(d===0)break t;r[c++]=n.length,d--,n.mode=qb;break;case T0:if(n.wrap){for(;f<32;){if(l===0)break t;l--,p|=i[o++]<<f,f+=8}if(v-=d,t.total_out+=v,n.total+=v,4&n.wrap&&v&&(t.adler=n.check=dr(n)?vr(n.check,r,v,c-v):mS(n.check,r,v,c-v)),v=d,4&n.wrap&&(dr(n)?p:UB(p))!==n.check){t.msg="incorrect data check",n.mode=bi;break}p=0,f=0}n.mode=16207;case 16207:if(n.wrap&&dr(n)){for(;f<32;){if(l===0)break t;l--,p+=i[o++]<<f,f+=8}if(4&n.wrap&&p!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=bi;break}p=0,f=0}n.mode=16208;case 16208:ot=Dq;break t;case bi:ot=LB;break t;case 16210:return kB;default:return Yo}return t.next_out=c,t.avail_out=d,t.next_in=o,t.avail_in=l,n.hold=p,n.bits=f,(n.wsize||v!==t.avail_out&&n.mode<bi&&(n.mode<T0||e!==PB))&&GB(t,t.output,t.next_out,v-t.avail_out),S-=t.avail_in,v-=t.avail_out,t.total_in+=S,t.total_out+=v,n.total+=v,4&n.wrap&&v&&(t.adler=n.check=dr(n)?vr(n.check,r,v,t.next_out-v):mS(n.check,r,v,t.next_out-v)),t.data_type=n.bits+(n.last?64:0)+(n.mode===xl?128:0)+(n.mode===Yb||n.mode===S0?256:0),(S===0&&v===0||e===PB)&&ot===sp&&(ot=Lq),ot},Vl={inflateReset:VB,inflateReset2:BB,inflateResetKeep:xB,inflateInit:t=>jB(t,15),inflateInit2:jB,inflate:Uq,inflateEnd:t=>{if(op(t))return Yo;let e=t.state;return e.window&&(e.window=null),t.state=null,sp},inflateGetHeader:(t,e)=>{if(op(t))return Yo;const n=t.state;return 2&n.wrap?(n.head=e,e.done=!1,sp):Yo},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,o;return op(t)?Yo:(i=t.state,i.wrap!==0&&i.mode!==zb?Yo:i.mode===zb&&(r=1,r=mS(r,e,n,0),r!==i.check)?LB:(o=GB(t,e,n,n),o?(i.mode=16210,kB):(i.havedict=1,sp)))},inflateInfo:"pako inflate (from Nodeca project)"},xq=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const HB=Object.prototype.toString,{Z_NO_FLUSH:Vq,Z_FINISH:Bq,Z_OK:RS,Z_STREAM_END:R0,Z_NEED_DICT:b0,Z_STREAM_ERROR:jq,Z_DATA_ERROR:WB,Z_MEM_ERROR:Fq}=xb;function Xb(t){this.options=wB({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new NB,this.strm.avail_out=0;let n=Vl.inflateInit2(this.strm,e.windowBits);if(n!==RS)throw new Error(ep[n]);if(this.header=new xq,Vl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=E0(e.dictionary):HB.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Vl.inflateSetDictionary(this.strm,e.dictionary),n!==RS)))throw new Error(ep[n])}function Gq(t,e){const n=new Xb(e);if(n.push(t),n.err)throw n.msg||ep[n.err];return n.result}Xb.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let o,c,l;if(this.ended)return!1;for(c=e===~~e?e:e===!0?Bq:Vq,HB.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),o=Vl.inflate(n,c),o===b0&&r&&(o=Vl.inflateSetDictionary(n,r),o===RS?o=Vl.inflate(n,c):o===WB&&(o=b0));n.avail_in>0&&o===R0&&n.state.wrap>0&&t[n.next_in]!==0;)Vl.inflateReset(n),o=Vl.inflate(n,c);switch(o){case jq:case WB:case b0:case Fq:return this.onEnd(o),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||o===R0))if(this.options.to==="string"){let d=fq(n.output,n.next_out),p=n.next_out-d,f=pq(n.output,d);n.next_out=p,n.avail_out=i-p,p&&n.output.set(n.output.subarray(d,d+p),0),this.onData(f)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==RS||l!==0){if(o===R0)return o=Vl.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Xb.prototype.onData=function(t){this.chunks.push(t)},Xb.prototype.onEnd=function(t){t===RS&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=IB(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Hq={inflate:Gq};const{deflate:Wq}=bq,{inflate:Kq}=Hq;var zq=Wq,Yq=Kq,KB=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(KB||{});class qq{constructor(){D(this,"_sequence",0),D(this,"_startTime",Date.now()),D(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const d={id:0,length:4,data:l.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};n.commonPacketHeader.extension=1,n.extension=p,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;j("SHOW_DATASTREAM2_LOG")&&b.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),o=new DataView(i);let c=0;if(o.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,o.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,o.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const l=this.serializeExtension(n.extension);r.set(new Uint8Array(l),c),c+=l.byteLength}if(r.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let i=0;const r=n.getUint16(i,!0);i+=2;const o={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,l;if(i+=4,j("SHOW_DATASTREAM2_LOG")&&b.debug("receive data header: ".concat(JSON.stringify(o))),n.getUint16(i,!0),i+=2,o.extension){l=this.deserializeExtension(e.slice(i)),i+=2+l.length,c=e.slice(i);let d=!1;if(l.datas.length>0){const p=l.datas.find(f=>f.id===0);p&&(d=!(1&~new DataView(p.data).getUint32(0,!0)))}c=d?this.decompress(c):c}else c=e.slice(8);return c}serializeExtension(e){const{profile:n,length:i,datas:r}=e,o=new ArrayBuffer(i+2),c=new Uint8Array(o),l=new DataView(o);let d=0;if(l.setUint8(d++,n),l.setUint8(d++,i),r.forEach(p=>{n?(l.setUint8(d++,p.id),l.setUint8(d++,p.length),c.set(new Uint8Array(p.data),d),d+=p.data.byteLength):(l.setUint8(d++,p.id|p.length<<4),c.set(new Uint8Array(p.data),d),d+=p.data.byteLength)}),d!==i+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(i+2));return o}deserializeExtension(e){const n=new DataView(e);let i=0;const r=n.getUint8(i);i++;const o=n.getUint8(i);i++;const c=r===KB.TWO_BYTE,l=[],d=new DataView(e,2);let p=0;for(;p<o;){let f=0,S=0,v=new ArrayBuffer(0);c?(f=d.getUint8(p),p++,S=d.getUint8(p),p++):(f=15&d.getUint8(p),S=d.getUint8(p)>>4,p++),S>0&&(v=d.buffer.slice(p+2,p+2+S),p+=v.byteLength),l.push({id:f,length:S,data:v})}if(p!==o)throw Error("parse error");return{profile:r,length:o,datas:l}}decompress(e){return Yq(new Uint8Array(e))}compress(e){return zq(new Uint8Array(e))}}const Xq={name:"DataStream",create:(t,e)=>{const n=e?new iz(t):new rz(t);return n.useDataStream(new qq),n}};class Jq extends An{constructor(e,n,i){super(),D(this,"ws",void 0),D(this,"requestId",1),D(this,"heartBeatTimer",void 0),D(this,"joinInfo",void 0),D(this,"clientId",void 0),D(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),D(this,"onClose",r=>{this.emit("close"),this.dispose()}),D(this,"onMessage",r=>{const o=JSON.parse(r.data);if(!o||o.command!=="serverResponse"||!o.requestId)return o&&o.command==="serverStatus"&&o.serverStatus&&o.serverStatus.command?(this.emit("status",o.serverStatus),void this.emit(o.serverStatus.command,o.serverStatus)):void 0;this.emit("req_".concat(o.requestId),o)}),this.joinInfo=e,this.clientId=n,this.ws=new Qg("cross-channel-".concat(this.clientId),i),this.ws.on(ae.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ae.CONNECTED,this.onOpen),this.ws.on(ae.ON_MESSAGE,this.onMessage),this.ws.on(ae.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new At((n,i)=>{const r=window.setTimeout(()=>{i(new et(L.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,o=>{window.clearTimeout(r),o.state&&o.state!==0?i(new et(L.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new et(L.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new et(L.WS_DISCONNECT);const n=()=>new At((c,l)=>{this.ws.once(ae.CLOSED,()=>l(new et(L.WS_ABORT))),this.ws.once(ae.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(e),r=new At((c,l)=>{const d=()=>{l(new et(L.WS_ABORT))};this.ws.once(ae.RECONNECTING,d),this.ws.once(ae.CLOSED,d),this.once("req_".concat(i),c),Ni(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(ae.RECONNECTING,d),this.ws.off(ae.CLOSED,d),l(new et(L.TIMEOUT,"cross channel ws request timeout"))})}),o=await r;if(!o||o.code!==200)throw new et(L.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o)));return o}async connect(e){this.ws.removeAllListeners(ae.REQUEST_NEW_URLS),this.ws.on(ae.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Qq extends An{set state(e){e!==this._state&&(e!==zr.RELAY_STATE_FAILURE&&(this.errorCode=jm.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,i,r,o){super(),D(this,"joinInfo",void 0),D(this,"sid",void 0),D(this,"clientId",void 0),D(this,"cancelToken",Or.CancelToken.source()),D(this,"workerToken",void 0),D(this,"requestId",0),D(this,"signal",void 0),D(this,"prevChannelMediaConfig",void 0),D(this,"httpRetryConfig",void 0),D(this,"_resolution",void 0),D(this,"_state",zr.RELAY_STATE_IDLE),D(this,"errorCode",jm.RELAY_OK),D(this,"onStatus",c=>{b.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",Dl.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",Dl.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=jm.SRC_TOKEN_EXPIRED,this.state=zr.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=jm.DEST_TOKEN_EXPIRED,this.state=zr.RELAY_STATE_FAILURE))}),D(this,"onReconnect",async()=>{b.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Dl.NETWORK_DISCONNECTED),this.state=zr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==zr.RELAY_STATE_IDLE&&(b.error("auto restart channel media relay failed",c.toString()),this.errorCode=jm.SERVER_CONNECTION_LOST,this.state=zr.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=Bh(),this.signal=new Jq(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=o}async startChannelMediaRelay(e){if(this.state!==zr.RELAY_STATE_IDLE)throw new et(L.INVALID_OPERATION);this.state=zr.RELAY_STATE_CONNECTING,await this.connect(),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new et(L.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new et(L.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new et(L.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==zr.RELAY_STATE_RUNNING)throw new et(L.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==zr.RELAY_STATE_RUNNING)throw new et(L.INVALID_OPERATION);const n=this.genMessage(Tr.SetVideoProfile);await this.signal.request(n),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),b.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=zr.RELAY_STATE_IDLE,this.dispose()}dispose(){b.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Or.CancelToken.source(),this.state=zr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await uY(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Dl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(Tr.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Tr.SetSdkProfile,e);await this.signal.request(i),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(Tr.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Dl.PACKET_JOINED_SRC_CHANNEL),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const o=this.genMessage(Tr.SetSourceUserId,e);await this.signal.request(o),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(Tr.SetDestChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Dl.PACKET_JOINED_DEST_CHANNEL),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(Tr.StartPacketTransfer,e);await this.signal.request(l),this.emit("event",Dl.PACKET_SENT_TO_DEST_CHANNEL),this.state=zr.RELAY_STATE_RUNNING,b.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(Tr.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",Dl.PACKET_UPDATE_DEST_CHANNEL),b.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(Tr.StopPacketTransfer);await this.signal.request(e),b.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const i=[],r=[],o=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Js,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.23.1"&&(c.sdkVersion="0.0.1");let l=null,d=null;switch(e){case Tr.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case Tr.SetSourceChannel:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new et(L.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},c;case Tr.SetSourceUserId:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new et(L.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:d.uid+""},c;case Tr.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new et(L.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(p=>{i.push(p.channelName),r.push(p.uid+""),o.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:o},c;case Tr.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case Tr.Reconnect:return c.clientRequest={command:"Reconnect"},c;case Tr.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case Tr.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new et(L.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(p=>{i.push(p.channelName),r.push(p.uid+""),o.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:o},c;case Tr.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const Zq={name:"ChannelMediaRelay",create:function(t){return new Qq(t.joinInfo,t.clientId,t.websocketRetryConfig||ri,t.httpRetryConfig||ri,t.resolution)}};function zB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function bS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zB(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zB(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class $q extends An{constructor(e,n,i,r){super(),D(this,"spec",void 0),D(this,"token",void 0),D(this,"websocket",void 0),D(this,"pingpongTimer",void 0),D(this,"reconnectMode","retry"),D(this,"serviceMode",void 0),D(this,"reqId",0),D(this,"commandReqId",0),D(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),D(this,"handleWebSocketMessage",o=>{if(!o.data)return;const c=JSON.parse(o.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(Wt.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===Nl.TRANSCODE?1:2}),this.emit(Ku.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=e,this.serviceMode=r,this.websocket=new Qg("live-streaming",i),this.websocket.on(ae.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ae.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ae.REQUEST_NEW_URLS,(o,c)=>{xi(this,Ku.REQUEST_NEW_ADDRESS).then(o).catch(c)}),this.websocket.on(ae.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const o=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new et(L.UNEXPECTED_ERROR);const l=bS({command:e,sdkVersion:Js==="4.23.1"?"0.0.1":Js,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new et(L.WS_DISCONNECT);const d=()=>new At((v,y)=>{this.websocket.once(ae.CLOSED,()=>y(new et(L.WS_ABORT))),this.websocket.once(ae.CONNECTED,v)});this.websocket.state!=="connected"&&await d(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const p=new At((v,y)=>{const P=()=>{y(new et(L.WS_ABORT))};this.websocket.once(ae.RECONNECTING,P),this.websocket.once(ae.CLOSED,P),this.once("@".concat(c,"-").concat(this.spec.sid),I=>{v(I)})});r&&Wt.workerEvent(this.spec.sid,bS(bS({},r),{},{requestId:o,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const f=Date.now();this.websocket.sendMessage(l);let S=null;try{S=await p}catch(v){if(this.websocket.state==="closed")throw v;return await d(),await this.request(e,n,i)}return r&&Wt.workerEvent(this.spec.sid,bS(bS({},r),{},{requestId:o,actionType:"response",payload:JSON.stringify(S.serverResponse),serverCode:S.code,success:S.code===200,responseTime:Date.now()-f})),S.code!==200&&this.handleResponseError(S),S}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=Js==="4.23.1"?"0.0.1":Js;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case li.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void b.warning("live stream response already exists stream");case li.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case li.LIVE_STREAM_RESPONSE_BAD_STREAM:case li.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new et(L.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case li.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new et(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case li.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new et(L.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case li.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new et(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ku.WARNING,n,e.serverResponse.url)}case li.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new et(L.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ku.WARNING,n,e.serverResponse.url)}case li.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new et(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case li.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new et(L.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case li.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new et(L.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ku.WARNING,n,e.serverResponse.url)}case li.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new et(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case li.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new et(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case li.LIVE_STREAM_RESPONSE_WORKER_LOST:case li.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new et(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case li.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new et(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new et(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case li.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case li.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case li.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case li.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new et(L.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(VR)},6e3)}}function YB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function qr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?YB(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):YB(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class t7 extends An{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ri,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ri;super(),D(this,"onLiveStreamWarning",void 0),D(this,"onLiveStreamError",void 0),D(this,"spec",void 0),D(this,"retryTimeout",1e4),D(this,"connection",void 0),D(this,"httpRetryConfig",void 0),D(this,"wsRetryConfig",void 0),D(this,"streamingTasks",new Map),D(this,"isStartingStreamingTask",!1),D(this,"taskMutex",new zi("live-streaming")),D(this,"cancelToken",Or.CancelToken.source()),D(this,"transcodingConfig",void 0),D(this,"uapResponse",void 0),D(this,"lastTaskId",1),D(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=qr(qr({},Wz),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(b.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>qr(qr(qr({},Hz),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){Nn(c.width)||$e(c.width,"config.width",0,1e4),Nn(c.height)||$e(c.height,"config.height",0,1e4),Nn(c.videoBitrate)||$e(c.videoBitrate,"config.videoBitrate",1,1e6),Nn(c.videoFrameRate)||$e(c.videoFrameRate,"config.videoFrameRate"),Nn(c.lowLatency)||wl(c.lowLatency,"config.lowLatency"),Nn(c.audioSampleRate)||hi(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Nn(c.audioBitrate)||$e(c.audioBitrate,"config.audioBitrate",1,128),Nn(c.audioChannels)||hi(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),Nn(c.videoGop)||$e(c.videoGop,"config.videoGop"),Nn(c.videoCodecProfile)||hi(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Nn(c.userCount)||$e(c.userCount,"config.userCount",0,17),Nn(c.backgroundColor)||$e(c.backgroundColor,"config.backgroundColor",0,16777215),Nn(c.userConfigExtraInfo)||Oi(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!Nn(c.transcodingUsers)&&(Il(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,d)=>{cb(l.uid),Nn(l.x)||$e(l.x,"transcodingUser[".concat(d,"].x"),0,1e4),Nn(l.y)||$e(l.y,"transcodingUser[".concat(d,"].y"),0,1e4),Nn(l.width)||$e(l.width,"transcodingUser[".concat(d,"].width"),0,1e4),Nn(l.height)||$e(l.height,"transcodingUser[".concat(d,"].height"),0,1e4),Nn(l.zOrder)||$e(l.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),Nn(l.alpha)||$e(l.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),Nn(c.watermark)||AO(c.watermark,"watermark"),Nn(c.backgroundImage)||AO(c.backgroundImage,"backgroundImage"),c.images&&!Nn(c.images)&&(Il(c.images,"config.images"),c.images.forEach((l,d)=>{AO(l,"images[".concat(d,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>qr(qr(qr({},CO),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(qr(qr(qr({},CO),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(qr(qr(qr({},CO),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>qr({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?At.resolve(c.uid):h2(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await At.all(r)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var o;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(or(o=this.streamingTasks).call(o)).map(l=>l.taskId).join("#")});b.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{b.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{b.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(d=>{b.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)})})}}async startLiveStreamingTask(e,n,i){if(!this.transcodingConfig&&n===Nl.TRANSCODE)throw new et(L.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};b.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const o=await this.taskMutex.lock();if(!this.connection&&i)return void o();if(this.streamingTasks.get(e)&&!i)return o(),new et(L.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(l){throw o(),l}switch(n){case Nl.TRANSCODE:r.transcodingConfig=qr({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new At((p,f)=>{Ni(this.retryTimeout).then(()=>{if(i)return f(i);const S=this.statusError.get(e);return S?(this.statusError.delete(e),f(S)):void 0})}),d=await At.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:n===Nl.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,b.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(e,{clientRequest:r,mode:n,url:e,taskId:c}),o()}catch(l){if(o(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,l)):await this.startLiveStreamingTask(e,n,l)}}stopLiveStreamingTask(e){return new At((n,i)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new et(L.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const o=r.mode;r.abortTask=()=>{b.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:o===Nl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{b.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var e;const n=Array.from(or(e=this.streamingTasks).call(e));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Or.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new et(L.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await xi(this,wO.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new $q(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Ku.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(Ku.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Ku.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new et(L.UNEXPECTED_ERROR,"can not get new live streaming address list"));xi(this,wO.REQUEST_WORKER_MANAGER_LIST,e).then(o=>{this.uapResponse=o,i(o.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=e.reason;switch(e.code){case li.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case li.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case li.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case li.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new et(L.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return b.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case li.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new et(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case li.LIVE_STREAM_RESPONSE_WORKER_LOST:case li.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(or(o=this.streamingTasks).call(o));for(const l of c)l.abortTask?l.abortTask():(b.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new et(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{b.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(d=>{b.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const e7={name:"LiveStreaming",create:function(t){return new t7(t.joinInfo,t.websocketRetryConfig||ri,t.httpRetryConfig||ri)}};function n7(t){let e=JB();return function(n,i){let r=n.appId;r!==void 0&&(Xe(i,10),xc(i,r));let o=n.cid;o!==void 0&&(Xe(i,16),Xe(i,o));let c=n.cname;c!==void 0&&(Xe(i,26),xc(i,c));let l=n.deviceId;l!==void 0&&(Xe(i,34),xc(i,l));let d=n.elapse;d!==void 0&&(Xe(i,40),rd(i,d));let p=n.fileSize;p!==void 0&&(Xe(i,48),rd(i,r_(p)));let f=n.height;f!==void 0&&(Xe(i,56),rd(i,r_(f)));let S=n.jpg;S!==void 0&&(Xe(i,66),Xe(i,S.length),function(kr,dt){let yt=s_(kr,dt.length);kr.bytes.set(dt,yt)}(i,S));let v=n.networkType;v!==void 0&&(Xe(i,72),rd(i,r_(v)));let y=n.osType;y!==void 0&&(Xe(i,80),rd(i,r_(y)));let P=n.requestId;P!==void 0&&(Xe(i,90),xc(i,P));let I=n.sdkVersion;I!==void 0&&(Xe(i,98),xc(i,I));let O=n.sequence;O!==void 0&&(Xe(i,104),rd(i,r_(O)));let M=n.sid;M!==void 0&&(Xe(i,114),xc(i,M));let U=n.timestamp;U!==void 0&&(Xe(i,120),rd(i,U));let W=n.uid;W!==void 0&&(Xe(i,128),Xe(i,W));let Q=n.vid;Q!==void 0&&(Xe(i,136),Xe(i,Q));let X=n.width;X!==void 0&&(Xe(i,144),rd(i,r_(X)));let Y=n.service;Y!==void 0&&(Xe(i,152),Xe(i,Y));let ot=n.callbackData;ot!==void 0&&(Xe(i,162),xc(i,ot));let Et=n.jpgEncryption;Et!==void 0&&(Xe(i,168),Xe(i,Et));let Ot=n.requestType;Ot!==void 0&&(Xe(i,176),Xe(i,Ot));let Lt=n.scorePorn;Lt!==void 0&&(Xe(i,185),O0(i,Lt));let Ce=n.scoreSexy;Ce!==void 0&&(Xe(i,193),O0(i,Ce));let Ae=n.scoreNeutral;Ae!==void 0&&(Xe(i,201),O0(i,Ae));let dn=n.scene;dn!==void 0&&(Xe(i,208),Xe(i,dn));let Kn=n.ossFilePrefix;Kn!==void 0&&(Xe(i,218),xc(i,Kn));let Un=n.serviceVendor;if(Un!==void 0)for(let kr of Un){Xe(i,226);let dt=JB();s7(kr,dt),Xe(i,dt.limit),l7(i,dt),c7(dt)}}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function i7(t){return function(n){let i={};t:for(;!QB(n);){let r=Vc(n);switch(r>>>3){case 0:break t;case 1:i.code=Vc(n);break;case 2:i.msg=ZB(n,Vc(n));break;case 3:{let o=o7(n);i.data=r7(n),n.limit=o;break}default:qB(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function r7(t){let e={};t:for(;!QB(t);){let n=Vc(t);switch(n>>>3){case 0:break t;case 1:e.requestId=ZB(t,Vc(t));break;case 2:e.requestType=Vc(t)>>>0;break;case 3:e.scorePorn=I0(t);break;case 4:e.scoreSexy=I0(t);break;case 5:e.scoreNeutral=I0(t);break;case 6:e.requestScene=Vc(t)>>>0;break;case 7:e.scene=Vc(t)>>>0;break;default:qB(t,7&n)}}return e}function s7(t,e){let n=t.service;n!==void 0&&(Xe(e,8),Xe(e,n));let i=t.vendor;i!==void 0&&(Xe(e,16),Xe(e,i));let r=t.token;r!==void 0&&(Xe(e,26),xc(e,r));let o=t.callbackUrl;o!==void 0&&(Xe(e,34),xc(e,o))}function o7(t){let e=Vc(t),n=t.limit;return t.limit=t.offset+e,n}function qB(t,e){switch(e){case 0:for(;128&$B(t););break;case 2:A0(t,Vc(t));break;case 5:A0(t,4);break;case 1:A0(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let a7=new Float32Array(1);new Uint8Array(a7.buffer);let C0=new Float64Array(1),Xr=new Uint8Array(C0.buffer);function r_(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let XB=[];function JB(){const t=XB.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function c7(t){XB.push(t)}function A0(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function QB(t){return t.offset>=t.limit}function s_(t,e){let n=t.bytes,i=t.offset,r=t.limit,o=i+e;if(o>n.length){let c=new Uint8Array(2*o);c.set(n),t.bytes=c}return t.offset=o,o>r&&(t.limit=o),i}function w0(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function ZB(t,e){let n=w0(t,e),i=String.fromCharCode,r=t.bytes,o="�",c="";for(let l=0;l<e;l++){let d,p,f,S,v=r[l+n];128&v?(224&v)==192?l+1>=e?c+=o:(d=r[l+n+1],(192&d)!=128?c+=o:(S=(31&v)<<6|63&d,S<128?c+=o:(c+=i(S),l++))):(240&v)==224?l+2>=e?c+=o:(d=r[l+n+1],p=r[l+n+2],(49344&(d|p<<8))!=32896?c+=o:(S=(15&v)<<12|(63&d)<<6|63&p,S<2048||S>=55296&&S<=57343?c+=o:(c+=i(S),l+=2))):(248&v)==240?l+3>=e?c+=o:(d=r[l+n+1],p=r[l+n+2],f=r[l+n+3],(12632256&(d|p<<8|f<<16))!=8421504?c+=o:(S=(7&v)<<18|(63&d)<<12|(63&p)<<6|63&f,S<65536||S>1114111?c+=o:(S-=65536,c+=i(55296+(S>>10),56320+(1023&S)),l+=3))):c+=o:c+=i(v)}return c}function xc(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}Xe(t,i);let r=s_(t,i),o=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?o[r++]=l:(l<2048?o[r++]=l>>6&31|192:(l<65536?o[r++]=l>>12&15|224:(o[r++]=l>>18&7|240,o[r++]=l>>12&63|128),o[r++]=l>>6&63|128),o[r++]=63&l|128)}}function l7(t,e){let n=s_(t,e.limit),i=t.bytes,r=e.bytes;for(let o=0,c=e.limit;o<c;o++)i[o+n]=r[o]}function $B(t){return t.bytes[w0(t,1)]}function tj(t,e){let n=s_(t,1);t.bytes[n]=e}function I0(t){let e=w0(t,8),n=t.bytes;return Xr[0]=n[e++],Xr[1]=n[e++],Xr[2]=n[e++],Xr[3]=n[e++],Xr[4]=n[e++],Xr[5]=n[e++],Xr[6]=n[e++],Xr[7]=n[e++],C0[0]}function O0(t,e){let n=s_(t,8),i=t.bytes;C0[0]=e,i[n++]=Xr[0],i[n++]=Xr[1],i[n++]=Xr[2],i[n++]=Xr[3],i[n++]=Xr[4],i[n++]=Xr[5],i[n++]=Xr[6],i[n++]=Xr[7]}function Vc(t){let e,n=0,i=0;do e=$B(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function Xe(t,e){for(e>>>=0;e>=128;)tj(t,127&e|128),e>>>=7;tj(t,e)}function rd(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,o=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=s_(t,o),l=t.bytes;switch(o){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=o!==9?128|r:127&r;case 8:l[c+7]=o!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=o!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=o!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=o!==5?128|i:127&i;case 4:l[c+3]=o!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=o!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=o!==2?n>>>7|128:n>>>7&127;case 1:l[c]=o!==1?128|n:127&n}}function ej(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const u7=new Map([["moderation",1],["supervise",2]]);class d7 extends An{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Ri.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=Hi(n=e.map(i=>u7.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),D(this,"name","AgoraRTCVideoContentInspect"),D(this,"_connectionState",Fo.CONNECTING),D(this,"_innerConnectionState",void 0),D(this,"sequence",0),D(this,"inspectStartTime",void 0),D(this,"workerManagerConnection",void 0),D(this,"workerConnection",void 0),D(this,"workerMessageLengthLimit",void 0),D(this,"inspectIntervalMinimum",void 0),D(this,"qualityRatio",void 0),D(this,"_connectInfo",void 0),D(this,"_cancelTokenSource",Or.CancelToken.source()),D(this,"_retryConfig",void 0),D(this,"wmSequence",0),D(this,"inspectInterval",void 0),D(this,"inspectTimer",null),D(this,"ossFilePrefix",void 0),D(this,"extraInfo",void 0),D(this,"_inspectType",void 0),D(this,"_inspectMode",void 0),D(this,"_quality",1),D(this,"qualityTimer",null),D(this,"_inspectId",void 0),D(this,"_needWorkUrlOnly",!1),D(this,"inspectImage",()=>{if(this.connectionState!==Fo.CONNECTED)throw new et(L.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Fo.CONNECTED?this.requestToInspectImage():b.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ln(5,"inspect-"),this.workerMessageLengthLimit=j("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=j("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=j("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Qg("worker-manager-"+this._inspectId,ri),this.on(Ri.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,b.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Go[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Qg("worker-"+this._inspectId,ri),this.handleWorkerEvents()}async init(e,n){this.emit(Ri.STATE_CHANGE,Go.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new At((r,o)=>{this.on(Ri.CONNECTION_STATE_CHANGE,(c,l)=>{l===Fo.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{o(c)})})}async requestAP(e,n,i){const r=j("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),o=await function(l,d,p,f){let{appId:S,areaCode:v,cname:y,sid:P,token:I,uid:O}=d;qm++;const M="image_moderation_api",U={service_name:M,json_body:JSON.stringify({appId:S,areaCode:v,cname:y,command:"allocateEdge",requestId:qm,seq:qm,sid:P,token:I,ts:Date.now(),uid:O+""})};let W,Q,X=l[0];return Ra(async()=>{W=Date.now();const Y=await Ia(X,{data:U,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Q=Date.now()-W,Y.code!==0){const Lt=new et(L.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Y.code,{retry:!0,responseTime:Q});throw b.error(Lt.toString()),Lt}const ot=JSON.parse(Y.json_body);if(ot.code!==200){const Lt=new et(L.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ot.code,", reason: ").concat(ot.reason),{code:ot.code,responseTime:Q});throw b.error(Lt.toString()),Lt}if(!ot.servers||!Array.isArray(ot.servers)||ot.servers.length===0){const Lt=new et(L.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ot.code,responseTime:Q});throw b.error(Lt.toString()),Lt}const Et=j("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ot=j("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ot.servers.map(Lt=>{let{address:Ce,wss:Ae}=Lt;if(Ce&&Ae)return"wss://".concat(Ce.replace(/\./g,"-"),".").concat(Et,":").concat(Ot||Ae)}).filter(Lt=>!!Lt),workerToken:ot.workerToken,vid:ot.vid,responseTime:Q}},(Y,ot)=>(Wt.apworkerEvent(P,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(Y.addressList),firstSuccess:ot===0,responseTime:Q,serverIp:l[ot%l.length]}),!1),(Y,ot)=>(Wt.apworkerEvent(P,{success:!1,sc:Y.data&&Y.data.code||200,serviceName:M,responseTime:Q,serverIp:l[ot%l.length]}),!!(Y.code!==L.OPERATION_ABORTED&&Y.code!==L.UNEXPECTED_RESPONSE||Y.data&&Y.data.retry)&&(X=l[(ot+1)%l.length],!0)),f)}(r,e,n,i);this.emit(Ri.STATE_CHANGE,Go.AP_CONNECTED);const{addressList:c}=o;return this.wmSequence++,c}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Ri.STATE_CHANGE,Go.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(ae.CONNECTED,async()=>{this.emit(Ri.STATE_CHANGE,Go.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(ae.CLOSED,()=>{this._innerConnectionState<Go.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(ae.FAILED,()=>{this._innerConnectionState<Go.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(ae.RECONNECTING,()=>{this._innerConnectionState<Go.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(ae.ON_MESSAGE,async e=>{this.emit(Ri.STATE_CHANGE,Go.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw b.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new et(L.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw b.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new et(L.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=j("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,o=n.replace(/:\d+\/?$/,":".concat(r));this.emit(Ri.STATE_CHANGE,Go.CONNECT_WORKER,o),this._needWorkUrlOnly?this.emit(Ri.REQUEST_NEW_WORKER_URL,o):await this.connectWorker(o)}}),this.workerManagerConnection.on(ae.WILL_RECONNECT,(e,n,i)=>{i(e)}),this.workerManagerConnection.on(ae.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(ae.CONNECTED,async()=>{this.emit(Ri.STATE_CHANGE,Go.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Fo.CONNECTED}),this.workerConnection.on(ae.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=i7(new Uint8Array(e.data));if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&b.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ri.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},o=Hi(n=Object.keys(r)).call(n,(l,d)=>r[l]>r[d]?l:d,"porn"),c=Object.keys(r).find(l=>l===o);this.emit(Ri.INSPECT_RESULT,c)}else this.emit(Ri.INSPECT_RESULT,void 0,new et(L.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Ri.INSPECT_RESULT,void 0,new et(L.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else b.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ri.INSPECT_RESULT,void 0,new et(L.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(ae.CLOSED,()=>{this.connectionState=Fo.CLOSED}),this.workerConnection.on(ae.FAILED,()=>{this.connectionState=Fo.CLOSED}),this.workerConnection.on(ae.RECONNECTING,()=>{this.connectionState=this.connectionState===Fo.CONNECTED?Fo.RECONNECTING:Fo.CONNECTING}),this.workerConnection.on(ae.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(ae.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(Ri.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const e=Is(this,Ri.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Ri.INSPECT_RESULT,void 0,new et(L.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Ri.INSPECT_RESULT,void 0,new et(L.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:i,cname:r,cid:o,vid:c,sid:l,uid:d}=n;const p=Date.now(),f=await e.getCurrentFrameImage("image/jpeg",this.quality),S=await U1(f,i,r),v=this.sequence+"-"+o+"-"+d+"-"+p+"-"+ln(12,""),y={appId:i,cid:o,cname:r,deviceId:"",elapse:(P=Number(p-this.inspectStartTime),{low:P|=0,high:P>>31,unsigned:P>=0}),fileSize:S.byteLength,jpgEncryption:2,height:f.height,width:f.width,jpg:S,networkType:6,osType:7,requestId:v,sdkVersion:"4.23.1",sequence:this.sequence,sid:l,timestamp:aV(p),uid:d,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var P;this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;const I=n7(y);if(I.byteLength<this.workerMessageLengthLimit){if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const O=function(M){for(var U=1;U<arguments.length;U++){var W=arguments[U]!=null?arguments[U]:{};U%2?ej(Object(W),!0).forEach(function(Q){D(M,Q,W[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(W)):ej(Object(W)).forEach(function(Q){Object.defineProperty(M,Q,Object.getOwnPropertyDescriptor(W,Q))})}return M}({},y);delete O.jpg,b.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(O))}return I}{const O=this.quality*this.qualityRatio;return this.quality=O,await this.generateRequestData(e,{appId:i,cname:r,cid:o,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Or.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Fo.CLOSED,this.emit(Ri.STATE_CHANGE,Go.CLOSED)}}const h7={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new et(L.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new et(L.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var o;if(!Ct(o=["supervise","moderation"]).call(o,r))throw new et(L.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new et(L.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new d7(e)}};var nj=R(ki.Object.getOwnPropertySymbols),p7=Ke,f7=z_.indexOf,m7=cu,N0=se([].indexOf),ij=!!N0&&1/N0([1],1,-0)<0;p7({target:"Array",proto:!0,forced:ij||!m7("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return ij?N0(this,t,e)||0:f7(this,t,e)}});var _7=Br("Array","indexOf"),E7=nt,g7=_7,D0=Array.prototype,S7=function(t){var e=t.indexOf;return t===D0||E7(D0,t)&&e===D0.indexOf?g7:e},rj=R(S7);function T7(t,e){if(t==null)return{};var n,i,r=function(c,l){if(c==null)return{};var d,p,f={},S=vx(c);for(p=0;p<S.length;p++)d=S[p],rj(l).call(l,d)>=0||(f[d]=c[d]);return f}(t,e);if(nj){var o=nj(t);for(i=0;i<o.length;i++)n=o[i],rj(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}let sj=class{get localCapabilities(){return kn(this._localCapabilities)}get rtpCapabilities(){return kn(this._rtpCapabilities)}get candidates(){return kn(this._candidates)}get iceParameters(){return kn(this._iceParameters)}get dtlsParameters(){return kn(this._dtlsParameters)}constructor(t){D(this,"sessionDesc",void 0),D(this,"_localCapabilities",void 0),D(this,"_rtpCapabilities",void 0),D(this,"_candidates",void 0),D(this,"_iceParameters",void 0),D(this,"_dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname","o/i14u9pJrxRKAsu"),D(this,"firefoxSsrcMidMap",new Map),t=kn(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:o,direction:c,setup:l,videoCodec:d,audioCodec:p}=t;let f;this.setup=l,f=c===Sr.RECEIVE_ONLY?Kr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Kr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=o;const S=c===Sr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,v=c===Sr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=c===Sr.RECEIVE_ONLY?r.send.videoCodecs:tS(xt.VIDEO,S,v,d),P=c===Sr.RECEIVE_ONLY?r.send.audioCodecs:tS(xt.AUDIO,S,v,p);for(const I of f.mediaDescriptions)I.attributes.iceUfrag=e.iceUfrag,I.attributes.icePwd=e.icePwd,I.attributes.fingerprints=n.fingerprints,I.attributes.candidates=i,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"&&(I.media.fmts=y.map(O=>O.payloadType.toString(10)),I.attributes.payloads=y,I.attributes.extmaps=S.videoExtensions),I.media.mediaType==="audio"&&(I.media.fmts=P.map(O=>O.payloadType.toString(10)),I.attributes.payloads=P,I.attributes.extmaps=S.audioExtensions,Ym(I));this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return Wu(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:c}=qh(e,this.cname,j("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(o);if(l){if(Ln()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(t,o,i);let p;return d===-1?(p=this.createOrRecycleSendMedia(t,o,c,"sendonly",i,r),this.updateBundleMids()):(p=kn(this.sessionDesc.mediaDescriptions[d]),p.attributes.direction="sendonly",p.attributes.ssrcs=o,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(p,r)),Ln()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,p.attributes.mid),{needExchangeSDP:!0,mid:p.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const i=[];return t.forEach(r=>{const o=r._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(o);let l,d=!1;c===-1?(d=!0,l=this.createOrRecycleRecvMedia(r,[],"recvonly",e,n),this.updateBundleMids()):(l=kn(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),i.push({mid:l.attributes.mid,needCreateTransceiver:d})}),i}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:i,port:r,type:o,relatedAddress:c,relatedPort:l,priority:d}=new RTCIceCandidate(t),p={foundation:e??"",componentId:"1",transport:n??"",priority:d?d+"":"",connectionAddress:i??"",port:r?r+"":"",type:o?o+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(f=>f.priority===p.priority&&f.connectionAddress===p.connectionAddress&&f.port===p.port)||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach(f=>{f.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,i,r){const o=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=tS(o,c,this.localCapabilities.send,o===xt.AUDIO?r:i),d=o===xt.VIDEO?c.videoExtensions:c.audioExtensions,p="".concat(++this.currentMidIndex);let f={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};f=this.mungRecvMediaDsec(f,t);const S=this.findFirstClosedMedia(o);if(S){const v=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[v]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Ct(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Ct(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Ln()){if(r){const o=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(o||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!o||o!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=kn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,i,r,o){const c=this.rtpCapabilities.send,l=t===xt.VIDEO?c.videoCodecs:c.audioCodecs,d=t===xt.VIDEO?c.videoExtensions:c.audioExtensions;Ln()&&(r="".concat(++this.currentMidIndex));let p={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};p=this.mungSendMediaDesc(p,o);const f=this.findFirstClosedMedia(t);if(f){const S=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[S]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}mungRecvMediaDsec(t,e,n){const i=kn(t);return PO(i),zm(i,e),LO(i,e),zx(i),mb(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=kn(t);return mb(n,e,this.localCapabilities.recv),Ym(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>Ln()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const v7=["sdp"];var _n;function oj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function sd(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?oj(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):oj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let aj=(_n=class u_ extends wx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,i){super(e,n),D(this,"direction",void 0),D(this,"name",void 0),D(this,"store",void 0),D(this,"spec",void 0),D(this,"peerConnection",void 0),D(this,"initialOffer",void 0),D(this,"transport",void 0),D(this,"statsFilter",void 0),D(this,"localCandidateCount",0),D(this,"_isInRestartIce",!1),D(this,"mutex",void 0),D(this,"onLocalCandidate",void 0),D(this,"remoteSDP",void 0),D(this,"pendingCandidates",[]),D(this,"localCapabilities",void 0),D(this,"isReady",!1),D(this,"restartCnt",0),D(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new zi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(u_.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Sr.SEND_ONLY,this.name=this.direction===Sr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=YI(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Ln()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await qx();if(this.localCapabilities=_b(n),e){const{sdp:i}=e,r=T7(e,v7),o=function(){const f={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},S=$g(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ho(S,f,"videoExtensions",v,y,P),Ho(S,f,"videoCodecs",v,y,P),Ho(S,f,"audioExtensions",v,y,P),Ho(S,f,"audioCodecs",v,y,P),j("RAISE_H264_BASELINE_PRIORITY")){const I=P.videoCodecs.findIndex(O=>O.rtpMap&&O.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&O.fmtp&&O.fmtp.parameters["profile-level-id"]==="42001f");if(I!==-1){const O=P.videoCodecs.findIndex(M=>M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(O<I){b.debug("raising H264 baseline profile priority");const M=P.videoCodecs[I];P.videoCodecs.splice(I,1),P.videoCodecs.splice(O,0,M)}O!==-1&&j("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(M=>!(M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&M.fmtp&&M.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:v,recv:y,sendrecv:P}}({},{},i);this.remoteSDP=new sj({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=qu(c.sdp);await this.peerConnection.setLocalDescription(c);const d=await Xx({},{},c.sdp);this.localCapabilities=_b(d);const p=this.peerConnection.getTransceivers()[0];return p!=null&&p.receiver&&p.receiver.transport&&this.tryBindTransportEvents(p.receiver.transport),sd(sd({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=qu(i.sdp);return this.initialOffer=i,sd(sd({},r),{},{sdp:i.sdp})}}catch(n){throw new st(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=e,o=await Xx({},{},n);this.remoteSDP=new sj({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new st(L.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Xs(function*(){const o=yield De(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=r.remoteSDP.receive(e,n,i);e.forEach((O,M)=>{if(l[M].needCreateTransceiver){const U=r.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});c.push(U),O._updateRtpTransceiver(U)}else{const U=r.peerConnection.getTransceivers().find(W=>W.mid===l[M].mid);if(!U)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[M].mid));c.push(U),O._updateRtpTransceiver(U)}}),Ln()&&j("SIMULCAST")===!0&&(yield De(r.applySimulcastForFirefox(c,e)));const d=l.map(O=>O.mid),p=yield De(r.peerConnection.createOffer()),f=r.mungSendOfferSDP(p.sdp,e,d),S=Kr(f),v=d.map(O=>{const M=S.mediaDescriptions.find(U=>U.attributes.mid===O);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return Hx(M,j("USE_PUB_RTX"))}),y=c.map((O,M)=>{const U=d[M];return{localSSRC:v[M],id:U}});yield De(r.peerConnection.setLocalDescription({type:"offer",sdp:f}));try{yield y}catch(O){const M=r.remoteSDP.toString();throw yield De(r.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield De(r.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield De(r.stopSending(d,!0)),O}yield De(r.applySimulcastEncodings(c,e)),yield De(r.applySendEncodings(c,e));const P=r.remoteSDP.toString(),I=r.logSDPExchange(f,"offer","local","send");return I==null||I(P),yield De(r.setRemoteDescription({type:"answer",sdp:P})),c.map((O,M)=>{const U=d[M];return{localSSRC:v[M],id:U}})}catch(c){throw c instanceof st?c:new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}})()}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));r.map(d=>{var p;d.direction="inactive",(p=d.stop)===null||p===void 0||p.call(d)});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const d=this.remoteSDP.toString(),p=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const f=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(f.sdp,o,e);p==null||p(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(o){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async mockReceive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const l=this.remoteSDP.toString(),d=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(p.sdp,o,e);d==null||d(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(o){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===jh.Auto&&(this.store.p2pTransport=jh.SdRtn,Ue().supportPCSetConfiguration&&this.peerConnection.setConfiguration(u_.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ue().supportPCSetConfiguration&&this.peerConnection.setConfiguration(u_.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=qu(n.sdp);return this.store.descriptionStart(),this.direction===Sr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===Sr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=qu(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const o=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new st(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?Ln()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:sd(sd({},Cc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:sd(sd({},Cc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;Ct(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var o;return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(jg(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...u_.turnServerConfigToIceServers(e.turnServer.servers,n,i)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...u_.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,i)),Ct(o=[jh.Relay,jh.SdRtn]).call(o,n)&&(r.iceTransportPolicy="relay"),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&Ue().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),b.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],o=e.filter(l=>l.tcpport);b.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(i));const c=o.length>i?o[i]:o[0];switch(n){case jh.SdRtn:const l=e.filter(p=>{var f;return Ct(f=p.username).call(f,"glb:")&&p.turnServerURL==p.turnServerURL}),d=l.length>i?l[i]:l[0];d&&(r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(Wm(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(Wm(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case jh.Relay:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Wm(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Wm(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair();b.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(f=>f.track===e._mediaStreamTrack)),!n)return b.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return b.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ue().supportSetRtpSenderParameters)return b.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},o={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:f,frameRate:S,scaleResolutionDownBy:v}=e._encoderConfig;f&&(o.maxBitrate=1e3*f),Ct(c=e._hints).call(c,un.LOW_STREAM)&&(S&&(o.maxFramerate=ps(S)),v&&v>=1&&(o.scaleResolutionDownBy=v))}if(j("DSCP_TYPE")&&Al()){var l;const f=j("DSCP_TYPE");Ct(l=["very-low","low","medium","high"]).call(l,f)&&(o.networkPriority=f)}const d=n.getParameters(),p=(i=d.encodings)===null||i===void 0?void 0:i[0];Ln()&&!p&&(r.encodings=[o]),p&&Object.assign(p,o),Object.assign(d,r),b.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(e,n){try{if(!Ue().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],o=n[i];o instanceof En&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,r.sender)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=Kr(e);return n.forEach((o,c)=>{const l=i[c],d=r.mediaDescriptions.find(p=>p.attributes.mid===l);d&&(zm(d,o),Yx(d,o,this.store.codec))}),Wu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,o,c,l;const p=e[d],f=n[d];if(f instanceof En&&!Ct(i=f._hints).call(i,un.LOW_STREAM)&&(r=f._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=f._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=f._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const S={},v={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,S))}}}async applySimulcastEncodings(e,n){if(!Ln()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof En&&this.isVP8Simulcast(r)){const o=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=o.sender.getParameters();await o.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,o,c;return!!(e instanceof En&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Ct(n=e._hints).call(n,un.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(o=e._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(j("SDP_LOGGING"))return b.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?o=>{this.logSDPExchange(o,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const o=this.remoteSDP.toString();r==null||r(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const o=this.remoteSDP.toString();r==null||r(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var i,r;if(n=(i=n)!==null&&i!==void 0?i:(r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp){var o;const c=(o=Kr(n).mediaDescriptions.find(l=>l.attributes.mid===e))===null||o===void 0?void 0:o.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),Ct(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,i){const r=Kr(e),o=r.mediaDescriptions.find(c=>c.attributes.mid===n);return o&&i===xt.AUDIO&&o.media.mediaType==="audio"&&Ym(o),Wu(r)}},Ft(_n.prototype,"establish",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"establish"),_n.prototype),Ft(_n.prototype,"connect",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"connect"),_n.prototype),Ft(_n.prototype,"receive",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"receive"),_n.prototype),Ft(_n.prototype,"mockReceive",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"mockReceive"),_n.prototype),Ft(_n.prototype,"stopReceiving",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"stopReceiving"),_n.prototype),Ft(_n.prototype,"restartICE",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"restartICE"),_n.prototype),Ft(_n.prototype,"close",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"close"),_n.prototype),Ft(_n.prototype,"updateEncoderConfig",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"updateEncoderConfig"),_n.prototype),Ft(_n.prototype,"updateSendParameters",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"updateSendParameters"),_n.prototype),Ft(_n.prototype,"replaceTrack",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"replaceTrack"),_n.prototype),Ft(_n.prototype,"muteLocal",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"muteLocal"),_n.prototype),Ft(_n.prototype,"unmuteLocal",[qo],Object.getOwnPropertyDescriptor(_n.prototype,"unmuteLocal"),_n.prototype),_n);function qo(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,o=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{o()}},n}let Na=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var cj,lj,uj,dj,hj,pj,fj,mj,_j,Ej,gj,bn;function Sj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Jb(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Sj(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Sj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let y7=(cj=Da(Na.SEND_ONLY),lj=Da(Na.SEND_ONLY),uj=Da(),dj=Da(Na.RECEIVE_ONLY),hj=Da(Na.RECEIVE_ONLY),pj=Da(Na.RECEIVE_ONLY),fj=Da(Na.RECEIVE_ONLY),mj=Da(Na.RECEIVE_ONLY),_j=Da(Na.RECEIVE_ONLY),Ej=Da(),gj=Da(Na.RECEIVE_ONLY),bn=class extends An{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(qt.StateChange,e,this._state)}constructor(t,e){super(),D(this,"isPlanB",!1),D(this,"store",void 0),D(this,"statsUploader",void 0),D(this,"sendConnection",void 0),D(this,"recvConnection",void 0),D(this,"localTrackMap",new Map),D(this,"remoteUserMap",new Map),D(this,"localDataChannels",[]),D(this,"pendingLocalTracks",[]),D(this,"pendingRemoteTracks",[]),D(this,"statsCollector",void 0),D(this,"dtlsFailedCount",0),D(this,"sendMutex",void 0),D(this,"recvMutex",void 0),D(this,"_state",Ye.Disconnected),D(this,"_restartStates",["disconnected","failed"]),D(this,"reconnectInterval",void 0),D(this,"uploadUnplinkStarted",!1),D(this,"uploadDownlinkStarted",!1),D(this,"uplinkStateUploadInterval",void 0),D(this,"downlinkStatsUploadInterval",void 0),D(this,"handleMuteLocalTrack",async(n,i,r)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ye.Connected)return void r(new st(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void i();const p=d.find(y=>y[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(y=>{let[,{id:P}]=y;return P}));let f=!1;var c,l;n.trackMediaType==="video"?f=!((c=this.localTrackMap.get(_t.LocalAudioTrack))===null||c===void 0||!c.track._muted):f=((l=this.localTrackMap.get(_t.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const S=this.createMuteMessage(d);await cn(this,qt.RequestMuteLocal,S);const v=n.trackMediaType==="video"?zu.MUTE_LOCAL_VIDEO:zu.MUTE_LOCAL_AUDIO;await cn(this,qt.RequestP2PMuteLocal,{action:v,message:S,isMuteAll:f}),i()}catch(d){r(d)}finally{o()}}),D(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ye.Connected)return void r(new st(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const l=this.createUnmuteMessage(c),d=n.trackMediaType==="video"?zu.UNMUTE_LOCAL_VIDEO:zu.UNMUTE_LOCAL_AUDIO;await cn(this,qt.RequestP2PMuteLocal,{action:d,message:l}),i()}catch(c){r(c)}finally{o()}}),D(this,"handleUpdateVideoEncoder",async(n,i,r,o)=>{let c;typeof o=="boolean"&&o||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(_t.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==Ye.Connected)return void i();const{id:p,track:f}=d;p&&(await this.sendConnection.updateSendParameters(p,f),await this.sendConnection.updateEncoderConfig(p,f),this.emit(qt.UpdateVideoEncoder,f)),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),D(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(_t.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==Ye.Connected)return void i();const{id:l,track:d}=c;l&&await this.sendConnection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{o()}}),D(this,"handleReplaceTrack",async(n,i,r,o)=>{let c;b.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof o=="boolean"&&o||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const p=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:S}]=f;return n===S});if(!this.sendConnection||!p||p[1].id===void 0||this.state!==Ye.Connected)return void i();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,p[1].id)),p[0]===_t.LocalVideoTrack&&Ue().supportDualStreamEncoding){const f=this.localTrackMap.get(_t.LocalVideoLowTrack);if(f){const S=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=S,f.track._originMediaStreamTrack=S,await new At((v,y)=>{this.handleReplaceTrack(f.track,v,y,!0)})}}i()}catch(p){r(p)}finally{var d;(d=c)===null||d===void 0||d()}}),D(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),D(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),D(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),D(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new k2(t),this.bindStatsUploaderEvents(),this.sendMutex=new zi("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new zi("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},j("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new st(L.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new st(L.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new aj(t,this.store,Sr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Ye.New,this.sendConnection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new aj(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new st(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ye.Connected}async addRemoteCandidate(t,e){if(e===Sr.RECEIVE_ONLY){if(!this.sendConnection)throw new st(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new st(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var i=this;return Xs(function*(){const r=yield De(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Ye.Connected){i.throwIfTrackTypeNotMatch(t);const p=t.filter(f=>i.pendingLocalTracks.indexOf(f)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(p))}i.store.pubId=i.store.pubId+1,qi.markPublishStart(i.store.clientId,i.store.pubId);const o=i.filterTobePublishedTracks(t,e,n);if(o.length===0)return void(yield De(i.tryToUnmuteAudio(t)));o.forEach(p=>{let{track:f,type:S}=p;const v=Date.now();i.store.publish(f.getTrackId(),S===_t.LocalAudioTrack?"audio":"video",v)}),i.bindLocalTrackEvents(o);const c=yield De(i.sendConnection.send(o.map(p=>{let{track:f}=p;return f}),i.store.codec,i.store.audioCodec)),l=(yield De(c.next())).value,d=i.createGatewayPublishMessage(o,l);try{yield d}catch(p){throw c.throw(p),(p==null?void 0:p.code)===L.WS_ABORT&&o.forEach(f=>{let{track:S}=f;i.pendingLocalTracks.indexOf(S)===-1&&i.pendingLocalTracks.push(S)}),i.unbindLocalTrackEvents(o),p}yield De(c.next()),o.forEach(p=>{let{type:f}=p;i.statsCollector.addLocalStats(f)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(o,l),o.forEach(p=>{let{track:f,type:S}=p;const v=Date.now();i.store.publish(f.getTrackId(),S===_t.LocalAudioTrack?"audio":"video",void 0,v)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Ye.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!Ct(t).call(t,r)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(r=>{let[,{id:o}]=r;return o})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[o,{track:c}]=r;return{type:o,track:c}})),e.forEach(r=>{let[o]=r;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Ye.Connected)return n&&n[1].track.close(),i;t.forEach(r=>{const o=this.pendingLocalTracks.indexOf(r);o!==-1&&this.pendingLocalTracks.splice(o,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:o,ssrcs:c}]=i;const l={stream_type:EY(o,r),ssrcs:c};o._muted||!o._enabled?e.push(l):n.push(l)}),e.length>0&&e.forEach(i=>{cn(this,qt.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{cn(this,qt.RequestUnmuteLocal,[i])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Xs(function*(){throw new st(L.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(b.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await xi(this,qt.RequestRePublish,this.pendingLocalTracks),this.emit(qt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new st(L.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,i){var r;if(!this.recvConnection)throw new st(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:o,mid:c,transceiver:l}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),i);e===xt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(o):(t._audioTrack=new Um(o,t.uid,t._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),l&&t._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(o):(t._videoTrack=new Mm(o,t.uid,t._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),l&&t._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._videoTrack));const d=this.remoteUserMap.get(t);d?d.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const p=this.pendingRemoteTracks.findIndex(f=>{let{user:S,kind:v}=f;return S.uid===t.uid&&e===v});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(qt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,i){if(!this.recvConnection)throw new st(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),i)}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(o=>{let{user:c,kind:l}=o;return e!==void 0?c.uid===t.uid&&e===l:c.uid===t.uid});if(i.forEach(o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||i.forEach(o=>{let{kind:c}=o;var l;if(c===xt.AUDIO)(l=t._audioTrack)===null||l===void 0||l._destroy(),t._audioTrack=void 0;else if(c===xt.VIDEO){var d;(d=t._videoTrack)===null||d===void 0||d._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(t,e);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(o=>{let[c,{kind:l}]=o;var d,p;if(l===xt.VIDEO&&c._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===xt.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0);else if(l===xt.AUDIO){var f;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((f=c._audioTrack)===null||f===void 0||f._destroy(),c._audioTrack=void 0)}}),r.forEach(o=>{let[,{kind:c}]=o;cn(this,qt.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[xt.VIDEO,xt.AUDIO].forEach(i=>{n.has(i)?cn(this,qt.RequestP2PUnmuteRemote,i):cn(this,qt.RequestP2PMuteRemote,i)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new st(L.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new st(L.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new st(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new st(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===xt.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||b.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(_t.LocalAudioTrack);if((e==null?void 0:e.track)instanceof ci){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==_t.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===_t.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===_t.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(_t.LocalAudioTrack),l=i?this.localTrackMap.get(_t.LocalVideoLowTrack):this.localTrackMap.get(_t.LocalVideoTrack);Wt.publish(this.store.sessionId,{eventElapse:qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(un.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var o;n||(n=[]);const c=n.find(d=>d instanceof Mn),l=i?(o=this.localTrackMap.get(_t.LocalVideoTrack))===null||o===void 0?void 0:o.track:n.find(d=>d instanceof En);Wt.publish(this.store.sessionId,{eventElapse:qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(un.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===xt.VIDEO?n._videoSSRC:n._audioSSRC;r&&Wt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===xt.VIDEO,audio:i===xt.AUDIO,peerid:n.uid,subscribeRequestid:i===xt.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:qi.measureFromSubscribeStart(this.store.clientId,r)})}reset(){b.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new zi("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new zi("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(_t.LocalAudioTrack);if((t==null?void 0:t.track)instanceof ci){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Ye.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(_t.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(_t.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof En||e&&e.track instanceof Mn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(Ns(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(_t.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Cg(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(b.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ye.Reconnecting,j("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case _t.LocalVideoTrack:Ct(e=i._hints).call(e,un.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case _t.LocalAudioTrack:i instanceof ci?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case _t.LocalVideoLowTrack:}}),this.emit(qt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Ns(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(qt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),b.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof Ju?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,i;if(t===Sr.SEND_ONLY){if(!this.sendConnection)throw new st(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new st(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){const r=await i.restartICE(e);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const o=await xi(this,qt.RequestP2PRestartICE,{direction:Sr.RECEIVE_ONLY,iceParameter:r});await i.restartICE(o),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(_t.LocalVideoTrack),n=this.localTrackMap.get(_t.LocalAudioTrack),i=t.videoSend.find(y=>{var P;return y.ssrc===(e==null||(P=e.ssrcs)===null||P===void 0?void 0:P[0].ssrcId)}),r=t.audioSend.find(y=>{var P;return y.ssrc===(n==null||(P=n.ssrcs)===null||P===void 0?void 0:P[0].ssrcId)});if(!i||!r)return 1;const o=Is(this,qt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,p=(d&&o?(d+o)/2:d||o)||0,f=100*t.sendPacketLossRate*.7/50+.3*p/1500,S=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,v=e==null?void 0:e.track;if(v&&v._encoderConfig&&v._hints.indexOf(un.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,P=t.bitrate.actualEncoded;if(y&&P){const I=(1e3*y-P)/(1e3*y);return gx[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,o=i._videoSSRC,c=t.audioRecv.find(P=>P.ssrc===r),l=t.videoRecv.find(P=>P.ssrc===o);if(!c&&!l)return void(e+=1);const d=Is(this,qt.NeedSignalRTT),p=t.rtt,f=(p&&d?(p+d)/2:p||d)||0,S=c?c.jitterMs:void 0,v=t.recvPacketLossRate;let y=.7*v*100/50+.3*f/1500;S&&(y=.6*v*100/50+.2*f/1500+.2*S/400),e+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new At((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const i=[],r=Ue(),o=this.getAllTracks();t=Rm(t=t.filter(d=>o.indexOf(d)===-1));let c=!1,l=!1;for(const d of t){if(d instanceof En&&(this.localTrackMap.has(_t.LocalVideoTrack)||c?new st(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:_t.LocalVideoTrack}),c=!0),e)){const p=this.getLowVideoTrack(d,n);i.push({track:p,type:_t.LocalVideoLowTrack})}if(d instanceof Mn){const p=this.localTrackMap.get(_t.LocalAudioTrack);if(p){if(!(p.track instanceof ci))throw new st(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new st(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(l){const f=i.find(S=>{let{type:v}=S;return v===_t.LocalAudioTrack});if(!(f.track instanceof ci))throw new st(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new st(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(d)}else{if(!r.webAudioMediaStreamDest||d instanceof ci||d._bypassWebAudio)i.push({track:d,type:_t.LocalAudioTrack});else{const f=new ci;f.addAudioTrack(d),i.push({track:f,type:_t.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Rm(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof Mn){const r=this.localTrackMap.get(_t.LocalAudioTrack);if(!r)continue;r.track instanceof ci?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([_t.LocalAudioTrack,r]),r.track.close())):e.push([_t.LocalAudioTrack,r])}if(i instanceof En){const r=this.localTrackMap.get(_t.LocalVideoTrack);if(!r)continue;e.push([_t.LocalVideoTrack,r]);const o=this.localTrackMap.get(_t.LocalVideoLowTrack);o&&e.push([_t.LocalVideoLowTrack,o])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case _t.LocalVideoTrack:n.addListener(Bt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _t.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case _t.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof ci?t.trackList.forEach(n=>{n.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Bt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Bt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case _t.LocalVideoTrack:n.off(Bt.GET_STATS,this.handleGetLocalVideoStats),n.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _t.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case _t.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof ci?t.trackList.forEach(e=>{e.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Bt.GET_STATS,this.handleGetLocalAudioStats),e.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Bt.GET_STATS,this.handleGetLocalAudioStats),t.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Mm&&e.addListener(Bt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Um&&e.addListener(Bt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Bt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(xt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(xt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let o,{track:c,type:l}=n;switch(l){case _t.LocalAudioTrack:o=qe.Audio;break;case _t.LocalVideoTrack:o=Ct(r=c._hints).call(r,un.SCREEN_TRACK)?qe.Screen:qe.High;break;case _t.LocalVideoLowTrack:o=qe.Low}return{kind:l===_t.LocalAudioTrack?xt.AUDIO:xt.VIDEO,stream_type:o,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case _t.LocalVideoTrack:i=Ct(n=o._hints).call(n,un.SCREEN_TRACK)?qe.Screen:qe.High;break;case _t.LocalAudioTrack:i=qe.Audio;break;case _t.LocalVideoLowTrack:i=qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:o}=n;this.localTrackMap.set(o,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(qt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),Ct(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await Ni(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Dn.TRACER}).onSuccess(),this.emit(qt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(Ns(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Nm.FIRST_FRAME_DECODED),Wt.firstRemoteFrame(this.store.sessionId,Ei.FIRST_AUDIO_DECODE,yn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(Ns(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&Wt.firstRemoteFrame(this.store.sessionId,Ei.FIRST_AUDIO_RECEIVED,yn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(Ns(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&Wt.firstRemoteFrame(this.store.sessionId,Ei.FIRST_VIDEO_RECEIVED,yn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(qt.ConnectionTypeChange,i),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Yu(n))," -> ").concat(JSON.stringify(Yu(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Yu(n))," -> ").concat(JSON.stringify(Yu(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(qt.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===Sr.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,b.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===Sr.SEND_ONLY?this.restartICE(t):xi(this,qt.RequestP2PRestartICE,{direction:Sr.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(_t.LocalAudioTrack);if(t instanceof Mn&&(n==null?void 0:n.track)instanceof ci)return n.track.isActive||e.push([_t.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return t===o});if(i&&(e.push(i),i[0]===_t.LocalVideoTrack)){const r=this.localTrackMap.get(_t.LocalVideoLowTrack);r&&e.push([_t.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(_t.LocalAudioTrack);if(t instanceof Mn&&(n==null?void 0:n.track)instanceof ci)return n.track.isActive&&e.push([_t.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return t===o});if(i)if(i[0]===_t.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(_t.LocalVideoLowTrack);r&&e.push([_t.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case _t.LocalAudioTrack:i=qe.Audio;break;case _t.LocalVideoTrack:i=Ct(n=o._hints).call(n,un.SCREEN_TRACK)?qe.Screen:qe.High;break;case _t.LocalVideoLowTrack:i=qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:o,ssrcs:c,id:l}]=e;switch(r){case _t.LocalAudioTrack:i=qe.Audio;break;case _t.LocalVideoTrack:i=Ct(n=o._hints).call(n,un.SCREEN_TRACK)?qe.Screen:qe.High;break;case _t.LocalVideoLowTrack:i=qe.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[o,c]=r;n.push([t,{kind:o,id:c}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:o}]=n;switch(r){case xt.VIDEO:return void(i._videoSSRC&&e.push({stream_type:xt.VIDEO,ssrcId:i._videoSSRC}));case xt.AUDIO:return void(i._audioSSRC&&e.push({stream_type:xt.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(_t.LocalVideoTrack),n=this.localTrackMap.get(_t.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new At((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new At((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof Mn){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await cn(this,qt.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(qt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(qt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ni(FI(this.dtlsFailedCount,ri)),this.emit(qt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(_t.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof En)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof En).length>1)throw new st(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Mn).length>1&&(t.some(e=>e instanceof Mn&&e._bypassWebAudio)||!Ue().webAudioMediaStreamDest))throw new st(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof En&&this.pendingLocalTracks.some(n=>n instanceof En))throw new st(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Mn&&this.pendingLocalTracks.some(n=>n instanceof Mn)&&(!Ue().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Mn&&n._bypassWebAudio)))throw new st(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ue().supportDualStreamEncoding,i=Jb(Jb({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():XO(t,i);const o=ln(8,"track-low-"),c=new En(r,Jb(Jb({},n&&{scaleResolutionDownBy:DO(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return c.on(Fh.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,Im.LOW_STREAM)}),c._hints.push(un.LOW_STREAM),t.addListener(Bt.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var r;const o=Array.from(Ns(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===o.uid&&d.type==="video");Wt.firstRemoteVideoDecode(this.store.sessionId,Ei.FIRST_VIDEO_DECODE,yn.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:e,videoheight:n,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const o=await this.recvConnection.getRemoteSSRC(r);return o!==void 0&&o!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new st(L.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new st(L.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new st(L.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new st(L.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new st(L.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new st(L.NOT_SUPPORTED)}async preConnect(t){throw new st(L.NOT_SUPPORTED)}getEstablishParams(){throw new st(L.NOT_SUPPORTED)}async reSubscribe(t){throw new st(L.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new st(L.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===_t.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Im.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ft(bn.prototype,"p2pConnect",[cj],Object.getOwnPropertyDescriptor(bn.prototype,"p2pConnect"),bn.prototype),Ft(bn.prototype,"unpublish",[lj],Object.getOwnPropertyDescriptor(bn.prototype,"unpublish"),bn.prototype),Ft(bn.prototype,"unpublishLowStream",[uj],Object.getOwnPropertyDescriptor(bn.prototype,"unpublishLowStream"),bn.prototype),Ft(bn.prototype,"subscribe",[dj],Object.getOwnPropertyDescriptor(bn.prototype,"subscribe"),bn.prototype),Ft(bn.prototype,"mockSubscribe",[hj],Object.getOwnPropertyDescriptor(bn.prototype,"mockSubscribe"),bn.prototype),Ft(bn.prototype,"unsubscribe",[pj],Object.getOwnPropertyDescriptor(bn.prototype,"unsubscribe"),bn.prototype),Ft(bn.prototype,"muteRemote",[fj],Object.getOwnPropertyDescriptor(bn.prototype,"muteRemote"),bn.prototype),Ft(bn.prototype,"unmuteRemote",[mj],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteRemote"),bn.prototype),Ft(bn.prototype,"hasRemoteMediaWithLock",[_j],Object.getOwnPropertyDescriptor(bn.prototype,"hasRemoteMediaWithLock"),bn.prototype),Ft(bn.prototype,"disconnectForReconnect",[Ej],Object.getOwnPropertyDescriptor(bn.prototype,"disconnectForReconnect"),bn.prototype),Ft(bn.prototype,"remoteMediaSsrcChanged",[gj],Object.getOwnPropertyDescriptor(bn.prototype,"remoteMediaSsrcChanged"),bn.prototype),bn);function Da(t){return function(e,n,i){const r=e[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];switch(t){case Na.SEND_ONLY:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}case Na.RECEIVE_ONLY:{const d=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}default:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n)),p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d(),p()}}}},i}}class ap extends An{constructor(e,n){super(),D(this,"signal",void 0),D(this,"token",void 0),D(this,"tokenTimeout",void 0),D(this,"tokenInterval",void 0),D(this,"_sequence",0),D(this,"userMap",new Map),D(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const i=()=>{this.signal.connectionState===fn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*j("P2P_TOKEN_INTERVAL"))};i()}async send(e,n,i,r,o){var c,l,d;if(this.userMap.size===0)return;const p=Array.from(or(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=(l=r)!==null&&l!==void 0?l:ln(6,""),o=(d=o)!==null&&d!==void 0?d:this._sequence++;const f={_id:r,_type:e,_seq:o,_message:n,token:"".concat(this.token,"_").concat(p)};j("SHOW_P2P_LOG")&&b.debug("send message",f,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(f)).forEach(v=>{this.signal.request(ee.DATA_STREAM,{payload:Hu(this.encoder.encode(v))})});const S=new At((v,y)=>{const P=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),I),this.off("res-@".concat(r),M),this.off(Gm.ABORT,O),b.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),this.userMap.size===0?y(new st(L.INVALID_REMOTE_USER)):y(new st(L.TIMEOUT))},j("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),I=()=>{P&&window.clearTimeout(P),this.off(Gm.ABORT,O),i&&v()},O=()=>{P&&window.clearTimeout(P),this.off("res-@".concat(r,"_ack"),I),this.off("res-@".concat(r),M),y(new st(L.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(Gm.ABORT,O),this.once("res-@".concat(r,"_ack"),I);const M=(W,Q)=>{U=!0,P&&window.clearTimeout(P),this.off("res-@".concat(r,"_ack"),I),this.off(Gm.ABORT,O),W==="success"?v(Q):y(new st(L.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let U=!1;i||(this.once("res-@".concat(r),M),Ni(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{U||b.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(f))}))});try{return await S}catch(v){if(v.code===L.TIMEOUT)return await this.send(e,n,i,r,o);throw v}}onMessage(e){var n;const{_uid:i}=e;let r,o=this.userMap.get(i);if(o)r=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==Wn.CHECK)return;const{token:p}=e;r=new Map,o={uid:i,isStart:!0,token:p,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,o),this.signal.emit(be.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var c;const{id:p,total:f}=e,S=(c=r.get(p))!==null&&c!==void 0?c:[];if(S.push(e),r.has(p)||r.set(p,S),S.length!==f)return;{const v=Cg(S).call(S,(y,P)=>y.index-P.index).map(y=>y.payload).join("");r.delete(p),(e=JSON.parse(v))._uid=i}}const{_type:l,token:d}=e;if(Ct(n=[Wn.ACK,Wn.CHECK]).call(n,l))return l===Wn.CHECK&&this.handleCheckToken(o,d),void this.receiveMessage(e);d==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(e):b.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(o.token,"_").concat(this.token),e)}check(){const e={_id:ln(6,""),token:this.token,_type:Wn.CHECK};j("SHOW_P2P_LOG")&&b.debug("send message",e),this.signal.request(ee.DATA_STREAM,{payload:Hu(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:Wn.ACK,token:this.token};j("SHOW_P2P_LOG")&&b.debug("send message",n),this.signal.request(ee.DATA_STREAM,{payload:Hu(this.encoder.encode(JSON.stringify(n)))})}response(e,n,i){this.send(Wn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(p=>{const{receivedMessagesMap:f,nextExpectedSequenceNumber:S}=p;for(;f.has(S);){const v=f.get(S);f.delete(S),this.receiveMessage(v),p.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:i,_seq:r}=e,o=this.userMap.get(i),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:d}=o;if(r<d)return this.ack(e._id),void b.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));c.set(r,e),l&&r===d&&(this.receiveMessage(e),c.delete(d),o.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:i,_message:r,_uid:o}=e;if(j("SHOW_P2P_LOG")&&b.debug("receive message",e),n){let c;switch(e._type!==Wn.ACK&&(r&&(c=JSON.parse(r)),this.ack(e._id)),e._type){case Wn.CANDIDATE:case Wn.CONTROL:this.signal.emit(i,c,o);break;case Wn.PUBLISH:case Wn.UNPUBLISH:case Wn.RESTART_ICE:case Wn.CALL:c.uid=o,xi(this.signal,i,c).then(l=>{this.response(e._id,l)}).catch(()=>{this.response(e._id,void 0,!0)});break;case Wn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Wn.RESPONSE:{const{success:l,message:d}=c;this.emit("res-@".concat(n),l?"success":"failed",d);break}}}}splitMessage(e){if(e.length<ap.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:i}=JSON.parse(e),r=ln(6,"");let o=0,c=800;const l=Math.ceil(e.length/c);for(;e.length>0;){o++;const d={id:r,index:o,total:l,payload:e.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(d).length>ap.MAX_MESSAGE_SIZE?c-=50:(n.push(d),e=e.slice(c))}return n.map(d=>JSON.stringify(d))}handleCheckToken(e,n){return e.token!==n?(b.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{b.debug("token timeout, ".concat(n)),this.reset(e.uid)},j("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await xi(this.signal,Wn.CALL,void 0),n=await this.send(Wn.CALL,e);this.signal.emit(ne.P2P_CONNECTION,n,!0)}async reset(e,n){const i=this.userMap.get(e);i&&(this.emit(Gm.ABORT),this.signal.emit(be.ON_USER_OFFLINE,{uid:i.uid,reason:Kz.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(b.debug("change local token from ".concat(n," to ").concat(n)),this.token=ln(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Gm.ABORT)}}D(ap,"MAX_SIZE",1),D(ap,"MAX_MESSAGE_SIZE",1024);class R7 extends An{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===fn.CONNECTED?this.emit(ne.WS_CONNECTED):e===fn.RECONNECTING?this.emit(ne.WS_RECONNECTING,this._websocketReconnectReason):e===fn.CLOSED&&this.emit(ne.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),D(this,"_disconnectedReason",void 0),D(this,"_websocketReconnectReason",void 0),D(this,"_connectionState",fn.CLOSED),D(this,"reconnectToken",void 0),D(this,"p2pToken",void 0),D(this,"websocket",void 0),D(this,"openConnectionTime",void 0),D(this,"clientId",void 0),D(this,"lastMsgTime",Date.now()),D(this,"uploadCache",[]),D(this,"uploadCacheInterval",void 0),D(this,"rttRolling",new QM(5)),D(this,"pingpongTimer",void 0),D(this,"pingpongTimeoutCount",0),D(this,"joinResponse",void 0),D(this,"multiIpOption",void 0),D(this,"initError",void 0),D(this,"spec",void 0),D(this,"store",void 0),D(this,"_external_signal",void 0),D(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ne.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const o="res-@".concat(r._id);this.emit(o,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case be.ON_DATA_STREAM:return void this.handleDataStream(r._message);case be.MUTE_AUDIO:case be.MUTE_VIDEO:case be.ON_P2P_LOST:case be.ON_USER_ONLINE:return;case be.ON_USER_OFFLINE:const{uid:o}=r._message;return b.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o)),void this._external_signal.reset(o)}if(this.emit(r._type,r._message),r._type===be.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===be.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(ze.UID_BANNED);break;case 15:this.close(ze.IP_BANNED);break;case 16:this.close(ze.CHANNEL_BANNED)}if(r._type===be.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case Jt.ERR_LICENSE_MISSING:this.close(ze.LICENSE_MISSING);break;case Jt.ERR_LICENSE_EXPIRED:this.close(ze.LICENSE_EXPIRED);break;case Jt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ze.LICENSE_MINUTES_EXCEEDED);break;case Jt.ERR_LICENSE_PERIOD_INVALID:this.close(ze.LICENSE_PERIOD_INVALID);break;case Jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ze.LICENSE_MULTIPLE_SDK_SERVICE);break;case Jt.ERR_LICENSE_ILLEGAL:this.close(ze.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new OO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===fn.CONNECTED&&this.reconnect("retry",Ui.OFFLINE)}),this.p2pToken=ln(6,""),this._external_signal=new ap(this,this.p2pToken)}async request(e,n,i,r){const o=ln(6,""),c={_id:o,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new At((P,I)=>{if(this.connectionState===fn.CONNECTED)return P();const O=()=>{this.off(ne.WS_CLOSED,M),P()},M=()=>{this.off(ne.WS_CONNECTED,O),I(new st(L.WS_ABORT))};this.once(ne.WS_CONNECTED,O),this.once(ne.WS_CLOSED,M)});if(this.connectionState!==fn.CONNECTING&&this.connectionState!==fn.RECONNECTING||e===ee.JOIN||e===ee.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const p=new At((P,I)=>{let O=!1;const M=(W,Q)=>{O=!0,P({isSuccess:W==="success",message:Q||{}}),this.off(ne.WS_CLOSED,U),this.off(ne.WS_RECONNECTING,U),this.emit(ne.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(o),M);const U=()=>{I(new st(L.WS_ABORT,"type: ".concat(e))),this.off(ne.WS_CLOSED,U),this.off(ne.WS_RECONNECTING,U),this.off("res-@".concat(o),M)};this.once(ne.WS_CLOSED,U),this.once(ne.WS_RECONNECTING,U),Ni(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(b.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(ne.REQUEST_TIMEOUT,e,n))})});let f=null;try{f=await p}catch(P){if(this.connectionState===fn.CLOSED||e===ee.LEAVE)throw new st(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?P.throw():e===ee.JOIN||e===ee.REJOIN?null:(await d(),await this.request(e,n))}if(f.isSuccess)return f.message;const S=Number(f.message.error_code||f.message.code),v=Jg(S),y=new st(L.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(f.message.error_str),{code:S,data:f.message,desc:v.desc});return v.action==="success"?f.message:(b.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(S,", message: ").concat(v.desc,", action: ").concat(v.action)),S===Jt.ERR_TOO_MANY_BROADCASTERS?((e===ee.JOIN||e===ee.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(S===Jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,b.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ui.MULTI_IP)):this.reconnect(v.action,Ui.SERVER_ERROR),e===ee.JOIN||e===ee.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new At(i=>{const r=o=>{(!n||n(o))&&(this.off(e,r),i(o))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void b.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(qg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const o=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==fn.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(e,n,i){return await this._external_signal.send(e,n,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new At((n,i)=>{this.once(ne.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ne.WS_CLOSED,()=>i(this.initError||new st(L.WS_ABORT))),this.connectionState=fn.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||ze.LEAVE,this.connectionState=fn.CLOSED,b.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ln(6,""),this._external_signal.clear(),this._external_signal=new ap(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ne.ABORT_P2P_EXECUTION);const e=await xi(this,ne.REQUEST_JOIN_INFO),n=await this.request(ee.JOIN,e);if(!n)return this.emit(ne.REPORT_JOIN_GATEWAY,L.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ne.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=fn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const i=Vh(e.payload),r=new TextDecoder().decode(i),o=JSON.parse(r);"total"in o&&"id"in o||Ct(n=Object.values(Wn)).call(n,o._type)?(o._uid=e.uid,this._external_signal.onMessage(o)):this.emit(be.ON_DATA_STREAM,e)}catch{this.emit(be.ON_DATA_STREAM,e)}}handleNotification(e){b.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Jg(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ze.UID_BANNED),void this.close()):void this.reconnect(n.action,Ui.SERVER_ERROR);b.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=j("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(b.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ui.TIMEOUT):this.request(ee.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),j("REPORT_STATS")&&this.send(ee.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(ae.RECONNECT_CREATE_CONNECTION,e=>{this.emit(ne.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(ae.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ae.CLOSED,()=>{this.connectionState=fn.CLOSED}),this.websocket.on(ae.FAILED,()=>{this._disconnectedReason=ze.NETWORK_ERROR,this.connectionState=fn.CLOSED}),this.websocket.on(ae.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===fn.CONNECTED?this.connectionState=fn.RECONNECTING:this.connectionState=fn.CONNECTING}),this.websocket.on(ae.WILL_RECONNECT,(e,n,i)=>{e!=="retry"?(b.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):b.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(ae.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(ne.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof st&&e.code===L.UNEXPECTED_RESPONSE&&e.data.code===Jt.ERR_NO_AUTHORIZED)return b.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ui.SERVER_ERROR);b.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ui.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(ae.REQUEST_NEW_URLS,(e,n)=>{xi(this,ne.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(ae.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(be.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const b7={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new y7(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new R7(n,e)}};function Tj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function vj(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Tj(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Tj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class C7{constructor(e){D(this,"sessionDesc",void 0),D(this,"localCapabilities",void 0),D(this,"rtpCapabilities",void 0),D(this,"candidates",void 0),D(this,"_originCandidates",void 0),D(this,"iceParameters",void 0),D(this,"dtlsParameters",void 0),D(this,"setup",void 0),D(this,"currentMidIndex",void 0),D(this,"cname",void 0),e=kn(e);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:o,setup:c,localCapabilities:l,sdkCodec:d,cname:p}=e,f=Kr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=o,this.candidates=r,this._originCandidates=kn(r),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=p;for(let S=0;S<f.mediaDescriptions.length;S++){const v=f.mediaDescriptions[S];if(v.attributes.iceUfrag=n.iceUfrag,v.attributes.icePwd=n.icePwd,v.attributes.fingerprints=i.fingerprints,v.attributes.candidates=r,v.attributes.setup=c,v.media.mediaType==="video"){v.media.fmts=o.videoCodecs.map(P=>P.payloadType.toString(10));let y=o.videoCodecs.filter(P=>{var I,O;return(I=P.rtpMap)===null||I===void 0?void 0:Ct(O=I.encodingName.toLowerCase()).call(O,d)});y.length===0&&(y=o.videoCodecs),v.attributes.payloads=y,v.attributes.extmaps=o.videoExtensions}v.media.mediaType==="audio"&&(v.media.fmts=o.audioCodecs.map(y=>y.payloadType.toString(10)),v.attributes.payloads=o.audioCodecs,v.attributes.extmaps=o.audioExtensions),f.mediaDescriptions[S]=this.mungMediaDesc(v)}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return Wu(this.sessionDesc)}send(e,n,i){const{ssrcs:r,ssrcGroups:o}=qh(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(p=>e===xt.VIDEO?p.media.mediaType==="video":p.media.mediaType==="audio"),l=r[0].attributes.label,d=r[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(r),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(o),{id:l,mslabel:d}}batchSend(e){return e.map(n=>{let{kind:i,ssrcMsg:r}=n;return this.send(i,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],r=[],o=[];n.attributes.ssrcs.forEach(c=>{Ct(e).call(e,c.attributes.label||"")?o.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var l;Ct(l=o.map(d=>d.ssrcId)).call(l,c.ssrcIds[0])||r.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=r})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,i){e.forEach((r,o)=>{const c=r._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===c.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],r);this.sessionDesc.mediaDescriptions[l]=d})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(n.forEach(r=>{i.push(vj(vj({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),n.length!==0){switch(e){case nr.TCP_RELAY:this.candidates=i;break;case nr.UDP_TCP_RELAY:case nr.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=kn(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(e,n){const i=kn(e);return zm(i,n),LO(i,n),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,i){const r=this.sessionDesc.mediaDescriptions.find(c=>e===xt.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(r){const c=r.attributes.ssrcs.find(l=>l.attributes.label===n);var o;c&&(c.attributes.label=i,(o=c.attributes.msid)===null||o===void 0||o.replace(n,i))}}mungMediaDesc(e){const n=kn(e);return PO(n),function(i){const r=i.attributes.extmaps.find(o=>fb(o.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var sn;function yj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Qb(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yj(Object(n),!0).forEach(function(i){D(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let A7=(sn=class NS extends Ix{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return Ct(n=Object.keys(HR)).call(n,e)}))]}constructor(e,n){super(e,n),D(this,"store",void 0),D(this,"peerConnection",void 0),D(this,"remoteSDP",void 0),D(this,"initialOffer",void 0),D(this,"statsFilter",void 0),D(this,"useRTX",!1),D(this,"localCapabilities",void 0),D(this,"localCandidateCount",0),D(this,"allCandidatesReceived",!1),D(this,"establishPromise",void 0),D(this,"mutex",void 0),this.store=n,this.mutex=new zi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(NS.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=YI(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Ln()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=qu(e.sdp),i=$g(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,Qb(Qb({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new st(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new C7(Qb(Qb({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new st(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var i=this;return Xs(function*(){const r=yield De(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=e.map(v=>i.peerConnection.addTrack(v._mediaStreamTrack)),c=yield De(i.peerConnection.createOffer()),l=Kr(c.sdp),d=e.map(v=>{const y=v._mediaStreamTrack,P=l.mediaDescriptions.find(I=>I.attributes.mid===y.kind);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return function(I,O,M){const U=I.attributes.ssrcs.filter(Q=>Q.attributes.label===O),W=I.attributes.ssrcGroups;if(U.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(W&&U.length>1){const Q=W.find(X=>X.ssrcIds.indexOf(U[0].ssrcId)!==-1);return Q?[{ssrcId:Q.ssrcIds[0],rtx:M?Q.ssrcIds[1]:void 0}]:[{ssrcId:U[0].ssrcId}]}return[{ssrcId:U[0].ssrcId}]}(P,y.id,i.useRTX)});let p;try{p=yield d}catch(v){throw o.forEach(y=>{Mi()&&y.replaceTrack(null),i.peerConnection.removeTrack(y)}),v}const f=i.mungSendOfferSDP(c.sdp,e);i.remoteSDP.receive(e,n,p);const S=i.remoteSDP.toString();return yield De(i.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield De(i.applySendEncodings(o,e)),yield De(i.peerConnection.setRemoteDescription({type:"answer",sdp:S})),e.map((v,y)=>{const P=v._mediaStreamTrack.id;return{localSSRC:d[y],id:P}})}catch(o){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(o=>{var c;return e.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(o=>{Mi()&&o.replaceTrack(null),this.peerConnection.removeTrack(o)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:o,mslabel:c}=this.remoteSDP.send(e,n,r),l=new At((f,S)=>{const v=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(o)))},1e4),y=P=>{const I=Me();if((I.name==="Safari"&&Number(I.version)===11||_r())&&P.track.id!==o&&P.streams[0].id===c){var O;const M=P.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(e,o,P.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void f(M)}if(P.track.id===o)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void f(P.track)};this.peerConnection.addEventListener("track",y)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await l,id:o}}catch(o){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return e.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(Mi()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(o=>o.active=!1),i.setParameters(r)}})}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(o=>{var c;return e.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async o=>{if(Mi()&&o.track)o.track.enabled=!0;else{const c=o.getParameters();c.encodings.forEach(l=>l.active=!0),await o.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Xs(function*(){const i=yield De(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Ue().supportPCSetConfiguration;if(e===nr.RELAY&&!r)return;if(r){const p=n.peerConnection.getConfiguration(),f=e===nr.RELAY?"relay":"all";p.iceTransportPolicy!==f&&(b.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(f,"]")),p.iceTransportPolicy=f,n.peerConnection.setConfiguration(p))}e!==nr.RELAY&&n.remoteSDP.updateCandidates(e);const o=yield De(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=qu(o.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const d=n.remoteSDP.toString();yield De(n.peerConnection.setLocalDescription(o)),yield De(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(r){b.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new st(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getSenders().filter(r=>{var o;return((o=r.track)===null||o===void 0?void 0:o.id)===e});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getSenders().find(r=>{var o;return((o=r.track)===null||o===void 0?void 0:o.id)===n});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new st(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new st(L.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(jg(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...NS.turnServerConfigToIceServers(e.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...NS.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(p=>{var f;return((f=p.track)===null||f===void 0?void 0:f.id)===e._mediaStreamTrack.id})),!n)return b.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!Ue().supportSetRtpSenderParameters)return b.warn("Browser not support set rtp-sender parameters");const r={},o={};if(e instanceof En)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(j("DSCP_TYPE")&&Al()){var c;const p=j("DSCP_TYPE");Ct(c=["very-low","low","medium","high"]).call(c,p)&&(o.networkPriority=p)}const l=n.getParameters(),d=(i=l.encodings)===null||i===void 0?void 0:i[0];d&&Object.assign(d,o),Object.assign(l,r),b.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(e,n){try{if(!Ue().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],o=n[i];r&&o&&await this.updateRtpSenderEncodings(o,r)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const i=Kr(e);return n.forEach((r,o)=>{const c=r._mediaStreamTrack,l=i.mediaDescriptions.find(d=>d.attributes.mid===c.kind);l&&zm(l,r)}),Wu(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((o,c)=>{let{id:l,mslabel:d}=o;const{kind:p}=e[c];return new At((f,S)=>{const v=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(l)))},1e4),y=P=>{const I=Me();if(I.name==="Safari"&&Number(I.version)===11&&P.track.id!==l&&P.streams[0].id===d){var O;const M=P.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(p,l,P.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void f({track:M,id:l})}if(P.track.id===l)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void f({track:P.track,id:l})};this.peerConnection.addEventListener("track",y)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await At.all(n)}catch(n){throw new st(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(Ue().supportPCSetConfiguration){const n=NS.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Ft(sn.prototype,"connect",[io],Object.getOwnPropertyDescriptor(sn.prototype,"connect"),sn.prototype),Ft(sn.prototype,"stopSending",[io],Object.getOwnPropertyDescriptor(sn.prototype,"stopSending"),sn.prototype),Ft(sn.prototype,"receive",[io],Object.getOwnPropertyDescriptor(sn.prototype,"receive"),sn.prototype),Ft(sn.prototype,"stopReceiving",[io],Object.getOwnPropertyDescriptor(sn.prototype,"stopReceiving"),sn.prototype),Ft(sn.prototype,"muteRemote",[io],Object.getOwnPropertyDescriptor(sn.prototype,"muteRemote"),sn.prototype),Ft(sn.prototype,"unmuteRemote",[io],Object.getOwnPropertyDescriptor(sn.prototype,"unmuteRemote"),sn.prototype),Ft(sn.prototype,"muteLocal",[io],Object.getOwnPropertyDescriptor(sn.prototype,"muteLocal"),sn.prototype),Ft(sn.prototype,"unmuteLocal",[io],Object.getOwnPropertyDescriptor(sn.prototype,"unmuteLocal"),sn.prototype),Ft(sn.prototype,"close",[io],Object.getOwnPropertyDescriptor(sn.prototype,"close"),sn.prototype),Ft(sn.prototype,"updateEncoderConfig",[io],Object.getOwnPropertyDescriptor(sn.prototype,"updateEncoderConfig"),sn.prototype),Ft(sn.prototype,"updateSendParameters",[io],Object.getOwnPropertyDescriptor(sn.prototype,"updateSendParameters"),sn.prototype),Ft(sn.prototype,"replaceTrack",[io],Object.getOwnPropertyDescriptor(sn.prototype,"replaceTrack"),sn.prototype),Ft(sn.prototype,"getRemoteSSRC",[io],Object.getOwnPropertyDescriptor(sn.prototype,"getRemoteSSRC"),sn.prototype),sn);function io(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,o=await r.lock("Locking from P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{o()}},n}const w7={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new A7(n,e)}};qI(),Je("PROCESS_ID","process-".concat(ln(8,""),"-").concat(ln(4,""),"-").concat(ln(4,""),"-").concat(ln(4,""),"-").concat(ln(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void b.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();b.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(wn,i)){const{value:r,expires:o}=e[i];if(o&&o<=n)return;ba[i]=r,wn[i]=r}})}catch(e){b.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(ba.AREAS)&&ba.AREAS.length>0&&VO(ba.AREAS,!0);const Rj=(t,e,n)=>{b.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),Je(t,e,n)};Xh(Zq,!1),Xh(e7,!1),Xh(UY,!1),Xh(h7,!1),Xh(Xq,!1),Xh(b7,!1),Xh(w7,!1);const si=function(t){const e=new An,n=t,i={getListeners:e.getListeners.bind(e),on:(r,o)=>(function(c,l){c===Oc.SECURITY_POLICY_VIOLATION&&eB(l,!0)}(r,o),e.on.bind(e)(r,o)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return tB(tB({},n),i)}({__TRACK_LIST__:wm,VERSION:Js,BUILD:QI,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Rj,getParameter:j,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(i){let r;return Ue().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(e);if(!n)return t;e.close(),e=null,t=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(e){throw new et(L.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=Wt.reportApiInvoke(null,{name:ii.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Dn.TRACER});let e=!1;try{const o=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;e=!!(o&&c&&l),e&&LI()&&AM(75)&&new o().close()}catch(o){return b.error("check system requirement failed: ",o),!1}let n=!1;const i=Me();i.name===He.CHROME&&Number(i.version)>=58&&(ya.engine.name!=="WebKit"||function(){const o=Me();if(kR()){if(o.os===_i.MAC_OS)return!0;if(o.os===_i.IOS){const c=ya.os.version&&ya.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(i.name===He.FIREFOX&&Number(i.version)>=56||i.name===He.OPERA&&Number(i.version)>=45||i.name===He.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(_r()||xo())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||PM()||Me().name===He.QQ)&&(n=!0),b.debug("checkSystemRequirements, api:",e,"browser",n);const r=e&&n;return t.onSuccess(r),r},getDevices:function(t){return Ms.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Ms.getRecordingDevices(t)},getCameras:function(t){return Ms.getCamerasDevices(t)},getElectronScreenSources:b1,getPlaybackDevices:function(t){return Ms.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=ln(5,"client-"),i=Wt.reportApiInvoke(null,{id:n,name:ii.CREATE_CLIENT,options:[e],tag:Dn.TRACER});try{(function(r){hi(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),hi(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&hi(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Oi(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&jM(r.turnServer),r.httpRetryConfig!==void 0&&BM(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&BM(r.websocketRetryConfig)})(e)}catch(r){throw i.onError(r),r}return(IM(16,0)||OM(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",b.debug("browser not support vp9, force use vp8")),Je("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new xY(Ko(Ko({forceWaitGatewayResponse:!0},e),{},{role:Ct(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=j("CAMERA_CAPTURE_CONFIG"),n=ln(8,"track-cam-"),i=Wt.reportApiInvoke(null,{id:n,tag:Dn.TRACER,name:ii.CREATE_CAM_VIDEO_TRACK,options:[Rn({},t),e]});e&&(t.encoderConfig=e);const r=XR(t);let o=null;b.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{o=(await ks({video:r},n)).getVideoTracks()[0]||null}catch(l){throw i.onError(l),l}if(!o){const l=new st(L.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(l),l.throw(b)}t.optimizationMode&&fO(n,o,t,Ac(t.encoderConfig));const c=new pO(o,t,r,t.scalabiltyMode?KR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return i.onSuccess(c.getTrackId()),b.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(t){const e=ln(8,"track-cus-"),n=Wt.reportApiInvoke(null,{id:e,tag:Dn.TRACER,name:ii.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),i=new En(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?KR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[un.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),b.info("create custom video track success with config",t,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(v){return k1(v)}(e):void 0;n&&(e="auto");const i=ln(8,"track-scr-v-"),r=Wt.reportApiInvoke(null,{id:i,tag:Dn.TRACER,name:ii.CREATE_SCREEN_VIDEO_TRACK,options:[Rn({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const o=function(v){const y={};v.screenSourceType&&(y.mediaSource=v.screenSourceType),v.extensionId&&Cl()&&(y.extensionId=v.extensionId);const{displaySurface:P,selfBrowserSurface:I,surfaceSwitching:O,systemAudio:M,preferCurrentTab:U}=v;(Tm(107)||NI(107)||DI(93))&&(P&&(hi(P,"displaySurface",["browser","window","monitor"]),y.displaySurface=P),I?(hi(I,"selfBrowserSurface",["exclude","include"]),y.selfBrowserSurface=I):y.selfBrowserSurface="include",O&&(hi(O,"surfaceSwitching",["exclude","include"]),y.surfaceSwitching=O)),(Tm(105)||NI(105)||DI(91))&&M&&(hi(M,"systemAudio",["exclude","include"]),y.systemAudio=M),(Tm(94)||NI(94)||DI(80))&&U&&(y.preferCurrentTab=!0),v.electronScreenSourceId&&(y.sourceId=v.electronScreenSourceId);const W=v.encoderConfig?nO(v.encoderConfig):null;return y.mandatory={chromeMediaSource:"desktop",maxWidth:W?W.width:void 0,maxHeight:W?W.height:void 0},W&&(W.frameRate&&(typeof W.frameRate=="number"?(y.mandatory.maxFrameRate=W.frameRate,y.mandatory.minFrameRate=W.frameRate):(y.mandatory.maxFrameRate=W.frameRate.max||W.frameRate.ideal||W.frameRate.exact||void 0,y.mandatory.minFrameRate=W.frameRate.min||W.frameRate.ideal||W.frameRate.exact||void 0),y.frameRate=W.frameRate),W.width&&(y.width=W.width),W.height&&(y.height=W.height)),y}(t);let c=null,l=null;const d=Ue();if(!d.supportShareAudio&&e==="enable"){const v=new st(L.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(v),v.throw(b)}b.info("start create screen video track with config",t,"withAudio",e,"trackId",i);const p=d.supportShareAudio&&e!=="disable";try{const v=await ks({screen:o,screenAudio:p?n||!0:void 0},i);c=v.getVideoTracks()[0]||null,l=v.getAudioTracks()[0]||null}catch(v){throw r.onError(v),v}if(!c){const v=new st(L.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(v),v.throw(b)}if(!l&&e==="enable"){c&&c.stop();const v=new st(L.SHARE_AUDIO_NOT_ALLOWED);return r.onError(v),v.throw(b)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(fO(i,c,t,t.encoderConfig&&nO(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const f=new En(c,t.encoderConfig?nO(t.encoderConfig):{},t.scalabiltyMode?KR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[un.SCREEN_TRACK]);if(!l)return r.onSuccess(f.getTrackId()),b.info("create screen video track success","video:",f.getTrackId()),f;const S=new Mn(l,void 0,ln(8,"track-scr-a-"),!1);return r.onSuccess([f.getTrackId(),S.getTrackId()]),b.info("create screen video track success","video:",f.getTrackId(),"audio:",S.getTrackId()),[f,S]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=j("CAMERA_CAPTURE_CONFIG"),i=ln(8,"track-mic-"),r=ln(8,"track-cam-"),o=Wt.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:Dn.TRACER,name:ii.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const c=XR(e),l=M1(t);let d=null,p=null;b.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const v=await ks({audio:l,video:c},"".concat(i,"-").concat(r));d=v.getAudioTracks()[0],p=v.getVideoTracks()[0]}catch(v){throw o.onError(v),v}if(!d||!p){const v=new st(L.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(v),v.throw(b)}e.optimizationMode&&fO(r,p,e,Ac(e.encoderConfig));const f=new JR(d,t,l,i),S=new pO(p,e,c,e.scalabiltyMode?KR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return o.onSuccess([f.getTrackId(),S.getTrackId()]),b.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[f,S]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=ln(8,"track-mic-"),n=Wt.reportApiInvoke(null,{id:e,tag:Dn.TRACER,name:ii.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=M1(t);let r=null;b.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{r=(await ks({audio:i},e)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!r){const c=new st(L.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(b)}const o=new JR(r,t,i,e);return n.onSuccess(o.getTrackId()),b.info("create microphone audio track success, trackId:",e),o},createCustomAudioTrack:function(t){const e=ln(8,"track-cus-"),n=Wt.reportApiInvoke(null,{id:e,tag:Dn.TRACER,name:ii.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),i=new Mn(t.mediaStreamTrack,t.encoderConfig?zR(t.encoderConfig):{},e,!1);return b.info("create custom audio track success with config",t,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:r}=t;const o={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":r,cacheOnlineFile:n,encoderConfig:i},c=ln(8,"track-buf-"),l=Wt.reportApiInvoke(null,{id:c,tag:Dn.TRACER,name:ii.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(j("DISABLE_WEBAUDIO"))throw new st(L.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");b.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",c);const d=r;if(!(r instanceof AudioBuffer))try{r=await async function(S,v){let y=null;if(typeof S=="string"){const I=vU.get(S);if(I)return b.debug("use cached audio resource: ",S),I;try{y=(await Ra(()=>Or.get(S,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(O){throw new st(L.FETCH_AUDIO_FILE_FAILED,O.toString())}}else y=await new At((O,M)=>{const U=new FileReader;U.onload=W=>{W.target?O(W.target.result):M(new st(L.READ_LOCAL_AUDIO_FILE_ERROR))},U.onerror=()=>{M(new st(L.READ_LOCAL_AUDIO_FILE_ERROR))},U.readAsArrayBuffer(S)});const P=await function(I){const O=Lm();return new At((M,U)=>{O.decodeAudioData(I,W=>{M(W)},W=>{U(new st(L.DECODE_AUDIO_FILE_FAILED,W.toString()))})})}(y);return typeof S=="string"&&v&&vU.set(S,P),P}(r,n)}catch(S){return l.onError(S),S.throw(b)}const p=new nz(r),f=new ez(d,p,i?zR(i):{},c);return b.info("create buffer source audio track success, trackId:",c),l.onSuccess(f.getTrackId()),f},setAppType:function(t){if(b.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw b.debug("Invalid appType"),new et(L.INVALID_PARAMS,"invalid app type",t);Je("APP_TYPE",Math.floor(t))},setLogLevel:function(t){b.setLogLevel(t)},enableLogUpload:function(){j("USE_NEW_LOG")?Je("UPLOAD_LOG",!0):b.enableLogUpload()},disableLogUpload:function(){j("USE_NEW_LOG")?Je("UPLOAD_LOG",!1):b.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new g2},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Wt.reportApiInvoke(null,{tag:Dn.TRACER,name:ii.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof Mn||t instanceof Um)){const d=new et(L.INVALID_TRACK,"the parameter is not a audio track");return n.onError(d),d.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof Mn?t.getTrackLabel():"remote_track",r=t.getVolumeLevel();let o=r,c=r;const l=Date.now();return new At(d=>{const p=setInterval(()=>{const f=t.getVolumeLevel();o=f>o?f:o,c=f<c?f:c;const S=o-c>1e-4,v=Date.now()-l;if(S||v>e){clearInterval(p);const y=S,P={duration:v,deviceLabel:i,maxVolumeLevel:o,result:y};b.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(P))),n.onSuccess(P),d(y)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Wt.reportApiInvoke(null,{tag:Dn.TRACER,name:ii.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof En||t instanceof Mm)){const S=new et(L.INVALID_TRACK,"the parameter is not a video track");return n.onError(S),S.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof En?t.getTrackLabel():"remote_track",r=t.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(Mi()||kR())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([r]),o.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,d=0;try{const S=Date.now();l=await function(v,y,P,I){let O,M=0,U=null;return new At((W,Q)=>{function X(){M>I&&O&&(O(),W(M));const Y=P.getContext("2d");if(!Y){const Ot=new et(L.UNEXPECTED_ERROR,"can not get canvas 2d context.");return b.error(Ot.toString()),void Q(Ot)}Y.drawImage(v,0,0,160,120);const ot=Y.getImageData(0,0,P.width,P.height),Et=Math.floor(ot.data.length/3);if(U){for(let Ot=0;Ot<Et;Ot+=3)if(ot.data[Ot]!==U[Ot])return M+=1,void(U=ot.data);U=ot.data}else U=ot.data}setTimeout(()=>{O&&(O(),W(M))},y),O=aO(()=>{X()},30)})}(o,e,c,4),d=Date.now()-S}catch(S){throw n.onError(S),S}RY===He.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const p=l>4,f={duration:d,changedPicNum:l,deviceLabel:i,result:p};return b.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(f))),n.onSuccess(f),p},setArea:VO,audioElementPlayCenter:Nr,resumeAudioContext:function(){Nr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){BY.processExternalMediaAEC(t)},registerExtensions:function(t){const e=j("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!Ct(e).call(e,n.name)&&e.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=b.extLog,i.reporter.hookApiInvoke=Wt.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=j(r)})}),Rj("PLUGIN_INFO",e)},ChannelMediaRelayError:jm,ChannelMediaRelayEvent:Dl,ChannelMediaRelayState:zr,RemoteStreamFallbackType:qK,RemoteStreamType:YK,ConnectionDisconnectedReason:ze,AudienceLatencyLevelType:bK,AREAS:je,preload:async function(t,e,n,i){return K2(t,e,n,i)}});return Object.defineProperties(si,{onAudioAutoplayFailed:{get:()=>Us.onAudioAutoplayFailed,set:t=>{Us.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Us.onAutoplayFailed,set:t=>{Us.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>si._onSecurityPolicyViolation,set(t){si._onSecurityPolicyViolation=t,eB(t)}},__CLIENT_LIST__:{get:()=>j("SHOW_GLOBAL_CLIENT_LIST")?zh:[]}}),Ms.on(Gh.CAMERA_DEVICE_CHANGED,t=>{b.info("camera device changed",JSON.stringify(t)),si.onCameraChanged&&si.onCameraChanged(t),si.safeEmit(Oc.CAMERA_CHANGED,t)}),Ms.on(Gh.RECORDING_DEVICE_CHANGED,t=>{b.info("microphone device changed",JSON.stringify(t)),si.onMicrophoneChanged&&si.onMicrophoneChanged(t),si.safeEmit(Oc.MICROPHONE_CHANGED,t)}),Ms.on(Gh.PLAYOUT_DEVICE_CHANGED,t=>{b.debug("playout device changed",JSON.stringify(t)),si.onPlaybackDeviceChanged&&si.onPlaybackDeviceChanged(t),si.safeEmit(Oc.PLAYBACK_DEVICE_CHANGED,t)}),Nr.onAutoplayFailed=()=>{b.info("detect audio element autoplay failed"),Us.onAudioAutoplayFailed&&Us.onAudioAutoplayFailed()},Qe.on("autoplay-failed",()=>{b.info("detect webaudio autoplay failed"),Us.onAudioAutoplayFailed&&Us.onAudioAutoplayFailed(),si.safeEmit(Oc.AUTOPLAY_FAILED)}),Qe.on(Pi.STATE_CHANGE,(t,e)=>{b.info("audio context state changed: ".concat(e," => ").concat(t)),si.onAudioContextStateChanged&&si.onAudioContextStateChanged(t,e),si.safeEmit(Oc.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),Xn.on(ym.NETWORK_STATE_CHANGE,(t,e)=>{b.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=si),si})}(aC)),aC.exports}var j9=B9();const DS=MN(j9);var uN=(h=>(h.AGENT="agent",h.USER="user",h))(uN||{}),l3=(h=>(h.TEXT="text",h.IMAGE="image",h))(l3||{});class F9{constructor(){jl(this,"_eventMap",new Map)}once(_,E){const g=(...R)=>{this.off(_,g),E(...R)};return this.on(_,g),this}on(_,E){const g=this._eventMap.get(_)??[];return g.push(E),this._eventMap.set(_,g),this}off(_,E){const g=this._eventMap.get(_);return g&&this._eventMap.set(_,g.filter(R=>R!==E)),this}removeAllEventListeners(){this._eventMap.clear()}emit(_,...E){const g=this._eventMap.get(_)??[];for(const R of g)try{R&&R(...E)}catch(w){const N=w,k=N.stack||N.message;console.error(`[event] handling event ${_.toString()} fail: ${k}`)}return this}}var dN=(h=>(h.CAMERA="camera",h.SCREEN="screen",h))(dN||{});const G9=window.location.protocol,H9=window.location.host,W9=window.location.pathname,K9=W9.split("/").filter(Boolean);K9.slice(0,1).join("/");const wC=`${G9}//${H9}`;function u3(h,_){return function(){return h.apply(_,arguments)}}const{toString:z9}=Object.prototype,{getPrototypeOf:VN}=Object,IC=(h=>_=>{const E=z9.call(_);return h[E]||(h[E]=E.slice(8,-1).toLowerCase())})(Object.create(null)),xa=h=>(h=h.toLowerCase(),_=>IC(_)===h),OC=h=>_=>typeof _===h,{isArray:g_}=Array,MS=OC("undefined");function Y9(h){return h!==null&&!MS(h)&&h.constructor!==null&&!MS(h.constructor)&&oo(h.constructor.isBuffer)&&h.constructor.isBuffer(h)}const d3=xa("ArrayBuffer");function q9(h){let _;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?_=ArrayBuffer.isView(h):_=h&&h.buffer&&d3(h.buffer),_}const X9=OC("string"),oo=OC("function"),h3=OC("number"),NC=h=>h!==null&&typeof h=="object",J9=h=>h===!0||h===!1,cC=h=>{if(IC(h)!=="object")return!1;const _=VN(h);return(_===null||_===Object.prototype||Object.getPrototypeOf(_)===null)&&!(Symbol.toStringTag in h)&&!(Symbol.iterator in h)},Q9=xa("Date"),Z9=xa("File"),$9=xa("Blob"),tX=xa("FileList"),eX=h=>NC(h)&&oo(h.pipe),nX=h=>{let _;return h&&(typeof FormData=="function"&&h instanceof FormData||oo(h.append)&&((_=IC(h))==="formdata"||_==="object"&&oo(h.toString)&&h.toString()==="[object FormData]"))},iX=xa("URLSearchParams"),[rX,sX,oX,aX]=["ReadableStream","Request","Response","Headers"].map(xa),cX=h=>h.trim?h.trim():h.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function FS(h,_,{allOwnKeys:E=!1}={}){if(h===null||typeof h>"u")return;let g,R;if(typeof h!="object"&&(h=[h]),g_(h))for(g=0,R=h.length;g<R;g++)_.call(null,h[g],g,h);else{const w=E?Object.getOwnPropertyNames(h):Object.keys(h),N=w.length;let k;for(g=0;g<N;g++)k=w[g],_.call(null,h[k],k,h)}}function p3(h,_){_=_.toLowerCase();const E=Object.keys(h);let g=E.length,R;for(;g-- >0;)if(R=E[g],_===R.toLowerCase())return R;return null}const pp=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,f3=h=>!MS(h)&&h!==pp;function hN(){const{caseless:h}=f3(this)&&this||{},_={},E=(g,R)=>{const w=h&&p3(_,R)||R;cC(_[w])&&cC(g)?_[w]=hN(_[w],g):cC(g)?_[w]=hN({},g):g_(g)?_[w]=g.slice():_[w]=g};for(let g=0,R=arguments.length;g<R;g++)arguments[g]&&FS(arguments[g],E);return _}const lX=(h,_,E,{allOwnKeys:g}={})=>(FS(_,(R,w)=>{E&&oo(R)?h[w]=u3(R,E):h[w]=R},{allOwnKeys:g}),h),uX=h=>(h.charCodeAt(0)===65279&&(h=h.slice(1)),h),dX=(h,_,E,g)=>{h.prototype=Object.create(_.prototype,g),h.prototype.constructor=h,Object.defineProperty(h,"super",{value:_.prototype}),E&&Object.assign(h.prototype,E)},hX=(h,_,E,g)=>{let R,w,N;const k={};if(_=_||{},h==null)return _;do{for(R=Object.getOwnPropertyNames(h),w=R.length;w-- >0;)N=R[w],(!g||g(N,h,_))&&!k[N]&&(_[N]=h[N],k[N]=!0);h=E!==!1&&VN(h)}while(h&&(!E||E(h,_))&&h!==Object.prototype);return _},pX=(h,_,E)=>{h=String(h),(E===void 0||E>h.length)&&(E=h.length),E-=_.length;const g=h.indexOf(_,E);return g!==-1&&g===E},fX=h=>{if(!h)return null;if(g_(h))return h;let _=h.length;if(!h3(_))return null;const E=new Array(_);for(;_-- >0;)E[_]=h[_];return E},mX=(h=>_=>h&&_ instanceof h)(typeof Uint8Array<"u"&&VN(Uint8Array)),_X=(h,_)=>{const g=(h&&h[Symbol.iterator]).call(h);let R;for(;(R=g.next())&&!R.done;){const w=R.value;_.call(h,w[0],w[1])}},EX=(h,_)=>{let E;const g=[];for(;(E=h.exec(_))!==null;)g.push(E);return g},gX=xa("HTMLFormElement"),SX=h=>h.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(E,g,R){return g.toUpperCase()+R}),Gj=(({hasOwnProperty:h})=>(_,E)=>h.call(_,E))(Object.prototype),TX=xa("RegExp"),m3=(h,_)=>{const E=Object.getOwnPropertyDescriptors(h),g={};FS(E,(R,w)=>{let N;(N=_(R,w,h))!==!1&&(g[w]=N||R)}),Object.defineProperties(h,g)},vX=h=>{m3(h,(_,E)=>{if(oo(h)&&["arguments","caller","callee"].indexOf(E)!==-1)return!1;const g=h[E];if(oo(g)){if(_.enumerable=!1,"writable"in _){_.writable=!1;return}_.set||(_.set=()=>{throw Error("Can not rewrite read-only method '"+E+"'")})}})},yX=(h,_)=>{const E={},g=R=>{R.forEach(w=>{E[w]=!0})};return g_(h)?g(h):g(String(h).split(_)),E},RX=()=>{},bX=(h,_)=>h!=null&&Number.isFinite(h=+h)?h:_,j0="abcdefghijklmnopqrstuvwxyz",Hj="0123456789",_3={DIGIT:Hj,ALPHA:j0,ALPHA_DIGIT:j0+j0.toUpperCase()+Hj},CX=(h=16,_=_3.ALPHA_DIGIT)=>{let E="";const{length:g}=_;for(;h--;)E+=_[Math.random()*g|0];return E};function AX(h){return!!(h&&oo(h.append)&&h[Symbol.toStringTag]==="FormData"&&h[Symbol.iterator])}const wX=h=>{const _=new Array(10),E=(g,R)=>{if(NC(g)){if(_.indexOf(g)>=0)return;if(!("toJSON"in g)){_[R]=g;const w=g_(g)?[]:{};return FS(g,(N,k)=>{const B=E(N,R+1);!MS(B)&&(w[k]=B)}),_[R]=void 0,w}}return g};return E(h,0)},IX=xa("AsyncFunction"),OX=h=>h&&(NC(h)||oo(h))&&oo(h.then)&&oo(h.catch),E3=((h,_)=>h?setImmediate:_?((E,g)=>(pp.addEventListener("message",({source:R,data:w})=>{R===pp&&w===E&&g.length&&g.shift()()},!1),R=>{g.push(R),pp.postMessage(E,"*")}))(`axios@${Math.random()}`,[]):E=>setTimeout(E))(typeof setImmediate=="function",oo(pp.postMessage)),NX=typeof queueMicrotask<"u"?queueMicrotask.bind(pp):typeof process<"u"&&process.nextTick||E3,It={isArray:g_,isArrayBuffer:d3,isBuffer:Y9,isFormData:nX,isArrayBufferView:q9,isString:X9,isNumber:h3,isBoolean:J9,isObject:NC,isPlainObject:cC,isReadableStream:rX,isRequest:sX,isResponse:oX,isHeaders:aX,isUndefined:MS,isDate:Q9,isFile:Z9,isBlob:$9,isRegExp:TX,isFunction:oo,isStream:eX,isURLSearchParams:iX,isTypedArray:mX,isFileList:tX,forEach:FS,merge:hN,extend:lX,trim:cX,stripBOM:uX,inherits:dX,toFlatObject:hX,kindOf:IC,kindOfTest:xa,endsWith:pX,toArray:fX,forEachEntry:_X,matchAll:EX,isHTMLForm:gX,hasOwnProperty:Gj,hasOwnProp:Gj,reduceDescriptors:m3,freezeMethods:vX,toObjectSet:yX,toCamelCase:SX,noop:RX,toFiniteNumber:bX,findKey:p3,global:pp,isContextDefined:f3,ALPHABET:_3,generateString:CX,isSpecCompliantForm:AX,toJSONObject:wX,isAsyncFn:IX,isThenable:OX,setImmediate:E3,asap:NX};function en(h,_,E,g,R){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=h,this.name="AxiosError",_&&(this.code=_),E&&(this.config=E),g&&(this.request=g),R&&(this.response=R,this.status=R.status?R.status:null)}It.inherits(en,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:It.toJSONObject(this.config),code:this.code,status:this.status}}});const g3=en.prototype,S3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(h=>{S3[h]={value:h}});Object.defineProperties(en,S3);Object.defineProperty(g3,"isAxiosError",{value:!0});en.from=(h,_,E,g,R,w)=>{const N=Object.create(g3);return It.toFlatObject(h,N,function(B){return B!==Error.prototype},k=>k!=="isAxiosError"),en.call(N,h.message,_,E,g,R),N.cause=h,N.name=h.name,w&&Object.assign(N,w),N};const DX=null;function pN(h){return It.isPlainObject(h)||It.isArray(h)}function T3(h){return It.endsWith(h,"[]")?h.slice(0,-2):h}function Wj(h,_,E){return h?h.concat(_).map(function(R,w){return R=T3(R),!E&&w?"["+R+"]":R}).join(E?".":""):_}function PX(h){return It.isArray(h)&&!h.some(pN)}const LX=It.toFlatObject(It,{},null,function(_){return/^is[A-Z]/.test(_)});function DC(h,_,E){if(!It.isObject(h))throw new TypeError("target must be an object");_=_||new FormData,E=It.toFlatObject(E,{metaTokens:!0,dots:!1,indexes:!1},!1,function(q,it){return!It.isUndefined(it[q])});const g=E.metaTokens,R=E.visitor||G,w=E.dots,N=E.indexes,B=(E.Blob||typeof Blob<"u"&&Blob)&&It.isSpecCompliantForm(_);if(!It.isFunction(R))throw new TypeError("visitor must be a function");function V(J){if(J===null)return"";if(It.isDate(J))return J.toISOString();if(!B&&It.isBlob(J))throw new en("Blob is not supported. Use a Buffer instead.");return It.isArrayBuffer(J)||It.isTypedArray(J)?B&&typeof Blob=="function"?new Blob([J]):Buffer.from(J):J}function G(J,q,it){let ht=J;if(J&&!it&&typeof J=="object"){if(It.endsWith(q,"{}"))q=g?q:q.slice(0,-2),J=JSON.stringify(J);else if(It.isArray(J)&&PX(J)||(It.isFileList(J)||It.endsWith(q,"[]"))&&(ht=It.toArray(J)))return q=T3(q),ht.forEach(function(lt,bt){!(It.isUndefined(lt)||lt===null)&&_.append(N===!0?Wj([q],bt,w):N===null?q:q+"[]",V(lt))}),!1}return pN(J)?!0:(_.append(Wj(it,q,w),V(J)),!1)}const z=[],nt=Object.assign(LX,{defaultVisitor:G,convertValue:V,isVisitable:pN});function at(J,q){if(!It.isUndefined(J)){if(z.indexOf(J)!==-1)throw Error("Circular reference detected in "+q.join("."));z.push(J),It.forEach(J,function(ht,pt){(!(It.isUndefined(ht)||ht===null)&&R.call(_,ht,It.isString(pt)?pt.trim():pt,q,nt))===!0&&at(ht,q?q.concat(pt):[pt])}),z.pop()}}if(!It.isObject(h))throw new TypeError("data must be an object");return at(h),_}function Kj(h){const _={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(h).replace(/[!'()~]|%20|%00/g,function(g){return _[g]})}function BN(h,_){this._pairs=[],h&&DC(h,this,_)}const v3=BN.prototype;v3.append=function(_,E){this._pairs.push([_,E])};v3.toString=function(_){const E=_?function(g){return _.call(this,g,Kj)}:Kj;return this._pairs.map(function(R){return E(R[0])+"="+E(R[1])},"").join("&")};function kX(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function y3(h,_,E){if(!_)return h;const g=E&&E.encode||kX;It.isFunction(E)&&(E={serialize:E});const R=E&&E.serialize;let w;if(R?w=R(_,E):w=It.isURLSearchParams(_)?_.toString():new BN(_,E).toString(g),w){const N=h.indexOf("#");N!==-1&&(h=h.slice(0,N)),h+=(h.indexOf("?")===-1?"?":"&")+w}return h}class zj{constructor(){this.handlers=[]}use(_,E,g){return this.handlers.push({fulfilled:_,rejected:E,synchronous:g?g.synchronous:!1,runWhen:g?g.runWhen:null}),this.handlers.length-1}eject(_){this.handlers[_]&&(this.handlers[_]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(_){It.forEach(this.handlers,function(g){g!==null&&_(g)})}}const R3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},MX=typeof URLSearchParams<"u"?URLSearchParams:BN,UX=typeof FormData<"u"?FormData:null,xX=typeof Blob<"u"?Blob:null,VX={isBrowser:!0,classes:{URLSearchParams:MX,FormData:UX,Blob:xX},protocols:["http","https","file","blob","url","data"]},jN=typeof window<"u"&&typeof document<"u",fN=typeof navigator=="object"&&navigator||void 0,BX=jN&&(!fN||["ReactNative","NativeScript","NS"].indexOf(fN.product)<0),jX=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",FX=jN&&window.location.href||"http://localhost",GX=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:jN,hasStandardBrowserEnv:BX,hasStandardBrowserWebWorkerEnv:jX,navigator:fN,origin:FX},Symbol.toStringTag,{value:"Module"})),$r={...GX,...VX};function HX(h,_){return DC(h,new $r.classes.URLSearchParams,Object.assign({visitor:function(E,g,R,w){return $r.isNode&&It.isBuffer(E)?(this.append(g,E.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)}},_))}function WX(h){return It.matchAll(/\w+|\[(\w*)]/g,h).map(_=>_[0]==="[]"?"":_[1]||_[0])}function KX(h){const _={},E=Object.keys(h);let g;const R=E.length;let w;for(g=0;g<R;g++)w=E[g],_[w]=h[w];return _}function b3(h){function _(E,g,R,w){let N=E[w++];if(N==="__proto__")return!0;const k=Number.isFinite(+N),B=w>=E.length;return N=!N&&It.isArray(R)?R.length:N,B?(It.hasOwnProp(R,N)?R[N]=[R[N],g]:R[N]=g,!k):((!R[N]||!It.isObject(R[N]))&&(R[N]=[]),_(E,g,R[N],w)&&It.isArray(R[N])&&(R[N]=KX(R[N])),!k)}if(It.isFormData(h)&&It.isFunction(h.entries)){const E={};return It.forEachEntry(h,(g,R)=>{_(WX(g),R,E,0)}),E}return null}function zX(h,_,E){if(It.isString(h))try{return(_||JSON.parse)(h),It.trim(h)}catch(g){if(g.name!=="SyntaxError")throw g}return(E||JSON.stringify)(h)}const GS={transitional:R3,adapter:["xhr","http","fetch"],transformRequest:[function(_,E){const g=E.getContentType()||"",R=g.indexOf("application/json")>-1,w=It.isObject(_);if(w&&It.isHTMLForm(_)&&(_=new FormData(_)),It.isFormData(_))return R?JSON.stringify(b3(_)):_;if(It.isArrayBuffer(_)||It.isBuffer(_)||It.isStream(_)||It.isFile(_)||It.isBlob(_)||It.isReadableStream(_))return _;if(It.isArrayBufferView(_))return _.buffer;if(It.isURLSearchParams(_))return E.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),_.toString();let k;if(w){if(g.indexOf("application/x-www-form-urlencoded")>-1)return HX(_,this.formSerializer).toString();if((k=It.isFileList(_))||g.indexOf("multipart/form-data")>-1){const B=this.env&&this.env.FormData;return DC(k?{"files[]":_}:_,B&&new B,this.formSerializer)}}return w||R?(E.setContentType("application/json",!1),zX(_)):_}],transformResponse:[function(_){const E=this.transitional||GS.transitional,g=E&&E.forcedJSONParsing,R=this.responseType==="json";if(It.isResponse(_)||It.isReadableStream(_))return _;if(_&&It.isString(_)&&(g&&!this.responseType||R)){const N=!(E&&E.silentJSONParsing)&&R;try{return JSON.parse(_)}catch(k){if(N)throw k.name==="SyntaxError"?en.from(k,en.ERR_BAD_RESPONSE,this,null,this.response):k}}return _}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$r.classes.FormData,Blob:$r.classes.Blob},validateStatus:function(_){return _>=200&&_<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};It.forEach(["delete","get","head","post","put","patch"],h=>{GS.headers[h]={}});const YX=It.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),qX=h=>{const _={};let E,g,R;return h&&h.split(`
`).forEach(function(N){R=N.indexOf(":"),E=N.substring(0,R).trim().toLowerCase(),g=N.substring(R+1).trim(),!(!E||_[E]&&YX[E])&&(E==="set-cookie"?_[E]?_[E].push(g):_[E]=[g]:_[E]=_[E]?_[E]+", "+g:g)}),_},Yj=Symbol("internals");function IS(h){return h&&String(h).trim().toLowerCase()}function lC(h){return h===!1||h==null?h:It.isArray(h)?h.map(lC):String(h)}function XX(h){const _=Object.create(null),E=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=E.exec(h);)_[g[1]]=g[2];return _}const JX=h=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(h.trim());function F0(h,_,E,g,R){if(It.isFunction(g))return g.call(this,_,E);if(R&&(_=E),!!It.isString(_)){if(It.isString(g))return _.indexOf(g)!==-1;if(It.isRegExp(g))return g.test(_)}}function QX(h){return h.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(_,E,g)=>E.toUpperCase()+g)}function ZX(h,_){const E=It.toCamelCase(" "+_);["get","set","has"].forEach(g=>{Object.defineProperty(h,g+E,{value:function(R,w,N){return this[g].call(this,_,R,w,N)},configurable:!0})})}let Bs=class{constructor(_){_&&this.set(_)}set(_,E,g){const R=this;function w(k,B,V){const G=IS(B);if(!G)throw new Error("header name must be a non-empty string");const z=It.findKey(R,G);(!z||R[z]===void 0||V===!0||V===void 0&&R[z]!==!1)&&(R[z||B]=lC(k))}const N=(k,B)=>It.forEach(k,(V,G)=>w(V,G,B));if(It.isPlainObject(_)||_ instanceof this.constructor)N(_,E);else if(It.isString(_)&&(_=_.trim())&&!JX(_))N(qX(_),E);else if(It.isHeaders(_))for(const[k,B]of _.entries())w(B,k,g);else _!=null&&w(E,_,g);return this}get(_,E){if(_=IS(_),_){const g=It.findKey(this,_);if(g){const R=this[g];if(!E)return R;if(E===!0)return XX(R);if(It.isFunction(E))return E.call(this,R,g);if(It.isRegExp(E))return E.exec(R);throw new TypeError("parser must be boolean|regexp|function")}}}has(_,E){if(_=IS(_),_){const g=It.findKey(this,_);return!!(g&&this[g]!==void 0&&(!E||F0(this,this[g],g,E)))}return!1}delete(_,E){const g=this;let R=!1;function w(N){if(N=IS(N),N){const k=It.findKey(g,N);k&&(!E||F0(g,g[k],k,E))&&(delete g[k],R=!0)}}return It.isArray(_)?_.forEach(w):w(_),R}clear(_){const E=Object.keys(this);let g=E.length,R=!1;for(;g--;){const w=E[g];(!_||F0(this,this[w],w,_,!0))&&(delete this[w],R=!0)}return R}normalize(_){const E=this,g={};return It.forEach(this,(R,w)=>{const N=It.findKey(g,w);if(N){E[N]=lC(R),delete E[w];return}const k=_?QX(w):String(w).trim();k!==w&&delete E[w],E[k]=lC(R),g[k]=!0}),this}concat(..._){return this.constructor.concat(this,..._)}toJSON(_){const E=Object.create(null);return It.forEach(this,(g,R)=>{g!=null&&g!==!1&&(E[R]=_&&It.isArray(g)?g.join(", "):g)}),E}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([_,E])=>_+": "+E).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(_){return _ instanceof this?_:new this(_)}static concat(_,...E){const g=new this(_);return E.forEach(R=>g.set(R)),g}static accessor(_){const g=(this[Yj]=this[Yj]={accessors:{}}).accessors,R=this.prototype;function w(N){const k=IS(N);g[k]||(ZX(R,N),g[k]=!0)}return It.isArray(_)?_.forEach(w):w(_),this}};Bs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);It.reduceDescriptors(Bs.prototype,({value:h},_)=>{let E=_[0].toUpperCase()+_.slice(1);return{get:()=>h,set(g){this[E]=g}}});It.freezeMethods(Bs);function G0(h,_){const E=this||GS,g=_||E,R=Bs.from(g.headers);let w=g.data;return It.forEach(h,function(k){w=k.call(E,w,R.normalize(),_?_.status:void 0)}),R.normalize(),w}function C3(h){return!!(h&&h.__CANCEL__)}function S_(h,_,E){en.call(this,h??"canceled",en.ERR_CANCELED,_,E),this.name="CanceledError"}It.inherits(S_,en,{__CANCEL__:!0});function A3(h,_,E){const g=E.config.validateStatus;!E.status||!g||g(E.status)?h(E):_(new en("Request failed with status code "+E.status,[en.ERR_BAD_REQUEST,en.ERR_BAD_RESPONSE][Math.floor(E.status/100)-4],E.config,E.request,E))}function $X(h){const _=/^([-+\w]{1,25})(:?\/\/|:)/.exec(h);return _&&_[1]||""}function tJ(h,_){h=h||10;const E=new Array(h),g=new Array(h);let R=0,w=0,N;return _=_!==void 0?_:1e3,function(B){const V=Date.now(),G=g[w];N||(N=V),E[R]=B,g[R]=V;let z=w,nt=0;for(;z!==R;)nt+=E[z++],z=z%h;if(R=(R+1)%h,R===w&&(w=(w+1)%h),V-N<_)return;const at=G&&V-G;return at?Math.round(nt*1e3/at):void 0}}function eJ(h,_){let E=0,g=1e3/_,R,w;const N=(V,G=Date.now())=>{E=G,R=null,w&&(clearTimeout(w),w=null),h.apply(null,V)};return[(...V)=>{const G=Date.now(),z=G-E;z>=g?N(V,G):(R=V,w||(w=setTimeout(()=>{w=null,N(R)},g-z)))},()=>R&&N(R)]}const fC=(h,_,E=3)=>{let g=0;const R=tJ(50,250);return eJ(w=>{const N=w.loaded,k=w.lengthComputable?w.total:void 0,B=N-g,V=R(B),G=N<=k;g=N;const z={loaded:N,total:k,progress:k?N/k:void 0,bytes:B,rate:V||void 0,estimated:V&&k&&G?(k-N)/V:void 0,event:w,lengthComputable:k!=null,[_?"download":"upload"]:!0};h(z)},E)},qj=(h,_)=>{const E=h!=null;return[g=>_[0]({lengthComputable:E,total:h,loaded:g}),_[1]]},Xj=h=>(..._)=>It.asap(()=>h(..._)),nJ=$r.hasStandardBrowserEnv?((h,_)=>E=>(E=new URL(E,$r.origin),h.protocol===E.protocol&&h.host===E.host&&(_||h.port===E.port)))(new URL($r.origin),$r.navigator&&/(msie|trident)/i.test($r.navigator.userAgent)):()=>!0,iJ=$r.hasStandardBrowserEnv?{write(h,_,E,g,R,w){const N=[h+"="+encodeURIComponent(_)];It.isNumber(E)&&N.push("expires="+new Date(E).toGMTString()),It.isString(g)&&N.push("path="+g),It.isString(R)&&N.push("domain="+R),w===!0&&N.push("secure"),document.cookie=N.join("; ")},read(h){const _=document.cookie.match(new RegExp("(^|;\\s*)("+h+")=([^;]*)"));return _?decodeURIComponent(_[3]):null},remove(h){this.write(h,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function rJ(h){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(h)}function sJ(h,_){return _?h.replace(/\/?\/$/,"")+"/"+_.replace(/^\/+/,""):h}function w3(h,_){return h&&!rJ(_)?sJ(h,_):_}const Jj=h=>h instanceof Bs?{...h}:h;function mp(h,_){_=_||{};const E={};function g(V,G,z,nt){return It.isPlainObject(V)&&It.isPlainObject(G)?It.merge.call({caseless:nt},V,G):It.isPlainObject(G)?It.merge({},G):It.isArray(G)?G.slice():G}function R(V,G,z,nt){if(It.isUndefined(G)){if(!It.isUndefined(V))return g(void 0,V,z,nt)}else return g(V,G,z,nt)}function w(V,G){if(!It.isUndefined(G))return g(void 0,G)}function N(V,G){if(It.isUndefined(G)){if(!It.isUndefined(V))return g(void 0,V)}else return g(void 0,G)}function k(V,G,z){if(z in _)return g(V,G);if(z in h)return g(void 0,V)}const B={url:w,method:w,data:w,baseURL:N,transformRequest:N,transformResponse:N,paramsSerializer:N,timeout:N,timeoutMessage:N,withCredentials:N,withXSRFToken:N,adapter:N,responseType:N,xsrfCookieName:N,xsrfHeaderName:N,onUploadProgress:N,onDownloadProgress:N,decompress:N,maxContentLength:N,maxBodyLength:N,beforeRedirect:N,transport:N,httpAgent:N,httpsAgent:N,cancelToken:N,socketPath:N,responseEncoding:N,validateStatus:k,headers:(V,G,z)=>R(Jj(V),Jj(G),z,!0)};return It.forEach(Object.keys(Object.assign({},h,_)),function(G){const z=B[G]||R,nt=z(h[G],_[G],G);It.isUndefined(nt)&&z!==k||(E[G]=nt)}),E}const I3=h=>{const _=mp({},h);let{data:E,withXSRFToken:g,xsrfHeaderName:R,xsrfCookieName:w,headers:N,auth:k}=_;_.headers=N=Bs.from(N),_.url=y3(w3(_.baseURL,_.url),h.params,h.paramsSerializer),k&&N.set("Authorization","Basic "+btoa((k.username||"")+":"+(k.password?unescape(encodeURIComponent(k.password)):"")));let B;if(It.isFormData(E)){if($r.hasStandardBrowserEnv||$r.hasStandardBrowserWebWorkerEnv)N.setContentType(void 0);else if((B=N.getContentType())!==!1){const[V,...G]=B?B.split(";").map(z=>z.trim()).filter(Boolean):[];N.setContentType([V||"multipart/form-data",...G].join("; "))}}if($r.hasStandardBrowserEnv&&(g&&It.isFunction(g)&&(g=g(_)),g||g!==!1&&nJ(_.url))){const V=R&&w&&iJ.read(w);V&&N.set(R,V)}return _},oJ=typeof XMLHttpRequest<"u",aJ=oJ&&function(h){return new Promise(function(E,g){const R=I3(h);let w=R.data;const N=Bs.from(R.headers).normalize();let{responseType:k,onUploadProgress:B,onDownloadProgress:V}=R,G,z,nt,at,J;function q(){at&&at(),J&&J(),R.cancelToken&&R.cancelToken.unsubscribe(G),R.signal&&R.signal.removeEventListener("abort",G)}let it=new XMLHttpRequest;it.open(R.method.toUpperCase(),R.url,!0),it.timeout=R.timeout;function ht(){if(!it)return;const lt=Bs.from("getAllResponseHeaders"in it&&it.getAllResponseHeaders()),Tt={data:!k||k==="text"||k==="json"?it.responseText:it.response,status:it.status,statusText:it.statusText,headers:lt,config:h,request:it};A3(function(Ht){E(Ht),q()},function(Ht){g(Ht),q()},Tt),it=null}"onloadend"in it?it.onloadend=ht:it.onreadystatechange=function(){!it||it.readyState!==4||it.status===0&&!(it.responseURL&&it.responseURL.indexOf("file:")===0)||setTimeout(ht)},it.onabort=function(){it&&(g(new en("Request aborted",en.ECONNABORTED,h,it)),it=null)},it.onerror=function(){g(new en("Network Error",en.ERR_NETWORK,h,it)),it=null},it.ontimeout=function(){let bt=R.timeout?"timeout of "+R.timeout+"ms exceeded":"timeout exceeded";const Tt=R.transitional||R3;R.timeoutErrorMessage&&(bt=R.timeoutErrorMessage),g(new en(bt,Tt.clarifyTimeoutError?en.ETIMEDOUT:en.ECONNABORTED,h,it)),it=null},w===void 0&&N.setContentType(null),"setRequestHeader"in it&&It.forEach(N.toJSON(),function(bt,Tt){it.setRequestHeader(Tt,bt)}),It.isUndefined(R.withCredentials)||(it.withCredentials=!!R.withCredentials),k&&k!=="json"&&(it.responseType=R.responseType),V&&([nt,J]=fC(V,!0),it.addEventListener("progress",nt)),B&&it.upload&&([z,at]=fC(B),it.upload.addEventListener("progress",z),it.upload.addEventListener("loadend",at)),(R.cancelToken||R.signal)&&(G=lt=>{it&&(g(!lt||lt.type?new S_(null,h,it):lt),it.abort(),it=null)},R.cancelToken&&R.cancelToken.subscribe(G),R.signal&&(R.signal.aborted?G():R.signal.addEventListener("abort",G)));const pt=$X(R.url);if(pt&&$r.protocols.indexOf(pt)===-1){g(new en("Unsupported protocol "+pt+":",en.ERR_BAD_REQUEST,h));return}it.send(w||null)})},cJ=(h,_)=>{const{length:E}=h=h?h.filter(Boolean):[];if(_||E){let g=new AbortController,R;const w=function(V){if(!R){R=!0,k();const G=V instanceof Error?V:this.reason;g.abort(G instanceof en?G:new S_(G instanceof Error?G.message:G))}};let N=_&&setTimeout(()=>{N=null,w(new en(`timeout ${_} of ms exceeded`,en.ETIMEDOUT))},_);const k=()=>{h&&(N&&clearTimeout(N),N=null,h.forEach(V=>{V.unsubscribe?V.unsubscribe(w):V.removeEventListener("abort",w)}),h=null)};h.forEach(V=>V.addEventListener("abort",w));const{signal:B}=g;return B.unsubscribe=()=>It.asap(k),B}},lJ=function*(h,_){let E=h.byteLength;if(E<_){yield h;return}let g=0,R;for(;g<E;)R=g+_,yield h.slice(g,R),g=R},uJ=async function*(h,_){for await(const E of dJ(h))yield*lJ(E,_)},dJ=async function*(h){if(h[Symbol.asyncIterator]){yield*h;return}const _=h.getReader();try{for(;;){const{done:E,value:g}=await _.read();if(E)break;yield g}}finally{await _.cancel()}},Qj=(h,_,E,g)=>{const R=uJ(h,_);let w=0,N,k=B=>{N||(N=!0,g&&g(B))};return new ReadableStream({async pull(B){try{const{done:V,value:G}=await R.next();if(V){k(),B.close();return}let z=G.byteLength;if(E){let nt=w+=z;E(nt)}B.enqueue(new Uint8Array(G))}catch(V){throw k(V),V}},cancel(B){return k(B),R.return()}},{highWaterMark:2})},PC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",O3=PC&&typeof ReadableStream=="function",hJ=PC&&(typeof TextEncoder=="function"?(h=>_=>h.encode(_))(new TextEncoder):async h=>new Uint8Array(await new Response(h).arrayBuffer())),N3=(h,..._)=>{try{return!!h(..._)}catch{return!1}},pJ=O3&&N3(()=>{let h=!1;const _=new Request($r.origin,{body:new ReadableStream,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type");return h&&!_}),Zj=64*1024,mN=O3&&N3(()=>It.isReadableStream(new Response("").body)),mC={stream:mN&&(h=>h.body)};PC&&(h=>{["text","arrayBuffer","blob","formData","stream"].forEach(_=>{!mC[_]&&(mC[_]=It.isFunction(h[_])?E=>E[_]():(E,g)=>{throw new en(`Response type '${_}' is not supported`,en.ERR_NOT_SUPPORT,g)})})})(new Response);const fJ=async h=>{if(h==null)return 0;if(It.isBlob(h))return h.size;if(It.isSpecCompliantForm(h))return(await new Request($r.origin,{method:"POST",body:h}).arrayBuffer()).byteLength;if(It.isArrayBufferView(h)||It.isArrayBuffer(h))return h.byteLength;if(It.isURLSearchParams(h)&&(h=h+""),It.isString(h))return(await hJ(h)).byteLength},mJ=async(h,_)=>{const E=It.toFiniteNumber(h.getContentLength());return E??fJ(_)},_J=PC&&(async h=>{let{url:_,method:E,data:g,signal:R,cancelToken:w,timeout:N,onDownloadProgress:k,onUploadProgress:B,responseType:V,headers:G,withCredentials:z="same-origin",fetchOptions:nt}=I3(h);V=V?(V+"").toLowerCase():"text";let at=cJ([R,w&&w.toAbortSignal()],N),J;const q=at&&at.unsubscribe&&(()=>{at.unsubscribe()});let it;try{if(B&&pJ&&E!=="get"&&E!=="head"&&(it=await mJ(G,g))!==0){let Tt=new Request(_,{method:"POST",body:g,duplex:"half"}),Yt;if(It.isFormData(g)&&(Yt=Tt.headers.get("content-type"))&&G.setContentType(Yt),Tt.body){const[Ht,re]=qj(it,fC(Xj(B)));g=Qj(Tt.body,Zj,Ht,re)}}It.isString(z)||(z=z?"include":"omit");const ht="credentials"in Request.prototype;J=new Request(_,{...nt,signal:at,method:E.toUpperCase(),headers:G.normalize().toJSON(),body:g,duplex:"half",credentials:ht?z:void 0});let pt=await fetch(J);const lt=mN&&(V==="stream"||V==="response");if(mN&&(k||lt&&q)){const Tt={};["status","statusText","headers"].forEach(Xt=>{Tt[Xt]=pt[Xt]});const Yt=It.toFiniteNumber(pt.headers.get("content-length")),[Ht,re]=k&&qj(Yt,fC(Xj(k),!0))||[];pt=new Response(Qj(pt.body,Zj,Ht,()=>{re&&re(),q&&q()}),Tt)}V=V||"text";let bt=await mC[It.findKey(mC,V)||"text"](pt,h);return!lt&&q&&q(),await new Promise((Tt,Yt)=>{A3(Tt,Yt,{data:bt,headers:Bs.from(pt.headers),status:pt.status,statusText:pt.statusText,config:h,request:J})})}catch(ht){throw q&&q(),ht&&ht.name==="TypeError"&&/fetch/i.test(ht.message)?Object.assign(new en("Network Error",en.ERR_NETWORK,h,J),{cause:ht.cause||ht}):en.from(ht,ht&&ht.code,h,J)}}),_N={http:DX,xhr:aJ,fetch:_J};It.forEach(_N,(h,_)=>{if(h){try{Object.defineProperty(h,"name",{value:_})}catch{}Object.defineProperty(h,"adapterName",{value:_})}});const $j=h=>`- ${h}`,EJ=h=>It.isFunction(h)||h===null||h===!1,D3={getAdapter:h=>{h=It.isArray(h)?h:[h];const{length:_}=h;let E,g;const R={};for(let w=0;w<_;w++){E=h[w];let N;if(g=E,!EJ(E)&&(g=_N[(N=String(E)).toLowerCase()],g===void 0))throw new en(`Unknown adapter '${N}'`);if(g)break;R[N||"#"+w]=g}if(!g){const w=Object.entries(R).map(([k,B])=>`adapter ${k} `+(B===!1?"is not supported by the environment":"is not available in the build"));let N=_?w.length>1?`since :
`+w.map($j).join(`
`):" "+$j(w[0]):"as no adapter specified";throw new en("There is no suitable adapter to dispatch the request "+N,"ERR_NOT_SUPPORT")}return g},adapters:_N};function H0(h){if(h.cancelToken&&h.cancelToken.throwIfRequested(),h.signal&&h.signal.aborted)throw new S_(null,h)}function tF(h){return H0(h),h.headers=Bs.from(h.headers),h.data=G0.call(h,h.transformRequest),["post","put","patch"].indexOf(h.method)!==-1&&h.headers.setContentType("application/x-www-form-urlencoded",!1),D3.getAdapter(h.adapter||GS.adapter)(h).then(function(g){return H0(h),g.data=G0.call(h,h.transformResponse,g),g.headers=Bs.from(g.headers),g},function(g){return C3(g)||(H0(h),g&&g.response&&(g.response.data=G0.call(h,h.transformResponse,g.response),g.response.headers=Bs.from(g.response.headers))),Promise.reject(g)})}const P3="1.7.9",LC={};["object","boolean","number","function","string","symbol"].forEach((h,_)=>{LC[h]=function(g){return typeof g===h||"a"+(_<1?"n ":" ")+h}});const eF={};LC.transitional=function(_,E,g){function R(w,N){return"[Axios v"+P3+"] Transitional option '"+w+"'"+N+(g?". "+g:"")}return(w,N,k)=>{if(_===!1)throw new en(R(N," has been removed"+(E?" in "+E:"")),en.ERR_DEPRECATED);return E&&!eF[N]&&(eF[N]=!0,console.warn(R(N," has been deprecated since v"+E+" and will be removed in the near future"))),_?_(w,N,k):!0}};LC.spelling=function(_){return(E,g)=>(console.warn(`${g} is likely a misspelling of ${_}`),!0)};function gJ(h,_,E){if(typeof h!="object")throw new en("options must be an object",en.ERR_BAD_OPTION_VALUE);const g=Object.keys(h);let R=g.length;for(;R-- >0;){const w=g[R],N=_[w];if(N){const k=h[w],B=k===void 0||N(k,w,h);if(B!==!0)throw new en("option "+w+" must be "+B,en.ERR_BAD_OPTION_VALUE);continue}if(E!==!0)throw new en("Unknown option "+w,en.ERR_BAD_OPTION)}}const uC={assertOptions:gJ,validators:LC},jc=uC.validators;let fp=class{constructor(_){this.defaults=_,this.interceptors={request:new zj,response:new zj}}async request(_,E){try{return await this._request(_,E)}catch(g){if(g instanceof Error){let R={};Error.captureStackTrace?Error.captureStackTrace(R):R=new Error;const w=R.stack?R.stack.replace(/^.+\n/,""):"";try{g.stack?w&&!String(g.stack).endsWith(w.replace(/^.+\n.+\n/,""))&&(g.stack+=`
`+w):g.stack=w}catch{}}throw g}}_request(_,E){typeof _=="string"?(E=E||{},E.url=_):E=_||{},E=mp(this.defaults,E);const{transitional:g,paramsSerializer:R,headers:w}=E;g!==void 0&&uC.assertOptions(g,{silentJSONParsing:jc.transitional(jc.boolean),forcedJSONParsing:jc.transitional(jc.boolean),clarifyTimeoutError:jc.transitional(jc.boolean)},!1),R!=null&&(It.isFunction(R)?E.paramsSerializer={serialize:R}:uC.assertOptions(R,{encode:jc.function,serialize:jc.function},!0)),uC.assertOptions(E,{baseUrl:jc.spelling("baseURL"),withXsrfToken:jc.spelling("withXSRFToken")},!0),E.method=(E.method||this.defaults.method||"get").toLowerCase();let N=w&&It.merge(w.common,w[E.method]);w&&It.forEach(["delete","get","head","post","put","patch","common"],J=>{delete w[J]}),E.headers=Bs.concat(N,w);const k=[];let B=!0;this.interceptors.request.forEach(function(q){typeof q.runWhen=="function"&&q.runWhen(E)===!1||(B=B&&q.synchronous,k.unshift(q.fulfilled,q.rejected))});const V=[];this.interceptors.response.forEach(function(q){V.push(q.fulfilled,q.rejected)});let G,z=0,nt;if(!B){const J=[tF.bind(this),void 0];for(J.unshift.apply(J,k),J.push.apply(J,V),nt=J.length,G=Promise.resolve(E);z<nt;)G=G.then(J[z++],J[z++]);return G}nt=k.length;let at=E;for(z=0;z<nt;){const J=k[z++],q=k[z++];try{at=J(at)}catch(it){q.call(this,it);break}}try{G=tF.call(this,at)}catch(J){return Promise.reject(J)}for(z=0,nt=V.length;z<nt;)G=G.then(V[z++],V[z++]);return G}getUri(_){_=mp(this.defaults,_);const E=w3(_.baseURL,_.url);return y3(E,_.params,_.paramsSerializer)}};It.forEach(["delete","get","head","options"],function(_){fp.prototype[_]=function(E,g){return this.request(mp(g||{},{method:_,url:E,data:(g||{}).data}))}});It.forEach(["post","put","patch"],function(_){function E(g){return function(w,N,k){return this.request(mp(k||{},{method:_,headers:g?{"Content-Type":"multipart/form-data"}:{},url:w,data:N}))}}fp.prototype[_]=E(),fp.prototype[_+"Form"]=E(!0)});let SJ=class L3{constructor(_){if(typeof _!="function")throw new TypeError("executor must be a function.");let E;this.promise=new Promise(function(w){E=w});const g=this;this.promise.then(R=>{if(!g._listeners)return;let w=g._listeners.length;for(;w-- >0;)g._listeners[w](R);g._listeners=null}),this.promise.then=R=>{let w;const N=new Promise(k=>{g.subscribe(k),w=k}).then(R);return N.cancel=function(){g.unsubscribe(w)},N},_(function(w,N,k){g.reason||(g.reason=new S_(w,N,k),E(g.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(_){if(this.reason){_(this.reason);return}this._listeners?this._listeners.push(_):this._listeners=[_]}unsubscribe(_){if(!this._listeners)return;const E=this._listeners.indexOf(_);E!==-1&&this._listeners.splice(E,1)}toAbortSignal(){const _=new AbortController,E=g=>{_.abort(g)};return this.subscribe(E),_.signal.unsubscribe=()=>this.unsubscribe(E),_.signal}static source(){let _;return{token:new L3(function(R){_=R}),cancel:_}}};function TJ(h){return function(E){return h.apply(null,E)}}function vJ(h){return It.isObject(h)&&h.isAxiosError===!0}const EN={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(EN).forEach(([h,_])=>{EN[_]=h});function k3(h){const _=new fp(h),E=u3(fp.prototype.request,_);return It.extend(E,fp.prototype,_,{allOwnKeys:!0}),It.extend(E,_,null,{allOwnKeys:!0}),E.create=function(R){return k3(mp(h,R))},E}const Li=k3(GS);Li.Axios=fp;Li.CanceledError=S_;Li.CancelToken=SJ;Li.isCancel=C3;Li.VERSION=P3;Li.toFormData=DC;Li.AxiosError=en;Li.Cancel=Li.CanceledError;Li.all=function(_){return Promise.all(_)};Li.spread=TJ;Li.isAxiosError=vJ;Li.mergeConfig=mp;Li.AxiosHeaders=Bs;Li.formToJSON=h=>b3(It.isHTMLForm(h)?new FormData(h):h);Li.getAdapter=D3.getAdapter;Li.HttpStatusCode=EN;Li.default=Li;const{Axios:ret,AxiosError:set,CanceledError:oet,isCancel:aet,CancelToken:cet,VERSION:uet,all:det,Cancel:het,isAxiosError:pet,spread:fet,toFormData:met,AxiosHeaders:_et,HttpStatusCode:Eet,formToJSON:get,getAdapter:Tet,mergeConfig:vet}=Li,yJ=async h=>{const _=`${wC}/convoai-token/${h.channel}/${h.userId}`;return(await Li.get(_)).data},RJ=async h=>{const _=`${wC}/convoai/convoai-start`;return(await Li.post(_,h)).data},bJ=async h=>{const _=`${wC}/convoai/convoai-stop`,E={agent_id:h};return(await Li.post(_,E)).data},CJ=5e3;class AJ extends F9{constructor(){super();jl(this,"_joined");jl(this,"client");jl(this,"localTracks");jl(this,"appId",null);jl(this,"token",null);jl(this,"userId",null);jl(this,"messageCache",{});this._joined=!1,this.localTracks={},this.client=DS.createClient({mode:"rtc",codec:"vp8"}),this._listenRtcEvents()}async join({channel:E,userId:g}){var R;if(!this._joined){const w=await yJ({channel:E,userId:g}),{app_id:N,token:k}=w;this.appId=N,this.token=k,this.userId=g,await((R=this.client)==null?void 0:R.join(N,E,k,g)),this._joined=!0}}async createCameraTracks(){try{const E=await DS.createCameraVideoTrack();this.localTracks.videoTrack=E}catch(E){console.error("Failed to create video track",E)}this.emit("localTracksChanged",this.localTracks)}async createMicrophoneAudioTrack(E){try{const g=await DS.createMicrophoneAudioTrack({microphoneId:E.deviceId});this.localTracks.audioTrack=g}catch(g){console.error("Failed to create audio track",g)}this.emit("localTracksChanged",this.localTracks)}async createScreenShareTrack(){try{const E=await DS.createScreenVideoTrack({encoderConfig:{width:1200,height:800,frameRate:5}},"disable");this.localTracks.screenTrack=E}catch(E){console.error("Failed to create screen track",E)}this.emit("localTracksChanged",this.localTracks)}async switchVideoSource(E){var g,R;E===dN.SCREEN?(await this.createScreenShareTrack(),this.localTracks.screenTrack&&(this.client.unpublish(this.localTracks.videoTrack),(g=this.localTracks.videoTrack)==null||g.close(),this.localTracks.videoTrack=void 0,this.client.publish(this.localTracks.screenTrack),this.emit("localTracksChanged",this.localTracks))):E===dN.CAMERA&&(await this.createCameraTracks(),this.localTracks.videoTrack&&(this.client.unpublish(this.localTracks.screenTrack),(R=this.localTracks.screenTrack)==null||R.close(),this.localTracks.screenTrack=void 0,this.client.publish(this.localTracks.videoTrack),this.emit("localTracksChanged",this.localTracks)))}async publish(){const E=[];this.localTracks.videoTrack&&E.push(this.localTracks.videoTrack),this.localTracks.audioTrack&&E.push(this.localTracks.audioTrack),E.length&&await this.client.publish(E)}async destroy(){var E,g,R,w,N;(g=(E=this.localTracks)==null?void 0:E.audioTrack)==null||g.close(),(w=(R=this.localTracks)==null?void 0:R.videoTrack)==null||w.close(),this._joined&&await((N=this.client)==null?void 0:N.leave()),this._resetData()}_listenRtcEvents(){this.client.on("network-quality",E=>{this.emit("networkQuality",E)}),this.client.on("user-published",async(E,g)=>{await this.client.subscribe(E,g),g==="audio"&&this._playAudio(E.audioTrack),this.emit("remoteUserChanged",{userId:E.uid,audioTrack:E.audioTrack,videoTrack:E.videoTrack})}),this.client.on("user-unpublished",async(E,g)=>{await this.client.unsubscribe(E,g),this.emit("remoteUserChanged",{userId:E.uid,audioTrack:E.audioTrack,videoTrack:E.videoTrack})}),this.client.on("stream-message",(E,g)=>{})}handleChunk(E){try{const[g,R,w,N]=E.split("|"),k=parseInt(R,10),B=w==="???"?-1:parseInt(w,10);if(B===-1){console.warn(`Total parts for message ${g} unknown, waiting for further parts.`);return}const V={message_id:g,part_index:k,total_parts:B,content:N};if(this.messageCache[g]||(this.messageCache[g]=[],setTimeout(()=>{var G;((G=this.messageCache[g])==null?void 0:G.length)!==B&&(console.warn(`Incomplete message with ID ${g} discarded`),delete this.messageCache[g])},CJ)),this.messageCache[g].push(V),this.messageCache[g].length===B){const G=this.reconstructMessage(this.messageCache[g]),{stream_id:z,is_final:nt,text:at,text_ts:J,data_type:q}=JSON.parse(atob(G));console.log(`[test] message_id: ${g} stream_id: ${z}, text: ${at}, data_type: ${q}`);const ht={type:Number(z)!=Number(this.userId)?uN.AGENT:uN.USER,time:J,text:at,data_type:l3.TEXT,userId:z,isFinal:nt};at.trim().length>0&&this.emit("textChanged",ht),delete this.messageCache[g]}}catch(g){console.error("Error processing chunk:",g)}}reconstructMessage(E){return E.sort((g,R)=>g.part_index-R.part_index),E.map(g=>g.content).join("")}_playAudio(E){E&&!E.isPlaying&&E.play()}_resetData(){this.localTracks={},this._joined=!1}}const ld=new AJ,wJ=h=>{const _=E=>{let w=1-Math.max(-100,Math.min(-10,E))*-1/100;return w=Math.sqrt(w),w};return h.map(E=>E===-1/0?0:_(E))};var W0={exports:{}},K0={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nF;function IJ(){if(nF)return K0;nF=1;var h=AC();function _(B,V){return B===V&&(B!==0||1/B===1/V)||B!==B&&V!==V}var E=typeof Object.is=="function"?Object.is:_,g=h.useSyncExternalStore,R=h.useRef,w=h.useEffect,N=h.useMemo,k=h.useDebugValue;return K0.useSyncExternalStoreWithSelector=function(B,V,G,z,nt){var at=R(null);if(at.current===null){var J={hasValue:!1,value:null};at.current=J}else J=at.current;at=N(function(){function it(Tt){if(!ht){if(ht=!0,pt=Tt,Tt=z(Tt),nt!==void 0&&J.hasValue){var Yt=J.value;if(nt(Yt,Tt))return lt=Yt}return lt=Tt}if(Yt=lt,E(pt,Tt))return Yt;var Ht=z(Tt);return nt!==void 0&&nt(Yt,Ht)?(pt=Tt,Yt):(pt=Tt,lt=Ht)}var ht=!1,pt,lt,bt=G===void 0?null:G;return[function(){return it(V())},bt===null?void 0:function(){return it(bt())}]},[V,G,z,nt]);var q=g(B,at[0],at[1]);return w(function(){J.hasValue=!0,J.value=q},[q]),k(q),q},K0}var iF;function OJ(){return iF||(iF=1,W0.exports=IJ()),W0.exports}var NJ=OJ();function DJ(h){h()}function PJ(){let h=null,_=null;return{clear(){h=null,_=null},notify(){DJ(()=>{let E=h;for(;E;)E.callback(),E=E.next})},get(){const E=[];let g=h;for(;g;)E.push(g),g=g.next;return E},subscribe(E){let g=!0;const R=_={callback:E,next:null,prev:_};return R.prev?R.prev.next=R:h=R,function(){!g||h===null||(g=!1,R.next?R.next.prev=R.prev:_=R.prev,R.prev?R.prev.next=R.next:h=R.next)}}}}var rF={notify(){},get:()=>[]};function LJ(h,_){let E,g=rF,R=0,w=!1;function N(q){G();const it=g.subscribe(q);let ht=!1;return()=>{ht||(ht=!0,it(),z())}}function k(){g.notify()}function B(){J.onStateChange&&J.onStateChange()}function V(){return w}function G(){R++,E||(E=h.subscribe(B),g=PJ())}function z(){R--,E&&R===0&&(E(),E=void 0,g.clear(),g=rF)}function nt(){w||(w=!0,G())}function at(){w&&(w=!1,z())}const J={addNestedSub:N,notifyNestedSubs:k,handleChangeWrapper:B,isSubscribed:V,trySubscribe:nt,tryUnsubscribe:at,getListeners:()=>g};return J}var kJ=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",MJ=kJ(),UJ=()=>typeof navigator<"u"&&navigator.product==="ReactNative",xJ=UJ(),VJ=()=>MJ||xJ?Z.useLayoutEffect:Z.useEffect,BJ=VJ(),z0=Symbol.for("react-redux-context"),Y0=typeof globalThis<"u"?globalThis:{};function jJ(){if(!Z.createContext)return{};const h=Y0[z0]??(Y0[z0]=new Map);let _=h.get(Z.createContext);return _||(_=Z.createContext(null),h.set(Z.createContext,_)),_}var hd=jJ();function FJ(h){const{children:_,context:E,serverState:g,store:R}=h,w=Z.useMemo(()=>{const B=LJ(R);return{store:R,subscription:B,getServerState:g?()=>g:void 0}},[R,g]),N=Z.useMemo(()=>R.getState(),[R]);BJ(()=>{const{subscription:B}=w;return B.onStateChange=B.notifyNestedSubs,B.trySubscribe(),N!==R.getState()&&B.notifyNestedSubs(),()=>{B.tryUnsubscribe(),B.onStateChange=void 0}},[w,N]);const k=E||hd;return Z.createElement(k.Provider,{value:w},_)}var GJ=FJ;function FN(h=hd){return function(){return Z.useContext(h)}}var M3=FN();function U3(h=hd){const _=h===hd?M3:FN(h),E=()=>{const{store:g}=_();return g};return Object.assign(E,{withTypes:()=>E}),E}var x3=U3();function HJ(h=hd){const _=h===hd?x3:U3(h),E=()=>_().dispatch;return Object.assign(E,{withTypes:()=>E}),E}var WJ=HJ(),KJ=(h,_)=>h===_;function zJ(h=hd){const _=h===hd?M3:FN(h),E=(g,R={})=>{const{equalityFn:w=KJ}=typeof R=="function"?{equalityFn:R}:R,N=_(),{store:k,subscription:B,getServerState:V}=N;Z.useRef(!0);const G=Z.useCallback({[g.name](nt){return g(nt)}}[g.name],[g]),z=NJ.useSyncExternalStoreWithSelector(B.addNestedSub,k.getState,V||k.getState,G,w);return Z.useDebugValue(z),z};return Object.assign(E,{withTypes:()=>E}),E}var YJ=zJ();const V3=WJ.withTypes(),gN=YJ.withTypes();x3.withTypes();const B3=(h,_=5,E=100,g=600)=>{const[R,w]=Z.useState([]);return Z.useEffect(()=>{if(!h)return w(new Array(_).fill(new Float32Array(0)));const N=new AudioContext,k=h instanceof MediaStreamTrack?h:h.getMediaStreamTrack(),B=new MediaStream([k]),V=N.createMediaStreamSource(B),G=N.createAnalyser();G.fftSize=2048,V.connect(G);const z=G.frequencyBinCount,nt=new Float32Array(z),J=setInterval(()=>{G.getFloatFrequencyData(nt);let q=new Float32Array(nt.length);for(let lt=0;lt<nt.length;lt++)q[lt]=nt[lt];q=q.slice(E,g);const it=wJ(q),ht=Math.ceil(it.length/_),pt=[];for(let lt=0;lt<_;lt++)pt.push(it.slice(lt*ht,(lt+1)*ht));w(pt)},10);return()=>{V.disconnect(),clearInterval(J)}},[h,E,g,_]),R};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qJ=h=>h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),j3=(...h)=>h.filter((_,E,g)=>!!_&&_.trim()!==""&&g.indexOf(_)===E).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var XJ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JJ=Z.forwardRef(({color:h="currentColor",size:_=24,strokeWidth:E=2,absoluteStrokeWidth:g,className:R="",children:w,iconNode:N,...k},B)=>Z.createElement("svg",{ref:B,...XJ,width:_,height:_,stroke:h,strokeWidth:g?Number(E)*24/Number(_):E,className:j3("lucide",R),...k},[...N.map(([V,G])=>Z.createElement(V,G)),...Array.isArray(w)?w:[w]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T_=(h,_)=>{const E=Z.forwardRef(({className:g,...R},w)=>Z.createElement(JJ,{ref:w,iconNode:_,className:j3(`lucide-${qJ(h)}`,g),...R}));return E.displayName=`${h}`,E};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QJ=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ZJ=T_("Check",QJ);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $J=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],F3=T_("ChevronDown",$J);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tQ=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],eQ=T_("ChevronUp",tQ);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nQ=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],iQ=T_("LoaderCircle",nQ);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rQ=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],sQ=T_("MicOff",rQ);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oQ=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],aQ=T_("Mic",oQ);function Mr(h){return`Minified Redux error #${h}; visit https://redux.js.org/Errors?code=${h} for the full message or use the non-minified dev environment for full errors. `}var cQ=typeof Symbol=="function"&&Symbol.observable||"@@observable",sF=cQ,q0=()=>Math.random().toString(36).substring(7).split("").join("."),lQ={INIT:`@@redux/INIT${q0()}`,REPLACE:`@@redux/REPLACE${q0()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${q0()}`},_C=lQ;function GN(h){if(typeof h!="object"||h===null)return!1;let _=h;for(;Object.getPrototypeOf(_)!==null;)_=Object.getPrototypeOf(_);return Object.getPrototypeOf(h)===_||Object.getPrototypeOf(h)===null}function G3(h,_,E){if(typeof h!="function")throw new Error(Mr(2));if(typeof _=="function"&&typeof E=="function"||typeof E=="function"&&typeof arguments[3]=="function")throw new Error(Mr(0));if(typeof _=="function"&&typeof E>"u"&&(E=_,_=void 0),typeof E<"u"){if(typeof E!="function")throw new Error(Mr(1));return E(G3)(h,_)}let g=h,R=_,w=new Map,N=w,k=0,B=!1;function V(){N===w&&(N=new Map,w.forEach((it,ht)=>{N.set(ht,it)}))}function G(){if(B)throw new Error(Mr(3));return R}function z(it){if(typeof it!="function")throw new Error(Mr(4));if(B)throw new Error(Mr(5));let ht=!0;V();const pt=k++;return N.set(pt,it),function(){if(ht){if(B)throw new Error(Mr(6));ht=!1,V(),N.delete(pt),w=null}}}function nt(it){if(!GN(it))throw new Error(Mr(7));if(typeof it.type>"u")throw new Error(Mr(8));if(typeof it.type!="string")throw new Error(Mr(17));if(B)throw new Error(Mr(9));try{B=!0,R=g(R,it)}finally{B=!1}return(w=N).forEach(pt=>{pt()}),it}function at(it){if(typeof it!="function")throw new Error(Mr(10));g=it,nt({type:_C.REPLACE})}function J(){const it=z;return{subscribe(ht){if(typeof ht!="object"||ht===null)throw new Error(Mr(11));function pt(){const bt=ht;bt.next&&bt.next(G())}return pt(),{unsubscribe:it(pt)}},[sF](){return this}}}return nt({type:_C.INIT}),{dispatch:nt,subscribe:z,getState:G,replaceReducer:at,[sF]:J}}function uQ(h){Object.keys(h).forEach(_=>{const E=h[_];if(typeof E(void 0,{type:_C.INIT})>"u")throw new Error(Mr(12));if(typeof E(void 0,{type:_C.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Mr(13))})}function dQ(h){const _=Object.keys(h),E={};for(let w=0;w<_.length;w++){const N=_[w];typeof h[N]=="function"&&(E[N]=h[N])}const g=Object.keys(E);let R;try{uQ(E)}catch(w){R=w}return function(N={},k){if(R)throw R;let B=!1;const V={};for(let G=0;G<g.length;G++){const z=g[G],nt=E[z],at=N[z],J=nt(at,k);if(typeof J>"u")throw k&&k.type,new Error(Mr(14));V[z]=J,B=B||J!==at}return B=B||g.length!==Object.keys(N).length,B?V:N}}function EC(...h){return h.length===0?_=>_:h.length===1?h[0]:h.reduce((_,E)=>(...g)=>_(E(...g)))}function hQ(...h){return _=>(E,g)=>{const R=_(E,g);let w=()=>{throw new Error(Mr(15))};const N={getState:R.getState,dispatch:(B,...V)=>w(B,...V)},k=h.map(B=>B(N));return w=EC(...k)(R.dispatch),{...R,dispatch:w}}}function pQ(h){return GN(h)&&"type"in h&&typeof h.type=="string"}var H3=Symbol.for("immer-nothing"),oF=Symbol.for("immer-draftable"),co=Symbol.for("immer-state");function ka(h,..._){throw new Error(`[Immer] minified error nr: ${h}. Full error at: https://bit.ly/3cXEKWf`)}var f_=Object.getPrototypeOf;function _p(h){return!!h&&!!h[co]}function Gl(h){var _;return h?W3(h)||Array.isArray(h)||!!h[oF]||!!((_=h.constructor)!=null&&_[oF])||MC(h)||UC(h):!1}var fQ=Object.prototype.constructor.toString();function W3(h){if(!h||typeof h!="object")return!1;const _=f_(h);if(_===null)return!0;const E=Object.hasOwnProperty.call(_,"constructor")&&_.constructor;return E===Object?!0:typeof E=="function"&&Function.toString.call(E)===fQ}function gC(h,_){kC(h)===0?Reflect.ownKeys(h).forEach(E=>{_(E,h[E],h)}):h.forEach((E,g)=>_(g,E,h))}function kC(h){const _=h[co];return _?_.type_:Array.isArray(h)?1:MC(h)?2:UC(h)?3:0}function SN(h,_){return kC(h)===2?h.has(_):Object.prototype.hasOwnProperty.call(h,_)}function K3(h,_,E){const g=kC(h);g===2?h.set(_,E):g===3?h.add(E):h[_]=E}function mQ(h,_){return h===_?h!==0||1/h===1/_:h!==h&&_!==_}function MC(h){return h instanceof Map}function UC(h){return h instanceof Set}function hp(h){return h.copy_||h.base_}function TN(h,_){if(MC(h))return new Map(h);if(UC(h))return new Set(h);if(Array.isArray(h))return Array.prototype.slice.call(h);const E=W3(h);if(_===!0||_==="class_only"&&!E){const g=Object.getOwnPropertyDescriptors(h);delete g[co];let R=Reflect.ownKeys(g);for(let w=0;w<R.length;w++){const N=R[w],k=g[N];k.writable===!1&&(k.writable=!0,k.configurable=!0),(k.get||k.set)&&(g[N]={configurable:!0,writable:!0,enumerable:k.enumerable,value:h[N]})}return Object.create(f_(h),g)}else{const g=f_(h);if(g!==null&&E)return{...h};const R=Object.create(g);return Object.assign(R,h)}}function HN(h,_=!1){return xC(h)||_p(h)||!Gl(h)||(kC(h)>1&&(h.set=h.add=h.clear=h.delete=_Q),Object.freeze(h),_&&Object.entries(h).forEach(([E,g])=>HN(g,!0))),h}function _Q(){ka(2)}function xC(h){return Object.isFrozen(h)}var EQ={};function Ep(h){const _=EQ[h];return _||ka(0,h),_}var US;function z3(){return US}function gQ(h,_){return{drafts_:[],parent_:h,immer_:_,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function aF(h,_){_&&(Ep("Patches"),h.patches_=[],h.inversePatches_=[],h.patchListener_=_)}function vN(h){yN(h),h.drafts_.forEach(SQ),h.drafts_=null}function yN(h){h===US&&(US=h.parent_)}function cF(h){return US=gQ(US,h)}function SQ(h){const _=h[co];_.type_===0||_.type_===1?_.revoke_():_.revoked_=!0}function lF(h,_){_.unfinalizedDrafts_=_.drafts_.length;const E=_.drafts_[0];return h!==void 0&&h!==E?(E[co].modified_&&(vN(_),ka(4)),Gl(h)&&(h=SC(_,h),_.parent_||TC(_,h)),_.patches_&&Ep("Patches").generateReplacementPatches_(E[co].base_,h,_.patches_,_.inversePatches_)):h=SC(_,E,[]),vN(_),_.patches_&&_.patchListener_(_.patches_,_.inversePatches_),h!==H3?h:void 0}function SC(h,_,E){if(xC(_))return _;const g=_[co];if(!g)return gC(_,(R,w)=>uF(h,g,_,R,w,E)),_;if(g.scope_!==h)return _;if(!g.modified_)return TC(h,g.base_,!0),g.base_;if(!g.finalized_){g.finalized_=!0,g.scope_.unfinalizedDrafts_--;const R=g.copy_;let w=R,N=!1;g.type_===3&&(w=new Set(R),R.clear(),N=!0),gC(w,(k,B)=>uF(h,g,R,k,B,E,N)),TC(h,R,!1),E&&h.patches_&&Ep("Patches").generatePatches_(g,E,h.patches_,h.inversePatches_)}return g.copy_}function uF(h,_,E,g,R,w,N){if(_p(R)){const k=w&&_&&_.type_!==3&&!SN(_.assigned_,g)?w.concat(g):void 0,B=SC(h,R,k);if(K3(E,g,B),_p(B))h.canAutoFreeze_=!1;else return}else N&&E.add(R);if(Gl(R)&&!xC(R)){if(!h.immer_.autoFreeze_&&h.unfinalizedDrafts_<1)return;SC(h,R),(!_||!_.scope_.parent_)&&typeof g!="symbol"&&Object.prototype.propertyIsEnumerable.call(E,g)&&TC(h,R)}}function TC(h,_,E=!1){!h.parent_&&h.immer_.autoFreeze_&&h.canAutoFreeze_&&HN(_,E)}function TQ(h,_){const E=Array.isArray(h),g={type_:E?1:0,scope_:_?_.scope_:z3(),modified_:!1,finalized_:!1,assigned_:{},parent_:_,base_:h,draft_:null,copy_:null,revoke_:null,isManual_:!1};let R=g,w=WN;E&&(R=[g],w=xS);const{revoke:N,proxy:k}=Proxy.revocable(R,w);return g.draft_=k,g.revoke_=N,k}var WN={get(h,_){if(_===co)return h;const E=hp(h);if(!SN(E,_))return vQ(h,E,_);const g=E[_];return h.finalized_||!Gl(g)?g:g===X0(h.base_,_)?(J0(h),h.copy_[_]=bN(g,h)):g},has(h,_){return _ in hp(h)},ownKeys(h){return Reflect.ownKeys(hp(h))},set(h,_,E){const g=Y3(hp(h),_);if(g!=null&&g.set)return g.set.call(h.draft_,E),!0;if(!h.modified_){const R=X0(hp(h),_),w=R==null?void 0:R[co];if(w&&w.base_===E)return h.copy_[_]=E,h.assigned_[_]=!1,!0;if(mQ(E,R)&&(E!==void 0||SN(h.base_,_)))return!0;J0(h),RN(h)}return h.copy_[_]===E&&(E!==void 0||_ in h.copy_)||Number.isNaN(E)&&Number.isNaN(h.copy_[_])||(h.copy_[_]=E,h.assigned_[_]=!0),!0},deleteProperty(h,_){return X0(h.base_,_)!==void 0||_ in h.base_?(h.assigned_[_]=!1,J0(h),RN(h)):delete h.assigned_[_],h.copy_&&delete h.copy_[_],!0},getOwnPropertyDescriptor(h,_){const E=hp(h),g=Reflect.getOwnPropertyDescriptor(E,_);return g&&{writable:!0,configurable:h.type_!==1||_!=="length",enumerable:g.enumerable,value:E[_]}},defineProperty(){ka(11)},getPrototypeOf(h){return f_(h.base_)},setPrototypeOf(){ka(12)}},xS={};gC(WN,(h,_)=>{xS[h]=function(){return arguments[0]=arguments[0][0],_.apply(this,arguments)}});xS.deleteProperty=function(h,_){return xS.set.call(this,h,_,void 0)};xS.set=function(h,_,E){return WN.set.call(this,h[0],_,E,h[0])};function X0(h,_){const E=h[co];return(E?hp(E):h)[_]}function vQ(h,_,E){var R;const g=Y3(_,E);return g?"value"in g?g.value:(R=g.get)==null?void 0:R.call(h.draft_):void 0}function Y3(h,_){if(!(_ in h))return;let E=f_(h);for(;E;){const g=Object.getOwnPropertyDescriptor(E,_);if(g)return g;E=f_(E)}}function RN(h){h.modified_||(h.modified_=!0,h.parent_&&RN(h.parent_))}function J0(h){h.copy_||(h.copy_=TN(h.base_,h.scope_.immer_.useStrictShallowCopy_))}var yQ=class{constructor(h){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(_,E,g)=>{if(typeof _=="function"&&typeof E!="function"){const w=E;E=_;const N=this;return function(B=w,...V){return N.produce(B,G=>E.call(this,G,...V))}}typeof E!="function"&&ka(6),g!==void 0&&typeof g!="function"&&ka(7);let R;if(Gl(_)){const w=cF(this),N=bN(_,void 0);let k=!0;try{R=E(N),k=!1}finally{k?vN(w):yN(w)}return aF(w,g),lF(R,w)}else if(!_||typeof _!="object"){if(R=E(_),R===void 0&&(R=_),R===H3&&(R=void 0),this.autoFreeze_&&HN(R,!0),g){const w=[],N=[];Ep("Patches").generateReplacementPatches_(_,R,w,N),g(w,N)}return R}else ka(1,_)},this.produceWithPatches=(_,E)=>{if(typeof _=="function")return(N,...k)=>this.produceWithPatches(N,B=>_(B,...k));let g,R;return[this.produce(_,E,(N,k)=>{g=N,R=k}),g,R]},typeof(h==null?void 0:h.autoFreeze)=="boolean"&&this.setAutoFreeze(h.autoFreeze),typeof(h==null?void 0:h.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(h.useStrictShallowCopy)}createDraft(h){Gl(h)||ka(8),_p(h)&&(h=RQ(h));const _=cF(this),E=bN(h,void 0);return E[co].isManual_=!0,yN(_),E}finishDraft(h,_){const E=h&&h[co];(!E||!E.isManual_)&&ka(9);const{scope_:g}=E;return aF(g,_),lF(void 0,g)}setAutoFreeze(h){this.autoFreeze_=h}setUseStrictShallowCopy(h){this.useStrictShallowCopy_=h}applyPatches(h,_){let E;for(E=_.length-1;E>=0;E--){const R=_[E];if(R.path.length===0&&R.op==="replace"){h=R.value;break}}E>-1&&(_=_.slice(E+1));const g=Ep("Patches").applyPatches_;return _p(h)?g(h,_):this.produce(h,R=>g(R,_))}};function bN(h,_){const E=MC(h)?Ep("MapSet").proxyMap_(h,_):UC(h)?Ep("MapSet").proxySet_(h,_):TQ(h,_);return(_?_.scope_:z3()).drafts_.push(E),E}function RQ(h){return _p(h)||ka(10,h),q3(h)}function q3(h){if(!Gl(h)||xC(h))return h;const _=h[co];let E;if(_){if(!_.modified_)return _.base_;_.finalized_=!0,E=TN(h,_.scope_.immer_.useStrictShallowCopy_)}else E=TN(h,!0);return gC(E,(g,R)=>{K3(E,g,q3(R))}),_&&(_.finalized_=!1),E}var lo=new yQ,X3=lo.produce;lo.produceWithPatches.bind(lo);lo.setAutoFreeze.bind(lo);lo.setUseStrictShallowCopy.bind(lo);lo.applyPatches.bind(lo);lo.createDraft.bind(lo);lo.finishDraft.bind(lo);function J3(h){return({dispatch:E,getState:g})=>R=>w=>typeof w=="function"?w(E,g,h):R(w)}var bQ=J3(),CQ=J3,AQ=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?EC:EC.apply(null,arguments)};function dF(h,_){function E(...g){if(_){let R=_(...g);if(!R)throw new Error(Fl(0));return{type:h,payload:R.payload,..."meta"in R&&{meta:R.meta},..."error"in R&&{error:R.error}}}return{type:h,payload:g[0]}}return E.toString=()=>`${h}`,E.type=h,E.match=g=>pQ(g)&&g.type===h,E}var Q3=class PS extends Array{constructor(..._){super(..._),Object.setPrototypeOf(this,PS.prototype)}static get[Symbol.species](){return PS}concat(..._){return super.concat.apply(this,_)}prepend(..._){return _.length===1&&Array.isArray(_[0])?new PS(..._[0].concat(this)):new PS(..._.concat(this))}};function hF(h){return Gl(h)?X3(h,()=>{}):h}function pF(h,_,E){return h.has(_)?h.get(_):h.set(_,E(_)).get(_)}function wQ(h){return typeof h=="boolean"}var IQ=()=>function(_){const{thunk:E=!0,immutableCheck:g=!0,serializableCheck:R=!0,actionCreatorCheck:w=!0}=_??{};let N=new Q3;return E&&(wQ(E)?N.push(bQ):N.push(CQ(E.extraArgument))),N},OQ="RTK_autoBatch",fF=h=>_=>{setTimeout(_,h)},NQ=(h={type:"raf"})=>_=>(...E)=>{const g=_(...E);let R=!0,w=!1,N=!1;const k=new Set,B=h.type==="tick"?queueMicrotask:h.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:fF(10):h.type==="callback"?h.queueNotification:fF(h.timeout),V=()=>{N=!1,w&&(w=!1,k.forEach(G=>G()))};return Object.assign({},g,{subscribe(G){const z=()=>R&&G(),nt=g.subscribe(z);return k.add(G),()=>{nt(),k.delete(G)}},dispatch(G){var z;try{return R=!((z=G==null?void 0:G.meta)!=null&&z[OQ]),w=!R,w&&(N||(N=!0,B(V))),g.dispatch(G)}finally{R=!0}}})},DQ=h=>function(E){const{autoBatch:g=!0}=E??{};let R=new Q3(h);return g&&R.push(NQ(typeof g=="object"?g:void 0)),R};function PQ(h){const _=IQ(),{reducer:E=void 0,middleware:g,devTools:R=!0,preloadedState:w=void 0,enhancers:N=void 0}=h||{};let k;if(typeof E=="function")k=E;else if(GN(E))k=dQ(E);else throw new Error(Fl(1));let B;typeof g=="function"?B=g(_):B=_();let V=EC;R&&(V=AQ({trace:!1,...typeof R=="object"&&R}));const G=hQ(...B),z=DQ(G);let nt=typeof N=="function"?N(z):z();const at=V(...nt);return G3(k,w,at)}function Z3(h){const _={},E=[];let g;const R={addCase(w,N){const k=typeof w=="string"?w:w.type;if(!k)throw new Error(Fl(28));if(k in _)throw new Error(Fl(29));return _[k]=N,R},addMatcher(w,N){return E.push({matcher:w,reducer:N}),R},addDefaultCase(w){return g=w,R}};return h(R),[_,E,g]}function LQ(h){return typeof h=="function"}function kQ(h,_){let[E,g,R]=Z3(_),w;if(LQ(h))w=()=>hF(h());else{const k=hF(h);w=()=>k}function N(k=w(),B){let V=[E[B.type],...g.filter(({matcher:G})=>G(B)).map(({reducer:G})=>G)];return V.filter(G=>!!G).length===0&&(V=[R]),V.reduce((G,z)=>{if(z)if(_p(G)){const at=z(G,B);return at===void 0?G:at}else{if(Gl(G))return X3(G,nt=>z(nt,B));{const nt=z(G,B);if(nt===void 0){if(G===null)return G;throw Error("A case reducer on a non-draftable value must not return undefined")}return nt}}return G},k)}return N.getInitialState=w,N}var MQ=Symbol.for("rtk-slice-createasyncthunk");function UQ(h,_){return`${h}/${_}`}function xQ({creators:h}={}){var E;const _=(E=h==null?void 0:h.asyncThunk)==null?void 0:E[MQ];return function(R){const{name:w,reducerPath:N=w}=R;if(!w)throw new Error(Fl(11));const k=(typeof R.reducers=="function"?R.reducers(jQ()):R.reducers)||{},B=Object.keys(k),V={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},G={addCase(lt,bt){const Tt=typeof lt=="string"?lt:lt.type;if(!Tt)throw new Error(Fl(12));if(Tt in V.sliceCaseReducersByType)throw new Error(Fl(13));return V.sliceCaseReducersByType[Tt]=bt,G},addMatcher(lt,bt){return V.sliceMatchers.push({matcher:lt,reducer:bt}),G},exposeAction(lt,bt){return V.actionCreators[lt]=bt,G},exposeCaseReducer(lt,bt){return V.sliceCaseReducersByName[lt]=bt,G}};B.forEach(lt=>{const bt=k[lt],Tt={reducerName:lt,type:UQ(w,lt),createNotation:typeof R.reducers=="function"};GQ(bt)?WQ(Tt,bt,G,_):FQ(Tt,bt,G)});function z(){const[lt={},bt=[],Tt=void 0]=typeof R.extraReducers=="function"?Z3(R.extraReducers):[R.extraReducers],Yt={...lt,...V.sliceCaseReducersByType};return kQ(R.initialState,Ht=>{for(let re in Yt)Ht.addCase(re,Yt[re]);for(let re of V.sliceMatchers)Ht.addMatcher(re.matcher,re.reducer);for(let re of bt)Ht.addMatcher(re.matcher,re.reducer);Tt&&Ht.addDefaultCase(Tt)})}const nt=lt=>lt,at=new Map;let J;function q(lt,bt){return J||(J=z()),J(lt,bt)}function it(){return J||(J=z()),J.getInitialState()}function ht(lt,bt=!1){function Tt(Ht){let re=Ht[lt];return typeof re>"u"&&bt&&(re=it()),re}function Yt(Ht=nt){const re=pF(at,bt,()=>new WeakMap);return pF(re,Ht,()=>{const Xt={};for(const[se,Ve]of Object.entries(R.selectors??{}))Xt[se]=VQ(Ve,Ht,it,bt);return Xt})}return{reducerPath:lt,getSelectors:Yt,get selectors(){return Yt(Tt)},selectSlice:Tt}}const pt={name:w,reducer:q,actions:V.actionCreators,caseReducers:V.sliceCaseReducersByName,getInitialState:it,...ht(N),injectInto(lt,{reducerPath:bt,...Tt}={}){const Yt=bt??N;return lt.inject({reducerPath:Yt,reducer:q},Tt),{...pt,...ht(Yt,!0)}}};return pt}}function VQ(h,_,E,g){function R(w,...N){let k=_(w);return typeof k>"u"&&g&&(k=E()),h(k,...N)}return R.unwrapped=h,R}var BQ=xQ();function jQ(){function h(_,E){return{_reducerDefinitionType:"asyncThunk",payloadCreator:_,...E}}return h.withTypes=()=>h,{reducer(_){return Object.assign({[_.name](...E){return _(...E)}}[_.name],{_reducerDefinitionType:"reducer"})},preparedReducer(_,E){return{_reducerDefinitionType:"reducerWithPrepare",prepare:_,reducer:E}},asyncThunk:h}}function FQ({type:h,reducerName:_,createNotation:E},g,R){let w,N;if("reducer"in g){if(E&&!HQ(g))throw new Error(Fl(17));w=g.reducer,N=g.prepare}else w=g;R.addCase(h,w).exposeCaseReducer(_,w).exposeAction(_,N?dF(h,N):dF(h))}function GQ(h){return h._reducerDefinitionType==="asyncThunk"}function HQ(h){return h._reducerDefinitionType==="reducerWithPrepare"}function WQ({type:h,reducerName:_},E,g,R){if(!R)throw new Error(Fl(18));const{payloadCreator:w,fulfilled:N,pending:k,rejected:B,settled:V,options:G}=E,z=R(h,w,G);g.exposeAction(_,z),N&&g.addCase(z.fulfilled,N),k&&g.addCase(z.pending,k),B&&g.addCase(z.rejected,B),V&&g.addMatcher(z.settled,V),g.exposeCaseReducer(_,{fulfilled:N||eC,pending:k||eC,rejected:B||eC,settled:V||eC})}function eC(){}function Fl(h){return`Minified Redux Toolkit error #${h}; visit https://redux-toolkit.js.org/Errors?code=${h} for the full message or use the non-minified dev environment for full errors. `}const KQ=()=>({agentConnected:!1,selectedMicrophone:{deviceId:"",label:"",value:""}}),$3=BQ({name:"global",initialState:KQ(),reducers:{setAgentConnected:(h,_)=>{h.agentConnected=_.payload},setSelectedMicrophone:(h,_)=>{h.selectedMicrophone=_.payload}}}),{setAgentConnected:zQ,setSelectedMicrophone:mF}=$3.actions,YQ=$3.reducer;function tG(h){const{frequencies:_,gap:E,barWidth:g,minBarHeight:R,maxBarHeight:w,borderRadius:N,className:k}=h,B=_.map(V=>{const G=V.reduce((z,nt)=>z+nt,0);return G<=0?0:Math.sqrt(G/V.length)});return Rt.jsx("div",{className:"flex items-center justify-center h-full",style:{gap:`${E}px`},children:B.map((V,G)=>{const z={height:R+V*(w-R)+"px",borderRadius:N+"px",width:g+"px",transition:"background-color 0.35s ease-out, transform 0.25s ease-out"};return Rt.jsx("span",{className:k,style:z},G)})})}function _F(h,[_,E]){return Math.min(E,Math.max(_,h))}function ir(h,_,{checkForDefaultPrevented:E=!0}={}){return function(R){if(h==null||h(R),E===!1||!R.defaultPrevented)return _==null?void 0:_(R)}}function KN(h,_=[]){let E=[];function g(w,N){const k=Z.createContext(N),B=E.length;E=[...E,N];const V=z=>{var ht;const{scope:nt,children:at,...J}=z,q=((ht=nt==null?void 0:nt[h])==null?void 0:ht[B])||k,it=Z.useMemo(()=>J,Object.values(J));return Rt.jsx(q.Provider,{value:it,children:at})};V.displayName=w+"Provider";function G(z,nt){var q;const at=((q=nt==null?void 0:nt[h])==null?void 0:q[B])||k,J=Z.useContext(at);if(J)return J;if(N!==void 0)return N;throw new Error(`\`${z}\` must be used within \`${w}\``)}return[V,G]}const R=()=>{const w=E.map(N=>Z.createContext(N));return function(k){const B=(k==null?void 0:k[h])||w;return Z.useMemo(()=>({[`__scope${h}`]:{...k,[h]:B}}),[k,B])}};return R.scopeName=h,[g,qQ(R,..._)]}function qQ(...h){const _=h[0];if(h.length===1)return _;const E=()=>{const g=h.map(R=>({useScope:R(),scopeName:R.scopeName}));return function(w){const N=g.reduce((k,{useScope:B,scopeName:V})=>{const z=B(w)[`__scope${V}`];return{...k,...z}},{});return Z.useMemo(()=>({[`__scope${_.scopeName}`]:N}),[N])}};return E.scopeName=_.scopeName,E}function XQ(h){const _=h+"CollectionProvider",[E,g]=KN(_),[R,w]=E(_,{collectionRef:{current:null},itemMap:new Map}),N=at=>{const{scope:J,children:q}=at,it=ud.useRef(null),ht=ud.useRef(new Map).current;return Rt.jsx(R,{scope:J,itemMap:ht,collectionRef:it,children:q})};N.displayName=_;const k=h+"CollectionSlot",B=ud.forwardRef((at,J)=>{const{scope:q,children:it}=at,ht=w(k,q),pt=Ur(J,ht.collectionRef);return Rt.jsx(p_,{ref:pt,children:it})});B.displayName=k;const V=h+"CollectionItemSlot",G="data-radix-collection-item",z=ud.forwardRef((at,J)=>{const{scope:q,children:it,...ht}=at,pt=ud.useRef(null),lt=Ur(J,pt),bt=w(V,q);return ud.useEffect(()=>(bt.itemMap.set(pt,{ref:pt,...ht}),()=>void bt.itemMap.delete(pt))),Rt.jsx(p_,{[G]:"",ref:lt,children:it})});z.displayName=V;function nt(at){const J=w(h+"CollectionConsumer",at);return ud.useCallback(()=>{const it=J.collectionRef.current;if(!it)return[];const ht=Array.from(it.querySelectorAll(`[${G}]`));return Array.from(J.itemMap.values()).sort((bt,Tt)=>ht.indexOf(bt.ref.current)-ht.indexOf(Tt.ref.current))},[J.collectionRef,J.itemMap])}return[{Provider:N,Slot:B,ItemSlot:z},nt,g]}var JQ=Z.createContext(void 0);function QQ(h){const _=Z.useContext(JQ);return h||_||"ltr"}function Hl(h){const _=Z.useRef(h);return Z.useEffect(()=>{_.current=h}),Z.useMemo(()=>(...E)=>{var g;return(g=_.current)==null?void 0:g.call(_,...E)},[])}function ZQ(h,_=globalThis==null?void 0:globalThis.document){const E=Hl(h);Z.useEffect(()=>{const g=R=>{R.key==="Escape"&&E(R)};return _.addEventListener("keydown",g,{capture:!0}),()=>_.removeEventListener("keydown",g,{capture:!0})},[E,_])}var $Q="DismissableLayer",CN="dismissableLayer.update",tZ="dismissableLayer.pointerDownOutside",eZ="dismissableLayer.focusOutside",EF,eG=Z.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),nG=Z.forwardRef((h,_)=>{const{disableOutsidePointerEvents:E=!1,onEscapeKeyDown:g,onPointerDownOutside:R,onFocusOutside:w,onInteractOutside:N,onDismiss:k,...B}=h,V=Z.useContext(eG),[G,z]=Z.useState(null),nt=(G==null?void 0:G.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,at]=Z.useState({}),J=Ur(_,Ht=>z(Ht)),q=Array.from(V.layers),[it]=[...V.layersWithOutsidePointerEventsDisabled].slice(-1),ht=q.indexOf(it),pt=G?q.indexOf(G):-1,lt=V.layersWithOutsidePointerEventsDisabled.size>0,bt=pt>=ht,Tt=rZ(Ht=>{const re=Ht.target,Xt=[...V.branches].some(se=>se.contains(re));!bt||Xt||(R==null||R(Ht),N==null||N(Ht),Ht.defaultPrevented||k==null||k())},nt),Yt=sZ(Ht=>{const re=Ht.target;[...V.branches].some(se=>se.contains(re))||(w==null||w(Ht),N==null||N(Ht),Ht.defaultPrevented||k==null||k())},nt);return ZQ(Ht=>{pt===V.layers.size-1&&(g==null||g(Ht),!Ht.defaultPrevented&&k&&(Ht.preventDefault(),k()))},nt),Z.useEffect(()=>{if(G)return E&&(V.layersWithOutsidePointerEventsDisabled.size===0&&(EF=nt.body.style.pointerEvents,nt.body.style.pointerEvents="none"),V.layersWithOutsidePointerEventsDisabled.add(G)),V.layers.add(G),gF(),()=>{E&&V.layersWithOutsidePointerEventsDisabled.size===1&&(nt.body.style.pointerEvents=EF)}},[G,nt,E,V]),Z.useEffect(()=>()=>{G&&(V.layers.delete(G),V.layersWithOutsidePointerEventsDisabled.delete(G),gF())},[G,V]),Z.useEffect(()=>{const Ht=()=>at({});return document.addEventListener(CN,Ht),()=>document.removeEventListener(CN,Ht)},[]),Rt.jsx(Xi.div,{...B,ref:J,style:{pointerEvents:lt?bt?"auto":"none":void 0,...h.style},onFocusCapture:ir(h.onFocusCapture,Yt.onFocusCapture),onBlurCapture:ir(h.onBlurCapture,Yt.onBlurCapture),onPointerDownCapture:ir(h.onPointerDownCapture,Tt.onPointerDownCapture)})});nG.displayName=$Q;var nZ="DismissableLayerBranch",iZ=Z.forwardRef((h,_)=>{const E=Z.useContext(eG),g=Z.useRef(null),R=Ur(_,g);return Z.useEffect(()=>{const w=g.current;if(w)return E.branches.add(w),()=>{E.branches.delete(w)}},[E.branches]),Rt.jsx(Xi.div,{...h,ref:R})});iZ.displayName=nZ;function rZ(h,_=globalThis==null?void 0:globalThis.document){const E=Hl(h),g=Z.useRef(!1),R=Z.useRef(()=>{});return Z.useEffect(()=>{const w=k=>{if(k.target&&!g.current){let B=function(){iG(tZ,E,V,{discrete:!0})};const V={originalEvent:k};k.pointerType==="touch"?(_.removeEventListener("click",R.current),R.current=B,_.addEventListener("click",R.current,{once:!0})):B()}else _.removeEventListener("click",R.current);g.current=!1},N=window.setTimeout(()=>{_.addEventListener("pointerdown",w)},0);return()=>{window.clearTimeout(N),_.removeEventListener("pointerdown",w),_.removeEventListener("click",R.current)}},[_,E]),{onPointerDownCapture:()=>g.current=!0}}function sZ(h,_=globalThis==null?void 0:globalThis.document){const E=Hl(h),g=Z.useRef(!1);return Z.useEffect(()=>{const R=w=>{w.target&&!g.current&&iG(eZ,E,{originalEvent:w},{discrete:!1})};return _.addEventListener("focusin",R),()=>_.removeEventListener("focusin",R)},[_,E]),{onFocusCapture:()=>g.current=!0,onBlurCapture:()=>g.current=!1}}function gF(){const h=new CustomEvent(CN);document.dispatchEvent(h)}function iG(h,_,E,{discrete:g}){const R=E.originalEvent.target,w=new CustomEvent(h,{bubbles:!1,cancelable:!0,detail:E});_&&R.addEventListener(h,_,{once:!0}),g?M9(R,w):R.dispatchEvent(w)}var Q0=0;function oZ(){Z.useEffect(()=>{const h=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",h[0]??SF()),document.body.insertAdjacentElement("beforeend",h[1]??SF()),Q0++,()=>{Q0===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(_=>_.remove()),Q0--}},[])}function SF(){const h=document.createElement("span");return h.setAttribute("data-radix-focus-guard",""),h.tabIndex=0,h.style.outline="none",h.style.opacity="0",h.style.position="fixed",h.style.pointerEvents="none",h}var Z0="focusScope.autoFocusOnMount",$0="focusScope.autoFocusOnUnmount",TF={bubbles:!1,cancelable:!0},aZ="FocusScope",rG=Z.forwardRef((h,_)=>{const{loop:E=!1,trapped:g=!1,onMountAutoFocus:R,onUnmountAutoFocus:w,...N}=h,[k,B]=Z.useState(null),V=Hl(R),G=Hl(w),z=Z.useRef(null),nt=Ur(_,q=>B(q)),at=Z.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Z.useEffect(()=>{if(g){let q=function(lt){if(at.paused||!k)return;const bt=lt.target;k.contains(bt)?z.current=bt:dd(z.current,{select:!0})},it=function(lt){if(at.paused||!k)return;const bt=lt.relatedTarget;bt!==null&&(k.contains(bt)||dd(z.current,{select:!0}))},ht=function(lt){if(document.activeElement===document.body)for(const Tt of lt)Tt.removedNodes.length>0&&dd(k)};document.addEventListener("focusin",q),document.addEventListener("focusout",it);const pt=new MutationObserver(ht);return k&&pt.observe(k,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",q),document.removeEventListener("focusout",it),pt.disconnect()}}},[g,k,at.paused]),Z.useEffect(()=>{if(k){yF.add(at);const q=document.activeElement;if(!k.contains(q)){const ht=new CustomEvent(Z0,TF);k.addEventListener(Z0,V),k.dispatchEvent(ht),ht.defaultPrevented||(cZ(pZ(sG(k)),{select:!0}),document.activeElement===q&&dd(k))}return()=>{k.removeEventListener(Z0,V),setTimeout(()=>{const ht=new CustomEvent($0,TF);k.addEventListener($0,G),k.dispatchEvent(ht),ht.defaultPrevented||dd(q??document.body,{select:!0}),k.removeEventListener($0,G),yF.remove(at)},0)}}},[k,V,G,at]);const J=Z.useCallback(q=>{if(!E&&!g||at.paused)return;const it=q.key==="Tab"&&!q.altKey&&!q.ctrlKey&&!q.metaKey,ht=document.activeElement;if(it&&ht){const pt=q.currentTarget,[lt,bt]=lZ(pt);lt&&bt?!q.shiftKey&&ht===bt?(q.preventDefault(),E&&dd(lt,{select:!0})):q.shiftKey&&ht===lt&&(q.preventDefault(),E&&dd(bt,{select:!0})):ht===pt&&q.preventDefault()}},[E,g,at.paused]);return Rt.jsx(Xi.div,{tabIndex:-1,...N,ref:nt,onKeyDown:J})});rG.displayName=aZ;function cZ(h,{select:_=!1}={}){const E=document.activeElement;for(const g of h)if(dd(g,{select:_}),document.activeElement!==E)return}function lZ(h){const _=sG(h),E=vF(_,h),g=vF(_.reverse(),h);return[E,g]}function sG(h){const _=[],E=document.createTreeWalker(h,NodeFilter.SHOW_ELEMENT,{acceptNode:g=>{const R=g.tagName==="INPUT"&&g.type==="hidden";return g.disabled||g.hidden||R?NodeFilter.FILTER_SKIP:g.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;E.nextNode();)_.push(E.currentNode);return _}function vF(h,_){for(const E of h)if(!uZ(E,{upTo:_}))return E}function uZ(h,{upTo:_}){if(getComputedStyle(h).visibility==="hidden")return!0;for(;h;){if(_!==void 0&&h===_)return!1;if(getComputedStyle(h).display==="none")return!0;h=h.parentElement}return!1}function dZ(h){return h instanceof HTMLInputElement&&"select"in h}function dd(h,{select:_=!1}={}){if(h&&h.focus){const E=document.activeElement;h.focus({preventScroll:!0}),h!==E&&dZ(h)&&_&&h.select()}}var yF=hZ();function hZ(){let h=[];return{add(_){const E=h[0];_!==E&&(E==null||E.pause()),h=RF(h,_),h.unshift(_)},remove(_){var E;h=RF(h,_),(E=h[0])==null||E.resume()}}}function RF(h,_){const E=[...h],g=E.indexOf(_);return g!==-1&&E.splice(g,1),E}function pZ(h){return h.filter(_=>_.tagName!=="A")}var uo=globalThis!=null&&globalThis.document?Z.useLayoutEffect:()=>{},fZ=k7.useId||(()=>{}),mZ=0;function zN(h){const[_,E]=Z.useState(fZ());return uo(()=>{E(g=>g??String(mZ++))},[h]),_?`radix-${_}`:""}const _Z=["top","right","bottom","left"],pd=Math.min,so=Math.max,vC=Math.round,nC=Math.floor,Gc=h=>({x:h,y:h}),EZ={left:"right",right:"left",bottom:"top",top:"bottom"},gZ={start:"end",end:"start"};function AN(h,_,E){return so(h,pd(_,E))}function Wl(h,_){return typeof h=="function"?h(_):h}function Kl(h){return h.split("-")[0]}function v_(h){return h.split("-")[1]}function YN(h){return h==="x"?"y":"x"}function qN(h){return h==="y"?"height":"width"}function fd(h){return["top","bottom"].includes(Kl(h))?"y":"x"}function XN(h){return YN(fd(h))}function SZ(h,_,E){E===void 0&&(E=!1);const g=v_(h),R=XN(h),w=qN(R);let N=R==="x"?g===(E?"end":"start")?"right":"left":g==="start"?"bottom":"top";return _.reference[w]>_.floating[w]&&(N=yC(N)),[N,yC(N)]}function TZ(h){const _=yC(h);return[wN(h),_,wN(_)]}function wN(h){return h.replace(/start|end/g,_=>gZ[_])}function vZ(h,_,E){const g=["left","right"],R=["right","left"],w=["top","bottom"],N=["bottom","top"];switch(h){case"top":case"bottom":return E?_?R:g:_?g:R;case"left":case"right":return _?w:N;default:return[]}}function yZ(h,_,E,g){const R=v_(h);let w=vZ(Kl(h),E==="start",g);return R&&(w=w.map(N=>N+"-"+R),_&&(w=w.concat(w.map(wN)))),w}function yC(h){return h.replace(/left|right|bottom|top/g,_=>EZ[_])}function RZ(h){return{top:0,right:0,bottom:0,left:0,...h}}function oG(h){return typeof h!="number"?RZ(h):{top:h,right:h,bottom:h,left:h}}function RC(h){const{x:_,y:E,width:g,height:R}=h;return{width:g,height:R,top:E,left:_,right:_+g,bottom:E+R,x:_,y:E}}function bF(h,_,E){let{reference:g,floating:R}=h;const w=fd(_),N=XN(_),k=qN(N),B=Kl(_),V=w==="y",G=g.x+g.width/2-R.width/2,z=g.y+g.height/2-R.height/2,nt=g[k]/2-R[k]/2;let at;switch(B){case"top":at={x:G,y:g.y-R.height};break;case"bottom":at={x:G,y:g.y+g.height};break;case"right":at={x:g.x+g.width,y:z};break;case"left":at={x:g.x-R.width,y:z};break;default:at={x:g.x,y:g.y}}switch(v_(_)){case"start":at[N]-=nt*(E&&V?-1:1);break;case"end":at[N]+=nt*(E&&V?-1:1);break}return at}const bZ=async(h,_,E)=>{const{placement:g="bottom",strategy:R="absolute",middleware:w=[],platform:N}=E,k=w.filter(Boolean),B=await(N.isRTL==null?void 0:N.isRTL(_));let V=await N.getElementRects({reference:h,floating:_,strategy:R}),{x:G,y:z}=bF(V,g,B),nt=g,at={},J=0;for(let q=0;q<k.length;q++){const{name:it,fn:ht}=k[q],{x:pt,y:lt,data:bt,reset:Tt}=await ht({x:G,y:z,initialPlacement:g,placement:nt,strategy:R,middlewareData:at,rects:V,platform:N,elements:{reference:h,floating:_}});G=pt??G,z=lt??z,at={...at,[it]:{...at[it],...bt}},Tt&&J<=50&&(J++,typeof Tt=="object"&&(Tt.placement&&(nt=Tt.placement),Tt.rects&&(V=Tt.rects===!0?await N.getElementRects({reference:h,floating:_,strategy:R}):Tt.rects),{x:G,y:z}=bF(V,nt,B)),q=-1)}return{x:G,y:z,placement:nt,strategy:R,middlewareData:at}};async function VS(h,_){var E;_===void 0&&(_={});const{x:g,y:R,platform:w,rects:N,elements:k,strategy:B}=h,{boundary:V="clippingAncestors",rootBoundary:G="viewport",elementContext:z="floating",altBoundary:nt=!1,padding:at=0}=Wl(_,h),J=oG(at),it=k[nt?z==="floating"?"reference":"floating":z],ht=RC(await w.getClippingRect({element:(E=await(w.isElement==null?void 0:w.isElement(it)))==null||E?it:it.contextElement||await(w.getDocumentElement==null?void 0:w.getDocumentElement(k.floating)),boundary:V,rootBoundary:G,strategy:B})),pt=z==="floating"?{x:g,y:R,width:N.floating.width,height:N.floating.height}:N.reference,lt=await(w.getOffsetParent==null?void 0:w.getOffsetParent(k.floating)),bt=await(w.isElement==null?void 0:w.isElement(lt))?await(w.getScale==null?void 0:w.getScale(lt))||{x:1,y:1}:{x:1,y:1},Tt=RC(w.convertOffsetParentRelativeRectToViewportRelativeRect?await w.convertOffsetParentRelativeRectToViewportRelativeRect({elements:k,rect:pt,offsetParent:lt,strategy:B}):pt);return{top:(ht.top-Tt.top+J.top)/bt.y,bottom:(Tt.bottom-ht.bottom+J.bottom)/bt.y,left:(ht.left-Tt.left+J.left)/bt.x,right:(Tt.right-ht.right+J.right)/bt.x}}const CZ=h=>({name:"arrow",options:h,async fn(_){const{x:E,y:g,placement:R,rects:w,platform:N,elements:k,middlewareData:B}=_,{element:V,padding:G=0}=Wl(h,_)||{};if(V==null)return{};const z=oG(G),nt={x:E,y:g},at=XN(R),J=qN(at),q=await N.getDimensions(V),it=at==="y",ht=it?"top":"left",pt=it?"bottom":"right",lt=it?"clientHeight":"clientWidth",bt=w.reference[J]+w.reference[at]-nt[at]-w.floating[J],Tt=nt[at]-w.reference[at],Yt=await(N.getOffsetParent==null?void 0:N.getOffsetParent(V));let Ht=Yt?Yt[lt]:0;(!Ht||!await(N.isElement==null?void 0:N.isElement(Yt)))&&(Ht=k.floating[lt]||w.floating[J]);const re=bt/2-Tt/2,Xt=Ht/2-q[J]/2-1,se=pd(z[ht],Xt),Ve=pd(z[pt],Xt),me=se,ke=Ht-q[J]-Ve,Zt=Ht/2-q[J]/2+re,xe=AN(me,Zt,ke),kt=!B.arrow&&v_(R)!=null&&Zt!==xe&&w.reference[J]/2-(Zt<me?se:Ve)-q[J]/2<0,zt=kt?Zt<me?Zt-me:Zt-ke:0;return{[at]:nt[at]+zt,data:{[at]:xe,centerOffset:Zt-xe-zt,...kt&&{alignmentOffset:zt}},reset:kt}}}),AZ=function(h){return h===void 0&&(h={}),{name:"flip",options:h,async fn(_){var E,g;const{placement:R,middlewareData:w,rects:N,initialPlacement:k,platform:B,elements:V}=_,{mainAxis:G=!0,crossAxis:z=!0,fallbackPlacements:nt,fallbackStrategy:at="bestFit",fallbackAxisSideDirection:J="none",flipAlignment:q=!0,...it}=Wl(h,_);if((E=w.arrow)!=null&&E.alignmentOffset)return{};const ht=Kl(R),pt=fd(k),lt=Kl(k)===k,bt=await(B.isRTL==null?void 0:B.isRTL(V.floating)),Tt=nt||(lt||!q?[yC(k)]:TZ(k)),Yt=J!=="none";!nt&&Yt&&Tt.push(...yZ(k,q,J,bt));const Ht=[k,...Tt],re=await VS(_,it),Xt=[];let se=((g=w.flip)==null?void 0:g.overflows)||[];if(G&&Xt.push(re[ht]),z){const Zt=SZ(R,N,bt);Xt.push(re[Zt[0]],re[Zt[1]])}if(se=[...se,{placement:R,overflows:Xt}],!Xt.every(Zt=>Zt<=0)){var Ve,me;const Zt=(((Ve=w.flip)==null?void 0:Ve.index)||0)+1,xe=Ht[Zt];if(xe)return{data:{index:Zt,overflows:se},reset:{placement:xe}};let kt=(me=se.filter(zt=>zt.overflows[0]<=0).sort((zt,Mt)=>zt.overflows[1]-Mt.overflows[1])[0])==null?void 0:me.placement;if(!kt)switch(at){case"bestFit":{var ke;const zt=(ke=se.filter(Mt=>{if(Yt){const ge=fd(Mt.placement);return ge===pt||ge==="y"}return!0}).map(Mt=>[Mt.placement,Mt.overflows.filter(ge=>ge>0).reduce((ge,rt)=>ge+rt,0)]).sort((Mt,ge)=>Mt[1]-ge[1])[0])==null?void 0:ke[0];zt&&(kt=zt);break}case"initialPlacement":kt=k;break}if(R!==kt)return{reset:{placement:kt}}}return{}}}};function CF(h,_){return{top:h.top-_.height,right:h.right-_.width,bottom:h.bottom-_.height,left:h.left-_.width}}function AF(h){return _Z.some(_=>h[_]>=0)}const wZ=function(h){return h===void 0&&(h={}),{name:"hide",options:h,async fn(_){const{rects:E}=_,{strategy:g="referenceHidden",...R}=Wl(h,_);switch(g){case"referenceHidden":{const w=await VS(_,{...R,elementContext:"reference"}),N=CF(w,E.reference);return{data:{referenceHiddenOffsets:N,referenceHidden:AF(N)}}}case"escaped":{const w=await VS(_,{...R,altBoundary:!0}),N=CF(w,E.floating);return{data:{escapedOffsets:N,escaped:AF(N)}}}default:return{}}}}};async function IZ(h,_){const{placement:E,platform:g,elements:R}=h,w=await(g.isRTL==null?void 0:g.isRTL(R.floating)),N=Kl(E),k=v_(E),B=fd(E)==="y",V=["left","top"].includes(N)?-1:1,G=w&&B?-1:1,z=Wl(_,h);let{mainAxis:nt,crossAxis:at,alignmentAxis:J}=typeof z=="number"?{mainAxis:z,crossAxis:0,alignmentAxis:null}:{mainAxis:z.mainAxis||0,crossAxis:z.crossAxis||0,alignmentAxis:z.alignmentAxis};return k&&typeof J=="number"&&(at=k==="end"?J*-1:J),B?{x:at*G,y:nt*V}:{x:nt*V,y:at*G}}const OZ=function(h){return h===void 0&&(h=0),{name:"offset",options:h,async fn(_){var E,g;const{x:R,y:w,placement:N,middlewareData:k}=_,B=await IZ(_,h);return N===((E=k.offset)==null?void 0:E.placement)&&(g=k.arrow)!=null&&g.alignmentOffset?{}:{x:R+B.x,y:w+B.y,data:{...B,placement:N}}}}},NZ=function(h){return h===void 0&&(h={}),{name:"shift",options:h,async fn(_){const{x:E,y:g,placement:R}=_,{mainAxis:w=!0,crossAxis:N=!1,limiter:k={fn:it=>{let{x:ht,y:pt}=it;return{x:ht,y:pt}}},...B}=Wl(h,_),V={x:E,y:g},G=await VS(_,B),z=fd(Kl(R)),nt=YN(z);let at=V[nt],J=V[z];if(w){const it=nt==="y"?"top":"left",ht=nt==="y"?"bottom":"right",pt=at+G[it],lt=at-G[ht];at=AN(pt,at,lt)}if(N){const it=z==="y"?"top":"left",ht=z==="y"?"bottom":"right",pt=J+G[it],lt=J-G[ht];J=AN(pt,J,lt)}const q=k.fn({..._,[nt]:at,[z]:J});return{...q,data:{x:q.x-E,y:q.y-g,enabled:{[nt]:w,[z]:N}}}}}},DZ=function(h){return h===void 0&&(h={}),{options:h,fn(_){const{x:E,y:g,placement:R,rects:w,middlewareData:N}=_,{offset:k=0,mainAxis:B=!0,crossAxis:V=!0}=Wl(h,_),G={x:E,y:g},z=fd(R),nt=YN(z);let at=G[nt],J=G[z];const q=Wl(k,_),it=typeof q=="number"?{mainAxis:q,crossAxis:0}:{mainAxis:0,crossAxis:0,...q};if(B){const lt=nt==="y"?"height":"width",bt=w.reference[nt]-w.floating[lt]+it.mainAxis,Tt=w.reference[nt]+w.reference[lt]-it.mainAxis;at<bt?at=bt:at>Tt&&(at=Tt)}if(V){var ht,pt;const lt=nt==="y"?"width":"height",bt=["top","left"].includes(Kl(R)),Tt=w.reference[z]-w.floating[lt]+(bt&&((ht=N.offset)==null?void 0:ht[z])||0)+(bt?0:it.crossAxis),Yt=w.reference[z]+w.reference[lt]+(bt?0:((pt=N.offset)==null?void 0:pt[z])||0)-(bt?it.crossAxis:0);J<Tt?J=Tt:J>Yt&&(J=Yt)}return{[nt]:at,[z]:J}}}},PZ=function(h){return h===void 0&&(h={}),{name:"size",options:h,async fn(_){var E,g;const{placement:R,rects:w,platform:N,elements:k}=_,{apply:B=()=>{},...V}=Wl(h,_),G=await VS(_,V),z=Kl(R),nt=v_(R),at=fd(R)==="y",{width:J,height:q}=w.floating;let it,ht;z==="top"||z==="bottom"?(it=z,ht=nt===(await(N.isRTL==null?void 0:N.isRTL(k.floating))?"start":"end")?"left":"right"):(ht=z,it=nt==="end"?"top":"bottom");const pt=q-G.top-G.bottom,lt=J-G.left-G.right,bt=pd(q-G[it],pt),Tt=pd(J-G[ht],lt),Yt=!_.middlewareData.shift;let Ht=bt,re=Tt;if((E=_.middlewareData.shift)!=null&&E.enabled.x&&(re=lt),(g=_.middlewareData.shift)!=null&&g.enabled.y&&(Ht=pt),Yt&&!nt){const se=so(G.left,0),Ve=so(G.right,0),me=so(G.top,0),ke=so(G.bottom,0);at?re=J-2*(se!==0||Ve!==0?se+Ve:so(G.left,G.right)):Ht=q-2*(me!==0||ke!==0?me+ke:so(G.top,G.bottom))}await B({..._,availableWidth:re,availableHeight:Ht});const Xt=await N.getDimensions(k.floating);return J!==Xt.width||q!==Xt.height?{reset:{rects:!0}}:{}}}};function VC(){return typeof window<"u"}function y_(h){return aG(h)?(h.nodeName||"").toLowerCase():"#document"}function ao(h){var _;return(h==null||(_=h.ownerDocument)==null?void 0:_.defaultView)||window}function Wc(h){var _;return(_=(aG(h)?h.ownerDocument:h.document)||window.document)==null?void 0:_.documentElement}function aG(h){return VC()?h instanceof Node||h instanceof ao(h).Node:!1}function Ma(h){return VC()?h instanceof Element||h instanceof ao(h).Element:!1}function Hc(h){return VC()?h instanceof HTMLElement||h instanceof ao(h).HTMLElement:!1}function wF(h){return!VC()||typeof ShadowRoot>"u"?!1:h instanceof ShadowRoot||h instanceof ao(h).ShadowRoot}function HS(h){const{overflow:_,overflowX:E,overflowY:g,display:R}=Ua(h);return/auto|scroll|overlay|hidden|clip/.test(_+g+E)&&!["inline","contents"].includes(R)}function LZ(h){return["table","td","th"].includes(y_(h))}function BC(h){return[":popover-open",":modal"].some(_=>{try{return h.matches(_)}catch{return!1}})}function JN(h){const _=QN(),E=Ma(h)?Ua(h):h;return["transform","translate","scale","rotate","perspective"].some(g=>E[g]?E[g]!=="none":!1)||(E.containerType?E.containerType!=="normal":!1)||!_&&(E.backdropFilter?E.backdropFilter!=="none":!1)||!_&&(E.filter?E.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(g=>(E.willChange||"").includes(g))||["paint","layout","strict","content"].some(g=>(E.contain||"").includes(g))}function kZ(h){let _=md(h);for(;Hc(_)&&!m_(_);){if(JN(_))return _;if(BC(_))return null;_=md(_)}return null}function QN(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function m_(h){return["html","body","#document"].includes(y_(h))}function Ua(h){return ao(h).getComputedStyle(h)}function jC(h){return Ma(h)?{scrollLeft:h.scrollLeft,scrollTop:h.scrollTop}:{scrollLeft:h.scrollX,scrollTop:h.scrollY}}function md(h){if(y_(h)==="html")return h;const _=h.assignedSlot||h.parentNode||wF(h)&&h.host||Wc(h);return wF(_)?_.host:_}function cG(h){const _=md(h);return m_(_)?h.ownerDocument?h.ownerDocument.body:h.body:Hc(_)&&HS(_)?_:cG(_)}function BS(h,_,E){var g;_===void 0&&(_=[]),E===void 0&&(E=!0);const R=cG(h),w=R===((g=h.ownerDocument)==null?void 0:g.body),N=ao(R);if(w){const k=IN(N);return _.concat(N,N.visualViewport||[],HS(R)?R:[],k&&E?BS(k):[])}return _.concat(R,BS(R,[],E))}function IN(h){return h.parent&&Object.getPrototypeOf(h.parent)?h.frameElement:null}function lG(h){const _=Ua(h);let E=parseFloat(_.width)||0,g=parseFloat(_.height)||0;const R=Hc(h),w=R?h.offsetWidth:E,N=R?h.offsetHeight:g,k=vC(E)!==w||vC(g)!==N;return k&&(E=w,g=N),{width:E,height:g,$:k}}function ZN(h){return Ma(h)?h:h.contextElement}function d_(h){const _=ZN(h);if(!Hc(_))return Gc(1);const E=_.getBoundingClientRect(),{width:g,height:R,$:w}=lG(_);let N=(w?vC(E.width):E.width)/g,k=(w?vC(E.height):E.height)/R;return(!N||!Number.isFinite(N))&&(N=1),(!k||!Number.isFinite(k))&&(k=1),{x:N,y:k}}const MZ=Gc(0);function uG(h){const _=ao(h);return!QN()||!_.visualViewport?MZ:{x:_.visualViewport.offsetLeft,y:_.visualViewport.offsetTop}}function UZ(h,_,E){return _===void 0&&(_=!1),!E||_&&E!==ao(h)?!1:_}function gp(h,_,E,g){_===void 0&&(_=!1),E===void 0&&(E=!1);const R=h.getBoundingClientRect(),w=ZN(h);let N=Gc(1);_&&(g?Ma(g)&&(N=d_(g)):N=d_(h));const k=UZ(w,E,g)?uG(w):Gc(0);let B=(R.left+k.x)/N.x,V=(R.top+k.y)/N.y,G=R.width/N.x,z=R.height/N.y;if(w){const nt=ao(w),at=g&&Ma(g)?ao(g):g;let J=nt,q=IN(J);for(;q&&g&&at!==J;){const it=d_(q),ht=q.getBoundingClientRect(),pt=Ua(q),lt=ht.left+(q.clientLeft+parseFloat(pt.paddingLeft))*it.x,bt=ht.top+(q.clientTop+parseFloat(pt.paddingTop))*it.y;B*=it.x,V*=it.y,G*=it.x,z*=it.y,B+=lt,V+=bt,J=ao(q),q=IN(J)}}return RC({width:G,height:z,x:B,y:V})}function $N(h,_){const E=jC(h).scrollLeft;return _?_.left+E:gp(Wc(h)).left+E}function dG(h,_,E){E===void 0&&(E=!1);const g=h.getBoundingClientRect(),R=g.left+_.scrollLeft-(E?0:$N(h,g)),w=g.top+_.scrollTop;return{x:R,y:w}}function xZ(h){let{elements:_,rect:E,offsetParent:g,strategy:R}=h;const w=R==="fixed",N=Wc(g),k=_?BC(_.floating):!1;if(g===N||k&&w)return E;let B={scrollLeft:0,scrollTop:0},V=Gc(1);const G=Gc(0),z=Hc(g);if((z||!z&&!w)&&((y_(g)!=="body"||HS(N))&&(B=jC(g)),Hc(g))){const at=gp(g);V=d_(g),G.x=at.x+g.clientLeft,G.y=at.y+g.clientTop}const nt=N&&!z&&!w?dG(N,B,!0):Gc(0);return{width:E.width*V.x,height:E.height*V.y,x:E.x*V.x-B.scrollLeft*V.x+G.x+nt.x,y:E.y*V.y-B.scrollTop*V.y+G.y+nt.y}}function VZ(h){return Array.from(h.getClientRects())}function BZ(h){const _=Wc(h),E=jC(h),g=h.ownerDocument.body,R=so(_.scrollWidth,_.clientWidth,g.scrollWidth,g.clientWidth),w=so(_.scrollHeight,_.clientHeight,g.scrollHeight,g.clientHeight);let N=-E.scrollLeft+$N(h);const k=-E.scrollTop;return Ua(g).direction==="rtl"&&(N+=so(_.clientWidth,g.clientWidth)-R),{width:R,height:w,x:N,y:k}}function jZ(h,_){const E=ao(h),g=Wc(h),R=E.visualViewport;let w=g.clientWidth,N=g.clientHeight,k=0,B=0;if(R){w=R.width,N=R.height;const V=QN();(!V||V&&_==="fixed")&&(k=R.offsetLeft,B=R.offsetTop)}return{width:w,height:N,x:k,y:B}}function FZ(h,_){const E=gp(h,!0,_==="fixed"),g=E.top+h.clientTop,R=E.left+h.clientLeft,w=Hc(h)?d_(h):Gc(1),N=h.clientWidth*w.x,k=h.clientHeight*w.y,B=R*w.x,V=g*w.y;return{width:N,height:k,x:B,y:V}}function IF(h,_,E){let g;if(_==="viewport")g=jZ(h,E);else if(_==="document")g=BZ(Wc(h));else if(Ma(_))g=FZ(_,E);else{const R=uG(h);g={x:_.x-R.x,y:_.y-R.y,width:_.width,height:_.height}}return RC(g)}function hG(h,_){const E=md(h);return E===_||!Ma(E)||m_(E)?!1:Ua(E).position==="fixed"||hG(E,_)}function GZ(h,_){const E=_.get(h);if(E)return E;let g=BS(h,[],!1).filter(k=>Ma(k)&&y_(k)!=="body"),R=null;const w=Ua(h).position==="fixed";let N=w?md(h):h;for(;Ma(N)&&!m_(N);){const k=Ua(N),B=JN(N);!B&&k.position==="fixed"&&(R=null),(w?!B&&!R:!B&&k.position==="static"&&!!R&&["absolute","fixed"].includes(R.position)||HS(N)&&!B&&hG(h,N))?g=g.filter(G=>G!==N):R=k,N=md(N)}return _.set(h,g),g}function HZ(h){let{element:_,boundary:E,rootBoundary:g,strategy:R}=h;const N=[...E==="clippingAncestors"?BC(_)?[]:GZ(_,this._c):[].concat(E),g],k=N[0],B=N.reduce((V,G)=>{const z=IF(_,G,R);return V.top=so(z.top,V.top),V.right=pd(z.right,V.right),V.bottom=pd(z.bottom,V.bottom),V.left=so(z.left,V.left),V},IF(_,k,R));return{width:B.right-B.left,height:B.bottom-B.top,x:B.left,y:B.top}}function WZ(h){const{width:_,height:E}=lG(h);return{width:_,height:E}}function KZ(h,_,E){const g=Hc(_),R=Wc(_),w=E==="fixed",N=gp(h,!0,w,_);let k={scrollLeft:0,scrollTop:0};const B=Gc(0);if(g||!g&&!w)if((y_(_)!=="body"||HS(R))&&(k=jC(_)),g){const nt=gp(_,!0,w,_);B.x=nt.x+_.clientLeft,B.y=nt.y+_.clientTop}else R&&(B.x=$N(R));const V=R&&!g&&!w?dG(R,k):Gc(0),G=N.left+k.scrollLeft-B.x-V.x,z=N.top+k.scrollTop-B.y-V.y;return{x:G,y:z,width:N.width,height:N.height}}function tN(h){return Ua(h).position==="static"}function OF(h,_){if(!Hc(h)||Ua(h).position==="fixed")return null;if(_)return _(h);let E=h.offsetParent;return Wc(h)===E&&(E=E.ownerDocument.body),E}function pG(h,_){const E=ao(h);if(BC(h))return E;if(!Hc(h)){let R=md(h);for(;R&&!m_(R);){if(Ma(R)&&!tN(R))return R;R=md(R)}return E}let g=OF(h,_);for(;g&&LZ(g)&&tN(g);)g=OF(g,_);return g&&m_(g)&&tN(g)&&!JN(g)?E:g||kZ(h)||E}const zZ=async function(h){const _=this.getOffsetParent||pG,E=this.getDimensions,g=await E(h.floating);return{reference:KZ(h.reference,await _(h.floating),h.strategy),floating:{x:0,y:0,width:g.width,height:g.height}}};function YZ(h){return Ua(h).direction==="rtl"}const qZ={convertOffsetParentRelativeRectToViewportRelativeRect:xZ,getDocumentElement:Wc,getClippingRect:HZ,getOffsetParent:pG,getElementRects:zZ,getClientRects:VZ,getDimensions:WZ,getScale:d_,isElement:Ma,isRTL:YZ};function fG(h,_){return h.x===_.x&&h.y===_.y&&h.width===_.width&&h.height===_.height}function XZ(h,_){let E=null,g;const R=Wc(h);function w(){var k;clearTimeout(g),(k=E)==null||k.disconnect(),E=null}function N(k,B){k===void 0&&(k=!1),B===void 0&&(B=1),w();const V=h.getBoundingClientRect(),{left:G,top:z,width:nt,height:at}=V;if(k||_(),!nt||!at)return;const J=nC(z),q=nC(R.clientWidth-(G+nt)),it=nC(R.clientHeight-(z+at)),ht=nC(G),lt={rootMargin:-J+"px "+-q+"px "+-it+"px "+-ht+"px",threshold:so(0,pd(1,B))||1};let bt=!0;function Tt(Yt){const Ht=Yt[0].intersectionRatio;if(Ht!==B){if(!bt)return N();Ht?N(!1,Ht):g=setTimeout(()=>{N(!1,1e-7)},1e3)}Ht===1&&!fG(V,h.getBoundingClientRect())&&N(),bt=!1}try{E=new IntersectionObserver(Tt,{...lt,root:R.ownerDocument})}catch{E=new IntersectionObserver(Tt,lt)}E.observe(h)}return N(!0),w}function JZ(h,_,E,g){g===void 0&&(g={});const{ancestorScroll:R=!0,ancestorResize:w=!0,elementResize:N=typeof ResizeObserver=="function",layoutShift:k=typeof IntersectionObserver=="function",animationFrame:B=!1}=g,V=ZN(h),G=R||w?[...V?BS(V):[],...BS(_)]:[];G.forEach(ht=>{R&&ht.addEventListener("scroll",E,{passive:!0}),w&&ht.addEventListener("resize",E)});const z=V&&k?XZ(V,E):null;let nt=-1,at=null;N&&(at=new ResizeObserver(ht=>{let[pt]=ht;pt&&pt.target===V&&at&&(at.unobserve(_),cancelAnimationFrame(nt),nt=requestAnimationFrame(()=>{var lt;(lt=at)==null||lt.observe(_)})),E()}),V&&!B&&at.observe(V),at.observe(_));let J,q=B?gp(h):null;B&&it();function it(){const ht=gp(h);q&&!fG(q,ht)&&E(),q=ht,J=requestAnimationFrame(it)}return E(),()=>{var ht;G.forEach(pt=>{R&&pt.removeEventListener("scroll",E),w&&pt.removeEventListener("resize",E)}),z==null||z(),(ht=at)==null||ht.disconnect(),at=null,B&&cancelAnimationFrame(J)}}const QZ=OZ,ZZ=NZ,$Z=AZ,t$=PZ,e$=wZ,NF=CZ,n$=DZ,i$=(h,_,E)=>{const g=new Map,R={platform:qZ,...E},w={...R.platform,_c:g};return bZ(h,_,{...R,platform:w})};var dC=typeof document<"u"?Z.useLayoutEffect:Z.useEffect;function bC(h,_){if(h===_)return!0;if(typeof h!=typeof _)return!1;if(typeof h=="function"&&h.toString()===_.toString())return!0;let E,g,R;if(h&&_&&typeof h=="object"){if(Array.isArray(h)){if(E=h.length,E!==_.length)return!1;for(g=E;g--!==0;)if(!bC(h[g],_[g]))return!1;return!0}if(R=Object.keys(h),E=R.length,E!==Object.keys(_).length)return!1;for(g=E;g--!==0;)if(!{}.hasOwnProperty.call(_,R[g]))return!1;for(g=E;g--!==0;){const w=R[g];if(!(w==="_owner"&&h.$$typeof)&&!bC(h[w],_[w]))return!1}return!0}return h!==h&&_!==_}function mG(h){return typeof window>"u"?1:(h.ownerDocument.defaultView||window).devicePixelRatio||1}function DF(h,_){const E=mG(h);return Math.round(_*E)/E}function eN(h){const _=Z.useRef(h);return dC(()=>{_.current=h}),_}function r$(h){h===void 0&&(h={});const{placement:_="bottom",strategy:E="absolute",middleware:g=[],platform:R,elements:{reference:w,floating:N}={},transform:k=!0,whileElementsMounted:B,open:V}=h,[G,z]=Z.useState({x:0,y:0,strategy:E,placement:_,middlewareData:{},isPositioned:!1}),[nt,at]=Z.useState(g);bC(nt,g)||at(g);const[J,q]=Z.useState(null),[it,ht]=Z.useState(null),pt=Z.useCallback(Mt=>{Mt!==Yt.current&&(Yt.current=Mt,q(Mt))},[]),lt=Z.useCallback(Mt=>{Mt!==Ht.current&&(Ht.current=Mt,ht(Mt))},[]),bt=w||J,Tt=N||it,Yt=Z.useRef(null),Ht=Z.useRef(null),re=Z.useRef(G),Xt=B!=null,se=eN(B),Ve=eN(R),me=eN(V),ke=Z.useCallback(()=>{if(!Yt.current||!Ht.current)return;const Mt={placement:_,strategy:E,middleware:nt};Ve.current&&(Mt.platform=Ve.current),i$(Yt.current,Ht.current,Mt).then(ge=>{const rt={...ge,isPositioned:me.current!==!1};Zt.current&&!bC(re.current,rt)&&(re.current=rt,jS.flushSync(()=>{z(rt)}))})},[nt,_,E,Ve,me]);dC(()=>{V===!1&&re.current.isPositioned&&(re.current.isPositioned=!1,z(Mt=>({...Mt,isPositioned:!1})))},[V]);const Zt=Z.useRef(!1);dC(()=>(Zt.current=!0,()=>{Zt.current=!1}),[]),dC(()=>{if(bt&&(Yt.current=bt),Tt&&(Ht.current=Tt),bt&&Tt){if(se.current)return se.current(bt,Tt,ke);ke()}},[bt,Tt,ke,se,Xt]);const xe=Z.useMemo(()=>({reference:Yt,floating:Ht,setReference:pt,setFloating:lt}),[pt,lt]),kt=Z.useMemo(()=>({reference:bt,floating:Tt}),[bt,Tt]),zt=Z.useMemo(()=>{const Mt={position:E,left:0,top:0};if(!kt.floating)return Mt;const ge=DF(kt.floating,G.x),rt=DF(kt.floating,G.y);return k?{...Mt,transform:"translate("+ge+"px, "+rt+"px)",...mG(kt.floating)>=1.5&&{willChange:"transform"}}:{position:E,left:ge,top:rt}},[E,k,kt.floating,G.x,G.y]);return Z.useMemo(()=>({...G,update:ke,refs:xe,elements:kt,floatingStyles:zt}),[G,ke,xe,kt,zt])}const s$=h=>{function _(E){return{}.hasOwnProperty.call(E,"current")}return{name:"arrow",options:h,fn(E){const{element:g,padding:R}=typeof h=="function"?h(E):h;return g&&_(g)?g.current!=null?NF({element:g.current,padding:R}).fn(E):{}:g?NF({element:g,padding:R}).fn(E):{}}}},o$=(h,_)=>({...QZ(h),options:[h,_]}),a$=(h,_)=>({...ZZ(h),options:[h,_]}),c$=(h,_)=>({...n$(h),options:[h,_]}),l$=(h,_)=>({...$Z(h),options:[h,_]}),u$=(h,_)=>({...t$(h),options:[h,_]}),d$=(h,_)=>({...e$(h),options:[h,_]}),h$=(h,_)=>({...s$(h),options:[h,_]});var p$="Arrow",_G=Z.forwardRef((h,_)=>{const{children:E,width:g=10,height:R=5,...w}=h;return Rt.jsx(Xi.svg,{...w,ref:_,width:g,height:R,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:h.asChild?E:Rt.jsx("polygon",{points:"0,0 30,0 15,10"})})});_G.displayName=p$;var f$=_G;function m$(h){const[_,E]=Z.useState(void 0);return uo(()=>{if(h){E({width:h.offsetWidth,height:h.offsetHeight});const g=new ResizeObserver(R=>{if(!Array.isArray(R)||!R.length)return;const w=R[0];let N,k;if("borderBoxSize"in w){const B=w.borderBoxSize,V=Array.isArray(B)?B[0]:B;N=V.inlineSize,k=V.blockSize}else N=h.offsetWidth,k=h.offsetHeight;E({width:N,height:k})});return g.observe(h,{box:"border-box"}),()=>g.unobserve(h)}else E(void 0)},[h]),_}var tD="Popper",[EG,gG]=KN(tD),[_$,SG]=EG(tD),TG=h=>{const{__scopePopper:_,children:E}=h,[g,R]=Z.useState(null);return Rt.jsx(_$,{scope:_,anchor:g,onAnchorChange:R,children:E})};TG.displayName=tD;var vG="PopperAnchor",yG=Z.forwardRef((h,_)=>{const{__scopePopper:E,virtualRef:g,...R}=h,w=SG(vG,E),N=Z.useRef(null),k=Ur(_,N);return Z.useEffect(()=>{w.onAnchorChange((g==null?void 0:g.current)||N.current)}),g?null:Rt.jsx(Xi.div,{...R,ref:k})});yG.displayName=vG;var eD="PopperContent",[E$,g$]=EG(eD),RG=Z.forwardRef((h,_)=>{var le,_e,Ge,Te,nn,gn;const{__scopePopper:E,side:g="bottom",sideOffset:R=0,align:w="center",alignOffset:N=0,arrowPadding:k=0,avoidCollisions:B=!0,collisionBoundary:V=[],collisionPadding:G=0,sticky:z="partial",hideWhenDetached:nt=!1,updatePositionStrategy:at="optimized",onPlaced:J,...q}=h,it=SG(eD,E),[ht,pt]=Z.useState(null),lt=Ur(_,jn=>pt(jn)),[bt,Tt]=Z.useState(null),Yt=m$(bt),Ht=(Yt==null?void 0:Yt.width)??0,re=(Yt==null?void 0:Yt.height)??0,Xt=g+(w!=="center"?"-"+w:""),se=typeof G=="number"?G:{top:0,right:0,bottom:0,left:0,...G},Ve=Array.isArray(V)?V:[V],me=Ve.length>0,ke={padding:se,boundary:Ve.filter(T$),altBoundary:me},{refs:Zt,floatingStyles:xe,placement:kt,isPositioned:zt,middlewareData:Mt}=r$({strategy:"fixed",placement:Xt,whileElementsMounted:(...jn)=>JZ(...jn,{animationFrame:at==="always"}),elements:{reference:it.anchor},middleware:[o$({mainAxis:R+re,alignmentAxis:N}),B&&a$({mainAxis:!0,crossAxis:!1,limiter:z==="partial"?c$():void 0,...ke}),B&&l$({...ke}),u$({...ke,apply:({elements:jn,rects:br,availableWidth:ho,availableHeight:ji})=>{const{width:Xo,height:Ci}=br.reference,ki=jn.floating.style;ki.setProperty("--radix-popper-available-width",`${ho}px`),ki.setProperty("--radix-popper-available-height",`${ji}px`),ki.setProperty("--radix-popper-anchor-width",`${Xo}px`),ki.setProperty("--radix-popper-anchor-height",`${Ci}px`)}}),bt&&h$({element:bt,padding:k}),v$({arrowWidth:Ht,arrowHeight:re}),nt&&d$({strategy:"referenceHidden",...ke})]}),[ge,rt]=AG(kt),Vt=Hl(J);uo(()=>{zt&&(Vt==null||Vt())},[zt,Vt]);const ce=(le=Mt.arrow)==null?void 0:le.x,fe=(_e=Mt.arrow)==null?void 0:_e.y,Qt=((Ge=Mt.arrow)==null?void 0:Ge.centerOffset)!==0,[We,we]=Z.useState();return uo(()=>{ht&&we(window.getComputedStyle(ht).zIndex)},[ht]),Rt.jsx("div",{ref:Zt.setFloating,"data-radix-popper-content-wrapper":"",style:{...xe,transform:zt?xe.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:We,"--radix-popper-transform-origin":[(Te=Mt.transformOrigin)==null?void 0:Te.x,(nn=Mt.transformOrigin)==null?void 0:nn.y].join(" "),...((gn=Mt.hide)==null?void 0:gn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:h.dir,children:Rt.jsx(E$,{scope:E,placedSide:ge,onArrowChange:Tt,arrowX:ce,arrowY:fe,shouldHideArrow:Qt,children:Rt.jsx(Xi.div,{"data-side":ge,"data-align":rt,...q,ref:lt,style:{...q.style,animation:zt?void 0:"none"}})})})});RG.displayName=eD;var bG="PopperArrow",S$={top:"bottom",right:"left",bottom:"top",left:"right"},CG=Z.forwardRef(function(_,E){const{__scopePopper:g,...R}=_,w=g$(bG,g),N=S$[w.placedSide];return Rt.jsx("span",{ref:w.onArrowChange,style:{position:"absolute",left:w.arrowX,top:w.arrowY,[N]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[w.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[w.placedSide],visibility:w.shouldHideArrow?"hidden":void 0},children:Rt.jsx(f$,{...R,ref:E,style:{...R.style,display:"block"}})})});CG.displayName=bG;function T$(h){return h!==null}var v$=h=>({name:"transformOrigin",options:h,fn(_){var it,ht,pt;const{placement:E,rects:g,middlewareData:R}=_,N=((it=R.arrow)==null?void 0:it.centerOffset)!==0,k=N?0:h.arrowWidth,B=N?0:h.arrowHeight,[V,G]=AG(E),z={start:"0%",center:"50%",end:"100%"}[G],nt=(((ht=R.arrow)==null?void 0:ht.x)??0)+k/2,at=(((pt=R.arrow)==null?void 0:pt.y)??0)+B/2;let J="",q="";return V==="bottom"?(J=N?z:`${nt}px`,q=`${-B}px`):V==="top"?(J=N?z:`${nt}px`,q=`${g.floating.height+B}px`):V==="right"?(J=`${-B}px`,q=N?z:`${at}px`):V==="left"&&(J=`${g.floating.width+B}px`,q=N?z:`${at}px`),{data:{x:J,y:q}}}});function AG(h){const[_,E="center"]=h.split("-");return[_,E]}var y$=TG,R$=yG,b$=RG,C$=CG,A$="Portal",wG=Z.forwardRef((h,_)=>{var k;const{container:E,...g}=h,[R,w]=Z.useState(!1);uo(()=>w(!0),[]);const N=E||R&&((k=globalThis==null?void 0:globalThis.document)==null?void 0:k.body);return N?L9.createPortal(Rt.jsx(Xi.div,{...g,ref:_}),N):null});wG.displayName=A$;function PF({prop:h,defaultProp:_,onChange:E=()=>{}}){const[g,R]=w$({defaultProp:_,onChange:E}),w=h!==void 0,N=w?h:g,k=Hl(E),B=Z.useCallback(V=>{if(w){const z=typeof V=="function"?V(h):V;z!==h&&k(z)}else R(V)},[w,h,R,k]);return[N,B]}function w$({defaultProp:h,onChange:_}){const E=Z.useState(h),[g]=E,R=Z.useRef(g),w=Hl(_);return Z.useEffect(()=>{R.current!==g&&(w(g),R.current=g)},[g,R,w]),E}function I$(h){const _=Z.useRef({value:h,previous:h});return Z.useMemo(()=>(_.current.value!==h&&(_.current.previous=_.current.value,_.current.value=h),_.current.previous),[h])}var O$="VisuallyHidden",IG=Z.forwardRef((h,_)=>Rt.jsx(Xi.span,{...h,ref:_,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...h.style}}));IG.displayName=O$;var N$=function(h){if(typeof document>"u")return null;var _=Array.isArray(h)?h[0]:h;return _.ownerDocument.body},a_=new WeakMap,iC=new WeakMap,rC={},nN=0,OG=function(h){return h&&(h.host||OG(h.parentNode))},D$=function(h,_){return _.map(function(E){if(h.contains(E))return E;var g=OG(E);return g&&h.contains(g)?g:(console.error("aria-hidden",E,"in not contained inside",h,". Doing nothing"),null)}).filter(function(E){return!!E})},P$=function(h,_,E,g){var R=D$(_,Array.isArray(h)?h:[h]);rC[E]||(rC[E]=new WeakMap);var w=rC[E],N=[],k=new Set,B=new Set(R),V=function(z){!z||k.has(z)||(k.add(z),V(z.parentNode))};R.forEach(V);var G=function(z){!z||B.has(z)||Array.prototype.forEach.call(z.children,function(nt){if(k.has(nt))G(nt);else try{var at=nt.getAttribute(g),J=at!==null&&at!=="false",q=(a_.get(nt)||0)+1,it=(w.get(nt)||0)+1;a_.set(nt,q),w.set(nt,it),N.push(nt),q===1&&J&&iC.set(nt,!0),it===1&&nt.setAttribute(E,"true"),J||nt.setAttribute(g,"true")}catch(ht){console.error("aria-hidden: cannot operate on ",nt,ht)}})};return G(_),k.clear(),nN++,function(){N.forEach(function(z){var nt=a_.get(z)-1,at=w.get(z)-1;a_.set(z,nt),w.set(z,at),nt||(iC.has(z)||z.removeAttribute(g),iC.delete(z)),at||z.removeAttribute(E)}),nN--,nN||(a_=new WeakMap,a_=new WeakMap,iC=new WeakMap,rC={})}},L$=function(h,_,E){E===void 0&&(E="data-aria-hidden");var g=Array.from(Array.isArray(h)?h:[h]),R=N$(h);return R?(g.push.apply(g,Array.from(R.querySelectorAll("[aria-live]"))),P$(g,R,E,"aria-hidden")):function(){return null}},Fc=function(){return Fc=Object.assign||function(_){for(var E,g=1,R=arguments.length;g<R;g++){E=arguments[g];for(var w in E)Object.prototype.hasOwnProperty.call(E,w)&&(_[w]=E[w])}return _},Fc.apply(this,arguments)};function NG(h,_){var E={};for(var g in h)Object.prototype.hasOwnProperty.call(h,g)&&_.indexOf(g)<0&&(E[g]=h[g]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function")for(var R=0,g=Object.getOwnPropertySymbols(h);R<g.length;R++)_.indexOf(g[R])<0&&Object.prototype.propertyIsEnumerable.call(h,g[R])&&(E[g[R]]=h[g[R]]);return E}function k$(h,_,E){if(E||arguments.length===2)for(var g=0,R=_.length,w;g<R;g++)(w||!(g in _))&&(w||(w=Array.prototype.slice.call(_,0,g)),w[g]=_[g]);return h.concat(w||Array.prototype.slice.call(_))}var hC="right-scroll-bar-position",pC="width-before-scroll-bar",M$="with-scroll-bars-hidden",U$="--removed-body-scroll-bar-size";function iN(h,_){return typeof h=="function"?h(_):h&&(h.current=_),h}function x$(h,_){var E=Z.useState(function(){return{value:h,callback:_,facade:{get current(){return E.value},set current(g){var R=E.value;R!==g&&(E.value=g,E.callback(g,R))}}}})[0];return E.callback=_,E.facade}var V$=typeof window<"u"?Z.useLayoutEffect:Z.useEffect,LF=new WeakMap;function B$(h,_){var E=x$(null,function(g){return h.forEach(function(R){return iN(R,g)})});return V$(function(){var g=LF.get(E);if(g){var R=new Set(g),w=new Set(h),N=E.current;R.forEach(function(k){w.has(k)||iN(k,null)}),w.forEach(function(k){R.has(k)||iN(k,N)})}LF.set(E,h)},[h]),E}function j$(h){return h}function F$(h,_){_===void 0&&(_=j$);var E=[],g=!1,R={read:function(){if(g)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return E.length?E[E.length-1]:h},useMedium:function(w){var N=_(w,g);return E.push(N),function(){E=E.filter(function(k){return k!==N})}},assignSyncMedium:function(w){for(g=!0;E.length;){var N=E;E=[],N.forEach(w)}E={push:function(k){return w(k)},filter:function(){return E}}},assignMedium:function(w){g=!0;var N=[];if(E.length){var k=E;E=[],k.forEach(w),N=E}var B=function(){var G=N;N=[],G.forEach(w)},V=function(){return Promise.resolve().then(B)};V(),E={push:function(G){N.push(G),V()},filter:function(G){return N=N.filter(G),E}}}};return R}function G$(h){h===void 0&&(h={});var _=F$(null);return _.options=Fc({async:!0,ssr:!1},h),_}var DG=function(h){var _=h.sideCar,E=NG(h,["sideCar"]);if(!_)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var g=_.read();if(!g)throw new Error("Sidecar medium not found");return Z.createElement(g,Fc({},E))};DG.isSideCarExport=!0;function H$(h,_){return h.useMedium(_),DG}var PG=G$(),rN=function(){},FC=Z.forwardRef(function(h,_){var E=Z.useRef(null),g=Z.useState({onScrollCapture:rN,onWheelCapture:rN,onTouchMoveCapture:rN}),R=g[0],w=g[1],N=h.forwardProps,k=h.children,B=h.className,V=h.removeScrollBar,G=h.enabled,z=h.shards,nt=h.sideCar,at=h.noIsolation,J=h.inert,q=h.allowPinchZoom,it=h.as,ht=it===void 0?"div":it,pt=h.gapMode,lt=NG(h,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),bt=nt,Tt=B$([E,_]),Yt=Fc(Fc({},lt),R);return Z.createElement(Z.Fragment,null,G&&Z.createElement(bt,{sideCar:PG,removeScrollBar:V,shards:z,noIsolation:at,inert:J,setCallbacks:w,allowPinchZoom:!!q,lockRef:E,gapMode:pt}),N?Z.cloneElement(Z.Children.only(k),Fc(Fc({},Yt),{ref:Tt})):Z.createElement(ht,Fc({},Yt,{className:B,ref:Tt}),k))});FC.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};FC.classNames={fullWidth:pC,zeroRight:hC};var W$=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function K$(){if(!document)return null;var h=document.createElement("style");h.type="text/css";var _=W$();return _&&h.setAttribute("nonce",_),h}function z$(h,_){h.styleSheet?h.styleSheet.cssText=_:h.appendChild(document.createTextNode(_))}function Y$(h){var _=document.head||document.getElementsByTagName("head")[0];_.appendChild(h)}var q$=function(){var h=0,_=null;return{add:function(E){h==0&&(_=K$())&&(z$(_,E),Y$(_)),h++},remove:function(){h--,!h&&_&&(_.parentNode&&_.parentNode.removeChild(_),_=null)}}},X$=function(){var h=q$();return function(_,E){Z.useEffect(function(){return h.add(_),function(){h.remove()}},[_&&E])}},LG=function(){var h=X$(),_=function(E){var g=E.styles,R=E.dynamic;return h(g,R),null};return _},J$={left:0,top:0,right:0,gap:0},sN=function(h){return parseInt(h||"",10)||0},Q$=function(h){var _=window.getComputedStyle(document.body),E=_[h==="padding"?"paddingLeft":"marginLeft"],g=_[h==="padding"?"paddingTop":"marginTop"],R=_[h==="padding"?"paddingRight":"marginRight"];return[sN(E),sN(g),sN(R)]},Z$=function(h){if(h===void 0&&(h="margin"),typeof window>"u")return J$;var _=Q$(h),E=document.documentElement.clientWidth,g=window.innerWidth;return{left:_[0],top:_[1],right:_[2],gap:Math.max(0,g-E+_[2]-_[0])}},$$=LG(),h_="data-scroll-locked",ttt=function(h,_,E,g){var R=h.left,w=h.top,N=h.right,k=h.gap;return E===void 0&&(E="margin"),`
  .`.concat(M$,` {
   overflow: hidden `).concat(g,`;
   padding-right: `).concat(k,"px ").concat(g,`;
  }
  body[`).concat(h_,`] {
    overflow: hidden `).concat(g,`;
    overscroll-behavior: contain;
    `).concat([_&&"position: relative ".concat(g,";"),E==="margin"&&`
    padding-left: `.concat(R,`px;
    padding-top: `).concat(w,`px;
    padding-right: `).concat(N,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(k,"px ").concat(g,`;
    `),E==="padding"&&"padding-right: ".concat(k,"px ").concat(g,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(hC,` {
    right: `).concat(k,"px ").concat(g,`;
  }
  
  .`).concat(pC,` {
    margin-right: `).concat(k,"px ").concat(g,`;
  }
  
  .`).concat(hC," .").concat(hC,` {
    right: 0 `).concat(g,`;
  }
  
  .`).concat(pC," .").concat(pC,` {
    margin-right: 0 `).concat(g,`;
  }
  
  body[`).concat(h_,`] {
    `).concat(U$,": ").concat(k,`px;
  }
`)},kF=function(){var h=parseInt(document.body.getAttribute(h_)||"0",10);return isFinite(h)?h:0},ett=function(){Z.useEffect(function(){return document.body.setAttribute(h_,(kF()+1).toString()),function(){var h=kF()-1;h<=0?document.body.removeAttribute(h_):document.body.setAttribute(h_,h.toString())}},[])},ntt=function(h){var _=h.noRelative,E=h.noImportant,g=h.gapMode,R=g===void 0?"margin":g;ett();var w=Z.useMemo(function(){return Z$(R)},[R]);return Z.createElement($$,{styles:ttt(w,!_,R,E?"":"!important")})},ON=!1;if(typeof window<"u")try{var sC=Object.defineProperty({},"passive",{get:function(){return ON=!0,!0}});window.addEventListener("test",sC,sC),window.removeEventListener("test",sC,sC)}catch{ON=!1}var c_=ON?{passive:!1}:!1,itt=function(h){return h.tagName==="TEXTAREA"},kG=function(h,_){if(!(h instanceof Element))return!1;var E=window.getComputedStyle(h);return E[_]!=="hidden"&&!(E.overflowY===E.overflowX&&!itt(h)&&E[_]==="visible")},rtt=function(h){return kG(h,"overflowY")},stt=function(h){return kG(h,"overflowX")},MF=function(h,_){var E=_.ownerDocument,g=_;do{typeof ShadowRoot<"u"&&g instanceof ShadowRoot&&(g=g.host);var R=MG(h,g);if(R){var w=UG(h,g),N=w[1],k=w[2];if(N>k)return!0}g=g.parentNode}while(g&&g!==E.body);return!1},ott=function(h){var _=h.scrollTop,E=h.scrollHeight,g=h.clientHeight;return[_,E,g]},att=function(h){var _=h.scrollLeft,E=h.scrollWidth,g=h.clientWidth;return[_,E,g]},MG=function(h,_){return h==="v"?rtt(_):stt(_)},UG=function(h,_){return h==="v"?ott(_):att(_)},ctt=function(h,_){return h==="h"&&_==="rtl"?-1:1},ltt=function(h,_,E,g,R){var w=ctt(h,window.getComputedStyle(_).direction),N=w*g,k=E.target,B=_.contains(k),V=!1,G=N>0,z=0,nt=0;do{var at=UG(h,k),J=at[0],q=at[1],it=at[2],ht=q-it-w*J;(J||ht)&&MG(h,k)&&(z+=ht,nt+=J),k instanceof ShadowRoot?k=k.host:k=k.parentNode}while(!B&&k!==document.body||B&&(_.contains(k)||_===k));return(G&&Math.abs(z)<1||!G&&Math.abs(nt)<1)&&(V=!0),V},oC=function(h){return"changedTouches"in h?[h.changedTouches[0].clientX,h.changedTouches[0].clientY]:[0,0]},UF=function(h){return[h.deltaX,h.deltaY]},xF=function(h){return h&&"current"in h?h.current:h},utt=function(h,_){return h[0]===_[0]&&h[1]===_[1]},dtt=function(h){return`
  .block-interactivity-`.concat(h,` {pointer-events: none;}
  .allow-interactivity-`).concat(h,` {pointer-events: all;}
`)},htt=0,l_=[];function ptt(h){var _=Z.useRef([]),E=Z.useRef([0,0]),g=Z.useRef(),R=Z.useState(htt++)[0],w=Z.useState(LG)[0],N=Z.useRef(h);Z.useEffect(function(){N.current=h},[h]),Z.useEffect(function(){if(h.inert){document.body.classList.add("block-interactivity-".concat(R));var q=k$([h.lockRef.current],(h.shards||[]).map(xF),!0).filter(Boolean);return q.forEach(function(it){return it.classList.add("allow-interactivity-".concat(R))}),function(){document.body.classList.remove("block-interactivity-".concat(R)),q.forEach(function(it){return it.classList.remove("allow-interactivity-".concat(R))})}}},[h.inert,h.lockRef.current,h.shards]);var k=Z.useCallback(function(q,it){if("touches"in q&&q.touches.length===2||q.type==="wheel"&&q.ctrlKey)return!N.current.allowPinchZoom;var ht=oC(q),pt=E.current,lt="deltaX"in q?q.deltaX:pt[0]-ht[0],bt="deltaY"in q?q.deltaY:pt[1]-ht[1],Tt,Yt=q.target,Ht=Math.abs(lt)>Math.abs(bt)?"h":"v";if("touches"in q&&Ht==="h"&&Yt.type==="range")return!1;var re=MF(Ht,Yt);if(!re)return!0;if(re?Tt=Ht:(Tt=Ht==="v"?"h":"v",re=MF(Ht,Yt)),!re)return!1;if(!g.current&&"changedTouches"in q&&(lt||bt)&&(g.current=Tt),!Tt)return!0;var Xt=g.current||Tt;return ltt(Xt,it,q,Xt==="h"?lt:bt)},[]),B=Z.useCallback(function(q){var it=q;if(!(!l_.length||l_[l_.length-1]!==w)){var ht="deltaY"in it?UF(it):oC(it),pt=_.current.filter(function(Tt){return Tt.name===it.type&&(Tt.target===it.target||it.target===Tt.shadowParent)&&utt(Tt.delta,ht)})[0];if(pt&&pt.should){it.cancelable&&it.preventDefault();return}if(!pt){var lt=(N.current.shards||[]).map(xF).filter(Boolean).filter(function(Tt){return Tt.contains(it.target)}),bt=lt.length>0?k(it,lt[0]):!N.current.noIsolation;bt&&it.cancelable&&it.preventDefault()}}},[]),V=Z.useCallback(function(q,it,ht,pt){var lt={name:q,delta:it,target:ht,should:pt,shadowParent:ftt(ht)};_.current.push(lt),setTimeout(function(){_.current=_.current.filter(function(bt){return bt!==lt})},1)},[]),G=Z.useCallback(function(q){E.current=oC(q),g.current=void 0},[]),z=Z.useCallback(function(q){V(q.type,UF(q),q.target,k(q,h.lockRef.current))},[]),nt=Z.useCallback(function(q){V(q.type,oC(q),q.target,k(q,h.lockRef.current))},[]);Z.useEffect(function(){return l_.push(w),h.setCallbacks({onScrollCapture:z,onWheelCapture:z,onTouchMoveCapture:nt}),document.addEventListener("wheel",B,c_),document.addEventListener("touchmove",B,c_),document.addEventListener("touchstart",G,c_),function(){l_=l_.filter(function(q){return q!==w}),document.removeEventListener("wheel",B,c_),document.removeEventListener("touchmove",B,c_),document.removeEventListener("touchstart",G,c_)}},[]);var at=h.removeScrollBar,J=h.inert;return Z.createElement(Z.Fragment,null,J?Z.createElement(w,{styles:dtt(R)}):null,at?Z.createElement(ntt,{gapMode:h.gapMode}):null)}function ftt(h){for(var _=null;h!==null;)h instanceof ShadowRoot&&(_=h.host,h=h.host),h=h.parentNode;return _}const mtt=H$(PG,ptt);var xG=Z.forwardRef(function(h,_){return Z.createElement(FC,Fc({},h,{ref:_,sideCar:mtt}))});xG.classNames=FC.classNames;var _tt=[" ","Enter","ArrowUp","ArrowDown"],Ett=[" ","Enter"],WS="Select",[GC,HC,gtt]=XQ(WS),[R_,yet]=KN(WS,[gtt,gG]),WC=gG(),[Stt,_d]=R_(WS),[Ttt,vtt]=R_(WS),VG=h=>{const{__scopeSelect:_,children:E,open:g,defaultOpen:R,onOpenChange:w,value:N,defaultValue:k,onValueChange:B,dir:V,name:G,autoComplete:z,disabled:nt,required:at,form:J}=h,q=WC(_),[it,ht]=Z.useState(null),[pt,lt]=Z.useState(null),[bt,Tt]=Z.useState(!1),Yt=QQ(V),[Ht=!1,re]=PF({prop:g,defaultProp:R,onChange:w}),[Xt,se]=PF({prop:N,defaultProp:k,onChange:B}),Ve=Z.useRef(null),me=it?J||!!it.closest("form"):!0,[ke,Zt]=Z.useState(new Set),xe=Array.from(ke).map(kt=>kt.props.value).join(";");return Rt.jsx(y$,{...q,children:Rt.jsxs(Stt,{required:at,scope:_,trigger:it,onTriggerChange:ht,valueNode:pt,onValueNodeChange:lt,valueNodeHasChildren:bt,onValueNodeHasChildrenChange:Tt,contentId:zN(),value:Xt,onValueChange:se,open:Ht,onOpenChange:re,dir:Yt,triggerPointerDownPosRef:Ve,disabled:nt,children:[Rt.jsx(GC.Provider,{scope:_,children:Rt.jsx(Ttt,{scope:h.__scopeSelect,onNativeOptionAdd:Z.useCallback(kt=>{Zt(zt=>new Set(zt).add(kt))},[]),onNativeOptionRemove:Z.useCallback(kt=>{Zt(zt=>{const Mt=new Set(zt);return Mt.delete(kt),Mt})},[]),children:E})}),me?Rt.jsxs(l4,{"aria-hidden":!0,required:at,tabIndex:-1,name:G,autoComplete:z,value:Xt,onChange:kt=>se(kt.target.value),disabled:nt,form:J,children:[Xt===void 0?Rt.jsx("option",{value:""}):null,Array.from(ke)]},xe):null]})})};VG.displayName=WS;var BG="SelectTrigger",jG=Z.forwardRef((h,_)=>{const{__scopeSelect:E,disabled:g=!1,...R}=h,w=WC(E),N=_d(BG,E),k=N.disabled||g,B=Ur(_,N.onTriggerChange),V=HC(E),G=Z.useRef("touch"),[z,nt,at]=u4(q=>{const it=V().filter(lt=>!lt.disabled),ht=it.find(lt=>lt.value===N.value),pt=d4(it,q,ht);pt!==void 0&&N.onValueChange(pt.value)}),J=q=>{k||(N.onOpenChange(!0),at()),q&&(N.triggerPointerDownPosRef.current={x:Math.round(q.pageX),y:Math.round(q.pageY)})};return Rt.jsx(R$,{asChild:!0,...w,children:Rt.jsx(Xi.button,{type:"button",role:"combobox","aria-controls":N.contentId,"aria-expanded":N.open,"aria-required":N.required,"aria-autocomplete":"none",dir:N.dir,"data-state":N.open?"open":"closed",disabled:k,"data-disabled":k?"":void 0,"data-placeholder":c4(N.value)?"":void 0,...R,ref:B,onClick:ir(R.onClick,q=>{q.currentTarget.focus(),G.current!=="mouse"&&J(q)}),onPointerDown:ir(R.onPointerDown,q=>{G.current=q.pointerType;const it=q.target;it.hasPointerCapture(q.pointerId)&&it.releasePointerCapture(q.pointerId),q.button===0&&q.ctrlKey===!1&&q.pointerType==="mouse"&&(J(q),q.preventDefault())}),onKeyDown:ir(R.onKeyDown,q=>{const it=z.current!=="";!(q.ctrlKey||q.altKey||q.metaKey)&&q.key.length===1&&nt(q.key),!(it&&q.key===" ")&&_tt.includes(q.key)&&(J(),q.preventDefault())})})})});jG.displayName=BG;var FG="SelectValue",GG=Z.forwardRef((h,_)=>{const{__scopeSelect:E,className:g,style:R,children:w,placeholder:N="",...k}=h,B=_d(FG,E),{onValueNodeHasChildrenChange:V}=B,G=w!==void 0,z=Ur(_,B.onValueNodeChange);return uo(()=>{V(G)},[V,G]),Rt.jsx(Xi.span,{...k,ref:z,style:{pointerEvents:"none"},children:c4(B.value)?Rt.jsx(Rt.Fragment,{children:N}):w})});GG.displayName=FG;var ytt="SelectIcon",HG=Z.forwardRef((h,_)=>{const{__scopeSelect:E,children:g,...R}=h;return Rt.jsx(Xi.span,{"aria-hidden":!0,...R,ref:_,children:g||"▼"})});HG.displayName=ytt;var Rtt="SelectPortal",WG=h=>Rt.jsx(wG,{asChild:!0,...h});WG.displayName=Rtt;var Sp="SelectContent",KG=Z.forwardRef((h,_)=>{const E=_d(Sp,h.__scopeSelect),[g,R]=Z.useState();if(uo(()=>{R(new DocumentFragment)},[]),!E.open){const w=g;return w?jS.createPortal(Rt.jsx(zG,{scope:h.__scopeSelect,children:Rt.jsx(GC.Slot,{scope:h.__scopeSelect,children:Rt.jsx("div",{children:h.children})})}),w):null}return Rt.jsx(YG,{...h,ref:_})});KG.displayName=Sp;var La=10,[zG,Ed]=R_(Sp),btt="SelectContentImpl",YG=Z.forwardRef((h,_)=>{const{__scopeSelect:E,position:g="item-aligned",onCloseAutoFocus:R,onEscapeKeyDown:w,onPointerDownOutside:N,side:k,sideOffset:B,align:V,alignOffset:G,arrowPadding:z,collisionBoundary:nt,collisionPadding:at,sticky:J,hideWhenDetached:q,avoidCollisions:it,...ht}=h,pt=_d(Sp,E),[lt,bt]=Z.useState(null),[Tt,Yt]=Z.useState(null),Ht=Ur(_,le=>bt(le)),[re,Xt]=Z.useState(null),[se,Ve]=Z.useState(null),me=HC(E),[ke,Zt]=Z.useState(!1),xe=Z.useRef(!1);Z.useEffect(()=>{if(lt)return L$(lt)},[lt]),oZ();const kt=Z.useCallback(le=>{const[_e,...Ge]=me().map(gn=>gn.ref.current),[Te]=Ge.slice(-1),nn=document.activeElement;for(const gn of le)if(gn===nn||(gn==null||gn.scrollIntoView({block:"nearest"}),gn===_e&&Tt&&(Tt.scrollTop=0),gn===Te&&Tt&&(Tt.scrollTop=Tt.scrollHeight),gn==null||gn.focus(),document.activeElement!==nn))return},[me,Tt]),zt=Z.useCallback(()=>kt([re,lt]),[kt,re,lt]);Z.useEffect(()=>{ke&&zt()},[ke,zt]);const{onOpenChange:Mt,triggerPointerDownPosRef:ge}=pt;Z.useEffect(()=>{if(lt){let le={x:0,y:0};const _e=Te=>{var nn,gn;le={x:Math.abs(Math.round(Te.pageX)-(((nn=ge.current)==null?void 0:nn.x)??0)),y:Math.abs(Math.round(Te.pageY)-(((gn=ge.current)==null?void 0:gn.y)??0))}},Ge=Te=>{le.x<=10&&le.y<=10?Te.preventDefault():lt.contains(Te.target)||Mt(!1),document.removeEventListener("pointermove",_e),ge.current=null};return ge.current!==null&&(document.addEventListener("pointermove",_e),document.addEventListener("pointerup",Ge,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",_e),document.removeEventListener("pointerup",Ge,{capture:!0})}}},[lt,Mt,ge]),Z.useEffect(()=>{const le=()=>Mt(!1);return window.addEventListener("blur",le),window.addEventListener("resize",le),()=>{window.removeEventListener("blur",le),window.removeEventListener("resize",le)}},[Mt]);const[rt,Vt]=u4(le=>{const _e=me().filter(nn=>!nn.disabled),Ge=_e.find(nn=>nn.ref.current===document.activeElement),Te=d4(_e,le,Ge);Te&&setTimeout(()=>Te.ref.current.focus())}),ce=Z.useCallback((le,_e,Ge)=>{const Te=!xe.current&&!Ge;(pt.value!==void 0&&pt.value===_e||Te)&&(Xt(le),Te&&(xe.current=!0))},[pt.value]),fe=Z.useCallback(()=>lt==null?void 0:lt.focus(),[lt]),Qt=Z.useCallback((le,_e,Ge)=>{const Te=!xe.current&&!Ge;(pt.value!==void 0&&pt.value===_e||Te)&&Ve(le)},[pt.value]),We=g==="popper"?NN:qG,we=We===NN?{side:k,sideOffset:B,align:V,alignOffset:G,arrowPadding:z,collisionBoundary:nt,collisionPadding:at,sticky:J,hideWhenDetached:q,avoidCollisions:it}:{};return Rt.jsx(zG,{scope:E,content:lt,viewport:Tt,onViewportChange:Yt,itemRefCallback:ce,selectedItem:re,onItemLeave:fe,itemTextRefCallback:Qt,focusSelectedItem:zt,selectedItemText:se,position:g,isPositioned:ke,searchRef:rt,children:Rt.jsx(xG,{as:p_,allowPinchZoom:!0,children:Rt.jsx(rG,{asChild:!0,trapped:pt.open,onMountAutoFocus:le=>{le.preventDefault()},onUnmountAutoFocus:ir(R,le=>{var _e;(_e=pt.trigger)==null||_e.focus({preventScroll:!0}),le.preventDefault()}),children:Rt.jsx(nG,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:w,onPointerDownOutside:N,onFocusOutside:le=>le.preventDefault(),onDismiss:()=>pt.onOpenChange(!1),children:Rt.jsx(We,{role:"listbox",id:pt.contentId,"data-state":pt.open?"open":"closed",dir:pt.dir,onContextMenu:le=>le.preventDefault(),...ht,...we,onPlaced:()=>Zt(!0),ref:Ht,style:{display:"flex",flexDirection:"column",outline:"none",...ht.style},onKeyDown:ir(ht.onKeyDown,le=>{const _e=le.ctrlKey||le.altKey||le.metaKey;if(le.key==="Tab"&&le.preventDefault(),!_e&&le.key.length===1&&Vt(le.key),["ArrowUp","ArrowDown","Home","End"].includes(le.key)){let Te=me().filter(nn=>!nn.disabled).map(nn=>nn.ref.current);if(["ArrowUp","End"].includes(le.key)&&(Te=Te.slice().reverse()),["ArrowUp","ArrowDown"].includes(le.key)){const nn=le.target,gn=Te.indexOf(nn);Te=Te.slice(gn+1)}setTimeout(()=>kt(Te)),le.preventDefault()}})})})})})})});YG.displayName=btt;var Ctt="SelectItemAlignedPosition",qG=Z.forwardRef((h,_)=>{const{__scopeSelect:E,onPlaced:g,...R}=h,w=_d(Sp,E),N=Ed(Sp,E),[k,B]=Z.useState(null),[V,G]=Z.useState(null),z=Ur(_,Ht=>G(Ht)),nt=HC(E),at=Z.useRef(!1),J=Z.useRef(!0),{viewport:q,selectedItem:it,selectedItemText:ht,focusSelectedItem:pt}=N,lt=Z.useCallback(()=>{if(w.trigger&&w.valueNode&&k&&V&&q&&it&&ht){const Ht=w.trigger.getBoundingClientRect(),re=V.getBoundingClientRect(),Xt=w.valueNode.getBoundingClientRect(),se=ht.getBoundingClientRect();if(w.dir!=="rtl"){const nn=se.left-re.left,gn=Xt.left-nn,jn=Ht.left-gn,br=Ht.width+jn,ho=Math.max(br,re.width),ji=window.innerWidth-La,Xo=_F(gn,[La,Math.max(La,ji-ho)]);k.style.minWidth=br+"px",k.style.left=Xo+"px"}else{const nn=re.right-se.right,gn=window.innerWidth-Xt.right-nn,jn=window.innerWidth-Ht.right-gn,br=Ht.width+jn,ho=Math.max(br,re.width),ji=window.innerWidth-La,Xo=_F(gn,[La,Math.max(La,ji-ho)]);k.style.minWidth=br+"px",k.style.right=Xo+"px"}const Ve=nt(),me=window.innerHeight-La*2,ke=q.scrollHeight,Zt=window.getComputedStyle(V),xe=parseInt(Zt.borderTopWidth,10),kt=parseInt(Zt.paddingTop,10),zt=parseInt(Zt.borderBottomWidth,10),Mt=parseInt(Zt.paddingBottom,10),ge=xe+kt+ke+Mt+zt,rt=Math.min(it.offsetHeight*5,ge),Vt=window.getComputedStyle(q),ce=parseInt(Vt.paddingTop,10),fe=parseInt(Vt.paddingBottom,10),Qt=Ht.top+Ht.height/2-La,We=me-Qt,we=it.offsetHeight/2,le=it.offsetTop+we,_e=xe+kt+le,Ge=ge-_e;if(_e<=Qt){const nn=Ve.length>0&&it===Ve[Ve.length-1].ref.current;k.style.bottom="0px";const gn=V.clientHeight-q.offsetTop-q.offsetHeight,jn=Math.max(We,we+(nn?fe:0)+gn+zt),br=_e+jn;k.style.height=br+"px"}else{const nn=Ve.length>0&&it===Ve[0].ref.current;k.style.top="0px";const jn=Math.max(Qt,xe+q.offsetTop+(nn?ce:0)+we)+Ge;k.style.height=jn+"px",q.scrollTop=_e-Qt+q.offsetTop}k.style.margin=`${La}px 0`,k.style.minHeight=rt+"px",k.style.maxHeight=me+"px",g==null||g(),requestAnimationFrame(()=>at.current=!0)}},[nt,w.trigger,w.valueNode,k,V,q,it,ht,w.dir,g]);uo(()=>lt(),[lt]);const[bt,Tt]=Z.useState();uo(()=>{V&&Tt(window.getComputedStyle(V).zIndex)},[V]);const Yt=Z.useCallback(Ht=>{Ht&&J.current===!0&&(lt(),pt==null||pt(),J.current=!1)},[lt,pt]);return Rt.jsx(wtt,{scope:E,contentWrapper:k,shouldExpandOnScrollRef:at,onScrollButtonChange:Yt,children:Rt.jsx("div",{ref:B,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:bt},children:Rt.jsx(Xi.div,{...R,ref:z,style:{boxSizing:"border-box",maxHeight:"100%",...R.style}})})})});qG.displayName=Ctt;var Att="SelectPopperPosition",NN=Z.forwardRef((h,_)=>{const{__scopeSelect:E,align:g="start",collisionPadding:R=La,...w}=h,N=WC(E);return Rt.jsx(b$,{...N,...w,ref:_,align:g,collisionPadding:R,style:{boxSizing:"border-box",...w.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});NN.displayName=Att;var[wtt,nD]=R_(Sp,{}),DN="SelectViewport",XG=Z.forwardRef((h,_)=>{const{__scopeSelect:E,nonce:g,...R}=h,w=Ed(DN,E),N=nD(DN,E),k=Ur(_,w.onViewportChange),B=Z.useRef(0);return Rt.jsxs(Rt.Fragment,{children:[Rt.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:g}),Rt.jsx(GC.Slot,{scope:E,children:Rt.jsx(Xi.div,{"data-radix-select-viewport":"",role:"presentation",...R,ref:k,style:{position:"relative",flex:1,overflow:"hidden auto",...R.style},onScroll:ir(R.onScroll,V=>{const G=V.currentTarget,{contentWrapper:z,shouldExpandOnScrollRef:nt}=N;if(nt!=null&&nt.current&&z){const at=Math.abs(B.current-G.scrollTop);if(at>0){const J=window.innerHeight-La*2,q=parseFloat(z.style.minHeight),it=parseFloat(z.style.height),ht=Math.max(q,it);if(ht<J){const pt=ht+at,lt=Math.min(J,pt),bt=pt-lt;z.style.height=lt+"px",z.style.bottom==="0px"&&(G.scrollTop=bt>0?bt:0,z.style.justifyContent="flex-end")}}}B.current=G.scrollTop})})})]})});XG.displayName=DN;var JG="SelectGroup",[Itt,Ott]=R_(JG),Ntt=Z.forwardRef((h,_)=>{const{__scopeSelect:E,...g}=h,R=zN();return Rt.jsx(Itt,{scope:E,id:R,children:Rt.jsx(Xi.div,{role:"group","aria-labelledby":R,...g,ref:_})})});Ntt.displayName=JG;var QG="SelectLabel",ZG=Z.forwardRef((h,_)=>{const{__scopeSelect:E,...g}=h,R=Ott(QG,E);return Rt.jsx(Xi.div,{id:R.id,...g,ref:_})});ZG.displayName=QG;var CC="SelectItem",[Dtt,$G]=R_(CC),t4=Z.forwardRef((h,_)=>{const{__scopeSelect:E,value:g,disabled:R=!1,textValue:w,...N}=h,k=_d(CC,E),B=Ed(CC,E),V=k.value===g,[G,z]=Z.useState(w??""),[nt,at]=Z.useState(!1),J=Ur(_,pt=>{var lt;return(lt=B.itemRefCallback)==null?void 0:lt.call(B,pt,g,R)}),q=zN(),it=Z.useRef("touch"),ht=()=>{R||(k.onValueChange(g),k.onOpenChange(!1))};if(g==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return Rt.jsx(Dtt,{scope:E,value:g,disabled:R,textId:q,isSelected:V,onItemTextChange:Z.useCallback(pt=>{z(lt=>lt||((pt==null?void 0:pt.textContent)??"").trim())},[]),children:Rt.jsx(GC.ItemSlot,{scope:E,value:g,disabled:R,textValue:G,children:Rt.jsx(Xi.div,{role:"option","aria-labelledby":q,"data-highlighted":nt?"":void 0,"aria-selected":V&&nt,"data-state":V?"checked":"unchecked","aria-disabled":R||void 0,"data-disabled":R?"":void 0,tabIndex:R?void 0:-1,...N,ref:J,onFocus:ir(N.onFocus,()=>at(!0)),onBlur:ir(N.onBlur,()=>at(!1)),onClick:ir(N.onClick,()=>{it.current!=="mouse"&&ht()}),onPointerUp:ir(N.onPointerUp,()=>{it.current==="mouse"&&ht()}),onPointerDown:ir(N.onPointerDown,pt=>{it.current=pt.pointerType}),onPointerMove:ir(N.onPointerMove,pt=>{var lt;it.current=pt.pointerType,R?(lt=B.onItemLeave)==null||lt.call(B):it.current==="mouse"&&pt.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ir(N.onPointerLeave,pt=>{var lt;pt.currentTarget===document.activeElement&&((lt=B.onItemLeave)==null||lt.call(B))}),onKeyDown:ir(N.onKeyDown,pt=>{var bt;((bt=B.searchRef)==null?void 0:bt.current)!==""&&pt.key===" "||(Ett.includes(pt.key)&&ht(),pt.key===" "&&pt.preventDefault())})})})})});t4.displayName=CC;var LS="SelectItemText",e4=Z.forwardRef((h,_)=>{const{__scopeSelect:E,className:g,style:R,...w}=h,N=_d(LS,E),k=Ed(LS,E),B=$G(LS,E),V=vtt(LS,E),[G,z]=Z.useState(null),nt=Ur(_,ht=>z(ht),B.onItemTextChange,ht=>{var pt;return(pt=k.itemTextRefCallback)==null?void 0:pt.call(k,ht,B.value,B.disabled)}),at=G==null?void 0:G.textContent,J=Z.useMemo(()=>Rt.jsx("option",{value:B.value,disabled:B.disabled,children:at},B.value),[B.disabled,B.value,at]),{onNativeOptionAdd:q,onNativeOptionRemove:it}=V;return uo(()=>(q(J),()=>it(J)),[q,it,J]),Rt.jsxs(Rt.Fragment,{children:[Rt.jsx(Xi.span,{id:B.textId,...w,ref:nt}),B.isSelected&&N.valueNode&&!N.valueNodeHasChildren?jS.createPortal(w.children,N.valueNode):null]})});e4.displayName=LS;var n4="SelectItemIndicator",i4=Z.forwardRef((h,_)=>{const{__scopeSelect:E,...g}=h;return $G(n4,E).isSelected?Rt.jsx(Xi.span,{"aria-hidden":!0,...g,ref:_}):null});i4.displayName=n4;var PN="SelectScrollUpButton",r4=Z.forwardRef((h,_)=>{const E=Ed(PN,h.__scopeSelect),g=nD(PN,h.__scopeSelect),[R,w]=Z.useState(!1),N=Ur(_,g.onScrollButtonChange);return uo(()=>{if(E.viewport&&E.isPositioned){let k=function(){const V=B.scrollTop>0;w(V)};const B=E.viewport;return k(),B.addEventListener("scroll",k),()=>B.removeEventListener("scroll",k)}},[E.viewport,E.isPositioned]),R?Rt.jsx(o4,{...h,ref:N,onAutoScroll:()=>{const{viewport:k,selectedItem:B}=E;k&&B&&(k.scrollTop=k.scrollTop-B.offsetHeight)}}):null});r4.displayName=PN;var LN="SelectScrollDownButton",s4=Z.forwardRef((h,_)=>{const E=Ed(LN,h.__scopeSelect),g=nD(LN,h.__scopeSelect),[R,w]=Z.useState(!1),N=Ur(_,g.onScrollButtonChange);return uo(()=>{if(E.viewport&&E.isPositioned){let k=function(){const V=B.scrollHeight-B.clientHeight,G=Math.ceil(B.scrollTop)<V;w(G)};const B=E.viewport;return k(),B.addEventListener("scroll",k),()=>B.removeEventListener("scroll",k)}},[E.viewport,E.isPositioned]),R?Rt.jsx(o4,{...h,ref:N,onAutoScroll:()=>{const{viewport:k,selectedItem:B}=E;k&&B&&(k.scrollTop=k.scrollTop+B.offsetHeight)}}):null});s4.displayName=LN;var o4=Z.forwardRef((h,_)=>{const{__scopeSelect:E,onAutoScroll:g,...R}=h,w=Ed("SelectScrollButton",E),N=Z.useRef(null),k=HC(E),B=Z.useCallback(()=>{N.current!==null&&(window.clearInterval(N.current),N.current=null)},[]);return Z.useEffect(()=>()=>B(),[B]),uo(()=>{var G;const V=k().find(z=>z.ref.current===document.activeElement);(G=V==null?void 0:V.ref.current)==null||G.scrollIntoView({block:"nearest"})},[k]),Rt.jsx(Xi.div,{"aria-hidden":!0,...R,ref:_,style:{flexShrink:0,...R.style},onPointerDown:ir(R.onPointerDown,()=>{N.current===null&&(N.current=window.setInterval(g,50))}),onPointerMove:ir(R.onPointerMove,()=>{var V;(V=w.onItemLeave)==null||V.call(w),N.current===null&&(N.current=window.setInterval(g,50))}),onPointerLeave:ir(R.onPointerLeave,()=>{B()})})}),Ptt="SelectSeparator",a4=Z.forwardRef((h,_)=>{const{__scopeSelect:E,...g}=h;return Rt.jsx(Xi.div,{"aria-hidden":!0,...g,ref:_})});a4.displayName=Ptt;var kN="SelectArrow",Ltt=Z.forwardRef((h,_)=>{const{__scopeSelect:E,...g}=h,R=WC(E),w=_d(kN,E),N=Ed(kN,E);return w.open&&N.position==="popper"?Rt.jsx(C$,{...R,...g,ref:_}):null});Ltt.displayName=kN;function c4(h){return h===""||h===void 0}var l4=Z.forwardRef((h,_)=>{const{value:E,...g}=h,R=Z.useRef(null),w=Ur(_,R),N=I$(E);return Z.useEffect(()=>{const k=R.current,B=window.HTMLSelectElement.prototype,G=Object.getOwnPropertyDescriptor(B,"value").set;if(N!==E&&G){const z=new Event("change",{bubbles:!0});G.call(k,E),k.dispatchEvent(z)}},[N,E]),Rt.jsx(IG,{asChild:!0,children:Rt.jsx("select",{...g,ref:w,defaultValue:E})})});l4.displayName="BubbleSelect";function u4(h){const _=Hl(h),E=Z.useRef(""),g=Z.useRef(0),R=Z.useCallback(N=>{const k=E.current+N;_(k),function B(V){E.current=V,window.clearTimeout(g.current),V!==""&&(g.current=window.setTimeout(()=>B(""),1e3))}(k)},[_]),w=Z.useCallback(()=>{E.current="",window.clearTimeout(g.current)},[]);return Z.useEffect(()=>()=>window.clearTimeout(g.current),[]),[E,R,w]}function d4(h,_,E){const R=_.length>1&&Array.from(_).every(V=>V===_[0])?_[0]:_,w=E?h.indexOf(E):-1;let N=ktt(h,Math.max(w,0));R.length===1&&(N=N.filter(V=>V!==E));const B=N.find(V=>V.textValue.toLowerCase().startsWith(R.toLowerCase()));return B!==E?B:void 0}function ktt(h,_){return h.map((E,g)=>h[(_+g)%h.length])}var Mtt=VG,h4=jG,Utt=GG,xtt=HG,Vtt=WG,p4=KG,Btt=XG,f4=ZG,m4=t4,jtt=e4,Ftt=i4,_4=r4,E4=s4,g4=a4;const Gtt=Mtt,Htt=Utt,S4=Z.forwardRef(({className:h,children:_,...E},g)=>Rt.jsxs(h4,{ref:g,className:Rr("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",h),...E,children:[_,Rt.jsx(xtt,{asChild:!0,children:Rt.jsx(F3,{className:"h-4 w-4 opacity-50"})})]}));S4.displayName=h4.displayName;const T4=Z.forwardRef(({className:h,..._},E)=>Rt.jsx(_4,{ref:E,className:Rr("flex cursor-default items-center justify-center py-1",h),..._,children:Rt.jsx(eQ,{className:"h-4 w-4"})}));T4.displayName=_4.displayName;const v4=Z.forwardRef(({className:h,..._},E)=>Rt.jsx(E4,{ref:E,className:Rr("flex cursor-default items-center justify-center py-1",h),..._,children:Rt.jsx(F3,{className:"h-4 w-4"})}));v4.displayName=E4.displayName;const y4=Z.forwardRef(({className:h,children:_,position:E="popper",...g},R)=>Rt.jsx(Vtt,{children:Rt.jsxs(p4,{ref:R,className:Rr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",E==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",h),position:E,...g,children:[Rt.jsx(T4,{}),Rt.jsx(Btt,{className:Rr("p-1",E==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:_}),Rt.jsx(v4,{})]})}));y4.displayName=p4.displayName;const Wtt=Z.forwardRef(({className:h,..._},E)=>Rt.jsx(f4,{ref:E,className:Rr("px-2 py-1.5 text-sm font-semibold",h),..._}));Wtt.displayName=f4.displayName;const R4=Z.forwardRef(({className:h,children:_,...E},g)=>Rt.jsxs(m4,{ref:g,className:Rr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",h),...E,children:[Rt.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:Rt.jsx(Ftt,{children:Rt.jsx(ZJ,{className:"h-4 w-4"})})}),Rt.jsx(jtt,{children:_})]}));R4.displayName=m4.displayName;const Ktt=Z.forwardRef(({className:h,..._},E)=>Rt.jsx(g4,{ref:E,className:Rr("-mx-1 my-1 h-px bg-muted",h),..._}));Ktt.displayName=g4.displayName;const ztt=h=>{const{active:_,color:E,...g}=h;return _?Rt.jsx(aQ,{color:E||"#3D53F5",...g}):Rt.jsx(sQ,{color:E||"#667085",...g})};function Ytt(h){const{audioTrack:_}=h,[E,g]=Z.useState(!1),[R,w]=Z.useState();Z.useEffect(()=>(_==null||_.on("track-updated",k),_&&w(_.getMediaStreamTrack()),()=>{_==null||_.off("track-updated",k)}),[_]),Z.useEffect(()=>{_==null||_.setMuted(E)},[_,E]);const N=B3(R,10),k=V=>{console.log("[test] audio track updated",V),w(V)},B=()=>{g(!E)};return Rt.jsx(qtt,{title:"",Icon:ztt,onIconClick:B,isActive:!E,select:Rt.jsx(Jtt,{audioTrack:_}),children:Rt.jsx("div",{className:"flex flex-1 flex-col items-center justify-center self-stretch rounded-md",children:Rt.jsx(tG,{className:"bg-primary",barWidth:2,minBarHeight:2,maxBarHeight:20,frequencies:N,borderRadius:2,gap:2})})})}function qtt(h){const{title:_,Icon:E,onIconClick:g,isActive:R,select:w,children:N}=h;return Rt.jsx("div",{className:"flex flex-col",children:Rt.jsx("div",{className:"flex items-center justify-between",children:Rt.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[Rt.jsxs(kS,{variant:"outline",className:"border-secondary bg-transparent",onClick:g,children:[Rt.jsx(E,{className:"h-5 w-5",active:R}),N]}),Rt.jsx("div",{className:"flex flex-1 w-[100px]",children:w})]})})})}const Xtt=h=>{const{items:_,value:E,onChange:g,placeholder:R}=h;return Rt.jsxs(Gtt,{value:E,onValueChange:g,children:[Rt.jsx(S4,{className:"flex-1",children:Rt.jsx(Htt,{placeholder:R})}),Rt.jsx(y4,{children:_.map(w=>Rt.jsx(R4,{value:w.value,children:w.label},w.value))})]})},Jtt=h=>{const _=V3(),E=gN(k=>k.global.selectedMicrophone),{audioTrack:g}=h,[R,w]=Z.useState([]);Z.useEffect(()=>{DS.getMicrophones().then(k=>{w(k.map(B=>({label:B.label,value:B.label,deviceId:B.deviceId}))),_(mF({label:k[0].label,deviceId:k[0].deviceId,value:k[0].label}))})},[_]);const N=async k=>{const B=R.find(V=>V.value===k);B&&(_(mF(B)),g&&await g.setDevice(B.deviceId))};return Rt.jsx(Xtt,{items:R,value:E.label,onChange:N})};function Qtt(h){const{audioTrack:_}=h,E=B3(_,20);return Rt.jsx("div",{className:Rr("flex h-auto w-full flex-col items-center justify-center"),children:Rt.jsx("div",{className:"h-14 w-full",children:Rt.jsx(tG,{className:"bg-secondary",frequencies:E,barWidth:2,minBarHeight:2,maxBarHeight:10,borderRadius:2,gap:2})})})}function Ztt(){const h=V3(),[_]=Z.useState(`${Math.random().toString(36).substring(4)}`),[E,g]=Z.useState(!1),[R,w]=Z.useState(""),[N,k]=Z.useState(void 0),[B,V]=Z.useState(),G=gN(lt=>lt.global.agentConnected),z=gN(lt=>lt.global.selectedMicrophone),nt=async()=>{ld.on("localTracksChanged",pt),ld.on("remoteUserChanged",ht),await ld.createMicrophoneAudioTrack(z),await ld.join({channel:_,userId:0}),await ld.publish()},at=async()=>{ld.off("localTracksChanged",pt),ld.off("remoteUserChanged",ht),await ld.destroy()},J=async()=>{const{agent_id:lt}=await RJ({base_url:wC,channel:_});w(lt)},q=async()=>{await bJ(R),w("")},it=async()=>{g(!0),G?await Promise.all([at(),q()]):await Promise.all([nt(),J()]),h(zQ(!G)),g(!1)},ht=lt=>{console.log("[rtc] onRemoteUserChanged",lt),V(lt)},pt=lt=>{console.log("[rtc] onLocalTracksChanged",lt);const{audioTrack:bt}=lt;bt&&k(bt)};return Rt.jsxs(QF,{className:"w-[350px]",children:[Rt.jsxs(ZF,{children:[Rt.jsx($F,{children:"Dify & Agora Conversational AI Agent"}),Rt.jsx(t3,{children:"Talk to Dify, with your voice."})]}),Rt.jsx(e3,{children:Rt.jsxs("div",{className:"grid w-full items-center gap-4",children:[Rt.jsxs("div",{className:"flex flex-col space-y-1.5",children:[Rt.jsx(o3,{htmlFor:"name",children:"Agent Channel"}),Rt.jsx(i3,{id:"name",placeholder:"Name of your project",value:_})]}),Rt.jsx("div",{className:"flex flex-col space-y-1.5",children:Rt.jsx(Ytt,{audioTrack:N})})]})}),Rt.jsx(n3,{className:"flex justify-between",children:E?Rt.jsxs(kS,{disabled:!0,children:[Rt.jsx(iQ,{className:"animate-spin"}),"Please wait"]}):G?Rt.jsxs(kS,{onClick:it,variant:"destructive",children:["Stop",Rt.jsx(Qtt,{audioTrack:B==null?void 0:B.audioTrack})]}):Rt.jsx(kS,{onClick:it,children:"Talk"})})]})}function $tt({children:h}){const _=Z.useRef(null);return _.current||(_.current=tet()),Rt.jsx(GJ,{store:_.current,children:h})}const tet=()=>PQ({reducer:{global:YQ},devTools:!1});j7.createRoot(document.getElementById("root")).render(Rt.jsx(Z.StrictMode,{children:Rt.jsx($tt,{children:Rt.jsx(Ztt,{})})}));
